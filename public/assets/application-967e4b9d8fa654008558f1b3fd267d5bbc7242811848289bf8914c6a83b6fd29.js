/*! jQuery v1.7.2 jquery.com | jquery.org/license */

(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cu(a){if(!cj[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ck||(ck=c.createElement("iframe"),ck.frameBorder=ck.width=ck.height=0),b.appendChild(ck);if(!cl||!ck.createElement)cl=(ck.contentWindow||ck.contentDocument).document,cl.write((f.support.boxModel?"<!doctype html>":"")+"<html><body>"),cl.close();d=cl.createElement(a),cl.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ck)}cj[a]=e}return cj[a]}function ct(a,b){var c={};f.each(cp.concat.apply([],cp.slice(0,b)),function(){c[this]=a});return c}function cs(){cq=b}function cr(){setTimeout(cs,0);return cq=f.now()}function ci(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ch(){try{return new a.XMLHttpRequest}catch(b){}}function cb(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function ca(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function b_(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bD.test(a)?d(a,e):b_(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&f.type(b)==="object")for(var e in b)b_(a+"["+e+"]",b[e],c,d);else d(a,b)}function b$(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function bZ(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bS,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bZ(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bZ(a,c,d,e,"*",g));return l}function bY(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bO),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bB(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?1:0,g=4;if(d>0){if(c!=="border")for(;e<g;e+=2)c||(d-=parseFloat(f.css(a,"padding"+bx[e]))||0),c==="margin"?d+=parseFloat(f.css(a,c+bx[e]))||0:d-=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0;return d+"px"}d=by(a,b);if(d<0||d==null)d=a.style[b];if(bt.test(d))return d;d=parseFloat(d)||0;if(c)for(;e<g;e+=2)d+=parseFloat(f.css(a,"padding"+bx[e]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+bx[e]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+bx[e]))||0);return d+"px"}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;b.nodeType===1&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?b.outerHTML=a.outerHTML:c!=="input"||a.type!=="checkbox"&&a.type!=="radio"?c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text):(a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)),b.removeAttribute(f.expando),b.removeAttribute("_submit_attached"),b.removeAttribute("_change_attached"))}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c,i[c][d])}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?+d:j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.2",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){if(typeof c!="string"||!c)return null;var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h,i){var j,k=d==null,l=0,m=a.length;if(d&&typeof d=="object"){for(l in d)e.access(a,c,l,d[l],1,h,f);g=1}else if(f!==b){j=i===b&&e.isFunction(f),k&&(j?(j=c,c=function(a,b,c){return j.call(e(a),c)}):(c.call(a,f),c=null));if(c)for(;l<m;l++)c(a[l],d,j?f.call(a[l],l,c(a[l],d)):f,i);g=1}return g?a:k?c.call(a):m?c(a[0],d):h},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m,n=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?n(g):h==="function"&&(!a.unique||!p.has(g))&&c.push(g)},o=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,j=!0,m=k||0,k=0,l=c.length;for(;c&&m<l;m++)if(c[m].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}j=!1,c&&(a.once?e===!0?p.disable():c=[]:d&&d.length&&(e=d.shift(),p.fireWith(e[0],e[1])))},p={add:function(){if(c){var a=c.length;n(arguments),j?l=c.length:e&&e!==!0&&(k=a,o(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){j&&f<=l&&(l--,f<=m&&m--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&p.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(j?a.once||d.push([b,c]):(!a.once||!e)&&o(b,c));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!i}};return p};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p=c.createElement("div"),q=c.documentElement;p.setAttribute("className","t"),p.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=p.getElementsByTagName("*"),e=p.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=p.getElementsByTagName("input")[0],b={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:p.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,pixelMargin:!0},f.boxModel=b.boxModel=c.compatMode==="CSS1Compat",i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete p.test}catch(r){b.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",function(){b.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),i.setAttribute("name","t"),p.appendChild(i),j=c.createDocumentFragment(),j.appendChild(p.lastChild),b.checkClone=j.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,j.removeChild(i),j.appendChild(p);if(p.attachEvent)for(n in{submit:1,change:1,focusin:1})m="on"+n,o=m in p,o||(p.setAttribute(m,"return;"),o=typeof p[m]=="function"),b[n+"Bubbles"]=o;j.removeChild(p),j=g=h=p=i=null,f(function(){var d,e,g,h,i,j,l,m,n,q,r,s,t,u=c.getElementsByTagName("body")[0];!u||(m=1,t="padding:0;margin:0;border:",r="position:absolute;top:0;left:0;width:1px;height:1px;",s=t+"0;visibility:hidden;",n="style='"+r+t+"5px solid #000;",q="<div "+n+"display:block;'><div style='"+t+"0;display:block;overflow:hidden;'></div></div>"+"<table "+n+"' cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",d=c.createElement("div"),d.style.cssText=s+"width:0;height:0;position:static;top:0;margin-top:"+m+"px",u.insertBefore(d,u.firstChild),p=c.createElement("div"),d.appendChild(p),p.innerHTML="<table><tr><td style='"+t+"0;display:none'></td><td>t</td></tr></table>",k=p.getElementsByTagName("td"),o=k[0].offsetHeight===0,k[0].style.display="",k[1].style.display="none",b.reliableHiddenOffsets=o&&k[0].offsetHeight===0,a.getComputedStyle&&(p.innerHTML="",l=c.createElement("div"),l.style.width="0",l.style.marginRight="0",p.style.width="2px",p.appendChild(l),b.reliableMarginRight=(parseInt((a.getComputedStyle(l,null)||{marginRight:0}).marginRight,10)||0)===0),typeof p.style.zoom!="undefined"&&(p.innerHTML="",p.style.width=p.style.padding="1px",p.style.border=0,p.style.overflow="hidden",p.style.display="inline",p.style.zoom=1,b.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.style.overflow="visible",p.innerHTML="<div style='width:5px;'></div>",b.shrinkWrapBlocks=p.offsetWidth!==3),p.style.cssText=r+s,p.innerHTML=q,e=p.firstChild,g=e.firstChild,i=e.nextSibling.firstChild.firstChild,j={doesNotAddBorder:g.offsetTop!==5,doesAddBorderForTableAndCells:i.offsetTop===5},g.style.position="fixed",g.style.top="20px",j.fixedPosition=g.offsetTop===20||g.offsetTop===15,g.style.position=g.style.top="",e.style.overflow="hidden",e.style.position="relative",j.subtractsBorderForOverflowNotVisible=g.offsetTop===-5,j.doesNotIncludeMarginInBodyOffset=u.offsetTop!==m,a.getComputedStyle&&(p.style.marginTop="1%",b.pixelMargin=(a.getComputedStyle(p,null)||{marginTop:0}).marginTop!=="1%"),typeof d.style.zoom!="undefined"&&(d.style.zoom=1),u.removeChild(d),l=p=d=null,f.extend(b,j))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h,i,j=this[0],k=0,m=null;if(a===b){if(this.length){m=f.data(j);if(j.nodeType===1&&!f._data(j,"parsedAttrs")){g=j.attributes;for(i=g.length;k<i;k++)h=g[k].name,h.indexOf("data-")===0&&(h=f.camelCase(h.substring(5)),l(j,h,m[h]));f._data(j,"parsedAttrs",!0)}}return m}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!";return f.access(this,function(c){if(c===b){m=this.triggerHandler("getData"+e,[d[0]]),m===b&&j&&(m=f.data(j,a),m=l(j,a,m));return m===b&&d[1]?this.data(d[0]):m}d[1]=c,this.each(function(){var b=f(this);b.triggerHandler("setData"+e,d),f.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1)},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){var d=2;typeof a!="string"&&(c=a,a="fx",d--);if(arguments.length<d)return f.queue(this[0],a);return c===b?this:this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise(c)}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,f.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,f.prop,a,b,arguments.length>1)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.type]||f.valHooks[g.nodeName.toLowerCase()];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h,i=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;i<g;i++)e=d[i],e&&(c=f.propFix[e]||e,h=u.test(e),h||f.attr(a,e,""),a.removeAttribute(v?e:c),h&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0,coords:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/(?:^|\s)hover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(
a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler,g=p.selector),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:g&&G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=f.event.special[c.type]||{},j=[],k,l,m,n,o,p,q,r,s,t,u;g[0]=c,c.delegateTarget=this;if(!i.preDispatch||i.preDispatch.call(this,c)!==!1){if(e&&(!c.button||c.type!=="click")){n=f(this),n.context=this.ownerDocument||this;for(m=c.target;m!=this;m=m.parentNode||this)if(m.disabled!==!0){p={},r=[],n[0]=m;for(k=0;k<e;k++)s=d[k],t=s.selector,p[t]===b&&(p[t]=s.quick?H(m,s.quick):n.is(t)),p[t]&&r.push(s);r.length&&j.push({elem:m,matches:r})}}d.length>e&&j.push({elem:this,matches:d.slice(e)});for(k=0;k<j.length&&!c.isPropagationStopped();k++){q=j[k],c.currentTarget=q.elem;for(l=0;l<q.matches.length&&!c.isImmediatePropagationStopped();l++){s=q.matches[l];if(h||!c.namespace&&!s.namespace||c.namespace_re&&c.namespace_re.test(s.namespace))c.data=s.data,c.handleObj=s,o=((f.event.special[s.origType]||{}).handle||s.handler).apply(q.elem,g),o!==b&&(c.result=o,o===!1&&(c.preventDefault(),c.stopPropagation()))}}i.postDispatch&&i.postDispatch.call(this,c);return c.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),d._submit_attached=!0)})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9||d===11){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));o.match.globalPOS=p;var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.globalPOS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")[\\s/>]","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){return f.access(this,function(a){return a===b?f.text(this):this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f
.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){return f.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(f.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(g){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,function(a,b){b.src?f.ajax({type:"GET",global:!1,url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||f.isXMLDoc(a)||!bc.test("<"+a.nodeName+">")?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g,h,i,j=[];b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);for(var k=0,l;(l=a[k])!=null;k++){typeof l=="number"&&(l+="");if(!l)continue;if(typeof l=="string")if(!_.test(l))l=b.createTextNode(l);else{l=l.replace(Y,"<$1></$2>");var m=(Z.exec(l)||["",""])[1].toLowerCase(),n=bg[m]||bg._default,o=n[0],p=b.createElement("div"),q=bh.childNodes,r;b===c?bh.appendChild(p):U(b).appendChild(p),p.innerHTML=n[1]+l+n[2];while(o--)p=p.lastChild;if(!f.support.tbody){var s=$.test(l),t=m==="table"&&!s?p.firstChild&&p.firstChild.childNodes:n[1]==="<table>"&&!s?p.childNodes:[];for(i=t.length-1;i>=0;--i)f.nodeName(t[i],"tbody")&&!t[i].childNodes.length&&t[i].parentNode.removeChild(t[i])}!f.support.leadingWhitespace&&X.test(l)&&p.insertBefore(b.createTextNode(X.exec(l)[0]),p.firstChild),l=p.childNodes,p&&(p.parentNode.removeChild(p),q.length>0&&(r=q[q.length-1],r&&r.parentNode&&r.parentNode.removeChild(r)))}var u;if(!f.support.appendChecked)if(l[0]&&typeof (u=l.length)=="number")for(i=0;i<u;i++)bn(l[i]);else bn(l);l.nodeType?j.push(l):j=f.merge(j,l)}if(d){g=function(a){return!a.type||be.test(a.type)};for(k=0;j[k];k++){h=j[k];if(e&&f.nodeName(h,"script")&&(!h.type||be.test(h.type)))e.push(h.parentNode?h.parentNode.removeChild(h):h);else{if(h.nodeType===1){var v=f.grep(h.getElementsByTagName("script"),g);j.splice.apply(j,[k+1,0].concat(v))}d.appendChild(h)}}}return j},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bp=/alpha\([^)]*\)/i,bq=/opacity=([^)]*)/,br=/([A-Z]|^ms)/g,bs=/^[\-+]?(?:\d*\.)?\d+$/i,bt=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,bu=/^([\-+])=([\-+.\de]+)/,bv=/^margin/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Top","Right","Bottom","Left"],by,bz,bA;f.fn.css=function(a,c){return f.access(this,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)},a,c,arguments.length>1)},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=by(a,"opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bu.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(by)return by(a,c)},swap:function(a,b,c){var d={},e,f;for(f in b)d[f]=a.style[f],a.style[f]=b[f];e=c.call(a);for(f in b)a.style[f]=d[f];return e}}),f.curCSS=f.css,c.defaultView&&c.defaultView.getComputedStyle&&(bz=function(a,b){var c,d,e,g,h=a.style;b=b.replace(br,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b))),!f.support.pixelMargin&&e&&bv.test(b)&&bt.test(c)&&(g=h.width,h.width=c,c=e.width,h.width=g);return c}),c.documentElement.currentStyle&&(bA=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f==null&&g&&(e=g[b])&&(f=e),bt.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),by=bz||bA,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth!==0?bB(a,b,d):f.swap(a,bw,function(){return bB(a,b,d)})},set:function(a,b){return bs.test(b)?b+"px":b}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bq.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bp,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bp.test(g)?g.replace(bp,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){return f.swap(a,{display:"inline-block"},function(){return b?by(a,"margin-right"):a.style.marginRight})}})}),f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)}),f.each({margin:"",padding:"",border:"Width"},function(a,b){f.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bx[d]+b]=e[d]||e[d-2]||e[0];return f}}});var bC=/%20/g,bD=/\[\]$/,bE=/\r?\n/g,bF=/#.*$/,bG=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bH=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bI=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bJ=/^(?:GET|HEAD)$/,bK=/^\/\//,bL=/\?/,bM=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bN=/^(?:select|textarea)/i,bO=/\s+/,bP=/([?&])_=[^&]*/,bQ=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bR=f.fn.load,bS={},bT={},bU,bV,bW=["*/"]+["*"];try{bU=e.href}catch(bX){bU=c.createElement("a"),bU.href="",bU=bU.href}bV=bQ.exec(bU.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bR)return bR.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bM,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bN.test(this.nodeName)||bH.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bE,"\r\n")}}):{name:b.name,value:c.replace(bE,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b$(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b$(a,b);return a},ajaxSettings:{url:bU,isLocal:bI.test(bV[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bW},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bY(bS),ajaxTransport:bY(bT),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?ca(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cb(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bG.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bF,"").replace(bK,bV[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bO),d.crossDomain==null&&(r=bQ.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bV[1]&&r[2]==bV[2]&&(r[3]||(r[1]==="http:"?80:443))==(bV[3]||(bV[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bZ(bS,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bJ.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bL.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bP,"$1_="+x);d.url=y+(y===d.url?(bL.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bW+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=bZ(bT,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)b_(g,a[g],c,e);return d.join("&").replace(bC,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cc=f.now(),cd=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cc++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=typeof b.data=="string"&&/^application\/x\-www\-form\-urlencoded/.test(b.contentType);if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(cd.test(b.url)||e&&cd.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(cd,l),b.url===j&&(e&&(k=k.replace(cd,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var ce=a.ActiveXObject?function(){for(var a in cg)cg[a](0,1)}:!1,cf=0,cg;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ch()||ci()}:ch,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,ce&&delete cg[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n);try{m.text=h.responseText}catch(a){}try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cf,ce&&(cg||(cg={},f(a).unload(ce)),cg[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cj={},ck,cl,cm=/^(?:toggle|show|hide)$/,cn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,co,cp=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cq;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(ct("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),(e===""&&f.css(d,"display")==="none"||!f.contains(d.ownerDocument.documentElement,d))&&f._data(d,"olddisplay",cu(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(ct("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(ct("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o,p,q;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]);if((k=f.cssHooks[g])&&"expand"in k){l=k.expand(a[g]),delete a[g];for(i in l)i in a||(a[i]=l[i])}}for(g in a){h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cu(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cm.test(h)?(q=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),q?(f._data(this,"toggle"+i,q==="show"?"hide":"show"),j[q]()):j[h]()):(m=cn.exec(h),n=j.cur(),m?(o=parseFloat(m[2]),p=m[3]||(f.cssNumber[i]?"":"px"),p!=="px"&&(f.style(this,i,(o||1)+p),n=(o||1)/j.cur()*n,f.style(this,i,n+p)),m[1]&&(o=(m[1]==="-="?-1:1)*o+n),j.custom(n,o,p)):j.custom(n,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:ct("show",1),slideUp:ct("hide",1),slideToggle:ct("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a){return a},swing:function(a){return-Math.cos(a*Math.PI)/2+.5}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cq||cr(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){f._data(e.elem,"fxshow"+e.prop)===b&&(e.options.hide?f._data(e.elem,"fxshow"+e.prop,e.start):e.options.show&&f._data(e.elem,"fxshow"+e.prop,e.end))},h()&&f.timers.push(h)&&!co&&(co=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cq||cr(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(co),co=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(cp.concat.apply([],cp),function(a,b){b.indexOf("margin")&&(f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)})}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cv,cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?cv=function(a,b,c,d){try{d=a.getBoundingClientRect()}catch(e){}if(!d||!f.contains(c,a))return d?{top:d.top,left:d.left}:{top:0,left:0};var g=b.body,h=cy(b),i=c.clientTop||g.clientTop||0,j=c.clientLeft||g.clientLeft||0,k=h.pageYOffset||f.support.boxModel&&c.scrollTop||g.scrollTop,l=h.pageXOffset||f.support.boxModel&&c.scrollLeft||g.scrollLeft,m=d.top+k-i,n=d.left+l-j;return{top:m,left:n}}:cv=function(a,b,c){var d,e=a.offsetParent,g=a,h=b.body,i=b.defaultView,j=i?i.getComputedStyle(a,null):a.currentStyle,k=a.offsetTop,l=a.offsetLeft;while((a=a.parentNode)&&a!==h&&a!==c){if(f.support.fixedPosition&&j.position==="fixed")break;d=i?i.getComputedStyle(a,null):a.currentStyle,k-=a.scrollTop,l-=a.scrollLeft,a===e&&(k+=a.offsetTop,l+=a.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(a.nodeName))&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),g=e,e=a.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&d.overflow!=="visible"&&(k+=parseFloat(d.borderTopWidth)||0,l+=parseFloat(d.borderLeftWidth)||0),j=d}if(j.position==="relative"||j.position==="static")k+=h.offsetTop,l+=h.offsetLeft;f.support.fixedPosition&&j.position==="fixed"&&(k+=Math.max(c.scrollTop,h.scrollTop),l+=Math.max(c.scrollLeft,h.scrollLeft));return{top:k,left:l}},f.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){f.offset.setOffset(this,a,b)});var c=this[0],d=c&&c.ownerDocument;if(!d)return null;if(c===d.body)return f.offset.bodyOffset(c);return cv(c,d,d.documentElement)},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);f.fn[a]=function(e){return f.access(this,function(a,e,g){var h=cy(a);if(g===b)return h?c in h?h[c]:f.support.boxModel&&h.document.documentElement[e]||h.document.body[e]:a[e];h?h.scrollTo(d?f(h).scrollLeft():g,d?g:f(h).scrollTop()):a[e]=g},a,e,arguments.length,null)}}),f.each({Height:"height",Width:"width"},function(a,c){var d="client"+a,e="scroll"+a,g="offset"+a;f.fn["inner"+a]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,c,"padding")):this[c]():null},f.fn["outer"+a]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,c,a?"margin":"border")):this[c]():null},f.fn[c]=function(a){return f.access(this,function(a,c,h){var i,j,k,l;if(f.isWindow(a)){i=a.document,j=i.documentElement[d];return f.support.boxModel&&j||i.body&&i.body[d]||j}if(a.nodeType===9){i=a.documentElement;if(i[d]>=i[e])return i[d];return Math.max(a.body[e],i[e],a.body[g],i[g])}if(h===b){k=f.css(a,c),l=parseFloat(k);return f.isNumeric(l)?l:k}f(a).css(c,h)},c,a,arguments.length,null)}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);
(function($, undefined) {

/**
 * Unobtrusive scripting adapter for jQuery
 * https://github.com/rails/jquery-ujs
 *
 * Requires jQuery 1.7.0 or later.
 *
 * Released under the MIT license
 *
 */

  // Cut down on the number of issues from people inadvertently including jquery_ujs twice
  // by detecting and raising an error when it happens.
  if ( $.rails !== undefined ) {
    $.error('jquery-ujs has already been loaded!');
  }

  // Shorthand to make it a little easier to call public rails functions from within rails.js
  var rails;
  var $document = $(document);

  $.rails = rails = {
    // Link elements bound by jquery-ujs
    linkClickSelector: 'a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]',

    // Button elements bound by jquery-ujs
    buttonClickSelector: 'button[data-remote]',

    // Select elements bound by jquery-ujs
    inputChangeSelector: 'select[data-remote], input[data-remote], textarea[data-remote]',

    // Form elements bound by jquery-ujs
    formSubmitSelector: 'form',

    // Form input elements bound by jquery-ujs
    formInputClickSelector: 'form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])',

    // Form input elements disabled during form submission
    disableSelector: 'input[data-disable-with], button[data-disable-with], textarea[data-disable-with]',

    // Form input elements re-enabled after form submission
    enableSelector: 'input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled',

    // Form required input elements
    requiredInputSelector: 'input[name][required]:not([disabled]),textarea[name][required]:not([disabled])',

    // Form file input elements
    fileInputSelector: 'input[type=file]',

    // Link onClick disable selector with possible reenable after remote submission
    linkDisableSelector: 'a[data-disable-with]',

    // Make sure that every Ajax request sends the CSRF token
    CSRFProtection: function(xhr) {
      var token = $('meta[name="csrf-token"]').attr('content');
      if (token) xhr.setRequestHeader('X-CSRF-Token', token);
    },

    // making sure that all forms have actual up-to-date token(cached forms contain old one)
    refreshCSRFTokens: function(){
      var csrfToken = $('meta[name=csrf-token]').attr('content');
      var csrfParam = $('meta[name=csrf-param]').attr('content');
      $('form input[name="' + csrfParam + '"]').val(csrfToken);
    },

    // Triggers an event on an element and returns false if the event result is false
    fire: function(obj, name, data) {
      var event = $.Event(name);
      obj.trigger(event, data);
      return event.result !== false;
    },

    // Default confirm dialog, may be overridden with custom confirm dialog in $.rails.confirm
    confirm: function(message) {
      return confirm(message);
    },

    // Default ajax function, may be overridden with custom function in $.rails.ajax
    ajax: function(options) {
      return $.ajax(options);
    },

    // Default way to get an element's href. May be overridden at $.rails.href.
    href: function(element) {
      return element.attr('href');
    },

    // Submits "remote" forms and links with ajax
    handleRemote: function(element) {
      var method, url, data, elCrossDomain, crossDomain, withCredentials, dataType, options;

      if (rails.fire(element, 'ajax:before')) {
        elCrossDomain = element.data('cross-domain');
        crossDomain = elCrossDomain === undefined ? null : elCrossDomain;
        withCredentials = element.data('with-credentials') || null;
        dataType = element.data('type') || ($.ajaxSettings && $.ajaxSettings.dataType);

        if (element.is('form')) {
          method = element.attr('method');
          url = element.attr('action');
          data = element.serializeArray();
          // memoized value from clicked submit button
          var button = element.data('ujs:submit-button');
          if (button) {
            data.push(button);
            element.data('ujs:submit-button', null);
          }
        } else if (element.is(rails.inputChangeSelector)) {
          method = element.data('method');
          url = element.data('url');
          data = element.serialize();
          if (element.data('params')) data = data + "&" + element.data('params');
        } else if (element.is(rails.buttonClickSelector)) {
          method = element.data('method') || 'get';
          url = element.data('url');
          data = element.serialize();
          if (element.data('params')) data = data + "&" + element.data('params');
        } else {
          method = element.data('method');
          url = rails.href(element);
          data = element.data('params') || null;
        }

        options = {
          type: method || 'GET', data: data, dataType: dataType,
          // stopping the "ajax:beforeSend" event will cancel the ajax request
          beforeSend: function(xhr, settings) {
            if (settings.dataType === undefined) {
              xhr.setRequestHeader('accept', '*/*;q=0.5, ' + settings.accepts.script);
            }
            return rails.fire(element, 'ajax:beforeSend', [xhr, settings]);
          },
          success: function(data, status, xhr) {
            element.trigger('ajax:success', [data, status, xhr]);
          },
          complete: function(xhr, status) {
            element.trigger('ajax:complete', [xhr, status]);
          },
          error: function(xhr, status, error) {
            element.trigger('ajax:error', [xhr, status, error]);
          },
          crossDomain: crossDomain
        };

        // There is no withCredentials for IE6-8 when
        // "Enable native XMLHTTP support" is disabled
        if (withCredentials) {
          options.xhrFields = {
            withCredentials: withCredentials
          };
        }

        // Only pass url to `ajax` options if not blank
        if (url) { options.url = url; }

        var jqxhr = rails.ajax(options);
        element.trigger('ajax:send', jqxhr);
        return jqxhr;
      } else {
        return false;
      }
    },

    // Handles "data-method" on links such as:
    // <a href="/users/5" data-method="delete" rel="nofollow" data-confirm="Are you sure?">Delete</a>
    handleMethod: function(link) {
      var href = rails.href(link),
        method = link.data('method'),
        target = link.attr('target'),
        csrfToken = $('meta[name=csrf-token]').attr('content'),
        csrfParam = $('meta[name=csrf-param]').attr('content'),
        form = $('<form method="post" action="' + href + '"></form>'),
        metadataInput = '<input name="_method" value="' + method + '" type="hidden" />';

      if (csrfParam !== undefined && csrfToken !== undefined) {
        metadataInput += '<input name="' + csrfParam + '" value="' + csrfToken + '" type="hidden" />';
      }

      if (target) { form.attr('target', target); }

      form.hide().append(metadataInput).appendTo('body');
      form.submit();
    },

    /* Disables form elements:
      - Caches element value in 'ujs:enable-with' data store
      - Replaces element text with value of 'data-disable-with' attribute
      - Sets disabled property to true
    */
    disableFormElements: function(form) {
      form.find(rails.disableSelector).each(function() {
        var element = $(this), method = element.is('button') ? 'html' : 'val';
        element.data('ujs:enable-with', element[method]());
        element[method](element.data('disable-with'));
        element.prop('disabled', true);
      });
    },

    /* Re-enables disabled form elements:
      - Replaces element text with cached value from 'ujs:enable-with' data store (created in `disableFormElements`)
      - Sets disabled property to false
    */
    enableFormElements: function(form) {
      form.find(rails.enableSelector).each(function() {
        var element = $(this), method = element.is('button') ? 'html' : 'val';
        if (element.data('ujs:enable-with')) element[method](element.data('ujs:enable-with'));
        element.prop('disabled', false);
      });
    },

   /* For 'data-confirm' attribute:
      - Fires `confirm` event
      - Shows the confirmation dialog
      - Fires the `confirm:complete` event

      Returns `true` if no function stops the chain and user chose yes; `false` otherwise.
      Attaching a handler to the element's `confirm` event that returns a `falsy` value cancels the confirmation dialog.
      Attaching a handler to the element's `confirm:complete` event that returns a `falsy` value makes this function
      return false. The `confirm:complete` event is fired whether or not the user answered true or false to the dialog.
   */
    allowAction: function(element) {
      var message = element.data('confirm'),
          answer = false, callback;
      if (!message) { return true; }

      if (rails.fire(element, 'confirm')) {
        answer = rails.confirm(message);
        callback = rails.fire(element, 'confirm:complete', [answer]);
      }
      return answer && callback;
    },

    // Helper function which checks for blank inputs in a form that match the specified CSS selector
    blankInputs: function(form, specifiedSelector, nonBlank) {
      var inputs = $(), input, valueToCheck,
          selector = specifiedSelector || 'input,textarea',
          allInputs = form.find(selector);

      allInputs.each(function() {
        input = $(this);
        valueToCheck = input.is('input[type=checkbox],input[type=radio]') ? input.is(':checked') : input.val();
        // If nonBlank and valueToCheck are both truthy, or nonBlank and valueToCheck are both falsey
        if (!valueToCheck === !nonBlank) {

          // Don't count unchecked required radio if other radio with same name is checked
          if (input.is('input[type=radio]') && allInputs.filter('input[type=radio]:checked[name="' + input.attr('name') + '"]').length) {
            return true; // Skip to next input
          }

          inputs = inputs.add(input);
        }
      });
      return inputs.length ? inputs : false;
    },

    // Helper function which checks for non-blank inputs in a form that match the specified CSS selector
    nonBlankInputs: function(form, specifiedSelector) {
      return rails.blankInputs(form, specifiedSelector, true); // true specifies nonBlank
    },

    // Helper function, needed to provide consistent behavior in IE
    stopEverything: function(e) {
      $(e.target).trigger('ujs:everythingStopped');
      e.stopImmediatePropagation();
      return false;
    },

    //  replace element's html with the 'data-disable-with' after storing original html
    //  and prevent clicking on it
    disableElement: function(element) {
      element.data('ujs:enable-with', element.html()); // store enabled state
      element.html(element.data('disable-with')); // set to disabled state
      element.bind('click.railsDisable', function(e) { // prevent further clicking
        return rails.stopEverything(e);
      });
    },

    // restore element to its original state which was disabled by 'disableElement' above
    enableElement: function(element) {
      if (element.data('ujs:enable-with') !== undefined) {
        element.html(element.data('ujs:enable-with')); // set to old enabled state
        element.removeData('ujs:enable-with'); // clean up cache
      }
      element.unbind('click.railsDisable'); // enable element
    }

  };

  if (rails.fire($document, 'rails:attachBindings')) {

    $.ajaxPrefilter(function(options, originalOptions, xhr){ if ( !options.crossDomain ) { rails.CSRFProtection(xhr); }});

    $document.delegate(rails.linkDisableSelector, 'ajax:complete', function() {
        rails.enableElement($(this));
    });

    $document.delegate(rails.linkClickSelector, 'click.rails', function(e) {
      var link = $(this), method = link.data('method'), data = link.data('params'), metaClick = e.metaKey || e.ctrlKey;
      if (!rails.allowAction(link)) return rails.stopEverything(e);

      if (!metaClick && link.is(rails.linkDisableSelector)) rails.disableElement(link);

      if (link.data('remote') !== undefined) {
        if (metaClick && (!method || method === 'GET') && !data) { return true; }

        var handleRemote = rails.handleRemote(link);
        // response from rails.handleRemote() will either be false or a deferred object promise.
        if (handleRemote === false) {
          rails.enableElement(link);
        } else {
          handleRemote.error( function() { rails.enableElement(link); } );
        }
        return false;

      } else if (link.data('method')) {
        rails.handleMethod(link);
        return false;
      }
    });

    $document.delegate(rails.buttonClickSelector, 'click.rails', function(e) {
      var button = $(this);
      if (!rails.allowAction(button)) return rails.stopEverything(e);

      rails.handleRemote(button);
      return false;
    });

    $document.delegate(rails.inputChangeSelector, 'change.rails', function(e) {
      var link = $(this);
      if (!rails.allowAction(link)) return rails.stopEverything(e);

      rails.handleRemote(link);
      return false;
    });

    $document.delegate(rails.formSubmitSelector, 'submit.rails', function(e) {
      var form = $(this),
        remote = form.data('remote') !== undefined,
        blankRequiredInputs = rails.blankInputs(form, rails.requiredInputSelector),
        nonBlankFileInputs = rails.nonBlankInputs(form, rails.fileInputSelector);

      if (!rails.allowAction(form)) return rails.stopEverything(e);

      // skip other logic when required values are missing or file upload is present
      if (blankRequiredInputs && form.attr("novalidate") == undefined && rails.fire(form, 'ajax:aborted:required', [blankRequiredInputs])) {
        return rails.stopEverything(e);
      }

      if (remote) {
        if (nonBlankFileInputs) {
          // slight timeout so that the submit button gets properly serialized
          // (make it easy for event handler to serialize form without disabled values)
          setTimeout(function(){ rails.disableFormElements(form); }, 13);
          var aborted = rails.fire(form, 'ajax:aborted:file', [nonBlankFileInputs]);

          // re-enable form elements if event bindings return false (canceling normal form submission)
          if (!aborted) { setTimeout(function(){ rails.enableFormElements(form); }, 13); }

          return aborted;
        }

        rails.handleRemote(form);
        return false;

      } else {
        // slight timeout so that the submit button gets properly serialized
        setTimeout(function(){ rails.disableFormElements(form); }, 13);
      }
    });

    $document.delegate(rails.formInputClickSelector, 'click.rails', function(event) {
      var button = $(this);

      if (!rails.allowAction(button)) return rails.stopEverything(event);

      // register the pressed submit button
      var name = button.attr('name'),
        data = name ? {name:name, value:button.val()} : null;

      button.closest('form').data('ujs:submit-button', data);
    });

    $document.delegate(rails.formSubmitSelector, 'ajax:beforeSend.rails', function(event) {
      if (this == event.target) rails.disableFormElements($(this));
    });

    $document.delegate(rails.formSubmitSelector, 'ajax:complete.rails', function(event) {
      if (this == event.target) rails.enableFormElements($(this));
    });

    $(function(){
      rails.refreshCSRFTokens();
    });
  }

})( jQuery );
!function(e){var t=function(e){this.value={h:1,s:1,b:1,a:1};this.setColor(e)};t.prototype={constructor:t,setColor:function(t){t=t.toLowerCase();var n=this;e.each(r.stringParsers,function(e,i){var s=i.re.exec(t),o=s&&i.parse(s),u=i.space||"rgba";if(o){if(u==="hsla"){n.value=r.RGBtoHSB.apply(null,r.HSLtoRGB.apply(null,o))}else{n.value=r.RGBtoHSB.apply(null,o)}return false}})},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setLightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=parseInt((1-e)*100,10)/100},toRGB:function(e,t,n,r){if(!e){e=this.value.h;t=this.value.s;n=this.value.b}e*=360;var i,s,o,u,a;e=e%360/60;a=n*t;u=a*(1-Math.abs(e%2-1));i=s=o=n-a;e=~~e;i+=[a,u,0,0,u,a][e];s+=[u,a,a,u,0,0][e];o+=[0,0,u,a,a,u][e];return{r:Math.round(i*255),g:Math.round(s*255),b:Math.round(o*255),a:r||this.value.a}},toHex:function(e,t,n,r){var i=this.toRGB(e,t,n,r);return"#"+(1<<24|parseInt(i.r)<<16|parseInt(i.g)<<8|parseInt(i.b)).toString(16).substr(1)},toHSL:function(e,t,n,r){if(!e){e=this.value.h;t=this.value.s;n=this.value.b}var i=e,s=(2-t)*n,o=t*n;if(s>0&&s<=1){o/=s}else{o/=2-s}s/=2;if(o>1){o=1}return{h:i,s:o,l:s,a:r||this.value.a}}};var n=function(t,n){this.element=e(t);var i=n.format||this.element.data("color-format")||"hex";this.format=r.translateFormats[i];this.isInput=this.element.is("input");this.component=this.element.is(".color")?this.element.find(".add-on"):false;this.picker=e(r.template).appendTo("body").on("mousedown",e.proxy(this.mousedown,this));if(this.isInput){this.element.on({focus:e.proxy(this.show,this),keyup:e.proxy(this.update,this)})}else if(this.component){this.component.on({click:e.proxy(this.show,this)})}else{this.element.on({click:e.proxy(this.show,this)})}if(i==="rgba"||i==="hsla"){this.picker.addClass("alpha");this.alpha=this.picker.find(".colorpicker-alpha")[0].style}if(this.component){this.picker.find(".colorpicker-color").hide();this.preview=this.element.find("i")[0].style}else{this.preview=this.picker.find("div:last")[0].style}this.base=this.picker.find("div:first")[0].style;this.update()};n.prototype={constructor:n,show:function(t){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();e(window).on("resize",e.proxy(this.place,this));if(!this.isInput){if(t){t.stopPropagation();t.preventDefault()}}e(document).on({mousedown:e.proxy(this.hide,this)});this.element.trigger({type:"show",color:this.color})},update:function(){this.color=new t(this.isInput?this.element.prop("value"):this.element.data("color"));this.picker.find("i").eq(0).css({left:this.color.value.s*100,top:100-this.color.value.b*100}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a));this.previewColor()},setValue:function(e){this.color=new t(e);this.picker.find("i").eq(0).css({left:this.color.value.s*100,top:100-this.color.value.b*100}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a));this.previewColor();this.element.trigger({type:"changeColor",color:this.color})},hide:function(){this.picker.hide();e(window).off("resize",this.place);if(!this.isInput){e(document).off({mousedown:this.hide});if(this.component){this.element.find("input").prop("value",this.format.call(this))}this.element.data("color",this.format.call(this))}else{this.element.prop("value",this.format.call(this))}this.element.trigger({type:"hide",color:this.color})},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height,left:e.left})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1);if(this.alpha){this.alpha.backgroundColor=this.color.toHex()}},pointer:null,slider:null,mousedown:function(t){t.stopPropagation();t.preventDefault();var n=e(t.target);var i=n.closest("div");if(!i.is(".colorpicker")){if(i.is(".colorpicker-saturation")){this.slider=e.extend({},r.sliders.saturation)}else if(i.is(".colorpicker-hue")){this.slider=e.extend({},r.sliders.hue)}else if(i.is(".colorpicker-alpha")){this.slider=e.extend({},r.sliders.alpha)}else{return false}var s=i.offset();this.slider.knob=i.find("i")[0].style;this.slider.left=t.pageX-s.left;this.slider.top=t.pageY-s.top;this.pointer={left:t.pageX,top:t.pageY};e(document).on({mousemove:e.proxy(this.mousemove,this),mouseup:e.proxy(this.mouseup,this)}).trigger("mousemove")}return false},mousemove:function(e){e.stopPropagation();e.preventDefault();var t=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((e.pageX||this.pointer.left)-this.pointer.left)));var n=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((e.pageY||this.pointer.top)-this.pointer.top)));this.slider.knob.left=t+"px";this.slider.knob.top=n+"px";if(this.slider.callLeft){this.color[this.slider.callLeft].call(this.color,t/100)}if(this.slider.callTop){this.color[this.slider.callTop].call(this.color,n/100)}this.previewColor();this.element.trigger({type:"changeColor",color:this.color});return false},mouseup:function(t){t.stopPropagation();t.preventDefault();e(document).off({mousemove:this.mousemove,mouseup:this.mouseup});return false}};e.fn.colorpicker=function(t,r){return this.each(function(){var i=e(this),s=i.data("colorpicker"),o=typeof t==="object"&&t;if(!s){i.data("colorpicker",s=new n(this,e.extend({},e.fn.colorpicker.defaults,o)))}if(typeof t==="string")s[t](r)})};e.fn.colorpicker.defaults={};e.fn.colorpicker.Constructor=n;var r={translateFormats:{rgb:function(){var e=this.color.toRGB();return"rgb("+e.r+","+e.g+","+e.b+")"},rgba:function(){var e=this.color.toRGB();return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},hsl:function(){var e=this.color.toHSL();return"hsl("+Math.round(e.h*360)+","+Math.round(e.s*100)+"%,"+Math.round(e.l*100)+"%)"},hsla:function(){var e=this.color.toHSL();return"hsla("+Math.round(e.h*360)+","+Math.round(e.s*100)+"%,"+Math.round(e.l*100)+"%,"+e.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:false,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:false,callTop:"setAlpha"}},RGBtoHSB:function(e,t,n,r){e/=255;t/=255;n/=255;var i,s,o,u;o=Math.max(e,t,n);u=o-Math.min(e,t,n);i=u===0?null:o==e?(t-n)/u:o==t?(n-e)/u+2:(e-t)/u+4;i=(i+360)%6*60/360;s=u===0?0:u/o;return{h:i||1,s:s,b:o,a:r||1}},HueToRGB:function(e,t,n){if(n<0)n+=1;else if(n>1)n-=1;if(n*6<1)return e+(t-e)*n*6;else if(n*2<1)return t;else if(n*3<2)return e+(t-e)*(2/3-n)*6;else return e},HSLtoRGB:function(e,t,n,i){if(t<0){t=0}var s;if(n<=.5){s=n*(1+t)}else{s=n+t-n*t}var o=2*n-s;var u=e+1/3;var a=e;var f=e-1/3;var l=Math.round(r.HueToRGB(o,s,u)*255);var c=Math.round(r.HueToRGB(o,s,a)*255);var h=Math.round(r.HueToRGB(o,s,f)*255);return[l,c,h,i||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}}],template:'<div class="colorpicker dropdown-menu">'+'<div class="colorpicker-saturation"><i><b></b></i></div>'+'<div class="colorpicker-hue"><i></i></div>'+'<div class="colorpicker-alpha"><i></i></div>'+'<div class="colorpicker-color"><div /></div>'+"</div>"}}(window.jQuery)
;
/*!
 * Bootstrap-select v1.6.2 (http://silviomoreto.github.io/bootstrap-select/)
 *
 * Copyright 2013-2014 bootstrap-select
 * Licensed under MIT (https://github.com/silviomoreto/bootstrap-select/blob/master/LICENSE)
 */

(function ($) {
  'use strict';

  // Case insensitive search
  $.expr[':'].icontains = function (obj, index, meta) {
    return icontains($(obj).text(), meta[3]);
  };

  // Case and accent insensitive search
  $.expr[':'].aicontains = function (obj, index, meta) {
    return icontains($(obj).data('normalizedText') || $(obj).text(), meta[3]);
  };

  /**
   * Actual implementation of the case insensitive search.
   * @access private
   * @param {String} haystack
   * @param {String} needle
   * @returns {boolean}
   */
  function icontains(haystack, needle) {
    return haystack.toUpperCase().indexOf(needle.toUpperCase()) > -1;
  }

  /**
   * Remove all diatrics from the given text.
   * @access private
   * @param {String} text
   * @returns {String}
   */
  function normalizeToBase(text) {
    var rExps = [
      {re: /[\xC0-\xC6]/g, ch: "A"},
      {re: /[\xE0-\xE6]/g, ch: "a"},
      {re: /[\xC8-\xCB]/g, ch: "E"},
      {re: /[\xE8-\xEB]/g, ch: "e"},
      {re: /[\xCC-\xCF]/g, ch: "I"},
      {re: /[\xEC-\xEF]/g, ch: "i"},
      {re: /[\xD2-\xD6]/g, ch: "O"},
      {re: /[\xF2-\xF6]/g, ch: "o"},
      {re: /[\xD9-\xDC]/g, ch: "U"},
      {re: /[\xF9-\xFC]/g, ch: "u"},
      {re: /[\xC7-\xE7]/g, ch: "c"},
      {re: /[\xD1]/g, ch: "N"},
      {re: /[\xF1]/g, ch: "n"}
    ];
    $.each(rExps, function () {
      text = text.replace(this.re, this.ch);
    });
    return text;
  }

  var Selectpicker = function (element, options, e) {
    if (e) {
      e.stopPropagation();
      e.preventDefault();
    }

    this.$element = $(element);
    this.$newElement = null;
    this.$button = null;
    this.$menu = null;
    this.$lis = null;
    this.options = options;

    // If we have no title yet, try to pull it from the html title attribute (jQuery doesnt' pick it up as it's not a
    // data-attribute)
    if (this.options.title === null) {
      this.options.title = this.$element.attr('title');
    }

    //Expose public methods
    this.val = Selectpicker.prototype.val;
    this.render = Selectpicker.prototype.render;
    this.refresh = Selectpicker.prototype.refresh;
    this.setStyle = Selectpicker.prototype.setStyle;
    this.selectAll = Selectpicker.prototype.selectAll;
    this.deselectAll = Selectpicker.prototype.deselectAll;
    this.destroy = Selectpicker.prototype.remove;
    this.remove = Selectpicker.prototype.remove;
    this.show = Selectpicker.prototype.show;
    this.hide = Selectpicker.prototype.hide;

    this.init();
  };

  Selectpicker.VERSION = '1.6.2';

  // part of this is duplicated in i18n/defaults-en_US.js. Make sure to update both.
  Selectpicker.DEFAULTS = {
    noneSelectedText: 'Nothing selected',
    noneResultsText: 'No results match',
    countSelectedText: function (numSelected, numTotal) {
      return (numSelected == 1) ? "{0} item selected" : "{0} items selected";
    },
    maxOptionsText: function (numAll, numGroup) {
      var arr = [];

      arr[0] = (numAll == 1) ? 'Limit reached ({n} item max)' : 'Limit reached ({n} items max)';
      arr[1] = (numGroup == 1) ? 'Group limit reached ({n} item max)' : 'Group limit reached ({n} items max)';

      return arr;
    },
    selectAllText: 'Select All',
    deselectAllText: 'Deselect All',
    multipleSeparator: ', ',
    style: 'btn-default',
    size: 'auto',
    title: null,
    selectedTextFormat: 'values',
    width: false,
    container: false,
    hideDisabled: false,
    showSubtext: false,
    showIcon: true,
    showContent: true,
    dropupAuto: true,
    header: false,
    liveSearch: false,
    actionsBox: false,
    iconBase: 'glyphicon',
    tickIcon: 'glyphicon-ok',
    maxOptions: false,
    mobile: false,
    selectOnTab: false,
    dropdownAlignRight: false,
    searchAccentInsensitive: false
  };

  Selectpicker.prototype = {

    constructor: Selectpicker,

    init: function () {
      var that = this,
          id = this.$element.attr('id');

      this.$element.hide();
      this.multiple = this.$element.prop('multiple');
      this.autofocus = this.$element.prop('autofocus');
      this.$newElement = this.createView();
      this.$element.after(this.$newElement);
      this.$menu = this.$newElement.find('> .dropdown-menu');
      this.$button = this.$newElement.find('> button');
      this.$searchbox = this.$newElement.find('input');

      if (this.options.dropdownAlignRight)
        this.$menu.addClass('dropdown-menu-right');

      if (typeof id !== 'undefined') {
        this.$button.attr('data-id', id);
        $('label[for="' + id + '"]').click(function (e) {
          e.preventDefault();
          that.$button.focus();
        });
      }

      this.checkDisabled();
      this.clickListener();
      if (this.options.liveSearch) this.liveSearchListener();
      this.render();
      this.liHeight();
      this.setStyle();
      this.setWidth();
      if (this.options.container) this.selectPosition();
      this.$menu.data('this', this);
      this.$newElement.data('this', this);
      if (this.options.mobile) this.mobile();
    },

    createDropdown: function () {
      // Options
      // If we are multiple, then add the show-tick class by default
      var multiple = this.multiple ? ' show-tick' : '',
          inputGroup = this.$element.parent().hasClass('input-group') ? ' input-group-btn' : '',
          autofocus = this.autofocus ? ' autofocus' : '',
          btnSize = this.$element.parents().hasClass('form-group-lg') ? ' btn-lg' : (this.$element.parents().hasClass('form-group-sm') ? ' btn-sm' : '');
      // Elements
      var header = this.options.header ? '<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>' + this.options.header + '</div>' : '';
      var searchbox = this.options.liveSearch ? '<div class="bs-searchbox"><input type="text" class="input-block-level form-control" autocomplete="off" /></div>' : '';
      var actionsbox = this.options.actionsBox ? '<div class="bs-actionsbox">' +
          '<div class="btn-group btn-block">' +
          '<button class="actions-btn bs-select-all btn btn-sm btn-default">' +
          this.options.selectAllText +
          '</button>' +
          '<button class="actions-btn bs-deselect-all btn btn-sm btn-default">' +
          this.options.deselectAllText +
          '</button>' +
          '</div>' +
          '</div>' : '';
      var drop =
          '<div class="btn-group bootstrap-select' + multiple + inputGroup + '">' +
              '<button type="button" class="btn dropdown-toggle selectpicker' + btnSize + '" data-toggle="dropdown"' + autofocus + '>' +
              '<span class="filter-option pull-left"></span>&nbsp;' +
              '<span class="caret"></span>' +
              '</button>' +
              '<div class="dropdown-menu open">' +
              header +
              searchbox +
              actionsbox +
              '<ul class="dropdown-menu inner selectpicker" role="menu">' +
              '</ul>' +
              '</div>' +
              '</div>';

      return $(drop);
    },

    createView: function () {
      var $drop = this.createDropdown();
      var $li = this.createLi();
      $drop.find('ul').append($li);
      return $drop;
    },

    reloadLi: function () {
      //Remove all children.
      this.destroyLi();
      //Re build
      var $li = this.createLi();
      this.$menu.find('ul').append($li);
    },

    destroyLi: function () {
      this.$menu.find('li').remove();
    },

    createLi: function () {
      var that = this,
          _li = [],
          optID = 0;

      // Helper functions
      /**
       * @param content
       * @param [index]
       * @param [classes]
       * @returns {string}
       */
      var generateLI = function (content, index, classes) {
        return '<li' +
            (typeof classes !== 'undefined' ? ' class="' + classes + '"' : '') +
            (typeof index !== 'undefined' | null === index ? ' data-original-index="' + index + '"' : '') +
            '>' + content + '</li>';
      };

      /**
       * @param text
       * @param [classes]
       * @param [inline]
       * @param [optgroup]
       * @returns {string}
       */
      var generateA = function (text, classes, inline, optgroup) {
        var normText = normalizeToBase($.trim($("<div/>").html(text).text()).replace(/\s\s+/g, ' '));
        return '<a tabindex="0"' +
            (typeof classes !== 'undefined' ? ' class="' + classes + '"' : '') +
            (typeof inline !== 'undefined' ? ' style="' + inline + '"' : '') +
            (typeof optgroup !== 'undefined' ? 'data-optgroup="' + optgroup + '"' : '') +
            ' data-normalized-text="' + normText + '"' +
            '>' + text +
            '<span class="' + that.options.iconBase + ' ' + that.options.tickIcon + ' icon-ok check-mark"></span>' +
            '</a>';
      };

      this.$element.find('option').each(function () {
        var $this = $(this);

        // Get the class and text for the option
        var optionClass = $this.attr('class') || '',
            inline = $this.attr('style'),
            text = $this.data('content') ? $this.data('content') : $this.html(),
            subtext = typeof $this.data('subtext') !== 'undefined' ? '<small class="muted text-muted">' + $this.data('subtext') + '</small>' : '',
            icon = typeof $this.data('icon') !== 'undefined' ? '<span class="' + that.options.iconBase + ' ' + $this.data('icon') + '"></span> ' : '',
            isDisabled = $this.is(':disabled') || $this.parent().is(':disabled'),
            index = $this[0].index;
        if (icon !== '' && isDisabled) {
          icon = '<span>' + icon + '</span>';
        }

        if (!$this.data('content')) {
          // Prepend any icon and append any subtext to the main text.
          text = icon + '<span class="text">' + text + subtext + '</span>';
        }

        if (that.options.hideDisabled && isDisabled) {
          return;
        }

        if ($this.parent().is('optgroup') && $this.data('divider') !== true) {
          if ($this.index() === 0) { // Is it the first option of the optgroup?
            optID += 1;

            // Get the opt group label
            var label = $this.parent().attr('label');
            var labelSubtext = typeof $this.parent().data('subtext') !== 'undefined' ? '<small class="muted text-muted">' + $this.parent().data('subtext') + '</small>' : '';
            var labelIcon = $this.parent().data('icon') ? '<span class="' + that.options.iconBase + ' ' + $this.parent().data('icon') + '"></span> ' : '';
            label = labelIcon + '<span class="text">' + label + labelSubtext + '</span>';

            if (index !== 0 && _li.length > 0) { // Is it NOT the first option of the select && are there elements in the dropdown?
              _li.push(generateLI('', null, 'divider'));
            }

            _li.push(generateLI(label, null, 'dropdown-header'));
          }

          _li.push(generateLI(generateA(text, 'opt ' + optionClass, inline, optID), index));
        } else if ($this.data('divider') === true) {
          _li.push(generateLI('', index, 'divider'));
        } else if ($this.data('hidden') === true) {
          _li.push(generateLI(generateA(text, optionClass, inline), index, 'hide is-hidden'));
        } else {
          _li.push(generateLI(generateA(text, optionClass, inline), index));
        }
      });

      //If we are not multiple, we don't have a selected item, and we don't have a title, select the first element so something is set in the button
      if (!this.multiple && this.$element.find('option:selected').length === 0 && !this.options.title) {
        this.$element.find('option').eq(0).prop('selected', true).attr('selected', 'selected');
      }

      return $(_li.join(''));
    },

    findLis: function () {
      if (this.$lis == null) this.$lis = this.$menu.find('li');
      return this.$lis;
    },

    /**
     * @param [updateLi] defaults to true
     */
    render: function (updateLi) {
      var that = this;

      //Update the LI to match the SELECT
      if (updateLi !== false) {
        this.$element.find('option').each(function (index) {
          that.setDisabled(index, $(this).is(':disabled') || $(this).parent().is(':disabled'));
          that.setSelected(index, $(this).is(':selected'));
        });
      }

      this.tabIndex();
      var notDisabled = this.options.hideDisabled ? ':not([disabled])' : '';
      var selectedItems = this.$element.find('option:selected' + notDisabled).map(function () {
        var $this = $(this);
        var icon = $this.data('icon') && that.options.showIcon ? '<i class="' + that.options.iconBase + ' ' + $this.data('icon') + '"></i> ' : '';
        var subtext;
        if (that.options.showSubtext && $this.attr('data-subtext') && !that.multiple) {
          subtext = ' <small class="muted text-muted">' + $this.data('subtext') + '</small>';
        } else {
          subtext = '';
        }
        if ($this.data('content') && that.options.showContent) {
          return $this.data('content');
        } else if (typeof $this.attr('title') !== 'undefined') {
          return $this.attr('title');
        } else {
          return icon + $this.html() + subtext;
        }
      }).toArray();

      //Fixes issue in IE10 occurring when no default option is selected and at least one option is disabled
      //Convert all the values into a comma delimited string
      var title = !this.multiple ? selectedItems[0] : selectedItems.join(this.options.multipleSeparator);

      //If this is multi select, and the selectText type is count, the show 1 of 2 selected etc..
      if (this.multiple && this.options.selectedTextFormat.indexOf('count') > -1) {
        var max = this.options.selectedTextFormat.split('>');
        if ((max.length > 1 && selectedItems.length > max[1]) || (max.length == 1 && selectedItems.length >= 2)) {
          notDisabled = this.options.hideDisabled ? ', [disabled]' : '';
          var totalCount = this.$element.find('option').not('[data-divider="true"], [data-hidden="true"]' + notDisabled).length,
              tr8nText = (typeof this.options.countSelectedText === 'function') ? this.options.countSelectedText(selectedItems.length, totalCount) : this.options.countSelectedText;
          title = tr8nText.replace('{0}', selectedItems.length.toString()).replace('{1}', totalCount.toString());
        }
      }

      this.options.title = this.$element.attr('title');

      if (this.options.selectedTextFormat == 'static') {
        title = this.options.title;
      }

      //If we dont have a title, then use the default, or if nothing is set at all, use the not selected text
      if (!title) {
        title = typeof this.options.title !== 'undefined' ? this.options.title : this.options.noneSelectedText;
      }

      this.$button.attr('title', $.trim($("<div/>").html(title).text()).replace(/\s\s+/g, ' '));
      this.$newElement.find('.filter-option').html(title);
    },

    /**
     * @param [style]
     * @param [status]
     */
    setStyle: function (style, status) {
      if (this.$element.attr('class')) {
        this.$newElement.addClass(this.$element.attr('class').replace(/selectpicker|mobile-device|validate\[.*\]/gi, ''));
      }

      var buttonClass = style ? style : this.options.style;

      if (status == 'add') {
        this.$button.addClass(buttonClass);
      } else if (status == 'remove') {
        this.$button.removeClass(buttonClass);
      } else {
        this.$button.removeClass(this.options.style);
        this.$button.addClass(buttonClass);
      }
    },

    liHeight: function () {
      if (this.options.size === false) return;

      var $selectClone = this.$menu.parent().clone().find('> .dropdown-toggle').prop('autofocus', false).end().appendTo('body'),
          $menuClone = $selectClone.addClass('open').find('> .dropdown-menu'),
          liHeight = $menuClone.find('li').not('.divider').not('.dropdown-header').filter(':visible').children('a').outerHeight(),
          headerHeight = this.options.header ? $menuClone.find('.popover-title').outerHeight() : 0,
          searchHeight = this.options.liveSearch ? $menuClone.find('.bs-searchbox').outerHeight() : 0,
          actionsHeight = this.options.actionsBox ? $menuClone.find('.bs-actionsbox').outerHeight() : 0;

      $selectClone.remove();

      this.$newElement
          .data('liHeight', liHeight)
          .data('headerHeight', headerHeight)
          .data('searchHeight', searchHeight)
          .data('actionsHeight', actionsHeight);
    },

    setSize: function () {
      this.findLis();
      var that = this,
          menu = this.$menu,
          menuInner = menu.find('.inner'),
          selectHeight = this.$newElement.outerHeight(),
          liHeight = this.$newElement.data('liHeight'),
          headerHeight = this.$newElement.data('headerHeight'),
          searchHeight = this.$newElement.data('searchHeight'),
          actionsHeight = this.$newElement.data('actionsHeight'),
          divHeight = this.$lis.filter('.divider').outerHeight(true),
          menuPadding = parseInt(menu.css('padding-top')) +
              parseInt(menu.css('padding-bottom')) +
              parseInt(menu.css('border-top-width')) +
              parseInt(menu.css('border-bottom-width')),
          notDisabled = this.options.hideDisabled ? ', .disabled' : '',
          $window = $(window),
          menuExtras = menuPadding + parseInt(menu.css('margin-top')) + parseInt(menu.css('margin-bottom')) + 2,
          menuHeight,
          selectOffsetTop,
          selectOffsetBot,
          posVert = function () {
            // JQuery defines a scrollTop function, but in pure JS it's a property
            //noinspection JSValidateTypes
            selectOffsetTop = that.$newElement.offset().top - $window.scrollTop();
            selectOffsetBot = $window.height() - selectOffsetTop - selectHeight;
          };
      posVert();
      if (this.options.header) menu.css('padding-top', 0);

      if (this.options.size == 'auto') {
        var getSize = function () {
          var minHeight,
              lisVis = that.$lis.not('.hide');

          posVert();
          menuHeight = selectOffsetBot - menuExtras;

          if (that.options.dropupAuto) {
            that.$newElement.toggleClass('dropup', (selectOffsetTop > selectOffsetBot) && ((menuHeight - menuExtras) < menu.height()));
          }
          if (that.$newElement.hasClass('dropup')) {
            menuHeight = selectOffsetTop - menuExtras;
          }

          if ((lisVis.length + lisVis.filter('.dropdown-header').length) > 3) {
            minHeight = liHeight * 3 + menuExtras - 2;
          } else {
            minHeight = 0;
          }

          menu.css({'max-height': menuHeight + 'px', 'overflow': 'hidden', 'min-height': minHeight + headerHeight + searchHeight + actionsHeight + 'px'});
          menuInner.css({'max-height': menuHeight - headerHeight - searchHeight - actionsHeight - menuPadding + 'px', 'overflow-y': 'auto', 'min-height': Math.max(minHeight - menuPadding, 0) + 'px'});
        };
        getSize();
        this.$searchbox.off('input.getSize propertychange.getSize').on('input.getSize propertychange.getSize', getSize);
        $(window).off('resize.getSize').on('resize.getSize', getSize);
        $(window).off('scroll.getSize').on('scroll.getSize', getSize);
      } else if (this.options.size && this.options.size != 'auto' && menu.find('li' + notDisabled).length > this.options.size) {
        var optIndex = this.$lis.not('.divider' + notDisabled).find(' > *').slice(0, this.options.size).last().parent().index();
        var divLength = this.$lis.slice(0, optIndex + 1).filter('.divider').length;
        menuHeight = liHeight * this.options.size + divLength * divHeight + menuPadding;
        if (that.options.dropupAuto) {
          //noinspection JSUnusedAssignment
          this.$newElement.toggleClass('dropup', (selectOffsetTop > selectOffsetBot) && (menuHeight < menu.height()));
        }
        menu.css({'max-height': menuHeight + headerHeight + searchHeight + actionsHeight + 'px', 'overflow': 'hidden'});
        menuInner.css({'max-height': menuHeight - menuPadding + 'px', 'overflow-y': 'auto'});
      }
    },

    setWidth: function () {
      if (this.options.width == 'auto') {
        this.$menu.css('min-width', '0');

        // Get correct width if element hidden
        var selectClone = this.$newElement.clone().appendTo('body');
        var ulWidth = selectClone.find('> .dropdown-menu').css('width');
        var btnWidth = selectClone.css('width', 'auto').find('> button').css('width');
        selectClone.remove();

        // Set width to whatever's larger, button title or longest option
        this.$newElement.css('width', Math.max(parseInt(ulWidth), parseInt(btnWidth)) + 'px');
      } else if (this.options.width == 'fit') {
        // Remove inline min-width so width can be changed from 'auto'
        this.$menu.css('min-width', '');
        this.$newElement.css('width', '').addClass('fit-width');
      } else if (this.options.width) {
        // Remove inline min-width so width can be changed from 'auto'
        this.$menu.css('min-width', '');
        this.$newElement.css('width', this.options.width);
      } else {
        // Remove inline min-width/width so width can be changed
        this.$menu.css('min-width', '');
        this.$newElement.css('width', '');
      }
      // Remove fit-width class if width is changed programmatically
      if (this.$newElement.hasClass('fit-width') && this.options.width !== 'fit') {
        this.$newElement.removeClass('fit-width');
      }
    },

    selectPosition: function () {
      var that = this,
          drop = '<div />',
          $drop = $(drop),
          pos,
          actualHeight,
          getPlacement = function ($element) {
            $drop.addClass($element.attr('class').replace(/form-control/gi, '')).toggleClass('dropup', $element.hasClass('dropup'));
            pos = $element.offset();
            actualHeight = $element.hasClass('dropup') ? 0 : $element[0].offsetHeight;
            $drop.css({'top': pos.top + actualHeight, 'left': pos.left, 'width': $element[0].offsetWidth, 'position': 'absolute'});
          };
      this.$newElement.on('click', function () {
        if (that.isDisabled()) {
          return;
        }
        getPlacement($(this));
        $drop.appendTo(that.options.container);
        $drop.toggleClass('open', !$(this).hasClass('open'));
        $drop.append(that.$menu);
      });
      $(window).resize(function () {
        getPlacement(that.$newElement);
      });
      $(window).on('scroll', function () {
        getPlacement(that.$newElement);
      });
      $('html').on('click', function (e) {
        if ($(e.target).closest(that.$newElement).length < 1) {
          $drop.removeClass('open');
        }
      });
    },

    setSelected: function (index, selected) {
      this.findLis();
      this.$lis.filter('[data-original-index="' + index + '"]').toggleClass('selected', selected);
    },

    setDisabled: function (index, disabled) {
      this.findLis();
      if (disabled) {
        this.$lis.filter('[data-original-index="' + index + '"]').addClass('disabled').find('a').attr('href', '#').attr('tabindex', -1);
      } else {
        this.$lis.filter('[data-original-index="' + index + '"]').removeClass('disabled').find('a').removeAttr('href').attr('tabindex', 0);
      }
    },

    isDisabled: function () {
      return this.$element.is(':disabled');
    },

    checkDisabled: function () {
      var that = this;

      if (this.isDisabled()) {
        this.$button.addClass('disabled').attr('tabindex', -1);
      } else {
        if (this.$button.hasClass('disabled')) {
          this.$button.removeClass('disabled');
        }

        if (this.$button.attr('tabindex') == -1) {
          if (!this.$element.data('tabindex')) this.$button.removeAttr('tabindex');
        }
      }

      this.$button.click(function () {
        return !that.isDisabled();
      });
    },

    tabIndex: function () {
      if (this.$element.is('[tabindex]')) {
        this.$element.data('tabindex', this.$element.attr('tabindex'));
        this.$button.attr('tabindex', this.$element.data('tabindex'));
      }
    },

    clickListener: function () {
      var that = this;

      this.$newElement.on('touchstart.dropdown', '.dropdown-menu', function (e) {
        e.stopPropagation();
      });

      this.$newElement.on('click', function () {
        that.setSize();
        if (!that.options.liveSearch && !that.multiple) {
          setTimeout(function () {
            that.$menu.find('.selected a').focus();
          }, 10);
        }
      });

      this.$menu.on('click', 'li a', function (e) {
        var $this = $(this),
            clickedIndex = $this.parent().data('originalIndex'),
            prevValue = that.$element.val(),
            prevIndex = that.$element.prop('selectedIndex');

        // Don't close on multi choice menu
        if (that.multiple) {
          e.stopPropagation();
        }

        e.preventDefault();

        //Don't run if we have been disabled
        if (!that.isDisabled() && !$this.parent().hasClass('disabled')) {
          var $options = that.$element.find('option'),
              $option = $options.eq(clickedIndex),
              state = $option.prop('selected'),
              $optgroup = $option.parent('optgroup'),
              maxOptions = that.options.maxOptions,
              maxOptionsGrp = $optgroup.data('maxOptions') || false;

          if (!that.multiple) { // Deselect all others if not multi select box
            $options.prop('selected', false);
            $option.prop('selected', true);
            that.$menu.find('.selected').removeClass('selected');
            that.setSelected(clickedIndex, true);
          } else { // Toggle the one we have chosen if we are multi select.
            $option.prop('selected', !state);
            that.setSelected(clickedIndex, !state);
            $this.blur();

            if ((maxOptions !== false) || (maxOptionsGrp !== false)) {
              var maxReached = maxOptions < $options.filter(':selected').length,
                  maxReachedGrp = maxOptionsGrp < $optgroup.find('option:selected').length;

              if ((maxOptions && maxReached) || (maxOptionsGrp && maxReachedGrp)) {
                if (maxOptions && maxOptions == 1) {
                  $options.prop('selected', false);
                  $option.prop('selected', true);
                  that.$menu.find('.selected').removeClass('selected');
                  that.setSelected(clickedIndex, true);
                } else if (maxOptionsGrp && maxOptionsGrp == 1) {
                  $optgroup.find('option:selected').prop('selected', false);
                  $option.prop('selected', true);
                  var optgroupID = $this.data('optgroup');

                  that.$menu.find('.selected').has('a[data-optgroup="' + optgroupID + '"]').removeClass('selected');

                  that.setSelected(clickedIndex, true);
                } else {
                  var maxOptionsArr = (typeof that.options.maxOptionsText === 'function') ?
                          that.options.maxOptionsText(maxOptions, maxOptionsGrp) : that.options.maxOptionsText,
                      maxTxt = maxOptionsArr[0].replace('{n}', maxOptions),
                      maxTxtGrp = maxOptionsArr[1].replace('{n}', maxOptionsGrp),
                      $notify = $('<div class="notify"></div>');
                  // If {var} is set in array, replace it
                  /** @deprecated */
                  if (maxOptionsArr[2]) {
                    maxTxt = maxTxt.replace('{var}', maxOptionsArr[2][maxOptions > 1 ? 0 : 1]);
                    maxTxtGrp = maxTxtGrp.replace('{var}', maxOptionsArr[2][maxOptionsGrp > 1 ? 0 : 1]);
                  }

                  $option.prop('selected', false);

                  that.$menu.append($notify);

                  if (maxOptions && maxReached) {
                    $notify.append($('<div>' + maxTxt + '</div>'));
                    that.$element.trigger('maxReached.bs.select');
                  }

                  if (maxOptionsGrp && maxReachedGrp) {
                    $notify.append($('<div>' + maxTxtGrp + '</div>'));
                    that.$element.trigger('maxReachedGrp.bs.select');
                  }

                  setTimeout(function () {
                    that.setSelected(clickedIndex, false);
                  }, 10);

                  $notify.delay(750).fadeOut(300, function () {
                    $(this).remove();
                  });
                }
              }
            }
          }

          if (!that.multiple) {
            that.$button.focus();
          } else if (that.options.liveSearch) {
            that.$searchbox.focus();
          }

          // Trigger select 'change'
          if ((prevValue != that.$element.val() && that.multiple) || (prevIndex != that.$element.prop('selectedIndex') && !that.multiple)) {
            that.$element.change();
          }
        }
      });

      this.$menu.on('click', 'li.disabled a, .popover-title, .popover-title :not(.close)', function (e) {
        if (e.target == this) {
          e.preventDefault();
          e.stopPropagation();
          if (!that.options.liveSearch) {
            that.$button.focus();
          } else {
            that.$searchbox.focus();
          }
        }
      });

      this.$menu.on('click', 'li.divider, li.dropdown-header', function (e) {
        e.preventDefault();
        e.stopPropagation();
        if (!that.options.liveSearch) {
          that.$button.focus();
        } else {
          that.$searchbox.focus();
        }
      });

      this.$menu.on('click', '.popover-title .close', function () {
        that.$button.focus();
      });

      this.$searchbox.on('click', function (e) {
        e.stopPropagation();
      });


      this.$menu.on('click', '.actions-btn', function (e) {
        if (that.options.liveSearch) {
          that.$searchbox.focus();
        } else {
          that.$button.focus();
        }

        e.preventDefault();
        e.stopPropagation();

        if ($(this).is('.bs-select-all')) {
          that.selectAll();
        } else {
          that.deselectAll();
        }
        that.$element.change();
      });

      this.$element.change(function () {
        that.render(false);
      });
    },

    liveSearchListener: function () {
      var that = this,
          no_results = $('<li class="no-results"></li>');

      this.$newElement.on('click.dropdown.data-api', function () {
        that.$menu.find('.active').removeClass('active');
        if (!!that.$searchbox.val()) {
          that.$searchbox.val('');
          that.$lis.not('.is-hidden').removeClass('hide');
          if (!!no_results.parent().length) no_results.remove();
        }
        if (!that.multiple) that.$menu.find('.selected').addClass('active');
        setTimeout(function () {
          that.$searchbox.focus();
        }, 10);
      });

      this.$searchbox.on('input propertychange', function () {
        if (that.$searchbox.val()) {

          if (that.options.searchAccentInsensitive) {
            that.$lis.not('.is-hidden').removeClass('hide').find('a').not(':aicontains(' + normalizeToBase(that.$searchbox.val()) + ')').parent().addClass('hide');
          } else {
            that.$lis.not('.is-hidden').removeClass('hide').find('a').not(':icontains(' + that.$searchbox.val() + ')').parent().addClass('hide');
          }

          if (!that.$menu.find('li').filter(':visible:not(.no-results)').length) {
            if (!!no_results.parent().length) no_results.remove();
            no_results.html(that.options.noneResultsText + ' "' + that.$searchbox.val() + '"').show();
            that.$menu.find('li').last().after(no_results);
          } else if (!!no_results.parent().length) {
            no_results.remove();
          }

        } else {
          that.$lis.not('.is-hidden').removeClass('hide');
          if (!!no_results.parent().length) no_results.remove();
        }

        that.$menu.find('li.active').removeClass('active');
        that.$menu.find('li').filter(':visible:not(.divider)').eq(0).addClass('active').find('a').focus();
        $(this).focus();
      });

      this.$menu.on('mouseenter', 'a', function (e) {
        that.$menu.find('.active').removeClass('active');
        $(e.currentTarget).parent().not('.disabled').addClass('active');
      });

      this.$menu.on('mouseleave', 'a', function () {
        that.$menu.find('.active').removeClass('active');
      });
    },

    val: function (value) {
      if (typeof value !== 'undefined') {
        this.$element.val(value);
        this.render();

        return this.$element;
      } else {
        return this.$element.val();
      }
    },

    selectAll: function () {
      this.findLis();
      this.$lis.not('.divider').not('.disabled').not('.selected').filter(':visible').find('a').click();
    },

    deselectAll: function () {
      this.findLis();
      this.$lis.not('.divider').not('.disabled').filter('.selected').filter(':visible').find('a').click();
    },

    keydown: function (e) {
      var $this,
          $items,
          $parent,
          index,
          next,
          first,
          last,
          prev,
          nextPrev,
          that,
          prevIndex,
          isActive,
          keyCodeMap = {
            32: ' ', 48: '0', 49: '1', 50: '2', 51: '3', 52: '4', 53: '5', 54: '6', 55: '7', 56: '8', 57: '9', 59: ';',
            65: 'a', 66: 'b', 67: 'c', 68: 'd', 69: 'e', 70: 'f', 71: 'g', 72: 'h', 73: 'i', 74: 'j', 75: 'k', 76: 'l',
            77: 'm', 78: 'n', 79: 'o', 80: 'p', 81: 'q', 82: 'r', 83: 's', 84: 't', 85: 'u', 86: 'v', 87: 'w', 88: 'x',
            89: 'y', 90: 'z', 96: '0', 97: '1', 98: '2', 99: '3', 100: '4', 101: '5', 102: '6', 103: '7', 104: '8', 105: '9'
          };

      $this = $(this);

      $parent = $this.parent();

      if ($this.is('input')) $parent = $this.parent().parent();

      that = $parent.data('this');

      if (that.options.liveSearch) $parent = $this.parent().parent();

      if (that.options.container) $parent = that.$menu;

      $items = $('[role=menu] li a', $parent);

      isActive = that.$menu.parent().hasClass('open');

      if (!isActive && /([0-9]|[A-z])/.test(String.fromCharCode(e.keyCode))) {
        if (!that.options.container) {
          that.setSize();
          that.$menu.parent().addClass('open');
          isActive = true;
        } else {
          that.$newElement.trigger('click');
        }
        that.$searchbox.focus();
      }

      if (that.options.liveSearch) {
        if (/(^9$|27)/.test(e.keyCode.toString(10)) && isActive && that.$menu.find('.active').length === 0) {
          e.preventDefault();
          that.$menu.parent().removeClass('open');
          that.$button.focus();
        }
        $items = $('[role=menu] li:not(.divider):not(.dropdown-header):visible', $parent);
        if (!$this.val() && !/(38|40)/.test(e.keyCode.toString(10))) {
          if ($items.filter('.active').length === 0) {
            if (that.options.searchAccentInsensitive) {
              $items = that.$newElement.find('li').filter(':aicontains(' + normalizeToBase(keyCodeMap[e.keyCode]) + ')');
            } else {
              $items = that.$newElement.find('li').filter(':icontains(' + keyCodeMap[e.keyCode] + ')');
            }
          }
        }
      }

      if (!$items.length) return;

      if (/(38|40)/.test(e.keyCode.toString(10))) {
        index = $items.index($items.filter(':focus'));
        first = $items.parent(':not(.disabled):visible').first().index();
        last = $items.parent(':not(.disabled):visible').last().index();
        next = $items.eq(index).parent().nextAll(':not(.disabled):visible').eq(0).index();
        prev = $items.eq(index).parent().prevAll(':not(.disabled):visible').eq(0).index();
        nextPrev = $items.eq(next).parent().prevAll(':not(.disabled):visible').eq(0).index();

        if (that.options.liveSearch) {
          $items.each(function (i) {
            if ($(this).is(':not(.disabled)')) {
              $(this).data('index', i);
            }
          });
          index = $items.index($items.filter('.active'));
          first = $items.filter(':not(.disabled):visible').first().data('index');
          last = $items.filter(':not(.disabled):visible').last().data('index');
          next = $items.eq(index).nextAll(':not(.disabled):visible').eq(0).data('index');
          prev = $items.eq(index).prevAll(':not(.disabled):visible').eq(0).data('index');
          nextPrev = $items.eq(next).prevAll(':not(.disabled):visible').eq(0).data('index');
        }

        prevIndex = $this.data('prevIndex');

        if (e.keyCode == 38) {
          if (that.options.liveSearch) index -= 1;
          if (index != nextPrev && index > prev) index = prev;
          if (index < first) index = first;
          if (index == prevIndex) index = last;
        }

        if (e.keyCode == 40) {
          if (that.options.liveSearch) index += 1;
          if (index == -1) index = 0;
          if (index != nextPrev && index < next) index = next;
          if (index > last) index = last;
          if (index == prevIndex) index = first;
        }

        $this.data('prevIndex', index);

        if (!that.options.liveSearch) {
          $items.eq(index).focus();
        } else {
          e.preventDefault();
          if (!$this.is('.dropdown-toggle')) {
            $items.removeClass('active');
            $items.eq(index).addClass('active').find('a').focus();
            $this.focus();
          }
        }

      } else if (!$this.is('input')) {
        var keyIndex = [],
            count,
            prevKey;

        $items.each(function () {
          if ($(this).parent().is(':not(.disabled)')) {
            if ($.trim($(this).text().toLowerCase()).substring(0, 1) == keyCodeMap[e.keyCode]) {
              keyIndex.push($(this).parent().index());
            }
          }
        });

        count = $(document).data('keycount');
        count++;
        $(document).data('keycount', count);

        prevKey = $.trim($(':focus').text().toLowerCase()).substring(0, 1);

        if (prevKey != keyCodeMap[e.keyCode]) {
          count = 1;
          $(document).data('keycount', count);
        } else if (count >= keyIndex.length) {
          $(document).data('keycount', 0);
          if (count > keyIndex.length) count = 1;
        }

        $items.eq(keyIndex[count - 1]).focus();
      }

      // Select focused option if "Enter", "Spacebar" or "Tab" (when selectOnTab is true) are pressed inside the menu.
      if ((/(13|32)/.test(e.keyCode.toString(10)) || (/(^9$)/.test(e.keyCode.toString(10)) && that.options.selectOnTab)) && isActive) {
        if (!/(32)/.test(e.keyCode.toString(10))) e.preventDefault();
        if (!that.options.liveSearch) {
          $(':focus').click();
        } else if (!/(32)/.test(e.keyCode.toString(10))) {
          that.$menu.find('.active a').click();
          $this.focus();
        }
        $(document).data('keycount', 0);
      }

      if ((/(^9$|27)/.test(e.keyCode.toString(10)) && isActive && (that.multiple || that.options.liveSearch)) || (/(27)/.test(e.keyCode.toString(10)) && !isActive)) {
        that.$menu.parent().removeClass('open');
        that.$button.focus();
      }
    },

    mobile: function () {
      this.$element.addClass('mobile-device').appendTo(this.$newElement);
      if (this.options.container) this.$menu.hide();
    },

    refresh: function () {
      this.$lis = null;
      this.reloadLi();
      this.render();
      this.setWidth();
      this.setStyle();
      this.checkDisabled();
      this.liHeight();
    },

    update: function () {
      this.reloadLi();
      this.setWidth();
      this.setStyle();
      this.checkDisabled();
      this.liHeight();
    },

    hide: function () {
      this.$newElement.hide();
    },

    show: function () {
      this.$newElement.show();
    },

    remove: function () {
      this.$newElement.remove();
      this.$element.remove();
    }
  };

  // SELECTPICKER PLUGIN DEFINITION
  // ==============================
  function Plugin(option, event) {
    // get the args of the outer function..
    var args = arguments;
    // The arguments of the function are explicitly re-defined from the argument list, because the shift causes them
    // to get lost
    //noinspection JSDuplicatedDeclaration
    var option = args[0],
        event = args[1];
    [].shift.apply(args);
    var value;
    var chain = this.each(function () {
      var $this = $(this);
      if ($this.is('select')) {
        var data = $this.data('selectpicker'),
            options = typeof option == 'object' && option;

        if (!data) {
          var config = $.extend({}, Selectpicker.DEFAULTS, $.fn.selectpicker.defaults, $this.data(), options);
          $this.data('selectpicker', (data = new Selectpicker(this, config, event)));
        } else if (options) {
          for (var i in options) {
            if (options.hasOwnProperty(i)) {
              data.options[i] = options[i];
            }
          }
        }

        if (typeof option == 'string') {
          if (data[option] instanceof Function) {
            value = data[option].apply(data, args);
          } else {
            value = data.options[option];
          }
        }
      }
    });

    if (typeof value !== 'undefined') {
      //noinspection JSUnusedAssignment
      return value;
    } else {
      return chain;
    }
  }

  var old = $.fn.selectpicker;
  $.fn.selectpicker = Plugin;
  $.fn.selectpicker.Constructor = Selectpicker;

  // SELECTPICKER NO CONFLICT
  // ========================
  $.fn.selectpicker.noConflict = function () {
    $.fn.selectpicker = old;
    return this;
  };

  $(document)
      .data('keycount', 0)
      .on('keydown', '.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bs-searchbox input', Selectpicker.prototype.keydown)
      .on('focusin.modal', '.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bs-searchbox input', function (e) {
        e.stopPropagation();
      });

  // SELECTPICKER DATA-API
  // =====================
  $(window).on('load.bs.select.data-api', function () {
    $('.selectpicker').each(function () {
      var $selectpicker = $(this);
      Plugin.call($selectpicker, $selectpicker.data());
    })
  });
})(jQuery);
/*!
 * Bootstrap v3.1.1 (http://getbootstrap.com)
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(jQuery),+function(a){"use strict";var b='[data-dismiss="alert"]',c=function(c){a(c).on("click",b,this.close)};c.prototype.close=function(b){function c(){f.trigger("closed.bs.alert").remove()}var d=a(this),e=d.attr("data-target");e||(e=d.attr("href"),e=e&&e.replace(/.*(?=#[^\s]*$)/,""));var f=a(e);b&&b.preventDefault(),f.length||(f=d.hasClass("alert")?d:d.parent()),f.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one(a.support.transition.end,c).emulateTransitionEnd(150):c())};var d=a.fn.alert;a.fn.alert=function(b){return this.each(function(){var d=a(this),e=d.data("bs.alert");e||d.data("bs.alert",e=new c(this)),"string"==typeof b&&e[b].call(d)})},a.fn.alert.Constructor=c,a.fn.alert.noConflict=function(){return a.fn.alert=d,this},a(document).on("click.bs.alert.data-api",b,c.prototype.close)}(jQuery),+function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.isLoading=!1};b.DEFAULTS={loadingText:"loading..."},b.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",f.resetText||d.data("resetText",d[e]()),d[e](f[b]||this.options[b]),setTimeout(a.proxy(function(){"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c))},this),0)},b.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")&&(c.prop("checked")&&this.$element.hasClass("active")?a=!1:b.find(".active").removeClass("active")),a&&c.prop("checked",!this.$element.hasClass("active")).trigger("change")}a&&this.$element.toggleClass("active")};var c=a.fn.button;a.fn.button=function(c){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof c&&c;e||d.data("bs.button",e=new b(this,f)),"toggle"==c?e.toggle():c&&e.setState(c)})},a.fn.button.Constructor=b,a.fn.button.noConflict=function(){return a.fn.button=c,this},a(document).on("click.bs.button.data-api","[data-toggle^=button]",function(b){var c=a(b.target);c.hasClass("btn")||(c=c.closest(".btn")),c.button("toggle"),b.preventDefault()})}(jQuery),+function(a){"use strict";var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},b.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},b.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},b.prototype.to=function(b){var c=this,d=this.getActiveIndex();return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},b.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},b.prototype.next=function(){return this.sliding?void 0:this.slide("next")},b.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},b.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}if(e.hasClass("active"))return this.sliding=!1;var j=a.Event("slide.bs.carousel",{relatedTarget:e[0],direction:g});return this.$element.trigger(j),j.isDefaultPrevented()?void 0:(this.sliding=!0,f&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")?(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*d.css("transition-duration").slice(0,-1))):(d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),f&&this.cycle(),this)};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c),g="string"==typeof c?c:f.slide;e||d.data("bs.carousel",e=new b(this,f)),"number"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d=a(this),e=a(d.attr("data-target")||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),d.data()),g=d.attr("data-slide-to");g&&(f.interval=!1),e.carousel(f),(g=d.attr("data-slide-to"))&&e.data("bs.carousel").to(g),b.preventDefault()}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var b=a(this);b.carousel(b.data())})})}(jQuery),+function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.DEFAULTS={toggle:!0},b.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},b.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b=a.Event("show.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.$parent&&this.$parent.find("> .panel > .in");if(c&&c.length){var d=c.data("bs.collapse");if(d&&d.transitioning)return;c.collapse("hide"),d||c.data("bs.collapse",null)}var e=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[e](0),this.transitioning=1;var f=function(){this.$element.removeClass("collapsing").addClass("collapse in")[e]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return f.call(this);var g=a.camelCase(["scroll",e].join("-"));this.$element.one(a.support.transition.end,a.proxy(f,this)).emulateTransitionEnd(350)[e](this.$element[0][g])}}},b.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?void this.$element[c](0).one(a.support.transition.end,a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},b.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var c=a.fn.collapse;a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c);!e&&f.toggle&&"show"==c&&(c=!c),e||d.data("bs.collapse",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.collapse.Constructor=b,a.fn.collapse.noConflict=function(){return a.fn.collapse=c,this},a(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e),g=f.data("bs.collapse"),h=g?"toggle":d.data(),i=d.attr("data-parent"),j=i&&a(i);g&&g.transitioning||(j&&j.find('[data-toggle=collapse][data-parent="'+i+'"]').not(d).addClass("collapsed"),d[f.hasClass("in")?"addClass":"removeClass"]("collapsed")),f.collapse(h)})}(jQuery),+function(a){"use strict";function b(b){a(d).remove(),a(e).each(function(){var d=c(a(this)),e={relatedTarget:this};d.hasClass("open")&&(d.trigger(b=a.Event("hide.bs.dropdown",e)),b.isDefaultPrevented()||d.removeClass("open").trigger("hidden.bs.dropdown",e))})}function c(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}var d=".dropdown-backdrop",e="[data-toggle=dropdown]",f=function(b){a(b).on("click.bs.dropdown",this.toggle)};f.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=c(e),g=f.hasClass("open");if(b(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a('<div class="dropdown-backdrop"/>').insertAfter(a(this)).on("click",b);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;f.toggleClass("open").trigger("shown.bs.dropdown",h),e.focus()}return!1}},f.prototype.keydown=function(b){if(/(38|40|27)/.test(b.keyCode)){var d=a(this);if(b.preventDefault(),b.stopPropagation(),!d.is(".disabled, :disabled")){var f=c(d),g=f.hasClass("open");if(!g||g&&27==b.keyCode)return 27==b.which&&f.find(e).focus(),d.click();var h=" li:not(.divider):visible a",i=f.find("[role=menu]"+h+", [role=listbox]"+h);if(i.length){var j=i.index(i.filter(":focus"));38==b.keyCode&&j>0&&j--,40==b.keyCode&&j<i.length-1&&j++,~j||(j=0),i.eq(j).focus()}}}};var g=a.fn.dropdown;a.fn.dropdown=function(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new f(this)),"string"==typeof b&&d[b].call(c)})},a.fn.dropdown.Constructor=f,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=g,this},a(document).on("click.bs.dropdown.data-api",b).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",e,f.prototype.toggle).on("keydown.bs.dropdown.data-api",e+", [role=menu], [role=listbox]",f.prototype.keydown)}(jQuery),+function(a){"use strict";var b=function(b,c){this.options=c,this.$element=a(b),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};b.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},b.prototype.toggle=function(a){return this[this.isShown?"hide":"show"](a)},b.prototype.show=function(b){var c=this,d=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(d),this.isShown||d.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.backdrop(function(){var d=a.support.transition&&c.$element.hasClass("fade");c.$element.parent().length||c.$element.appendTo(document.body),c.$element.show().scrollTop(0),d&&c.$element[0].offsetWidth,c.$element.addClass("in").attr("aria-hidden",!1),c.enforceFocus();var e=a.Event("shown.bs.modal",{relatedTarget:b});d?c.$element.find(".modal-dialog").one(a.support.transition.end,function(){c.$element.focus().trigger(e)}).emulateTransitionEnd(300):c.$element.focus().trigger(e)}))},b.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one(a.support.transition.end,a.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal())},b.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.focus()},this))},b.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},b.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.removeBackdrop(),a.$element.trigger("hidden.bs.modal")})},b.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},b.prototype.backdrop=function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;if(this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),d&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;d?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,b).emulateTransitionEnd(150):b()):b&&b()};var c=a.fn.modal;a.fn.modal=function(c,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},b.DEFAULTS,e.data(),"object"==typeof c&&c);f||e.data("bs.modal",f=new b(this,g)),"string"==typeof c?f[c](d):g.show&&f.show(d)})},a.fn.modal.Constructor=b,a.fn.modal.noConflict=function(){return a.fn.modal=c,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=c.attr("href"),e=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),f=e.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());c.is("a")&&b.preventDefault(),e.modal(f,this).one("hide",function(){c.is(":visible")&&c.focus()})}),a(document).on("show.bs.modal",".modal",function(){a(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){a(document.body).removeClass("modal-open")})}(jQuery),+function(a){"use strict";var b=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};b.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},b.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},b.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},b.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},b.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},b.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){if(this.$element.trigger(b),b.isDefaultPrevented())return;var c=this,d=this.tip();this.setContent(),this.options.animation&&d.addClass("fade");var e="function"==typeof this.options.placement?this.options.placement.call(this,d[0],this.$element[0]):this.options.placement,f=/\s?auto?\s?/i,g=f.test(e);g&&(e=e.replace(f,"")||"top"),d.detach().css({top:0,left:0,display:"block"}).addClass(e),this.options.container?d.appendTo(this.options.container):d.insertAfter(this.$element);var h=this.getPosition(),i=d[0].offsetWidth,j=d[0].offsetHeight;if(g){var k=this.$element.parent(),l=e,m=document.documentElement.scrollTop||document.body.scrollTop,n="body"==this.options.container?window.innerWidth:k.outerWidth(),o="body"==this.options.container?window.innerHeight:k.outerHeight(),p="body"==this.options.container?0:k.offset().left;e="bottom"==e&&h.top+h.height+j-m>o?"top":"top"==e&&h.top-m-j<0?"bottom":"right"==e&&h.right+i>n?"left":"left"==e&&h.left-i<p?"right":e,d.removeClass(l).addClass(e)}var q=this.getCalculatedOffset(e,h,i,j);this.applyPlacement(q,e),this.hoverState=null;var r=function(){c.$element.trigger("shown.bs."+c.type)};a.support.transition&&this.$tip.hasClass("fade")?d.one(a.support.transition.end,r).emulateTransitionEnd(150):r()}},b.prototype.applyPlacement=function(b,c){var d,e=this.tip(),f=e[0].offsetWidth,g=e[0].offsetHeight,h=parseInt(e.css("margin-top"),10),i=parseInt(e.css("margin-left"),10);isNaN(h)&&(h=0),isNaN(i)&&(i=0),b.top=b.top+h,b.left=b.left+i,a.offset.setOffset(e[0],a.extend({using:function(a){e.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),e.addClass("in");var j=e[0].offsetWidth,k=e[0].offsetHeight;if("top"==c&&k!=g&&(d=!0,b.top=b.top+g-k),/bottom|top/.test(c)){var l=0;b.left<0&&(l=-2*b.left,b.left=0,e.offset(b),j=e[0].offsetWidth,k=e[0].offsetHeight),this.replaceArrow(l-f+j,j,"left")}else this.replaceArrow(k-g,k,"top");d&&e.offset(b)},b.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},b.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach(),c.$element.trigger("hidden.bs."+c.type)}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);return this.$element.trigger(e),e.isDefaultPrevented()?void 0:(d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one(a.support.transition.end,b).emulateTransitionEnd(150):b(),this.hoverState=null,this)},b.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},b.prototype.hasContent=function(){return this.getTitle()},b.prototype.getPosition=function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},b.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},b.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},b.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},b.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},b.prototype.enable=function(){this.enabled=!0},b.prototype.disable=function(){this.enabled=!1},b.prototype.toggleEnabled=function(){this.enabled=!this.enabled},b.prototype.toggle=function(b){var c=b?a(b.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;c.tip().hasClass("in")?c.leave(c):c.enter(c)},b.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var c=a.fn.tooltip;a.fn.tooltip=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof c&&c;(e||"destroy"!=c)&&(e||d.data("bs.tooltip",e=new b(this,f)),"string"==typeof c&&e[c]())})},a.fn.tooltip.Constructor=b,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(jQuery),+function(a){"use strict";var b=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");b.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),b.prototype.constructor=b,b.prototype.getDefaults=function(){return b.DEFAULTS},b.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content")[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},b.prototype.hasContent=function(){return this.getTitle()||this.getContent()},b.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},b.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},b.prototype.tip=function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip};var c=a.fn.popover;a.fn.popover=function(c){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof c&&c;(e||"destroy"!=c)&&(e||d.data("bs.popover",e=new b(this,f)),"string"==typeof c&&e[c]())})},a.fn.popover.Constructor=b,a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(jQuery),+function(a){"use strict";function b(c,d){var e,f=a.proxy(this.process,this);this.$element=a(a(c).is("body")?window:c),this.$body=a("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",f),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||(e=a(c).attr("href"))&&e.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=a([]),this.targets=a([]),this.activeTarget=null,this.refresh(),this.process()}b.DEFAULTS={offset:10},b.prototype.refresh=function(){var b=this.$element[0]==window?"offset":"position";this.offsets=a([]),this.targets=a([]);{var c=this;this.$body.find(this.selector).map(function(){var d=a(this),e=d.data("target")||d.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[b]().top+(!a.isWindow(c.$scrollElement.get(0))&&c.$scrollElement.scrollTop()),e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){c.offsets.push(this[0]),c.targets.push(this[1])})}},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,d=c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(b>=d)return g!=(a=f.last()[0])&&this.activate(a);if(g&&b<=e[0])return g!=(a=f[0])&&this.activate(a);for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(!e[a+1]||b<=e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,a(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")};var c=a.fn.scrollspy;a.fn.scrollspy=function(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=c,this},a(window).on("load",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);b.scrollspy(b.data())})})}(jQuery),+function(a){"use strict";var b=function(b){this.element=a(b)};b.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a")[0],f=a.Event("show.bs.tab",{relatedTarget:e});if(b.trigger(f),!f.isDefaultPrevented()){var g=a(d);this.activate(b.parent("li"),c),this.activate(g,g.parent(),function(){b.trigger({type:"shown.bs.tab",relatedTarget:e})})}}},b.prototype.activate=function(b,c,d){function e(){f.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),g?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var f=c.find("> .active"),g=d&&a.support.transition&&f.hasClass("fade");g?f.one(a.support.transition.end,e).emulateTransitionEnd(150):e(),f.removeClass("in")};var c=a.fn.tab;a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new b(this)),"string"==typeof c&&e[c]()})},a.fn.tab.Constructor=b,a.fn.tab.noConflict=function(){return a.fn.tab=c,this},a(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})}(jQuery),+function(a){"use strict";var b=function(c,d){this.options=a.extend({},b.DEFAULTS,d),this.$window=a(window).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(c),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};b.RESET="affix affix-top affix-bottom",b.DEFAULTS={offset:0},b.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(b.RESET).addClass("affix");var a=this.$window.scrollTop(),c=this.$element.offset();return this.pinnedOffset=c.top-a},b.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},b.prototype.checkPosition=function(){if(this.$element.is(":visible")){var c=a(document).height(),d=this.$window.scrollTop(),e=this.$element.offset(),f=this.options.offset,g=f.top,h=f.bottom;"top"==this.affixed&&(e.top+=d),"object"!=typeof f&&(h=g=f),"function"==typeof g&&(g=f.top(this.$element)),"function"==typeof h&&(h=f.bottom(this.$element));var i=null!=this.unpin&&d+this.unpin<=e.top?!1:null!=h&&e.top+this.$element.height()>=c-h?"bottom":null!=g&&g>=d?"top":!1;if(this.affixed!==i){this.unpin&&this.$element.css("top","");var j="affix"+(i?"-"+i:""),k=a.Event(j+".bs.affix");this.$element.trigger(k),k.isDefaultPrevented()||(this.affixed=i,this.unpin="bottom"==i?this.getPinnedOffset():null,this.$element.removeClass(b.RESET).addClass(j).trigger(a.Event(j.replace("affix","affixed"))),"bottom"==i&&this.$element.offset({top:c-h-this.$element.height()}))}}};var c=a.fn.affix;a.fn.affix=function(c){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof c&&c;e||d.data("bs.affix",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.affix.Constructor=b,a.fn.affix.noConflict=function(){return a.fn.affix=c,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var b=a(this),c=b.data();c.offset=c.offset||{},c.offsetBottom&&(c.offset.bottom=c.offsetBottom),c.offsetTop&&(c.offset.top=c.offsetTop),b.affix(c)})})}(jQuery);
// Generated by CoffeeScript 1.6.2
(function(){var e=[].slice;(function(t,n){var r;return r=function(){function e(e){var r=this;this.$el=t(e),t(n).resize(function(){return r.refresh()})}return e.prototype.start=function(){var e,t,n,r;if(this._overlay_visible())return!1;this._add_overlay_layer(),r=this.$el.find("*[data-intro]:visible");for(t=0,n=r.length;t<n;t++)e=r[t],this._show_element(e);return this.$el.trigger("chardinJs:start")},e.prototype.toggle=function(){return this._overlay_visible()?this.stop():this.start()},e.prototype.refresh=function(){var e,t,n,r,i;if(this._overlay_visible()){r=this.$el.find("*[data-intro]:visible"),i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this._position_helper_layer(e));return i}return this},e.prototype.stop=function(){return this.$el.find(".chardinjs-overlay").fadeOut(function(){return t(this).remove()}),this.$el.find(".chardinjs-helper-layer").remove(),this.$el.find(".chardinjs-show-element").removeClass("chardinjs-show-element"),this.$el.find(".chardinjs-relative-position").removeClass("chardinjs-relative-position"),n.removeEventListener?n.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this.$el.trigger("chardinJs:stop")},e.prototype._overlay_visible=function(){return this.$el.find(".chardinjs-overlay").length!==0},e.prototype._add_overlay_layer=function(){var e,t,n,r=this;return this._overlay_visible()?!1:(t=document.createElement("div"),n="",t.className="chardinjs-overlay",this.$el.prop("tagName")==="BODY"?(n+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",t.setAttribute("style",n)):(e=this._get_offset(this.$el.get()[0]),e&&(n+="width: "+e.width+"px; height:"+e.height+"px; top:"+e.top+"px;left: "+e.left+"px;",t.setAttribute("style",n))),this.$el.get()[0].appendChild(t),t.onclick=function(){return r.stop()},setTimeout(function(){return n+="opacity: .8;opacity: .8;-ms-filter: 'progid:DXImageTransform.Microsoft.Alpha(Opacity=80)';filter: alpha(opacity=80);",t.setAttribute("style",n)},10))},e.prototype._get_position=function(e){return e.getAttribute("data-position")||"bottom"},e.prototype._place_tooltip=function(e){var n,r,i,s,o,u,a;u=t(e).data("tooltip_layer"),a=this._get_offset(u),u.style.top=null,u.style.right=null,u.style.bottom=null,u.style.left=null;switch(this._get_position(e)){case"top":case"bottom":i=this._get_offset(e),o=i.width,r=t(u).width(),u.style.left=""+(o/2-a.width/2)+"px";break;case"left":case"right":i=this._get_offset(e),s=i.height,n=t(u).height(),u.style.top=""+(s/2-a.height/2)+"px"}switch(this._get_position(e)){case"left":return u.style.left="-"+(a.width-34)+"px";case"right":return u.style.right="-"+(a.width-34)+"px";case"bottom":return u.style.bottom="-"+a.height+"px";case"top":return u.style.top="-"+a.height+"px"}},e.prototype._position_helper_layer=function(e){var n,r;return r=t(e).data("helper_layer"),n=this._get_offset(e),r.setAttribute("style","width: "+n.width+"px; height:"+n.height+"px; top:"+n.top+"px; left: "+n.left+"px;")},e.prototype._show_element=function(e){var n,r,i,s;r=this._get_offset(e),i=document.createElement("div"),s=document.createElement("div"),t(e).data("helper_layer",i).data("tooltip_layer",s),e.id&&i.setAttribute("data-id",e.id),i.className="chardinjs-helper-layer chardinjs-"+this._get_position(e),this._position_helper_layer(e),this.$el.get()[0].appendChild(i),s.className="chardinjs-tooltip chardinjs-"+this._get_position(e),s.innerHTML="<div class='chardinjs-tooltiptext'>"+e.getAttribute("data-intro")+"</div>",i.appendChild(s),this._place_tooltip(e),e.className+=" chardinjs-show-element",n="",e.currentStyle?n=e.currentStyle.position:document.defaultView&&document.defaultView.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue("position")),n=n.toLowerCase();if(n!=="absolute"&&n!=="relative")return e.className+=" chardinjs-relative-position"},e.prototype._get_offset=function(e){var t,n,r;t={width:e.offsetWidth,height:e.offsetHeight},n=0,r=0;while(e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop))n+=e.offsetLeft,r+=e.offsetTop,e=e.offsetParent;return t.top=r,t.left=n,t},e}(),t.fn.extend({chardinJs:function(){var n,i,s,o;return o=arguments[0],i=2<=arguments.length?e.call(arguments,1):[],n=t(this[0]),s=n.data("chardinJs"),s||n.data("chardinJs",s=new r(this,o)),typeof o=="string"&&s[o].apply(s,i),s}})})(window.jQuery,window)}).call(this);
/*
 Colors JS Library v1.2.4
 Copyright 2012-2013 Matt Jordan
 Licensed under Creative Commons Attribution-ShareAlike 3.0 Unported. (http://creativecommons.org/licenses/by-sa/3.0/)
 https://github.com/mbjordan/Colors
*/

(function(n){var l={},g={};l.render=function(a,b){var d={},c;if("object"==typeof a)return"rgb"===b&&(c=["R","G","B","RGB"]),"hsv"===b&&(c=["H","S","V","HSV"]),"hsl"===b&&(c=["H","S","L","HSL"]),d[c[0]]=a[0],d[c[1]]=a[1],d[c[2]]=a[2],d[c[3]]=a[0]+" "+a[1]+" "+a[2],d.a=a,d};l.paddedHex=function(a){a=(10>a?"0":"")+a.toString(16);return 1===a.length?"0"+a:a};Number.prototype.round=function(a){return parseFloat(this.toFixed(a||10))};g.rgb2hex=function(a,b,d){a=l.paddedHex(a);b=void 0!==b?l.paddedHex(b):
a;d=void 0!==d?l.paddedHex(d):a;return"#"+a+b+d};g.hex2rgb=function(a){a=a.replace("#","");return 6===a.length?l.render([parseInt(a.substr(0,2),16),parseInt(a.substr(2,2),16),parseInt(a.substr(4,2),16)],"rgb"):parseInt(a,16)};g.hex2hsv=function(a){a="#"==a.charAt(0)?a.substring(1,7):a;var b=parseInt(a.substring(0,2),16)/255,d=parseInt(a.substring(2,4),16)/255;a=parseInt(a.substring(4,6),16)/255;var c=0,e=0,h=0,e=Math.min(b,d,a),k=Math.max(b,d,a),f=k-e,m,g,h=k;0===f?e=c=0:(e=f/k,m=((k-b)/6+f/2)/f,
g=((k-d)/6+f/2)/f,f=((k-a)/6+f/2)/f,b==k?c=f-g:d==k?c=1/3+m-f:a==k&&(c=2/3+g-m),0>c&&(c+=1),1<c&&(c-=1));return l.render([Math.round(360*c),Math.round(100*e),Math.round(100*h)],"hsv")};g.hsv2rgb=function(a,b,d){var c=[],e,h,k;"object"==typeof a?(e=a[0],b=a[1],a=a[2]):(e=a,a=d);b/=100;a/=100;d=Math.floor(e/60%6);h=e/60-d;e=a*(1-b);k=a*(1-h*b);b=a*(1-(1-h)*b);switch(d){case 0:c=[a,b,e];break;case 1:c=[k,a,e];break;case 2:c=[e,a,b];break;case 3:c=[e,k,a];break;case 4:c=[b,e,a];break;case 5:c=[a,e,k]}return l.render([Math.min(255,
Math.floor(256*c[0])),Math.min(255,Math.floor(256*c[1])),Math.min(255,Math.floor(256*c[2]))],"rgb")};g.rgb2hsl=function(a,b,d){var c,e,h,k,f;"object"===typeof a?(c=a[0],b=a[1],a=a[2]):(c=a,a=d);c/=255;b/=255;a/=255;d=Math.max(c,b,a);e=Math.min(c,b,a);k=(d+e)/2;if(d==e)h=e=0;else{f=d-e;e=0.5<k?f/(2-d-e):f/(d+e);switch(d){case c:h=(b-a)/f+(b<a?6:0);break;case b:h=(a-c)/f+2;break;case a:h=(c-b)/f+4}h/=6}return l.render([Math.floor(360*h),(100*e).round(1),(100*k).round(1)],"hsl")};g.hsv2hsl=function(a,
b,d){var c,e,h,k,f,g;"object"==typeof a?(c=a[0],e=a[1],h=a[2]):(c=a,e=b,h=d);h=this.hsv2rgb(c,e,h);c=h.R/255;e=h.G/255;k=h.B/255;f=Math.max(c,e,k);g=Math.min(c,e,k);h=(f+g)/2;f!=g&&(b=0.5>h?(f-g)/(f+g):(f-g)/(2-f-g),a=c==f?(e-k)/(f-g):e==f?2+(k-c)/(f-g):4+(c-e)/(f-g));return l.render([Math.floor(a),Math.floor(b),Math.floor(d)],"hsl")};g.name2hex=function(a){a=a.toLowerCase();a={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",
black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",
darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",
hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",
lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",
orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",
snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}[a];return void 0===a?"Invalid Color Name":a};g.name2rgb=function(a){a=this.name2hex(a);return/^[a-fA-F0-9#]{7}$/.test(a)?this.hex2rgb(a):l.render(["Invalid Color Name","Invalid Color Name","Invalid Color Name"],"rgb")};g.name2hsv=function(a){a=this.name2hex(a);
return/^[a-fA-F0-9#]{7}$/.test(a)?this.hex2hsv(a):l.render(["Invalid Color Name","Invalid Color Name","Invalid Color Name"],"hsv")};g.complement=function(a,b,d){var c;if("string"==typeof a&&/(#([A-Fa-f0-9]){3}(([A-Fa-f0-9]){3})?)/.test(a))return a=a.replace("#",""),b="#",6===a.length&&(b+=l.paddedHex(255-this.hex2rgb(a.substr(0,2))),b+=l.paddedHex(255-this.hex2rgb(a.substr(2,2))),b+=l.paddedHex(255-this.hex2rgb(a.substr(4,2)))),3===a.length&&(b+=l.paddedHex(255-this.hex2rgb(a.substr(0,1)+a.substr(0,
1))),b+=l.paddedHex(255-this.hex2rgb(a.substr(1,1)+a.substr(1,1))),b+=l.paddedHex(255-this.hex2rgb(a.substr(2,1)+a.substr(2,1)))),b;void 0!==a&&void 0!==b&&void 0!==d&&(c=[255-a,255-b,255-d]);"object"==typeof a&&(c=[255-a[0],255-a[1],255-a[2]]);return l.render(c,"rgb")};g.rand=function(a){var b,d;if("hex"===a||void 0===a){a="";for(d=0;6>d;d++)b=Math.floor(16*Math.random()),a+="0123456789abcdef".substring(b,b+1);return"#"+a}if("rgb"==a)return a=Math.floor(-254*Math.random()+255),b=Math.floor(-254*
Math.random()+255),d=Math.floor(-254*Math.random()+255),l.render([a,b,d],"rgb")};n.Colors=n.$c=g})(window);
!function(){function n(n,t){return t>n?-1:n>t?1:n>=t?0:0/0}function t(n){return null!=n&&!isNaN(n)}function r(n){return{left:function(t,r,e,u){for(arguments.length<3&&(e=0),arguments.length<4&&(u=t.length);u>e;){var i=e+u>>>1;n(t[i],r)<0?e=i+1:u=i}return e},right:function(t,r,e,u){for(arguments.length<3&&(e=0),arguments.length<4&&(u=t.length);u>e;){var i=e+u>>>1;n(t[i],r)>0?u=i:e=i+1}return e}}}function e(n){return n.length}function u(n){for(var t=1;n*t%1;)t*=10;return t}function i(n,t){try{for(var r in t)Object.defineProperty(n.prototype,r,{value:t[r],enumerable:!1})}catch(e){n.prototype=t}}function o(){}function a(n){return sa+n in this}function c(n){return n=sa+n,n in this&&delete this[n]}function s(){var n=[];return this.forEach(function(t){n.push(t)}),n}function l(){var n=0;for(var t in this)t.charCodeAt(0)===la&&++n;return n}function f(){for(var n in this)if(n.charCodeAt(0)===la)return!1;return!0}function h(){}function g(n,t,r){return function(){var e=r.apply(t,arguments);return e===t?n:e}}function p(n,t){if(t in n)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var r=0,e=fa.length;e>r;++r){var u=fa[r]+t;if(u in n)return u}}function v(){}function d(){}function m(n){function t(){for(var t,e=r,u=-1,i=e.length;++u<i;)(t=e[u].on)&&t.apply(this,arguments);return n}var r=[],e=new o;return t.on=function(t,u){var i,o=e.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,r=r.slice(0,i=r.indexOf(o)).concat(r.slice(i+1)),e.remove(t)),u&&r.push(e.set(t,{on:u})),n)},t}function y(){Bo.event.preventDefault()}function x(){for(var n,t=Bo.event;n=t.sourceEvent;)t=n;return t}function M(n){for(var t=new d,r=0,e=arguments.length;++r<e;)t[arguments[r]]=m(t);return t.of=function(r,e){return function(u){try{var i=u.sourceEvent=Bo.event;u.target=n,Bo.event=u,t[u.type].apply(r,e)}finally{Bo.event=i}}},t}function _(n){return ga(n,ya),n}function b(n){return"function"==typeof n?n:function(){return pa(n,this)}}function w(n){return"function"==typeof n?n:function(){return va(n,this)}}function S(n,t){function r(){this.removeAttribute(n)}function e(){this.removeAttributeNS(n.space,n.local)}function u(){this.setAttribute(n,t)}function i(){this.setAttributeNS(n.space,n.local,t)}function o(){var r=t.apply(this,arguments);null==r?this.removeAttribute(n):this.setAttribute(n,r)}function a(){var r=t.apply(this,arguments);null==r?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,r)}return n=Bo.ns.qualify(n),null==t?n.local?e:r:"function"==typeof t?n.local?a:o:n.local?i:u}function k(n){return n.trim().replace(/\s+/g," ")}function E(n){return new RegExp("(?:^|\\s+)"+Bo.requote(n)+"(?:\\s+|$)","g")}function A(n){return n.trim().split(/^|\s+/)}function C(n,t){function r(){for(var r=-1;++r<u;)n[r](this,t)}function e(){for(var r=-1,e=t.apply(this,arguments);++r<u;)n[r](this,e)}n=A(n).map(N);var u=n.length;return"function"==typeof t?e:r}function N(n){var t=E(n);return function(r,e){if(u=r.classList)return e?u.add(n):u.remove(n);var u=r.getAttribute("class")||"";e?(t.lastIndex=0,t.test(u)||r.setAttribute("class",k(u+" "+n))):r.setAttribute("class",k(u.replace(t," ")))}}function z(n,t,r){function e(){this.style.removeProperty(n)}function u(){this.style.setProperty(n,t,r)}function i(){var e=t.apply(this,arguments);null==e?this.style.removeProperty(n):this.style.setProperty(n,e,r)}return null==t?e:"function"==typeof t?i:u}function L(n,t){function r(){delete this[n]}function e(){this[n]=t}function u(){var r=t.apply(this,arguments);null==r?delete this[n]:this[n]=r}return null==t?r:"function"==typeof t?u:e}function T(n){return"function"==typeof n?n:(n=Bo.ns.qualify(n)).local?function(){return this.ownerDocument.createElementNS(n.space,n.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,n)}}function q(n){return{__data__:n}}function R(n){return function(){return ma(this,n)}}function D(t){return arguments.length||(t=n),function(n,r){return n&&r?t(n.__data__,r.__data__):!n-!r}}function P(n,t){for(var r=0,e=n.length;e>r;r++)for(var u,i=n[r],o=0,a=i.length;a>o;o++)(u=i[o])&&t(u,o,r);return n}function U(n){return ga(n,Ma),n}function j(n){var t,r;return function(e,u,i){var o,a=n[i].update,c=a.length;for(i!=r&&(r=i,t=0),u>=t&&(t=u+1);!(o=a[t])&&++t<c;);return o}}function H(){var n=this.__transition__;n&&++n.active}function F(n,t,r){function e(){var t=this[o];t&&(this.removeEventListener(n,t,t.$),delete this[o])}function u(){var u=c(t,Wo(arguments));e.call(this),this.addEventListener(n,this[o]=u,u.$=r),u._=t}function i(){var t,r=new RegExp("^__on([^.]+)"+Bo.requote(n)+"$");for(var e in this)if(t=e.match(r)){var u=this[e];this.removeEventListener(t[1],u,u.$),delete this[e]}}var o="__on"+n,a=n.indexOf("."),c=O;a>0&&(n=n.substring(0,a));var s=ba.get(n);return s&&(n=s,c=I),a?t?u:e:t?v:i}function O(n,t){return function(r){var e=Bo.event;Bo.event=r,t[0]=this.__data__;try{n.apply(this,t)}finally{Bo.event=e}}}function I(n,t){var r=O(n,t);return function(n){var t=this,e=n.relatedTarget;e&&(e===t||8&e.compareDocumentPosition(t))||r.call(t,n)}}function Y(){var n=".dragsuppress-"+ ++Sa,t="click"+n,r=Bo.select(Qo).on("touchmove"+n,y).on("dragstart"+n,y).on("selectstart"+n,y);if(wa){var e=Ko.style,u=e[wa];e[wa]="none"}return function(i){function o(){r.on(t,null)}r.on(n,null),wa&&(e[wa]=u),i&&(r.on(t,function(){y(),o()},!0),setTimeout(o,0))}}function Z(n,t){t.changedTouches&&(t=t.changedTouches[0]);var r=n.ownerSVGElement||n;if(r.createSVGPoint){var e=r.createSVGPoint();return e.x=t.clientX,e.y=t.clientY,e=e.matrixTransform(n.getScreenCTM().inverse()),[e.x,e.y]}var u=n.getBoundingClientRect();return[t.clientX-u.left-n.clientLeft,t.clientY-u.top-n.clientTop]}function V(){return Bo.event.changedTouches[0].identifier}function $(){return Bo.event.target}function X(){return Qo}function B(n){return n>0?1:0>n?-1:0}function J(n,t,r){return(t[0]-n[0])*(r[1]-n[1])-(t[1]-n[1])*(r[0]-n[0])}function W(n){return n>1?0:-1>n?ka:Math.acos(n)}function G(n){return n>1?Aa:-1>n?-Aa:Math.asin(n)}function K(n){return((n=Math.exp(n))-1/n)/2}function Q(n){return((n=Math.exp(n))+1/n)/2}function nt(n){return((n=Math.exp(2*n))-1)/(n+1)}function tt(n){return(n=Math.sin(n/2))*n}function rt(){}function et(n,t,r){return new ut(n,t,r)}function ut(n,t,r){this.h=n,this.s=t,this.l=r}function it(n,t,r){function e(n){return n>360?n-=360:0>n&&(n+=360),60>n?i+(o-i)*n/60:180>n?o:240>n?i+(o-i)*(240-n)/60:i}function u(n){return Math.round(255*e(n))}var i,o;return n=isNaN(n)?0:(n%=360)<0?n+360:n,t=isNaN(t)?0:0>t?0:t>1?1:t,r=0>r?0:r>1?1:r,o=.5>=r?r*(1+t):r+t-r*t,i=2*r-o,yt(u(n+120),u(n),u(n-120))}function ot(n,t,r){return new at(n,t,r)}function at(n,t,r){this.h=n,this.c=t,this.l=r}function ct(n,t,r){return isNaN(n)&&(n=0),isNaN(t)&&(t=0),st(r,Math.cos(n*=za)*t,Math.sin(n)*t)}function st(n,t,r){return new lt(n,t,r)}function lt(n,t,r){this.l=n,this.a=t,this.b=r}function ft(n,t,r){var e=(n+16)/116,u=e+t/500,i=e-r/200;return u=gt(u)*Oa,e=gt(e)*Ia,i=gt(i)*Ya,yt(vt(3.2404542*u-1.5371385*e-.4985314*i),vt(-.969266*u+1.8760108*e+.041556*i),vt(.0556434*u-.2040259*e+1.0572252*i))}function ht(n,t,r){return n>0?ot(Math.atan2(r,t)*La,Math.sqrt(t*t+r*r),n):ot(0/0,0/0,n)}function gt(n){return n>.206893034?n*n*n:(n-4/29)/7.787037}function pt(n){return n>.008856?Math.pow(n,1/3):7.787037*n+4/29}function vt(n){return Math.round(255*(.00304>=n?12.92*n:1.055*Math.pow(n,1/2.4)-.055))}function dt(n){return yt(n>>16,255&n>>8,255&n)}function mt(n){return dt(n)+""}function yt(n,t,r){return new xt(n,t,r)}function xt(n,t,r){this.r=n,this.g=t,this.b=r}function Mt(n){return 16>n?"0"+Math.max(0,n).toString(16):Math.min(255,n).toString(16)}function _t(n,t,r){var e,u,i,o=0,a=0,c=0;if(e=/([a-z]+)\((.*)\)/i.exec(n))switch(u=e[2].split(","),e[1]){case"hsl":return r(parseFloat(u[0]),parseFloat(u[1])/100,parseFloat(u[2])/100);case"rgb":return t(kt(u[0]),kt(u[1]),kt(u[2]))}return(i=$a.get(n))?t(i.r,i.g,i.b):(null==n||"#"!==n.charAt(0)||isNaN(i=parseInt(n.substring(1),16))||(4===n.length?(o=(3840&i)>>4,o=o>>4|o,a=240&i,a=a>>4|a,c=15&i,c=c<<4|c):7===n.length&&(o=(16711680&i)>>16,a=(65280&i)>>8,c=255&i)),t(o,a,c))}function bt(n,t,r){var e,u,i=Math.min(n/=255,t/=255,r/=255),o=Math.max(n,t,r),a=o-i,c=(o+i)/2;return a?(u=.5>c?a/(o+i):a/(2-o-i),e=n==o?(t-r)/a+(r>t?6:0):t==o?(r-n)/a+2:(n-t)/a+4,e*=60):(e=0/0,u=c>0&&1>c?0:e),et(e,u,c)}function wt(n,t,r){n=St(n),t=St(t),r=St(r);var e=pt((.4124564*n+.3575761*t+.1804375*r)/Oa),u=pt((.2126729*n+.7151522*t+.072175*r)/Ia),i=pt((.0193339*n+.119192*t+.9503041*r)/Ya);return st(116*u-16,500*(e-u),200*(u-i))}function St(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function kt(n){var t=parseFloat(n);return"%"===n.charAt(n.length-1)?Math.round(2.55*t):t}function Et(n){return"function"==typeof n?n:function(){return n}}function At(n){return n}function Ct(n){return function(t,r,e){return 2===arguments.length&&"function"==typeof r&&(e=r,r=null),Nt(t,r,n,e)}}function Nt(n,t,r,e){function u(){var n,t=c.status;if(!t&&c.responseText||t>=200&&300>t||304===t){try{n=r.call(i,c)}catch(e){return o.error.call(i,e),void 0}o.load.call(i,n)}else o.error.call(i,c)}var i={},o=Bo.dispatch("beforesend","progress","load","error"),a={},c=new XMLHttpRequest,s=null;return!Qo.XDomainRequest||"withCredentials"in c||!/^(http(s)?:)?\/\//.test(n)||(c=new XDomainRequest),"onload"in c?c.onload=c.onerror=u:c.onreadystatechange=function(){c.readyState>3&&u()},c.onprogress=function(n){var t=Bo.event;Bo.event=n;try{o.progress.call(i,c)}finally{Bo.event=t}},i.header=function(n,t){return n=(n+"").toLowerCase(),arguments.length<2?a[n]:(null==t?delete a[n]:a[n]=t+"",i)},i.mimeType=function(n){return arguments.length?(t=null==n?null:n+"",i):t},i.responseType=function(n){return arguments.length?(s=n,i):s},i.response=function(n){return r=n,i},["get","post"].forEach(function(n){i[n]=function(){return i.send.apply(i,[n].concat(Wo(arguments)))}}),i.send=function(r,e,u){if(2===arguments.length&&"function"==typeof e&&(u=e,e=null),c.open(r,n,!0),null==t||"accept"in a||(a.accept=t+",*/*"),c.setRequestHeader)for(var l in a)c.setRequestHeader(l,a[l]);return null!=t&&c.overrideMimeType&&c.overrideMimeType(t),null!=s&&(c.responseType=s),null!=u&&i.on("error",u).on("load",function(n){u(null,n)}),o.beforesend.call(i,c),c.send(null==e?null:e),i},i.abort=function(){return c.abort(),i},Bo.rebind(i,o,"on"),null==e?i:i.get(zt(e))}function zt(n){return 1===n.length?function(t,r){n(null==t?r:null)}:n}function Lt(){var n=Tt(),t=qt()-n;t>24?(isFinite(t)&&(clearTimeout(Wa),Wa=setTimeout(Lt,t)),Ja=0):(Ja=1,Ka(Lt))}function Tt(){var n=Date.now();for(Ga=Xa;Ga;)n>=Ga.t&&(Ga.f=Ga.c(n-Ga.t)),Ga=Ga.n;return n}function qt(){for(var n,t=Xa,r=1/0;t;)t.f?t=n?n.n=t.n:Xa=t.n:(t.t<r&&(r=t.t),t=(n=t).n);return Ba=n,r}function Rt(n,t){return t-(n?Math.ceil(Math.log(n)/Math.LN10):1)}function Dt(n,t){var r=Math.pow(10,3*ca(8-t));return{scale:t>8?function(n){return n/r}:function(n){return n*r},symbol:n}}function Pt(n){var t=n.decimal,r=n.thousands,e=n.grouping,u=n.currency,i=e?function(n){for(var t=n.length,u=[],i=0,o=e[0];t>0&&o>0;)u.push(n.substring(t-=o,t+o)),o=e[i=(i+1)%e.length];return u.reverse().join(r)}:At;return function(n){var r=nc.exec(n),e=r[1]||" ",o=r[2]||">",a=r[3]||"",c=r[4]||"",s=r[5],l=+r[6],f=r[7],h=r[8],g=r[9],p=1,v="",d="",m=!1;switch(h&&(h=+h.substring(1)),(s||"0"===e&&"="===o)&&(s=e="0",o="=",f&&(l-=Math.floor((l-1)/4))),g){case"n":f=!0,g="g";break;case"%":p=100,d="%",g="f";break;case"p":p=100,d="%",g="r";break;case"b":case"o":case"x":case"X":"#"===c&&(v="0"+g.toLowerCase());case"c":case"d":m=!0,h=0;break;case"s":p=-1,g="r"}"$"===c&&(v=u[0],d=u[1]),"r"!=g||h||(g="g"),null!=h&&("g"==g?h=Math.max(1,Math.min(21,h)):("e"==g||"f"==g)&&(h=Math.max(0,Math.min(20,h)))),g=tc.get(g)||Ut;var y=s&&f;return function(n){var r=d;if(m&&n%1)return"";var u=0>n||0===n&&0>1/n?(n=-n,"-"):a;if(0>p){var c=Bo.formatPrefix(n,h);n=c.scale(n),r=c.symbol+d}else n*=p;n=g(n,h);var x=n.lastIndexOf("."),M=0>x?n:n.substring(0,x),_=0>x?"":t+n.substring(x+1);!s&&f&&(M=i(M));var b=v.length+M.length+_.length+(y?0:u.length),w=l>b?new Array(b=l-b+1).join(e):"";return y&&(M=i(w+M)),u+=v,n=M+_,("<"===o?u+n+w:">"===o?w+u+n:"^"===o?w.substring(0,b>>=1)+u+n+w.substring(b):u+(y?n:w+n))+r}}}function Ut(n){return n+""}function jt(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Ht(n,t,r){function e(t){var r=n(t),e=i(r,1);return e-t>t-r?r:e}function u(r){return t(r=n(new ec(r-1)),1),r}function i(n,r){return t(n=new ec(+n),r),n}function o(n,e,i){var o=u(n),a=[];if(i>1)for(;e>o;)r(o)%i||a.push(new Date(+o)),t(o,1);else for(;e>o;)a.push(new Date(+o)),t(o,1);return a}function a(n,t,r){try{ec=jt;var e=new jt;return e._=n,o(e,t,r)}finally{ec=Date}}n.floor=n,n.round=e,n.ceil=u,n.offset=i,n.range=o;var c=n.utc=Ft(n);return c.floor=c,c.round=Ft(e),c.ceil=Ft(u),c.offset=Ft(i),c.range=a,n}function Ft(n){return function(t,r){try{ec=jt;var e=new jt;return e._=t,n(e,r)._}finally{ec=Date}}}function Ot(n){function t(n){function t(t){for(var r,u,i,o=[],a=-1,c=0;++a<e;)37===n.charCodeAt(a)&&(o.push(n.substring(c,a)),null!=(u=ic[r=n.charAt(++a)])&&(r=n.charAt(++a)),(i=C[r])&&(r=i(t,null==u?"e"===r?" ":"0":u)),o.push(r),c=a+1);return o.push(n.substring(c,a)),o.join("")}var e=n.length;return t.parse=function(t){var e={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},u=r(e,n,t,0);if(u!=t.length)return null;"p"in e&&(e.H=e.H%12+12*e.p);var i=null!=e.Z&&ec!==jt,o=new(i?jt:ec);return"j"in e?o.setFullYear(e.y,0,e.j):"w"in e&&("W"in e||"U"in e)?(o.setFullYear(e.y,0,1),o.setFullYear(e.y,0,"W"in e?(e.w+6)%7+7*e.W-(o.getDay()+5)%7:e.w+7*e.U-(o.getDay()+6)%7)):o.setFullYear(e.y,e.m,e.d),o.setHours(e.H+Math.floor(e.Z/100),e.M+e.Z%100,e.S,e.L),i?o._:o},t.toString=function(){return n},t}function r(n,t,r,e){for(var u,i,o,a=0,c=t.length,s=r.length;c>a;){if(e>=s)return-1;if(u=t.charCodeAt(a++),37===u){if(o=t.charAt(a++),i=N[o in ic?t.charAt(a++):o],!i||(e=i(n,r,e))<0)return-1}else if(u!=r.charCodeAt(e++))return-1}return e}function e(n,t,r){b.lastIndex=0;var e=b.exec(t.substring(r));return e?(n.w=w.get(e[0].toLowerCase()),r+e[0].length):-1}function u(n,t,r){M.lastIndex=0;var e=M.exec(t.substring(r));return e?(n.w=_.get(e[0].toLowerCase()),r+e[0].length):-1}function i(n,t,r){E.lastIndex=0;var e=E.exec(t.substring(r));return e?(n.m=A.get(e[0].toLowerCase()),r+e[0].length):-1}function o(n,t,r){S.lastIndex=0;var e=S.exec(t.substring(r));return e?(n.m=k.get(e[0].toLowerCase()),r+e[0].length):-1}function a(n,t,e){return r(n,C.c.toString(),t,e)}function c(n,t,e){return r(n,C.x.toString(),t,e)}function s(n,t,e){return r(n,C.X.toString(),t,e)}function l(n,t,r){var e=x.get(t.substring(r,r+=2).toLowerCase());return null==e?-1:(n.p=e,r)}var f=n.dateTime,h=n.date,g=n.time,p=n.periods,v=n.days,d=n.shortDays,m=n.months,y=n.shortMonths;t.utc=function(n){function r(n){try{ec=jt;var t=new ec;return t._=n,e(t)}finally{ec=Date}}var e=t(n);return r.parse=function(n){try{ec=jt;var t=e.parse(n);return t&&t._}finally{ec=Date}},r.toString=e.toString,r},t.multi=t.utc.multi=ar;var x=Bo.map(),M=Yt(v),_=Zt(v),b=Yt(d),w=Zt(d),S=Yt(m),k=Zt(m),E=Yt(y),A=Zt(y);p.forEach(function(n,t){x.set(n.toLowerCase(),t)});var C={a:function(n){return d[n.getDay()]},A:function(n){return v[n.getDay()]},b:function(n){return y[n.getMonth()]},B:function(n){return m[n.getMonth()]},c:t(f),d:function(n,t){return It(n.getDate(),t,2)},e:function(n,t){return It(n.getDate(),t,2)},H:function(n,t){return It(n.getHours(),t,2)},I:function(n,t){return It(n.getHours()%12||12,t,2)},j:function(n,t){return It(1+rc.dayOfYear(n),t,3)},L:function(n,t){return It(n.getMilliseconds(),t,3)},m:function(n,t){return It(n.getMonth()+1,t,2)},M:function(n,t){return It(n.getMinutes(),t,2)},p:function(n){return p[+(n.getHours()>=12)]},S:function(n,t){return It(n.getSeconds(),t,2)},U:function(n,t){return It(rc.sundayOfYear(n),t,2)},w:function(n){return n.getDay()},W:function(n,t){return It(rc.mondayOfYear(n),t,2)},x:t(h),X:t(g),y:function(n,t){return It(n.getFullYear()%100,t,2)},Y:function(n,t){return It(n.getFullYear()%1e4,t,4)},Z:ir,"%":function(){return"%"}},N={a:e,A:u,b:i,B:o,c:a,d:Qt,e:Qt,H:tr,I:tr,j:nr,L:ur,m:Kt,M:rr,p:l,S:er,U:$t,w:Vt,W:Xt,x:c,X:s,y:Jt,Y:Bt,Z:Wt,"%":or};return t}function It(n,t,r){var e=0>n?"-":"",u=(e?-n:n)+"",i=u.length;return e+(r>i?new Array(r-i+1).join(t)+u:u)}function Yt(n){return new RegExp("^(?:"+n.map(Bo.requote).join("|")+")","i")}function Zt(n){for(var t=new o,r=-1,e=n.length;++r<e;)t.set(n[r].toLowerCase(),r);return t}function Vt(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+1));return e?(n.w=+e[0],r+e[0].length):-1}function $t(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r));return e?(n.U=+e[0],r+e[0].length):-1}function Xt(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r));return e?(n.W=+e[0],r+e[0].length):-1}function Bt(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+4));return e?(n.y=+e[0],r+e[0].length):-1}function Jt(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+2));return e?(n.y=Gt(+e[0]),r+e[0].length):-1}function Wt(n,t,r){return/^[+-]\d{4}$/.test(t=t.substring(r,r+5))?(n.Z=-t,r+5):-1}function Gt(n){return n+(n>68?1900:2e3)}function Kt(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+2));return e?(n.m=e[0]-1,r+e[0].length):-1}function Qt(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+2));return e?(n.d=+e[0],r+e[0].length):-1}function nr(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+3));return e?(n.j=+e[0],r+e[0].length):-1}function tr(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+2));return e?(n.H=+e[0],r+e[0].length):-1}function rr(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+2));return e?(n.M=+e[0],r+e[0].length):-1}function er(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+2));return e?(n.S=+e[0],r+e[0].length):-1}function ur(n,t,r){oc.lastIndex=0;var e=oc.exec(t.substring(r,r+3));return e?(n.L=+e[0],r+e[0].length):-1}function ir(n){var t=n.getTimezoneOffset(),r=t>0?"-":"+",e=~~(ca(t)/60),u=ca(t)%60;return r+It(e,"0",2)+It(u,"0",2)}function or(n,t,r){ac.lastIndex=0;var e=ac.exec(t.substring(r,r+1));return e?r+e[0].length:-1}function ar(n){for(var t=n.length,r=-1;++r<t;)n[r][0]=this(n[r][0]);return function(t){for(var r=0,e=n[r];!e[1](t);)e=n[++r];return e[0](t)}}function cr(){}function sr(n,t,r){var e=r.s=n+t,u=e-n,i=e-u;r.t=n-i+(t-u)}function lr(n,t){n&&fc.hasOwnProperty(n.type)&&fc[n.type](n,t)}function fr(n,t,r){var e,u=-1,i=n.length-r;for(t.lineStart();++u<i;)e=n[u],t.point(e[0],e[1],e[2]);t.lineEnd()}function hr(n,t){var r=-1,e=n.length;for(t.polygonStart();++r<e;)fr(n[r],t,1);t.polygonEnd()}function gr(){function n(n,t){n*=za,t=t*za/2+ka/4;var r=n-e,o=r>=0?1:-1,a=o*r,c=Math.cos(t),s=Math.sin(t),l=i*s,f=u*c+l*Math.cos(a),h=l*o*Math.sin(a);gc.add(Math.atan2(h,f)),e=n,u=c,i=s}var t,r,e,u,i;pc.point=function(o,a){pc.point=n,e=(t=o)*za,u=Math.cos(a=(r=a)*za/2+ka/4),i=Math.sin(a)},pc.lineEnd=function(){n(t,r)}}function pr(n){var t=n[0],r=n[1],e=Math.cos(r);return[e*Math.cos(t),e*Math.sin(t),Math.sin(r)]}function vr(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function dr(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function mr(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function yr(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function xr(n){var t=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function Mr(n){return[Math.atan2(n[1],n[0]),G(n[2])]}function _r(n,t){return ca(n[0]-t[0])<Ca&&ca(n[1]-t[1])<Ca}function br(n,t){n*=za;var r=Math.cos(t*=za);wr(r*Math.cos(n),r*Math.sin(n),Math.sin(t))}function wr(n,t,r){++vc,mc+=(n-mc)/vc,yc+=(t-yc)/vc,xc+=(r-xc)/vc}function Sr(){function n(n,u){n*=za;var i=Math.cos(u*=za),o=i*Math.cos(n),a=i*Math.sin(n),c=Math.sin(u),s=Math.atan2(Math.sqrt((s=r*c-e*a)*s+(s=e*o-t*c)*s+(s=t*a-r*o)*s),t*o+r*a+e*c);dc+=s,Mc+=s*(t+(t=o)),_c+=s*(r+(r=a)),bc+=s*(e+(e=c)),wr(t,r,e)}var t,r,e;Ec.point=function(u,i){u*=za;var o=Math.cos(i*=za);t=o*Math.cos(u),r=o*Math.sin(u),e=Math.sin(i),Ec.point=n,wr(t,r,e)}}function kr(){Ec.point=br}function Er(){function n(n,t){n*=za;var r=Math.cos(t*=za),o=r*Math.cos(n),a=r*Math.sin(n),c=Math.sin(t),s=u*c-i*a,l=i*o-e*c,f=e*a-u*o,h=Math.sqrt(s*s+l*l+f*f),g=e*o+u*a+i*c,p=h&&-W(g)/h,v=Math.atan2(h,g);wc+=p*s,Sc+=p*l,kc+=p*f,dc+=v,Mc+=v*(e+(e=o)),_c+=v*(u+(u=a)),bc+=v*(i+(i=c)),wr(e,u,i)}var t,r,e,u,i;Ec.point=function(o,a){t=o,r=a,Ec.point=n,o*=za;var c=Math.cos(a*=za);e=c*Math.cos(o),u=c*Math.sin(o),i=Math.sin(a),wr(e,u,i)},Ec.lineEnd=function(){n(t,r),Ec.lineEnd=kr,Ec.point=br}}function Ar(){return!0}function Cr(n,t,r,e,u){var i=[],o=[];if(n.forEach(function(n){if(!((t=n.length-1)<=0)){var t,r=n[0],e=n[t];if(_r(r,e)){u.lineStart();for(var a=0;t>a;++a)u.point((r=n[a])[0],r[1]);return u.lineEnd(),void 0}var c=new zr(r,n,null,!0),s=new zr(r,null,c,!1);c.o=s,i.push(c),o.push(s),c=new zr(e,n,null,!1),s=new zr(e,null,c,!0),c.o=s,i.push(c),o.push(s)}}),o.sort(t),Nr(i),Nr(o),i.length){for(var a=0,c=r,s=o.length;s>a;++a)o[a].e=c=!c;for(var l,f,h=i[0];;){for(var g=h,p=!0;g.v;)if((g=g.n)===h)return;l=g.z,u.lineStart();do{if(g.v=g.o.v=!0,g.e){if(p)for(var a=0,s=l.length;s>a;++a)u.point((f=l[a])[0],f[1]);else e(g.x,g.n.x,1,u);g=g.n}else{if(p){l=g.p.z;for(var a=l.length-1;a>=0;--a)u.point((f=l[a])[0],f[1])}else e(g.x,g.p.x,-1,u);g=g.p}g=g.o,l=g.z,p=!p}while(!g.v);u.lineEnd()}}}function Nr(n){if(t=n.length){for(var t,r,e=0,u=n[0];++e<t;)u.n=r=n[e],r.p=u,u=r;u.n=r=n[0],r.p=u}}function zr(n,t,r,e){this.x=n,this.z=t,this.o=r,this.e=e,this.v=!1,this.n=this.p=null}function Lr(n,t,r,e){return function(u,i){function o(t,r){var e=u(t,r);n(t=e[0],r=e[1])&&i.point(t,r)}function a(n,t){var r=u(n,t);d.point(r[0],r[1])}function c(){y.point=a,d.lineStart()}function s(){y.point=o,d.lineEnd()}function l(n,t){v.push([n,t]);var r=u(n,t);M.point(r[0],r[1])}function f(){M.lineStart(),v=[]}function h(){l(v[0][0],v[0][1]),M.lineEnd();var n,t=M.clean(),r=x.buffer(),e=r.length;if(v.pop(),p.push(v),v=null,e)if(1&t){n=r[0];var u,e=n.length-1,o=-1;if(e>0){for(_||(i.polygonStart(),_=!0),i.lineStart();++o<e;)i.point((u=n[o])[0],u[1]);i.lineEnd()}}else e>1&&2&t&&r.push(r.pop().concat(r.shift())),g.push(r.filter(Tr))}var g,p,v,d=t(i),m=u.invert(e[0],e[1]),y={point:o,lineStart:c,lineEnd:s,polygonStart:function(){y.point=l,y.lineStart=f,y.lineEnd=h,g=[],p=[]},polygonEnd:function(){y.point=o,y.lineStart=c,y.lineEnd=s,g=Bo.merge(g);var n=Dr(m,p);g.length?(_||(i.polygonStart(),_=!0),Cr(g,Rr,n,r,i)):n&&(_||(i.polygonStart(),_=!0),i.lineStart(),r(null,null,1,i),i.lineEnd()),_&&(i.polygonEnd(),_=!1),g=p=null},sphere:function(){i.polygonStart(),i.lineStart(),r(null,null,1,i),i.lineEnd(),i.polygonEnd()}},x=qr(),M=t(x),_=!1;return y}}function Tr(n){return n.length>1}function qr(){var n,t=[];return{lineStart:function(){t.push(n=[])},point:function(t,r){n.push([t,r])},lineEnd:v,buffer:function(){var r=t;return t=[],n=null,r},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Rr(n,t){return((n=n.x)[0]<0?n[1]-Aa-Ca:Aa-n[1])-((t=t.x)[0]<0?t[1]-Aa-Ca:Aa-t[1])}function Dr(n,t){var r=n[0],e=n[1],u=[Math.sin(r),-Math.cos(r),0],i=0,o=0;gc.reset();for(var a=0,c=t.length;c>a;++a){var s=t[a],l=s.length;if(l)for(var f=s[0],h=f[0],g=f[1]/2+ka/4,p=Math.sin(g),v=Math.cos(g),d=1;;){d===l&&(d=0),n=s[d];var m=n[0],y=n[1]/2+ka/4,x=Math.sin(y),M=Math.cos(y),_=m-h,b=_>=0?1:-1,w=b*_,S=w>ka,k=p*x;if(gc.add(Math.atan2(k*b*Math.sin(w),v*M+k*Math.cos(w))),i+=S?_+b*Ea:_,S^h>=r^m>=r){var E=dr(pr(f),pr(n));xr(E);var A=dr(u,E);xr(A);var C=(S^_>=0?-1:1)*G(A[2]);(e>C||e===C&&(E[0]||E[1]))&&(o+=S^_>=0?1:-1)}if(!d++)break;h=m,p=x,v=M,f=n}}return(-Ca>i||Ca>i&&0>gc)^1&o}function Pr(n){var t,r=0/0,e=0/0,u=0/0;return{lineStart:function(){n.lineStart(),t=1},point:function(i,o){var a=i>0?ka:-ka,c=ca(i-r);ca(c-ka)<Ca?(n.point(r,e=(e+o)/2>0?Aa:-Aa),n.point(u,e),n.lineEnd(),n.lineStart(),n.point(a,e),n.point(i,e),t=0):u!==a&&c>=ka&&(ca(r-u)<Ca&&(r-=u*Ca),ca(i-a)<Ca&&(i-=a*Ca),e=Ur(r,e,i,o),n.point(u,e),n.lineEnd(),n.lineStart(),n.point(a,e),t=0),n.point(r=i,e=o),u=a},lineEnd:function(){n.lineEnd(),r=e=0/0},clean:function(){return 2-t}}}function Ur(n,t,r,e){var u,i,o=Math.sin(n-r);return ca(o)>Ca?Math.atan((Math.sin(t)*(i=Math.cos(e))*Math.sin(r)-Math.sin(e)*(u=Math.cos(t))*Math.sin(n))/(u*i*o)):(t+e)/2}function jr(n,t,r,e){var u;if(null==n)u=r*Aa,e.point(-ka,u),e.point(0,u),e.point(ka,u),e.point(ka,0),e.point(ka,-u),e.point(0,-u),e.point(-ka,-u),e.point(-ka,0),e.point(-ka,u);else if(ca(n[0]-t[0])>Ca){var i=n[0]<t[0]?ka:-ka;u=r*i/2,e.point(-i,u),e.point(0,u),e.point(i,u)}else e.point(t[0],t[1])}function Hr(n){function t(n,t){return Math.cos(n)*Math.cos(t)>i}function r(n){var r,i,c,s,l;return{lineStart:function(){s=c=!1,l=1},point:function(f,h){var g,p=[f,h],v=t(f,h),d=o?v?0:u(f,h):v?u(f+(0>f?ka:-ka),h):0;if(!r&&(s=c=v)&&n.lineStart(),v!==c&&(g=e(r,p),(_r(r,g)||_r(p,g))&&(p[0]+=Ca,p[1]+=Ca,v=t(p[0],p[1]))),v!==c)l=0,v?(n.lineStart(),g=e(p,r),n.point(g[0],g[1])):(g=e(r,p),n.point(g[0],g[1]),n.lineEnd()),r=g;else if(a&&r&&o^v){var m;d&i||!(m=e(p,r,!0))||(l=0,o?(n.lineStart(),n.point(m[0][0],m[0][1]),n.point(m[1][0],m[1][1]),n.lineEnd()):(n.point(m[1][0],m[1][1]),n.lineEnd(),n.lineStart(),n.point(m[0][0],m[0][1])))}!v||r&&_r(r,p)||n.point(p[0],p[1]),r=p,c=v,i=d},lineEnd:function(){c&&n.lineEnd(),r=null},clean:function(){return l|(s&&c)<<1}}}function e(n,t,r){var e=pr(n),u=pr(t),o=[1,0,0],a=dr(e,u),c=vr(a,a),s=a[0],l=c-s*s;if(!l)return!r&&n;var f=i*c/l,h=-i*s/l,g=dr(o,a),p=yr(o,f),v=yr(a,h);mr(p,v);var d=g,m=vr(p,d),y=vr(d,d),x=m*m-y*(vr(p,p)-1);if(!(0>x)){var M=Math.sqrt(x),_=yr(d,(-m-M)/y);if(mr(_,p),_=Mr(_),!r)return _;var b,w=n[0],S=t[0],k=n[1],E=t[1];w>S&&(b=w,w=S,S=b);var A=S-w,C=ca(A-ka)<Ca,N=C||Ca>A;if(!C&&k>E&&(b=k,k=E,E=b),N?C?k+E>0^_[1]<(ca(_[0]-w)<Ca?k:E):k<=_[1]&&_[1]<=E:A>ka^(w<=_[0]&&_[0]<=S)){var z=yr(d,(-m+M)/y);return mr(z,p),[_,Mr(z)]}}}function u(t,r){var e=o?n:ka-n,u=0;return-e>t?u|=1:t>e&&(u|=2),-e>r?u|=4:r>e&&(u|=8),u}var i=Math.cos(n),o=i>0,a=ca(i)>Ca,c=ge(n,6*za);return Lr(t,r,c,o?[0,-n]:[-ka,n-ka])}function Fr(n,t,r,e){return function(u){var i,o=u.a,a=u.b,c=o.x,s=o.y,l=a.x,f=a.y,h=0,g=1,p=l-c,v=f-s;if(i=n-c,p||!(i>0)){if(i/=p,0>p){if(h>i)return;g>i&&(g=i)}else if(p>0){if(i>g)return;i>h&&(h=i)}if(i=r-c,p||!(0>i)){if(i/=p,0>p){if(i>g)return;i>h&&(h=i)}else if(p>0){if(h>i)return;g>i&&(g=i)}if(i=t-s,v||!(i>0)){if(i/=v,0>v){if(h>i)return;g>i&&(g=i)}else if(v>0){if(i>g)return;i>h&&(h=i)}if(i=e-s,v||!(0>i)){if(i/=v,0>v){if(i>g)return;i>h&&(h=i)}else if(v>0){if(h>i)return;g>i&&(g=i)}return h>0&&(u.a={x:c+h*p,y:s+h*v}),1>g&&(u.b={x:c+g*p,y:s+g*v}),u}}}}}}function Or(n,t,r,e){function u(e,u){return ca(e[0]-n)<Ca?u>0?0:3:ca(e[0]-r)<Ca?u>0?2:1:ca(e[1]-t)<Ca?u>0?1:0:u>0?3:2}function i(n,t){return o(n.x,t.x)}function o(n,t){var r=u(n,1),e=u(t,1);return r!==e?r-e:0===r?t[1]-n[1]:1===r?n[0]-t[0]:2===r?n[1]-t[1]:t[0]-n[0]}return function(a){function c(n){for(var t=0,r=d.length,e=n[1],u=0;r>u;++u)for(var i,o=1,a=d[u],c=a.length,s=a[0];c>o;++o)i=a[o],s[1]<=e?i[1]>e&&J(s,i,n)>0&&++t:i[1]<=e&&J(s,i,n)<0&&--t,s=i;return 0!==t}function s(i,a,c,s){var l=0,f=0;if(null==i||(l=u(i,c))!==(f=u(a,c))||o(i,a)<0^c>0){do s.point(0===l||3===l?n:r,l>1?e:t);while((l=(l+c+4)%4)!==f)}else s.point(a[0],a[1])}function l(u,i){return u>=n&&r>=u&&i>=t&&e>=i}function f(n,t){l(n,t)&&a.point(n,t)}function h(){N.point=p,d&&d.push(m=[]),S=!0,w=!1,_=b=0/0}function g(){v&&(p(y,x),M&&w&&A.rejoin(),v.push(A.buffer())),N.point=f,w&&a.lineEnd()}function p(n,t){n=Math.max(-Cc,Math.min(Cc,n)),t=Math.max(-Cc,Math.min(Cc,t));var r=l(n,t);if(d&&m.push([n,t]),S)y=n,x=t,M=r,S=!1,r&&(a.lineStart(),a.point(n,t));else if(r&&w)a.point(n,t);else{var e={a:{x:_,y:b},b:{x:n,y:t}};C(e)?(w||(a.lineStart(),a.point(e.a.x,e.a.y)),a.point(e.b.x,e.b.y),r||a.lineEnd(),k=!1):r&&(a.lineStart(),a.point(n,t),k=!1)}_=n,b=t,w=r}var v,d,m,y,x,M,_,b,w,S,k,E=a,A=qr(),C=Fr(n,t,r,e),N={point:f,lineStart:h,lineEnd:g,polygonStart:function(){a=A,v=[],d=[],k=!0},polygonEnd:function(){a=E,v=Bo.merge(v);var t=c([n,e]),r=k&&t,u=v.length;(r||u)&&(a.polygonStart(),r&&(a.lineStart(),s(null,null,1,a),a.lineEnd()),u&&Cr(v,i,t,s,a),a.polygonEnd()),v=d=m=null}};return N}}function Ir(n,t){function r(r,e){return r=n(r,e),t(r[0],r[1])}return n.invert&&t.invert&&(r.invert=function(r,e){return r=t.invert(r,e),r&&n.invert(r[0],r[1])}),r}function Yr(n){var t=0,r=ka/3,e=ie(n),u=e(t,r);return u.parallels=function(n){return arguments.length?e(t=n[0]*ka/180,r=n[1]*ka/180):[180*(t/ka),180*(r/ka)]},u}function Zr(n,t){function r(n,t){var r=Math.sqrt(i-2*u*Math.sin(t))/u;return[r*Math.sin(n*=u),o-r*Math.cos(n)]}var e=Math.sin(n),u=(e+Math.sin(t))/2,i=1+e*(2*u-e),o=Math.sqrt(i)/u;return r.invert=function(n,t){var r=o-t;return[Math.atan2(n,r)/u,G((i-(n*n+r*r)*u*u)/(2*u))]},r}function Vr(){function n(n,t){zc+=u*n-e*t,e=n,u=t}var t,r,e,u;Dc.point=function(i,o){Dc.point=n,t=e=i,r=u=o},Dc.lineEnd=function(){n(t,r)}}function $r(n,t){Lc>n&&(Lc=n),n>qc&&(qc=n),Tc>t&&(Tc=t),t>Rc&&(Rc=t)}function Xr(){function n(n,t){o.push("M",n,",",t,i)}function t(n,t){o.push("M",n,",",t),a.point=r}function r(n,t){o.push("L",n,",",t)}function e(){a.point=n}function u(){o.push("Z")}var i=Br(4.5),o=[],a={point:n,lineStart:function(){a.point=t},lineEnd:e,polygonStart:function(){a.lineEnd=u},polygonEnd:function(){a.lineEnd=e,a.point=n},pointRadius:function(n){return i=Br(n),a},result:function(){if(o.length){var n=o.join("");return o=[],n}}};return a}function Br(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function Jr(n,t){mc+=n,yc+=t,++xc}function Wr(){function n(n,e){var u=n-t,i=e-r,o=Math.sqrt(u*u+i*i);Mc+=o*(t+n)/2,_c+=o*(r+e)/2,bc+=o,Jr(t=n,r=e)}var t,r;Uc.point=function(e,u){Uc.point=n,Jr(t=e,r=u)}}function Gr(){Uc.point=Jr}function Kr(){function n(n,t){var r=n-e,i=t-u,o=Math.sqrt(r*r+i*i);Mc+=o*(e+n)/2,_c+=o*(u+t)/2,bc+=o,o=u*n-e*t,wc+=o*(e+n),Sc+=o*(u+t),kc+=3*o,Jr(e=n,u=t)}var t,r,e,u;Uc.point=function(i,o){Uc.point=n,Jr(t=e=i,r=u=o)},Uc.lineEnd=function(){n(t,r)}}function Qr(n){function t(t,r){n.moveTo(t,r),n.arc(t,r,o,0,Ea)}function r(t,r){n.moveTo(t,r),a.point=e}function e(t,r){n.lineTo(t,r)}function u(){a.point=t}function i(){n.closePath()}var o=4.5,a={point:t,lineStart:function(){a.point=r},lineEnd:u,polygonStart:function(){a.lineEnd=i},polygonEnd:function(){a.lineEnd=u,a.point=t},pointRadius:function(n){return o=n,a},result:v};return a}function ne(n){function t(n){return(a?e:r)(n)}function r(t){return ee(t,function(r,e){r=n(r,e),t.point(r[0],r[1])})}function e(t){function r(r,e){r=n(r,e),t.point(r[0],r[1])}function e(){x=0/0,S.point=i,t.lineStart()}function i(r,e){var i=pr([r,e]),o=n(r,e);u(x,M,y,_,b,w,x=o[0],M=o[1],y=r,_=i[0],b=i[1],w=i[2],a,t),t.point(x,M)}function o(){S.point=r,t.lineEnd()}function c(){e(),S.point=s,S.lineEnd=l}function s(n,t){i(f=n,h=t),g=x,p=M,v=_,d=b,m=w,S.point=i}function l(){u(x,M,y,_,b,w,g,p,f,v,d,m,a,t),S.lineEnd=o,o()}var f,h,g,p,v,d,m,y,x,M,_,b,w,S={point:r,lineStart:e,lineEnd:o,polygonStart:function(){t.polygonStart(),S.lineStart=c},polygonEnd:function(){t.polygonEnd(),S.lineStart=e}};return S}function u(t,r,e,a,c,s,l,f,h,g,p,v,d,m){var y=l-t,x=f-r,M=y*y+x*x;if(M>4*i&&d--){var _=a+g,b=c+p,w=s+v,S=Math.sqrt(_*_+b*b+w*w),k=Math.asin(w/=S),E=ca(ca(w)-1)<Ca||ca(e-h)<Ca?(e+h)/2:Math.atan2(b,_),A=n(E,k),C=A[0],N=A[1],z=C-t,L=N-r,T=x*z-y*L;(T*T/M>i||ca((y*z+x*L)/M-.5)>.3||o>a*g+c*p+s*v)&&(u(t,r,e,a,c,s,C,N,E,_/=S,b/=S,w,d,m),m.point(C,N),u(C,N,E,_,b,w,l,f,h,g,p,v,d,m))}}var i=.5,o=Math.cos(30*za),a=16;return t.precision=function(n){return arguments.length?(a=(i=n*n)>0&&16,t):Math.sqrt(i)},t}function te(n){var t=ne(function(t,r){return n([t*La,r*La])});return function(n){return oe(t(n))}}function re(n){this.stream=n}function ee(n,t){return{point:t,sphere:function(){n.sphere()},lineStart:function(){n.lineStart()},lineEnd:function(){n.lineEnd()},polygonStart:function(){n.polygonStart()},polygonEnd:function(){n.polygonEnd()}}}function ue(n){return ie(function(){return n})()}function ie(n){function t(n){return n=a(n[0]*za,n[1]*za),[n[0]*h+c,s-n[1]*h]}function r(n){return n=a.invert((n[0]-c)/h,(s-n[1])/h),n&&[n[0]*La,n[1]*La]}function e(){a=Ir(o=se(m,y,x),i);var n=i(v,d);return c=g-n[0]*h,s=p+n[1]*h,u()
}function u(){return l&&(l.valid=!1,l=null),t}var i,o,a,c,s,l,f=ne(function(n,t){return n=i(n,t),[n[0]*h+c,s-n[1]*h]}),h=150,g=480,p=250,v=0,d=0,m=0,y=0,x=0,M=Ac,_=At,b=null,w=null;return t.stream=function(n){return l&&(l.valid=!1),l=oe(M(o,f(_(n)))),l.valid=!0,l},t.clipAngle=function(n){return arguments.length?(M=null==n?(b=n,Ac):Hr((b=+n)*za),u()):b},t.clipExtent=function(n){return arguments.length?(w=n,_=n?Or(n[0][0],n[0][1],n[1][0],n[1][1]):At,u()):w},t.scale=function(n){return arguments.length?(h=+n,e()):h},t.translate=function(n){return arguments.length?(g=+n[0],p=+n[1],e()):[g,p]},t.center=function(n){return arguments.length?(v=n[0]%360*za,d=n[1]%360*za,e()):[v*La,d*La]},t.rotate=function(n){return arguments.length?(m=n[0]%360*za,y=n[1]%360*za,x=n.length>2?n[2]%360*za:0,e()):[m*La,y*La,x*La]},Bo.rebind(t,f,"precision"),function(){return i=n.apply(this,arguments),t.invert=i.invert&&r,e()}}function oe(n){return ee(n,function(t,r){n.point(t*za,r*za)})}function ae(n,t){return[n,t]}function ce(n,t){return[n>ka?n-Ea:-ka>n?n+Ea:n,t]}function se(n,t,r){return n?t||r?Ir(fe(n),he(t,r)):fe(n):t||r?he(t,r):ce}function le(n){return function(t,r){return t+=n,[t>ka?t-Ea:-ka>t?t+Ea:t,r]}}function fe(n){var t=le(n);return t.invert=le(-n),t}function he(n,t){function r(n,t){var r=Math.cos(t),a=Math.cos(n)*r,c=Math.sin(n)*r,s=Math.sin(t),l=s*e+a*u;return[Math.atan2(c*i-l*o,a*e-s*u),G(l*i+c*o)]}var e=Math.cos(n),u=Math.sin(n),i=Math.cos(t),o=Math.sin(t);return r.invert=function(n,t){var r=Math.cos(t),a=Math.cos(n)*r,c=Math.sin(n)*r,s=Math.sin(t),l=s*i-c*o;return[Math.atan2(c*i+s*o,a*e+l*u),G(l*e-a*u)]},r}function ge(n,t){var r=Math.cos(n),e=Math.sin(n);return function(u,i,o,a){var c=o*t;null!=u?(u=pe(r,u),i=pe(r,i),(o>0?i>u:u>i)&&(u+=o*Ea)):(u=n+o*Ea,i=n-.5*c);for(var s,l=u;o>0?l>i:i>l;l-=c)a.point((s=Mr([r,-e*Math.cos(l),-e*Math.sin(l)]))[0],s[1])}}function pe(n,t){var r=pr(t);r[0]-=n,xr(r);var e=W(-r[1]);return((-r[2]<0?-e:e)+2*Math.PI-Ca)%(2*Math.PI)}function ve(n,t,r){var e=Bo.range(n,t-Ca,r).concat(t);return function(n){return e.map(function(t){return[n,t]})}}function de(n,t,r){var e=Bo.range(n,t-Ca,r).concat(t);return function(n){return e.map(function(t){return[t,n]})}}function me(n){return n.source}function ye(n){return n.target}function xe(n,t,r,e){var u=Math.cos(t),i=Math.sin(t),o=Math.cos(e),a=Math.sin(e),c=u*Math.cos(n),s=u*Math.sin(n),l=o*Math.cos(r),f=o*Math.sin(r),h=2*Math.asin(Math.sqrt(tt(e-t)+u*o*tt(r-n))),g=1/Math.sin(h),p=h?function(n){var t=Math.sin(n*=h)*g,r=Math.sin(h-n)*g,e=r*c+t*l,u=r*s+t*f,o=r*i+t*a;return[Math.atan2(u,e)*La,Math.atan2(o,Math.sqrt(e*e+u*u))*La]}:function(){return[n*La,t*La]};return p.distance=h,p}function Me(){function n(n,u){var i=Math.sin(u*=za),o=Math.cos(u),a=ca((n*=za)-t),c=Math.cos(a);jc+=Math.atan2(Math.sqrt((a=o*Math.sin(a))*a+(a=e*i-r*o*c)*a),r*i+e*o*c),t=n,r=i,e=o}var t,r,e;Hc.point=function(u,i){t=u*za,r=Math.sin(i*=za),e=Math.cos(i),Hc.point=n},Hc.lineEnd=function(){Hc.point=Hc.lineEnd=v}}function _e(n,t){function r(t,r){var e=Math.cos(t),u=Math.cos(r),i=n(e*u);return[i*u*Math.sin(t),i*Math.sin(r)]}return r.invert=function(n,r){var e=Math.sqrt(n*n+r*r),u=t(e),i=Math.sin(u),o=Math.cos(u);return[Math.atan2(n*i,e*o),Math.asin(e&&r*i/e)]},r}function be(n,t){function r(n,t){o>0?-Aa+Ca>t&&(t=-Aa+Ca):t>Aa-Ca&&(t=Aa-Ca);var r=o/Math.pow(u(t),i);return[r*Math.sin(i*n),o-r*Math.cos(i*n)]}var e=Math.cos(n),u=function(n){return Math.tan(ka/4+n/2)},i=n===t?Math.sin(n):Math.log(e/Math.cos(t))/Math.log(u(t)/u(n)),o=e*Math.pow(u(n),i)/i;return i?(r.invert=function(n,t){var r=o-t,e=B(i)*Math.sqrt(n*n+r*r);return[Math.atan2(n,r)/i,2*Math.atan(Math.pow(o/e,1/i))-Aa]},r):Se}function we(n,t){function r(n,t){var r=i-t;return[r*Math.sin(u*n),i-r*Math.cos(u*n)]}var e=Math.cos(n),u=n===t?Math.sin(n):(e-Math.cos(t))/(t-n),i=e/u+n;return ca(u)<Ca?ae:(r.invert=function(n,t){var r=i-t;return[Math.atan2(n,r)/u,i-B(u)*Math.sqrt(n*n+r*r)]},r)}function Se(n,t){return[n,Math.log(Math.tan(ka/4+t/2))]}function ke(n){var t,r=ue(n),e=r.scale,u=r.translate,i=r.clipExtent;return r.scale=function(){var n=e.apply(r,arguments);return n===r?t?r.clipExtent(null):r:n},r.translate=function(){var n=u.apply(r,arguments);return n===r?t?r.clipExtent(null):r:n},r.clipExtent=function(n){var o=i.apply(r,arguments);if(o===r){if(t=null==n){var a=ka*e(),c=u();i([[c[0]-a,c[1]-a],[c[0]+a,c[1]+a]])}}else t&&(o=null);return o},r.clipExtent(null)}function Ee(n,t){return[Math.log(Math.tan(ka/4+t/2)),-n]}function Ae(n){return n[0]}function Ce(n){return n[1]}function Ne(n){for(var t=n.length,r=[0,1],e=2,u=2;t>u;u++){for(;e>1&&J(n[r[e-2]],n[r[e-1]],n[u])<=0;)--e;r[e++]=u}return r.slice(0,e)}function ze(n,t){return n[0]-t[0]||n[1]-t[1]}function Le(n,t,r){return(r[0]-t[0])*(n[1]-t[1])<(r[1]-t[1])*(n[0]-t[0])}function Te(n,t,r,e){var u=n[0],i=r[0],o=t[0]-u,a=e[0]-i,c=n[1],s=r[1],l=t[1]-c,f=e[1]-s,h=(a*(c-s)-f*(u-i))/(f*o-a*l);return[u+h*o,c+h*l]}function qe(n){var t=n[0],r=n[n.length-1];return!(t[0]-r[0]||t[1]-r[1])}function Re(){tu(this),this.edge=this.site=this.circle=null}function De(n){var t=Gc.pop()||new Re;return t.site=n,t}function Pe(n){$e(n),Bc.remove(n),Gc.push(n),tu(n)}function Ue(n){var t=n.circle,r=t.x,e=t.cy,u={x:r,y:e},i=n.P,o=n.N,a=[n];Pe(n);for(var c=i;c.circle&&ca(r-c.circle.x)<Ca&&ca(e-c.circle.cy)<Ca;)i=c.P,a.unshift(c),Pe(c),c=i;a.unshift(c),$e(c);for(var s=o;s.circle&&ca(r-s.circle.x)<Ca&&ca(e-s.circle.cy)<Ca;)o=s.N,a.push(s),Pe(s),s=o;a.push(s),$e(s);var l,f=a.length;for(l=1;f>l;++l)s=a[l],c=a[l-1],Ke(s.edge,c.site,s.site,u);c=a[0],s=a[f-1],s.edge=We(c.site,s.site,null,u),Ve(c),Ve(s)}function je(n){for(var t,r,e,u,i=n.x,o=n.y,a=Bc._;a;)if(e=He(a,o)-i,e>Ca)a=a.L;else{if(u=i-Fe(a,o),!(u>Ca)){e>-Ca?(t=a.P,r=a):u>-Ca?(t=a,r=a.N):t=r=a;break}if(!a.R){t=a;break}a=a.R}var c=De(n);if(Bc.insert(t,c),t||r){if(t===r)return $e(t),r=De(t.site),Bc.insert(c,r),c.edge=r.edge=We(t.site,c.site),Ve(t),Ve(r),void 0;if(!r)return c.edge=We(t.site,c.site),void 0;$e(t),$e(r);var s=t.site,l=s.x,f=s.y,h=n.x-l,g=n.y-f,p=r.site,v=p.x-l,d=p.y-f,m=2*(h*d-g*v),y=h*h+g*g,x=v*v+d*d,M={x:(d*y-g*x)/m+l,y:(h*x-v*y)/m+f};Ke(r.edge,s,p,M),c.edge=We(s,n,null,M),r.edge=We(n,p,null,M),Ve(t),Ve(r)}}function He(n,t){var r=n.site,e=r.x,u=r.y,i=u-t;if(!i)return e;var o=n.P;if(!o)return-1/0;r=o.site;var a=r.x,c=r.y,s=c-t;if(!s)return a;var l=a-e,f=1/i-1/s,h=l/s;return f?(-h+Math.sqrt(h*h-2*f*(l*l/(-2*s)-c+s/2+u-i/2)))/f+e:(e+a)/2}function Fe(n,t){var r=n.N;if(r)return He(r,t);var e=n.site;return e.y===t?e.x:1/0}function Oe(n){this.site=n,this.edges=[]}function Ie(n){for(var t,r,e,u,i,o,a,c,s,l,f=n[0][0],h=n[1][0],g=n[0][1],p=n[1][1],v=Xc,d=v.length;d--;)if(i=v[d],i&&i.prepare())for(a=i.edges,c=a.length,o=0;c>o;)l=a[o].end(),e=l.x,u=l.y,s=a[++o%c].start(),t=s.x,r=s.y,(ca(e-t)>Ca||ca(u-r)>Ca)&&(a.splice(o,0,new Qe(Ge(i.site,l,ca(e-f)<Ca&&p-u>Ca?{x:f,y:ca(t-f)<Ca?r:p}:ca(u-p)<Ca&&h-e>Ca?{x:ca(r-p)<Ca?t:h,y:p}:ca(e-h)<Ca&&u-g>Ca?{x:h,y:ca(t-h)<Ca?r:g}:ca(u-g)<Ca&&e-f>Ca?{x:ca(r-g)<Ca?t:f,y:g}:null),i.site,null)),++c)}function Ye(n,t){return t.angle-n.angle}function Ze(){tu(this),this.x=this.y=this.arc=this.site=this.cy=null}function Ve(n){var t=n.P,r=n.N;if(t&&r){var e=t.site,u=n.site,i=r.site;if(e!==i){var o=u.x,a=u.y,c=e.x-o,s=e.y-a,l=i.x-o,f=i.y-a,h=2*(c*f-s*l);if(!(h>=-Na)){var g=c*c+s*s,p=l*l+f*f,v=(f*g-s*p)/h,d=(c*p-l*g)/h,f=d+a,m=Kc.pop()||new Ze;m.arc=n,m.site=u,m.x=v+o,m.y=f+Math.sqrt(v*v+d*d),m.cy=f,n.circle=m;for(var y=null,x=Wc._;x;)if(m.y<x.y||m.y===x.y&&m.x<=x.x){if(!x.L){y=x.P;break}x=x.L}else{if(!x.R){y=x;break}x=x.R}Wc.insert(y,m),y||(Jc=m)}}}}function $e(n){var t=n.circle;t&&(t.P||(Jc=t.N),Wc.remove(t),Kc.push(t),tu(t),n.circle=null)}function Xe(n){for(var t,r=$c,e=Fr(n[0][0],n[0][1],n[1][0],n[1][1]),u=r.length;u--;)t=r[u],(!Be(t,n)||!e(t)||ca(t.a.x-t.b.x)<Ca&&ca(t.a.y-t.b.y)<Ca)&&(t.a=t.b=null,r.splice(u,1))}function Be(n,t){var r=n.b;if(r)return!0;var e,u,i=n.a,o=t[0][0],a=t[1][0],c=t[0][1],s=t[1][1],l=n.l,f=n.r,h=l.x,g=l.y,p=f.x,v=f.y,d=(h+p)/2,m=(g+v)/2;if(v===g){if(o>d||d>=a)return;if(h>p){if(i){if(i.y>=s)return}else i={x:d,y:c};r={x:d,y:s}}else{if(i){if(i.y<c)return}else i={x:d,y:s};r={x:d,y:c}}}else if(e=(h-p)/(v-g),u=m-e*d,-1>e||e>1)if(h>p){if(i){if(i.y>=s)return}else i={x:(c-u)/e,y:c};r={x:(s-u)/e,y:s}}else{if(i){if(i.y<c)return}else i={x:(s-u)/e,y:s};r={x:(c-u)/e,y:c}}else if(v>g){if(i){if(i.x>=a)return}else i={x:o,y:e*o+u};r={x:a,y:e*a+u}}else{if(i){if(i.x<o)return}else i={x:a,y:e*a+u};r={x:o,y:e*o+u}}return n.a=i,n.b=r,!0}function Je(n,t){this.l=n,this.r=t,this.a=this.b=null}function We(n,t,r,e){var u=new Je(n,t);return $c.push(u),r&&Ke(u,n,t,r),e&&Ke(u,t,n,e),Xc[n.i].edges.push(new Qe(u,n,t)),Xc[t.i].edges.push(new Qe(u,t,n)),u}function Ge(n,t,r){var e=new Je(n,null);return e.a=t,e.b=r,$c.push(e),e}function Ke(n,t,r,e){n.a||n.b?n.l===r?n.b=e:n.a=e:(n.a=e,n.l=t,n.r=r)}function Qe(n,t,r){var e=n.a,u=n.b;this.edge=n,this.site=t,this.angle=r?Math.atan2(r.y-t.y,r.x-t.x):n.l===t?Math.atan2(u.x-e.x,e.y-u.y):Math.atan2(e.x-u.x,u.y-e.y)}function nu(){this._=null}function tu(n){n.U=n.C=n.L=n.R=n.P=n.N=null}function ru(n,t){var r=t,e=t.R,u=r.U;u?u.L===r?u.L=e:u.R=e:n._=e,e.U=u,r.U=e,r.R=e.L,r.R&&(r.R.U=r),e.L=r}function eu(n,t){var r=t,e=t.L,u=r.U;u?u.L===r?u.L=e:u.R=e:n._=e,e.U=u,r.U=e,r.L=e.R,r.L&&(r.L.U=r),e.R=r}function uu(n){for(;n.L;)n=n.L;return n}function iu(n,t){var r,e,u,i=n.sort(ou).pop();for($c=[],Xc=new Array(n.length),Bc=new nu,Wc=new nu;;)if(u=Jc,i&&(!u||i.y<u.y||i.y===u.y&&i.x<u.x))(i.x!==r||i.y!==e)&&(Xc[i.i]=new Oe(i),je(i),r=i.x,e=i.y),i=n.pop();else{if(!u)break;Ue(u.arc)}t&&(Xe(t),Ie(t));var o={cells:Xc,edges:$c};return Bc=Wc=$c=Xc=null,o}function ou(n,t){return t.y-n.y||t.x-n.x}function au(n,t,r){return(n.x-r.x)*(t.y-n.y)-(n.x-t.x)*(r.y-n.y)}function cu(n){return n.x}function su(n){return n.y}function lu(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function fu(n,t,r,e,u,i){if(!n(t,r,e,u,i)){var o=.5*(r+u),a=.5*(e+i),c=t.nodes;c[0]&&fu(n,c[0],r,e,o,a),c[1]&&fu(n,c[1],o,e,u,a),c[2]&&fu(n,c[2],r,a,o,i),c[3]&&fu(n,c[3],o,a,u,i)}}function hu(n,t){n=Bo.rgb(n),t=Bo.rgb(t);var r=n.r,e=n.g,u=n.b,i=t.r-r,o=t.g-e,a=t.b-u;return function(n){return"#"+Mt(Math.round(r+i*n))+Mt(Math.round(e+o*n))+Mt(Math.round(u+a*n))}}function gu(n,t){var r,e={},u={};for(r in n)r in t?e[r]=du(n[r],t[r]):u[r]=n[r];for(r in t)r in n||(u[r]=t[r]);return function(n){for(r in e)u[r]=e[r](n);return u}}function pu(n,t){return t-=n=+n,function(r){return n+t*r}}function vu(n,t){var r,e,u,i=ns.lastIndex=ts.lastIndex=0,o=-1,a=[],c=[];for(n+="",t+="";(r=ns.exec(n))&&(e=ts.exec(t));)(u=e.index)>i&&(u=t.substring(i,u),a[o]?a[o]+=u:a[++o]=u),(r=r[0])===(e=e[0])?a[o]?a[o]+=e:a[++o]=e:(a[++o]=null,c.push({i:o,x:pu(r,e)})),i=ts.lastIndex;return i<t.length&&(u=t.substring(i),a[o]?a[o]+=u:a[++o]=u),a.length<2?c[0]?(t=c[0].x,function(n){return t(n)+""}):function(){return t}:(t=c.length,function(n){for(var r,e=0;t>e;++e)a[(r=c[e]).i]=r.x(n);return a.join("")})}function du(n,t){for(var r,e=Bo.interpolators.length;--e>=0&&!(r=Bo.interpolators[e](n,t)););return r}function mu(n,t){var r,e=[],u=[],i=n.length,o=t.length,a=Math.min(n.length,t.length);for(r=0;a>r;++r)e.push(du(n[r],t[r]));for(;i>r;++r)u[r]=n[r];for(;o>r;++r)u[r]=t[r];return function(n){for(r=0;a>r;++r)u[r]=e[r](n);return u}}function yu(n){return function(t){return 0>=t?0:t>=1?1:n(t)}}function xu(n){return function(t){return 1-n(1-t)}}function Mu(n){return function(t){return.5*(.5>t?n(2*t):2-n(2-2*t))}}function _u(n){return n*n}function bu(n){return n*n*n}function wu(n){if(0>=n)return 0;if(n>=1)return 1;var t=n*n,r=t*n;return 4*(.5>n?r:3*(n-t)+r-.75)}function Su(n){return function(t){return Math.pow(t,n)}}function ku(n){return 1-Math.cos(n*Aa)}function Eu(n){return Math.pow(2,10*(n-1))}function Au(n){return 1-Math.sqrt(1-n*n)}function Cu(n,t){var r;return arguments.length<2&&(t=.45),arguments.length?r=t/Ea*Math.asin(1/n):(n=1,r=t/4),function(e){return 1+n*Math.pow(2,-10*e)*Math.sin((e-r)*Ea/t)}}function Nu(n){return n||(n=1.70158),function(t){return t*t*((n+1)*t-n)}}function zu(n){return 1/2.75>n?7.5625*n*n:2/2.75>n?7.5625*(n-=1.5/2.75)*n+.75:2.5/2.75>n?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375}function Lu(n,t){n=Bo.hcl(n),t=Bo.hcl(t);var r=n.h,e=n.c,u=n.l,i=t.h-r,o=t.c-e,a=t.l-u;return isNaN(o)&&(o=0,e=isNaN(e)?t.c:e),isNaN(i)?(i=0,r=isNaN(r)?t.h:r):i>180?i-=360:-180>i&&(i+=360),function(n){return ct(r+i*n,e+o*n,u+a*n)+""}}function Tu(n,t){n=Bo.hsl(n),t=Bo.hsl(t);var r=n.h,e=n.s,u=n.l,i=t.h-r,o=t.s-e,a=t.l-u;return isNaN(o)&&(o=0,e=isNaN(e)?t.s:e),isNaN(i)?(i=0,r=isNaN(r)?t.h:r):i>180?i-=360:-180>i&&(i+=360),function(n){return it(r+i*n,e+o*n,u+a*n)+""}}function qu(n,t){n=Bo.lab(n),t=Bo.lab(t);var r=n.l,e=n.a,u=n.b,i=t.l-r,o=t.a-e,a=t.b-u;return function(n){return ft(r+i*n,e+o*n,u+a*n)+""}}function Ru(n,t){return t-=n,function(r){return Math.round(n+t*r)}}function Du(n){var t=[n.a,n.b],r=[n.c,n.d],e=Uu(t),u=Pu(t,r),i=Uu(ju(r,t,-u))||0;t[0]*r[1]<r[0]*t[1]&&(t[0]*=-1,t[1]*=-1,e*=-1,u*=-1),this.rotate=(e?Math.atan2(t[1],t[0]):Math.atan2(-r[0],r[1]))*La,this.translate=[n.e,n.f],this.scale=[e,i],this.skew=i?Math.atan2(u,i)*La:0}function Pu(n,t){return n[0]*t[0]+n[1]*t[1]}function Uu(n){var t=Math.sqrt(Pu(n,n));return t&&(n[0]/=t,n[1]/=t),t}function ju(n,t,r){return n[0]+=r*t[0],n[1]+=r*t[1],n}function Hu(n,t){var r,e=[],u=[],i=Bo.transform(n),o=Bo.transform(t),a=i.translate,c=o.translate,s=i.rotate,l=o.rotate,f=i.skew,h=o.skew,g=i.scale,p=o.scale;return a[0]!=c[0]||a[1]!=c[1]?(e.push("translate(",null,",",null,")"),u.push({i:1,x:pu(a[0],c[0])},{i:3,x:pu(a[1],c[1])})):c[0]||c[1]?e.push("translate("+c+")"):e.push(""),s!=l?(s-l>180?l+=360:l-s>180&&(s+=360),u.push({i:e.push(e.pop()+"rotate(",null,")")-2,x:pu(s,l)})):l&&e.push(e.pop()+"rotate("+l+")"),f!=h?u.push({i:e.push(e.pop()+"skewX(",null,")")-2,x:pu(f,h)}):h&&e.push(e.pop()+"skewX("+h+")"),g[0]!=p[0]||g[1]!=p[1]?(r=e.push(e.pop()+"scale(",null,",",null,")"),u.push({i:r-4,x:pu(g[0],p[0])},{i:r-2,x:pu(g[1],p[1])})):(1!=p[0]||1!=p[1])&&e.push(e.pop()+"scale("+p+")"),r=u.length,function(n){for(var t,i=-1;++i<r;)e[(t=u[i]).i]=t.x(n);return e.join("")}}function Fu(n,t){return t=t-(n=+n)?1/(t-n):0,function(r){return(r-n)*t}}function Ou(n,t){return t=t-(n=+n)?1/(t-n):0,function(r){return Math.max(0,Math.min(1,(r-n)*t))}}function Iu(n){for(var t=n.source,r=n.target,e=Zu(t,r),u=[t];t!==e;)t=t.parent,u.push(t);for(var i=u.length;r!==e;)u.splice(i,0,r),r=r.parent;return u}function Yu(n){for(var t=[],r=n.parent;null!=r;)t.push(n),n=r,r=r.parent;return t.push(n),t}function Zu(n,t){if(n===t)return n;for(var r=Yu(n),e=Yu(t),u=r.pop(),i=e.pop(),o=null;u===i;)o=u,u=r.pop(),i=e.pop();return o}function Vu(n){n.fixed|=2}function $u(n){n.fixed&=-7}function Xu(n){n.fixed|=4,n.px=n.x,n.py=n.y}function Bu(n){n.fixed&=-5}function Ju(n,t,r){var e=0,u=0;if(n.charge=0,!n.leaf)for(var i,o=n.nodes,a=o.length,c=-1;++c<a;)i=o[c],null!=i&&(Ju(i,t,r),n.charge+=i.charge,e+=i.charge*i.cx,u+=i.charge*i.cy);if(n.point){n.leaf||(n.point.x+=Math.random()-.5,n.point.y+=Math.random()-.5);var s=t*r[n.point.index];n.charge+=n.pointCharge=s,e+=s*n.point.x,u+=s*n.point.y}n.cx=e/n.charge,n.cy=u/n.charge}function Wu(n,t){return Bo.rebind(n,t,"sort","children","value"),n.nodes=n,n.links=ri,n}function Gu(n,t){for(var r=[n];null!=(n=r.pop());)if(t(n),(u=n.children)&&(e=u.length))for(var e,u;--e>=0;)r.push(u[e])}function Ku(n,t){for(var r=[n],e=[];null!=(n=r.pop());)if(e.push(n),(i=n.children)&&(u=i.length))for(var u,i,o=-1;++o<u;)r.push(i[o]);for(;null!=(n=e.pop());)t(n)}function Qu(n){return n.children}function ni(n){return n.value}function ti(n,t){return t.value-n.value}function ri(n){return Bo.merge(n.map(function(n){return(n.children||[]).map(function(t){return{source:n,target:t}})}))}function ei(n){return n.x}function ui(n){return n.y}function ii(n,t,r){n.y0=t,n.y=r}function oi(n){return Bo.range(n.length)}function ai(n){for(var t=-1,r=n[0].length,e=[];++t<r;)e[t]=0;return e}function ci(n){for(var t,r=1,e=0,u=n[0][1],i=n.length;i>r;++r)(t=n[r][1])>u&&(e=r,u=t);return e}function si(n){return n.reduce(li,0)}function li(n,t){return n+t[1]}function fi(n,t){return hi(n,Math.ceil(Math.log(t.length)/Math.LN2+1))}function hi(n,t){for(var r=-1,e=+n[0],u=(n[1]-e)/t,i=[];++r<=t;)i[r]=u*r+e;return i}function gi(n){return[Bo.min(n),Bo.max(n)]}function pi(n,t){return n.value-t.value}function vi(n,t){var r=n._pack_next;n._pack_next=t,t._pack_prev=n,t._pack_next=r,r._pack_prev=t}function di(n,t){n._pack_next=t,t._pack_prev=n}function mi(n,t){var r=t.x-n.x,e=t.y-n.y,u=n.r+t.r;return.999*u*u>r*r+e*e}function yi(n){function t(n){l=Math.min(n.x-n.r,l),f=Math.max(n.x+n.r,f),h=Math.min(n.y-n.r,h),g=Math.max(n.y+n.r,g)}if((r=n.children)&&(s=r.length)){var r,e,u,i,o,a,c,s,l=1/0,f=-1/0,h=1/0,g=-1/0;if(r.forEach(xi),e=r[0],e.x=-e.r,e.y=0,t(e),s>1&&(u=r[1],u.x=u.r,u.y=0,t(u),s>2))for(i=r[2],bi(e,u,i),t(i),vi(e,i),e._pack_prev=i,vi(i,u),u=e._pack_next,o=3;s>o;o++){bi(e,u,i=r[o]);var p=0,v=1,d=1;for(a=u._pack_next;a!==u;a=a._pack_next,v++)if(mi(a,i)){p=1;break}if(1==p)for(c=e._pack_prev;c!==a._pack_prev&&!mi(c,i);c=c._pack_prev,d++);p?(d>v||v==d&&u.r<e.r?di(e,u=a):di(e=c,u),o--):(vi(e,i),u=i,t(i))}var m=(l+f)/2,y=(h+g)/2,x=0;for(o=0;s>o;o++)i=r[o],i.x-=m,i.y-=y,x=Math.max(x,i.r+Math.sqrt(i.x*i.x+i.y*i.y));n.r=x,r.forEach(Mi)}}function xi(n){n._pack_next=n._pack_prev=n}function Mi(n){delete n._pack_next,delete n._pack_prev}function _i(n,t,r,e){var u=n.children;if(n.x=t+=e*n.x,n.y=r+=e*n.y,n.r*=e,u)for(var i=-1,o=u.length;++i<o;)_i(u[i],t,r,e)}function bi(n,t,r){var e=n.r+r.r,u=t.x-n.x,i=t.y-n.y;if(e&&(u||i)){var o=t.r+r.r,a=u*u+i*i;o*=o,e*=e;var c=.5+(e-o)/(2*a),s=Math.sqrt(Math.max(0,2*o*(e+a)-(e-=a)*e-o*o))/(2*a);r.x=n.x+c*u+s*i,r.y=n.y+c*i-s*u}else r.x=n.x+e,r.y=n.y}function wi(n,t){return n.parent==t.parent?1:2}function Si(n){var t=n.children;return t.length?t[0]:n.t}function ki(n){var t,r=n.children;return(t=r.length)?r[t-1]:n.t}function Ei(n,t,r){var e=r/(t.i-n.i);t.c-=e,t.s+=r,n.c+=e,t.z+=r,t.m+=r}function Ai(n){for(var t,r=0,e=0,u=n.children,i=u.length;--i>=0;)t=u[i],t.z+=r,t.m+=r,r+=t.s+(e+=t.c)}function Ci(n,t,r){return n.a.parent===t.parent?n.a:r}function Ni(n){return 1+Bo.max(n,function(n){return n.y})}function zi(n){return n.reduce(function(n,t){return n+t.x},0)/n.length}function Li(n){var t=n.children;return t&&t.length?Li(t[0]):n}function Ti(n){var t,r=n.children;return r&&(t=r.length)?Ti(r[t-1]):n}function qi(n){return{x:n.x,y:n.y,dx:n.dx,dy:n.dy}}function Ri(n,t){var r=n.x+t[3],e=n.y+t[0],u=n.dx-t[1]-t[3],i=n.dy-t[0]-t[2];return 0>u&&(r+=u/2,u=0),0>i&&(e+=i/2,i=0),{x:r,y:e,dx:u,dy:i}}function Di(n){var t=n[0],r=n[n.length-1];return r>t?[t,r]:[r,t]}function Pi(n){return n.rangeExtent?n.rangeExtent():Di(n.range())}function Ui(n,t,r,e){var u=r(n[0],n[1]),i=e(t[0],t[1]);return function(n){return i(u(n))}}function ji(n,t){var r,e=0,u=n.length-1,i=n[e],o=n[u];return i>o&&(r=e,e=u,u=r,r=i,i=o,o=r),n[e]=t.floor(i),n[u]=t.ceil(o),n}function Hi(n){return n?{floor:function(t){return Math.floor(t/n)*n},ceil:function(t){return Math.ceil(t/n)*n}}:hs}function Fi(n,t,r,e){var u=[],i=[],o=0,a=Math.min(n.length,t.length)-1;for(n[a]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<=a;)u.push(r(n[o-1],n[o])),i.push(e(t[o-1],t[o]));return function(t){var r=Bo.bisect(n,t,1,a)-1;return i[r](u[r](t))}}function Oi(n,t,r,e){function u(){var u=Math.min(n.length,t.length)>2?Fi:Ui,c=e?Ou:Fu;return o=u(n,t,c,r),a=u(t,n,c,du),i}function i(n){return o(n)}var o,a;return i.invert=function(n){return a(n)},i.domain=function(t){return arguments.length?(n=t.map(Number),u()):n},i.range=function(n){return arguments.length?(t=n,u()):t},i.rangeRound=function(n){return i.range(n).interpolate(Ru)},i.clamp=function(n){return arguments.length?(e=n,u()):e},i.interpolate=function(n){return arguments.length?(r=n,u()):r},i.ticks=function(t){return Vi(n,t)},i.tickFormat=function(t,r){return $i(n,t,r)},i.nice=function(t){return Yi(n,t),u()},i.copy=function(){return Oi(n,t,r,e)},u()}function Ii(n,t){return Bo.rebind(n,t,"range","rangeRound","interpolate","clamp")}function Yi(n,t){return ji(n,Hi(Zi(n,t)[2]))}function Zi(n,t){null==t&&(t=10);var r=Di(n),e=r[1]-r[0],u=Math.pow(10,Math.floor(Math.log(e/t)/Math.LN10)),i=t/e*u;return.15>=i?u*=10:.35>=i?u*=5:.75>=i&&(u*=2),r[0]=Math.ceil(r[0]/u)*u,r[1]=Math.floor(r[1]/u)*u+.5*u,r[2]=u,r}function Vi(n,t){return Bo.range.apply(Bo,Zi(n,t))}function $i(n,t,r){var e=Zi(n,t);if(r){var u=nc.exec(r);if(u.shift(),"s"===u[8]){var i=Bo.formatPrefix(Math.max(ca(e[0]),ca(e[1])));return u[7]||(u[7]="."+Xi(i.scale(e[2]))),u[8]="f",r=Bo.format(u.join("")),function(n){return r(i.scale(n))+i.symbol}}u[7]||(u[7]="."+Bi(u[8],e)),r=u.join("")}else r=",."+Xi(e[2])+"f";return Bo.format(r)}function Xi(n){return-Math.floor(Math.log(n)/Math.LN10+.01)}function Bi(n,t){var r=Xi(t[2]);return n in gs?Math.abs(r-Xi(Math.max(ca(t[0]),ca(t[1]))))+ +("e"!==n):r-2*("%"===n)}function Ji(n,t,r,e){function u(n){return(r?Math.log(0>n?0:n):-Math.log(n>0?0:-n))/Math.log(t)}function i(n){return r?Math.pow(t,n):-Math.pow(t,-n)}function o(t){return n(u(t))}return o.invert=function(t){return i(n.invert(t))},o.domain=function(t){return arguments.length?(r=t[0]>=0,n.domain((e=t.map(Number)).map(u)),o):e},o.base=function(r){return arguments.length?(t=+r,n.domain(e.map(u)),o):t},o.nice=function(){var t=ji(e.map(u),r?Math:vs);return n.domain(t),e=t.map(i),o},o.ticks=function(){var n=Di(e),o=[],a=n[0],c=n[1],s=Math.floor(u(a)),l=Math.ceil(u(c)),f=t%1?2:t;if(isFinite(l-s)){if(r){for(;l>s;s++)for(var h=1;f>h;h++)o.push(i(s)*h);o.push(i(s))}else for(o.push(i(s));s++<l;)for(var h=f-1;h>0;h--)o.push(i(s)*h);for(s=0;o[s]<a;s++);for(l=o.length;o[l-1]>c;l--);o=o.slice(s,l)}return o},o.tickFormat=function(n,t){if(!arguments.length)return ps;arguments.length<2?t=ps:"function"!=typeof t&&(t=Bo.format(t));var e,a=Math.max(.1,n/o.ticks().length),c=r?(e=1e-12,Math.ceil):(e=-1e-12,Math.floor);return function(n){return n/i(c(u(n)+e))<=a?t(n):""}},o.copy=function(){return Ji(n.copy(),t,r,e)},Ii(o,n)}function Wi(n,t,r){function e(t){return n(u(t))}var u=Gi(t),i=Gi(1/t);return e.invert=function(t){return i(n.invert(t))},e.domain=function(t){return arguments.length?(n.domain((r=t.map(Number)).map(u)),e):r},e.ticks=function(n){return Vi(r,n)},e.tickFormat=function(n,t){return $i(r,n,t)},e.nice=function(n){return e.domain(Yi(r,n))},e.exponent=function(o){return arguments.length?(u=Gi(t=o),i=Gi(1/t),n.domain(r.map(u)),e):t},e.copy=function(){return Wi(n.copy(),t,r)},Ii(e,n)}function Gi(n){return function(t){return 0>t?-Math.pow(-t,n):Math.pow(t,n)}}function Ki(n,t){function r(r){return i[((u.get(r)||("range"===t.t?u.set(r,n.push(r)):0/0))-1)%i.length]}function e(t,r){return Bo.range(n.length).map(function(n){return t+r*n})}var u,i,a;return r.domain=function(e){if(!arguments.length)return n;n=[],u=new o;for(var i,a=-1,c=e.length;++a<c;)u.has(i=e[a])||u.set(i,n.push(i));return r[t.t].apply(r,t.a)},r.range=function(n){return arguments.length?(i=n,a=0,t={t:"range",a:arguments},r):i},r.rangePoints=function(u,o){arguments.length<2&&(o=0);var c=u[0],s=u[1],l=(s-c)/(Math.max(1,n.length-1)+o);return i=e(n.length<2?(c+s)/2:c+l*o/2,l),a=0,t={t:"rangePoints",a:arguments},r},r.rangeBands=function(u,o,c){arguments.length<2&&(o=0),arguments.length<3&&(c=o);var s=u[1]<u[0],l=u[s-0],f=u[1-s],h=(f-l)/(n.length-o+2*c);return i=e(l+h*c,h),s&&i.reverse(),a=h*(1-o),t={t:"rangeBands",a:arguments},r},r.rangeRoundBands=function(u,o,c){arguments.length<2&&(o=0),arguments.length<3&&(c=o);var s=u[1]<u[0],l=u[s-0],f=u[1-s],h=Math.floor((f-l)/(n.length-o+2*c)),g=f-l-(n.length-o)*h;return i=e(l+Math.round(g/2),h),s&&i.reverse(),a=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},r},r.rangeBand=function(){return a},r.rangeExtent=function(){return Di(t.a[0])},r.copy=function(){return Ki(n,t)},r.domain(n)}function Qi(r,e){function u(){var n=0,t=e.length;for(o=[];++n<t;)o[n-1]=Bo.quantile(r,n/t);return i}function i(n){return isNaN(n=+n)?void 0:e[Bo.bisect(o,n)]}var o;return i.domain=function(e){return arguments.length?(r=e.filter(t).sort(n),u()):r},i.range=function(n){return arguments.length?(e=n,u()):e},i.quantiles=function(){return o},i.invertExtent=function(n){return n=e.indexOf(n),0>n?[0/0,0/0]:[n>0?o[n-1]:r[0],n<o.length?o[n]:r[r.length-1]]},i.copy=function(){return Qi(r,e)},u()}function no(n,t,r){function e(t){return r[Math.max(0,Math.min(o,Math.floor(i*(t-n))))]}function u(){return i=r.length/(t-n),o=r.length-1,e}var i,o;return e.domain=function(r){return arguments.length?(n=+r[0],t=+r[r.length-1],u()):[n,t]},e.range=function(n){return arguments.length?(r=n,u()):r},e.invertExtent=function(t){return t=r.indexOf(t),t=0>t?0/0:t/i+n,[t,t+1/i]},e.copy=function(){return no(n,t,r)},u()}function to(n,t){function r(r){return r>=r?t[Bo.bisect(n,r)]:void 0}return r.domain=function(t){return arguments.length?(n=t,r):n},r.range=function(n){return arguments.length?(t=n,r):t},r.invertExtent=function(r){return r=t.indexOf(r),[n[r-1],n[r]]},r.copy=function(){return to(n,t)},r}function ro(n){function t(n){return+n}return t.invert=t,t.domain=t.range=function(r){return arguments.length?(n=r.map(t),t):n},t.ticks=function(t){return Vi(n,t)},t.tickFormat=function(t,r){return $i(n,t,r)},t.copy=function(){return ro(n)},t}function eo(n){return n.innerRadius}function uo(n){return n.outerRadius}function io(n){return n.startAngle}function oo(n){return n.endAngle}function ao(n){function t(t){function o(){s.push("M",i(n(l),a))}for(var c,s=[],l=[],f=-1,h=t.length,g=Et(r),p=Et(e);++f<h;)u.call(this,c=t[f],f)?l.push([+g.call(this,c,f),+p.call(this,c,f)]):l.length&&(o(),l=[]);return l.length&&o(),s.length?s.join(""):null}var r=Ae,e=Ce,u=Ar,i=co,o=i.key,a=.7;return t.x=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(e=n,t):e},t.defined=function(n){return arguments.length?(u=n,t):u},t.interpolate=function(n){return arguments.length?(o="function"==typeof n?i=n:(i=bs.get(n)||co).key,t):o},t.tension=function(n){return arguments.length?(a=n,t):a},t}function co(n){return n.join("L")}function so(n){return co(n)+"Z"}function lo(n){for(var t=0,r=n.length,e=n[0],u=[e[0],",",e[1]];++t<r;)u.push("H",(e[0]+(e=n[t])[0])/2,"V",e[1]);return r>1&&u.push("H",e[0]),u.join("")}function fo(n){for(var t=0,r=n.length,e=n[0],u=[e[0],",",e[1]];++t<r;)u.push("V",(e=n[t])[1],"H",e[0]);return u.join("")}function ho(n){for(var t=0,r=n.length,e=n[0],u=[e[0],",",e[1]];++t<r;)u.push("H",(e=n[t])[0],"V",e[1]);return u.join("")}function go(n,t){return n.length<4?co(n):n[1]+mo(n.slice(1,n.length-1),yo(n,t))}function po(n,t){return n.length<3?co(n):n[0]+mo((n.push(n[0]),n),yo([n[n.length-2]].concat(n,[n[1]]),t))}function vo(n,t){return n.length<3?co(n):n[0]+mo(n,yo(n,t))}function mo(n,t){if(t.length<1||n.length!=t.length&&n.length!=t.length+2)return co(n);var r=n.length!=t.length,e="",u=n[0],i=n[1],o=t[0],a=o,c=1;if(r&&(e+="Q"+(i[0]-2*o[0]/3)+","+(i[1]-2*o[1]/3)+","+i[0]+","+i[1],u=n[1],c=2),t.length>1){a=t[1],i=n[c],c++,e+="C"+(u[0]+o[0])+","+(u[1]+o[1])+","+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1];for(var s=2;s<t.length;s++,c++)i=n[c],a=t[s],e+="S"+(i[0]-a[0])+","+(i[1]-a[1])+","+i[0]+","+i[1]}if(r){var l=n[c];e+="Q"+(i[0]+2*a[0]/3)+","+(i[1]+2*a[1]/3)+","+l[0]+","+l[1]}return e}function yo(n,t){for(var r,e=[],u=(1-t)/2,i=n[0],o=n[1],a=1,c=n.length;++a<c;)r=i,i=o,o=n[a],e.push([u*(o[0]-r[0]),u*(o[1]-r[1])]);return e}function xo(n){if(n.length<3)return co(n);var t=1,r=n.length,e=n[0],u=e[0],i=e[1],o=[u,u,u,(e=n[1])[0]],a=[i,i,i,e[1]],c=[u,",",i,"L",wo(ks,o),",",wo(ks,a)];for(n.push(n[r-1]);++t<=r;)e=n[t],o.shift(),o.push(e[0]),a.shift(),a.push(e[1]),So(c,o,a);return n.pop(),c.push("L",e),c.join("")}function Mo(n){if(n.length<4)return co(n);for(var t,r=[],e=-1,u=n.length,i=[0],o=[0];++e<3;)t=n[e],i.push(t[0]),o.push(t[1]);for(r.push(wo(ks,i)+","+wo(ks,o)),--e;++e<u;)t=n[e],i.shift(),i.push(t[0]),o.shift(),o.push(t[1]),So(r,i,o);return r.join("")}function _o(n){for(var t,r,e=-1,u=n.length,i=u+4,o=[],a=[];++e<4;)r=n[e%u],o.push(r[0]),a.push(r[1]);for(t=[wo(ks,o),",",wo(ks,a)],--e;++e<i;)r=n[e%u],o.shift(),o.push(r[0]),a.shift(),a.push(r[1]),So(t,o,a);return t.join("")}function bo(n,t){var r=n.length-1;if(r)for(var e,u,i=n[0][0],o=n[0][1],a=n[r][0]-i,c=n[r][1]-o,s=-1;++s<=r;)e=n[s],u=s/r,e[0]=t*e[0]+(1-t)*(i+u*a),e[1]=t*e[1]+(1-t)*(o+u*c);return xo(n)}function wo(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function So(n,t,r){n.push("C",wo(ws,t),",",wo(ws,r),",",wo(Ss,t),",",wo(Ss,r),",",wo(ks,t),",",wo(ks,r))}function ko(n,t){return(t[1]-n[1])/(t[0]-n[0])}function Eo(n){for(var t=0,r=n.length-1,e=[],u=n[0],i=n[1],o=e[0]=ko(u,i);++t<r;)e[t]=(o+(o=ko(u=i,i=n[t+1])))/2;return e[t]=o,e}function Ao(n){for(var t,r,e,u,i=[],o=Eo(n),a=-1,c=n.length-1;++a<c;)t=ko(n[a],n[a+1]),ca(t)<Ca?o[a]=o[a+1]=0:(r=o[a]/t,e=o[a+1]/t,u=r*r+e*e,u>9&&(u=3*t/Math.sqrt(u),o[a]=u*r,o[a+1]=u*e));for(a=-1;++a<=c;)u=(n[Math.min(c,a+1)][0]-n[Math.max(0,a-1)][0])/(6*(1+o[a]*o[a])),i.push([u||0,o[a]*u||0]);return i}function Co(n){return n.length<3?co(n):n[0]+mo(n,Ao(n))}function No(n){for(var t,r,e,u=-1,i=n.length;++u<i;)t=n[u],r=t[0],e=t[1]+Ms,t[0]=r*Math.cos(e),t[1]=r*Math.sin(e);return n}function zo(n){function t(t){function c(){v.push("M",a(n(m),f),l,s(n(d.reverse()),f),"Z")}for(var h,g,p,v=[],d=[],m=[],y=-1,x=t.length,M=Et(r),_=Et(u),b=r===e?function(){return g}:Et(e),w=u===i?function(){return p}:Et(i);++y<x;)o.call(this,h=t[y],y)?(d.push([g=+M.call(this,h,y),p=+_.call(this,h,y)]),m.push([+b.call(this,h,y),+w.call(this,h,y)])):d.length&&(c(),d=[],m=[]);return d.length&&c(),v.length?v.join(""):null}var r=Ae,e=Ae,u=0,i=Ce,o=Ar,a=co,c=a.key,s=a,l="L",f=.7;return t.x=function(n){return arguments.length?(r=e=n,t):e},t.x0=function(n){return arguments.length?(r=n,t):r},t.x1=function(n){return arguments.length?(e=n,t):e},t.y=function(n){return arguments.length?(u=i=n,t):i},t.y0=function(n){return arguments.length?(u=n,t):u},t.y1=function(n){return arguments.length?(i=n,t):i},t.defined=function(n){return arguments.length?(o=n,t):o},t.interpolate=function(n){return arguments.length?(c="function"==typeof n?a=n:(a=bs.get(n)||co).key,s=a.reverse||a,l=a.closed?"M":"L",t):c},t.tension=function(n){return arguments.length?(f=n,t):f},t}function Lo(n){return n.radius}function To(n){return[n.x,n.y]}function qo(n){return function(){var t=n.apply(this,arguments),r=t[0],e=t[1]+Ms;return[r*Math.cos(e),r*Math.sin(e)]}}function Ro(){return 64}function Do(){return"circle"}function Po(n){var t=Math.sqrt(n/ka);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Uo(n,t){return ga(n,Ls),n.id=t,n}function jo(n,t,r,e){var u=n.id;return P(n,"function"==typeof r?function(n,i,o){n.__transition__[u].tween.set(t,e(r.call(n,n.__data__,i,o)))}:(r=e(r),function(n){n.__transition__[u].tween.set(t,r)}))}function Ho(n){return null==n&&(n=""),function(){this.textContent=n}}function Fo(n,t,r,e){var u=n.__transition__||(n.__transition__={active:0,count:0}),i=u[r];if(!i){var a=e.time;i=u[r]={tween:new o,time:a,ease:e.ease,delay:e.delay,duration:e.duration},++u.count,Bo.timer(function(e){function o(e){return u.active>r?s():(u.active=r,i.event&&i.event.start.call(n,l,t),i.tween.forEach(function(r,e){(e=e.call(n,l,t))&&v.push(e)}),Bo.timer(function(){return p.c=c(e||1)?Ar:c,1},0,a),void 0)}function c(e){if(u.active!==r)return s();for(var o=e/g,a=f(o),c=v.length;c>0;)v[--c].call(n,a);return o>=1?(i.event&&i.event.end.call(n,l,t),s()):void 0}function s(){return--u.count?delete u[r]:delete n.__transition__,1}var l=n.__data__,f=i.ease,h=i.delay,g=i.duration,p=Ga,v=[];return p.t=h+a,e>=h?o(e-h):(p.c=o,void 0)},0,a)}}function Oo(n,t){n.attr("transform",function(n){return"translate("+t(n)+",0)"})}function Io(n,t){n.attr("transform",function(n){return"translate(0,"+t(n)+")"})}function Yo(n){return n.toISOString()}function Zo(n,t,r){function e(t){return n(t)}function u(n,r){var e=n[1]-n[0],u=e/r,i=Bo.bisect(Fs,u);return i==Fs.length?[t.year,Zi(n.map(function(n){return n/31536e6}),r)[2]]:i?t[u/Fs[i-1]<Fs[i]/u?i-1:i]:[Ys,Zi(n,r)[2]]}return e.invert=function(t){return Vo(n.invert(t))
},e.domain=function(t){return arguments.length?(n.domain(t),e):n.domain().map(Vo)},e.nice=function(n,t){function r(r){return!isNaN(r)&&!n.range(r,Vo(+r+1),t).length}var i=e.domain(),o=Di(i),a=null==n?u(o,10):"number"==typeof n&&u(o,n);return a&&(n=a[0],t=a[1]),e.domain(ji(i,t>1?{floor:function(t){for(;r(t=n.floor(t));)t=Vo(t-1);return t},ceil:function(t){for(;r(t=n.ceil(t));)t=Vo(+t+1);return t}}:n))},e.ticks=function(n,t){var r=Di(e.domain()),i=null==n?u(r,10):"number"==typeof n?u(r,n):!n.range&&[{range:n},t];return i&&(n=i[0],t=i[1]),n.range(r[0],Vo(+r[1]+1),1>t?1:t)},e.tickFormat=function(){return r},e.copy=function(){return Zo(n.copy(),t,r)},Ii(e,n)}function Vo(n){return new Date(n)}function $o(n){return JSON.parse(n.responseText)}function Xo(n){var t=Go.createRange();return t.selectNode(Go.body),t.createContextualFragment(n.responseText)}var Bo={version:"3.4.8"};Date.now||(Date.now=function(){return+new Date});var Jo=[].slice,Wo=function(n){return Jo.call(n)},Go=document,Ko=Go.documentElement,Qo=window;try{Wo(Ko.childNodes)[0].nodeType}catch(na){Wo=function(n){for(var t=n.length,r=new Array(t);t--;)r[t]=n[t];return r}}try{Go.createElement("div").style.setProperty("opacity",0,"")}catch(ta){var ra=Qo.Element.prototype,ea=ra.setAttribute,ua=ra.setAttributeNS,ia=Qo.CSSStyleDeclaration.prototype,oa=ia.setProperty;ra.setAttribute=function(n,t){ea.call(this,n,t+"")},ra.setAttributeNS=function(n,t,r){ua.call(this,n,t,r+"")},ia.setProperty=function(n,t,r){oa.call(this,n,t+"",r)}}Bo.ascending=n,Bo.descending=function(n,t){return n>t?-1:t>n?1:t>=n?0:0/0},Bo.min=function(n,t){var r,e,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(r=n[u])&&r>=r);)r=void 0;for(;++u<i;)null!=(e=n[u])&&r>e&&(r=e)}else{for(;++u<i&&!(null!=(r=t.call(n,n[u],u))&&r>=r);)r=void 0;for(;++u<i;)null!=(e=t.call(n,n[u],u))&&r>e&&(r=e)}return r},Bo.max=function(n,t){var r,e,u=-1,i=n.length;if(1===arguments.length){for(;++u<i&&!(null!=(r=n[u])&&r>=r);)r=void 0;for(;++u<i;)null!=(e=n[u])&&e>r&&(r=e)}else{for(;++u<i&&!(null!=(r=t.call(n,n[u],u))&&r>=r);)r=void 0;for(;++u<i;)null!=(e=t.call(n,n[u],u))&&e>r&&(r=e)}return r},Bo.extent=function(n,t){var r,e,u,i=-1,o=n.length;if(1===arguments.length){for(;++i<o&&!(null!=(r=u=n[i])&&r>=r);)r=u=void 0;for(;++i<o;)null!=(e=n[i])&&(r>e&&(r=e),e>u&&(u=e))}else{for(;++i<o&&!(null!=(r=u=t.call(n,n[i],i))&&r>=r);)r=void 0;for(;++i<o;)null!=(e=t.call(n,n[i],i))&&(r>e&&(r=e),e>u&&(u=e))}return[r,u]},Bo.sum=function(n,t){var r,e=0,u=n.length,i=-1;if(1===arguments.length)for(;++i<u;)isNaN(r=+n[i])||(e+=r);else for(;++i<u;)isNaN(r=+t.call(n,n[i],i))||(e+=r);return e},Bo.mean=function(n,r){var e,u=0,i=n.length,o=-1,a=i;if(1===arguments.length)for(;++o<i;)t(e=n[o])?u+=e:--a;else for(;++o<i;)t(e=r.call(n,n[o],o))?u+=e:--a;return a?u/a:void 0},Bo.quantile=function(n,t){var r=(n.length-1)*t+1,e=Math.floor(r),u=+n[e-1],i=r-e;return i?u+i*(n[e]-u):u},Bo.median=function(r,e){return arguments.length>1&&(r=r.map(e)),r=r.filter(t),r.length?Bo.quantile(r.sort(n),.5):void 0};var aa=r(n);Bo.bisectLeft=aa.left,Bo.bisect=Bo.bisectRight=aa.right,Bo.bisector=function(t){return r(1===t.length?function(r,e){return n(t(r),e)}:t)},Bo.shuffle=function(n){for(var t,r,e=n.length;e;)r=0|Math.random()*e--,t=n[e],n[e]=n[r],n[r]=t;return n},Bo.permute=function(n,t){for(var r=t.length,e=new Array(r);r--;)e[r]=n[t[r]];return e},Bo.pairs=function(n){for(var t,r=0,e=n.length-1,u=n[0],i=new Array(0>e?0:e);e>r;)i[r]=[t=u,u=n[++r]];return i},Bo.zip=function(){if(!(u=arguments.length))return[];for(var n=-1,t=Bo.min(arguments,e),r=new Array(t);++n<t;)for(var u,i=-1,o=r[n]=new Array(u);++i<u;)o[i]=arguments[i][n];return r},Bo.transpose=function(n){return Bo.zip.apply(Bo,n)},Bo.keys=function(n){var t=[];for(var r in n)t.push(r);return t},Bo.values=function(n){var t=[];for(var r in n)t.push(n[r]);return t},Bo.entries=function(n){var t=[];for(var r in n)t.push({key:r,value:n[r]});return t},Bo.merge=function(n){for(var t,r,e,u=n.length,i=-1,o=0;++i<u;)o+=n[i].length;for(r=new Array(o);--u>=0;)for(e=n[u],t=e.length;--t>=0;)r[--o]=e[t];return r};var ca=Math.abs;Bo.range=function(n,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=n,n=0)),1/0===(t-n)/r)throw new Error("infinite range");var e,i=[],o=u(ca(r)),a=-1;if(n*=o,t*=o,r*=o,0>r)for(;(e=n+r*++a)>t;)i.push(e/o);else for(;(e=n+r*++a)<t;)i.push(e/o);return i},Bo.map=function(n){var t=new o;if(n instanceof o)n.forEach(function(n,r){t.set(n,r)});else for(var r in n)t.set(r,n[r]);return t},i(o,{has:a,get:function(n){return this[sa+n]},set:function(n,t){return this[sa+n]=t},remove:c,keys:s,values:function(){var n=[];return this.forEach(function(t,r){n.push(r)}),n},entries:function(){var n=[];return this.forEach(function(t,r){n.push({key:t,value:r})}),n},size:l,empty:f,forEach:function(n){for(var t in this)t.charCodeAt(0)===la&&n.call(this,t.substring(1),this[t])}});var sa="\x00",la=sa.charCodeAt(0);Bo.nest=function(){function n(t,a,c){if(c>=i.length)return e?e.call(u,a):r?a.sort(r):a;for(var s,l,f,h,g=-1,p=a.length,v=i[c++],d=new o;++g<p;)(h=d.get(s=v(l=a[g])))?h.push(l):d.set(s,[l]);return t?(l=t(),f=function(r,e){l.set(r,n(t,e,c))}):(l={},f=function(r,e){l[r]=n(t,e,c)}),d.forEach(f),l}function t(n,r){if(r>=i.length)return n;var e=[],u=a[r++];return n.forEach(function(n,u){e.push({key:n,values:t(u,r)})}),u?e.sort(function(n,t){return u(n.key,t.key)}):e}var r,e,u={},i=[],a=[];return u.map=function(t,r){return n(r,t,0)},u.entries=function(r){return t(n(Bo.map,r,0),0)},u.key=function(n){return i.push(n),u},u.sortKeys=function(n){return a[i.length-1]=n,u},u.sortValues=function(n){return r=n,u},u.rollup=function(n){return e=n,u},u},Bo.set=function(n){var t=new h;if(n)for(var r=0,e=n.length;e>r;++r)t.add(n[r]);return t},i(h,{has:a,add:function(n){return this[sa+n]=!0,n},remove:function(n){return n=sa+n,n in this&&delete this[n]},values:s,size:l,empty:f,forEach:function(n){for(var t in this)t.charCodeAt(0)===la&&n.call(this,t.substring(1))}}),Bo.behavior={},Bo.rebind=function(n,t){for(var r,e=1,u=arguments.length;++e<u;)n[r=arguments[e]]=g(n,t,t[r]);return n};var fa=["webkit","ms","moz","Moz","o","O"];Bo.dispatch=function(){for(var n=new d,t=-1,r=arguments.length;++t<r;)n[arguments[t]]=m(n);return n},d.prototype.on=function(n,t){var r=n.indexOf("."),e="";if(r>=0&&(e=n.substring(r+1),n=n.substring(0,r)),n)return arguments.length<2?this[n].on(e):this[n].on(e,t);if(2===arguments.length){if(null==t)for(n in this)this.hasOwnProperty(n)&&this[n].on(e,null);return this}},Bo.event=null,Bo.requote=function(n){return n.replace(ha,"\\$&")};var ha=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,ga={}.__proto__?function(n,t){n.__proto__=t}:function(n,t){for(var r in t)n[r]=t[r]},pa=function(n,t){return t.querySelector(n)},va=function(n,t){return t.querySelectorAll(n)},da=Ko[p(Ko,"matchesSelector")],ma=function(n,t){return da.call(n,t)};"function"==typeof Sizzle&&(pa=function(n,t){return Sizzle(n,t)[0]||null},va=Sizzle,ma=Sizzle.matchesSelector),Bo.selection=function(){return _a};var ya=Bo.selection.prototype=[];ya.select=function(n){var t,r,e,u,i=[];n=b(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]),t.parentNode=(e=this[o]).parentNode;for(var c=-1,s=e.length;++c<s;)(u=e[c])?(t.push(r=n.call(u,u.__data__,c,o)),r&&"__data__"in u&&(r.__data__=u.__data__)):t.push(null)}return _(i)},ya.selectAll=function(n){var t,r,e=[];n=w(n);for(var u=-1,i=this.length;++u<i;)for(var o=this[u],a=-1,c=o.length;++a<c;)(r=o[a])&&(e.push(t=Wo(n.call(r,r.__data__,a,u))),t.parentNode=r);return _(e)};var xa={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Bo.ns={prefix:xa,qualify:function(n){var t=n.indexOf(":"),r=n;return t>=0&&(r=n.substring(0,t),n=n.substring(t+1)),xa.hasOwnProperty(r)?{space:xa[r],local:n}:n}},ya.attr=function(n,t){if(arguments.length<2){if("string"==typeof n){var r=this.node();return n=Bo.ns.qualify(n),n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}for(t in n)this.each(S(t,n[t]));return this}return this.each(S(n,t))},ya.classed=function(n,t){if(arguments.length<2){if("string"==typeof n){var r=this.node(),e=(n=A(n)).length,u=-1;if(t=r.classList){for(;++u<e;)if(!t.contains(n[u]))return!1}else for(t=r.getAttribute("class");++u<e;)if(!E(n[u]).test(t))return!1;return!0}for(t in n)this.each(C(t,n[t]));return this}return this.each(C(n,t))},ya.style=function(n,t,r){var e=arguments.length;if(3>e){if("string"!=typeof n){2>e&&(t="");for(r in n)this.each(z(r,n[r],t));return this}if(2>e)return Qo.getComputedStyle(this.node(),null).getPropertyValue(n);r=""}return this.each(z(n,t,r))},ya.property=function(n,t){if(arguments.length<2){if("string"==typeof n)return this.node()[n];for(t in n)this.each(L(t,n[t]));return this}return this.each(L(n,t))},ya.text=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.textContent=null==t?"":t}:null==n?function(){this.textContent=""}:function(){this.textContent=n}):this.node().textContent},ya.html=function(n){return arguments.length?this.each("function"==typeof n?function(){var t=n.apply(this,arguments);this.innerHTML=null==t?"":t}:null==n?function(){this.innerHTML=""}:function(){this.innerHTML=n}):this.node().innerHTML},ya.append=function(n){return n=T(n),this.select(function(){return this.appendChild(n.apply(this,arguments))})},ya.insert=function(n,t){return n=T(n),t=b(t),this.select(function(){return this.insertBefore(n.apply(this,arguments),t.apply(this,arguments)||null)})},ya.remove=function(){return this.each(function(){var n=this.parentNode;n&&n.removeChild(this)})},ya.data=function(n,t){function r(n,r){var e,u,i,a=n.length,f=r.length,h=Math.min(a,f),g=new Array(f),p=new Array(f),v=new Array(a);if(t){var d,m=new o,y=new o,x=[];for(e=-1;++e<a;)d=t.call(u=n[e],u.__data__,e),m.has(d)?v[e]=u:m.set(d,u),x.push(d);for(e=-1;++e<f;)d=t.call(r,i=r[e],e),(u=m.get(d))?(g[e]=u,u.__data__=i):y.has(d)||(p[e]=q(i)),y.set(d,i),m.remove(d);for(e=-1;++e<a;)m.has(x[e])&&(v[e]=n[e])}else{for(e=-1;++e<h;)u=n[e],i=r[e],u?(u.__data__=i,g[e]=u):p[e]=q(i);for(;f>e;++e)p[e]=q(r[e]);for(;a>e;++e)v[e]=n[e]}p.update=g,p.parentNode=g.parentNode=v.parentNode=n.parentNode,c.push(p),s.push(g),l.push(v)}var e,u,i=-1,a=this.length;if(!arguments.length){for(n=new Array(a=(e=this[0]).length);++i<a;)(u=e[i])&&(n[i]=u.__data__);return n}var c=U([]),s=_([]),l=_([]);if("function"==typeof n)for(;++i<a;)r(e=this[i],n.call(e,e.parentNode.__data__,i));else for(;++i<a;)r(e=this[i],n);return s.enter=function(){return c},s.exit=function(){return l},s},ya.datum=function(n){return arguments.length?this.property("__data__",n):this.property("__data__")},ya.filter=function(n){var t,r,e,u=[];"function"!=typeof n&&(n=R(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]),t.parentNode=(r=this[i]).parentNode;for(var a=0,c=r.length;c>a;a++)(e=r[a])&&n.call(e,e.__data__,a,i)&&t.push(e)}return _(u)},ya.order=function(){for(var n=-1,t=this.length;++n<t;)for(var r,e=this[n],u=e.length-1,i=e[u];--u>=0;)(r=e[u])&&(i&&i!==r.nextSibling&&i.parentNode.insertBefore(r,i),i=r);return this},ya.sort=function(n){n=D.apply(this,arguments);for(var t=-1,r=this.length;++t<r;)this[t].sort(n);return this.order()},ya.each=function(n){return P(this,function(t,r,e){n.call(t,t.__data__,r,e)})},ya.call=function(n){var t=Wo(arguments);return n.apply(t[0]=this,t),this},ya.empty=function(){return!this.node()},ya.node=function(){for(var n=0,t=this.length;t>n;n++)for(var r=this[n],e=0,u=r.length;u>e;e++){var i=r[e];if(i)return i}return null},ya.size=function(){var n=0;return this.each(function(){++n}),n};var Ma=[];Bo.selection.enter=U,Bo.selection.enter.prototype=Ma,Ma.append=ya.append,Ma.empty=ya.empty,Ma.node=ya.node,Ma.call=ya.call,Ma.size=ya.size,Ma.select=function(n){for(var t,r,e,u,i,o=[],a=-1,c=this.length;++a<c;){e=(u=this[a]).update,o.push(t=[]),t.parentNode=u.parentNode;for(var s=-1,l=u.length;++s<l;)(i=u[s])?(t.push(e[s]=r=n.call(u.parentNode,i.__data__,s,a)),r.__data__=i.__data__):t.push(null)}return _(o)},Ma.insert=function(n,t){return arguments.length<2&&(t=j(this)),ya.insert.call(this,n,t)},ya.transition=function(){for(var n,t,r=As||++Ts,e=[],u=Cs||{time:Date.now(),ease:wu,delay:0,duration:250},i=-1,o=this.length;++i<o;){e.push(n=[]);for(var a=this[i],c=-1,s=a.length;++c<s;)(t=a[c])&&Fo(t,c,r,u),n.push(t)}return Uo(e,r)},ya.interrupt=function(){return this.each(H)},Bo.select=function(n){var t=["string"==typeof n?pa(n,Go):n];return t.parentNode=Ko,_([t])},Bo.selectAll=function(n){var t=Wo("string"==typeof n?va(n,Go):n);return t.parentNode=Ko,_([t])};var _a=Bo.select(Ko);ya.on=function(n,t,r){var e=arguments.length;if(3>e){if("string"!=typeof n){2>e&&(t=!1);for(r in n)this.each(F(r,n[r],t));return this}if(2>e)return(e=this.node()["__on"+n])&&e._;r=!1}return this.each(F(n,t,r))};var ba=Bo.map({mouseenter:"mouseover",mouseleave:"mouseout"});ba.forEach(function(n){"on"+n in Go&&ba.remove(n)});var wa="onselectstart"in Go?null:p(Ko.style,"userSelect"),Sa=0;Bo.mouse=function(n){return Z(n,x())},Bo.touches=function(n,t){return arguments.length<2&&(t=x().touches),t?Wo(t).map(function(t){var r=Z(n,t);return r.identifier=t.identifier,r}):[]},Bo.behavior.drag=function(){function n(){this.on("mousedown.drag",u).on("touchstart.drag",i)}function t(n,t,u,i,o){return function(){function a(){var n,r,e=t(h,v);e&&(n=e[0]-x[0],r=e[1]-x[1],p|=n|r,x=e,g({type:"drag",x:e[0]+s[0],y:e[1]+s[1],dx:n,dy:r}))}function c(){t(h,v)&&(m.on(i+d,null).on(o+d,null),y(p&&Bo.event.target===f),g({type:"dragend"}))}var s,l=this,f=Bo.event.target,h=l.parentNode,g=r.of(l,arguments),p=0,v=n(),d=".drag"+(null==v?"":"-"+v),m=Bo.select(u()).on(i+d,a).on(o+d,c),y=Y(),x=t(h,v);e?(s=e.apply(l,arguments),s=[s.x-x[0],s.y-x[1]]):s=[0,0],g({type:"dragstart"})}}var r=M(n,"drag","dragstart","dragend"),e=null,u=t(v,Bo.mouse,X,"mousemove","mouseup"),i=t(V,Bo.touch,$,"touchmove","touchend");return n.origin=function(t){return arguments.length?(e=t,n):e},Bo.rebind(n,r,"on")};var ka=Math.PI,Ea=2*ka,Aa=ka/2,Ca=1e-6,Na=Ca*Ca,za=ka/180,La=180/ka,Ta=Math.SQRT2,qa=2,Ra=4;Bo.interpolateZoom=function(n,t){function r(n){var t=n*y;if(m){var r=Q(v),o=i/(qa*h)*(r*nt(Ta*t+v)-K(v));return[e+o*s,u+o*l,i*r/Q(Ta*t+v)]}return[e+n*s,u+n*l,i*Math.exp(Ta*t)]}var e=n[0],u=n[1],i=n[2],o=t[0],a=t[1],c=t[2],s=o-e,l=a-u,f=s*s+l*l,h=Math.sqrt(f),g=(c*c-i*i+Ra*f)/(2*i*qa*h),p=(c*c-i*i-Ra*f)/(2*c*qa*h),v=Math.log(Math.sqrt(g*g+1)-g),d=Math.log(Math.sqrt(p*p+1)-p),m=d-v,y=(m||Math.log(c/i))/Ta;return r.duration=1e3*y,r},Bo.behavior.zoom=function(){function n(n){n.on(A,s).on(Ua+".zoom",f).on(C,h).on("dblclick.zoom",g).on(z,l)}function t(n){return[(n[0]-S.x)/S.k,(n[1]-S.y)/S.k]}function r(n){return[n[0]*S.k+S.x,n[1]*S.k+S.y]}function e(n){S.k=Math.max(E[0],Math.min(E[1],n))}function u(n,t){t=r(t),S.x+=n[0]-t[0],S.y+=n[1]-t[1]}function i(){_&&_.domain(x.range().map(function(n){return(n-S.x)/S.k}).map(x.invert)),w&&w.domain(b.range().map(function(n){return(n-S.y)/S.k}).map(b.invert))}function o(n){n({type:"zoomstart"})}function a(n){i(),n({type:"zoom",scale:S.k,translate:[S.x,S.y]})}function c(n){n({type:"zoomend"})}function s(){function n(){l=1,u(Bo.mouse(e),g),a(s)}function r(){f.on(C,Qo===e?h:null).on(N,null),p(l&&Bo.event.target===i),c(s)}var e=this,i=Bo.event.target,s=L.of(e,arguments),l=0,f=Bo.select(Qo).on(C,n).on(N,r),g=t(Bo.mouse(e)),p=Y();H.call(e),o(s)}function l(){function n(){var n=Bo.touches(g);return h=S.k,n.forEach(function(n){n.identifier in v&&(v[n.identifier]=t(n))}),n}function r(){var t=Bo.event.target;Bo.select(t).on(M,i).on(_,f),b.push(t);for(var r=Bo.event.changedTouches,o=0,c=r.length;c>o;++o)v[r[o].identifier]=null;var s=n(),l=Date.now();if(1===s.length){if(500>l-m){var h=s[0],g=v[h.identifier];e(2*S.k),u(h,g),y(),a(p)}m=l}else if(s.length>1){var h=s[0],x=s[1],w=h[0]-x[0],k=h[1]-x[1];d=w*w+k*k}}function i(){for(var n,t,r,i,o=Bo.touches(g),c=0,s=o.length;s>c;++c,i=null)if(r=o[c],i=v[r.identifier]){if(t)break;n=r,t=i}if(i){var l=(l=r[0]-n[0])*l+(l=r[1]-n[1])*l,f=d&&Math.sqrt(l/d);n=[(n[0]+r[0])/2,(n[1]+r[1])/2],t=[(t[0]+i[0])/2,(t[1]+i[1])/2],e(f*h)}m=null,u(n,t),a(p)}function f(){if(Bo.event.touches.length){for(var t=Bo.event.changedTouches,r=0,e=t.length;e>r;++r)delete v[t[r].identifier];for(var u in v)return void n()}Bo.selectAll(b).on(x,null),w.on(A,s).on(z,l),k(),c(p)}var h,g=this,p=L.of(g,arguments),v={},d=0,x=".zoom-"+Bo.event.changedTouches[0].identifier,M="touchmove"+x,_="touchend"+x,b=[],w=Bo.select(g).on(A,null).on(z,r),k=Y();H.call(g),r(),o(p)}function f(){var n=L.of(this,arguments);d?clearTimeout(d):(H.call(this),o(n)),d=setTimeout(function(){d=null,c(n)},50),y();var r=v||Bo.mouse(this);p||(p=t(r)),e(Math.pow(2,.002*Da())*S.k),u(r,p),a(n)}function h(){p=null}function g(){var n=L.of(this,arguments),r=Bo.mouse(this),i=t(r),s=Math.log(S.k)/Math.LN2;o(n),e(Math.pow(2,Bo.event.shiftKey?Math.ceil(s)-1:Math.floor(s)+1)),u(r,i),a(n),c(n)}var p,v,d,m,x,_,b,w,S={x:0,y:0,k:1},k=[960,500],E=Pa,A="mousedown.zoom",C="mousemove.zoom",N="mouseup.zoom",z="touchstart.zoom",L=M(n,"zoomstart","zoom","zoomend");return n.event=function(n){n.each(function(){var n=L.of(this,arguments),t=S;As?Bo.select(this).transition().each("start.zoom",function(){S=this.__chart__||{x:0,y:0,k:1},o(n)}).tween("zoom:zoom",function(){var r=k[0],e=k[1],u=r/2,i=e/2,o=Bo.interpolateZoom([(u-S.x)/S.k,(i-S.y)/S.k,r/S.k],[(u-t.x)/t.k,(i-t.y)/t.k,r/t.k]);return function(t){var e=o(t),c=r/e[2];this.__chart__=S={x:u-e[0]*c,y:i-e[1]*c,k:c},a(n)}}).each("end.zoom",function(){c(n)}):(this.__chart__=S,o(n),a(n),c(n))})},n.translate=function(t){return arguments.length?(S={x:+t[0],y:+t[1],k:S.k},i(),n):[S.x,S.y]},n.scale=function(t){return arguments.length?(S={x:S.x,y:S.y,k:+t},i(),n):S.k},n.scaleExtent=function(t){return arguments.length?(E=null==t?Pa:[+t[0],+t[1]],n):E},n.center=function(t){return arguments.length?(v=t&&[+t[0],+t[1]],n):v},n.size=function(t){return arguments.length?(k=t&&[+t[0],+t[1]],n):k},n.x=function(t){return arguments.length?(_=t,x=t.copy(),S={x:0,y:0,k:1},n):_},n.y=function(t){return arguments.length?(w=t,b=t.copy(),S={x:0,y:0,k:1},n):w},Bo.rebind(n,L,"on")};var Da,Pa=[0,1/0],Ua="onwheel"in Go?(Da=function(){return-Bo.event.deltaY*(Bo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Go?(Da=function(){return Bo.event.wheelDelta},"mousewheel"):(Da=function(){return-Bo.event.detail},"MozMousePixelScroll");rt.prototype.toString=function(){return this.rgb()+""},Bo.hsl=function(n,t,r){return 1===arguments.length?n instanceof ut?et(n.h,n.s,n.l):_t(""+n,bt,et):et(+n,+t,+r)};var ja=ut.prototype=new rt;ja.brighter=function(n){return n=Math.pow(.7,arguments.length?n:1),et(this.h,this.s,this.l/n)},ja.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),et(this.h,this.s,n*this.l)},ja.rgb=function(){return it(this.h,this.s,this.l)},Bo.hcl=function(n,t,r){return 1===arguments.length?n instanceof at?ot(n.h,n.c,n.l):n instanceof lt?ht(n.l,n.a,n.b):ht((n=wt((n=Bo.rgb(n)).r,n.g,n.b)).l,n.a,n.b):ot(+n,+t,+r)};var Ha=at.prototype=new rt;Ha.brighter=function(n){return ot(this.h,this.c,Math.min(100,this.l+Fa*(arguments.length?n:1)))},Ha.darker=function(n){return ot(this.h,this.c,Math.max(0,this.l-Fa*(arguments.length?n:1)))},Ha.rgb=function(){return ct(this.h,this.c,this.l).rgb()},Bo.lab=function(n,t,r){return 1===arguments.length?n instanceof lt?st(n.l,n.a,n.b):n instanceof at?ct(n.l,n.c,n.h):wt((n=Bo.rgb(n)).r,n.g,n.b):st(+n,+t,+r)};var Fa=18,Oa=.95047,Ia=1,Ya=1.08883,Za=lt.prototype=new rt;Za.brighter=function(n){return st(Math.min(100,this.l+Fa*(arguments.length?n:1)),this.a,this.b)},Za.darker=function(n){return st(Math.max(0,this.l-Fa*(arguments.length?n:1)),this.a,this.b)},Za.rgb=function(){return ft(this.l,this.a,this.b)},Bo.rgb=function(n,t,r){return 1===arguments.length?n instanceof xt?yt(n.r,n.g,n.b):_t(""+n,yt,it):yt(~~n,~~t,~~r)};var Va=xt.prototype=new rt;Va.brighter=function(n){n=Math.pow(.7,arguments.length?n:1);var t=this.r,r=this.g,e=this.b,u=30;return t||r||e?(t&&u>t&&(t=u),r&&u>r&&(r=u),e&&u>e&&(e=u),yt(Math.min(255,~~(t/n)),Math.min(255,~~(r/n)),Math.min(255,~~(e/n)))):yt(u,u,u)},Va.darker=function(n){return n=Math.pow(.7,arguments.length?n:1),yt(~~(n*this.r),~~(n*this.g),~~(n*this.b))},Va.hsl=function(){return bt(this.r,this.g,this.b)},Va.toString=function(){return"#"+Mt(this.r)+Mt(this.g)+Mt(this.b)};var $a=Bo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});$a.forEach(function(n,t){$a.set(n,dt(t))}),Bo.functor=Et,Bo.xhr=Ct(At),Bo.dsv=function(n,t){function r(n,r,i){arguments.length<3&&(i=r,r=null);var o=Nt(n,t,null==r?e:u(r),i);return o.row=function(n){return arguments.length?o.response(null==(r=n)?e:u(n)):r},o}function e(n){return r.parse(n.responseText)}function u(n){return function(t){return r.parse(t.responseText,n)}}function i(t){return t.map(o).join(n)}function o(n){return a.test(n)?'"'+n.replace(/\"/g,'""')+'"':n}var a=new RegExp('["'+n+"\n]"),c=n.charCodeAt(0);return r.parse=function(n,t){var e;return r.parseRows(n,function(n,r){if(e)return e(n,r-1);var u=new Function("d","return {"+n.map(function(n,t){return JSON.stringify(n)+": d["+t+"]"}).join(",")+"}");e=t?function(n,r){return t(u(n),r)}:u})},r.parseRows=function(n,t){function r(){if(l>=s)return o;if(u)return u=!1,i;var t=l;if(34===n.charCodeAt(t)){for(var r=t;r++<s;)if(34===n.charCodeAt(r)){if(34!==n.charCodeAt(r+1))break;++r}l=r+2;var e=n.charCodeAt(r+1);return 13===e?(u=!0,10===n.charCodeAt(r+2)&&++l):10===e&&(u=!0),n.substring(t+1,r).replace(/""/g,'"')}for(;s>l;){var e=n.charCodeAt(l++),a=1;if(10===e)u=!0;else if(13===e)u=!0,10===n.charCodeAt(l)&&(++l,++a);else if(e!==c)continue;return n.substring(t,l-a)}return n.substring(t)}for(var e,u,i={},o={},a=[],s=n.length,l=0,f=0;(e=r())!==o;){for(var h=[];e!==i&&e!==o;)h.push(e),e=r();(!t||(h=t(h,f++)))&&a.push(h)}return a},r.format=function(t){if(Array.isArray(t[0]))return r.formatRows(t);var e=new h,u=[];return t.forEach(function(n){for(var t in n)e.has(t)||u.push(e.add(t))}),[u.map(o).join(n)].concat(t.map(function(t){return u.map(function(n){return o(t[n])}).join(n)})).join("\n")},r.formatRows=function(n){return n.map(i).join("\n")},r},Bo.csv=Bo.dsv(",","text/csv"),Bo.tsv=Bo.dsv("	","text/tab-separated-values"),Bo.touch=function(n,t,r){if(arguments.length<3&&(r=t,t=x().changedTouches),t)for(var e,u=0,i=t.length;i>u;++u)if((e=t[u]).identifier===r)return Z(n,e)};var Xa,Ba,Ja,Wa,Ga,Ka=Qo[p(Qo,"requestAnimationFrame")]||function(n){setTimeout(n,17)};Bo.timer=function(n,t,r){var e=arguments.length;2>e&&(t=0),3>e&&(r=Date.now());var u=r+t,i={c:n,t:u,f:!1,n:null};Ba?Ba.n=i:Xa=i,Ba=i,Ja||(Wa=clearTimeout(Wa),Ja=1,Ka(Lt))},Bo.timer.flush=function(){Tt(),qt()},Bo.round=function(n,t){return t?Math.round(n*(t=Math.pow(10,t)))/t:Math.round(n)};var Qa=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"].map(Dt);Bo.formatPrefix=function(n,t){var r=0;return n&&(0>n&&(n*=-1),t&&(n=Bo.round(n,Rt(n,t))),r=1+Math.floor(1e-12+Math.log(n)/Math.LN10),r=Math.max(-24,Math.min(24,3*Math.floor((r-1)/3)))),Qa[8+r/3]};var nc=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,tc=Bo.map({b:function(n){return n.toString(2)},c:function(n){return String.fromCharCode(n)},o:function(n){return n.toString(8)},x:function(n){return n.toString(16)},X:function(n){return n.toString(16).toUpperCase()},g:function(n,t){return n.toPrecision(t)},e:function(n,t){return n.toExponential(t)},f:function(n,t){return n.toFixed(t)},r:function(n,t){return(n=Bo.round(n,Rt(n,t))).toFixed(Math.max(0,Math.min(20,Rt(n*(1+1e-15),t))))}}),rc=Bo.time={},ec=Date;jt.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){uc.setUTCDate.apply(this._,arguments)},setDay:function(){uc.setUTCDay.apply(this._,arguments)},setFullYear:function(){uc.setUTCFullYear.apply(this._,arguments)},setHours:function(){uc.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){uc.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){uc.setUTCMinutes.apply(this._,arguments)},setMonth:function(){uc.setUTCMonth.apply(this._,arguments)},setSeconds:function(){uc.setUTCSeconds.apply(this._,arguments)},setTime:function(){uc.setTime.apply(this._,arguments)}};var uc=Date.prototype;rc.year=Ht(function(n){return n=rc.day(n),n.setMonth(0,1),n},function(n,t){n.setFullYear(n.getFullYear()+t)},function(n){return n.getFullYear()}),rc.years=rc.year.range,rc.years.utc=rc.year.utc.range,rc.day=Ht(function(n){var t=new ec(2e3,0);return t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),t},function(n,t){n.setDate(n.getDate()+t)},function(n){return n.getDate()-1}),rc.days=rc.day.range,rc.days.utc=rc.day.utc.range,rc.dayOfYear=function(n){var t=rc.year(n);return Math.floor((n-t-6e4*(n.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(n,t){t=7-t;var r=rc[n]=Ht(function(n){return(n=rc.day(n)).setDate(n.getDate()-(n.getDay()+t)%7),n},function(n,t){n.setDate(n.getDate()+7*Math.floor(t))},function(n){var r=rc.year(n).getDay();return Math.floor((rc.dayOfYear(n)+(r+t)%7)/7)-(r!==t)});rc[n+"s"]=r.range,rc[n+"s"].utc=r.utc.range,rc[n+"OfYear"]=function(n){var r=rc.year(n).getDay();return Math.floor((rc.dayOfYear(n)+(r+t)%7)/7)}}),rc.week=rc.sunday,rc.weeks=rc.sunday.range,rc.weeks.utc=rc.sunday.utc.range,rc.weekOfYear=rc.sundayOfYear;var ic={"-":"",_:" ",0:"0"},oc=/^\s*\d+/,ac=/^%/;Bo.locale=function(n){return{numberFormat:Pt(n),timeFormat:Ot(n)}};var cc=Bo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Bo.format=cc.numberFormat,Bo.geo={},cr.prototype={s:0,t:0,add:function(n){sr(n,this.t,sc),sr(sc.s,this.s,this),this.s?this.t+=sc.t:this.s=sc.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var sc=new cr;Bo.geo.stream=function(n,t){n&&lc.hasOwnProperty(n.type)?lc[n.type](n,t):lr(n,t)};var lc={Feature:function(n,t){lr(n.geometry,t)},FeatureCollection:function(n,t){for(var r=n.features,e=-1,u=r.length;++e<u;)lr(r[e].geometry,t)}},fc={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var r=n.coordinates,e=-1,u=r.length;++e<u;)n=r[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){fr(n.coordinates,t,0)},MultiLineString:function(n,t){for(var r=n.coordinates,e=-1,u=r.length;++e<u;)fr(r[e],t,0)},Polygon:function(n,t){hr(n.coordinates,t)},MultiPolygon:function(n,t){for(var r=n.coordinates,e=-1,u=r.length;++e<u;)hr(r[e],t)},GeometryCollection:function(n,t){for(var r=n.geometries,e=-1,u=r.length;++e<u;)lr(r[e],t)}};Bo.geo.area=function(n){return hc=0,Bo.geo.stream(n,pc),hc};var hc,gc=new cr,pc={sphere:function(){hc+=4*ka},point:v,lineStart:v,lineEnd:v,polygonStart:function(){gc.reset(),pc.lineStart=gr},polygonEnd:function(){var n=2*gc;hc+=0>n?4*ka+n:n,pc.lineStart=pc.lineEnd=pc.point=v}};Bo.geo.bounds=function(){function n(n,t){x.push(M=[l=n,h=n]),f>t&&(f=t),t>g&&(g=t)}function t(t,r){var e=pr([t*za,r*za]);if(m){var u=dr(m,e),i=[u[1],-u[0],0],o=dr(i,u);xr(o),o=Mr(o);var c=t-p,s=c>0?1:-1,v=o[0]*La*s,d=ca(c)>180;if(d^(v>s*p&&s*t>v)){var y=o[1]*La;y>g&&(g=y)}else if(v=(v+360)%360-180,d^(v>s*p&&s*t>v)){var y=-o[1]*La;f>y&&(f=y)}else f>r&&(f=r),r>g&&(g=r);d?p>t?a(l,t)>a(l,h)&&(h=t):a(t,h)>a(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>p?a(l,t)>a(l,h)&&(h=t):a(t,h)>a(l,h)&&(l=t)}else n(t,r);m=e,p=t}function r(){_.point=t}function e(){M[0]=l,M[1]=h,_.point=n,m=null}function u(n,r){if(m){var e=n-p;y+=ca(e)>180?e+(e>0?360:-360):e}else v=n,d=r;pc.point(n,r),t(n,r)}function i(){pc.lineStart()}function o(){u(v,d),pc.lineEnd(),ca(y)>Ca&&(l=-(h=180)),M[0]=l,M[1]=h,m=null}function a(n,t){return(t-=n)<0?t+360:t}function c(n,t){return n[0]-t[0]}function s(n,t){return t[0]<=t[1]?t[0]<=n&&n<=t[1]:n<t[0]||t[1]<n}var l,f,h,g,p,v,d,m,y,x,M,_={point:n,lineStart:r,lineEnd:e,polygonStart:function(){_.point=u,_.lineStart=i,_.lineEnd=o,y=0,pc.polygonStart()},polygonEnd:function(){pc.polygonEnd(),_.point=n,_.lineStart=r,_.lineEnd=e,0>gc?(l=-(h=180),f=-(g=90)):y>Ca?g=90:-Ca>y&&(f=-90),M[0]=l,M[1]=h}};return function(n){g=h=-(l=f=1/0),x=[],Bo.geo.stream(n,_);var t=x.length;if(t){x.sort(c);for(var r,e=1,u=x[0],i=[u];t>e;++e)r=x[e],s(r[0],u)||s(r[1],u)?(a(u[0],r[1])>a(u[0],u[1])&&(u[1]=r[1]),a(r[0],u[1])>a(u[0],u[1])&&(u[0]=r[0])):i.push(u=r);for(var o,r,p=-1/0,t=i.length-1,e=0,u=i[t];t>=e;u=r,++e)r=i[e],(o=a(u[1],r[0]))>p&&(p=o,l=r[0],h=u[1])}return x=M=null,1/0===l||1/0===f?[[0/0,0/0],[0/0,0/0]]:[[l,f],[h,g]]
}}(),Bo.geo.centroid=function(n){vc=dc=mc=yc=xc=Mc=_c=bc=wc=Sc=kc=0,Bo.geo.stream(n,Ec);var t=wc,r=Sc,e=kc,u=t*t+r*r+e*e;return Na>u&&(t=Mc,r=_c,e=bc,Ca>dc&&(t=mc,r=yc,e=xc),u=t*t+r*r+e*e,Na>u)?[0/0,0/0]:[Math.atan2(r,t)*La,G(e/Math.sqrt(u))*La]};var vc,dc,mc,yc,xc,Mc,_c,bc,wc,Sc,kc,Ec={sphere:v,point:br,lineStart:Sr,lineEnd:kr,polygonStart:function(){Ec.lineStart=Er},polygonEnd:function(){Ec.lineStart=Sr}},Ac=Lr(Ar,Pr,jr,[-ka,-ka/2]),Cc=1e9;Bo.geo.clipExtent=function(){var n,t,r,e,u,i,o={stream:function(n){return u&&(u.valid=!1),u=i(n),u.valid=!0,u},extent:function(a){return arguments.length?(i=Or(n=+a[0][0],t=+a[0][1],r=+a[1][0],e=+a[1][1]),u&&(u.valid=!1,u=null),o):[[n,t],[r,e]]}};return o.extent([[0,0],[960,500]])},(Bo.geo.conicEqualArea=function(){return Yr(Zr)}).raw=Zr,Bo.geo.albers=function(){return Bo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},Bo.geo.albersUsa=function(){function n(n){var i=n[0],o=n[1];return t=null,r(i,o),t||(e(i,o),t)||u(i,o),t}var t,r,e,u,i=Bo.geo.albers(),o=Bo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),a=Bo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),c={point:function(n,r){t=[n,r]}};return n.invert=function(n){var t=i.scale(),r=i.translate(),e=(n[0]-r[0])/t,u=(n[1]-r[1])/t;return(u>=.12&&.234>u&&e>=-.425&&-.214>e?o:u>=.166&&.234>u&&e>=-.214&&-.115>e?a:i).invert(n)},n.stream=function(n){var t=i.stream(n),r=o.stream(n),e=a.stream(n);return{point:function(n,u){t.point(n,u),r.point(n,u),e.point(n,u)},sphere:function(){t.sphere(),r.sphere(),e.sphere()},lineStart:function(){t.lineStart(),r.lineStart(),e.lineStart()},lineEnd:function(){t.lineEnd(),r.lineEnd(),e.lineEnd()},polygonStart:function(){t.polygonStart(),r.polygonStart(),e.polygonStart()},polygonEnd:function(){t.polygonEnd(),r.polygonEnd(),e.polygonEnd()}}},n.precision=function(t){return arguments.length?(i.precision(t),o.precision(t),a.precision(t),n):i.precision()},n.scale=function(t){return arguments.length?(i.scale(t),o.scale(.35*t),a.scale(t),n.translate(i.translate())):i.scale()},n.translate=function(t){if(!arguments.length)return i.translate();var s=i.scale(),l=+t[0],f=+t[1];return r=i.translate(t).clipExtent([[l-.455*s,f-.238*s],[l+.455*s,f+.238*s]]).stream(c).point,e=o.translate([l-.307*s,f+.201*s]).clipExtent([[l-.425*s+Ca,f+.12*s+Ca],[l-.214*s-Ca,f+.234*s-Ca]]).stream(c).point,u=a.translate([l-.205*s,f+.212*s]).clipExtent([[l-.214*s+Ca,f+.166*s+Ca],[l-.115*s-Ca,f+.234*s-Ca]]).stream(c).point,n},n.scale(1070)};var Nc,zc,Lc,Tc,qc,Rc,Dc={point:v,lineStart:v,lineEnd:v,polygonStart:function(){zc=0,Dc.lineStart=Vr},polygonEnd:function(){Dc.lineStart=Dc.lineEnd=Dc.point=v,Nc+=ca(zc/2)}},Pc={point:$r,lineStart:v,lineEnd:v,polygonStart:v,polygonEnd:v},Uc={point:Jr,lineStart:Wr,lineEnd:Gr,polygonStart:function(){Uc.lineStart=Kr},polygonEnd:function(){Uc.point=Jr,Uc.lineStart=Wr,Uc.lineEnd=Gr}};Bo.geo.path=function(){function n(n){return n&&("function"==typeof a&&i.pointRadius(+a.apply(this,arguments)),o&&o.valid||(o=u(i)),Bo.geo.stream(n,o)),i.result()}function t(){return o=null,n}var r,e,u,i,o,a=4.5;return n.area=function(n){return Nc=0,Bo.geo.stream(n,u(Dc)),Nc},n.centroid=function(n){return mc=yc=xc=Mc=_c=bc=wc=Sc=kc=0,Bo.geo.stream(n,u(Uc)),kc?[wc/kc,Sc/kc]:bc?[Mc/bc,_c/bc]:xc?[mc/xc,yc/xc]:[0/0,0/0]},n.bounds=function(n){return qc=Rc=-(Lc=Tc=1/0),Bo.geo.stream(n,u(Pc)),[[Lc,Tc],[qc,Rc]]},n.projection=function(n){return arguments.length?(u=(r=n)?n.stream||te(n):At,t()):r},n.context=function(n){return arguments.length?(i=null==(e=n)?new Xr:new Qr(n),"function"!=typeof a&&i.pointRadius(a),t()):e},n.pointRadius=function(t){return arguments.length?(a="function"==typeof t?t:(i.pointRadius(+t),+t),n):a},n.projection(Bo.geo.albersUsa()).context(null)},Bo.geo.transform=function(n){return{stream:function(t){var r=new re(t);for(var e in n)r[e]=n[e];return r}}},re.prototype={point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Bo.geo.projection=ue,Bo.geo.projectionMutator=ie,(Bo.geo.equirectangular=function(){return ue(ae)}).raw=ae.invert=ae,Bo.geo.rotation=function(n){function t(t){return t=n(t[0]*za,t[1]*za),t[0]*=La,t[1]*=La,t}return n=se(n[0]%360*za,n[1]*za,n.length>2?n[2]*za:0),t.invert=function(t){return t=n.invert(t[0]*za,t[1]*za),t[0]*=La,t[1]*=La,t},t},ce.invert=ae,Bo.geo.circle=function(){function n(){var n="function"==typeof e?e.apply(this,arguments):e,t=se(-n[0]*za,-n[1]*za,0).invert,u=[];return r(null,null,1,{point:function(n,r){u.push(n=t(n,r)),n[0]*=La,n[1]*=La}}),{type:"Polygon",coordinates:[u]}}var t,r,e=[0,0],u=6;return n.origin=function(t){return arguments.length?(e=t,n):e},n.angle=function(e){return arguments.length?(r=ge((t=+e)*za,u*za),n):t},n.precision=function(e){return arguments.length?(r=ge(t*za,(u=+e)*za),n):u},n.angle(90)},Bo.geo.distance=function(n,t){var r,e=(t[0]-n[0])*za,u=n[1]*za,i=t[1]*za,o=Math.sin(e),a=Math.cos(e),c=Math.sin(u),s=Math.cos(u),l=Math.sin(i),f=Math.cos(i);return Math.atan2(Math.sqrt((r=f*o)*r+(r=s*l-c*f*a)*r),c*l+s*f*a)},Bo.geo.graticule=function(){function n(){return{type:"MultiLineString",coordinates:t()}}function t(){return Bo.range(Math.ceil(i/d)*d,u,d).map(h).concat(Bo.range(Math.ceil(s/m)*m,c,m).map(g)).concat(Bo.range(Math.ceil(e/p)*p,r,p).filter(function(n){return ca(n%d)>Ca}).map(l)).concat(Bo.range(Math.ceil(a/v)*v,o,v).filter(function(n){return ca(n%m)>Ca}).map(f))}var r,e,u,i,o,a,c,s,l,f,h,g,p=10,v=p,d=90,m=360,y=2.5;return n.lines=function(){return t().map(function(n){return{type:"LineString",coordinates:n}})},n.outline=function(){return{type:"Polygon",coordinates:[h(i).concat(g(c).slice(1),h(u).reverse().slice(1),g(s).reverse().slice(1))]}},n.extent=function(t){return arguments.length?n.majorExtent(t).minorExtent(t):n.minorExtent()},n.majorExtent=function(t){return arguments.length?(i=+t[0][0],u=+t[1][0],s=+t[0][1],c=+t[1][1],i>u&&(t=i,i=u,u=t),s>c&&(t=s,s=c,c=t),n.precision(y)):[[i,s],[u,c]]},n.minorExtent=function(t){return arguments.length?(e=+t[0][0],r=+t[1][0],a=+t[0][1],o=+t[1][1],e>r&&(t=e,e=r,r=t),a>o&&(t=a,a=o,o=t),n.precision(y)):[[e,a],[r,o]]},n.step=function(t){return arguments.length?n.majorStep(t).minorStep(t):n.minorStep()},n.majorStep=function(t){return arguments.length?(d=+t[0],m=+t[1],n):[d,m]},n.minorStep=function(t){return arguments.length?(p=+t[0],v=+t[1],n):[p,v]},n.precision=function(t){return arguments.length?(y=+t,l=ve(a,o,90),f=de(e,r,y),h=ve(s,c,90),g=de(i,u,y),n):y},n.majorExtent([[-180,-90+Ca],[180,90-Ca]]).minorExtent([[-180,-80-Ca],[180,80+Ca]])},Bo.geo.greatArc=function(){function n(){return{type:"LineString",coordinates:[t||e.apply(this,arguments),r||u.apply(this,arguments)]}}var t,r,e=me,u=ye;return n.distance=function(){return Bo.geo.distance(t||e.apply(this,arguments),r||u.apply(this,arguments))},n.source=function(r){return arguments.length?(e=r,t="function"==typeof r?null:r,n):e},n.target=function(t){return arguments.length?(u=t,r="function"==typeof t?null:t,n):u},n.precision=function(){return arguments.length?n:0},n},Bo.geo.interpolate=function(n,t){return xe(n[0]*za,n[1]*za,t[0]*za,t[1]*za)},Bo.geo.length=function(n){return jc=0,Bo.geo.stream(n,Hc),jc};var jc,Hc={sphere:v,point:v,lineStart:Me,lineEnd:v,polygonStart:v,polygonEnd:v},Fc=_e(function(n){return Math.sqrt(2/(1+n))},function(n){return 2*Math.asin(n/2)});(Bo.geo.azimuthalEqualArea=function(){return ue(Fc)}).raw=Fc;var Oc=_e(function(n){var t=Math.acos(n);return t&&t/Math.sin(t)},At);(Bo.geo.azimuthalEquidistant=function(){return ue(Oc)}).raw=Oc,(Bo.geo.conicConformal=function(){return Yr(be)}).raw=be,(Bo.geo.conicEquidistant=function(){return Yr(we)}).raw=we;var Ic=_e(function(n){return 1/n},Math.atan);(Bo.geo.gnomonic=function(){return ue(Ic)}).raw=Ic,Se.invert=function(n,t){return[n,2*Math.atan(Math.exp(t))-Aa]},(Bo.geo.mercator=function(){return ke(Se)}).raw=Se;var Yc=_e(function(){return 1},Math.asin);(Bo.geo.orthographic=function(){return ue(Yc)}).raw=Yc;var Zc=_e(function(n){return 1/(1+n)},function(n){return 2*Math.atan(n)});(Bo.geo.stereographic=function(){return ue(Zc)}).raw=Zc,Ee.invert=function(n,t){return[-t,2*Math.atan(Math.exp(n))-Aa]},(Bo.geo.transverseMercator=function(){var n=ke(Ee),t=n.center,r=n.rotate;return n.center=function(n){return n?t([-n[1],n[0]]):(n=t(),[-n[1],n[0]])},n.rotate=function(n){return n?r([n[0],n[1],n.length>2?n[2]+90:90]):(n=r(),[n[0],n[1],n[2]-90])},n.rotate([0,0])}).raw=Ee,Bo.geom={},Bo.geom.hull=function(n){function t(n){if(n.length<3)return[];var t,u=Et(r),i=Et(e),o=n.length,a=[],c=[];for(t=0;o>t;t++)a.push([+u.call(this,n[t],t),+i.call(this,n[t],t),t]);for(a.sort(ze),t=0;o>t;t++)c.push([a[t][0],-a[t][1]]);var s=Ne(a),l=Ne(c),f=l[0]===s[0],h=l[l.length-1]===s[s.length-1],g=[];for(t=s.length-1;t>=0;--t)g.push(n[a[s[t]][2]]);for(t=+f;t<l.length-h;++t)g.push(n[a[l[t]][2]]);return g}var r=Ae,e=Ce;return arguments.length?t(n):(t.x=function(n){return arguments.length?(r=n,t):r},t.y=function(n){return arguments.length?(e=n,t):e},t)},Bo.geom.polygon=function(n){return ga(n,Vc),n};var Vc=Bo.geom.polygon.prototype=[];Vc.area=function(){for(var n,t=-1,r=this.length,e=this[r-1],u=0;++t<r;)n=e,e=this[t],u+=n[1]*e[0]-n[0]*e[1];return.5*u},Vc.centroid=function(n){var t,r,e=-1,u=this.length,i=0,o=0,a=this[u-1];for(arguments.length||(n=-1/(6*this.area()));++e<u;)t=a,a=this[e],r=t[0]*a[1]-a[0]*t[1],i+=(t[0]+a[0])*r,o+=(t[1]+a[1])*r;return[i*n,o*n]},Vc.clip=function(n){for(var t,r,e,u,i,o,a=qe(n),c=-1,s=this.length-qe(this),l=this[s-1];++c<s;){for(t=n.slice(),n.length=0,u=this[c],i=t[(e=t.length-a)-1],r=-1;++r<e;)o=t[r],Le(o,l,u)?(Le(i,l,u)||n.push(Te(i,o,l,u)),n.push(o)):Le(i,l,u)&&n.push(Te(i,o,l,u)),i=o;a&&n.push(n[0]),l=u}return n};var $c,Xc,Bc,Jc,Wc,Gc=[],Kc=[];Oe.prototype.prepare=function(){for(var n,t=this.edges,r=t.length;r--;)n=t[r].edge,n.b&&n.a||t.splice(r,1);return t.sort(Ye),t.length},Qe.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},nu.prototype={insert:function(n,t){var r,e,u;if(n){if(t.P=n,t.N=n.N,n.N&&(n.N.P=t),n.N=t,n.R){for(n=n.R;n.L;)n=n.L;n.L=t}else n.R=t;r=n}else this._?(n=uu(this._),t.P=null,t.N=n,n.P=n.L=t,r=n):(t.P=t.N=null,this._=t,r=null);for(t.L=t.R=null,t.U=r,t.C=!0,n=t;r&&r.C;)e=r.U,r===e.L?(u=e.R,u&&u.C?(r.C=u.C=!1,e.C=!0,n=e):(n===r.R&&(ru(this,r),n=r,r=n.U),r.C=!1,e.C=!0,eu(this,e))):(u=e.L,u&&u.C?(r.C=u.C=!1,e.C=!0,n=e):(n===r.L&&(eu(this,r),n=r,r=n.U),r.C=!1,e.C=!0,ru(this,e))),r=n.U;this._.C=!1},remove:function(n){n.N&&(n.N.P=n.P),n.P&&(n.P.N=n.N),n.N=n.P=null;var t,r,e,u=n.U,i=n.L,o=n.R;if(r=i?o?uu(o):i:o,u?u.L===n?u.L=r:u.R=r:this._=r,i&&o?(e=r.C,r.C=n.C,r.L=i,i.U=r,r!==o?(u=r.U,r.U=n.U,n=r.R,u.L=n,r.R=o,o.U=r):(r.U=u,u=r,n=r.R)):(e=n.C,n=r),n&&(n.U=u),!e){if(n&&n.C)return n.C=!1,void 0;do{if(n===this._)break;if(n===u.L){if(t=u.R,t.C&&(t.C=!1,u.C=!0,ru(this,u),t=u.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,eu(this,t),t=u.R),t.C=u.C,u.C=t.R.C=!1,ru(this,u),n=this._;break}}else if(t=u.L,t.C&&(t.C=!1,u.C=!0,eu(this,u),t=u.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ru(this,t),t=u.L),t.C=u.C,u.C=t.L.C=!1,eu(this,u),n=this._;break}t.C=!0,n=u,u=u.U}while(!n.C);n&&(n.C=!1)}}},Bo.geom.voronoi=function(n){function t(n){var t=new Array(n.length),e=a[0][0],u=a[0][1],i=a[1][0],o=a[1][1];return iu(r(n),a).cells.forEach(function(r,a){var c=r.edges,s=r.site,l=t[a]=c.length?c.map(function(n){var t=n.start();return[t.x,t.y]}):s.x>=e&&s.x<=i&&s.y>=u&&s.y<=o?[[e,o],[i,o],[i,u],[e,u]]:[];l.point=n[a]}),t}function r(n){return n.map(function(n,t){return{x:Math.round(i(n,t)/Ca)*Ca,y:Math.round(o(n,t)/Ca)*Ca,i:t}})}var e=Ae,u=Ce,i=e,o=u,a=Qc;return n?t(n):(t.links=function(n){return iu(r(n)).edges.filter(function(n){return n.l&&n.r}).map(function(t){return{source:n[t.l.i],target:n[t.r.i]}})},t.triangles=function(n){var t=[];return iu(r(n)).cells.forEach(function(r,e){for(var u,i,o=r.site,a=r.edges.sort(Ye),c=-1,s=a.length,l=a[s-1].edge,f=l.l===o?l.r:l.l;++c<s;)u=l,i=f,l=a[c].edge,f=l.l===o?l.r:l.l,e<i.i&&e<f.i&&au(o,i,f)<0&&t.push([n[e],n[i.i],n[f.i]])}),t},t.x=function(n){return arguments.length?(i=Et(e=n),t):e},t.y=function(n){return arguments.length?(o=Et(u=n),t):u},t.clipExtent=function(n){return arguments.length?(a=null==n?Qc:n,t):a===Qc?null:a},t.size=function(n){return arguments.length?t.clipExtent(n&&[[0,0],n]):a===Qc?null:a&&a[1]},t)};var Qc=[[-1e6,-1e6],[1e6,1e6]];Bo.geom.delaunay=function(n){return Bo.geom.voronoi().triangles(n)},Bo.geom.quadtree=function(n,t,r,e,u){function i(n){function i(n,t,r,e,u,i,o,a){if(!isNaN(r)&&!isNaN(e))if(n.leaf){var c=n.x,l=n.y;if(null!=c)if(ca(c-r)+ca(l-e)<.01)s(n,t,r,e,u,i,o,a);else{var f=n.point;n.x=n.y=n.point=null,s(n,f,c,l,u,i,o,a),s(n,t,r,e,u,i,o,a)}else n.x=r,n.y=e,n.point=t}else s(n,t,r,e,u,i,o,a)}function s(n,t,r,e,u,o,a,c){var s=.5*(u+a),l=.5*(o+c),f=r>=s,h=e>=l,g=(h<<1)+f;n.leaf=!1,n=n.nodes[g]||(n.nodes[g]=lu()),f?u=s:a=s,h?o=l:c=l,i(n,t,r,e,u,o,a,c)}var l,f,h,g,p,v,d,m,y,x=Et(a),M=Et(c);if(null!=t)v=t,d=r,m=e,y=u;else if(m=y=-(v=d=1/0),f=[],h=[],p=n.length,o)for(g=0;p>g;++g)l=n[g],l.x<v&&(v=l.x),l.y<d&&(d=l.y),l.x>m&&(m=l.x),l.y>y&&(y=l.y),f.push(l.x),h.push(l.y);else for(g=0;p>g;++g){var _=+x(l=n[g],g),b=+M(l,g);v>_&&(v=_),d>b&&(d=b),_>m&&(m=_),b>y&&(y=b),f.push(_),h.push(b)}var w=m-v,S=y-d;w>S?y=d+w:m=v+S;var k=lu();if(k.add=function(n){i(k,n,+x(n,++g),+M(n,g),v,d,m,y)},k.visit=function(n){fu(n,k,v,d,m,y)},g=-1,null==t){for(;++g<p;)i(k,n[g],f[g],h[g],v,d,m,y);--g}else n.forEach(k.add);return f=h=n=l=null,k}var o,a=Ae,c=Ce;return(o=arguments.length)?(a=cu,c=su,3===o&&(u=r,e=t,r=t=0),i(n)):(i.x=function(n){return arguments.length?(a=n,i):a},i.y=function(n){return arguments.length?(c=n,i):c},i.extent=function(n){return arguments.length?(null==n?t=r=e=u=null:(t=+n[0][0],r=+n[0][1],e=+n[1][0],u=+n[1][1]),i):null==t?null:[[t,r],[e,u]]},i.size=function(n){return arguments.length?(null==n?t=r=e=u=null:(t=r=0,e=+n[0],u=+n[1]),i):null==t?null:[e-t,u-r]},i)},Bo.interpolateRgb=hu,Bo.interpolateObject=gu,Bo.interpolateNumber=pu,Bo.interpolateString=vu;var ns=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ts=new RegExp(ns.source,"g");Bo.interpolate=du,Bo.interpolators=[function(n,t){var r=typeof t;return("string"===r?$a.has(t)||/^(#|rgb\(|hsl\()/.test(t)?hu:vu:t instanceof rt?hu:Array.isArray(t)?mu:"object"===r&&isNaN(t)?gu:pu)(n,t)}],Bo.interpolateArray=mu;var rs=function(){return At},es=Bo.map({linear:rs,poly:Su,quad:function(){return _u},cubic:function(){return bu},sin:function(){return ku},exp:function(){return Eu},circle:function(){return Au},elastic:Cu,back:Nu,bounce:function(){return zu}}),us=Bo.map({"in":At,out:xu,"in-out":Mu,"out-in":function(n){return Mu(xu(n))}});Bo.ease=function(n){var t=n.indexOf("-"),r=t>=0?n.substring(0,t):n,e=t>=0?n.substring(t+1):"in";return r=es.get(r)||rs,e=us.get(e)||At,yu(e(r.apply(null,Jo.call(arguments,1))))},Bo.interpolateHcl=Lu,Bo.interpolateHsl=Tu,Bo.interpolateLab=qu,Bo.interpolateRound=Ru,Bo.transform=function(n){var t=Go.createElementNS(Bo.ns.prefix.svg,"g");return(Bo.transform=function(n){if(null!=n){t.setAttribute("transform",n);var r=t.transform.baseVal.consolidate()}return new Du(r?r.matrix:is)})(n)},Du.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var is={a:1,b:0,c:0,d:1,e:0,f:0};Bo.interpolateTransform=Hu,Bo.layout={},Bo.layout.bundle=function(){return function(n){for(var t=[],r=-1,e=n.length;++r<e;)t.push(Iu(n[r]));return t}},Bo.layout.chord=function(){function n(){var n,s,f,h,g,p={},v=[],d=Bo.range(i),m=[];for(r=[],e=[],n=0,h=-1;++h<i;){for(s=0,g=-1;++g<i;)s+=u[h][g];v.push(s),m.push(Bo.range(i)),n+=s}for(o&&d.sort(function(n,t){return o(v[n],v[t])}),a&&m.forEach(function(n,t){n.sort(function(n,r){return a(u[t][n],u[t][r])})}),n=(Ea-l*i)/n,s=0,h=-1;++h<i;){for(f=s,g=-1;++g<i;){var y=d[h],x=m[y][g],M=u[y][x],_=s,b=s+=M*n;p[y+"-"+x]={index:y,subindex:x,startAngle:_,endAngle:b,value:M}}e[y]={index:y,startAngle:f,endAngle:s,value:(s-f)/n},s+=l}for(h=-1;++h<i;)for(g=h-1;++g<i;){var w=p[h+"-"+g],S=p[g+"-"+h];(w.value||S.value)&&r.push(w.value<S.value?{source:S,target:w}:{source:w,target:S})}c&&t()}function t(){r.sort(function(n,t){return c((n.source.value+n.target.value)/2,(t.source.value+t.target.value)/2)})}var r,e,u,i,o,a,c,s={},l=0;return s.matrix=function(n){return arguments.length?(i=(u=n)&&u.length,r=e=null,s):u},s.padding=function(n){return arguments.length?(l=n,r=e=null,s):l},s.sortGroups=function(n){return arguments.length?(o=n,r=e=null,s):o},s.sortSubgroups=function(n){return arguments.length?(a=n,r=null,s):a},s.sortChords=function(n){return arguments.length?(c=n,r&&t(),s):c},s.chords=function(){return r||n(),r},s.groups=function(){return e||n(),e},s},Bo.layout.force=function(){function n(n){return function(t,r,e,u){if(t.point!==n){var i=t.cx-n.x,o=t.cy-n.y,a=u-r,c=i*i+o*o;if(c>a*a/d){if(p>c){var s=t.charge/c;n.px-=i*s,n.py-=o*s}return!0}if(t.point&&c&&p>c){var s=t.pointCharge/c;n.px-=i*s,n.py-=o*s}}return!t.charge}}function t(n){n.px=Bo.event.x,n.py=Bo.event.y,a.resume()}var r,e,u,i,o,a={},c=Bo.dispatch("start","tick","end"),s=[1,1],l=.9,f=os,h=as,g=-30,p=cs,v=.1,d=.64,m=[],y=[];return a.tick=function(){if((e*=.99)<.005)return c.end({type:"end",alpha:e=0}),!0;var t,r,a,f,h,p,d,x,M,_=m.length,b=y.length;for(r=0;b>r;++r)a=y[r],f=a.source,h=a.target,x=h.x-f.x,M=h.y-f.y,(p=x*x+M*M)&&(p=e*i[r]*((p=Math.sqrt(p))-u[r])/p,x*=p,M*=p,h.x-=x*(d=f.weight/(h.weight+f.weight)),h.y-=M*d,f.x+=x*(d=1-d),f.y+=M*d);if((d=e*v)&&(x=s[0]/2,M=s[1]/2,r=-1,d))for(;++r<_;)a=m[r],a.x+=(x-a.x)*d,a.y+=(M-a.y)*d;if(g)for(Ju(t=Bo.geom.quadtree(m),e,o),r=-1;++r<_;)(a=m[r]).fixed||t.visit(n(a));for(r=-1;++r<_;)a=m[r],a.fixed?(a.x=a.px,a.y=a.py):(a.x-=(a.px-(a.px=a.x))*l,a.y-=(a.py-(a.py=a.y))*l);c.tick({type:"tick",alpha:e})},a.nodes=function(n){return arguments.length?(m=n,a):m},a.links=function(n){return arguments.length?(y=n,a):y},a.size=function(n){return arguments.length?(s=n,a):s},a.linkDistance=function(n){return arguments.length?(f="function"==typeof n?n:+n,a):f},a.distance=a.linkDistance,a.linkStrength=function(n){return arguments.length?(h="function"==typeof n?n:+n,a):h},a.friction=function(n){return arguments.length?(l=+n,a):l},a.charge=function(n){return arguments.length?(g="function"==typeof n?n:+n,a):g},a.chargeDistance=function(n){return arguments.length?(p=n*n,a):Math.sqrt(p)},a.gravity=function(n){return arguments.length?(v=+n,a):v},a.theta=function(n){return arguments.length?(d=n*n,a):Math.sqrt(d)},a.alpha=function(n){return arguments.length?(n=+n,e?e=n>0?n:0:n>0&&(c.start({type:"start",alpha:e=n}),Bo.timer(a.tick)),a):e},a.start=function(){function n(n,e){if(!r){for(r=new Array(c),a=0;c>a;++a)r[a]=[];for(a=0;s>a;++a){var u=y[a];r[u.source.index].push(u.target),r[u.target.index].push(u.source)}}for(var i,o=r[t],a=-1,s=o.length;++a<s;)if(!isNaN(i=o[a][n]))return i;return Math.random()*e}var t,r,e,c=m.length,l=y.length,p=s[0],v=s[1];for(t=0;c>t;++t)(e=m[t]).index=t,e.weight=0;for(t=0;l>t;++t)e=y[t],"number"==typeof e.source&&(e.source=m[e.source]),"number"==typeof e.target&&(e.target=m[e.target]),++e.source.weight,++e.target.weight;for(t=0;c>t;++t)e=m[t],isNaN(e.x)&&(e.x=n("x",p)),isNaN(e.y)&&(e.y=n("y",v)),isNaN(e.px)&&(e.px=e.x),isNaN(e.py)&&(e.py=e.y);if(u=[],"function"==typeof f)for(t=0;l>t;++t)u[t]=+f.call(this,y[t],t);else for(t=0;l>t;++t)u[t]=f;if(i=[],"function"==typeof h)for(t=0;l>t;++t)i[t]=+h.call(this,y[t],t);else for(t=0;l>t;++t)i[t]=h;if(o=[],"function"==typeof g)for(t=0;c>t;++t)o[t]=+g.call(this,m[t],t);else for(t=0;c>t;++t)o[t]=g;return a.resume()},a.resume=function(){return a.alpha(.1)},a.stop=function(){return a.alpha(0)},a.drag=function(){return r||(r=Bo.behavior.drag().origin(At).on("dragstart.force",Vu).on("drag.force",t).on("dragend.force",$u)),arguments.length?(this.on("mouseover.force",Xu).on("mouseout.force",Bu).call(r),void 0):r},Bo.rebind(a,c,"on")};var os=20,as=1,cs=1/0;Bo.layout.hierarchy=function(){function n(u){var i,o=[u],a=[];for(u.depth=0;null!=(i=o.pop());)if(a.push(i),(s=r.call(n,i,i.depth))&&(c=s.length)){for(var c,s,l;--c>=0;)o.push(l=s[c]),l.parent=i,l.depth=i.depth+1;e&&(i.value=0),i.children=s}else e&&(i.value=+e.call(n,i,i.depth)||0),delete i.children;return Ku(u,function(n){var r,u;t&&(r=n.children)&&r.sort(t),e&&(u=n.parent)&&(u.value+=n.value)}),a}var t=ti,r=Qu,e=ni;return n.sort=function(r){return arguments.length?(t=r,n):t},n.children=function(t){return arguments.length?(r=t,n):r},n.value=function(t){return arguments.length?(e=t,n):e},n.revalue=function(t){return e&&(Gu(t,function(n){n.children&&(n.value=0)}),Ku(t,function(t){var r;t.children||(t.value=+e.call(n,t,t.depth)||0),(r=t.parent)&&(r.value+=t.value)})),t},n},Bo.layout.partition=function(){function n(t,r,e,u){var i=t.children;if(t.x=r,t.y=t.depth*u,t.dx=e,t.dy=u,i&&(o=i.length)){var o,a,c,s=-1;for(e=t.value?e/t.value:0;++s<o;)n(a=i[s],r,c=a.value*e,u),r+=c}}function t(n){var r=n.children,e=0;if(r&&(u=r.length))for(var u,i=-1;++i<u;)e=Math.max(e,t(r[i]));return 1+e}function r(r,i){var o=e.call(this,r,i);return n(o[0],0,u[0],u[1]/t(o[0])),o}var e=Bo.layout.hierarchy(),u=[1,1];return r.size=function(n){return arguments.length?(u=n,r):u},Wu(r,e)},Bo.layout.pie=function(){function n(i){var o=i.map(function(r,e){return+t.call(n,r,e)}),a=+("function"==typeof e?e.apply(this,arguments):e),c=(("function"==typeof u?u.apply(this,arguments):u)-a)/Bo.sum(o),s=Bo.range(i.length);null!=r&&s.sort(r===ss?function(n,t){return o[t]-o[n]}:function(n,t){return r(i[n],i[t])});var l=[];return s.forEach(function(n){var t;l[n]={data:i[n],value:t=o[n],startAngle:a,endAngle:a+=t*c}}),l}var t=Number,r=ss,e=0,u=Ea;return n.value=function(r){return arguments.length?(t=r,n):t},n.sort=function(t){return arguments.length?(r=t,n):r},n.startAngle=function(t){return arguments.length?(e=t,n):e},n.endAngle=function(t){return arguments.length?(u=t,n):u},n};var ss={};Bo.layout.stack=function(){function n(a,c){var s=a.map(function(r,e){return t.call(n,r,e)}),l=s.map(function(t){return t.map(function(t,r){return[i.call(n,t,r),o.call(n,t,r)]})}),f=r.call(n,l,c);s=Bo.permute(s,f),l=Bo.permute(l,f);var h,g,p,v=e.call(n,l,c),d=s.length,m=s[0].length;for(g=0;m>g;++g)for(u.call(n,s[0][g],p=v[g],l[0][g][1]),h=1;d>h;++h)u.call(n,s[h][g],p+=l[h-1][g][1],l[h][g][1]);return a}var t=At,r=oi,e=ai,u=ii,i=ei,o=ui;return n.values=function(r){return arguments.length?(t=r,n):t},n.order=function(t){return arguments.length?(r="function"==typeof t?t:ls.get(t)||oi,n):r},n.offset=function(t){return arguments.length?(e="function"==typeof t?t:fs.get(t)||ai,n):e},n.x=function(t){return arguments.length?(i=t,n):i},n.y=function(t){return arguments.length?(o=t,n):o},n.out=function(t){return arguments.length?(u=t,n):u},n};var ls=Bo.map({"inside-out":function(n){var t,r,e=n.length,u=n.map(ci),i=n.map(si),o=Bo.range(e).sort(function(n,t){return u[n]-u[t]}),a=0,c=0,s=[],l=[];for(t=0;e>t;++t)r=o[t],c>a?(a+=i[r],s.push(r)):(c+=i[r],l.push(r));return l.reverse().concat(s)},reverse:function(n){return Bo.range(n.length).reverse()},"default":oi}),fs=Bo.map({silhouette:function(n){var t,r,e,u=n.length,i=n[0].length,o=[],a=0,c=[];for(r=0;i>r;++r){for(t=0,e=0;u>t;t++)e+=n[t][r][1];e>a&&(a=e),o.push(e)}for(r=0;i>r;++r)c[r]=(a-o[r])/2;return c},wiggle:function(n){var t,r,e,u,i,o,a,c,s,l=n.length,f=n[0],h=f.length,g=[];for(g[0]=c=s=0,r=1;h>r;++r){for(t=0,u=0;l>t;++t)u+=n[t][r][1];for(t=0,i=0,a=f[r][0]-f[r-1][0];l>t;++t){for(e=0,o=(n[t][r][1]-n[t][r-1][1])/(2*a);t>e;++e)o+=(n[e][r][1]-n[e][r-1][1])/a;i+=o*n[t][r][1]}g[r]=c-=u?i/u*a:0,s>c&&(s=c)}for(r=0;h>r;++r)g[r]-=s;return g},expand:function(n){var t,r,e,u=n.length,i=n[0].length,o=1/u,a=[];for(r=0;i>r;++r){for(t=0,e=0;u>t;t++)e+=n[t][r][1];if(e)for(t=0;u>t;t++)n[t][r][1]/=e;else for(t=0;u>t;t++)n[t][r][1]=o}for(r=0;i>r;++r)a[r]=0;return a},zero:ai});Bo.layout.histogram=function(){function n(n,i){for(var o,a,c=[],s=n.map(r,this),l=e.call(this,s,i),f=u.call(this,l,s,i),i=-1,h=s.length,g=f.length-1,p=t?1:1/h;++i<g;)o=c[i]=[],o.dx=f[i+1]-(o.x=f[i]),o.y=0;if(g>0)for(i=-1;++i<h;)a=s[i],a>=l[0]&&a<=l[1]&&(o=c[Bo.bisect(f,a,1,g)-1],o.y+=p,o.push(n[i]));return c}var t=!0,r=Number,e=gi,u=fi;return n.value=function(t){return arguments.length?(r=t,n):r},n.range=function(t){return arguments.length?(e=Et(t),n):e},n.bins=function(t){return arguments.length?(u="number"==typeof t?function(n){return hi(n,t)}:Et(t),n):u},n.frequency=function(r){return arguments.length?(t=!!r,n):t},n},Bo.layout.pack=function(){function n(n,i){var o=r.call(this,n,i),a=o[0],c=u[0],s=u[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(a.x=a.y=0,Ku(a,function(n){n.r=+l(n.value)}),Ku(a,yi),e){var f=e*(t?1:Math.max(2*a.r/c,2*a.r/s))/2;Ku(a,function(n){n.r+=f}),Ku(a,yi),Ku(a,function(n){n.r-=f})}return _i(a,c/2,s/2,t?1:1/Math.max(2*a.r/c,2*a.r/s)),o}var t,r=Bo.layout.hierarchy().sort(pi),e=0,u=[1,1];return n.size=function(t){return arguments.length?(u=t,n):u},n.radius=function(r){return arguments.length?(t=null==r||"function"==typeof r?r:+r,n):t},n.padding=function(t){return arguments.length?(e=+t,n):e},Wu(n,r)},Bo.layout.tree=function(){function n(n,u){var l=o.call(this,n,u),f=l[0],h=t(f);if(Ku(h,r),h.parent.m=-h.z,Gu(h,e),s)Gu(f,i);else{var g=f,p=f,v=f;Gu(f,function(n){n.x<g.x&&(g=n),n.x>p.x&&(p=n),n.depth>v.depth&&(v=n)});var d=a(g,p)/2-g.x,m=c[0]/(p.x+a(p,g)/2+d),y=c[1]/(v.depth||1);Gu(f,function(n){n.x=(n.x+d)*m,n.y=n.depth*y})}return l}function t(n){for(var t,r={A:null,children:[n]},e=[r];null!=(t=e.pop());)for(var u,i=t.children,o=0,a=i.length;a>o;++o)e.push((i[o]=u={_:i[o],parent:t,children:(u=i[o].children)&&u.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=u);return r.children[0]}function r(n){var t=n.children,r=n.parent.children,e=n.i?r[n.i-1]:null;if(t.length){Ai(n);var i=(t[0].z+t[t.length-1].z)/2;e?(n.z=e.z+a(n._,e._),n.m=n.z-i):n.z=i}else e&&(n.z=e.z+a(n._,e._));n.parent.A=u(n,e,n.parent.A||r[0])}function e(n){n._.x=n.z+n.parent.m,n.m+=n.parent.m}function u(n,t,r){if(t){for(var e,u=n,i=n,o=t,c=u.parent.children[0],s=u.m,l=i.m,f=o.m,h=c.m;o=ki(o),u=Si(u),o&&u;)c=Si(c),i=ki(i),i.a=n,e=o.z+f-u.z-s+a(o._,u._),e>0&&(Ei(Ci(o,n,r),n,e),s+=e,l+=e),f+=o.m,s+=u.m,h+=c.m,l+=i.m;o&&!ki(i)&&(i.t=o,i.m+=f-l),u&&!Si(c)&&(c.t=u,c.m+=s-h,r=n)}return r}function i(n){n.x*=c[0],n.y=n.depth*c[1]}var o=Bo.layout.hierarchy().sort(null).value(null),a=wi,c=[1,1],s=null;return n.separation=function(t){return arguments.length?(a=t,n):a},n.size=function(t){return arguments.length?(s=null==(c=t)?i:null,n):s?null:c},n.nodeSize=function(t){return arguments.length?(s=null==(c=t)?null:i,n):s?c:null},Wu(n,o)},Bo.layout.cluster=function(){function n(n,i){var o,a=t.call(this,n,i),c=a[0],s=0;Ku(c,function(n){var t=n.children;t&&t.length?(n.x=zi(t),n.y=Ni(t)):(n.x=o?s+=r(n,o):0,n.y=0,o=n)});var l=Li(c),f=Ti(c),h=l.x-r(l,f)/2,g=f.x+r(f,l)/2;return Ku(c,u?function(n){n.x=(n.x-c.x)*e[0],n.y=(c.y-n.y)*e[1]}:function(n){n.x=(n.x-h)/(g-h)*e[0],n.y=(1-(c.y?n.y/c.y:1))*e[1]}),a}var t=Bo.layout.hierarchy().sort(null).value(null),r=wi,e=[1,1],u=!1;return n.separation=function(t){return arguments.length?(r=t,n):r},n.size=function(t){return arguments.length?(u=null==(e=t),n):u?null:e},n.nodeSize=function(t){return arguments.length?(u=null!=(e=t),n):u?e:null},Wu(n,t)},Bo.layout.treemap=function(){function n(n,t){for(var r,e,u=-1,i=n.length;++u<i;)e=(r=n[u]).value*(0>t?0:t),r.area=isNaN(e)||0>=e?0:e}function t(r){var i=r.children;if(i&&i.length){var o,a,c,s=f(r),l=[],h=i.slice(),p=1/0,v="slice"===g?s.dx:"dice"===g?s.dy:"slice-dice"===g?1&r.depth?s.dy:s.dx:Math.min(s.dx,s.dy);for(n(h,s.dx*s.dy/r.value),l.area=0;(c=h.length)>0;)l.push(o=h[c-1]),l.area+=o.area,"squarify"!==g||(a=e(l,v))<=p?(h.pop(),p=a):(l.area-=l.pop().area,u(l,v,s,!1),v=Math.min(s.dx,s.dy),l.length=l.area=0,p=1/0);l.length&&(u(l,v,s,!0),l.length=l.area=0),i.forEach(t)}}function r(t){var e=t.children;if(e&&e.length){var i,o=f(t),a=e.slice(),c=[];for(n(a,o.dx*o.dy/t.value),c.area=0;i=a.pop();)c.push(i),c.area+=i.area,null!=i.z&&(u(c,i.z?o.dx:o.dy,o,!a.length),c.length=c.area=0);e.forEach(r)}}function e(n,t){for(var r,e=n.area,u=0,i=1/0,o=-1,a=n.length;++o<a;)(r=n[o].area)&&(i>r&&(i=r),r>u&&(u=r));return e*=e,t*=t,e?Math.max(t*u*p/e,e/(t*i*p)):1/0}function u(n,t,r,e){var u,i=-1,o=n.length,a=r.x,s=r.y,l=t?c(n.area/t):0;if(t==r.dx){for((e||l>r.dy)&&(l=r.dy);++i<o;)u=n[i],u.x=a,u.y=s,u.dy=l,a+=u.dx=Math.min(r.x+r.dx-a,l?c(u.area/l):0);u.z=!0,u.dx+=r.x+r.dx-a,r.y+=l,r.dy-=l}else{for((e||l>r.dx)&&(l=r.dx);++i<o;)u=n[i],u.x=a,u.y=s,u.dx=l,s+=u.dy=Math.min(r.y+r.dy-s,l?c(u.area/l):0);u.z=!1,u.dy+=r.y+r.dy-s,r.x+=l,r.dx-=l}}function i(e){var u=o||a(e),i=u[0];return i.x=0,i.y=0,i.dx=s[0],i.dy=s[1],o&&a.revalue(i),n([i],i.dx*i.dy/i.value),(o?r:t)(i),h&&(o=u),u}var o,a=Bo.layout.hierarchy(),c=Math.round,s=[1,1],l=null,f=qi,h=!1,g="squarify",p=.5*(1+Math.sqrt(5));return i.size=function(n){return arguments.length?(s=n,i):s},i.padding=function(n){function t(t){var r=n.call(i,t,t.depth);return null==r?qi(t):Ri(t,"number"==typeof r?[r,r,r,r]:r)}function r(t){return Ri(t,n)}if(!arguments.length)return l;var e;return f=null==(l=n)?qi:"function"==(e=typeof n)?t:"number"===e?(n=[n,n,n,n],r):r,i},i.round=function(n){return arguments.length?(c=n?Math.round:Number,i):c!=Number},i.sticky=function(n){return arguments.length?(h=n,o=null,i):h},i.ratio=function(n){return arguments.length?(p=n,i):p},i.mode=function(n){return arguments.length?(g=n+"",i):g},Wu(i,a)},Bo.random={normal:function(n,t){var r=arguments.length;return 2>r&&(t=1),1>r&&(n=0),function(){var r,e,u;do r=2*Math.random()-1,e=2*Math.random()-1,u=r*r+e*e;while(!u||u>1);return n+t*r*Math.sqrt(-2*Math.log(u)/u)}},logNormal:function(){var n=Bo.random.normal.apply(Bo,arguments);return function(){return Math.exp(n())}},bates:function(n){var t=Bo.random.irwinHall(n);return function(){return t()/n}},irwinHall:function(n){return function(){for(var t=0,r=0;n>r;r++)t+=Math.random();return t}}},Bo.scale={};var hs={floor:At,ceil:At};Bo.scale.linear=function(){return Oi([0,1],[0,1],du,!1)};var gs={s:1,g:1,p:1,r:1,e:1};Bo.scale.log=function(){return Ji(Bo.scale.linear().domain([0,1]),10,!0,[1,10])};var ps=Bo.format(".0e"),vs={floor:function(n){return-Math.ceil(-n)},ceil:function(n){return-Math.floor(-n)}};Bo.scale.pow=function(){return Wi(Bo.scale.linear(),1,[0,1])},Bo.scale.sqrt=function(){return Bo.scale.pow().exponent(.5)},Bo.scale.ordinal=function(){return Ki([],{t:"range",a:[[]]})},Bo.scale.category10=function(){return Bo.scale.ordinal().range(ds)},Bo.scale.category20=function(){return Bo.scale.ordinal().range(ms)},Bo.scale.category20b=function(){return Bo.scale.ordinal().range(ys)},Bo.scale.category20c=function(){return Bo.scale.ordinal().range(xs)};var ds=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(mt),ms=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(mt),ys=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(mt),xs=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(mt);Bo.scale.quantile=function(){return Qi([],[])},Bo.scale.quantize=function(){return no(0,1,[0,1])},Bo.scale.threshold=function(){return to([.5],[0,1])},Bo.scale.identity=function(){return ro([0,1])},Bo.svg={},Bo.svg.arc=function(){function n(){var n=t.apply(this,arguments),i=r.apply(this,arguments),o=e.apply(this,arguments)+Ms,a=u.apply(this,arguments)+Ms,c=(o>a&&(c=o,o=a,a=c),a-o),s=ka>c?"0":"1",l=Math.cos(o),f=Math.sin(o),h=Math.cos(a),g=Math.sin(a);
return c>=_s?n?"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"M0,"+n+"A"+n+","+n+" 0 1,0 0,"+-n+"A"+n+","+n+" 0 1,0 0,"+n+"Z":"M0,"+i+"A"+i+","+i+" 0 1,1 0,"+-i+"A"+i+","+i+" 0 1,1 0,"+i+"Z":n?"M"+i*l+","+i*f+"A"+i+","+i+" 0 "+s+",1 "+i*h+","+i*g+"L"+n*h+","+n*g+"A"+n+","+n+" 0 "+s+",0 "+n*l+","+n*f+"Z":"M"+i*l+","+i*f+"A"+i+","+i+" 0 "+s+",1 "+i*h+","+i*g+"L0,0"+"Z"}var t=eo,r=uo,e=io,u=oo;return n.innerRadius=function(r){return arguments.length?(t=Et(r),n):t},n.outerRadius=function(t){return arguments.length?(r=Et(t),n):r},n.startAngle=function(t){return arguments.length?(e=Et(t),n):e},n.endAngle=function(t){return arguments.length?(u=Et(t),n):u},n.centroid=function(){var n=(t.apply(this,arguments)+r.apply(this,arguments))/2,i=(e.apply(this,arguments)+u.apply(this,arguments))/2+Ms;return[Math.cos(i)*n,Math.sin(i)*n]},n};var Ms=-Aa,_s=Ea-Ca;Bo.svg.line=function(){return ao(At)};var bs=Bo.map({linear:co,"linear-closed":so,step:lo,"step-before":fo,"step-after":ho,basis:xo,"basis-open":Mo,"basis-closed":_o,bundle:bo,cardinal:vo,"cardinal-open":go,"cardinal-closed":po,monotone:Co});bs.forEach(function(n,t){t.key=n,t.closed=/-closed$/.test(n)});var ws=[0,2/3,1/3,0],Ss=[0,1/3,2/3,0],ks=[0,1/6,2/3,1/6];Bo.svg.line.radial=function(){var n=ao(No);return n.radius=n.x,delete n.x,n.angle=n.y,delete n.y,n},fo.reverse=ho,ho.reverse=fo,Bo.svg.area=function(){return zo(At)},Bo.svg.area.radial=function(){var n=zo(No);return n.radius=n.x,delete n.x,n.innerRadius=n.x0,delete n.x0,n.outerRadius=n.x1,delete n.x1,n.angle=n.y,delete n.y,n.startAngle=n.y0,delete n.y0,n.endAngle=n.y1,delete n.y1,n},Bo.svg.chord=function(){function n(n,a){var c=t(this,i,n,a),s=t(this,o,n,a);return"M"+c.p0+e(c.r,c.p1,c.a1-c.a0)+(r(c,s)?u(c.r,c.p1,c.r,c.p0):u(c.r,c.p1,s.r,s.p0)+e(s.r,s.p1,s.a1-s.a0)+u(s.r,s.p1,c.r,c.p0))+"Z"}function t(n,t,r,e){var u=t.call(n,r,e),i=a.call(n,u,e),o=c.call(n,u,e)+Ms,l=s.call(n,u,e)+Ms;return{r:i,a0:o,a1:l,p0:[i*Math.cos(o),i*Math.sin(o)],p1:[i*Math.cos(l),i*Math.sin(l)]}}function r(n,t){return n.a0==t.a0&&n.a1==t.a1}function e(n,t,r){return"A"+n+","+n+" 0 "+ +(r>ka)+",1 "+t}function u(n,t,r,e){return"Q 0,0 "+e}var i=me,o=ye,a=Lo,c=io,s=oo;return n.radius=function(t){return arguments.length?(a=Et(t),n):a},n.source=function(t){return arguments.length?(i=Et(t),n):i},n.target=function(t){return arguments.length?(o=Et(t),n):o},n.startAngle=function(t){return arguments.length?(c=Et(t),n):c},n.endAngle=function(t){return arguments.length?(s=Et(t),n):s},n},Bo.svg.diagonal=function(){function n(n,u){var i=t.call(this,n,u),o=r.call(this,n,u),a=(i.y+o.y)/2,c=[i,{x:i.x,y:a},{x:o.x,y:a},o];return c=c.map(e),"M"+c[0]+"C"+c[1]+" "+c[2]+" "+c[3]}var t=me,r=ye,e=To;return n.source=function(r){return arguments.length?(t=Et(r),n):t},n.target=function(t){return arguments.length?(r=Et(t),n):r},n.projection=function(t){return arguments.length?(e=t,n):e},n},Bo.svg.diagonal.radial=function(){var n=Bo.svg.diagonal(),t=To,r=n.projection;return n.projection=function(n){return arguments.length?r(qo(t=n)):t},n},Bo.svg.symbol=function(){function n(n,e){return(Es.get(t.call(this,n,e))||Po)(r.call(this,n,e))}var t=Do,r=Ro;return n.type=function(r){return arguments.length?(t=Et(r),n):t},n.size=function(t){return arguments.length?(r=Et(t),n):r},n};var Es=Bo.map({circle:Po,cross:function(n){var t=Math.sqrt(n/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(n){var t=Math.sqrt(n/(2*zs)),r=t*zs;return"M0,"+-t+"L"+r+",0"+" 0,"+t+" "+-r+",0"+"Z"},square:function(n){var t=Math.sqrt(n)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(n){var t=Math.sqrt(n/Ns),r=t*Ns/2;return"M0,"+r+"L"+t+","+-r+" "+-t+","+-r+"Z"},"triangle-up":function(n){var t=Math.sqrt(n/Ns),r=t*Ns/2;return"M0,"+-r+"L"+t+","+r+" "+-t+","+r+"Z"}});Bo.svg.symbolTypes=Es.keys();var As,Cs,Ns=Math.sqrt(3),zs=Math.tan(30*za),Ls=[],Ts=0;Ls.call=ya.call,Ls.empty=ya.empty,Ls.node=ya.node,Ls.size=ya.size,Bo.transition=function(n){return arguments.length?As?n.transition():n:_a.transition()},Bo.transition.prototype=Ls,Ls.select=function(n){var t,r,e,u=this.id,i=[];n=b(n);for(var o=-1,a=this.length;++o<a;){i.push(t=[]);for(var c=this[o],s=-1,l=c.length;++s<l;)(e=c[s])&&(r=n.call(e,e.__data__,s,o))?("__data__"in e&&(r.__data__=e.__data__),Fo(r,s,u,e.__transition__[u]),t.push(r)):t.push(null)}return Uo(i,u)},Ls.selectAll=function(n){var t,r,e,u,i,o=this.id,a=[];n=w(n);for(var c=-1,s=this.length;++c<s;)for(var l=this[c],f=-1,h=l.length;++f<h;)if(e=l[f]){i=e.__transition__[o],r=n.call(e,e.__data__,f,c),a.push(t=[]);for(var g=-1,p=r.length;++g<p;)(u=r[g])&&Fo(u,g,o,i),t.push(u)}return Uo(a,o)},Ls.filter=function(n){var t,r,e,u=[];"function"!=typeof n&&(n=R(n));for(var i=0,o=this.length;o>i;i++){u.push(t=[]);for(var r=this[i],a=0,c=r.length;c>a;a++)(e=r[a])&&n.call(e,e.__data__,a,i)&&t.push(e)}return Uo(u,this.id)},Ls.tween=function(n,t){var r=this.id;return arguments.length<2?this.node().__transition__[r].tween.get(n):P(this,null==t?function(t){t.__transition__[r].tween.remove(n)}:function(e){e.__transition__[r].tween.set(n,t)})},Ls.attr=function(n,t){function r(){this.removeAttribute(a)}function e(){this.removeAttributeNS(a.space,a.local)}function u(n){return null==n?r:(n+="",function(){var t,r=this.getAttribute(a);return r!==n&&(t=o(r,n),function(n){this.setAttribute(a,t(n))})})}function i(n){return null==n?e:(n+="",function(){var t,r=this.getAttributeNS(a.space,a.local);return r!==n&&(t=o(r,n),function(n){this.setAttributeNS(a.space,a.local,t(n))})})}if(arguments.length<2){for(t in n)this.attr(t,n[t]);return this}var o="transform"==n?Hu:du,a=Bo.ns.qualify(n);return jo(this,"attr."+n,t,a.local?i:u)},Ls.attrTween=function(n,t){function r(n,r){var e=t.call(this,n,r,this.getAttribute(u));return e&&function(n){this.setAttribute(u,e(n))}}function e(n,r){var e=t.call(this,n,r,this.getAttributeNS(u.space,u.local));return e&&function(n){this.setAttributeNS(u.space,u.local,e(n))}}var u=Bo.ns.qualify(n);return this.tween("attr."+n,u.local?e:r)},Ls.style=function(n,t,r){function e(){this.style.removeProperty(n)}function u(t){return null==t?e:(t+="",function(){var e,u=Qo.getComputedStyle(this,null).getPropertyValue(n);return u!==t&&(e=du(u,t),function(t){this.style.setProperty(n,e(t),r)})})}var i=arguments.length;if(3>i){if("string"!=typeof n){2>i&&(t="");for(r in n)this.style(r,n[r],t);return this}r=""}return jo(this,"style."+n,t,u)},Ls.styleTween=function(n,t,r){function e(e,u){var i=t.call(this,e,u,Qo.getComputedStyle(this,null).getPropertyValue(n));return i&&function(t){this.style.setProperty(n,i(t),r)}}return arguments.length<3&&(r=""),this.tween("style."+n,e)},Ls.text=function(n){return jo(this,"text",n,Ho)},Ls.remove=function(){return this.each("end.transition",function(){var n;this.__transition__.count<2&&(n=this.parentNode)&&n.removeChild(this)})},Ls.ease=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof n&&(n=Bo.ease.apply(Bo,arguments)),P(this,function(r){r.__transition__[t].ease=n}))},Ls.delay=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:P(this,"function"==typeof n?function(r,e,u){r.__transition__[t].delay=+n.call(r,r.__data__,e,u)}:(n=+n,function(r){r.__transition__[t].delay=n}))},Ls.duration=function(n){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:P(this,"function"==typeof n?function(r,e,u){r.__transition__[t].duration=Math.max(1,n.call(r,r.__data__,e,u))}:(n=Math.max(1,n),function(r){r.__transition__[t].duration=n}))},Ls.each=function(n,t){var r=this.id;if(arguments.length<2){var e=Cs,u=As;As=r,P(this,function(t,e,u){Cs=t.__transition__[r],n.call(t,t.__data__,e,u)}),Cs=e,As=u}else P(this,function(e){var u=e.__transition__[r];(u.event||(u.event=Bo.dispatch("start","end"))).on(n,t)});return this},Ls.transition=function(){for(var n,t,r,e,u=this.id,i=++Ts,o=[],a=0,c=this.length;c>a;a++){o.push(n=[]);for(var t=this[a],s=0,l=t.length;l>s;s++)(r=t[s])&&(e=Object.create(r.__transition__[u]),e.delay+=e.duration,Fo(r,s,i,e)),n.push(r)}return Uo(o,i)},Bo.svg.axis=function(){function n(n){n.each(function(){var n,s=Bo.select(this),l=this.__chart__||r,f=this.__chart__=r.copy(),h=null==c?f.ticks?f.ticks.apply(f,a):f.domain():c,g=null==t?f.tickFormat?f.tickFormat.apply(f,a):At:t,p=s.selectAll(".tick").data(h,f),v=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Ca),d=Bo.transition(p.exit()).style("opacity",Ca).remove(),m=Bo.transition(p.order()).style("opacity",1),y=Pi(f),x=s.selectAll(".domain").data([0]),M=(x.enter().append("path").attr("class","domain"),Bo.transition(x));v.append("line"),v.append("text");var _=v.select("line"),b=m.select("line"),w=p.select("text").text(g),S=v.select("text"),k=m.select("text");switch(e){case"bottom":n=Oo,_.attr("y2",u),S.attr("y",Math.max(u,0)+o),b.attr("x2",0).attr("y2",u),k.attr("x",0).attr("y",Math.max(u,0)+o),w.attr("dy",".71em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+i+"V0H"+y[1]+"V"+i);break;case"top":n=Oo,_.attr("y2",-u),S.attr("y",-(Math.max(u,0)+o)),b.attr("x2",0).attr("y2",-u),k.attr("x",0).attr("y",-(Math.max(u,0)+o)),w.attr("dy","0em").style("text-anchor","middle"),M.attr("d","M"+y[0]+","+-i+"V0H"+y[1]+"V"+-i);break;case"left":n=Io,_.attr("x2",-u),S.attr("x",-(Math.max(u,0)+o)),b.attr("x2",-u).attr("y2",0),k.attr("x",-(Math.max(u,0)+o)).attr("y",0),w.attr("dy",".32em").style("text-anchor","end"),M.attr("d","M"+-i+","+y[0]+"H0V"+y[1]+"H"+-i);break;case"right":n=Io,_.attr("x2",u),S.attr("x",Math.max(u,0)+o),b.attr("x2",u).attr("y2",0),k.attr("x",Math.max(u,0)+o).attr("y",0),w.attr("dy",".32em").style("text-anchor","start"),M.attr("d","M"+i+","+y[0]+"H0V"+y[1]+"H"+i)}if(f.rangeBand){var E=f,A=E.rangeBand()/2;l=f=function(n){return E(n)+A}}else l.rangeBand?l=f:d.call(n,f);v.call(n,l),m.call(n,f)})}var t,r=Bo.scale.linear(),e=qs,u=6,i=6,o=3,a=[10],c=null;return n.scale=function(t){return arguments.length?(r=t,n):r},n.orient=function(t){return arguments.length?(e=t in Rs?t+"":qs,n):e},n.ticks=function(){return arguments.length?(a=arguments,n):a},n.tickValues=function(t){return arguments.length?(c=t,n):c},n.tickFormat=function(r){return arguments.length?(t=r,n):t},n.tickSize=function(t){var r=arguments.length;return r?(u=+t,i=+arguments[r-1],n):u},n.innerTickSize=function(t){return arguments.length?(u=+t,n):u},n.outerTickSize=function(t){return arguments.length?(i=+t,n):i},n.tickPadding=function(t){return arguments.length?(o=+t,n):o},n.tickSubdivide=function(){return arguments.length&&n},n};var qs="bottom",Rs={top:1,right:1,bottom:1,left:1};Bo.svg.brush=function(){function n(i){i.each(function(){var i=Bo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",u).on("touchstart.brush",u),o=i.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),i.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var a=i.selectAll(".resize").data(p,At);a.exit().remove(),a.enter().append("g").attr("class",function(n){return"resize "+n}).style("cursor",function(n){return Ds[n]}).append("rect").attr("x",function(n){return/[ew]$/.test(n)?-3:null}).attr("y",function(n){return/^[ns]/.test(n)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),a.style("display",n.empty()?"none":null);var l,f=Bo.transition(i),h=Bo.transition(o);c&&(l=Pi(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),r(f)),s&&(l=Pi(s),h.attr("y",l[0]).attr("height",l[1]-l[0]),e(f)),t(f)})}function t(n){n.selectAll(".resize").attr("transform",function(n){return"translate("+l[+/e$/.test(n)]+","+f[+/^s/.test(n)]+")"})}function r(n){n.select(".extent").attr("x",l[0]),n.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function e(n){n.select(".extent").attr("y",f[0]),n.selectAll(".extent,.e>rect,.w>rect").attr("height",f[1]-f[0])}function u(){function u(){32==Bo.event.keyCode&&(C||(x=null,z[0]-=l[1],z[1]-=f[1],C=2),y())}function p(){32==Bo.event.keyCode&&2==C&&(z[0]+=l[1],z[1]+=f[1],C=0,y())}function v(){var n=Bo.mouse(_),u=!1;M&&(n[0]+=M[0],n[1]+=M[1]),C||(Bo.event.altKey?(x||(x=[(l[0]+l[1])/2,(f[0]+f[1])/2]),z[0]=l[+(n[0]<x[0])],z[1]=f[+(n[1]<x[1])]):x=null),E&&d(n,c,0)&&(r(S),u=!0),A&&d(n,s,1)&&(e(S),u=!0),u&&(t(S),w({type:"brush",mode:C?"move":"resize"}))}function d(n,t,r){var e,u,a=Pi(t),c=a[0],s=a[1],p=z[r],v=r?f:l,d=v[1]-v[0];return C&&(c-=p,s-=d+p),e=(r?g:h)?Math.max(c,Math.min(s,n[r])):n[r],C?u=(e+=p)+d:(x&&(p=Math.max(c,Math.min(s,2*x[r]-e))),e>p?(u=e,e=p):u=p),v[0]!=e||v[1]!=u?(r?o=null:i=null,v[0]=e,v[1]=u,!0):void 0}function m(){v(),S.style("pointer-events","all").selectAll(".resize").style("display",n.empty()?"none":null),Bo.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),N(),w({type:"brushend"})}var x,M,_=this,b=Bo.select(Bo.event.target),w=a.of(_,arguments),S=Bo.select(_),k=b.datum(),E=!/^(n|s)$/.test(k)&&c,A=!/^(e|w)$/.test(k)&&s,C=b.classed("extent"),N=Y(),z=Bo.mouse(_),L=Bo.select(Qo).on("keydown.brush",u).on("keyup.brush",p);if(Bo.event.changedTouches?L.on("touchmove.brush",v).on("touchend.brush",m):L.on("mousemove.brush",v).on("mouseup.brush",m),S.interrupt().selectAll("*").interrupt(),C)z[0]=l[0]-z[0],z[1]=f[0]-z[1];else if(k){var T=+/w$/.test(k),q=+/^n/.test(k);M=[l[1-T]-z[0],f[1-q]-z[1]],z[0]=l[T],z[1]=f[q]}else Bo.event.altKey&&(x=z.slice());S.style("pointer-events","none").selectAll(".resize").style("display",null),Bo.select("body").style("cursor",b.style("cursor")),w({type:"brushstart"}),v()}var i,o,a=M(n,"brushstart","brush","brushend"),c=null,s=null,l=[0,0],f=[0,0],h=!0,g=!0,p=Ps[0];return n.event=function(n){n.each(function(){var n=a.of(this,arguments),t={x:l,y:f,i:i,j:o},r=this.__chart__||t;this.__chart__=t,As?Bo.select(this).transition().each("start.brush",function(){i=r.i,o=r.j,l=r.x,f=r.y,n({type:"brushstart"})}).tween("brush:brush",function(){var r=mu(l,t.x),e=mu(f,t.y);return i=o=null,function(u){l=t.x=r(u),f=t.y=e(u),n({type:"brush",mode:"resize"})}}).each("end.brush",function(){i=t.i,o=t.j,n({type:"brush",mode:"resize"}),n({type:"brushend"})}):(n({type:"brushstart"}),n({type:"brush",mode:"resize"}),n({type:"brushend"}))})},n.x=function(t){return arguments.length?(c=t,p=Ps[!c<<1|!s],n):c},n.y=function(t){return arguments.length?(s=t,p=Ps[!c<<1|!s],n):s},n.clamp=function(t){return arguments.length?(c&&s?(h=!!t[0],g=!!t[1]):c?h=!!t:s&&(g=!!t),n):c&&s?[h,g]:c?h:s?g:null},n.extent=function(t){var r,e,u,a,h;return arguments.length?(c&&(r=t[0],e=t[1],s&&(r=r[0],e=e[0]),i=[r,e],c.invert&&(r=c(r),e=c(e)),r>e&&(h=r,r=e,e=h),(r!=l[0]||e!=l[1])&&(l=[r,e])),s&&(u=t[0],a=t[1],c&&(u=u[1],a=a[1]),o=[u,a],s.invert&&(u=s(u),a=s(a)),u>a&&(h=u,u=a,a=h),(u!=f[0]||a!=f[1])&&(f=[u,a])),n):(c&&(i?(r=i[0],e=i[1]):(r=l[0],e=l[1],c.invert&&(r=c.invert(r),e=c.invert(e)),r>e&&(h=r,r=e,e=h))),s&&(o?(u=o[0],a=o[1]):(u=f[0],a=f[1],s.invert&&(u=s.invert(u),a=s.invert(a)),u>a&&(h=u,u=a,a=h))),c&&s?[[r,u],[e,a]]:c?[r,e]:s&&[u,a])},n.clear=function(){return n.empty()||(l=[0,0],f=[0,0],i=o=null),n},n.empty=function(){return!!c&&l[0]==l[1]||!!s&&f[0]==f[1]},Bo.rebind(n,a,"on")};var Ds={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Ps=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Us=rc.format=cc.timeFormat,js=Us.utc,Hs=js("%Y-%m-%dT%H:%M:%S.%LZ");Us.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?Yo:Hs,Yo.parse=function(n){var t=new Date(n);return isNaN(t)?null:t},Yo.toString=Hs.toString,rc.second=Ht(function(n){return new ec(1e3*Math.floor(n/1e3))},function(n,t){n.setTime(n.getTime()+1e3*Math.floor(t))},function(n){return n.getSeconds()}),rc.seconds=rc.second.range,rc.seconds.utc=rc.second.utc.range,rc.minute=Ht(function(n){return new ec(6e4*Math.floor(n/6e4))},function(n,t){n.setTime(n.getTime()+6e4*Math.floor(t))},function(n){return n.getMinutes()}),rc.minutes=rc.minute.range,rc.minutes.utc=rc.minute.utc.range,rc.hour=Ht(function(n){var t=n.getTimezoneOffset()/60;return new ec(36e5*(Math.floor(n/36e5-t)+t))},function(n,t){n.setTime(n.getTime()+36e5*Math.floor(t))},function(n){return n.getHours()}),rc.hours=rc.hour.range,rc.hours.utc=rc.hour.utc.range,rc.month=Ht(function(n){return n=rc.day(n),n.setDate(1),n},function(n,t){n.setMonth(n.getMonth()+t)},function(n){return n.getMonth()}),rc.months=rc.month.range,rc.months.utc=rc.month.utc.range;var Fs=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Os=[[rc.second,1],[rc.second,5],[rc.second,15],[rc.second,30],[rc.minute,1],[rc.minute,5],[rc.minute,15],[rc.minute,30],[rc.hour,1],[rc.hour,3],[rc.hour,6],[rc.hour,12],[rc.day,1],[rc.day,2],[rc.week,1],[rc.month,1],[rc.month,3],[rc.year,1]],Is=Us.multi([[".%L",function(n){return n.getMilliseconds()}],[":%S",function(n){return n.getSeconds()}],["%I:%M",function(n){return n.getMinutes()}],["%I %p",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&1!=n.getDate()}],["%b %d",function(n){return 1!=n.getDate()}],["%B",function(n){return n.getMonth()}],["%Y",Ar]]),Ys={range:function(n,t,r){return Bo.range(Math.ceil(n/r)*r,+t,r).map(Vo)},floor:At,ceil:At};Os.year=rc.year,rc.scale=function(){return Zo(Bo.scale.linear(),Os,Is)};var Zs=Os.map(function(n){return[n[0].utc,n[1]]}),Vs=js.multi([[".%L",function(n){return n.getUTCMilliseconds()}],[":%S",function(n){return n.getUTCSeconds()}],["%I:%M",function(n){return n.getUTCMinutes()}],["%I %p",function(n){return n.getUTCHours()}],["%a %d",function(n){return n.getUTCDay()&&1!=n.getUTCDate()}],["%b %d",function(n){return 1!=n.getUTCDate()}],["%B",function(n){return n.getUTCMonth()}],["%Y",Ar]]);Zs.year=rc.year.utc,rc.scale.utc=function(){return Zo(Bo.scale.linear(),Zs,Vs)},Bo.text=Ct(function(n){return n.responseText}),Bo.json=function(n,t){return Nt(n,"application/json",$o,t)},Bo.html=function(n,t){return Nt(n,"text/html",Xo,t)},Bo.xml=Ct(function(n){return n.responseXML}),"function"==typeof define&&define.amd?define(Bo):"object"==typeof module&&module.exports?module.exports=Bo:this.d3=Bo}();
/*!

 handlebars v4.0.5

Copyright (C) 2011-2015 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.Handlebars=b():a.Handlebars=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){"use strict";function d(){var a=r();return a.compile=function(b,c){return k.compile(b,c,a)},a.precompile=function(b,c){return k.precompile(b,c,a)},a.AST=i["default"],a.Compiler=k.Compiler,a.JavaScriptCompiler=m["default"],a.Parser=j.parser,a.parse=j.parse,a}var e=c(1)["default"];b.__esModule=!0;var f=c(2),g=e(f),h=c(21),i=e(h),j=c(22),k=c(27),l=c(28),m=e(l),n=c(25),o=e(n),p=c(20),q=e(p),r=g["default"].create,s=d();s.create=d,q["default"](s),s.Visitor=o["default"],s["default"]=s,b["default"]=s,a.exports=b["default"]},function(a,b){"use strict";b["default"]=function(a){return a&&a.__esModule?a:{"default":a}},b.__esModule=!0},function(a,b,c){"use strict";function d(){var a=new h.HandlebarsEnvironment;return n.extend(a,h),a.SafeString=j["default"],a.Exception=l["default"],a.Utils=n,a.escapeExpression=n.escapeExpression,a.VM=p,a.template=function(b){return p.template(b,a)},a}var e=c(3)["default"],f=c(1)["default"];b.__esModule=!0;var g=c(4),h=e(g),i=c(18),j=f(i),k=c(6),l=f(k),m=c(5),n=e(m),o=c(19),p=e(o),q=c(20),r=f(q),s=d();s.create=d,r["default"](s),s["default"]=s,b["default"]=s,a.exports=b["default"]},function(a,b){"use strict";b["default"]=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b},b.__esModule=!0},function(a,b,c){"use strict";function d(a,b,c){this.helpers=a||{},this.partials=b||{},this.decorators=c||{},i.registerDefaultHelpers(this),j.registerDefaultDecorators(this)}var e=c(1)["default"];b.__esModule=!0,b.HandlebarsEnvironment=d;var f=c(5),g=c(6),h=e(g),i=c(7),j=c(15),k=c(17),l=e(k),m="4.0.5";b.VERSION=m;var n=7;b.COMPILER_REVISION=n;var o={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};b.REVISION_CHANGES=o;var p="[object Object]";d.prototype={constructor:d,logger:l["default"],log:l["default"].log,registerHelper:function(a,b){if(f.toString.call(a)===p){if(b)throw new h["default"]("Arg not supported with multiple helpers");f.extend(this.helpers,a)}else this.helpers[a]=b},unregisterHelper:function(a){delete this.helpers[a]},registerPartial:function(a,b){if(f.toString.call(a)===p)f.extend(this.partials,a);else{if("undefined"==typeof b)throw new h["default"]('Attempting to register a partial called "'+a+'" as undefined');this.partials[a]=b}},unregisterPartial:function(a){delete this.partials[a]},registerDecorator:function(a,b){if(f.toString.call(a)===p){if(b)throw new h["default"]("Arg not supported with multiple decorators");f.extend(this.decorators,a)}else this.decorators[a]=b},unregisterDecorator:function(a){delete this.decorators[a]}};var q=l["default"].log;b.log=q,b.createFrame=f.createFrame,b.logger=l["default"]},function(a,b){"use strict";function c(a){return k[a]}function d(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b])Object.prototype.hasOwnProperty.call(arguments[b],c)&&(a[c]=arguments[b][c]);return a}function e(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function f(a){if("string"!=typeof a){if(a&&a.toHTML)return a.toHTML();if(null==a)return"";if(!a)return a+"";a=""+a}return m.test(a)?a.replace(l,c):a}function g(a){return a||0===a?p(a)&&0===a.length?!0:!1:!0}function h(a){var b=d({},a);return b._parent=a,b}function i(a,b){return a.path=b,a}function j(a,b){return(a?a+".":"")+b}b.__esModule=!0,b.extend=d,b.indexOf=e,b.escapeExpression=f,b.isEmpty=g,b.createFrame=h,b.blockParams=i,b.appendContextPath=j;var k={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},l=/[&<>"'`=]/g,m=/[&<>"'`=]/,n=Object.prototype.toString;b.toString=n;var o=function(a){return"function"==typeof a};o(/x/)&&(b.isFunction=o=function(a){return"function"==typeof a&&"[object Function]"===n.call(a)}),b.isFunction=o;var p=Array.isArray||function(a){return a&&"object"==typeof a?"[object Array]"===n.call(a):!1};b.isArray=p},function(a,b){"use strict";function c(a,b){var e=b&&b.loc,f=void 0,g=void 0;e&&(f=e.start.line,g=e.start.column,a+=" - "+f+":"+g);for(var h=Error.prototype.constructor.call(this,a),i=0;i<d.length;i++)this[d[i]]=h[d[i]];Error.captureStackTrace&&Error.captureStackTrace(this,c),e&&(this.lineNumber=f,this.column=g)}b.__esModule=!0;var d=["description","fileName","lineNumber","message","name","number","stack"];c.prototype=new Error,b["default"]=c,a.exports=b["default"]},function(a,b,c){"use strict";function d(a){g["default"](a),i["default"](a),k["default"](a),m["default"](a),o["default"](a),q["default"](a),s["default"](a)}var e=c(1)["default"];b.__esModule=!0,b.registerDefaultHelpers=d;var f=c(8),g=e(f),h=c(9),i=e(h),j=c(10),k=e(j),l=c(11),m=e(l),n=c(12),o=e(n),p=c(13),q=e(p),r=c(14),s=e(r)},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("blockHelperMissing",function(b,c){var e=c.inverse,f=c.fn;if(b===!0)return f(this);if(b===!1||null==b)return e(this);if(d.isArray(b))return b.length>0?(c.ids&&(c.ids=[c.name]),a.helpers.each(b,c)):e(this);if(c.data&&c.ids){var g=d.createFrame(c.data);g.contextPath=d.appendContextPath(c.data.contextPath,c.name),c={data:g}}return f(b,c)})},a.exports=b["default"]},function(a,b,c){"use strict";var d=c(1)["default"];b.__esModule=!0;var e=c(5),f=c(6),g=d(f);b["default"]=function(a){a.registerHelper("each",function(a,b){function c(b,c,f){j&&(j.key=b,j.index=c,j.first=0===c,j.last=!!f,k&&(j.contextPath=k+b)),i+=d(a[b],{data:j,blockParams:e.blockParams([a[b],b],[k+b,null])})}if(!b)throw new g["default"]("Must pass iterator to #each");var d=b.fn,f=b.inverse,h=0,i="",j=void 0,k=void 0;if(b.data&&b.ids&&(k=e.appendContextPath(b.data.contextPath,b.ids[0])+"."),e.isFunction(a)&&(a=a.call(this)),b.data&&(j=e.createFrame(b.data)),a&&"object"==typeof a)if(e.isArray(a))for(var l=a.length;l>h;h++)h in a&&c(h,h,h===a.length-1);else{var m=void 0;for(var n in a)a.hasOwnProperty(n)&&(void 0!==m&&c(m,h-1),m=n,h++);void 0!==m&&c(m,h-1,!0)}return 0===h&&(i=f(this)),i})},a.exports=b["default"]},function(a,b,c){"use strict";var d=c(1)["default"];b.__esModule=!0;var e=c(6),f=d(e);b["default"]=function(a){a.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new f["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},a.exports=b["default"]},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("if",function(a,b){return d.isFunction(a)&&(a=a.call(this)),!b.hash.includeZero&&!a||d.isEmpty(a)?b.inverse(this):b.fn(this)}),a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn,hash:c.hash})})},a.exports=b["default"]},function(a,b){"use strict";b.__esModule=!0,b["default"]=function(a){a.registerHelper("log",function(){for(var b=[void 0],c=arguments[arguments.length-1],d=0;d<arguments.length-1;d++)b.push(arguments[d]);var e=1;null!=c.hash.level?e=c.hash.level:c.data&&null!=c.data.level&&(e=c.data.level),b[0]=e,a.log.apply(a,b)})},a.exports=b["default"]},function(a,b){"use strict";b.__esModule=!0,b["default"]=function(a){a.registerHelper("lookup",function(a,b){return a&&a[b]})},a.exports=b["default"]},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerHelper("with",function(a,b){d.isFunction(a)&&(a=a.call(this));var c=b.fn;if(d.isEmpty(a))return b.inverse(this);var e=b.data;return b.data&&b.ids&&(e=d.createFrame(b.data),e.contextPath=d.appendContextPath(b.data.contextPath,b.ids[0])),c(a,{data:e,blockParams:d.blockParams([a],[e&&e.contextPath])})})},a.exports=b["default"]},function(a,b,c){"use strict";function d(a){g["default"](a)}var e=c(1)["default"];b.__esModule=!0,b.registerDefaultDecorators=d;var f=c(16),g=e(f)},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5);b["default"]=function(a){a.registerDecorator("inline",function(a,b,c,e){var f=a;return b.partials||(b.partials={},f=function(e,f){var g=c.partials;c.partials=d.extend({},g,b.partials);var h=a(e,f);return c.partials=g,h}),b.partials[e.args[0]]=e.fn,f})},a.exports=b["default"]},function(a,b,c){"use strict";b.__esModule=!0;var d=c(5),e={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(a){if("string"==typeof a){var b=d.indexOf(e.methodMap,a.toLowerCase());a=b>=0?b:parseInt(a,10)}return a},log:function(a){if(a=e.lookupLevel(a),"undefined"!=typeof console&&e.lookupLevel(e.level)<=a){var b=e.methodMap[a];console[b]||(b="log");for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;c>f;f++)d[f-1]=arguments[f];console[b].apply(console,d)}}};b["default"]=e,a.exports=b["default"]},function(a,b){"use strict";function c(a){this.string=a}b.__esModule=!0,c.prototype.toString=c.prototype.toHTML=function(){return""+this.string},b["default"]=c,a.exports=b["default"]},function(a,b,c){"use strict";function d(a){var b=a&&a[0]||1,c=r.COMPILER_REVISION;if(b!==c){if(c>b){var d=r.REVISION_CHANGES[c],e=r.REVISION_CHANGES[b];throw new q["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+d+") or downgrade your runtime to an older version ("+e+").")}throw new q["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+a[1]+").")}}function e(a,b){function c(c,d,e){e.hash&&(d=o.extend({},d,e.hash),e.ids&&(e.ids[0]=!0)),c=b.VM.resolvePartial.call(this,c,d,e);var f=b.VM.invokePartial.call(this,c,d,e);if(null==f&&b.compile&&(e.partials[e.name]=b.compile(c,a.compilerOptions,b),f=e.partials[e.name](d,e)),null!=f){if(e.indent){for(var g=f.split("\n"),h=0,i=g.length;i>h&&(g[h]||h+1!==i);h++)g[h]=e.indent+g[h];f=g.join("\n")}return f}throw new q["default"]("The partial "+e.name+" could not be compiled when running in runtime-only mode")}function d(b){function c(b){return""+a.main(e,b,e.helpers,e.partials,g,i,h)}var f=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],g=f.data;d._setup(f),!f.partial&&a.useData&&(g=j(b,g));var h=void 0,i=a.useBlockParams?[]:void 0;return a.useDepths&&(h=f.depths?b!==f.depths[0]?[b].concat(f.depths):f.depths:[b]),(c=k(a.main,c,e,f.depths||[],g,i))(b,f)}if(!b)throw new q["default"]("No environment passed to template");if(!a||!a.main)throw new q["default"]("Unknown template object: "+typeof a);a.main.decorator=a.main_d,b.VM.checkRevision(a.compiler);var e={strict:function(a,b){if(!(b in a))throw new q["default"]('"'+b+'" not defined in '+a);return a[b]},lookup:function(a,b){for(var c=a.length,d=0;c>d;d++)if(a[d]&&null!=a[d][b])return a[d][b]},lambda:function(a,b){return"function"==typeof a?a.call(b):a},escapeExpression:o.escapeExpression,invokePartial:c,fn:function(b){var c=a[b];return c.decorator=a[b+"_d"],c},programs:[],program:function(a,b,c,d,e){var g=this.programs[a],h=this.fn(a);return b||e||d||c?g=f(this,a,h,b,c,d,e):g||(g=this.programs[a]=f(this,a,h)),g},data:function(a,b){for(;a&&b--;)a=a._parent;return a},merge:function(a,b){var c=a||b;return a&&b&&a!==b&&(c=o.extend({},b,a)),c},noop:b.VM.noop,compilerInfo:a.compiler};return d.isTop=!0,d._setup=function(c){c.partial?(e.helpers=c.helpers,e.partials=c.partials,e.decorators=c.decorators):(e.helpers=e.merge(c.helpers,b.helpers),a.usePartial&&(e.partials=e.merge(c.partials,b.partials)),(a.usePartial||a.useDecorators)&&(e.decorators=e.merge(c.decorators,b.decorators)))},d._child=function(b,c,d,g){if(a.useBlockParams&&!d)throw new q["default"]("must pass block params");if(a.useDepths&&!g)throw new q["default"]("must pass parent depths");return f(e,b,a[b],c,0,d,g)},d}function f(a,b,c,d,e,f,g){function h(b){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],h=g;return g&&b!==g[0]&&(h=[b].concat(g)),c(a,b,a.helpers,a.partials,e.data||d,f&&[e.blockParams].concat(f),h)}return h=k(c,h,a,g,d,f),h.program=b,h.depth=g?g.length:0,h.blockParams=e||0,h}function g(a,b,c){return a?a.call||c.name||(c.name=a,a=c.partials[a]):a="@partial-block"===c.name?c.data["partial-block"]:c.partials[c.name],a}function h(a,b,c){c.partial=!0,c.ids&&(c.data.contextPath=c.ids[0]||c.data.contextPath);var d=void 0;if(c.fn&&c.fn!==i&&(c.data=r.createFrame(c.data),d=c.data["partial-block"]=c.fn,d.partials&&(c.partials=o.extend({},c.partials,d.partials))),void 0===a&&d&&(a=d),void 0===a)throw new q["default"]("The partial "+c.name+" could not be found");return a instanceof Function?a(b,c):void 0}function i(){return""}function j(a,b){return b&&"root"in b||(b=b?r.createFrame(b):{},b.root=a),b}function k(a,b,c,d,e,f){if(a.decorator){var g={};b=a.decorator(b,g,c,d&&d[0],e,f,d),o.extend(b,g)}return b}var l=c(3)["default"],m=c(1)["default"];b.__esModule=!0,b.checkRevision=d,b.template=e,b.wrapProgram=f,b.resolvePartial=g,b.invokePartial=h,b.noop=i;var n=c(5),o=l(n),p=c(6),q=m(p),r=c(4)},function(a,b){(function(c){"use strict";b.__esModule=!0,b["default"]=function(a){var b="undefined"!=typeof c?c:window,d=b.Handlebars;a.noConflict=function(){return b.Handlebars===a&&(b.Handlebars=d),a}},a.exports=b["default"]}).call(b,function(){return this}())},function(a,b){"use strict";b.__esModule=!0;var c={helpers:{helperExpression:function(a){return"SubExpression"===a.type||("MustacheStatement"===a.type||"BlockStatement"===a.type)&&!!(a.params&&a.params.length||a.hash)},scopedId:function(a){return/^\.|this\b/.test(a.original)},simpleId:function(a){return 1===a.parts.length&&!c.helpers.scopedId(a)&&!a.depth}}};b["default"]=c,a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){if("Program"===a.type)return a;h["default"].yy=n,n.locInfo=function(a){return new n.SourceLocation(b&&b.srcName,a)};var c=new j["default"](b);return c.accept(h["default"].parse(a))}var e=c(1)["default"],f=c(3)["default"];b.__esModule=!0,b.parse=d;var g=c(23),h=e(g),i=c(24),j=e(i),k=c(26),l=f(k),m=c(5);b.parser=h["default"];var n={};m.extend(n,l)},function(a,b){"use strict";var c=function(){function a(){this.yy={}}var b={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition_plus0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,1],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(a,b,c,d,e,f,g){var h=f.length-1;switch(e){case 1:return f[h-1];case 2:this.$=d.prepareProgram(f[h]);break;case 3:this.$=f[h];break;case 4:this.$=f[h];break;case 5:this.$=f[h];break;case 6:this.$=f[h];break;case 7:this.$=f[h];break;case 8:this.$=f[h];break;case 9:this.$={type:"CommentStatement",value:d.stripComment(f[h]),strip:d.stripFlags(f[h],f[h]),loc:d.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:f[h],value:f[h],loc:d.locInfo(this._$)};break;case 11:this.$=d.prepareRawBlock(f[h-2],f[h-1],f[h],this._$);break;case 12:this.$={path:f[h-3],params:f[h-2],hash:f[h-1]};break;case 13:this.$=d.prepareBlock(f[h-3],f[h-2],f[h-1],f[h],!1,this._$);break;case 14:this.$=d.prepareBlock(f[h-3],f[h-2],f[h-1],f[h],!0,this._$);break;case 15:this.$={open:f[h-5],path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 16:this.$={path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 17:this.$={path:f[h-4],params:f[h-3],hash:f[h-2],blockParams:f[h-1],strip:d.stripFlags(f[h-5],f[h])};break;case 18:this.$={strip:d.stripFlags(f[h-1],f[h-1]),program:f[h]};break;case 19:var i=d.prepareBlock(f[h-2],f[h-1],f[h],f[h],!1,this._$),j=d.prepareProgram([i],f[h-1].loc);j.chained=!0,this.$={strip:f[h-2].strip,program:j,chain:!0};break;case 20:this.$=f[h];break;case 21:this.$={path:f[h-1],strip:d.stripFlags(f[h-2],f[h])};break;case 22:this.$=d.prepareMustache(f[h-3],f[h-2],f[h-1],f[h-4],d.stripFlags(f[h-4],f[h]),this._$);break;case 23:this.$=d.prepareMustache(f[h-3],f[h-2],f[h-1],f[h-4],d.stripFlags(f[h-4],f[h]),this._$);break;case 24:this.$={type:"PartialStatement",name:f[h-3],params:f[h-2],hash:f[h-1],indent:"",strip:d.stripFlags(f[h-4],f[h]),loc:d.locInfo(this._$)};break;case 25:this.$=d.preparePartialBlock(f[h-2],f[h-1],f[h],this._$);break;case 26:this.$={path:f[h-3],params:f[h-2],hash:f[h-1],strip:d.stripFlags(f[h-4],f[h])};break;case 27:this.$=f[h];break;case 28:this.$=f[h];break;case 29:this.$={type:"SubExpression",path:f[h-3],params:f[h-2],hash:f[h-1],loc:d.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:f[h],loc:d.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:d.id(f[h-2]),value:f[h],loc:d.locInfo(this._$)};break;case 32:this.$=d.id(f[h-1]);break;case 33:this.$=f[h];break;case 34:this.$=f[h];break;case 35:this.$={type:"StringLiteral",value:f[h],original:f[h],loc:d.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(f[h]),original:Number(f[h]),loc:d.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===f[h],original:"true"===f[h],loc:d.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:d.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:d.locInfo(this._$)};break;case 40:this.$=f[h];break;case 41:this.$=f[h];break;case 42:this.$=d.preparePath(!0,f[h],this._$);break;case 43:this.$=d.preparePath(!1,f[h],this._$);break;case 44:f[h-2].push({part:d.id(f[h]),original:f[h],separator:f[h-1]}),this.$=f[h-2];break;case 45:this.$=[{part:d.id(f[h]),original:f[h]}];break;case 46:this.$=[];break;case 47:f[h-1].push(f[h]);break;case 48:this.$=[f[h]];break;case 49:f[h-1].push(f[h]);break;case 50:this.$=[];break;case 51:f[h-1].push(f[h]);break;case 58:this.$=[];break;case 59:f[h-1].push(f[h]);break;case 64:this.$=[];break;case 65:f[h-1].push(f[h]);break;case 70:this.$=[];break;case 71:f[h-1].push(f[h]);break;case 78:this.$=[];break;case 79:f[h-1].push(f[h]);break;case 82:this.$=[];break;case 83:f[h-1].push(f[h]);break;case 86:this.$=[];break;case 87:f[h-1].push(f[h]);break;case 90:this.$=[];break;case 91:f[h-1].push(f[h]);break;case 94:this.$=[];break;case 95:f[h-1].push(f[h]);break;case 98:this.$=[f[h]];break;case 99:f[h-1].push(f[h]);break;case 100:this.$=[f[h]];break;case 101:f[h-1].push(f[h])}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{13:40,15:[1,20],17:39},{20:42,56:41,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:45,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:48,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:42,56:49,64:43,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:50,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,51]},{72:[1,35],86:52},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:53,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:54,38:56,39:[1,58],43:57,44:[1,59],45:55,47:[2,54]},{28:60,43:61,44:[1,59],47:[2,56]},{13:63,15:[1,20],18:[1,62]},{15:[2,48],18:[2,48]},{33:[2,86],57:64,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:65,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:66,47:[1,67]},{30:68,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:69,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:70,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:71,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:75,33:[2,80],50:72,63:73,64:76,65:[1,44],69:74,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,80]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,51]},{20:75,53:81,54:[2,84],63:82,64:76,65:[1,44],69:83,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:84,47:[1,67]},{47:[2,55]},{4:85,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:86,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:87,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:88,47:[1,67]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:75,33:[2,88],58:89,63:90,64:76,65:[1,44],69:91,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:92,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:93,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,31:94,33:[2,60],63:95,64:76,65:[1,44],69:96,70:77,71:78,72:[1,79],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,66],36:97,63:98,64:76,65:[1,44],69:99,70:77,71:78,72:[1,79],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,22:100,23:[2,52],63:101,64:76,65:[1,44],69:102,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:75,33:[2,92],62:103,63:104,64:76,65:[1,44],69:105,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,106]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:107,72:[1,108],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,109],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,110]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:56,39:[1,58],43:57,44:[1,59],45:112,46:111,47:[2,76]},{33:[2,70],40:113,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,114]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:75,63:116,64:76,65:[1,44],67:115,68:[2,96],69:117,70:77,71:78,72:[1,79],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,118]},{32:119,33:[2,62],74:120,75:[1,121]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:122,74:123,75:[1,121]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,124]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,125]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,109]},{20:75,63:126,64:76,65:[1,44],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:75,33:[2,72],41:127,63:128,64:76,65:[1,44],69:129,70:77,71:78,72:[1,79],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,130]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,131]},{33:[2,63]},{72:[1,133],76:132},{33:[1,134]},{33:[2,69]},{15:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:135,74:136,75:[1,121]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,138],77:[1,137]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],
48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,139]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],55:[2,55],57:[2,20],61:[2,57],74:[2,81],83:[2,85],87:[2,18],91:[2,89],102:[2,53],105:[2,93],111:[2,19],112:[2,77],117:[2,97],120:[2,63],123:[2,69],124:[2,12],136:[2,75],137:[2,32]},parseError:function(a,b){throw new Error(a)},parse:function(a){function b(){var a;return a=c.lexer.lex()||1,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0;this.lexer.setInput(a),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;f.push(l);var m=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var n,o,p,q,r,s,t,u,v,w={};;){if(p=d[d.length-1],this.defaultActions[p]?q=this.defaultActions[p]:((null===n||"undefined"==typeof n)&&(n=b()),q=g[p]&&g[p][n]),"undefined"==typeof q||!q.length||!q[0]){var x="";if(!k){v=[];for(s in g[p])this.terminals_[s]&&s>2&&v.push("'"+this.terminals_[s]+"'");x=this.lexer.showPosition?"Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+v.join(", ")+", got '"+(this.terminals_[n]||n)+"'":"Parse error on line "+(i+1)+": Unexpected "+(1==n?"end of input":"'"+(this.terminals_[n]||n)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[n]||n,line:this.lexer.yylineno,loc:l,expected:v})}}if(q[0]instanceof Array&&q.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+n);switch(q[0]){case 1:d.push(n),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(q[1]),n=null,o?(n=o,o=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,l=this.lexer.yylloc,k>0&&k--);break;case 2:if(t=this.productions_[q[1]][1],w.$=e[e.length-t],w._$={first_line:f[f.length-(t||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(t||1)].first_column,last_column:f[f.length-1].last_column},m&&(w._$.range=[f[f.length-(t||1)].range[0],f[f.length-1].range[1]]),r=this.performAction.call(w,h,j,i,this.yy,q[1],e,f),"undefined"!=typeof r)return r;t&&(d=d.slice(0,-1*t*2),e=e.slice(0,-1*t),f=f.slice(0,-1*t)),d.push(this.productions_[q[1]][0]),e.push(w.$),f.push(w._$),u=g[d[d.length-2]][d[d.length-1]],d.push(u);break;case 3:return!0}}return!0}},c=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b-1),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this},more:function(){return this._more=!0,this},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d,e;this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),g=0;g<f.length&&(c=this._input.match(this.rules[f[g]]),!c||b&&!(c[0].length>b[0].length)||(b=c,d=g,this.options.flex));g++);return b?(e=b[0].match(/(?:\r\n?|\n).*/g),e&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-e[e.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,f[d],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),a?a:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return"undefined"!=typeof a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(a){this.begin(a)}};return a.options={},a.performAction=function(a,b,c,d){function e(a,c){return b.yytext=b.yytext.substr(a,b.yyleng-c)}switch(c){case 0:if("\\\\"===b.yytext.slice(-2)?(e(0,1),this.begin("mu")):"\\"===b.yytext.slice(-1)?(e(0,1),this.begin("emu")):this.begin("mu"),b.yytext)return 15;break;case 1:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(b.yytext=b.yytext.substr(5,b.yyleng-9),"END_RAW_BLOCK");case 5:return 15;case 6:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:return this.popState(),44;case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:return 48;case 21:this.unput(b.yytext),this.popState(),this.begin("com");break;case 22:return this.popState(),14;case 23:return 48;case 24:return 73;case 25:return 72;case 26:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return b.yytext=e(1,2).replace(/\\"/g,'"'),80;case 32:return b.yytext=e(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:return 82;case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 41:return 72;case 42:return b.yytext=b.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},a.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^\/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],a.conditions={mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}},a}();return b.lexer=c,a.prototype=b,b.Parser=a,new a}();b.__esModule=!0,b["default"]=c},function(a,b,c){"use strict";function d(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=a}function e(a,b,c){void 0===b&&(b=a.length);var d=a[b-1],e=a[b-2];return d?"ContentStatement"===d.type?(e||!c?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(d.original):void 0:c}function f(a,b,c){void 0===b&&(b=-1);var d=a[b+1],e=a[b+2];return d?"ContentStatement"===d.type?(e||!c?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(d.original):void 0:c}function g(a,b,c){var d=a[null==b?0:b+1];if(d&&"ContentStatement"===d.type&&(c||!d.rightStripped)){var e=d.value;d.value=d.value.replace(c?/^\s+/:/^[ \t]*\r?\n?/,""),d.rightStripped=d.value!==e}}function h(a,b,c){var d=a[null==b?a.length-1:b-1];if(d&&"ContentStatement"===d.type&&(c||!d.leftStripped)){var e=d.value;return d.value=d.value.replace(c?/\s+$/:/[ \t]+$/,""),d.leftStripped=d.value!==e,d.leftStripped}}var i=c(1)["default"];b.__esModule=!0;var j=c(25),k=i(j);d.prototype=new k["default"],d.prototype.Program=function(a){var b=!this.options.ignoreStandalone,c=!this.isRootSeen;this.isRootSeen=!0;for(var d=a.body,i=0,j=d.length;j>i;i++){var k=d[i],l=this.accept(k);if(l){var m=e(d,i,c),n=f(d,i,c),o=l.openStandalone&&m,p=l.closeStandalone&&n,q=l.inlineStandalone&&m&&n;l.close&&g(d,i,!0),l.open&&h(d,i,!0),b&&q&&(g(d,i),h(d,i)&&"PartialStatement"===k.type&&(k.indent=/([ \t]+$)/.exec(d[i-1].original)[1])),b&&o&&(g((k.program||k.inverse).body),h(d,i)),b&&p&&(g(d,i),h((k.inverse||k.program).body))}}return a},d.prototype.BlockStatement=d.prototype.DecoratorBlock=d.prototype.PartialBlockStatement=function(a){this.accept(a.program),this.accept(a.inverse);var b=a.program||a.inverse,c=a.program&&a.inverse,d=c,i=c;if(c&&c.chained)for(d=c.body[0].program;i.chained;)i=i.body[i.body.length-1].program;var j={open:a.openStrip.open,close:a.closeStrip.close,openStandalone:f(b.body),closeStandalone:e((d||b).body)};if(a.openStrip.close&&g(b.body,null,!0),c){var k=a.inverseStrip;k.open&&h(b.body,null,!0),k.close&&g(d.body,null,!0),a.closeStrip.open&&h(i.body,null,!0),!this.options.ignoreStandalone&&e(b.body)&&f(d.body)&&(h(b.body),g(d.body))}else a.closeStrip.open&&h(b.body,null,!0);return j},d.prototype.Decorator=d.prototype.MustacheStatement=function(a){return a.strip},d.prototype.PartialStatement=d.prototype.CommentStatement=function(a){var b=a.strip||{};return{inlineStandalone:!0,open:b.open,close:b.close}},b["default"]=d,a.exports=b["default"]},function(a,b,c){"use strict";function d(){this.parents=[]}function e(a){this.acceptRequired(a,"path"),this.acceptArray(a.params),this.acceptKey(a,"hash")}function f(a){e.call(this,a),this.acceptKey(a,"program"),this.acceptKey(a,"inverse")}function g(a){this.acceptRequired(a,"name"),this.acceptArray(a.params),this.acceptKey(a,"hash")}var h=c(1)["default"];b.__esModule=!0;var i=c(6),j=h(i);d.prototype={constructor:d,mutating:!1,acceptKey:function(a,b){var c=this.accept(a[b]);if(this.mutating){if(c&&!d.prototype[c.type])throw new j["default"]('Unexpected node type "'+c.type+'" found when accepting '+b+" on "+a.type);a[b]=c}},acceptRequired:function(a,b){if(this.acceptKey(a,b),!a[b])throw new j["default"](a.type+" requires "+b)},acceptArray:function(a){for(var b=0,c=a.length;c>b;b++)this.acceptKey(a,b),a[b]||(a.splice(b,1),b--,c--)},accept:function(a){if(a){if(!this[a.type])throw new j["default"]("Unknown type: "+a.type,a);this.current&&this.parents.unshift(this.current),this.current=a;var b=this[a.type](a);return this.current=this.parents.shift(),!this.mutating||b?b:b!==!1?a:void 0}},Program:function(a){this.acceptArray(a.body)},MustacheStatement:e,Decorator:e,BlockStatement:f,DecoratorBlock:f,PartialStatement:g,PartialBlockStatement:function(a){g.call(this,a),this.acceptKey(a,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:e,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(a){this.acceptArray(a.pairs)},HashPair:function(a){this.acceptRequired(a,"value")}},b["default"]=d,a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b){if(b=b.path?b.path.original:b,a.path.original!==b){var c={loc:a.path.loc};throw new q["default"](a.path.original+" doesn't match "+b,c)}}function e(a,b){this.source=a,this.start={line:b.first_line,column:b.first_column},this.end={line:b.last_line,column:b.last_column}}function f(a){return/^\[.*\]$/.test(a)?a.substr(1,a.length-2):a}function g(a,b){return{open:"~"===a.charAt(2),close:"~"===b.charAt(b.length-3)}}function h(a){return a.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")}function i(a,b,c){c=this.locInfo(c);for(var d=a?"@":"",e=[],f=0,g="",h=0,i=b.length;i>h;h++){var j=b[h].part,k=b[h].original!==j;if(d+=(b[h].separator||"")+j,k||".."!==j&&"."!==j&&"this"!==j)e.push(j);else{if(e.length>0)throw new q["default"]("Invalid path: "+d,{loc:c});".."===j&&(f++,g+="../")}}return{type:"PathExpression",data:a,depth:f,parts:e,original:d,loc:c}}function j(a,b,c,d,e,f){var g=d.charAt(3)||d.charAt(2),h="{"!==g&&"&"!==g,i=/\*/.test(d);return{type:i?"Decorator":"MustacheStatement",path:a,params:b,hash:c,escaped:h,strip:e,loc:this.locInfo(f)}}function k(a,b,c,e){d(a,c),e=this.locInfo(e);var f={type:"Program",body:b,strip:{},loc:e};return{type:"BlockStatement",path:a.path,params:a.params,hash:a.hash,program:f,openStrip:{},inverseStrip:{},closeStrip:{},loc:e}}function l(a,b,c,e,f,g){e&&e.path&&d(a,e);var h=/\*/.test(a.open);b.blockParams=a.blockParams;var i=void 0,j=void 0;if(c){if(h)throw new q["default"]("Unexpected inverse block on decorator",c);c.chain&&(c.program.body[0].closeStrip=e.strip),j=c.strip,i=c.program}return f&&(f=i,i=b,b=f),{type:h?"DecoratorBlock":"BlockStatement",path:a.path,params:a.params,hash:a.hash,program:b,inverse:i,openStrip:a.strip,inverseStrip:j,closeStrip:e&&e.strip,loc:this.locInfo(g)}}function m(a,b){if(!b&&a.length){var c=a[0].loc,d=a[a.length-1].loc;c&&d&&(b={source:c.source,start:{line:c.start.line,column:c.start.column},end:{line:d.end.line,column:d.end.column}})}return{type:"Program",body:a,strip:{},loc:b}}function n(a,b,c,e){return d(a,c),{type:"PartialBlockStatement",name:a.path,params:a.params,hash:a.hash,program:b,openStrip:a.strip,closeStrip:c&&c.strip,loc:this.locInfo(e)}}var o=c(1)["default"];b.__esModule=!0,b.SourceLocation=e,b.id=f,b.stripFlags=g,b.stripComment=h,b.preparePath=i,b.prepareMustache=j,b.prepareRawBlock=k,b.prepareBlock=l,b.prepareProgram=m,b.preparePartialBlock=n;var p=c(6),q=o(p)},function(a,b,c){"use strict";function d(){}function e(a,b,c){if(null==a||"string"!=typeof a&&"Program"!==a.type)throw new k["default"]("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+a);b=b||{},"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var d=c.parse(a,b),e=(new c.Compiler).compile(d,b);return(new c.JavaScriptCompiler).compile(e,b)}function f(a,b,c){function d(){var d=c.parse(a,b),e=(new c.Compiler).compile(d,b),f=(new c.JavaScriptCompiler).compile(e,b,void 0,!0);return c.template(f)}function e(a,b){return f||(f=d()),f.call(this,a,b)}if(void 0===b&&(b={}),null==a||"string"!=typeof a&&"Program"!==a.type)throw new k["default"]("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+a);"data"in b||(b.data=!0),b.compat&&(b.useDepths=!0);var f=void 0;return e._setup=function(a){return f||(f=d()),f._setup(a)},e._child=function(a,b,c,e){return f||(f=d()),f._child(a,b,c,e)},e}function g(a,b){if(a===b)return!0;if(l.isArray(a)&&l.isArray(b)&&a.length===b.length){for(var c=0;c<a.length;c++)if(!g(a[c],b[c]))return!1;return!0}}function h(a){if(!a.path.parts){var b=a.path;a.path={type:"PathExpression",data:!1,depth:0,parts:[b.original+""],original:b.original+"",loc:b.loc}}}var i=c(1)["default"];b.__esModule=!0,b.Compiler=d,b.precompile=e,b.compile=f;var j=c(6),k=i(j),l=c(5),m=c(21),n=i(m),o=[].slice;d.prototype={compiler:d,equals:function(a){var b=this.opcodes.length;if(a.opcodes.length!==b)return!1;for(var c=0;b>c;c++){var d=this.opcodes[c],e=a.opcodes[c];if(d.opcode!==e.opcode||!g(d.args,e.args))return!1}b=this.children.length;for(var c=0;b>c;c++)if(!this.children[c].equals(a.children[c]))return!1;return!0},guid:0,compile:function(a,b){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=b,this.stringParams=b.stringParams,this.trackIds=b.trackIds,b.blockParams=b.blockParams||[];var c=b.knownHelpers;if(b.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0,lookup:!0},c)for(var d in c)d in c&&(b.knownHelpers[d]=c[d]);return this.accept(a)},compileProgram:function(a){var b=new this.compiler,c=b.compile(a,this.options),d=this.guid++;return this.usePartial=this.usePartial||c.usePartial,this.children[d]=c,this.useDepths=this.useDepths||c.useDepths,d},accept:function(a){if(!this[a.type])throw new k["default"]("Unknown type: "+a.type,a);this.sourceNode.unshift(a);var b=this[a.type](a);return this.sourceNode.shift(),b},Program:function(a){this.options.blockParams.unshift(a.blockParams);for(var b=a.body,c=b.length,d=0;c>d;d++)this.accept(b[d]);return this.options.blockParams.shift(),this.isSimple=1===c,this.blockParams=a.blockParams?a.blockParams.length:0,this},BlockStatement:function(a){h(a);var b=a.program,c=a.inverse;b=b&&this.compileProgram(b),c=c&&this.compileProgram(c);var d=this.classifySexpr(a);"helper"===d?this.helperSexpr(a,b,c):"simple"===d?(this.simpleSexpr(a),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("blockValue",a.path.original)):(this.ambiguousSexpr(a,b,c),this.opcode("pushProgram",b),this.opcode("pushProgram",c),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(a){var b=a.program&&this.compileProgram(a.program),c=this.setupFullMustacheParams(a,b,void 0),d=a.path;this.useDecorators=!0,this.opcode("registerDecorator",c.length,d.original)},PartialStatement:function(a){this.usePartial=!0;var b=a.program;b&&(b=this.compileProgram(a.program));var c=a.params;if(c.length>1)throw new k["default"]("Unsupported number of partial arguments: "+c.length,a);c.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):c.push({type:"PathExpression",parts:[],depth:0}));var d=a.name.original,e="SubExpression"===a.name.type;e&&this.accept(a.name),this.setupFullMustacheParams(a,b,void 0,!0);var f=a.indent||"";this.options.preventIndent&&f&&(this.opcode("appendContent",f),f=""),this.opcode("invokePartial",e,d,f),this.opcode("append")},PartialBlockStatement:function(a){this.PartialStatement(a)},MustacheStatement:function(a){this.SubExpression(a),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(a){this.DecoratorBlock(a)},ContentStatement:function(a){a.value&&this.opcode("appendContent",a.value)},CommentStatement:function(){},SubExpression:function(a){h(a);var b=this.classifySexpr(a);"simple"===b?this.simpleSexpr(a):"helper"===b?this.helperSexpr(a):this.ambiguousSexpr(a)},ambiguousSexpr:function(a,b,c){var d=a.path,e=d.parts[0],f=null!=b||null!=c;this.opcode("getContext",d.depth),this.opcode("pushProgram",b),this.opcode("pushProgram",c),d.strict=!0,this.accept(d),this.opcode("invokeAmbiguous",e,f)},simpleSexpr:function(a){var b=a.path;b.strict=!0,this.accept(b),this.opcode("resolvePossibleLambda")},helperSexpr:function(a,b,c){var d=this.setupFullMustacheParams(a,b,c),e=a.path,f=e.parts[0];if(this.options.knownHelpers[f])this.opcode("invokeKnownHelper",d.length,f);else{if(this.options.knownHelpersOnly)throw new k["default"]("You specified knownHelpersOnly, but used the unknown helper "+f,a);e.strict=!0,e.falsy=!0,this.accept(e),this.opcode("invokeHelper",d.length,e.original,n["default"].helpers.simpleId(e))}},PathExpression:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth);var b=a.parts[0],c=n["default"].helpers.scopedId(a),d=!a.depth&&!c&&this.blockParamIndex(b);d?this.opcode("lookupBlockParam",d,a.parts):b?a.data?(this.options.data=!0,this.opcode("lookupData",a.depth,a.parts,a.strict)):this.opcode("lookupOnContext",a.parts,a.falsy,a.strict,c):this.opcode("pushContext")},StringLiteral:function(a){this.opcode("pushString",a.value)},NumberLiteral:function(a){this.opcode("pushLiteral",a.value)},BooleanLiteral:function(a){this.opcode("pushLiteral",a.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(a){var b=a.pairs,c=0,d=b.length;for(this.opcode("pushHash");d>c;c++)this.pushParam(b[c].value);for(;c--;)this.opcode("assignToHash",b[c].key);this.opcode("popHash")},opcode:function(a){this.opcodes.push({opcode:a,args:o.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(a){a&&(this.useDepths=!0)},classifySexpr:function(a){var b=n["default"].helpers.simpleId(a.path),c=b&&!!this.blockParamIndex(a.path.parts[0]),d=!c&&n["default"].helpers.helperExpression(a),e=!c&&(d||b);if(e&&!d){var f=a.path.parts[0],g=this.options;g.knownHelpers[f]?d=!0:g.knownHelpersOnly&&(e=!1)}return d?"helper":e?"ambiguous":"simple"},pushParams:function(a){for(var b=0,c=a.length;c>b;b++)this.pushParam(a[b])},pushParam:function(a){var b=null!=a.value?a.value:a.original||"";if(this.stringParams)b.replace&&(b=b.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),a.depth&&this.addDepth(a.depth),this.opcode("getContext",a.depth||0),this.opcode("pushStringParam",b,a.type),"SubExpression"===a.type&&this.accept(a);else{if(this.trackIds){var c=void 0;if(!a.parts||n["default"].helpers.scopedId(a)||a.depth||(c=this.blockParamIndex(a.parts[0])),c){var d=a.parts.slice(1).join(".");this.opcode("pushId","BlockParam",c,d)}else b=a.original||b,b.replace&&(b=b.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",a.type,b)}this.accept(a)}},setupFullMustacheParams:function(a,b,c,d){var e=a.params;return this.pushParams(e),this.opcode("pushProgram",b),this.opcode("pushProgram",c),a.hash?this.accept(a.hash):this.opcode("emptyHash",d),e},blockParamIndex:function(a){for(var b=0,c=this.options.blockParams.length;c>b;b++){var d=this.options.blockParams[b],e=d&&l.indexOf(d,a);if(d&&e>=0)return[b,e]}}}},function(a,b,c){"use strict";function d(a){this.value=a}function e(){}function f(a,b,c,d){var e=b.popStack(),f=0,g=c.length;for(a&&g--;g>f;f++)e=b.nameLookup(e,c[f],d);return a?[b.aliasable("container.strict"),"(",e,", ",b.quotedString(c[f]),")"]:e}var g=c(1)["default"];b.__esModule=!0;var h=c(4),i=c(6),j=g(i),k=c(5),l=c(29),m=g(l);e.prototype={nameLookup:function(a,b){return e.isValidJavaScriptVariableName(b)?[a,".",b]:[a,"[",JSON.stringify(b),"]"]},depthedLookup:function(a){return[this.aliasable("container.lookup"),'(depths, "',a,'")']},compilerInfo:function(){var a=h.COMPILER_REVISION,b=h.REVISION_CHANGES[a];return[a,b]},appendToBuffer:function(a,b,c){return k.isArray(a)||(a=[a]),a=this.source.wrap(a,b),this.environment.isSimple?["return ",a,";"]:c?["buffer += ",a,";"]:(a.appendToBuffer=!0,a)},initializeBuffer:function(){return this.quotedString("")},compile:function(a,b,c,d){this.environment=a,this.options=b,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!d,this.name=this.environment.name,this.isChild=!!c,this.context=c||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(a,b),this.useDepths=this.useDepths||a.useDepths||a.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||a.useBlockParams;var e=a.opcodes,f=void 0,g=void 0,h=void 0,i=void 0;for(h=0,i=e.length;i>h;h++)f=e[h],this.source.currentLocation=f.loc,g=g||f.loc,this[f.opcode].apply(this,f.args);if(this.source.currentLocation=g,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new j["default"]("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend("var decorators = container.decorators;\n"),this.decorators.push("return fn;"),d?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var k=this.createFunctionContext(d);if(this.isChild)return k;var l={compiler:this.compilerInfo(),main:k};this.decorators&&(l.main_d=this.decorators,l.useDecorators=!0);var m=this.context,n=m.programs,o=m.decorators;for(h=0,i=n.length;i>h;h++)n[h]&&(l[h]=n[h],o[h]&&(l[h+"_d"]=o[h],l.useDecorators=!0));return this.environment.usePartial&&(l.usePartial=!0),this.options.data&&(l.useData=!0),this.useDepths&&(l.useDepths=!0),this.useBlockParams&&(l.useBlockParams=!0),this.options.compat&&(l.compat=!0),d?l.compilerOptions=this.options:(l.compiler=JSON.stringify(l.compiler),this.source.currentLocation={start:{line:1,column:0}},l=this.objectLiteral(l),b.srcName?(l=l.toStringWithSourceMap({file:b.destName}),l.map=l.map&&l.map.toString()):l=l.toString()),l},preamble:function(){this.lastContext=0,this.source=new m["default"](this.options.srcName),this.decorators=new m["default"](this.options.srcName)},createFunctionContext:function(a){var b="",c=this.stackVars.concat(this.registers.list);c.length>0&&(b+=", "+c.join(", "));var d=0;for(var e in this.aliases){var f=this.aliases[e];this.aliases.hasOwnProperty(e)&&f.children&&f.referenceCount>1&&(b+=", alias"+ ++d+"="+e,f.children[0]="alias"+d)}var g=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&g.push("blockParams"),this.useDepths&&g.push("depths");var h=this.mergeSource(b);return a?(g.push(h),Function.apply(this,g)):this.source.wrap(["function(",g.join(","),") {\n  ",h,"}"])},mergeSource:function(a){var b=this.environment.isSimple,c=!this.forceBuffer,d=void 0,e=void 0,f=void 0,g=void 0;return this.source.each(function(a){a.appendToBuffer?(f?a.prepend("  + "):f=a,g=a):(f&&(e?f.prepend("buffer += "):d=!0,g.add(";"),f=g=void 0),e=!0,b||(c=!1))}),c?f?(f.prepend("return "),g.add(";")):e||this.source.push('return "";'):(a+=", buffer = "+(d?"":this.initializeBuffer()),f?(f.prepend("return buffer + "),g.add(";")):this.source.push("return buffer;")),a&&this.source.prepend("var "+a.substring(2)+(d?"":";\n")),this.source.merge()},blockValue:function(a){var b=this.aliasable("helpers.blockHelperMissing"),c=[this.contextName(0)];this.setupHelperArgs(a,0,c);var d=this.popStack();c.splice(1,0,d),this.push(this.source.functionCall(b,"call",c))},ambiguousBlockValue:function(){var a=this.aliasable("helpers.blockHelperMissing"),b=[this.contextName(0)];this.setupHelperArgs("",0,b,!0),this.flushInline();var c=this.topStack();b.splice(1,0,c),this.pushSource(["if (!",this.lastHelper,") { ",c," = ",this.source.functionCall(a,"call",b),"}"])},appendContent:function(a){this.pendingContent?a=this.pendingContent+a:this.pendingLocation=this.source.currentLocation,this.pendingContent=a},append:function(){if(this.isInline())this.replaceStack(function(a){return[" != null ? ",a,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var a=this.popStack();this.pushSource(["if (",a," != null) { ",this.appendToBuffer(a,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(a){this.lastContext=a},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(a,b,c,d){var e=0;d||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(a[e++])),this.resolvePath("context",a,e,b,c)},lookupBlockParam:function(a,b){this.useBlockParams=!0,this.push(["blockParams[",a[0],"][",a[1],"]"]),this.resolvePath("context",b,1)},lookupData:function(a,b,c){a?this.pushStackLiteral("container.data(data, "+a+")"):this.pushStackLiteral("data"),this.resolvePath("data",b,0,!0,c)},resolvePath:function(a,b,c,d,e){var g=this;if(this.options.strict||this.options.assumeObjects)return void this.push(f(this.options.strict&&e,this,b,a));for(var h=b.length;h>c;c++)this.replaceStack(function(e){var f=g.nameLookup(e,b[c],a);return d?[" && ",f]:[" != null ? ",f," : ",e]})},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(a,b){this.pushContext(),this.pushString(b),"SubExpression"!==b&&("string"==typeof a?this.pushString(a):this.pushStackLiteral(a))},emptyHash:function(a){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(a?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var a=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(a.ids)),this.stringParams&&(this.push(this.objectLiteral(a.contexts)),this.push(this.objectLiteral(a.types))),this.push(this.objectLiteral(a.values))},pushString:function(a){this.pushStackLiteral(this.quotedString(a))},pushLiteral:function(a){this.pushStackLiteral(a)},pushProgram:function(a){null!=a?this.pushStackLiteral(this.programExpression(a)):this.pushStackLiteral(null)},registerDecorator:function(a,b){var c=this.nameLookup("decorators",b,"decorator"),d=this.setupHelperArgs(b,a);this.decorators.push(["fn = ",this.decorators.functionCall(c,"",["fn","props","container",d])," || fn;"])},invokeHelper:function(a,b,c){var d=this.popStack(),e=this.setupHelper(a,b),f=c?[e.name," || "]:"",g=["("].concat(f,d);this.options.strict||g.push(" || ",this.aliasable("helpers.helperMissing")),g.push(")"),this.push(this.source.functionCall(g,"call",e.callParams))},invokeKnownHelper:function(a,b){var c=this.setupHelper(a,b);this.push(this.source.functionCall(c.name,"call",c.callParams))},invokeAmbiguous:function(a,b){this.useRegister("helper");var c=this.popStack();this.emptyHash();var d=this.setupHelper(0,a,b),e=this.lastHelper=this.nameLookup("helpers",a,"helper"),f=["(","(helper = ",e," || ",c,")"];this.options.strict||(f[0]="(helper = ",f.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",f,d.paramsInit?["),(",d.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",d.callParams)," : helper))"])},invokePartial:function(a,b,c){var d=[],e=this.setupParams(b,1,d);a&&(b=this.popStack(),delete e.name),c&&(e.indent=JSON.stringify(c)),e.helpers="helpers",e.partials="partials",e.decorators="container.decorators",a?d.unshift(b):d.unshift(this.nameLookup("partials",b,"partial")),this.options.compat&&(e.depths="depths"),e=this.objectLiteral(e),
d.push(e),this.push(this.source.functionCall("container.invokePartial","",d))},assignToHash:function(a){var b=this.popStack(),c=void 0,d=void 0,e=void 0;this.trackIds&&(e=this.popStack()),this.stringParams&&(d=this.popStack(),c=this.popStack());var f=this.hash;c&&(f.contexts[a]=c),d&&(f.types[a]=d),e&&(f.ids[a]=e),f.values[a]=b},pushId:function(a,b,c){"BlockParam"===a?this.pushStackLiteral("blockParams["+b[0]+"].path["+b[1]+"]"+(c?" + "+JSON.stringify("."+c):"")):"PathExpression"===a?this.pushString(b):"SubExpression"===a?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:e,compileChildren:function(a,b){for(var c=a.children,d=void 0,e=void 0,f=0,g=c.length;g>f;f++){d=c[f],e=new this.compiler;var h=this.matchExistingProgram(d);null==h?(this.context.programs.push(""),h=this.context.programs.length,d.index=h,d.name="program"+h,this.context.programs[h]=e.compile(d,b,this.context,!this.precompile),this.context.decorators[h]=e.decorators,this.context.environments[h]=d,this.useDepths=this.useDepths||e.useDepths,this.useBlockParams=this.useBlockParams||e.useBlockParams):(d.index=h,d.name="program"+h,this.useDepths=this.useDepths||d.useDepths,this.useBlockParams=this.useBlockParams||d.useBlockParams)}},matchExistingProgram:function(a){for(var b=0,c=this.context.environments.length;c>b;b++){var d=this.context.environments[b];if(d&&d.equals(a))return b}},programExpression:function(a){var b=this.environment.children[a],c=[b.index,"data",b.blockParams];return(this.useBlockParams||this.useDepths)&&c.push("blockParams"),this.useDepths&&c.push("depths"),"container.program("+c.join(", ")+")"},useRegister:function(a){this.registers[a]||(this.registers[a]=!0,this.registers.list.push(a))},push:function(a){return a instanceof d||(a=this.source.wrap(a)),this.inlineStack.push(a),a},pushStackLiteral:function(a){this.push(new d(a))},pushSource:function(a){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),a&&this.source.push(a)},replaceStack:function(a){var b=["("],c=void 0,e=void 0,f=void 0;if(!this.isInline())throw new j["default"]("replaceStack on non-inline");var g=this.popStack(!0);if(g instanceof d)c=[g.value],b=["(",c],f=!0;else{e=!0;var h=this.incrStack();b=["((",this.push(h)," = ",g,")"],c=this.topStack()}var i=a.call(this,c);f||this.popStack(),e&&this.stackSlot--,this.push(b.concat(i,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var a=this.inlineStack;this.inlineStack=[];for(var b=0,c=a.length;c>b;b++){var e=a[b];if(e instanceof d)this.compileStack.push(e);else{var f=this.incrStack();this.pushSource([f," = ",e,";"]),this.compileStack.push(f)}}},isInline:function(){return this.inlineStack.length},popStack:function(a){var b=this.isInline(),c=(b?this.inlineStack:this.compileStack).pop();if(!a&&c instanceof d)return c.value;if(!b){if(!this.stackSlot)throw new j["default"]("Invalid stack pop");this.stackSlot--}return c},topStack:function(){var a=this.isInline()?this.inlineStack:this.compileStack,b=a[a.length-1];return b instanceof d?b.value:b},contextName:function(a){return this.useDepths&&a?"depths["+a+"]":"depth"+a},quotedString:function(a){return this.source.quotedString(a)},objectLiteral:function(a){return this.source.objectLiteral(a)},aliasable:function(a){var b=this.aliases[a];return b?(b.referenceCount++,b):(b=this.aliases[a]=this.source.wrap(a),b.aliasable=!0,b.referenceCount=1,b)},setupHelper:function(a,b,c){var d=[],e=this.setupHelperArgs(b,a,d,c),f=this.nameLookup("helpers",b,"helper"),g=this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : {}");return{params:d,paramsInit:e,name:f,callParams:[g].concat(d)}},setupParams:function(a,b,c){var d={},e=[],f=[],g=[],h=!c,i=void 0;h&&(c=[]),d.name=this.quotedString(a),d.hash=this.popStack(),this.trackIds&&(d.hashIds=this.popStack()),this.stringParams&&(d.hashTypes=this.popStack(),d.hashContexts=this.popStack());var j=this.popStack(),k=this.popStack();(k||j)&&(d.fn=k||"container.noop",d.inverse=j||"container.noop");for(var l=b;l--;)i=this.popStack(),c[l]=i,this.trackIds&&(g[l]=this.popStack()),this.stringParams&&(f[l]=this.popStack(),e[l]=this.popStack());return h&&(d.args=this.source.generateArray(c)),this.trackIds&&(d.ids=this.source.generateArray(g)),this.stringParams&&(d.types=this.source.generateArray(f),d.contexts=this.source.generateArray(e)),this.options.data&&(d.data="data"),this.useBlockParams&&(d.blockParams="blockParams"),d},setupHelperArgs:function(a,b,c,d){var e=this.setupParams(a,b,c);return e=this.objectLiteral(e),d?(this.useRegister("options"),c.push("options"),["options=",e]):c?(c.push(e),""):e}},function(){for(var a="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),b=e.RESERVED_WORDS={},c=0,d=a.length;d>c;c++)b[a[c]]=!0}(),e.isValidJavaScriptVariableName=function(a){return!e.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(a)},b["default"]=e,a.exports=b["default"]},function(a,b,c){"use strict";function d(a,b,c){if(f.isArray(a)){for(var d=[],e=0,g=a.length;g>e;e++)d.push(b.wrap(a[e],c));return d}return"boolean"==typeof a||"number"==typeof a?a+"":a}function e(a){this.srcFile=a,this.source=[]}b.__esModule=!0;var f=c(5),g=void 0;try{}catch(h){}g||(g=function(a,b,c,d){this.src="",d&&this.add(d)},g.prototype={add:function(a){f.isArray(a)&&(a=a.join("")),this.src+=a},prepend:function(a){f.isArray(a)&&(a=a.join("")),this.src=a+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),e.prototype={isEmpty:function(){return!this.source.length},prepend:function(a,b){this.source.unshift(this.wrap(a,b))},push:function(a,b){this.source.push(this.wrap(a,b))},merge:function(){var a=this.empty();return this.each(function(b){a.add(["  ",b,"\n"])}),a},each:function(a){for(var b=0,c=this.source.length;c>b;b++)a(this.source[b])},empty:function(){var a=this.currentLocation||{start:{}};return new g(a.start.line,a.start.column,this.srcFile)},wrap:function(a){var b=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return a instanceof g?a:(a=d(a,this,b),new g(b.start.line,b.start.column,this.srcFile,a))},functionCall:function(a,b,c){return c=this.generateList(c),this.wrap([a,b?"."+b+"(":"(",c,")"])},quotedString:function(a){return'"'+(a+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)){var e=d(a[c],this);"undefined"!==e&&b.push([this.quotedString(c),":",e])}var f=this.generateList(b);return f.prepend("{"),f.add("}"),f},generateList:function(a){for(var b=this.empty(),c=0,e=a.length;e>c;c++)c&&b.add(","),b.add(d(a[c],this));return b},generateArray:function(a){var b=this.generateList(a);return b.prepend("["),b.add("]"),b}},b["default"]=e,a.exports=b["default"]}])});
/*! jQuery UI - v1.11.2 - 2015-01-17
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, draggable.js, droppable.js, sortable.js, datepicker.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */


(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/input|select|textarea|button|object/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function s(e){for(var t,i;e.length&&e[0]!==document;){if(t=e.css("position"),("absolute"===t||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",o)}function o(){e.datepicker._isDisabledDatepicker(d.inline?d.dpDiv.parent()[0]:d.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&&(t[s]=i[s]);return t}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var h=0,l=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=l.call(arguments,1),a=0,o=n.length;o>a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a="string"==typeof n,o=l.call(arguments,1),r=this;return n=!a&&o.length?e.widget.extend.apply(null,[n].concat(o)):n,a?this.each(function(){var i,a=e.data(this,s);return"instance"===n?(r=a,!1):a?e.isFunction(a[n])&&"_"!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&&void 0!==i?(r=i&&i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&&t._init()):e.data(this,s,new i(n,this))}),r}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=h++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var u=!1;e(document).mouseup(function(){u=!1}),e.widget("ui.mouse",{version:"1.11.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!u){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),u=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),u=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.widget("ui.draggable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),o.grid&&(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left>=i[0]||a-this.offset.click.left>i[2]?a:a-this.offset.click.left>=i[0]?a-o.grid[0]:a+o.grid[0]:a),"y"===o.axis&&(h=this.originalPageX),"x"===o.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&&(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&&this._intersectsWith(this.containerCache)&&e.contains(a.element[0],this.element[0])&&(n=!1),n})),n?(a.isOver||(a.isOver=1,a.currentItem=i.helper.appendTo(a.element).data("ui-sortable-item",!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger("toSortable",t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&&(a._mouseDrag(t),i.position=a.position)):a.isOver&&(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger("out",t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&&a.placeholder.remove(),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger("fromSortable",t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,s){var n=e("body"),a=s.options;n.css("cursor")&&(a._cursor=n.css("cursor")),n.css("cursor",a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("opacity")&&(a._opacity=n.css("opacity")),n.css("opacity",a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&&"HTML"!==o.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY<n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top<n.scrollSensitivity&&(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX<n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left<n.scrollSensitivity&&(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(r).scrollTop()<n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<n.scrollSensitivity&&(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(r).scrollLeft()<n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<n.scrollSensitivity&&(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(s,t)
}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c>=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m>v||g>l+m||u-m>b||y>d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):("inner"!==f.snapMode&&(n=m>=Math.abs(u-b),a=m>=Math.abs(d-y),o=m>=Math.abs(h-v),r=m>=Math.abs(l-g),n&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left)),p=n||a||o||r,"outer"!==f.snapMode&&(n=m>=Math.abs(u-y),a=m>=Math.abs(d-b),o=m>=Math.abs(h-g),r=m>=Math.abs(l-v),n&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.top=s._convertPositionTo("relative",{top:d-s.helperProportions.height,left:0}).top),o&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&&(n||a||o||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(n=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css("zIndex")&&(a._zIndex=n.css("zIndex")),n.css("zIndex",a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.droppable",{version:"1.11.2",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case"fit":return a>=l&&d>=r&&o>=u&&c>=h;case"intersect":return a+t.helperProportions.width/2>l&&d>r-t.helperProportions.width/2&&o+t.helperProportions.height/2>u&&c>h-t.helperProportions.height/2;case"pointer":return e(n.pageY,u,i.proportions().height)&&e(n.pageX,l,i.proportions().width);case"touch":return(o>=u&&c>=o||h>=u&&c>=h||u>o&&h>c)&&(a>=l&&d>=a||r>=l&&d>=r||l>a&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(s=0;a.length>s;s++)if(!(a[s].options.disabled||t&&!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length>n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible="none"!==a[s].element.css("display"),a[s].visible&&("mousedown"===o&&a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&&this.isover?"isout":o&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,a=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n}),a.length&&(s=e(a[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable,e.widget("ui.sortable",e.ui.mouse,{version:"1.11.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||this._isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+"-item")===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+"-item")===a&&(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find("*").addBack().each(function(){this===t.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(a=this.document.find("body"),this.storedCursor=a.css("cursor"),a.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(a)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),r!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===a?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&&"x"!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),a&&"y"!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&s.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!s.length&&t.key&&s.push(t.key+"="),s.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||"id")||"")}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d="x"===this.options.axis||s+l>r&&h>s+l,c="y"===this.options.axis||t+u>a&&o>t+u,p=d&&c;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>a&&o>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&&i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&&"right"===a||"down"===n?2:1:n&&("down"===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&t||"up"===s&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&&t)for(s=l.length-1;s>=0;s--)for(a=e(l[s]),n=a.length-1;n>=0;n--)o=e.data(a[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=h.length-1;s>=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&&this.ready)for(i=c.length-1;i>=0;i--)for(n=e(c[i]),s=n.length-1;s>=0;s--)a=e.data(n[s],this.widgetFullName),a&&a!==this&&!a.options.disabled&&(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i>=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l>s;s++)h=e(r[s]),h.data(this.widgetName+"-item",o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+s+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n)}):"img"===s&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&&e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?"left":"top",r=u?"width":"height",d=u?"clientX":"clientY",s=this.items.length-1;s>=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(h=this.items[s].item.offset()[o],l=!1,t[d]-h>this.items[s][r]/2&&(l=!0),n>Math.abs(t[d]-h)&&(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)t||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(s=0;n.length>s;s++)n[s].call(this,e);
this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.extend(e.ui,{datepicker:{version:"1.11.2"}});var d;e.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n="div"===s||"span"===s,t.id||(this.uuid+=1,t.id="dp"+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),"input"===s?this._connectDatepicker(t,a):n&&this._inlineDatepicker(t,a)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var s,n,a,o=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[r?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&t.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),a=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(a?e("<img/>").attr({src:a,alt:n,title:n}):n)),t[r?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,s=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,s=n);return s},a.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),a.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-a.getDay())),e.input.attr("size",this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+o+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],"datepicker",c)),r(c.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",c),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,"datepicker");s.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,a.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,a.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},"string"==typeof i&&(n={},n[i]=s),l&&(this._curInst===l&&this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,"min"),h=this._getMinMaxDate(l,"max"),r(l.settings,n),null!==o&&void 0!==n.dateFormat&&void 0===n.minDate&&(l.settings.minDate=this._formatDate(l,o)),null!==h&&void 0!==n.dateFormat&&void 0===n.maxDate&&(l.settings.maxDate=this._formatDate(l,h)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(".ui-datepicker-rtl");if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",a.dpDiv),n[0]&&e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,"onSelect"),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,"stepBigMonths"):-e.datepicker._get(a,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,r?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,"stepBigMonths"):+e.datepicker._get(a,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">s||!i||i.indexOf(s)>-1):void 0},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&&(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),a=n?n.apply(t,[t,i]):{},a!==!1&&(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:h.left+"px",top:h.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,d=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find("."+this._dayOverClass+" a");r.length>0&&o.apply(r.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),t.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=s&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&&i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a>l&&l>a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),s=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o)},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),s,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,"onClose"),a&&a.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==s)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+("M"===s?this._get(a,"showCurrentAtPos"):0),s),this._updateDatepicker(a))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a["selected"+("M"===s?"Month":"Year")]=a["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e("a",n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&&a.input.val(i),this._updateAlternate(a),s=this._get(a,"onSelect"),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&&a.input.trigger("change"),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,a=this._get(t,"altField");a&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?""+i:i+"",""===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},x=function(e){var t=_(e),s="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n="y"===e?s:1,a=RegExp("^\\d{"+n+","+s+"}"),o=i.substring(h).match(a);if(!o)throw"Missing number at position "+h;return h+=o[0].length,parseInt(o[0],10)},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0}),-1!==a)return a+1;throw"Unknown name at position "+h},k=function(){if(i.charAt(h)!==t.charAt(n))throw"Unexpected literal at position "+h;h++};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||_("'")?k():b=!1;else switch(t.charAt(n)){case"d":v=x("d");break;case"D":w("D",d,c);break;case"o":y=x("o");break;case"m":g=x("m");break;case"M":g=w("M",p,f);break;case"y":m=x("y");break;case"@":r=new Date(x("@")),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"!":r=new Date((x("!")-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case"'":_("'")?k():b=!0;break;default:k()}if(i.length>h&&(o=i.substr(h),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),y>-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a>=v)break;g++,v-=a}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw"Invalid date";return r},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length>s+1&&e.charAt(s+1)===t;return i&&s++,i},l=function(e,t,i){var s=""+t;if(h(e))for(;i>s.length;)s="0"+s;return s},u=function(e,t,i,s){return h(e)?s[t]:i[t]},d="",c=!1;if(t)for(s=0;e.length>s;s++)if(c)"'"!==e.charAt(s)||h("'")?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case"d":d+=l("d",t.getDate(),2);break;case"D":d+=u("D",t.getDay(),n,a);break;case"o":d+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",t.getMonth()+1,2);break;case"M":d+=u("M",t.getMonth(),o,r);break;case"y":d+=h("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":d+=t.getTime();break;case"!":d+=1e4*t.getTime()+this._ticksTo1970;break;case"'":h("'")?d+="'":c=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i="",s=!1,n=function(i){var s=e.length>t+1&&e.charAt(t+1)===i;return s&&t++,s};for(t=0;e.length>t;t++)if(s)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n}catch(r){s=t?"":s}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,s){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case"y":case"Y":a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o))}l=h.exec(i)}return new Date(a,o,r)},o=null==i||""===i?s:"string"==typeof i?a(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&&"Invalid Date"==""+o?s:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(s?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),s="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,"M")},next:function(){e.datepicker._adjustDate(s,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,N,M,C,A,P,I,H,z,F,E,W,O,L,j=new Date,R=this._daylightSavingAdjust(new Date(j.getFullYear(),j.getMonth(),j.getDate())),Y=this._get(e,"isRTL"),J=this._get(e,"showButtonPanel"),B=this._get(e,"hideIfNoPrevNext"),K=this._get(e,"navigationAsDateFormat"),V=this._getNumberOfMonths(e),U=this._get(e,"showCurrentAtPos"),q=this._get(e,"stepMonths"),G=1!==V[0]||1!==V[1],X=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(e,"min"),$=this._getMinMaxDate(e,"max"),Z=e.drawMonth-U,et=e.drawYear;if(0>Z&&(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-V[0]*V[1]+1,$.getDate())),t=Q&&Q>t?Q:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-q,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":B?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+q,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":B?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),r=this._get(e,"gotoCurrent")&&e.currentDay?X:R,o=K?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=J?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(e,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(Y?"":h)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,d=this._get(e,"showWeek"),c=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",w=0;V[0]>w;w++){for(k="",this.maxRows=4,T=0;V[1]>T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",N="",G){if(N+="<div class='ui-datepicker-group",V[1]>1)switch(T){case 0:N+=" ui-datepicker-group-first",S=" ui-corner-"+(Y?"right":"left");break;case V[1]-1:N+=" ui-datepicker-group-last",S=" ui-corner-"+(Y?"left":"right");break;default:N+=" ui-datepicker-group-middle",S=""}N+="'>"}for(N+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===w?Y?a:s:"")+(/all|right/.test(S)&&0===w?Y?s:a:"")+this._generateMonthYearHeader(e,Z,et,Q,$,w>0||T>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",M=d?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",x=0;7>x;x++)C=(x+u)%7,M+="<th scope='col'"+((x+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+c[C]+"'>"+p[C]+"</span></th>";for(N+=M+"</tr></thead><tbody>",A=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),H=G?this.maxRows>I?this.maxRows:I:I,this.maxRows=H,z=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;H>F;F++){for(N+="<tr>",E=d?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(z)+"</td>":"",x=0;7>x;x++)W=g?g.apply(e.input?e.input[0]:null,[z]):[!0,""],O=z.getMonth()!==Z,L=O&&!y||!W[0]||Q&&Q>z||$&&z>$,E+="<td class='"+((x+u+6)%7>=5?" ui-datepicker-week-end":"")+(O?" ui-datepicker-other-month":"")+(z.getTime()===D.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===z.getTime()&&b.getTime()===D.getTime()?" "+this._dayOverClass:"")+(L?" "+this._unselectableClass+" ui-state-disabled":"")+(O&&!v?"":" "+W[1]+(z.getTime()===X.getTime()?" "+this._currentClass:"")+(z.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+(O&&!v||!W[2]?"":" title='"+W[2].replace(/'/g,"&#39;")+"'")+(L?"":" data-handler='selectDay' data-event='click' data-month='"+z.getMonth()+"' data-year='"+z.getFullYear()+"'")+">"+(O&&!v?"&#xa0;":L?"<span class='ui-state-default'>"+z.getDate()+"</span>":"<a class='ui-state-default"+(z.getTime()===R.getTime()?" ui-state-highlight":"")+(z.getTime()===X.getTime()?" ui-state-active":"")+(O?" ui-priority-secondary":"")+"' href='#'>"+z.getDate()+"</a>")+"</td>",z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);N+=E+"</tr>"}Z++,Z>11&&(Z=0,et++),N+="</tbody></table>"+(G?"</div>"+(V[0]>0&&T===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),k+=N}_+=k}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(a||!g)_+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!h||u>=s.getMonth())&&(!l||n.getMonth()>=u)&&(_+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+r[u]+"</option>");_+="</select>"}if(y||(b+=_+(!a&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",a||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(d=this._get(e,"yearRange").split(":"),c=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t},f=p(d[0]),m=Math.max(f,p(d[1]||"")),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!a&&g&&v?"":"&#xa0;")+_),b+="</div>"},_adjustInstDate:function(e,t,i){var s=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return s&&n>s?s:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0>t?t:n[0]*n[1]),1));return 0>t&&a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),o=null,r=null,h=this._get(e,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||t.getTime()>=n.getTime())&&(!a||t.getTime()<=a.getTime())&&(!o||t.getFullYear()>=o)&&(!r||r>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}
},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.2",e.datepicker});
/*!
	Autosize v1.18.9 - 2014-05-27
	Automatically adjust textarea height based on user input.
	(c) 2014 Jack Moore - http://www.jacklmoore.com/autosize
	license: http://www.opensource.org/licenses/mit-license.php
*/

(function ($) {
	var
	defaults = {
		className: 'autosizejs',
		id: 'autosizejs',
		append: '\n',
		callback: false,
		resizeDelay: 10,
		placeholder: true
	},

	// border:0 is unnecessary, but avoids a bug in Firefox on OSX
	copy = '<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; padding: 0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',

	// line-height is conditionally included because IE7/IE8/old Opera do not return the correct value.
	typographyStyles = [
		'fontFamily',
		'fontSize',
		'fontWeight',
		'fontStyle',
		'letterSpacing',
		'textTransform',
		'wordSpacing',
		'textIndent'
	],

	// to keep track which textarea is being mirrored when adjust() is called.
	mirrored,

	// the mirror element, which is used to calculate what size the mirrored element should be.
	mirror = $(copy).data('autosize', true)[0];

	// test that line-height can be accurately copied.
	mirror.style.lineHeight = '99px';
	if ($(mirror).css('lineHeight') === '99px') {
		typographyStyles.push('lineHeight');
	}
	mirror.style.lineHeight = '';

	$.fn.autosize = function (options) {
		if (!this.length) {
			return this;
		}

		options = $.extend({}, defaults, options || {});

		if (mirror.parentNode !== document.body) {
			$(document.body).append(mirror);
		}

		return this.each(function () {
			var
			ta = this,
			$ta = $(ta),
			maxHeight,
			minHeight,
			boxOffset = 0,
			callback = $.isFunction(options.callback),
			originalStyles = {
				height: ta.style.height,
				overflow: ta.style.overflow,
				overflowY: ta.style.overflowY,
				wordWrap: ta.style.wordWrap,
				resize: ta.style.resize
			},
			timeout,
			width = $ta.width(),
			taResize = $ta.css('resize');

			if ($ta.data('autosize')) {
				// exit if autosize has already been applied, or if the textarea is the mirror element.
				return;
			}
			$ta.data('autosize', true);

			if ($ta.css('box-sizing') === 'border-box' || $ta.css('-moz-box-sizing') === 'border-box' || $ta.css('-webkit-box-sizing') === 'border-box'){
				boxOffset = $ta.outerHeight() - $ta.height();
			}

			// IE8 and lower return 'auto', which parses to NaN, if no min-height is set.
			minHeight = Math.max(parseInt($ta.css('minHeight'), 10) - boxOffset || 0, $ta.height());

			$ta.css({
				overflow: 'hidden',
				overflowY: 'hidden',
				wordWrap: 'break-word' // horizontal overflow is hidden, so break-word is necessary for handling words longer than the textarea width
			});

			if (taResize === 'vertical') {
				$ta.css('resize','none');
			} else if (taResize === 'both') {
				$ta.css('resize', 'horizontal');
			}

			// The mirror width must exactly match the textarea width, so using getBoundingClientRect because it doesn't round the sub-pixel value.
			// window.getComputedStyle, getBoundingClientRect returning a width are unsupported, but also unneeded in IE8 and lower.
			function setWidth() {
				var width;
				var style = window.getComputedStyle ? window.getComputedStyle(ta, null) : false;
				
				if (style) {

					width = ta.getBoundingClientRect().width;

					if (width === 0 || typeof width !== 'number') {
						width = parseInt(style.width,10);
					}

					$.each(['paddingLeft', 'paddingRight', 'borderLeftWidth', 'borderRightWidth'], function(i,val){
						width -= parseInt(style[val],10);
					});
				} else {
					width = $ta.width();
				}

				mirror.style.width = Math.max(width,0) + 'px';
			}

			function initMirror() {
				var styles = {};

				mirrored = ta;
				mirror.className = options.className;
				mirror.id = options.id;
				maxHeight = parseInt($ta.css('maxHeight'), 10);

				// mirror is a duplicate textarea located off-screen that
				// is automatically updated to contain the same text as the
				// original textarea.  mirror always has a height of 0.
				// This gives a cross-browser supported way getting the actual
				// height of the text, through the scrollTop property.
				$.each(typographyStyles, function(i,val){
					styles[val] = $ta.css(val);
				});
				
				$(mirror).css(styles).attr('wrap', $ta.attr('wrap'));

				setWidth();

				// Chrome-specific fix:
				// When the textarea y-overflow is hidden, Chrome doesn't reflow the text to account for the space
				// made available by removing the scrollbar. This workaround triggers the reflow for Chrome.
				if (window.chrome) {
					var width = ta.style.width;
					ta.style.width = '0px';
					var ignore = ta.offsetWidth;
					ta.style.width = width;
				}
			}

			// Using mainly bare JS in this function because it is going
			// to fire very often while typing, and needs to very efficient.
			function adjust() {
				var height, original;

				if (mirrored !== ta) {
					initMirror();
				} else {
					setWidth();
				}

				if (!ta.value && options.placeholder) {
					// If the textarea is empty, copy the placeholder text into 
					// the mirror control and use that for sizing so that we 
					// don't end up with placeholder getting trimmed.
					mirror.value = ($ta.attr("placeholder") || '') + options.append;
				} else {
					mirror.value = ta.value + options.append;
				}

				mirror.style.overflowY = ta.style.overflowY;
				original = parseInt(ta.style.height,10);

				// Setting scrollTop to zero is needed in IE8 and lower for the next step to be accurately applied
				mirror.scrollTop = 0;

				mirror.scrollTop = 9e4;

				// Using scrollTop rather than scrollHeight because scrollHeight is non-standard and includes padding.
				height = mirror.scrollTop;

				if (maxHeight && height > maxHeight) {
					ta.style.overflowY = 'scroll';
					height = maxHeight;
				} else {
					ta.style.overflowY = 'hidden';
					if (height < minHeight) {
						height = minHeight;
					}
				}

				height += boxOffset;

				if (original !== height) {
					ta.style.height = height + 'px';
					if (callback) {
						options.callback.call(ta,ta);
					}
				}
			}

			function resize () {
				clearTimeout(timeout);
				timeout = setTimeout(function(){
					var newWidth = $ta.width();

					if (newWidth !== width) {
						width = newWidth;
						adjust();
					}
				}, parseInt(options.resizeDelay,10));
			}

			if ('onpropertychange' in ta) {
				if ('oninput' in ta) {
					// Detects IE9.  IE9 does not fire onpropertychange or oninput for deletions,
					// so binding to onkeyup to catch most of those occasions.  There is no way that I
					// know of to detect something like 'cut' in IE9.
					$ta.on('input.autosize keyup.autosize', adjust);
				} else {
					// IE7 / IE8
					$ta.on('propertychange.autosize', function(){
						if(event.propertyName === 'value'){
							adjust();
						}
					});
				}
			} else {
				// Modern Browsers
				$ta.on('input.autosize', adjust);
			}

			// Set options.resizeDelay to false if using fixed-width textarea elements.
			// Uses a timeout and width check to reduce the amount of times adjust needs to be called after window resize.

			if (options.resizeDelay !== false) {
				$(window).on('resize.autosize', resize);
			}

			// Event for manual triggering if needed.
			// Should only be needed when the value of the textarea is changed through JavaScript rather than user input.
			$ta.on('autosize.resize', adjust);

			// Event for manual triggering that also forces the styles to update as well.
			// Should only be needed if one of typography styles of the textarea change, and the textarea is already the target of the adjust method.
			$ta.on('autosize.resizeIncludeStyle', function() {
				mirrored = null;
				adjust();
			});

			$ta.on('autosize.destroy', function(){
				mirrored = null;
				clearTimeout(timeout);
				$(window).off('resize', resize);
				$ta
					.off('autosize')
					.off('.autosize')
					.css(originalStyles)
					.removeData('autosize');
			});

			// Call adjust in case the textarea already contains text.
			adjust();
		});
	};
}(window.jQuery || window.$)); // jQuery or jQuery-like library, such as Zepto
;
!function(s){s.fn.colourBrightness=function(s){var e,a,t,r,n=s;n.match(/^rgb/)?(n=n.match(/rgb\(([^)]+)\)/)[1],n=n.split(/ *, */).map(Number),e=n[0],a=n[1],t=n[2]):"#"==n[0]&&7==n.length?(e=parseInt(n.slice(1,3),16),a=parseInt(n.slice(3,5),16),t=parseInt(n.slice(5,7),16)):"#"==n[0]&&4==n.length&&(e=parseInt(n[1]+n[1],16),a=parseInt(n[2]+n[2],16),t=parseInt(n[3]+n[3],16)),r=(299*e+587*a+114*t)/1e3,125>r?this.removeClass("light").addClass("dark"):this.removeClass("dark").addClass("light")}}(jQuery);
/*!
 @package noty - jQuery Notification Plugin
 @version version: 2.2.5
 @contributors https://github.com/needim/noty/graphs/contributors

 @documentation Examples and Documentation - http://needim.github.com/noty/

 @license Licensed under the MIT licenses: http://www.opensource.org/licenses/mit-license.php
 */

"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),function(a){var b={init:function(b){return this.options=a.extend({},a.noty.defaults,b),this.options.layout=this.options.custom?a.noty.layouts.inline:a.noty.layouts[this.options.layout],a.noty.themes[this.options.theme]?this.options.theme=a.noty.themes[this.options.theme]:b.themeClassName=this.options.theme,delete b.layout,delete b.theme,this.options=a.extend({},this.options,this.options.layout.options),this.options.id="noty_"+(new Date).getTime()*Math.floor(1e6*Math.random()),this.options=a.extend({},this.options,b),this._build(),this},_build:function(){var b=a('<div class="noty_bar noty_type_'+this.options.type+'"></div>').attr("id",this.options.id);if(b.append(this.options.template).find(".noty_text").html(this.options.text),this.$bar=null!==this.options.layout.parent.object?a(this.options.layout.parent.object).css(this.options.layout.parent.css).append(b):b,this.options.themeClassName&&this.$bar.addClass(this.options.themeClassName).addClass("noty_container_type_"+this.options.type),this.options.buttons){this.options.closeWith=[],this.options.timeout=!1;var c=a("<div/>").addClass("noty_buttons");null!==this.options.layout.parent.object?this.$bar.find(".noty_bar").append(c):this.$bar.append(c);var d=this;a.each(this.options.buttons,function(b,c){var e=a("<button/>").addClass(c.addClass?c.addClass:"gray").html(c.text).attr("id",c.id?c.id:"button-"+b).appendTo(d.$bar.find(".noty_buttons")).on("click",function(){a.isFunction(c.onClick)&&c.onClick.call(e,d)})})}this.$message=this.$bar.find(".noty_message"),this.$closeButton=this.$bar.find(".noty_close"),this.$buttons=this.$bar.find(".noty_buttons"),a.noty.store[this.options.id]=this},show:function(){var b=this;return b.options.custom?b.options.custom.find(b.options.layout.container.selector).append(b.$bar):a(b.options.layout.container.selector).append(b.$bar),b.options.theme&&b.options.theme.style&&b.options.theme.style.apply(b),"function"===a.type(b.options.layout.css)?this.options.layout.css.apply(b.$bar):b.$bar.css(this.options.layout.css||{}),b.$bar.addClass(b.options.layout.addClass),b.options.layout.container.style.apply(a(b.options.layout.container.selector)),b.showing=!0,b.options.theme&&b.options.theme.style&&b.options.theme.callback.onShow.apply(this),a.inArray("click",b.options.closeWith)>-1&&b.$bar.css("cursor","pointer").one("click",function(a){b.stopPropagation(a),b.options.callback.onCloseClick&&b.options.callback.onCloseClick.apply(b),b.close()}),a.inArray("hover",b.options.closeWith)>-1&&b.$bar.one("mouseenter",function(){b.close()}),a.inArray("button",b.options.closeWith)>-1&&b.$closeButton.one("click",function(a){b.stopPropagation(a),b.close()}),-1==a.inArray("button",b.options.closeWith)&&b.$closeButton.remove(),b.options.callback.onShow&&b.options.callback.onShow.apply(b),b.$bar.animate(b.options.animation.open,b.options.animation.speed,b.options.animation.easing,function(){b.options.callback.afterShow&&b.options.callback.afterShow.apply(b),b.showing=!1,b.shown=!0}),b.options.timeout&&b.$bar.delay(b.options.timeout).promise().done(function(){b.close()}),this},close:function(){if(!(this.closed||this.$bar&&this.$bar.hasClass("i-am-closing-now"))){var b=this;if(this.showing)return b.$bar.queue(function(){b.close.apply(b)}),void 0;if(!this.shown&&!this.showing){var c=[];return a.each(a.noty.queue,function(a,d){d.options.id!=b.options.id&&c.push(d)}),a.noty.queue=c,void 0}b.$bar.addClass("i-am-closing-now"),b.options.callback.onClose&&b.options.callback.onClose.apply(b),b.$bar.clearQueue().stop().animate(b.options.animation.close,b.options.animation.speed,b.options.animation.easing,function(){b.options.callback.afterClose&&b.options.callback.afterClose.apply(b)}).promise().done(function(){b.options.modal&&(a.notyRenderer.setModalCount(-1),0==a.notyRenderer.getModalCount()&&a(".noty_modal").fadeOut("fast",function(){a(this).remove()})),a.notyRenderer.setLayoutCountFor(b,-1),0==a.notyRenderer.getLayoutCountFor(b)&&a(b.options.layout.container.selector).remove(),"undefined"!=typeof b.$bar&&null!==b.$bar&&(b.$bar.remove(),b.$bar=null,b.closed=!0),delete a.noty.store[b.options.id],b.options.theme.callback&&b.options.theme.callback.onClose&&b.options.theme.callback.onClose.apply(b),b.options.dismissQueue||(a.noty.ontap=!0,a.notyRenderer.render()),b.options.maxVisible>0&&b.options.dismissQueue&&a.notyRenderer.render()})}},setText:function(a){return this.closed||(this.options.text=a,this.$bar.find(".noty_text").html(a)),this},setType:function(a){return this.closed||(this.options.type=a,this.options.theme.style.apply(this),this.options.theme.callback.onShow.apply(this)),this},setTimeout:function(a){if(!this.closed){var b=this;this.options.timeout=a,b.$bar.delay(b.options.timeout).promise().done(function(){b.close()})}return this},stopPropagation:function(a){a=a||window.event,"undefined"!=typeof a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},closed:!1,showing:!1,shown:!1};a.notyRenderer={},a.notyRenderer.init=function(c){var d=Object.create(b).init(c);return d.options.killer&&a.noty.closeAll(),d.options.force?a.noty.queue.unshift(d):a.noty.queue.push(d),a.notyRenderer.render(),"object"==a.noty.returns?d:d.options.id},a.notyRenderer.render=function(){var b=a.noty.queue[0];"object"===a.type(b)?b.options.dismissQueue?b.options.maxVisible>0?a(b.options.layout.container.selector+" li").length<b.options.maxVisible&&a.notyRenderer.show(a.noty.queue.shift()):a.notyRenderer.show(a.noty.queue.shift()):a.noty.ontap&&(a.notyRenderer.show(a.noty.queue.shift()),a.noty.ontap=!1):a.noty.ontap=!0},a.notyRenderer.show=function(b){b.options.modal&&(a.notyRenderer.createModalFor(b),a.notyRenderer.setModalCount(1)),b.options.custom?0==b.options.custom.find(b.options.layout.container.selector).length?b.options.custom.append(a(b.options.layout.container.object).addClass("i-am-new")):b.options.custom.find(b.options.layout.container.selector).removeClass("i-am-new"):0==a(b.options.layout.container.selector).length?a("body").append(a(b.options.layout.container.object).addClass("i-am-new")):a(b.options.layout.container.selector).removeClass("i-am-new"),a.notyRenderer.setLayoutCountFor(b,1),b.show()},a.notyRenderer.createModalFor=function(b){if(0==a(".noty_modal").length){var c=a("<div/>").addClass("noty_modal").addClass(b.options.theme).data("noty_modal_count",0);b.options.theme.modal&&b.options.theme.modal.css&&c.css(b.options.theme.modal.css),c.prependTo(a("body")).fadeIn("fast")}},a.notyRenderer.getLayoutCountFor=function(b){return a(b.options.layout.container.selector).data("noty_layout_count")||0},a.notyRenderer.setLayoutCountFor=function(b,c){return a(b.options.layout.container.selector).data("noty_layout_count",a.notyRenderer.getLayoutCountFor(b)+c)},a.notyRenderer.getModalCount=function(){return a(".noty_modal").data("noty_modal_count")||0},a.notyRenderer.setModalCount=function(b){return a(".noty_modal").data("noty_modal_count",a.notyRenderer.getModalCount()+b)},a.fn.noty=function(b){return b.custom=a(this),a.notyRenderer.init(b)},a.noty={},a.noty.queue=[],a.noty.ontap=!0,a.noty.layouts={},a.noty.themes={},a.noty.returns="object",a.noty.store={},a.noty.get=function(b){return a.noty.store.hasOwnProperty(b)?a.noty.store[b]:!1},a.noty.close=function(b){return a.noty.get(b)?a.noty.get(b).close():!1},a.noty.setText=function(b,c){return a.noty.get(b)?a.noty.get(b).setText(c):!1},a.noty.setType=function(b,c){return a.noty.get(b)?a.noty.get(b).setType(c):!1},a.noty.clearQueue=function(){a.noty.queue=[]},a.noty.closeAll=function(){a.noty.clearQueue(),a.each(a.noty.store,function(a,b){b.close()})};var c=window.alert;a.noty.consumeAlert=function(b){window.alert=function(c){b?b.text=c:b={text:c},a.notyRenderer.init(b)}},a.noty.stopConsumeAlert=function(){window.alert=c},a.noty.defaults={layout:"top",theme:"defaultTheme",type:"alert",text:"",dismissQueue:!0,template:'<div class="noty_message"><span class="noty_text"></span><div class="noty_close"></div></div>',animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,killer:!1,closeWith:["click"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){},onCloseClick:function(){}},buttons:!1},a(window).on("resize",function(){a.each(a.noty.layouts,function(b,c){c.container.style.apply(a(c.container.selector))})})}(jQuery),window.noty=function(a){return jQuery.notyRenderer.init(a)},function(a){a.noty.layouts.bottom={name:"bottom",options:{},container:{object:'<ul id="noty_bottom_layout_container" />',selector:"ul#noty_bottom_layout_container",style:function(){a(this).css({bottom:0,left:"5%",position:"fixed",width:"90%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(a){a.noty.layouts.bottomCenter={name:"bottomCenter",options:{},container:{object:'<ul id="noty_bottomCenter_layout_container" />',selector:"ul#noty_bottomCenter_layout_container",style:function(){a(this).css({bottom:20,left:0,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),a(this).css({left:(a(window).width()-a(this).outerWidth(!1))/2+"px"})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.bottomLeft={name:"bottomLeft",options:{},container:{object:'<ul id="noty_bottomLeft_layout_container" />',selector:"ul#noty_bottomLeft_layout_container",style:function(){a(this).css({bottom:20,left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.bottomRight={name:"bottomRight",options:{},container:{object:'<ul id="noty_bottomRight_layout_container" />',selector:"ul#noty_bottomRight_layout_container",style:function(){a(this).css({bottom:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.center={name:"center",options:{},container:{object:'<ul id="noty_center_layout_container" />',selector:"ul#noty_center_layout_container",style:function(){a(this).css({position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});var b=a(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");a("body").append(b),b.find(".i-am-closing-now").remove(),b.find("li").css("display","block");var c=b.height();b.remove(),a(this).hasClass("i-am-new")?a(this).css({left:(a(window).width()-a(this).outerWidth(!1))/2+"px",top:(a(window).height()-c)/2+"px"}):a(this).animate({left:(a(window).width()-a(this).outerWidth(!1))/2+"px",top:(a(window).height()-c)/2+"px"},500)}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.centerLeft={name:"centerLeft",options:{},container:{object:'<ul id="noty_centerLeft_layout_container" />',selector:"ul#noty_centerLeft_layout_container",style:function(){a(this).css({left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});var b=a(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");a("body").append(b),b.find(".i-am-closing-now").remove(),b.find("li").css("display","block");var c=b.height();b.remove(),a(this).hasClass("i-am-new")?a(this).css({top:(a(window).height()-c)/2+"px"}):a(this).animate({top:(a(window).height()-c)/2+"px"},500),window.innerWidth<600&&a(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.centerRight={name:"centerRight",options:{},container:{object:'<ul id="noty_centerRight_layout_container" />',selector:"ul#noty_centerRight_layout_container",style:function(){a(this).css({right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});var b=a(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");a("body").append(b),b.find(".i-am-closing-now").remove(),b.find("li").css("display","block");var c=b.height();b.remove(),a(this).hasClass("i-am-new")?a(this).css({top:(a(window).height()-c)/2+"px"}):a(this).animate({top:(a(window).height()-c)/2+"px"},500),window.innerWidth<600&&a(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.inline={name:"inline",options:{},container:{object:'<ul class="noty_inline_layout_container" />',selector:"ul.noty_inline_layout_container",style:function(){a(this).css({width:"100%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(a){a.noty.layouts.top={name:"top",options:{},container:{object:'<ul id="noty_top_layout_container" />',selector:"ul#noty_top_layout_container",style:function(){a(this).css({top:0,left:"5%",position:"fixed",width:"90%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(a){a.noty.layouts.topCenter={name:"topCenter",options:{},container:{object:'<ul id="noty_topCenter_layout_container" />',selector:"ul#noty_topCenter_layout_container",style:function(){a(this).css({top:20,left:0,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),a(this).css({left:(a(window).width()-a(this).outerWidth(!1))/2+"px"})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.topLeft={name:"topLeft",options:{},container:{object:'<ul id="noty_topLeft_layout_container" />',selector:"ul#noty_topLeft_layout_container",style:function(){a(this).css({top:20,left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.layouts.topRight={name:"topRight",options:{},container:{object:'<ul id="noty_topRight_layout_container" />',selector:"ul#noty_topRight_layout_container",style:function(){a(this).css({top:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7}),window.innerWidth<600&&a(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(a){a.noty.themes.defaultTheme={name:"defaultTheme",helpers:{borderFix:function(){if(this.options.dismissQueue){var b=this.options.layout.container.selector+" "+this.options.layout.parent.selector;switch(this.options.layout.name){case"top":a(b).css({borderRadius:"0px 0px 0px 0px"}),a(b).last().css({borderRadius:"0px 0px 5px 5px"});break;case"topCenter":case"topLeft":case"topRight":case"bottomCenter":case"bottomLeft":case"bottomRight":case"center":case"centerLeft":case"centerRight":case"inline":a(b).css({borderRadius:"0px 0px 0px 0px"}),a(b).first().css({"border-top-left-radius":"5px","border-top-right-radius":"5px"}),a(b).last().css({"border-bottom-left-radius":"5px","border-bottom-right-radius":"5px"});break;case"bottom":a(b).css({borderRadius:"0px 0px 0px 0px"}),a(b).first().css({borderRadius:"5px 5px 0px 0px"})}}}},modal:{css:{position:"fixed",width:"100%",height:"100%",backgroundColor:"#000",zIndex:1e4,opacity:.6,display:"none",left:0,top:0}},style:function(){switch(this.$bar.css({overflow:"hidden",background:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAoCAYAAAAPOoFWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPZJREFUeNq81tsOgjAMANB2ov7/7ypaN7IlIwi9rGuT8QSc9EIDAsAznxvY4pXPKr05RUE5MEVB+TyWfCEl9LZApYopCmo9C4FKSMtYoI8Bwv79aQJU4l6hXXCZrQbokJEksxHo9KMOgc6w1atHXM8K9DVC7FQnJ0i8iK3QooGgbnyKgMDygBWyYFZoqx4qS27KqLZJjA1D0jK6QJcYEQEiWv9PGkTsbqxQ8oT+ZtZB6AkdsJnQDnMoHXHLGKOgDYuCWmYhEERCI5gaamW0bnHdA3k2ltlIN+2qKRyCND0bhqSYCyTB3CAOc4WusBEIpkeBuPgJMAAX8Hs1NfqHRgAAAABJRU5ErkJggg==') repeat-x scroll left top #fff"}),this.$message.css({fontSize:"13px",lineHeight:"16px",textAlign:"center",padding:"8px 10px 9px",width:"auto",position:"relative"}),this.$closeButton.css({position:"absolute",top:4,right:4,width:10,height:10,background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAATpJREFUeNoszrFqVFEUheG19zlz7sQ7ijMQBAvfYBqbpJCoZSAQbOwEE1IHGytbLQUJ8SUktW8gCCFJMSGSNxCmFBJO7j5rpXD6n5/P5vM53H3b3T9LOiB5AQDuDjM7BnA7DMPHDGBH0nuSzwHsRcRVRNRSysuU0i6AOwA/02w2+9Fae00SEbEh6SGAR5K+k3zWWptKepCm0+kpyRoRGyRBcpPkDsn1iEBr7drdP2VJZyQXERGSPpiZAViTBACXKaV9kqd5uVzCzO5KKb/d/UZSDwD/eyxqree1VqSu6zKAF2Z2RPJJaw0rAkjOJT0m+SuT/AbgDcmnkmBmfwAsJL1dXQ8lWY6IGwB1ZbrOOb8zs8thGP4COFwx/mE8Ho9Go9ErMzvJOW/1fY/JZIJSypqZfXX3L13X9fcDAKJct1sx3OiuAAAAAElFTkSuQmCC)",display:"none",cursor:"pointer"}),this.$buttons.css({padding:5,textAlign:"right",borderTop:"1px solid #ccc",backgroundColor:"#fff"}),this.$buttons.find("button").css({marginLeft:5}),this.$buttons.find("button:first").css({marginLeft:0}),this.$bar.on({mouseenter:function(){a(this).find(".noty_close").stop().fadeTo("normal",1)},mouseleave:function(){a(this).find(".noty_close").stop().fadeTo("normal",0)}}),this.options.layout.name){case"top":this.$bar.css({borderRadius:"0px 0px 5px 5px",borderBottom:"2px solid #eee",borderLeft:"2px solid #eee",borderRight:"2px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"});break;case"topCenter":case"center":case"bottomCenter":case"inline":this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}),this.$message.css({fontSize:"13px",textAlign:"center"});break;case"topLeft":case"topRight":case"bottomLeft":case"bottomRight":case"centerLeft":case"centerRight":this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"}),this.$message.css({fontSize:"13px",textAlign:"left"});break;case"bottom":this.$bar.css({borderRadius:"5px 5px 0px 0px",borderTop:"2px solid #eee",borderLeft:"2px solid #eee",borderRight:"2px solid #eee",boxShadow:"0 -2px 4px rgba(0, 0, 0, 0.1)"});break;default:this.$bar.css({border:"2px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"})}switch(this.options.type){case"alert":case"notification":this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"});break;case"warning":this.$bar.css({backgroundColor:"#FFEAA8",borderColor:"#FFC237",color:"#826200"}),this.$buttons.css({borderTop:"1px solid #FFC237"});break;case"error":this.$bar.css({backgroundColor:"red",borderColor:"darkred",color:"#FFF"}),this.$message.css({fontWeight:"bold"}),this.$buttons.css({borderTop:"1px solid darkred"});break;case"information":this.$bar.css({backgroundColor:"#57B7E2",borderColor:"#0B90C4",color:"#FFF"}),this.$buttons.css({borderTop:"1px solid #0B90C4"});break;case"success":this.$bar.css({backgroundColor:"lightgreen",borderColor:"#50C24E",color:"darkgreen"}),this.$buttons.css({borderTop:"1px solid #50C24E"});break;default:this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"})}},callback:{onShow:function(){a.noty.themes.defaultTheme.helpers.borderFix.apply(this)},onClose:function(){a.noty.themes.defaultTheme.helpers.borderFix.apply(this)}}}}(jQuery);
//     Underscore.js 1.6.0
//     http://underscorejs.org
//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.
(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,h=e.reduce,v=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,w=Object.keys,_=i.bind,j=function(n){return n instanceof j?n:this instanceof j?void(this._wrapped=n):new j(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=j),exports._=j):n._=j,j.VERSION="1.6.0";var A=j.each=j.forEach=function(n,t,e){if(null==n)return n;if(s&&n.forEach===s)n.forEach(t,e);else if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++)if(t.call(e,n[u],u,n)===r)return}else for(var a=j.keys(n),u=0,i=a.length;i>u;u++)if(t.call(e,n[a[u]],a[u],n)===r)return;return n};j.map=j.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e.push(t.call(r,n,u,i))}),e)};var O="Reduce of empty array with no initial value";j.reduce=j.foldl=j.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduce===h)return e&&(t=j.bind(t,e)),u?n.reduce(t,r):n.reduce(t);if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u)throw new TypeError(O);return r},j.reduceRight=j.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduceRight===v)return e&&(t=j.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t);var i=n.length;if(i!==+i){var a=j.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u)throw new TypeError(O);return r},j.find=j.detect=function(n,t,r){var e;return k(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},j.filter=j.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&e.push(n)}),e)},j.reject=function(n,t,r){return j.filter(n,function(n,e,u){return!t.call(r,n,e,u)},r)},j.every=j.all=function(n,t,e){t||(t=j.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var k=j.some=j.any=function(n,t,e){t||(t=j.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};j.contains=j.include=function(n,t){return null==n?!1:y&&n.indexOf===y?n.indexOf(t)!=-1:k(n,function(n){return n===t})},j.invoke=function(n,t){var r=o.call(arguments,2),e=j.isFunction(t);return j.map(n,function(n){return(e?t:n[t]).apply(n,r)})},j.pluck=function(n,t){return j.map(n,j.property(t))},j.where=function(n,t){return j.filter(n,j.matches(t))},j.findWhere=function(n,t){return j.find(n,j.matches(t))},j.max=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);var e=-1/0,u=-1/0;return A(n,function(n,i,a){var o=t?t.call(r,n,i,a):n;o>u&&(e=n,u=o)}),e},j.min=function(n,t,r){if(!t&&j.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);var e=1/0,u=1/0;return A(n,function(n,i,a){var o=t?t.call(r,n,i,a):n;u>o&&(e=n,u=o)}),e},j.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=j.random(r++),e[r-1]=e[t],e[t]=n}),e},j.sample=function(n,t,r){return null==t||r?(n.length!==+n.length&&(n=j.values(n)),n[j.random(n.length-1)]):j.shuffle(n).slice(0,Math.max(0,t))};var E=function(n){return null==n?j.identity:j.isFunction(n)?n:j.property(n)};j.sortBy=function(n,t,r){return t=E(t),j.pluck(j.map(n,function(n,e,u){return{value:n,index:e,criteria:t.call(r,n,e,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||r===void 0)return 1;if(e>r||e===void 0)return-1}return n.index-t.index}),"value")};var F=function(n){return function(t,r,e){var u={};return r=E(r),A(t,function(i,a){var o=r.call(e,i,a,t);n(u,o,i)}),u}};j.groupBy=F(function(n,t,r){j.has(n,t)?n[t].push(r):n[t]=[r]}),j.indexBy=F(function(n,t,r){n[t]=r}),j.countBy=F(function(n,t){j.has(n,t)?n[t]++:n[t]=1}),j.sortedIndex=function(n,t,r,e){r=E(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;r.call(e,n[o])<u?i=o+1:a=o}return i},j.toArray=function(n){return n?j.isArray(n)?o.call(n):n.length===+n.length?j.map(n,j.identity):j.values(n):[]},j.size=function(n){return null==n?0:n.length===+n.length?n.length:j.keys(n).length},j.first=j.head=j.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:0>t?[]:o.call(n,0,t)},j.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},j.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},j.rest=j.tail=j.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},j.compact=function(n){return j.filter(n,j.identity)};var M=function(n,t,r){return t&&j.every(n,j.isArray)?c.apply(r,n):(A(n,function(n){j.isArray(n)||j.isArguments(n)?t?a.apply(r,n):M(n,t,r):r.push(n)}),r)};j.flatten=function(n,t){return M(n,t,[])},j.without=function(n){return j.difference(n,o.call(arguments,1))},j.partition=function(n,t){var r=[],e=[];return A(n,function(n){(t(n)?r:e).push(n)}),[r,e]},j.uniq=j.unique=function(n,t,r,e){j.isFunction(t)&&(e=r,r=t,t=!1);var u=r?j.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:j.contains(a,r))||(a.push(r),i.push(n[e]))}),i},j.union=function(){return j.uniq(j.flatten(arguments,!0))},j.intersection=function(n){var t=o.call(arguments,1);return j.filter(j.uniq(n),function(n){return j.every(t,function(t){return j.contains(t,n)})})},j.difference=function(n){var t=c.apply(e,o.call(arguments,1));return j.filter(n,function(n){return!j.contains(t,n)})},j.zip=function(){for(var n=j.max(j.pluck(arguments,"length").concat(0)),t=new Array(n),r=0;n>r;r++)t[r]=j.pluck(arguments,""+r);return t},j.object=function(n,t){if(null==n)return{};for(var r={},e=0,u=n.length;u>e;e++)t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1];return r},j.indexOf=function(n,t,r){if(null==n)return-1;var e=0,u=n.length;if(r){if("number"!=typeof r)return e=j.sortedIndex(n,t),n[e]===t?e:-1;e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y)return n.indexOf(t,r);for(;u>e;e++)if(n[e]===t)return e;return-1},j.lastIndexOf=function(n,t,r){if(null==n)return-1;var e=null!=r;if(b&&n.lastIndexOf===b)return e?n.lastIndexOf(t,r):n.lastIndexOf(t);for(var u=e?r:n.length;u--;)if(n[u]===t)return u;return-1},j.range=function(n,t,r){arguments.length<=1&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=new Array(e);e>u;)i[u++]=n,n+=r;return i};var R=function(){};j.bind=function(n,t){var r,e;if(_&&n.bind===_)return _.apply(n,o.call(arguments,1));if(!j.isFunction(n))throw new TypeError;return r=o.call(arguments,2),e=function(){if(!(this instanceof e))return n.apply(t,r.concat(o.call(arguments)));R.prototype=n.prototype;var u=new R;R.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},j.partial=function(n){var t=o.call(arguments,1);return function(){for(var r=0,e=t.slice(),u=0,i=e.length;i>u;u++)e[u]===j&&(e[u]=arguments[r++]);for(;r<arguments.length;)e.push(arguments[r++]);return n.apply(this,e)}},j.bindAll=function(n){var t=o.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){n[t]=j.bind(n[t],n)}),n},j.memoize=function(n,t){var r={};return t||(t=j.identity),function(){var e=t.apply(this,arguments);return j.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},j.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},j.defer=function(n){return j.delay.apply(j,[n,1].concat(o.call(arguments,1)))},j.throttle=function(n,t,r){var e,u,i,a=null,o=0;r||(r={});var c=function(){o=r.leading===!1?0:j.now(),a=null,i=n.apply(e,u),e=u=null};return function(){var l=j.now();o||r.leading!==!1||(o=l);var f=t-(l-o);return e=this,u=arguments,0>=f?(clearTimeout(a),a=null,o=l,i=n.apply(e,u),e=u=null):a||r.trailing===!1||(a=setTimeout(c,f)),i}},j.debounce=function(n,t,r){var e,u,i,a,o,c=function(){var l=j.now()-a;t>l?e=setTimeout(c,t-l):(e=null,r||(o=n.apply(i,u),i=u=null))};return function(){i=this,u=arguments,a=j.now();var l=r&&!e;return e||(e=setTimeout(c,t)),l&&(o=n.apply(i,u),i=u=null),o}},j.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},j.wrap=function(n,t){return j.partial(t,n)},j.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--)t=[n[r].apply(this,t)];return t[0]}},j.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},j.keys=function(n){if(!j.isObject(n))return[];if(w)return w(n);var t=[];for(var r in n)j.has(n,r)&&t.push(r);return t},j.values=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=n[t[u]];return e},j.pairs=function(n){for(var t=j.keys(n),r=t.length,e=new Array(r),u=0;r>u;u++)e[u]=[t[u],n[t[u]]];return e},j.invert=function(n){for(var t={},r=j.keys(n),e=0,u=r.length;u>e;e++)t[n[r[e]]]=r[e];return t},j.functions=j.methods=function(n){var t=[];for(var r in n)j.isFunction(n[r])&&t.push(r);return t.sort()},j.extend=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]=t[r]}),n},j.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},j.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n)j.contains(r,u)||(t[u]=n[u]);return t},j.defaults=function(n){return A(o.call(arguments,1),function(t){if(t)for(var r in t)n[r]===void 0&&(n[r]=t[r])}),n},j.clone=function(n){return j.isObject(n)?j.isArray(n)?n.slice():j.extend({},n):n},j.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof j&&(n=n._wrapped),t instanceof j&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t))return!1;switch(u){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var i=r.length;i--;)if(r[i]==n)return e[i]==t;var a=n.constructor,o=t.constructor;if(a!==o&&!(j.isFunction(a)&&a instanceof a&&j.isFunction(o)&&o instanceof o)&&"constructor"in n&&"constructor"in t)return!1;r.push(n),e.push(t);var c=0,f=!0;if("[object Array]"==u){if(c=n.length,f=c==t.length)for(;c--&&(f=S(n[c],t[c],r,e)););}else{for(var s in n)if(j.has(n,s)&&(c++,!(f=j.has(t,s)&&S(n[s],t[s],r,e))))break;if(f){for(s in t)if(j.has(t,s)&&!c--)break;f=!c}}return r.pop(),e.pop(),f};j.isEqual=function(n,t){return S(n,t,[],[])},j.isEmpty=function(n){if(null==n)return!0;if(j.isArray(n)||j.isString(n))return 0===n.length;for(var t in n)if(j.has(n,t))return!1;return!0},j.isElement=function(n){return!(!n||1!==n.nodeType)},j.isArray=x||function(n){return"[object Array]"==l.call(n)},j.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){j["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),j.isArguments(arguments)||(j.isArguments=function(n){return!(!n||!j.has(n,"callee"))}),"function"!=typeof/./&&(j.isFunction=function(n){return"function"==typeof n}),j.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},j.isNaN=function(n){return j.isNumber(n)&&n!=+n},j.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},j.isNull=function(n){return null===n},j.isUndefined=function(n){return n===void 0},j.has=function(n,t){return f.call(n,t)},j.noConflict=function(){return n._=t,this},j.identity=function(n){return n},j.constant=function(n){return function(){return n}},j.property=function(n){return function(t){return t[n]}},j.matches=function(n){return function(t){if(t===n)return!0;for(var r in n)if(n[r]!==t[r])return!1;return!0}},j.times=function(n,t,r){for(var e=Array(Math.max(0,n)),u=0;n>u;u++)e[u]=t.call(r,u);return e},j.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},j.now=Date.now||function(){return(new Date).getTime()};var T={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};T.unescape=j.invert(T.escape);var I={escape:new RegExp("["+j.keys(T.escape).join("")+"]","g"),unescape:new RegExp("("+j.keys(T.unescape).join("|")+")","g")};j.each(["escape","unescape"],function(n){j[n]=function(t){return null==t?"":(""+t).replace(I[n],function(t){return T[n][t]})}}),j.result=function(n,t){if(null==n)return void 0;var r=n[t];return j.isFunction(r)?r.call(n):r},j.mixin=function(n){A(j.functions(n),function(t){var r=j[t]=n[t];j.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(j,n))}})};var N=0;j.uniqueId=function(n){var t=++N+"";return n?n+t:t},j.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;j.template=function(n,t,r){var e;r=j.defaults({},r,j.templateSettings);var u=new RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),i=0,a="__p+='";n.replace(u,function(t,r,e,u,o){return a+=n.slice(i,o).replace(D,function(n){return"\\"+B[n]}),r&&(a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(a+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),u&&(a+="';\n"+u+"\n__p+='"),i=o+t.length,t}),a+="';\n",r.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(r.variable||"obj","_",a)}catch(o){throw o.source=a,o}if(t)return e(t,j);var c=function(n){return e.call(this,n,j)};return c.source="function("+(r.variable||"obj")+"){\n"+a+"}",c},j.chain=function(n){return j(n).chain()};var z=function(n){return this._chain?j(n).chain():n};j.mixin(j),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];j.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];j.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),j.extend(j.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return j})}).call(this);
var triggerPykHelp = function () {
  $('body').chardinJs('start');
}
;
/*! ====================================================== *
Copyright (c) 2015, Pykih Software LLP
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ====================================================== */

var PykCharts={};PykCharts.assets="/pykih-charts/assets/",PykCharts.export_menu_status=0,PykCharts["boolean"]=function(t){var e=["0","f","false","n","no","",0,"0.00","0.0",0,0],a=[void 0,null,NaN];return-1!==a.indexOf(t)?!1:(value=t.toLocaleString(),value=value.toLowerCase(),e.indexOf(value)>-1?!1:!0)},PykCharts.getEvent=function(){try{return d3.event||event}catch(t){return event}},PykCharts.Configuration=function(t){var e=this,a=(t.selector,{liveData:function(e){var a=t.real_time_charts_refresh_frequency;return PykCharts["boolean"](a)&&(clearInterval(t.interval),t.interval=setInterval(e.refresh,1e3*a)),this},emptyDiv:function(t){return d3.select(t).append("div").style("clear","both"),this},storeInitialDivHeight:function(){var e=parseFloat(d3.select(t.selector).style("height"));return e?t.original_div_height=parseFloat(d3.select(t.selector).style("height")):t.original_div_height="auto",this},appendUnits:function(e){e=PykCharts.numberFormat(e);var a,r,n;return r=t.units_prefix,n=t.units_suffix,r?(a=r+" "+e,n&&(a+=" "+n)):a=n?e+" "+n:e,a},title:function(a){if(PykCharts["boolean"](t.title_text)&&t.title_size){var r=t.chart_width;a&&(r=a);var n=PykCharts["boolean"](t.export_enable)?.9*r:r;e.titleDiv=d3.select(t.selector).append("div").attr("id","title").style({width:n+"px","text-align":"left","float":"left"}).html("<span style='pointer-events:none;font-size:"+t.title_size+"vw;color:"+t.title_color+";font-weight:"+t.title_weight+";padding-left:1px;font-family:"+t.title_family+"'>"+t.title_text+"</span>")}return this},subtitle:function(a){if(PykCharts["boolean"](t.subtitle_text)&&t.subtitle_size){var r=t.chart_width;a&&(r=a),e.subtitleDiv=d3.select(t.selector).append("div").attr("id","sub-title").style({width:r+"px","text-align":"left"}).html("<span style='pointer-events:none;font-size:"+t.subtitle_size+"vw;color:"+t.subtitle_color+";font-weight:"+t.subtitle_weight+";padding-left:1px;font-family:"+t.subtitle_family+"'>"+t.subtitle_text+"</span>")}return this},createFooter:function(e){var a=t.chart_width;return e&&(a=e),d3.select(t.selector).append("table").attr({id:"footer",width:a+"px"}).style("background",t.bg),this},lastUpdatedAt:function(e){if(PykCharts["boolean"](t.real_time_charts_refresh_frequency)&&PykCharts["boolean"](t.real_time_charts_last_updated_at_enable)){var a=new Date,r=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();"liveData"===e?document.querySelectorAll(t.selector+" #lastUpdatedAt").innerHTML="<span style='pointer-events:none;'>Last Updated At: </span><span style='pointer-events:none;'>"+r+"</span>":d3.select(t.selector+" #footer").append("tr").attr("class","PykCharts-credits").html("<td colspan=2 style='text-align:right' id='lastUpdatedAt'><span style='pointer-events:none;'>Last Updated At: </span><span style='pointer-events:none;'>"+r+"</span></tr>")}return this},checkChangeInData:function(a,r){var n=Object.keys(r[0]),o=Object.keys(a[0]),i=!1,l=a.length,s=n.length;if(n.length===o.length&&r.length===a.length){for(var _=0;l>_;_++)for(var c=0;s>c;c++)if("object"!=typeof a[_][o[c]]&&"object"!=typeof r[_][n[c]]){if(a[_][o[c]]!==r[_][n[c]]||n[c]!==o[c]){i=!0;break}}else if(!t.k.__proto__._isEqual(a[_][o[c]],r[_][n[c]])||n[c]!==o[c]){i=!0;break}}else i=!0;return e.compare_data=a,[e.compare_data,i]},credits:function(){if(PykCharts["boolean"](t.credit_my_site_name)||PykCharts["boolean"](t.credit_my_site_url)){var e=!0;""===t.credit_my_site_name&&(t.credit_my_site_name=t.credit_my_site_url),""===t.credit_my_site_url&&(e=!1),d3.select(t.selector+" #footer").append("tr").attr({"class":"PykCharts-credits",id:"credit-datasource"}).append("td").style("text-align","left").html("<span style='pointer-events:none;'>Credits: </span><a href='"+t.credit_my_site_url+"' target='_blank' onclick='return "+e+"'>"+t.credit_my_site_name+"</a>")}return this},dataSource:function(){if(PykCharts["boolean"](t.data_source_name)||PykCharts["boolean"](t.data_source_url)){var e=!0;""===t.data_source_name&&(t.data_source_name=t.data_source_url),""===t.data_source_url&&(e=!1);var a="<span style='pointer-events:none;'>Source: </span><a href='"+t.data_source_url+"' target='_blank' onclick='return "+e+"'>"+t.data_source_name+"</a></tr>";d3.selectAll(t.selector+" #footer").length?d3.select(t.selector+" table #credit-datasource").style({background:t.bg,"text-align":"right"}).append("td").html(a):d3.select(t.selector).append("table").attr({id:"footer","class":"PykCharts-credits",width:t.chart_width+"px"}).style({background:t.bg,"text-align":"right"}).append("tr").append("td").html(a)}return this},makeMainDiv:function(e,a){var r=d3.select(e).append("div").attr({id:"chart-container-"+a,"class":"main-div"}).style("width","100%");return PykCharts["boolean"](t.panels_enable)&&r.style({"float":"left",width:"auto"}),this},tooltip:function(e,a,r,n){if((PykCharts["boolean"](t.tooltip_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format||PykCharts["boolean"](t.annotation_enable))&&"default"===t.mode){var o;if(void 0!==a){var i=t.selector.substr(1,t.selector.length);o="tooltip-svg-container-"+r+"-pyk-tooltip"+i}else o="pyk-tooltip";PykCharts.Configuration.tooltipp=d3.select("body").append("div").attr({id:o,"class":"pyk-tooltip"})}else PykCharts["boolean"](t.tooltip_enable)&&(PykCharts.Configuration.tooltipp=d3.select("body").append("div").attr({id:"pyk-tooltip","class":"pyk-tooltip"}));return this},dateConversion:function(t){t=new Date(t);var e=t.getTimezoneOffset();return t=new Date(t.getTime()+60*e*1e3)},loading:function(){d3.select(t.selector).style("height",t.chart_height);var e="image"===t.loading_type?"<img src="+t.loading_source+">":t.loading_source;d3.select(t.selector).html("<div id='chart-loader'>"+e+"</div>");var a=parseFloat(d3.select(t.selector).style("height"));return d3.select(t.selector+" #chart-loader").style({visibility:"visible","padding-left":t.chart_width/2+"px","padding-top":a/2+"px"}),this},remove_loading_bar:function(e){var a=document.querySelector(t.selector+" #chart-loader");return a&&a.parentNode.removeChild(a),document.getElementById(e).style.height=t.original_div_height,this},dataFromPykQuery:function(e){PykCharts["boolean"](t.interactive_enable)&&(t.data=e)},totalColors:function(t){var a=parseInt(t,10);return a>2&&10>a?(e.total_colors=a,this):(e.total_colors=9,this)},colorType:function(t){return"color"===t&&(e.legends="no"),this},resize:function(e,a){var r=t.chart_width;PykCharts["boolean"](t.panels_enable)&&a&&(r=a),console.log(d3.select(t.selector).style("width"),document.querySelector(t.selector).clientWidth);var n,o=r/t.chart_height,i=isNaN(parseFloat(d3.select(t.selector).style("width")))?0:parseFloat(d3.select(t.selector).style("width")),l=d3.selectAll(t.selector+" #footer"),s=d3.selectAll(t.selector+" .main-div");if((i>r||0===i)&&(i=r),t.constructor===PykCharts.multiD.multiSeriesLine&&(i=window.innerWidth-.15*window.innerWidth,i>r&&(i=r)),PykCharts["boolean"](e)&&(e.attr({width:i,height:i/o}),d3.selectAll(t.selector+" .main-div").style("width","100%")),PykCharts["boolean"](t.title_text)&&PykCharts["boolean"](t.export_enable)&&(n=.9*i,d3.select(t.selector+" #title").style("width",n+"px")),PykCharts["boolean"](t.subtitle_text)&&(n=.9*i,d3.select(t.selector+" #sub-title").style("width",n+"px")),PykCharts["boolean"](t.export_enable)&&(div_size=i,div_float="none",div_left=i-16,PykCharts["boolean"](t.title_text)&&t.title_size&&"default"===t.mode&&(div_size=.1*i,div_float="left",div_left=0),d3.select(t.selector+" #export").style({width:div_size+"px",left:div_left+"px","float":div_float}),d3.select(t.selector+" .dropdown-multipleConatiner-export").style("left",i-80+"px")),l&&l.attr("width",i),s&&!PykCharts["boolean"](t.panels_enable)){var _=document.querySelector(t.selector+" .main-div");_&&(_.style.width=i)}},__proto__:{_downloadDataURI:function(t){function e(t){return"object"!=typeof t||t.nodeType||null!=t&&t===t.window?!1:t.constructor&&!t.constructor.prototype.hasOwnProperty("isPrototypeOf")?!1:!0}if(t){e(t)||(t={data:t}),t.filename||(t.filename="download."+t.data.split(",")[0].split(";")[0].substring(5).split("/")[1]),t.url||(t.url="http://download-data-uri.appspot.com/");var a=(d3.select("body").append("form").attr("id","export-form").attr("method","post").attr("action",t.url).style("display","none").html("<input type='hidden' name='filename' value='"+t.filename+"'/><input type='hidden' name='data' value='"+t.data+"'/>"),document.getElementById("export-form"));a.submit(),a.parentNode.removeChild(a)}},_xmlToJson:function(t,e){var a,r,n,o,i,l,s,_,c,d=[],u=t.firstChild.childElementCount;for(0==e?(l=e,c=u,_=1):1==e&&(l=e,c=2*u+1,_=2);c>l;l+=_){for(a=t.firstChild.childNodes[l],i={},s=0,element_len=a.childElementCount;s<element_len;s++)r=a.children.item(s),n=r.nodeName,o=r.textContent,i[n]=o;d.push(i)}return d},_domainBandwidth:function(e,a,r){if(addFactor=0,"time"===r){var n=e[0],o=e[1],i=[];switch(padding=.1*(o-n),a){case 0:i[0]=n-(padding+addFactor);break;case 1:i[1]=o+(padding+addFactor);break;case 2:i[0]=n-(padding+addFactor),i[1]=o+(padding+addFactor)}return[t.k.dateConversion(i[0]),t.k.dateConversion(i[1])]}switch(padding=.1*(e[1]-e[0]),a){case 0:e[0]-=padding+addFactor;break;case 1:e[1]=parseFloat(e[1],10)+(padding+addFactor);break;case 2:e[0]-=padding+addFactor,e[1]=parseFloat(e[1],10)+(padding+addFactor)}return e},_radiusCalculation:function(e,a){var r;return r="percentageBar"===a?t.chart_height:"spiderweb"===a?d3.min([t.chart_width-t.legendsGroup_width,t.chart_height-t.legendsGroup_height-20]):void 0!==a?t.chart_width:d3.min([t.chart_width,t.chart_height]),r*e/200},_getHighestParentsAttribute:function(t,e){function a(t){return"body"===t.tagName.toLowerCase()?void(r=null):(r=t.style[e],r||(r=d3.select(t).style(e)),void(r||a(t.parentNode)))}var r,n=document.querySelector(t);return a(n),r},_groupBy:function(t,e){for(var a,r,n=[],o={oned:["name"],line:["x","name"],area:["x","name"],bar:["y","group"],column:["x","group"],scatterplot:["x","y","name","group"],pulse:["x","y","name","group"],spiderweb:["x","group"],waterfall:["x","y"],simple2x2:["group"]},i={oned:{dimension:"name",fact:"weight"},line:{dimension:"x",fact:"y",name:"name"},area:{dimension:"x",fact:"y",name:"name"},bar:{dimension:"y",fact:"x",name:"group"},column:{dimension:"x",fact:"y",name:"group"},scatterplot:{dimension:"x",fact:"y",weight:"weight",name:"name",group:"group"},pulse:{dimension:"y",fact:"x",weight:"weight",name:"name",group:"group"},spiderweb:{dimension:"x",fact:"y",name:"name",weight:"weight"},waterfall:{dimension:"y",fact:"x",name:"group"},simple2x2:{dimension:"group",fact:"weight"}},l=o[t],s=[],_=e.length,a=0;_>a;a+=1){var r=e[a];if(0==s.length)s.push([r]);else{for(var c=!1,d=s.length,u=0;d>u;u+=1){var h=s[u],p=!0,g=h[0];l.forEach(function(t){g[t]!==r[t]&&(p=!1)}),p&&(c=h)}c?c.push(r):s.push([r])}}for(a in s)if(s[a].constructor===Array){r={};var m=s[a],f=i[t],x=[],y={},v={};r[f.dimension]=m[0][f.dimension],f.name&&(r[f.name]=m[0][f.name]),f.weight?(r[f.weight]=d3.sum(m,function(e){return e[i[t].weight]}),"spiderweb"===t?r[f.fact]=d3.sum(m,function(e){return e[i[t].fact]}):r[f.fact]=m[0][f.fact]):r[f.fact]=d3.sum(m,function(e){return e[i[t].fact]}),f.group&&(r[f.group]=m[0][f.group]);for(var k in i[t])x.push(i[t][k]);for(var k in m[0]){for(var w=0,a=0;a<x.length;a++)if(k===x[a]){w=1;break}0===w&&(y[k]=m[0][k])}for(var k in r)v[k]=r[k];for(var k in y)v[k]=y[k];n.push(v)}return n},_sortData:function(t,e,a,r,n){if(PykCharts["boolean"](r.data_sort_enable)||n){if(PykCharts["boolean"](r.data_sort_enable))switch(console.log("else if"),r.data_sort_type){case"numerically":t.sort(function(t,a){return"descending"===r.data_sort_order?a[e]-t[e]:t[e]-a[e]});break;case"alphabetically":t.sort(function(t,n){return t[e]<n[e]?"descending"===r.data_sort_order?1:-1:t[e]>n[e]?"descending"===r.data_sort_order?-1:1:t[a]<n[a]?"descending"===r.data_sort_order?1:-1:t[a]>n[a]?"descending"===r.data_sort_order?-1:1:0});break;case"date":t.sort(function(t,n){return new Date(t[e])<new Date(n[e])?"descending"===r.data_sort_order?1:-1:new Date(t[e])>new Date(n[e])?"descending"===r.data_sort_order?-1:1:t[a]<n[a]?"descending"===r.data_sort_order?1:-1:t[a]>n[a]?"descending"===r.data_sort_order?-1:1:0})}}else console.log("if"),console.log(t),t.sort(function(e,r){return console.log(t,e,r),e[a]>r[a]?(console.log("if"),1):e[a]<r[a]?(console.log("else if"),-1):void 0});return t},_unique:function(t,e){for(var a={},r=[],n=0,o=t.length;o>n;n++)e&&(t[n]=t[n][e]),a[t[n]]||(a[t[n]]=!0,r.push(t[n]));return r},_ready:function(t){function e(){document.removeEventListener("DOMContentLoaded",e,!1),window.removeEventListener("load",e,!1)}return document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&document.detachEvent("onreadystatechange",arguments.callee)}),this},_colourBrightness:function(t,e){var a,r,n,o,i=1,l=t;if(l.match(/^rgba/)?(l=l.match(/rgba\(([^)]+)\)/)[1],l=l.split(/ *, */).map(Number),a=l[0],r=l[1],n=l[2],i=l[3]):l.match(/^rgb/)?(l=l.match(/rgb\(([^)]+)\)/)[1],l=l.split(/ *, */).map(Number),a=l[0],r=l[1],n=l[2]):"#"==l[0]&&7==l.length?(a=parseInt(l.slice(1,3),16),r=parseInt(l.slice(3,5),16),n=parseInt(l.slice(5,7),16)):"#"==l[0]&&4==l.length&&(a=parseInt(l[1]+l[1],16),r=parseInt(l[2]+l[2],16),n=parseInt(l[3]+l[3],16)),o=(299*a+587*r+114*n)/1e3,125>o&&i>.5){if(!e)return"dark";d3.selectAll(e).classed({light:!1,dark:!0})}else if(125>o&&.5>=i){if(!e)return"light";d3.selectAll(e).classed({light:!0,dark:!1})}else{if(!e)return"light";d3.selectAll(e).classed({light:!0,dark:!1})}},_isNumber:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},_where:function(t,e){var a=t.length,r=[];if("object"==typeof t)for(var n in t){var o=0,i=0;for(var l in e)t[n].hasOwnProperty(l)&&t[n][l]===e[l]?o+=1:o=0,i+=1;o===i&&r.push(t[n])}else for(var n=0;a>n;n++){var o=0,i=0;for(var l in e)t[n].hasOwnProperty(l)&&t[n][l]===e[l]?o+=1:o=0,i+=1;o===i&&r.push(t[n])}return r},_isEqual:function(t,e){var a=function(t,e,n,o){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;var i=toString.call(t);if(i!==toString.call(e))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}if("object"!=typeof t||"object"!=typeof e)return!1;for(var l=n.length;l--;)if(n[l]===t)return o[l]===e;var s=t.constructor,_=e.constructor;if(s!==_&&"constructor"in t&&"constructor"in e&&!(r(s)&&s instanceof s&&r(_)&&_ instanceof _))return!1;n.push(t),o.push(e);var c,d;if("[object Array]"===i){if(c=t.length,d=c===e.length)for(;c--&&(d=a(t[c],e[c],n,o)););}else{var u,h=Object.getOwnPropertyNames(t);if(c=h.length,d=Object.getOwnPropertyNames(e).length===c)for(;c--&&(u=h[c],d=hasOwnProperty.call(e,u)&&a(t[u],e[u],n,o)););}return n.pop(),o.pop(),d},r=function(t){return"function"==typeof t||!1};return a(t,e,[],[])},_offset:function(t){var e,a,r="undefined",n={top:0,left:0},o=t&&t.ownerDocument;return o?(e=o.documentElement,typeof t.getBoundingClientRect!==r&&(n=t.getBoundingClientRect()),a=null!=o&&o===o.window?o:9===o.nodeType&&o.defaultView,{top:n.top+a.pageYOffset-e.clientTop,left:n.left+a.pageXOffset-e.clientLeft}):void 0}},backgroundColor:function(t){function e(n){return r=n,a=d3.select(n).style("background-color"),"transparent"!==a&&"rgba(0, 0, 0, 0)"!==a?t.k.__proto__._colourBrightness(a,d3.selectAll(n)[0]):void 0!==d3.select(n)[0][0].parentNode.tagName&&"body"!==d3.select(n)[0][0].parentNode.tagName.toLowerCase()?e(d3.select(n)[0][0].parentNode):void t.k.__proto__._colourBrightness("rgb(255,255,255)",d3.select(n)[0])}d3.select(t.selector).style({"background-color":t.background_color,position:"relative"});var a,r;return e(t.selector),d3.select(r)[0][0].classList.contains("light")?t.img=PykCharts.assets+"img/download.png":t.img=PykCharts.assets+"img/download-light.png",this},dataSourceFormatIdentification:function(e,a,r){if("object"==typeof e)a.data=e,a[r](a.data);else{var n=e.lastIndexOf("."),o=e.length-n,i=Math.floor(100*Math.random()+1);if(e.constructor==Array)a.data=e,a[r](a.data);else{var l=e.substr(n+1,o);if(-1!=e.indexOf("<root>")){var s,_;window.DOMParser?(parser=new DOMParser,s=parser.parseFromString(e,"text/xml")):(s=new ActiveXObject("Microsoft.XMLDOM"),s.async=!1,s.loadXML(e)),_=t.k.__proto__._xmlToJson(s,0),a[r](_)}else-1!=e.indexOf("{")?(a.data=JSON.parse(e),a[r](a.data)):-1!=e.indexOf(",")?(a.data=d3.csv.parse(e),a[r](a.data)):"json"===l?d3.json(e+"?"+i,a[r]):"csv"===l?d3.csv(e+"?"+i,a[r]):"xml"===l&&d3.xml(e+"?"+i,function(e){var n;n=t.k.__proto__._xmlToJson(e,1),a[r](n)})}}},"export":function(e,a,r,n,o,i){if(PykCharts["boolean"](t.export_enable)){var i=t.chart_width;PykCharts["boolean"](n)&&i&&(i=i);var l="export",s=i,_="none",c=i-16;if(d3.select(t.selector).append("div").style("left",i-80+"px").attr("class","dropdown-multipleConatiner-export"),PykCharts["boolean"](n))for(var d=o.length,u=0;d>u;u++)d3.select(t.selector+" .dropdown-multipleConatiner-export").append("span").attr("id",r+u).on("mouseover",function(){d3.select(this).style("background-color","#E0E0E1")}).on("mouseout",function(){d3.select(this).style("background-color","#fff")}).style({"margin-bottom":"3px",cursor:"pointer"}).html("Panel "+(u+1)+"<br>");else d3.select(t.selector+" .dropdown-multipleConatiner-export").append("span").attr("id","span").on("mouseover",function(){d3.select(this).style("background-color","#E0E0E1")}).on("mouseout",function(){d3.select(this).style("background-color","#fff")}).style({"margin-bottom":"3px",cursor:"pointer"}).html("Export as SVG<br>");PykCharts["boolean"](t.title_text)&&t.title_size&&"default"===t.mode&&(s=.1*i,_="left",c=0);var h=d3.select(e.selector).append("div").attr("id",l).style({width:s+"px",left:c+"px","float":_,"text-align":"right"});setTimeout(function(){h.html("<img title='Export to SVG' src='"+t.img+"' style='left:"+c+"px;margin-bottom:3px;cursor:pointer;'/>")},1e3*t.transition_duration)}return this},exportSVG:function(e,a,r,n,o,i,l){if(PykCharts["boolean"](t.export_enable)){i||(i=0),l||(l=0);var s="export",_=r+"canvas",c=document.createElement("canvas");c.setAttribute("id",_);var d=document.getElementById(_);paper.setup(d);var u=new paper.Project;u._view._viewSize.width=e.chart_width+i,u._view._viewSize.height=e.chart_height+l;var h=r+".svg";if(d3.select(e.selector+" #"+s).on("click",function(){PykCharts.export_menu_status=1,d3.select(t.selector+" .dropdown-multipleConatiner-export").style("visibility","visible")}),PykCharts["boolean"](n))for(var p=o.length,g=0;p>g;g++)d3.selectAll(e.selector+" #"+r+g).on("click",function(){d3.select(t.selector+" .dropdown-multipleConatiner-export").style("visibility","hidden");var n=this.id.substring(this.id.length-1,this.id.length);e.k.processSVG(document.querySelector(t.selector+" #"+a+n),r),u.importSVG(document.querySelector(t.selector+" #"+a+n));var o=u.exportSVG({asString:!0});t.k.__proto__._downloadDataURI({data:"data:image/svg+xml;base64,"+btoa(o),filename:h}),u.clear()});else d3.selectAll(e.selector+" #span").on("click",function(){d3.select(t.selector+" .dropdown-multipleConatiner-export").style("visibility","hidden"),e.k.processSVG(document.querySelector(t.selector+" "+a),r),u.importSVG(document.querySelector(t.selector+" "+a));var n=u.exportSVG({asString:!0});t.k.__proto__._downloadDataURI({data:"data:image/svg+xml;base64,"+btoa(n),filename:h}),u.clear()})}return this},shadeColorConversion:function(e,a){var r,n,o=[],l=150/a;e=d3.rgb(e),n="rgb("+e.r+","+e.g+","+e.b+")",r=t.k.__proto__._colourBrightness(n),"light"===r?inc=-1:inc=1;Math.sqrt(e.r*e.r+e.g*e.g)+Math.sqrt(e.r*e.r+e.b*e.b)+Math.sqrt(e.g*e.g+e.b*e.b);for(i=0;Math.abs(i)<a;i+=inc){var s={r:parseInt(e.r+i*l,10),g:parseInt(e.g+i*l,10),b:parseInt(e.b+i*l,10)},_="rgb("+s.r+","+s.g+","+s.b+")";o.push(_)}return-1===inc&&o.reverse(),o},processSVG:function(t,e){for(var a=t.querySelectorAll("text"),r=a.length,n=0;r>n;n++)if(a[n].hasAttribute("dy")){var o=a[n].getAttribute("dy"),i=o.length;if("em"==o.substring(i-2,i)){var l,s;a[n].hasAttribute("font-size")?(l=a[n].getAttribute("font-size"),s=parseFloat(l)*parseFloat(o)):s=12*parseFloat(o),a[n].setAttribute("dy",s)}}return this},errorHandling:function(e,a,r){console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+t.selector+'.(Invalid value for attribute "'+e+'")  Visit https://github.com/pykih/PykCharts.js/wiki/Errors#error_'+a)},warningHandling:function(e,a,r){console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+t.selector+'.(Invalid value for attribute "'+e+'")  Visit https://github.com/pykih/PykCharts.js/wiki/Warnings#warning_'+a)},validator:function(){var e={validatingSelector:function(e){"#"===e.charAt(0)&&(e=e.substring(1,e.length));try{if(!document.getElementById(e))throw t.stop=!0,"selector"}catch(a){t.k.errorHandling(a,"1")}return this},validatingDataType:function(e,a,r,n){try{if(!t.k.__proto__._isNumber(e))throw n?t[n]=r:t[a]=r,a;t[a]=parseFloat(e)}catch(o){t.k.warningHandling(o,"1")}return this},validatingChartMode:function(e,a,r){try{if("default"!==e&&"infographics"!==e)throw t[a]=r,"mode"}catch(n){t.k.warningHandling(n,"2")}return this},validatingAxisDataFormat:function(e,a){if(e)try{if("number"!==e&&"string"!==e&&"time"!==e)throw t.stop=!0,a}catch(r){t.k.errorHandling(r,"9")}return this},validatingColorMode:function(e,a,r,n){if(e)try{if("oneDimensionalCharts"===n){if("color"!==e&&"shade"!==e)throw t[a]=r,"color_mode"}else if("color"!==e&&"saturation"!==e)throw t[a]=r,"color_mode"}catch(o){t.k.warningHandling(o,"3")}return this},validatingYAxisPointerPosition:function(e,a,r){try{if("left"!==e&&"right"!==e)throw t[a]=r,a}catch(n){t.k.warningHandling(n,"7")}return this},validatingXAxisPointerPosition:function(e,a,r){try{if("top"!==e&&"bottom"!==e)throw t[a]=r,a}catch(n){t.k.warningHandling(n,"7")}return this},validatingBorderBetweenChartElementsStyle:function(e,a){try{if("1,3"!==e&&"5,5"!==e&&"0"!==e)throw a}catch(r){t.k.errorHandling(r,"#7")}return this},validatingLegendsPosition:function(e,a,r){try{if("horizontal"!==e&&"vertical"!==e)throw t[a]=r,a}catch(n){t.k.warningHandling(n,"13")}return this},isArray:function(e,a){try{if(e.constructor!==Array)throw a}catch(r){t.stop=!0,t.k.errorHandling(r,"4")}return this},validatingTimeScaleDataType:function(e,a){if(e)try{if("date"!==e&&"year"!==e&&"month"!==e&&"hours"!==e&&"minutes"!==e)throw t.stop=!0,a}catch(r){t.k.errorHandling(r,"5")}return this},validatingTooltipMode:function(e,a,r){if(e)try{if("fixed"!==e&&"moving"!==e)throw t[a]=r,a}catch(n){t.k.warningHandling(n,"14")}return this},validatingFontWeight:function(e,a,r,n){try{if("bold"!==e&&"normal"!==e)throw n?t[n]=r:t[a]=r,a}catch(o){t.k.warningHandling(o,"5")}return this},validatingColor:function(e,a,r,n){if(e)try{var o;if("string"!=typeof e)throw a;if("#"!=e.charAt(0)&&"rgb"!=e.substring(0,3).toLowerCase()&&"transparent"!=e.toLowerCase()){if(o=$c.name2hex(e),"Invalid Color Name"===o)throw a}else if("#"===e.charAt(0)&&(o=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e),!o))throw a}catch(i){n?t[n]=r:t[a]=r,t.k.warningHandling(i,"4")}return this},validatingDataMode:function(e,a,r,n){try{if("absolute"!==e&&"percentage"!==e)throw t[a]=r,a}catch(o){t.k.warningHandling(o,"16")}return this},validatingLegendsMode:function(e,a,r,n){try{if("default"!==e&&"interactive"!==e)throw t[a]=r,a}catch(o){t.k.warningHandling(o,"17")}return this},validatingJSON:function(e){if(!e)try{throw t.stop=!0,"Data is not in the valid JSON format"}catch(a){console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+t.selector+'.("'+a+'")  Visit www.pykcharts.com/errors#error_2')}return t.stop?!1:!0}};return e}});return a};var configuration=PykCharts.Configuration;configuration.mouseEvent=function(t){var e=this;e.tooltip=configuration.tooltipp;var a={tooltipPosition:function(a){return PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.annotation_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format?(e.tooltip.style({display:"block",top:PykCharts.getEvent().pageY-20+"px",left:PykCharts.getEvent().pageX+30+"px"}),e.tooltip):void 0},tooltipTextShow:function(a,r,n,o,i){var l=t.selector.substr(1,t.selector.length);return PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.annotation_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format?("yes"===r&&"multilineChart"===n?d3.selectAll("#tooltip-svg-container-"+o+"-pyk-tooltip"+l).html(a):e.tooltip.html(a),this):void 0},tooltipHide:function(a,r,n,o){return PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.annotation_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format?"yes"===r&&"multilineChart"===n?d3.selectAll(".pyk-tooltip").style("display","none"):e.tooltip.style("display","none"):void 0},axisHighlightShow:function(e,a,r,n){var o,i,l,s,_,c;if(PykCharts["boolean"](t.axis_onhover_highlight_enable))if(a===t.selector+" .y.axis"&&void 0==n){s=a+" .tick text",l=t.axis_y_pointer_color,_=d3.selectAll(s)[0].length,c=e.length,d3.selectAll(s).style("fill","#bbb").style("font-weight","normal");for(var d=0;_>d;d++)for(var u=0;c>u;u++)d3.selectAll(s)[0][d].__data__===e[u]&&d3.select(d3.selectAll(s)[0][d]).style("fill",l).style("font-weight","bold")}else{a===t.selector+" .x.axis"?(s=a+" .tick text",l=t.axis_x_pointer_color):a===t.selector+" .axis-text"&&"column"===n?(s=a,l=t.axis_x_pointer_color):a===t.selector+" .axis-text"&&"bar"===n?(s=a,l=t.axis_y_pointer_color):a===t.selector+" .y.axis"&&"waterfall"==n?(s=a+" .tick text",l=t.axis_y_pointer_color):a===t.selector+" .y.axis"&&"bar"===n&&(s=a+" .tick text",l=t.axis_x_pointer_color),void 0!==i&&d3.select(d3.selectAll(s)[0][i]).style({fill:l,"font-weight":"normal"}),_=d3.selectAll(s)[0].length;var h=r.length;if("number"===t.axis_x_data_format)for(var o=0;_>o&&d3.selectAll(s)[0][o].__data__!=e;o++);else for(o=0;h>o&&r[o]!==e;o++);i=o,d3.selectAll(s).style("fill","#bbb"),d3.select(d3.selectAll(s)[0][o]).style({fill:l,"font-weight":"bold"})}return this},axisHighlightHide:function(e,a){var r,n,o;return PykCharts["boolean"](t.axis_onhover_highlight_enable)&&(e===t.selector+" .y.axis"?(n=e+" .tick text",r=t.axis_y_pointer_color,o=t.axis_y_pointer_weight):e===t.selector+" .x.axis"?(n=e+" .tick text",r=t.axis_x_pointer_color,o=t.axis_x_pointer_weight):e===t.selector+" .axis-text"&&"column"===a?(n=e,r=t.axis_x_pointer_color,o=t.axis_x_pointer_weight):e===t.selector+" .axis-text"&&"bar"===a&&(n=e,r=t.axis_y_pointer_color,o=t.axis_y_pointer_weight),d3.selectAll(n).style({fill:r,"font-weight":o})),this},highlight:function(t,e,a){var r=d3.select(e);return d3.selectAll(t).attr("fill-opacity",function(t,e){return t.children&&a?0:.5}),r.attr("fill-opacity",1),this},highlightHide:function(t){return d3.selectAll(t).attr("fill-opacity",function(t,e){return d3.select(this).attr("data-fill-opacity")}),this},highlightGroup:function(t,e,a){var r=d3.select(e),n=d3.selectAll(t);return n.selectAll(a).attr("fill-opacity",.5),r.selectAll(a).attr("fill-opacity",1),this},highlightGroupHide:function(t,e){return d3.selectAll(t+" "+e).attr("fill-opacity",function(t,e){return d3.select(this).attr("data-fill-opacity")}),this}};return a},configuration.fillChart=function(t,e,a){var r={selectColor:function(a){return e=new PykCharts.Configuration.Theme({}),"color"===t.color_mode?a.name.toLowerCase()===t.highlight.toLowerCase()?t.highlight_color:t.chart_color.length&&t.chart_color[0]?t.chart_color[0]:e.stylesheet.chart_color:a.color},colorChart:function(a){return a.name===t.highlight?e.stylesheet.highlight_color:e.stylesheet.chart_color},colorPieW:function(e){return e.color?e.color:t.chart_color.length?t.color:t.chart_color[0]},colorPieMS:function(e,a){return"lineChart"!==a&&"areaChart"!==a&&e.name.toLowerCase()===t.highlight.toLowerCase()?t.highlight_color:"saturation"===t.color_mode?t.saturation_color:"color"===t.color_mode?e.color:void 0},colorGroup:function(e){return"saturation"===t.color_mode?t.saturation_color:"color"===t.color_mode?e.color:void 0},colorLegends:function(e){return"saturation"===t.color_mode?t.saturation_color:"color"===t.color_mode&&e?e:"color"===t.color_mode?t.chart_color:t.chart_color[0]}};return r},configuration.border=function(t){var e={width:function(){return t.border_between_chart_elements_thickness+"px"},color:function(){return t.border_between_chart_elements_color},style:function(){return t.border_between_chart_elements_style}};return e},configuration.transition=function(t){var e={duration:function(){return"default"===t.mode&&PykCharts["boolean"](t.transition_duration)?1e3*t.transition_duration:0}};return e},configuration.renderBrush=function(t,e,a,r){function n(t){var e=+("e"==t),a=e?1:-1,n=r/3;return"M"+.5*a+","+n+"A6,6 0 0 "+e+" "+6.5*a+","+(n+6)+"V"+(2*n-6)+"A6,6 0 0 "+e+" "+.5*a+","+2*n+"ZM"+2.5*a+","+(n+8)+"V"+(2*n-8)+"M"+4.5*a+","+(n+8)+"V"+(2*n-8)}function o(){return t.brush_extent=d3.event.target.extent(),min=t.brush_extent[0],max=t.brush_extent[1],t.onBrush(e(min),e(max)),console.log(e(min),e(max)),t.brush_extent}t.make_brush=d3.svg.brush().x(e).on("brushend",o);var i=a.append("g").attr("class","brush").call(t.make_brush);i.selectAll("rect").attr("height",r).attr("fill","blue").attr("fill-opacity",.3),i.selectAll(".resize").append("path").attr("d",n).attr("fill","#4C7190").attr("stroke","#4C7190").attr("stroke-width","1.5px")},configuration.Theme=function(){var t=this;return t.stylesheet={mode:"default",selector:"",interactive_enable:"no",click_enable:"no",chart_height:430,chart_width:600,chart_margin_top:35,chart_margin_right:50,chart_margin_bottom:35,chart_margin_left:50,title_text:"",title_size:2,title_color:"#1D1D1D",title_weight:"bold",title_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",subtitle_size:1,subtitle_color:"black",subtitle_weight:"normal",subtitle_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",highlight:"",highlight_color:"#08306b",background_color:"transparent",chart_color:["#255AEE"],saturation_color:"#255AEE",border_between_chart_elements_thickness:1,border_between_chart_elements_color:"white",border_between_chart_elements_style:"solid",legends_enable:"yes",legends_display:"horizontal",legends_text_size:11,legends_text_color:"#1D1D1D",legends_text_weight:"normal",legends_text_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",label_size:11,label_color:"white",label_weight:"normal",label_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",pointer_overflow_enable:"yes",pointer_thickness:1,pointer_weight:"normal",pointer_size:11,pointer_color:"#1D1D1D",pointer_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",export_enable:"no",color_mode:"color",axis_x_pointer_size:11,axis_x_pointer_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",axis_x_pointer_weight:"normal",axis_x_pointer_color:"#1D1D1D",axis_x_enable:"yes",axis_x_title:"",axis_x_title_size:14,axis_x_title_color:"#1D1D1D",axis_x_title_weight:"bold",axis_x_title_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",axis_x_position:"bottom",axis_x_pointer_position:"bottom",axis_x_line_color:"#1D1D1D",axis_x_no_of_axis_value:5,axis_x_pointer_length:5,axis_x_pointer_padding:6,axis_x_pointer_values:[],axis_x_outer_pointer_length:0,axis_x_time_value_datatype:"",axis_x_time_value_interval:0,axisHighlight_x_data_format:"string",loading_source:"<div class='PykCharts-loading'>loading...</div>",loading_type:"css",tooltip_enable:"yes",tooltip_mode:"moving",credit_my_site_name:"PykCharts",credit_my_site_url:"http://www.pykcharts.com/",chart_onhover_highlight_enable:"yes",units_prefix:!1,units_suffix:!1},t.functionality={real_time_charts_refresh_frequency:0,real_time_charts_last_updated_at_enable:"yes",transition_duration:0},t.oneDimensionalCharts={clubdata_enable:"yes",clubdata_text:"Others",
clubdata_maximum_nodes:5,shade_color:"#255AEE",pie_radius_percent:70,donut_radius_percent:70,donut_inner_radius_percent:40,donut_show_total_at_center:"yes",donut_show_total_at_center_size:24,donut_show_total_at_center_color:"#1D1D1D",donut_show_total_at_center_weight:"bold",donut_show_total_at_center_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",funnel_rect_width:100,funnel_rect_height:100,percent_column_rect_width:20,percent_row_rect_height:10},t.otherCharts={pictograph_show_all_images:"yes",pictograph_total_count_enable:"yes",pictograph_current_count_enable:"yes",pictograph_image_per_line:3,pictograph_image_width:79,pictograph_image_height:66,pictograph_current_count_size:64,pictograph_current_count_color:"#255aee",pictograph_current_count_weight:"normal",pictograph_current_count_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",pictograph_total_count_size:64,pictograph_total_count_color:"grey",pictograph_total_count_weight:"normal",pictograph_total_count_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",pictograph_units_per_image_text_size:24,pictograph_units_per_image_text_color:"grey",pictograph_units_per_image_text_weight:"normal",pictograph_units_per_image_text_family:"'Helvetica Neue',Helvetica,Arial,sans-serif"},t.multiDimensionalCharts={chart_grid_x_enable:"yes",chart_grid_y_enable:"yes",chart_grid_color:"#ddd",axis_onhover_highlight_enable:"yes",axis_y_pointer_size:11,axis_y_pointer_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",axis_y_pointer_weight:"normal",axis_y_pointer_color:"#1D1D1D",axis_y_enable:"yes",axis_y_title:"",axis_y_title_size:14,axis_y_title_color:"#1D1D1D",axis_y_title_weight:"bold",axis_y_title_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",axis_y_position:"left",axis_y_pointer_position:"left",axis_y_line_color:"#1D1D1D",axis_y_no_of_axis_value:5,axis_y_pointer_length:5,axis_y_pointer_padding:6,axis_y_pointer_values:[],axis_y_outer_pointer_length:0,axis_y_time_value_datatype:"",axis_y_time_value_interval:0,axis_y_data_format:"number",variable_circle_size_enable:"yes",crosshair_enable:"yes",zoom_enable:"no",zoom_level:3,spiderweb_outer_radius_percent:100,scatterplot_radius:20,scatterplot_pointer_enable:"no",curvy_lines_enable:"no",annotation_enable:"no",annotation_view_mode:"onload",annotation_background_color:"#C2CBCF",annotation_font_color:"black",legends_mode:"default",expand_group:"yes",data_mode_enable:"no",data_mode_legends_color:"black",data_mode_default:"percentage",connecting_lines_color:"#ddd",connecting_lines_style:"solid",text_between_steps_color:"#aaa",text_between_steps_family:"'Helvetica Neue',Helvetica,Arial,sans-serif",text_between_steps_size:10,text_between_steps_weight:"normal",data_mode_enable:"no",data_mode_legends_color:"black",data_mode_default:"percentage",connecting_lines_color:"#ddd",connecting_lines_style:"solid",data_sort_enable:"yes",data_sort_type:"alphabetically",data_sort_order:"ascending",calculate_total:"yes",axis_y_background_color:"transparent"},t.treeCharts={zoom_enable:"no",nodeRadius:4.5},t.mapsTheme={total_no_of_colors:3,palette_color:"Blue-1",tooltip_position_top:0,tooltip_position_left:0,timeline_duration:1,timeline_margin_top:5,timeline_margin_right:25,timeline_margin_bottom:25,timeline_margin_left:45,label_enable:"no",click_enable:"yes",chart_onhover_effect:"shadow"},t},PykCharts.validation={},PykCharts.oneD={},PykCharts.other={},PykCharts.validation.processInputs=function(t,e,a){function r(t){return t.toLowerCase()}function n(t){return t in e}var o=new PykCharts.Configuration.Theme({}),i=o.stylesheet,l=o.functionality,s=o.oneDimensionalCharts,_=o.multiDimensionalCharts,c=o.mapsTheme;t.title_text=e.title_text,t.subtitle_text=e.subtitle_text,e.credit_my_site_name||e.credit_my_site_url?(t.credit_my_site_name=e.credit_my_site_name?e.credit_my_site_name:"",t.credit_my_site_url=e.credit_my_site_url?e.credit_my_site_url:""):(t.credit_my_site_name=i.credit_my_site_name,t.credit_my_site_url=i.credit_my_site_url),t.data_source_name=e.data_source_name?e.data_source_name:"",t.data_source_url=e.data_source_url?e.data_source_url:"",t.default_color=i.chart_color;var d=[{config_name:"selector",default_value:i,validation_type:"validatingSelector",all_charts:!0},{config_name:"chart_color",default_value:i,validation_type:"isArray",all_charts:!0},{config_name:"axis_x_pointer_values",default_value:i,validation_type:"isArray",maps:!0,multiDimensionalCharts:!0},{config_name:"axis_y_pointer_values",default_value:_,validation_type:"isArray",multiDimensionalCharts:!0},{config_name:"mode",default_value:i,validation_type:"validatingChartMode",condition2:r,oneDimensionalCharts:!0,multiDimensionalCharts:!0,other:!0},{config_name:"chart_width",default_value:i,validation_type:"validatingDataType",all_charts:!0},{config_name:"title_size",default_value:i,validation_type:"validatingDataType",all_charts:!0},{config_name:"subtitle_size",default_value:i,validation_type:"validatingDataType",condition1:n,all_charts:!0},{config_name:"border_between_chart_elements_thickness",default_value:i,validation_type:"validatingDataType",condition1:n,all_charts:!0},{config_name:"label_size",default_value:i,validation_type:"validatingDataType",condition1:n,all_charts:!0},{config_name:"pointer_thickness",default_value:i,validation_type:"validatingDataType",condition1:n,oneDimensionalCharts:!0,multiDimensionalCharts:!0},{config_name:"pointer_size",default_value:i,validation_type:"validatingDataType",condition1:n,oneDimensionalCharts:!0,multiDimensionalCharts:!0},{config_name:"axis_x_title_size",default_value:i,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"axis_y_title_size",default_value:_,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"legends_text_size",default_value:i,validation_type:"validatingDataType",condition1:n,maps:!0,multiDimensionalCharts:!0},{config_name:"axis_x_pointer_size",default_value:i,validation_type:"validatingDataType",condition1:n,maps:!0,multiDimensionalCharts:!0},{config_name:"axis_y_pointer_size",default_value:_,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"axis_x_pointer_length",default_value:i,validation_type:"validatingDataType",condition1:n,maps:!0,multiDimensionalCharts:!0},{config_name:"axis_y_pointer_length",default_value:_,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"axis_x_outer_pointer_length",default_value:i,validation_type:"validatingDataType",condition1:n,maps:!0,multiDimensionalCharts:!0},{config_name:"axis_y_outer_pointer_length",default_value:_,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"real_time_charts_refresh_frequency",default_value:l,validation_type:"validatingDataType",all_charts:!0},{config_name:"transition_duration",default_value:l,validation_type:"validatingDataType",oneDimensionalCharts:!0,multiDimensionalCharts:!0,other:!0},{config_name:"clubdata_maximum_nodes",default_value:s,validation_type:"validatingDataType",oneDimensionalCharts:!0},{config_name:"title_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,all_charts:!0},{config_name:"subtitle_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,all_charts:!0},{config_name:"pointer_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,oneDimensionalCharts:!0,multiDimensionalCharts:!0},{config_name:"label_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,all_charts:!0},{config_name:"background_color",default_value:i,validation_type:"validatingColor",all_charts:!0},{config_name:"shade_color",default_value:s,validation_type:"validatingColor",oneDimensionalCharts:!0},{config_name:"title_color",default_value:i,validation_type:"validatingColor",all_charts:!0},{config_name:"subtitle_color",default_value:i,validation_type:"validatingColor",all_charts:!0},{config_name:"highlight_color",default_value:i,validation_type:"validatingColor",all_charts:!0},{config_name:"label_color",default_value:i,validation_type:"validatingColor",all_charts:!0},{config_name:"pointer_color",default_value:i,validation_type:"validatingColor",oneDimensionalCharts:!0,multiDimensionalCharts:!0},{config_name:"border_between_chart_elements_color",default_value:i,validation_type:"validatingColor",all_charts:!0},{config_name:"axis_x_time_value_datatype",default_value:i,validation_type:"validatingTimeScaleDataType",multiDimensionalCharts:!0},{config_name:"axis_y_time_value_datatype",default_value:_,validation_type:"validatingTimeScaleDataType",multiDimensionalCharts:!0},{config_name:"chart_height",default_value:i,validation_type:"validatingDataType",multiDimensionalCharts:!0,maps:!0},{config_name:"chart_margin_left",default_value:i,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"chart_margin_right",default_value:i,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"chart_margin_top",default_value:i,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"chart_margin_bottom",default_value:i,validation_type:"validatingDataType",condition1:n,multiDimensionalCharts:!0},{config_name:"zoom_level",default_value:_,validation_type:"validatingDataType",multiDimensionalCharts:!0},{config_name:"axis_x_pointer_padding",default_value:i,validation_type:"validatingDataType",multiDimensionalCharts:!0,maps:!0},{config_name:"axis_y_pointer_padding",default_value:_,validation_type:"validatingDataType",multiDimensionalCharts:!0},{config_name:"axis_x_no_of_axis_value",default_value:i,validation_type:"validatingDataType",multiDimensionalCharts:!0},{config_name:"axis_y_no_of_axis_value",default_value:_,validation_type:"validatingDataType",multiDimensionalCharts:!0},{config_name:"axis_x_time_value_interval",default_value:i,validation_type:"validatingDataType",multiDimensionalCharts:!0},{config_name:"axis_y_time_value_interval",default_value:_,validation_type:"validatingDataType",multiDimensionalCharts:!0},{config_name:"legends_text_color",default_value:i,validation_type:"validatingColor",multiDimensionalCharts:!0,maps:!0},{config_name:"axis_x_pointer_color",default_value:i,validation_type:"validatingColor",multiDimensionalCharts:!0,maps:!0},{config_name:"axis_y_pointer_color",default_value:_,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"axis_x_title_color",default_value:i,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"axis_y_title_color",default_value:_,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"axis_x_line_color",default_value:i,validation_type:"validatingColor",multiDimensionalCharts:!0,maps:!0},{config_name:"axis_y_line_color",default_value:_,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"annotation_font_color",default_value:_,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"annotation_background_color",default_value:_,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"chart_grid_color",default_value:_,validation_type:"validatingColor",multiDimensionalCharts:!0},{config_name:"legends_display",default_value:i,validation_type:"validatingLegendsPosition",multiDimensionalCharts:!0,maps:!0},{config_name:"tooltip_mode",default_value:i,validation_type:"validatingTooltipMode",multiDimensionalCharts:!0,maps:!0},{config_name:"legends_text_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,multiDimensionalCharts:!0,maps:!0},{config_name:"axis_y_pointer_weight",default_value:_,validation_type:"validatingFontWeight",condition2:r,multiDimensionalCharts:!0},{config_name:"axis_x_pointer_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,multiDimensionalCharts:!0,maps:!0},{config_name:"axis_y_title_weight",default_value:_,validation_type:"validatingFontWeight",condition2:r,multiDimensionalCharts:!0},{config_name:"axis_x_title_weight",default_value:i,validation_type:"validatingFontWeight",condition2:r,multiDimensionalCharts:!0},{config_name:"axis_y_position",default_value:_,validation_type:"validatingYAxisPointerPosition",multiDimensionalCharts:!0},{config_name:"axis_x_position",default_value:i,validation_type:"validatingXAxisPointerPosition",condition2:r,multiDimensionalCharts:!0},{config_name:"axis_y_pointer_position",default_value:_,validation_type:"validatingYAxisPointerPosition",condition2:r,multiDimensionalCharts:!0},{config_name:"axis_x_pointer_position",default_value:i,validation_type:"validatingXAxisPointerPosition",condition2:r,multiDimensionalCharts:!0},{config_name:"color_mode",default_value:i,validation_type:"validatingColorMode",condition2:r,multiDimensionalCharts:!0},{config_name:"border_between_chart_elements_style",default_value:i,condition2:r,all_charts:!0},{config_name:"clubdata_text",default_value:s,oneDimensionalCharts:!0},{config_name:"saturation_color",default_value:i,multiDimensionalCharts:!0,maps:!0},{config_name:"timeline_duration",default_value:c,maps:!0,condition1:n}];t.k=new PykCharts.Configuration(t);for(var u=t.k.validator(),h=0,p=d.length;p>h;h++){var g=d[h];if(g[a]||g.all_charts){var m=g.config_name,f=g.default_value[m],x=g.condition1?g.condition1(m):e[m];if(m in e)var y=g.condition2?g.condition2(e[m]):e[m];t[m]=x?y:f,g.validation_type&&u[g.validation_type](t[m],m,f)}}"maps"===a&&(t.axis_x_pointer_position=e.axis_x_pointer_position?e.axis_x_pointer_position:"top",u.validatingXAxisPointerPosition(t.axis_x_pointer_position,"axis_x_pointer_position","top")),"oneDimensionalCharts"===a?(t.color_mode=e.color_mode?e.color_mode:"shade",u.validatingColorMode(t.color_mode,"color_mode","shade",a)):"maps"===a&&(t.color_mode=e.color_mode?e.color_mode:"saturation",u.validatingColorMode(t.color_mode,"color_mode","saturation",a));for(var v=[{config_name:"interactive_enable",default_value:i,all_charts:!0},{config_name:"click_enable",default_value:i,all_charts:!0},{config_name:"tooltip_enable",default_value:i,all_charts:!0},{config_name:"export_enable",default_value:i,all_charts:!0},{config_name:"real_time_charts_last_updated_at_enable",default_value:l,all_charts:!0},{config_name:"clubdata_enable",default_value:s,oneDimensionalCharts:!0},{config_name:"pointer_overflow_enable",default_value:i,oneDimensionalCharts:!0},{config_name:"chart_onhover_highlight_enable",default_value:i,all_charts:!0},{config_name:"chart_grid_x_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"chart_grid_y_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"axis_x_enable",default_value:i,multiDimensionalCharts:!0,maps:!0},{config_name:"axis_y_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"axis_onhover_highlight_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"zoom_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"annotation_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"legends_enable",default_value:i,multiDimensionalCharts:!0,maps:!0},{config_name:"variable_circle_size_enable",default_value:_,multiDimensionalCharts:!0},{config_name:"title_family",default_value:i,all_charts:!0},{config_name:"subtitle_family",default_value:i,all_charts:!0},{config_name:"pointer_family",default_value:i,oneDimensionalCharts:!0,multiDimensionalCharts:!0},{config_name:"title_family",default_value:i,all_charts:!0},{config_name:"label_family",default_value:i,all_charts:!0},{config_name:"units_suffix",default_value:i,oneDimensionalCharts:!0},{config_name:"units_prefix",default_value:i,oneDimensionalCharts:!0},{config_name:"highlight",default_value:i,all_charts:!0},{config_name:"axis_x_title_family",default_value:i,multiDimensionalCharts:!0},{config_name:"axis_y_title_family",default_value:_,multiDimensionalCharts:!0},{config_name:"legends_text_family",default_value:i,multiDimensionalCharts:!0},{config_name:"axis_x_title",default_value:i,multiDimensionalCharts:!0},{config_name:"axis_y_title",default_value:i,multiDimensionalCharts:!0},{config_name:"map_code",default_value:c,maps:!0},{config_name:"click_enable",default_value:c,maps:!0},{config_name:"annotation_view_mode",default_value:_,multiDimensionalCharts:!0},{config_name:"loading_type",default_value:i,all_charts:!0},{config_name:"loading_source",default_value:i,all_charts:!0}],h=0,k=v.length;k>h;h++){var g=v[h];if(g[a]||g.all_charts){var m=g.config_name,f=g.default_value[m];t[m]=e[m]?e[m]:f}}switch(t.clubdata_always_include_data_points=PykCharts["boolean"](t.clubdata_enable)&&e.clubdata_always_include_data_points?e.clubdata_always_include_data_points:[],u.isArray(t.clubdata_always_include_data_points,"clubdata_always_include_data_points"),t.border_between_chart_elements_style){case"dotted":t.border_between_chart_elements_style="1,3";break;case"dashed":t.border_between_chart_elements_style="5,5";break;default:t.border_between_chart_elements_style="0"}if("oneDimensionalCharts"===a||"maps"===a)t.chart_color[0]&&t.k.validator().validatingColor(t.chart_color[0],"chart_color",i.chart_color);else for(var h=0;h<t.chart_color.length;h++)t.chart_color[h]&&t.k.validator().validatingColor(t.chart_color[h],"chart_color",i.chart_color);return t.k=new PykCharts.Configuration(t),t},PykCharts.oneD.bubble=function(t){var e=this;e.interval="";new PykCharts.Configuration.Theme({});this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),e.chart_height=t.chart_height?t.chart_height:e.chart_width,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width),e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("oned",t),e.compare_data=e.k.__proto__._groupBy("oned",t),e.k.remove_loading_bar(r),e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("oned",t),e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",e.refresh_data=e.k.__proto__._groupBy("oned",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data),r=[];e.compare_data=a[0];var n=a[1];n&&e.k.lastUpdatedAt("liveData"),e.new_data=e.optionalFeatures().clubData(),"shade"===e.color_mode&&(r=e.k.shadeColorConversion(e.shade_color,e.new_data.children.length),r.reverse(),e.new_data.children.forEach(function(t,e){t.color=r[e]})),e.optionalFeatures().createChart().label()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var t=e.selector.substring(1,e.selector.length),a=t+"_svg",r=[];e.fillChart=new PykCharts.Configuration.fillChart(e),e.transitions=new PykCharts.Configuration.transition(e),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+a,"bubble").emptyDiv(e.selector).subtitle(),e.new_data=e.optionalFeatures().clubData(),"shade"===e.color_mode&&(r=e.k.shadeColorConversion(e.shade_color,e.new_data.children.length),r.reverse(),e.new_data.children.forEach(function(t,e){t.color=r[e]})),e.optionalFeatures().svgContainer(a).createChart().label(),e.k.createFooter().lastUpdatedAt().credits().dataSource().liveData(e).tooltip()):"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+a,"bubble").emptyDiv(e.selector),e.new_data={children:e.data},"shade"===e.color_mode&&(r=e.k.shadeColorConversion(e.shade_color,e.new_data.children.length),r.reverse(),e.new_data.children.forEach(function(t,e){t.color=r[e]})),e.optionalFeatures().svgContainer(a).createChart().label(),e.k.tooltip()),e.k.exportSVG(e,"#"+a,"bubble"),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e);var n=e.k.resize(e.svgContainer);e.k.__proto__._ready(n),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.optionalFeatures=function(){var a={svgContainer:function(t){return e.svgContainer=d3.select(e.selector).append("svg").attr({"class":"svgcontainer PykCharts-oneD",id:t,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height,width:e.chart_width,height:e.chart_height}),e.group=e.svgContainer.append("g").attr("id","bubgrp"),this},createChart:function(){var t=d3.layout.pack().sort(function(t,e){return e.weight-t.weight}).size([e.chart_width,e.chart_height]).value(function(t){return t.weight}).padding(20);e.sum=d3.sum(e.new_data.children,function(t){return t.weight});e.new_data.children.length;e.node=t.nodes(e.new_data);var a=e.group.selectAll(".bubble-node").data(e.node);return a.enter().append("g").attr("class","bubble-node").append("circle"),a.attr("class","bubble-node").select("circle").attr({"class":"bubble",id:function(t,e){return"bubble"+e},x:function(t){return t.x},y:function(t){return t.y},r:0,transform:function(t){return"translate("+t.x+","+t.y+")"},fill:function(t){return t.children?e.background_color:e.fillChart.selectColor(t)},"fill-opacity":function(t){return t.children?0:1},"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},"data-id":function(t,e){return t.name}}).on({mouseover:function(t){t.children||"default"!==e.mode||(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(e.selector+" .bubble",this,!0),t.tooltip=t.tooltip||"<table><thead><th colspan='2' class='tooltip-heading'>"+t.name+"</th></thead><tr><td class='tooltip-left-content'>"+e.k.appendUnits(t.weight)+"  <td class='tooltip-right-content'>("+(100*t.weight/e.sum).toFixed(1)+"%)</tr></table>",e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(t.tooltip))},mouseout:function(t){"default"===e.mode&&(e.mouseEvent.tooltipHide(t),PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(e.selector+" .bubble"))},mousemove:function(t){t.children||"default"!==e.mode||e.mouseEvent.tooltipPosition(t)},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("r",function(t){return t.r}),a.exit().remove(),this},label:function(){function a(){n.text(function(t){return t.children?" ":t.name}).attr("pointer-events","none").text(function(t){return this.getBBox().width<.85*(2*t.r)&&this.getBBox().height<2*t.r?t.children?" ":t.name:""})}function r(){o.text(function(t){return t.children?" ":e.k.appendUnits(t.weight)}).text(function(t){return this.getBBox().width<2*t.r*.55&&this.getBBox().height<2*t.r*.55?t.children?" ":(100*t.weight/e.sum).toFixed(1)+"%":""})}var n=e.group.selectAll(".name").data(e.node),o=e.group.selectAll(".weight").data(e.node);return n.enter().append("svg:text").attr("class","name"),o.enter().append("svg:text").attr("class","weight"),n.attr("class","name").attr({x:function(t){return t.x},y:function(t){return t.y-5}}),o.attr("class","weight").attr({x:function(t){return t.x},y:function(t){return+t.y+e.label_size}}),n.attr("text-anchor","middle").attr("fill",function(a){if("shade"===e.color_mode&&!a.children&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color}).style({"font-weight":e.label_weight,"font-size":e.label_size+"px","font-family":e.label_family}).text(""),setTimeout(a,e.transitions.duration()),o.attr({"text-anchor":"middle",fill:function(a){if("shade"===e.color_mode&&!a.children&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color},"pointer-events":"none"}).style({"font-family":e.label_family,"font-weight":e.label_weight,"font-size":e.label_size+"px"}).text(""),setTimeout(r,e.transitions.duration()),n.exit().remove(),o.exit().remove(),this},clubData:function(){var t,a=e.data.length;if(PykCharts["boolean"](e.clubdata_enable)){var r,n,o=[],i=0,l=[];if(a<=e.clubdata_maximum_nodes)return t={children:e.data};if(0!==e.clubdata_always_include_data_points.length){var s=e.clubdata_always_include_data_points.length;for(n=0;s>n;n++)o[n]=e.clubdata_always_include_data_points[n]}for(n=0;n<o.length;n++)for(r=0;a>r;r++)o[n].toUpperCase()===e.data[r].name.toUpperCase()&&l.push(e.data[r]);for(e.data.sort(function(t,e){return e.weight-t.weight});l.length<e.clubdata_maximum_nodes-1;){for(n=0;n<o.length;n++)e.data[i].name.toUpperCase()===o[n].toUpperCase()&&i++;l.push(e.data[i]),i++}var _=0;for(r=i;a>r;r++){for(n=0;n<l.length&&r<e.data.length;n++)e.data[r].name.toUpperCase()===l[n].name.toUpperCase()&&(_+=0,r++,n=-1);r<e.data.length&&(_+=e.data[r].weight)}for(var c=function(t,e){return e.weight-t.weight};l.length>e.clubdata_maximum_nodes;){l.sort(c);l.pop()}var d={name:e.clubdata_text,weight:_,color:e.clubData_color,tooltip:e.clubData_tooltipText,highlight:!1};l.length<e.clubdata_maximum_nodes&&l.push(d),l.sort(function(t,e){return t.weight-e.weight}),t={children:l},e.map1=t.children.map(function(t){return t.weight})}else e.data.sort(function(t,e){return t.weight-e.weight}),t={children:e.data};return t}};return a}},PykCharts.oneD.funnel=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),e.chart_height=t.chart_height?t.chart_height:e.chart_width;var n=(t.optional,a.oneDimensionalCharts);e.funnel_rect_width=t.funnel_rect_width?t.funnel_rect_width:n.funnel_rect_width,e.funnel_rect_height=t.funnel_rect_height?t.funnel_rect_height:n.funnel_rect_height,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width).validatingDataType(e.funnel_rect_width,"funnel_rect_width",n.funnel_rect_width).validatingDataType(e.funnel_rect_height,"funnel_rect_height",n.funnel_rect_height);try{if(e.funnel_rect_width>=e.chart_width)throw"funnel_rect_width"}catch(o){e.funnel_rect_width=n.funnel_rect_width,console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.(Invalid value for attribute "funnel_rect_width")  Visit www.pykcharts.com/errors#warning_19')}e.stop||(e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("oned",t),e.compare_data=e.k.__proto__._groupBy("oned",t),e.k.remove_loading_bar(r),void e.render())},PykCharts["boolean"](t.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("oned",t),e.refresh_data=e.k.__proto__._groupBy("oned",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().createChart().label().ticks()},PykCharts["boolean"](t.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var t=this,e=t.selector.substring(1,t.selector.length),a=e+"_svg";t.fillChart=new PykCharts.Configuration.fillChart(t),t.transitions=new PykCharts.Configuration.transition(t),"default"===t.mode&&t.k.title().backgroundColor(t)["export"](t,"#"+a,"funnel").emptyDiv(t.selector).subtitle(),t.k.tooltip(),t.mouseEvent=new PykCharts.Configuration.mouseEvent(t),"infographics"===t.mode&&(t.k.backgroundColor(t)["export"](t,"#"+a,"funnel").emptyDiv(t.selector),t.new_data=t.data),"default"===t.mode&&t.optionalFeatures(),t.optionalFeatures().svgContainer(a).createChart().label().ticks(),"default"===t.mode&&t.k.liveData(t).createFooter().lastUpdatedAt().credits().dataSource();var r=0;setTimeout(function(){t.ticks_text_width.length&&(r=d3.max(t.ticks_text_width,function(t){return t})),t.k.exportSVG(t,"#"+a,"funnel",void 0,void 0,r)},t.transitions.duration());var n=t.k.resize(t.svgContainer);t.k.__proto__._ready(n),window.addEventListener("resize",function(e){return t.k.resize(t.svgContainer)})},this.funnelLayout=function(){var t,e,a,r=this,n={data:function(e){return 0===e.length||(t=e),this},size:function(t){return 2!==t.length||(e=t),this},mouth:function(t){return 2!==t.length||(a=t),this},coordinates:function(){for(var n=e[0],o=e[1],i=a[0],l=a[1],s=(n-i)/2,_=o-l,c=0,d=0,u=0,h=0,p=[],g=s/_,m=(n+i)/2*_,f=i*l,x=m+f,y=f/x*100,v=t.length-1;v>=0;v--){var k=r.percentageValues(t)[v];if(y>=k)u=k/y*l,c=o-u,v===t.length-1?p[v]={values:[{x:(n-i)/2,y:c},{x:(n-i)/2,y:o},{x:(n-i)/2+i,y:o},{x:(n-i)/2+i,y:c}]}:p[v]={values:[{x:(n-i)/2,y:c},p[v+1].values[0],p[v+1].values[3],{x:(n-i)/2+i,y:c}]};else{var w=k/100*x-f,b=2*g,C=2*i,P=2*w;d=(-C+Math.sqrt(Math.pow(C,2)-4*b*-P))/(2*b),c=o-d-l;var D=2*(g*d)+i,S=(n-D)/2;if(0===h)v===t.length-1?p[v]={values:[{x:S,y:c},{x:(n-i)/2,y:_},{x:(n-i)/2,y:o},{x:(n-i)/2+i,y:o},{x:(n-i)/2+i,y:_},{x:D+S,y:c}]}:p[v]={values:[{x:S,y:c},{x:(n-i)/2,y:_},p[v+1].values[0],p[v+1].values[3],{x:(n-i)/2+i,y:_},{x:D+S,y:c}]};else{var A;A=6===p[v+1].values.length?5:3,p[v]={values:[{x:S,y:c},p[v+1].values[0],p[v+1].values[A],{x:D+S,y:c}]}}h=1}}return p}};return n},this.percentageValues=function(t){var e=t.map(function(e){var a=d3.max(t,function(t){return t.weight});return e.weight/a*100});return e.sort(function(t,e){return e-t}),e},this.optionalFeatures=function(){var a={svgContainer:function(a){return e.svgContainer=d3.select(t.selector).append("svg").attr({width:e.chart_width+"px",height:e.chart_height+"px",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height,id:a,"class":"svgcontainer PykCharts-oneD"}),e.group=e.svgContainer.append("g").attr("id","funnel"),this},createChart:function(){var a=new PykCharts.Configuration.border(e);e.new_data=e.data.sort(function(t,e){return e.weight-t.weight}),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.per_values=e.percentageValues(e.new_data),e.funnel=e.funnelLayout().data(e.new_data).size([e.chart_width,e.chart_height]).mouth([e.funnel_rect_width,e.funnel_rect_height]),e.coordinates=e.funnel.coordinates();var r=d3.svg.line().interpolate("linear-closed").x(function(t,e){return t.x}).y(function(t,e){return t.y});e.chart_data=e.group.selectAll(".fun-path").data(e.coordinates);var n=[{x:0,y:0},{x:e.chart_width,y:0},{x:0,y:0},{x:e.chart_width,y:0},{x:0,y:0},{x:e.chart_width,y:0}];return e.chart_data.enter().append("path").attr("class","fun-path"),e.chart_data.attr({"class":"fun-path",d:function(t){return r(n)},fill:function(t,a){return t.color=e.new_data[a].color,e.fillChart.selectColor(e.new_data[a])},"fill-opacity":1,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},stroke:a.color(),"stroke-width":a.width(),"stroke-dasharray":a.style(),"stroke-opacity":1,"data-id":function(t,a){return e.new_data[a].name}}).on({mouseover:function(a,r){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(t.selector+" .fun-path",this),tooltip=e.data[r].tooltip||"<table><tr><th colspan='2' class='tooltip-heading'>"+e.new_data[r].name+"</tr><tr><td class='tooltip-left-content'>"+e.k.appendUnits(e.new_data[r].weight)+"<td class='tooltip-right-content'>("+e.per_values[r].toFixed(1)+"%) </tr></table>",e.mouseEvent.tooltipPosition(a),e.mouseEvent.tooltipTextShow(tooltip))},mouseout:function(a){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(t.selector+" .fun-path"),
e.mouseEvent.tooltipHide(a))},mousemove:function(t,a){"default"===e.mode&&e.mouseEvent.tooltipPosition(t)},click:function(a,r){PykCharts["boolean"](t.click_enable)&&e.addEvents(e.new_data[r].name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("d",function(t){return r(t.values)}),e.chart_data.exit().remove(),this},label:function(){function a(){e.chart_text.text(function(t,a){return e.per_values[a].toFixed(1)+"%"}).attr({"text-anchor":"middle","pointer-events":"none",fill:function(a){if("shade"===e.color_mode&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color}}).style({"font-weight":e.label_weight,"font-size":e.label_size+"px","font-family":e.label_family}).text(function(t,a){return this.getBBox().width<t.values[3].x-t.values[1].x&&this.getBBox().height<t.values[2].y-t.values[0].y?e.per_values[a].toFixed(1)+"%":""})}return e.chart_text=e.group.selectAll("text").data(e.coordinates),e.chart_text.enter().append("text"),e.chart_text.attr({y:function(t,e){return 4===t.values.length?(t.values[0].y-t.values[1].y)/2+t.values[1].y+5:(t.values[0].y-t.values[2].y)/2+t.values[2].y+5},x:function(t,a){return e.chart_width/2}}),e.chart_text.text(""),setTimeout(a,e.transitions.duration()),e.chart_text.exit().remove(),this},ticks:function(){function t(){n.text(function(t,a){return e.data[a].name}).text(function(t,a){return r[a]=this.getBBox().height,e.ticks_text_width.push(this.getBBox().width),this.getBBox().height<t.values[2].y-t.values[0].y?e.data[a].name:""}).style({"font-size":e.pointer_size+"px","text-anchor":"start",fill:e.pointer_color,"pointer-events":"none","font-family":e.pointer_family,"font-weight":e.pointer_weight})}function a(){l.attr("x2",function(t,e){return t.values[2].y-t.values[0].y>r[e]?4===t.values.length?(t.values[3].x+t.values[2].x)/2+12:t.values[4].x+12:4===t.values.length?(t.values[3].x+t.values[2].x)/2:t.values[4].x})}PykCharts["boolean"](e.pointer_overflow_enable)&&e.svgContainer.style("overflow","visible");var r=[];e.ticks_text_width=[];var n=e.group.selectAll(".ticks_label").data(e.coordinates);n.attr("class","ticks_label"),n.enter().append("text").attr({x:0,y:0});var o,i;n.attr("transform",function(t){return 4===t.values.length?(o=(t.values[3].x+t.values[2].x)/2+17,i=(t.values[0].y+t.values[2].y)/2+5):(o=t.values[4].x+17,i=t.values[4].y+5),"translate("+o+","+i+")"}),n.text(""),setTimeout(t,e.transitions.duration()),n.exit().remove();var l=e.group.selectAll(".funnel-ticks").data(e.coordinates);return l.enter().append("line").attr("class","funnel-ticks"),l.attr({x1:function(t,e){return 4===t.values.length?(t.values[3].x+t.values[2].x)/2:t.values[4].x},y1:function(t,e){return 4===t.values.length?(t.values[0].y+t.values[2].y)/2:t.values[4].y},x2:function(t,e){return 4===t.values.length?(t.values[3].x+t.values[2].x)/2:t.values[4].x},y2:function(t,e){return 4===t.values.length?(t.values[0].y+t.values[2].y)/2:t.values[4].y},"stroke-width":e.pointer_thickness+"px",stroke:e.pointer_color}),setTimeout(a,e.transitions.duration()),l.exit().remove(),this}};return a}},PykCharts.oneD.percentageColumn=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(e){var r=this;r=new PykCharts.validation.processInputs(r,t,"oneDimensionalCharts"),r.chart_height=PykCharts["boolean"](t.chart_height)?t.chart_height:r.chart_width,r.percent_column_rect_width=t.percent_column_rect_width?t.percent_column_rect_width:a.oneDimensionalCharts.percent_column_rect_width,r.k.validator().validatingDataType(r.chart_height,"chart_height",r.chart_width).validatingDataType(r.percent_column_rect_width,"percent_column_rect_width",a.oneDimensionalCharts.percent_column_rect_width),r.stop||(r.k.storeInitialDivHeight(),r.percent_column_rect_width>100&&(r.percent_column_rect_width=100),r.percent_column_rect_width=2*r.k.__proto__._radiusCalculation(r.percent_column_rect_width,"percentageBar"),"default"===r.mode&&r.k.loading(),r.executeData=function(t){var e=r.k.validator().validatingJSON(t),a=r.selector.substring(1,r.selector.length);return r.stop||e===!1?void r.k.remove_loading_bar(a):(r.data=r.k.__proto__._groupBy("oned",t),r.compare_data=r.k.__proto__._groupBy("oned",t),r.k.remove_loading_bar(a),r.clubdata_enable=r.data.length>r.clubdata_maximum_nodes?r.clubdata_enable:"no",void r.render())},PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeData")):r.k.dataSourceFormatIdentification(t.data,r,"executeData"))},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("oned",t),e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",e.refresh_data=e.k.__proto__._groupBy("oned",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().clubData(),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().createChart().label().ticks()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var e=this,a=e.selector.substring(1,e.selector.length),r=a+"_svg";e.fillChart=new PykCharts.Configuration.fillChart(e),e.transitions=new PykCharts.Configuration.transition(e),"default"===e.mode&&e.k.title().backgroundColor(e)["export"](e,"#"+r,"percentageColumn").emptyDiv(e.selector).subtitle(),"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+r,"percentageColumn").emptyDiv(e.selector),e.new_data=e.data),e.k.tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),"default"===e.mode&&(percent_column=e.optionalFeatures().clubData()),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().svgContainer(r).createChart().label().ticks(),"default"===e.mode&&e.k.liveData(e).createFooter().lastUpdatedAt().credits().dataSource();var n=0;setTimeout(function(){e.ticks_text_width.length&&(n=d3.max(e.ticks_text_width,function(t){return t})),e.k.exportSVG(e,"#"+r,"percentageColumn",void 0,void 0,n+15),PykCharts["boolean"](t.chart_width)||(e.chart_width=e.percent_column_rect_width+10+n,e.svgContainer.attr("viewBox","0 0 "+e.chart_width+" "+e.chart_height));var a=e.k.resize(e.svgContainer);e.k.__proto__._ready(a)},e.transitions.duration()),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.optionalFeatures=function(){var a={createChart:function(){var t=new PykCharts.Configuration.border(e),a=e.new_data.map(function(t){return t.weight});a.sum=function(){for(var t=0,e=0;e<this.length;++e)t+=this[e];return t};var r=a.sum();return e.new_data.forEach(function(t,e){this[e].percentValue=100*t.weight/r},e.new_data),e.chart_data=e.group.selectAll(".per-rect").data(e.new_data),e.chart_data.enter().append("rect").attr("class","per-rect"),e.chart_data.attr({x:0,y:function(t,a){if(0===a)return 0;var r=0,n=e.new_data.slice(0,a);return n.forEach(function(t,e){r+=this[e].percentValue},n),r*e.chart_height/100},width:e.percent_column_rect_width,height:0,fill:function(t){return e.fillChart.selectColor(t)},"fill-opacity":1,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},stroke:t.color(),"stroke-width":t.width(),"stroke-dasharray":t.style(),"data-id":function(t,e){return t.name}}).on({mouseover:function(t,a){"default"===e.mode&&(t.tooltip=t.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+t.name+"</tr><tr><td class='tooltip-left-content'>"+e.k.appendUnits(t.weight)+"<td class='tooltip-right-content'>("+t.percentValue.toFixed(1)+"%)</tr></table>",PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(e.selector+" .per-rect",this),e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(t.tooltip))},mouseout:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(e.selector+" .per-rect"),e.mouseEvent.tooltipHide(t))},mousemove:function(t,a){"default"===e.mode&&e.mouseEvent.tooltipPosition(t)},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("height",function(t){return t.percentValue*e.chart_height/100}),e.chart_data.exit().remove(),this},svgContainer:function(t){return e.svgContainer=d3.select(e.selector).append("svg").attr({width:e.chart_width,height:e.chart_height,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height,id:t,"class":"svgcontainer PykCharts-oneD"}),e.group=e.svgContainer.append("g").attr("id","percentageColumn"),this},label:function(){function a(){e.chart_text.text(function(t){return t.percentValue.toFixed(1)+"%"}).text(function(t){return this.getBBox().width<.92*e.percent_column_rect_width&&this.getBBox().height<t.percentValue*e.chart_height/100?t.percentValue.toFixed(1)+"%":""})}e.chart_text=e.group.selectAll(".per-text").data(e.new_data);var r=0;return e.chart_text.enter().append("text").attr("class","per-text"),e.chart_text.attr({"class":"per-text",x:e.percent_column_rect_width/2,y:function(t,a){return r+=t.percentValue,0===a?(0+r*e.chart_height/100)/2+5:((r-t.percentValue)*e.chart_height/100+r*e.chart_height/100)/2+5}}),r=0,e.chart_text.text("").attr({fill:function(a){if("shade"===e.color_mode&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color},"text-anchor":"middle","pointer-events":"none"}).style({"font-size":e.label_size+"px","font-weight":e.label_weight,"font-family":e.label_family}),setTimeout(a,e.transitions.duration()),e.chart_text.exit().remove(),this},ticks:function(){function t(){s.text(function(t){return t.name}).text(function(t,a){return i[a]=this.getBBox().height,e.ticks_text_width[a]=this.getBBox().width,this.getBBox().height<t.percentValue*e.chart_height/100?t.name:""}),n=0,l.attr({x1:function(t,a){return e.percent_column_rect_width},y1:function(t,a){return n+=t.percentValue,0===a?(0+n*e.chart_height/100)/2:((n-t.percentValue)*e.chart_height/100+n*e.chart_height/100)/2},x2:function(t,a){return e.percent_column_rect_width},y2:function(t,a){return o+=t.percentValue,0===a?(0+o*e.chart_height/100)/2:((o-t.percentValue)*e.chart_height/100+o*e.chart_height/100)/2},"stroke-width":e.pointer_thickness+"px",stroke:e.pointer_color,x2:function(t,a){return t.percentValue*e.chart_height/100>i[a]?e.percent_column_rect_width+10:e.percent_column_rect_width}})}PykCharts["boolean"](e.pointer_overflow_enable)&&e.svgContainer.style("overflow","visible");var a,r,n=0,o=0,i=[];n=0,e.ticks_text_width=[];var l=e.group.selectAll(".per-ticks").data(e.new_data);l.enter().append("line").attr("class","per-ticks");var s=e.group.selectAll(".ticks_label").data(e.new_data);return s.enter().append("text").attr("class","ticks_label"),s.attr("class","ticks_label").attr("transform",function(t){return n+=t.percentValue,a=e.percent_column_rect_width+15,r=((n-t.percentValue)*e.chart_height/100+n*e.chart_height/100)/2+5,"translate("+a+","+r+")"}),s.text(function(t){return""}).attr({"font-size":e.pointer_size,"text-anchor":"start",fill:e.pointer_color,"font-family":e.pointer_family,"font-weight":e.pointer_weight,"pointer-events":"none"}),setTimeout(t,e.transitions.duration()),s.exit().remove(),l.exit().remove(),this},clubData:function(){if(PykCharts["boolean"](e.clubdata_enable)){var t=[];if(0!==e.clubdata_always_include_data_points.length){var a=e.clubdata_always_include_data_points.length;for(i=0;i<a;i++)t[i]=e.clubdata_always_include_data_points[i]}var r=[];for(i=0;i<t.length;i++)for(j=0;j<e.data.length;j++)t[i].toUpperCase()===e.data[j].name.toUpperCase()&&r.push(e.data[j]);e.data.sort(function(t,e){return e.weight-t.weight});for(var n=0;r.length<e.clubdata_maximum_nodes-1;){for(i=0;i<t.length;i++)e.data[n].name.toUpperCase()===t[i].toUpperCase()&&n++;r.push(e.data[n]),n++}var o=0;for(j=n;j<e.data.length;j++){for(i=0;i<r.length&&j<e.data.length;i++)e.data[j].name.toUpperCase()===r[i].name.toUpperCase()&&(o+=0,j++,i=-1);j<e.data.length&&(o+=e.data[j].weight)}for(var l=function(t,e){return e.weight-t.weight};r.length>e.clubdata_maximum_nodes;){r.sort(l);r.pop()}var s={name:e.clubdata_text,weight:o,tooltip:e.clubdata_tooltip};r.sort(function(t,e){return e.weight-t.weight}),r.length<e.clubdata_maximum_nodes&&r.push(s),e.new_data=r}else e.data.sort(function(t,e){return e.weight-t.weight}),e.new_data=e.data;return this}};return a}},PykCharts.oneD.percentageBar=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(e){var r=this;r=new PykCharts.validation.processInputs(r,t,"oneDimensionalCharts"),r.percent_row_rect_height=t.percent_row_rect_height?t.percent_row_rect_height:a.oneDimensionalCharts.percent_row_rect_height,r.percent_row_rect_height>100&&(r.percent_row_rect_height=100),r.percent_row_rect_height=2*r.k.__proto__._radiusCalculation(r.percent_row_rect_height),r.chart_height=PykCharts["boolean"](t.chart_height)?t.chart_height:r.percent_row_rect_height+10+r.pointer_size,r.k.validator().validatingDataType(r.chart_height,"chart_height",r.chart_width/2).validatingDataType(r.percent_row_rect_height,"percent_row_rect_height",a.oneDimensionalCharts.percent_row_rect_height),r.stop||(r.k.storeInitialDivHeight(),"default"===r.mode&&r.k.loading(),r.executeData=function(t){var e=r.k.validator().validatingJSON(t),a=r.selector.substring(1,r.selector.length);return r.stop||e===!1?void r.k.remove_loading_bar(a):(r.data=r.k.__proto__._groupBy("oned",t),r.compare_data=r.k.__proto__._groupBy("oned",t),r.k.remove_loading_bar(a),r.clubdata_enable=r.data.length>r.clubdata_maximum_nodes?r.clubdata_enable:"no",void r.render())},PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeData")):r.k.dataSourceFormatIdentification(t.data,r,"executeData"))},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("oned",t),e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",e.refresh_data=e.k.__proto__._groupBy("oned",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().clubData(),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().createChart().label().ticks()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var t=this,e=t.selector.substring(1,t.selector.length),a=e+"_svg";t.fillChart=new PykCharts.Configuration.fillChart(t),t.transitions=new PykCharts.Configuration.transition(t),"default"===t.mode&&t.k.title().backgroundColor(t)["export"](t,"#"+a,"percentageBar").emptyDiv(t.selector).subtitle(),"infographics"===t.mode&&(t.k.backgroundColor(t)["export"](t,"#"+a,"percentageBar").emptyDiv(t.selector),t.new_data=t.data,"shade"===t.color_mode&&(shade_array=t.k.shadeColorConversion(t.shade_color,t.new_data.length),t.new_data.forEach(function(t,e){t.color=shade_array[e]}))),t.k.tooltip(),t.mouseEvent=new PykCharts.Configuration.mouseEvent(t),"default"===t.mode&&(percent_bar=t.optionalFeatures().clubData(),"shade"===t.color_mode&&(shade_array=t.k.shadeColorConversion(t.shade_color,t.new_data.length),t.new_data.forEach(function(t,e){t.color=shade_array[e]}))),t.optionalFeatures().svgContainer(a).createChart().label().ticks(),"default"===t.mode&&t.k.liveData(t).createFooter().lastUpdatedAt().credits().dataSource();var r=0;setTimeout(function(){t.ticks_text_height&&(r=t.ticks_text_height+10),t.k.exportSVG(t,"#"+a,"percentageBar",void 0,void 0,0,r)},t.transitions.duration());var n=t.k.resize(t.svgContainer);t.k.__proto__._ready(n),window.addEventListener("resize",function(e){return t.k.resize(t.svgContainer)})},this.optionalFeatures=function(){var a={createChart:function(){var t=new PykCharts.Configuration.border(e),a=e.new_data.map(function(t){return t.weight});a.sum=function(){for(var t=0,e=0;e<this.length;++e)t+=this[e];return t};var r=a.sum();return e.new_data.forEach(function(t,e){this[e].percentValue=100*t.weight/r},e.new_data),e.chart_data=e.group.selectAll(".per-rect").data(e.new_data),e.chart_data.enter().append("rect").attr("class","per-rect"),e.chart_data.attr({x:0,x:function(t,a){if(0===a)return 0;var r=0,n=e.new_data.slice(0,a);return n.forEach(function(t,e){r+=this[e].percentValue},n),r*e.chart_width/100},width:0,height:function(t){return e.percent_row_rect_height},fill:function(t){return e.fillChart.selectColor(t)},"fill-opacity":1,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},stroke:t.color(),"stroke-width":t.width(),"stroke-dasharray":t.style(),"data-id":function(t,e){return t.name}}).on({mouseover:function(t,a){"default"===e.mode&&(t.tooltip=t.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+t.name+"</tr><tr><td class='tooltip-left-content'>"+e.k.appendUnits(t.weight)+"<td class='tooltip-right-content'>("+t.percentValue.toFixed(1)+"%)</tr></table>",PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(e.selector+" .per-rect",this),e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(t.tooltip))},mouseout:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(e.selector+" .per-rect"),e.mouseEvent.tooltipHide(t))},mousemove:function(t,a){"default"===e.mode&&e.mouseEvent.tooltipPosition(t)},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("width",function(t){return t.percentValue*e.chart_width/100}),e.chart_data.exit().remove(),this},svgContainer:function(t){return e.svgContainer=d3.select(e.selector).append("svg").attr({width:e.chart_width,height:e.chart_height,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height,id:t,"class":"svgcontainer PykCharts-oneD"}),e.group=e.svgContainer.append("g").attr("id","percentageBar"),this},label:function(){function a(){e.chart_text.text(function(t){return t.percentValue.toFixed(1)+"%"}).text(function(t){return this.getBBox().width<.92*(t.percentValue*e.chart_width/100)&&this.getBBox().height<e.percent_row_rect_height?t.percentValue.toFixed(1)+"%":""})}e.chart_text=e.group.selectAll(".per-text").data(e.new_data);var r=0;return e.chart_text.enter().append("text").attr("class","per-text"),e.chart_text.attr({"class":"per-text",y:e.percent_row_rect_height/2+5,x:function(t,a){return r+=t.percentValue,0===a?(0+r*e.chart_width/100)/2:((r-t.percentValue)*e.chart_width/100+r*e.chart_width/100)/2}}),r=0,e.chart_text.text("").attr({fill:function(a){if("shade"===e.color_mode&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color},"text-anchor":"middle","pointer-events":"none"}).style({"font-size":e.label_size+"px","font-weight":e.label_weight,"font-family":e.label_family}),setTimeout(a,e.transitions.duration()),e.chart_text.exit().remove(),this},ticks:function(){function t(){s.text(function(t){return t.name}).text(function(t,a){return i[a]=this.getBBox().width,e.ticks_text_height=this.getBBox().height,this.getBBox().width<t.percentValue*e.chart_width/100?t.name:""}),n=0,l.attr({y1:function(t,a){return e.percent_row_rect_height},x1:function(t,a){return n+=t.percentValue,0===a?(0+n*e.chart_width/100)/2:((n-t.percentValue)*e.chart_width/100+n*e.chart_width/100)/2},y2:function(t,a){return e.percent_row_rect_height},x2:function(t,a){return o+=t.percentValue,0===a?(0+o*e.chart_width/100)/2:((o-t.percentValue)*e.chart_width/100+o*e.chart_width/100)/2},"stroke-width":e.pointer_thickness+"px",stroke:e.pointer_color,y2:function(t,a){return t.percentValue*e.chart_width/100>i[a]?e.percent_row_rect_height+10:e.percent_row_rect_height}}).style("margin-top","10px")}PykCharts["boolean"](e.pointer_overflow_enable)&&e.svgContainer.style("overflow","visible");var a,r,n=0,o=0,i=[];e.ticks_text_height,n=0;var l=e.group.selectAll(".per-ticks").data(e.new_data);l.enter().append("line").attr("class","per-ticks");var s=e.group.selectAll(".ticks_label").data(e.new_data);return s.enter().append("text").attr("class","ticks_label"),s.attr("class","ticks_label").attr("transform",function(t){return n+=t.percentValue,r=e.percent_row_rect_height+e.pointer_size+10,a=((n-t.percentValue)*e.chart_width/100+n*e.chart_width/100)/2,"translate("+a+","+r+")"}),s.text(function(t){return""}).attr({"font-size":e.pointer_size,"text-anchor":"middle",fill:e.pointer_color,"font-family":e.pointer_family,"font-weight":e.pointer_weight,"pointer-events":"none"}),setTimeout(t,e.transitions.duration()),s.exit().remove(),l.exit().remove(),this},clubData:function(){if(PykCharts["boolean"](e.clubdata_enable)){var t=[];if(0!==e.clubdata_always_include_data_points.length){var a=e.clubdata_always_include_data_points.length;for(i=0;i<a;i++)t[i]=e.clubdata_always_include_data_points[i]}var r=[];for(i=0;i<t.length;i++)for(j=0;j<e.data.length;j++)t[i].toUpperCase()===e.data[j].name.toUpperCase()&&r.push(e.data[j]);e.data.sort(function(t,e){return e.weight-t.weight});for(var n=0;r.length<e.clubdata_maximum_nodes-1;){for(i=0;i<t.length;i++)e.data[n].name.toUpperCase()===t[i].toUpperCase()&&n++;r.push(e.data[n]),n++}var o=0;for(j=n;j<e.data.length;j++){for(i=0;i<r.length&&j<e.data.length;i++)e.data[j].name.toUpperCase()===r[i].name.toUpperCase()&&(o+=0,j++,i=-1);j<e.data.length&&(o+=e.data[j].weight)}for(var l=function(t,e){return e.weight-t.weight};r.length>e.clubdata_maximum_nodes;){r.sort(l);r.pop()}var s={name:e.clubdata_text,weight:o,tooltip:e.clubdata_tooltip};r.sort(function(t,e){return e.weight-t.weight}),r.length<e.clubdata_maximum_nodes&&r.push(s),e.new_data=r}else e.data.sort(function(t,e){return e.weight-t.weight}),e.new_data=e.data;return this}};return a}},PykCharts.oneD.pie=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),t.chart_height?(e.chart_height=t.chart_height,e.calculation=void 0):(e.chart_height=e.chart_width,e.calculation="pie"),e.pie_radius_percent=t.pie_radius_percent?t.pie_radius_percent:a.oneDimensionalCharts.pie_radius_percent,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width).validatingDataType(e.pie_radius_percent,"pie_radius_percent",a.oneDimensionalCharts.pie_radius_percent),e.stop||(e.k.storeInitialDivHeight(),e.innerRadiusPercent=0,e.height_translate=e.chart_height/2,e.pie_radius_percent>100&&(e.pie_radius_percent=100),"default"===e.mode&&e.k.loading(),e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("oned",a),e.compare_data=e.k.__proto__._groupBy("oned",a),e.k.remove_loading_bar(n);var o=new PykCharts.oneD.pieFunctions(t,e,"pie");e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))}},PykCharts.oneD.donut=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),t.chart_height?(e.chart_height=t.chart_height,e.calculation=void 0):(e.chart_height=e.chart_width,e.calculation="pie"),e.pie_radius_percent=t.donut_radius_percent?t.donut_radius_percent:a.oneDimensionalCharts.donut_radius_percent,e.innerRadiusPercent=t.donut_inner_radius_percent?t.donut_inner_radius_percent:a.oneDimensionalCharts.donut_inner_radius_percent,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width).validatingDataType(e.pie_radius_percent,"donut_radius_percent",a.oneDimensionalCharts.donut_radius_percent).validatingDataType(e.innerRadiusPercent,"donut_inner_radius_percent",a.oneDimensionalCharts.donut_inner_radius_percent),!e.stop){e.k.storeInitialDivHeight(),e.pie_radius_percent>100&&(e.pie_radius_percent=100),e.innerRadiusPercent>100&&(e.innerRadiusPercent=100);try{if(e.innerRadiusPercent>=e.pie_radius_percent)throw e.innerRadiusPercent=a.oneDimensionalCharts.donut_inner_radius_percent,"donut_inner_radius_percent"}catch(n){e.k.warningHandling(n,"6")}e.stop||("default"===e.mode&&e.k.loading(),e.height_translate=e.chart_height/2,e.show_total_at_center=t.donut_show_total_at_center?t.donut_show_total_at_center.toLowerCase():a.oneDimensionalCharts.donut_show_total_at_center,e.show_total_at_center_size="donut_show_total_at_center_size"in t?t.donut_show_total_at_center_size:a.oneDimensionalCharts.donut_show_total_at_center_size,e.show_total_at_center_color=t.donut_show_total_at_center_color?t.donut_show_total_at_center_color:a.oneDimensionalCharts.donut_show_total_at_center_color,e.show_total_at_center_weight=t.donut_show_total_at_center_weight?t.donut_show_total_at_center_weight:a.oneDimensionalCharts.donut_show_total_at_center_weight,e.show_total_at_center_family=t.donut_show_total_at_center_family?t.donut_show_total_at_center_family:a.oneDimensionalCharts.donut_show_total_at_center_family,e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("oned",a),e.compare_data=e.k.__proto__._groupBy("oned",a),e.k.remove_loading_bar(n);var o=new PykCharts.oneD.pieFunctions(t,e,"donut");e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))}}},PykCharts.oneD.electionPie=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),t.chart_height||void 0===t.chart_height)try{if(void 0===t.chart_height)t.chart_height="";else if(isNaN(t.chart_height))throw t.chart_height="","chart_height"}catch(n){e.k.warningHandling(n)}PykCharts["boolean"](t.chart_height)?(e.chart_height=t.chart_height,e.calculation=void 0,e.height_translate=e.chart_height/2):(e.chart_height=e.chart_width/2,e.calculation="pie",e.height_translate=e.chart_height),e.pie_radius_percent=t.pie_radius_percent?t.pie_radius_percent:a.oneDimensionalCharts.pie_radius_percent;try{if(isNaN(e.pie_radius_percent))throw e.pie_radius_percent=a.oneDimensionalCharts.pie_radius_percent,"pie_radius_percent"}catch(n){e.k.warningHandling(n,"1")}e.stop||(e.k.storeInitialDivHeight(),e.pie_radius_percent>100&&(e.pie_radius_percent=100),"default"===e.mode&&e.k.loading(),e.innerRadiusPercent=0,e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("oned",a),e.compare_data=e.k.__proto__._groupBy("oned",a),e.k.remove_loading_bar(n);var o=new PykCharts.oneD.pieFunctions(t,e,"election pie");e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))}},PykCharts.oneD.electionDonut=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),t.chart_height||void 0===t.chart_height)try{if(void 0===t.chart_height)t.chart_height="";else if(isNaN(t.chart_height))throw t.chart_height="","chart_height"}catch(n){e.k.warningHandling(n)}if(PykCharts["boolean"](t.chart_height)?(e.chart_height=t.chart_height,e.calculation=void 0,e.height_translate=e.chart_height/2):(e.chart_height=e.chart_width/2,e.calculation="pie",e.height_translate=e.chart_height),e.pie_radius_percent=t.donut_radius_percent?t.donut_radius_percent:a.oneDimensionalCharts.donut_radius_percent,e.innerRadiusPercent=t.donut_inner_radius_percent&&t.donut_inner_radius_percent?t.donut_inner_radius_percent:a.oneDimensionalCharts.donut_inner_radius_percent,e.k.validator().validatingDataType(e.pie_radius_percent,"donut_radius_percent",a.oneDimensionalCharts.donut_radius_percent).validatingDataType(e.innerRadiusPercent,"donut_inner_radius_percent",a.oneDimensionalCharts.donut_inner_radius_percent),!e.stop){e.k.storeInitialDivHeight(),e.pie_radius_percent>100&&(e.pie_radius_percent=100),e.innerRadiusPercent>100&&(e.innerRadiusPercent=100);try{if(e.innerRadiusPercent>=e.pie_radius_percent)throw e.innerRadiusPercent=a.oneDimensionalCharts.donut_inner_radius_percent,"donut_inner_radius_percent"}catch(n){e.k.warningHandling(n,"6")}e.stop||("default"===e.mode&&e.k.loading(),e.show_total_at_center=t.donut_show_total_at_center?t.donut_show_total_at_center.toLowerCase():a.oneDimensionalCharts.donut_show_total_at_center,e.show_total_at_center_size="donut_show_total_at_center_size"in t?t.donut_show_total_at_center_size:a.oneDimensionalCharts.donut_show_total_at_center_size,e.show_total_at_center_color=t.donut_show_total_at_center_color?t.donut_show_total_at_center_color:a.oneDimensionalCharts.donut_show_total_at_center_color,e.show_total_at_center_weight=t.donut_show_total_at_center_weight?t.donut_show_total_at_center_weight:a.oneDimensionalCharts.donut_show_total_at_center_weight,e.show_total_at_center_family=t.donut_show_total_at_center_family?t.donut_show_total_at_center_family:a.oneDimensionalCharts.donut_show_total_at_center_family,e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("oned",a),e.compare_data=e.k.__proto__._groupBy("oned",a),e.k.remove_loading_bar(n);var o=new PykCharts.oneD.pieFunctions(t,e,"election donut");e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))}}},PykCharts.oneD.pieFunctions=function(t,e,a){var r=e;r.refresh=function(e){r.executeRefresh=function(t){r.data=r.k.__proto__._groupBy("oned",t),r.clubdata_enable=r.data.length>r.clubdata_maximum_nodes?r.clubdata_enable:"no",r.refresh_data=r.k.__proto__._groupBy("oned",t);var e=r.k.checkChangeInData(r.refresh_data,r.compare_data),a=[];r.compare_data=e[0];var n=e[1];n&&r.k.lastUpdatedAt("liveData"),r.new_data=r.optionalFeatures().clubData(),r.optionalFeatures().createChart(a).label().ticks().centerLabel()},PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeRefresh")):r.k.dataSourceFormatIdentification(t.data,r,"executeRefresh")},this.render=function(){r.count=1;var t=r.selector.substring(1,r.selector.length),e=t+"_svg",n=[];r.fillChart=new PykCharts.Configuration.fillChart(r),r.transitions=new PykCharts.Configuration.transition(r),
"default"===r.mode.toLowerCase()?(r.k.title().backgroundColor(r)["export"](r,"#"+e,a).emptyDiv(r.selector).subtitle(),r.optionalFeatures().svgContainer(e),r.new_data=r.optionalFeatures().clubData(),r.k.createFooter().lastUpdatedAt().credits().dataSource().tooltip(),r.optionalFeatures().set_start_end_angle().createChart(n).label().ticks().centerLabel(),r.k.liveData(r)):"infographics"===r.mode.toLowerCase()&&(r.new_data=r.data,r.k.backgroundColor(r)["export"](r,"#"+e,a).emptyDiv(r.selector),r.optionalFeatures().svgContainer(e).set_start_end_angle().createChart(n).label().ticks().centerLabel(),r.k.tooltip()),r.mouseEvent=new PykCharts.Configuration.mouseEvent(r);var o=0,i=0;setTimeout(function(){r.ticks_text_width.length&&(o=d3.max(r.ticks_text_width,function(t){return t}),i=r.ticks_text_height),r.k.exportSVG(r,"#"+e,a,void 0,void 0,o+20,i+20)},r.transitions.duration());var l=r.k.resize(r.svgContainer);r.k.__proto__._ready(l),window.addEventListener("resize",function(t){return r.k.resize(r.svgContainer)})},r.optionalFeatures=function(){var e={svgContainer:function(t){return r.svgContainer=d3.select(r.selector).append("svg").attr({width:r.chart_width,height:function(){return r.chart_height},preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+r.chart_width+" "+r.chart_height,id:t,"class":"svgcontainer PykCharts-oneD"}),r.group=r.svgContainer.append("g").attr({transform:"translate("+r.chart_width/2+","+r.height_translate+")",id:"pieGroup"}),this},createChart:function(){document.querySelector(r.selector+" #pieGroup").innerHTML=null;var t=new PykCharts.Configuration.border(r);if("shade"===r.color_mode&&(shade_array=r.k.shadeColorConversion(r.shade_color,r.new_data.length),r.new_data.forEach(function(t,e){t.color=shade_array[e]})),"pie"===a.toLowerCase()||"donut"===a.toLowerCase()){r.new_data.sort(function(t,e){return t.weight-e.weight});var e=r.new_data.pop();if(r.new_data.unshift(e),PykCharts["boolean"](r.clubdata_enable)&&"default"===r.mode){for(var n,o,i=0;i<r.new_data.length;i++)if(r.new_data[i].name===r.clubdata_text){n=i,o=r.new_data[i];break}if(n){if(r.new_data.splice(n,1),0===i){var e=r.new_data.pop();r.new_data.splice(0,0,e)}r.new_data.splice(1,0,o)}}}else if(("election pie"==a.toLowerCase()||"election donut"==a.toLowerCase())&&(r.new_data.sort(function(t,e){return e.weight-t.weight}),PykCharts["boolean"](r.clubdata_enable)&&"default"===r.mode)){for(var n,o,i=0;i<r.new_data.length;i++)if(r.new_data[i].name===r.clubdata_text){n=i,o=r.new_data[i];break}n&&(r.new_data.splice(n,1),r.new_data.push(o))}r.sum=0;for(var i=0,l=r.new_data.length;l>i;i++)r.sum+=r.new_data[i].weight;return r.inner_radius=r.k.__proto__._radiusCalculation(r.innerRadiusPercent,r.calculation),r.outer_radius=r.k.__proto__._radiusCalculation(r.pie_radius_percent,r.calculation),r.arc=d3.svg.arc().innerRadius(r.inner_radius).outerRadius(r.outer_radius),r.pie=d3.layout.pie().value(function(t){return t.weight}).sort(null).startAngle(r.start_angle).endAngle(r.end_angle),r.chart_data=r.group.selectAll("path").data(r.pie(r.new_data)),r.chart_data.enter().append("path"),r.chart_data.attr("class","pie"),r.chart_data.attr({fill:function(t,e){return r.fillChart.selectColor(t.data)},"fill-opacity":1,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},stroke:t.color(),"stroke-width":t.width(),"stroke-dasharray":t.style(),"data-id":function(t){return t.data.name}}).on({mouseover:function(t){"default"===r.mode&&(t.data.tooltip=t.data.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+t.data.name+"</tr><tr><td class='tooltip-left-content'>"+r.k.appendUnits(t.data.weight)+"<td class='tooltip-right-content'>("+(100*t.data.weight/r.sum).toFixed(1)+"%) </tr></table>",PykCharts["boolean"](r.chart_onhover_highlight_enable)&&r.mouseEvent.highlight(r.selector+" .pie",this),r.mouseEvent.tooltipPosition(t),r.mouseEvent.tooltipTextShow(t.data.tooltip))},mouseout:function(t){"default"===r.mode&&(PykCharts["boolean"](r.chart_onhover_highlight_enable)&&r.mouseEvent.highlightHide(r.selector+" .pie"),r.mouseEvent.tooltipHide(t))},mousemove:function(t){"default"===r.mode&&r.mouseEvent.tooltipPosition(t)},click:function(t){PykCharts["boolean"](r.click_enable)&&r.addEvents(t.data.name,d3.select(this).attr("data-id"))}}),r.chart_data.transition().delay(function(t,e){return r.transition_duration&&"default"===r.mode?e*r.transition_duration*1e3/r.new_data.length:0}).duration(r.transitions.duration()/r.new_data.length).attrTween("d",function(t){var e=d3.interpolate(t.startAngle,t.endAngle);return function(a){return t.endAngle=e(a),r.arc(t)}}),r.chart_data.exit().remove(),this},label:function(){function e(){r.chart_text.style({"font-weight":r.label_weight,"font-size":r.label_size+"px","font-family":r.label_family}).text(function(t){return(100*t.data.weight/r.sum).toFixed(1)+"%"}).attr({"text-anchor":"middle","pointer-events":"none",dy:5,fill:function(e){if("shade"===r.color_mode&&!t.label_color){var a=r.k.__proto__._colourBrightness(e.data.color);return"light"===a?"black":"white"}return r.label_color}}).text(function(t,e){return"pie"===a.toLowerCase()||"election pie"===a.toLowerCase()?this.getBBox().width<(t.endAngle-t.startAngle)*(r.outer_radius/2)?(100*t.data.weight/r.sum).toFixed(1)+"%":"":this.getBBox().width<Math.abs(t.endAngle-t.startAngle)*r.outer_radius*.9&&this.getBBox().height<.75*(r.outer_radius-r.inner_radius)?(100*t.data.weight/r.sum).toFixed(1)+"%":""}),r.chart_text.exit().remove()}return r.chart_text=r.group.selectAll("text").data(r.pie(r.new_data)),r.chart_text.enter().append("text").attr({"class":"pie-label",transform:function(t){return"translate("+r.arc.centroid(t)+")"}}),r.chart_text.attr("transform",function(t){return"translate("+r.arc.centroid(t)+")"}),r.chart_text.text(""),setTimeout(e,r.transitions.duration()),this},clubData:function(){if(PykCharts["boolean"](r.clubdata_enable)){var t=[];if(0!==r.clubdata_always_include_data_points.length){var e=r.clubdata_always_include_data_points.length;for(i=0;i<e;i++)t[i]=r.clubdata_always_include_data_points[i]}var a=[];for(i=0;i<t.length;i++)for(j=0;j<r.data.length;j++)t[i].toUpperCase()===r.data[j].name.toUpperCase()&&a.push(r.data[j]);r.data.sort(function(t,e){return e.weight-t.weight});for(var n=0;a.length<r.clubdata_maximum_nodes-1;){for(i=0;i<t.length;i++)r.data[n].name.toUpperCase()===t[i].toUpperCase()&&n++;a.push(r.data[n]),n++}var o=0;for(j=n;j<r.data.length;j++){for(i=0;i<a.length&&j<r.data.length;i++)r.data[j].name.toUpperCase()===a[i].name.toUpperCase()&&(o+=0,j++,i=-1);j<r.data.length&&(o+=r.data[j].weight)}for(var l=function(t,e){return e.weight-t.weight};a.length>r.clubdata_maximum_nodes;){a.sort(l);a.pop()}var s={name:r.clubdata_text,weight:o,tooltip:r.clubdata_tooltip};a.sort(function(t,e){return e.weight-t.weight}),a.length<r.clubdata_maximum_nodes&&a.push(s),r.new_data=a}else r.data.sort(function(t,e){return e.weight-t.weight}),r.new_data=r.data;return r.new_data},ticks:function(){function t(){n.text(function(t){return t.data.name}).text(function(t,e){return r.ticks_text_width[e]=this.getBBox().width,r.ticks_text_height=this.getBBox().height,t.data.name}).attr({"text-anchor":function(t){var e=(t.endAngle-t.startAngle)/2+t.startAngle;return e>0&&2>e?"start":e>=1.5&&3.5>e?"middle":e>=3.5&&6>e?"end":e>=6?"middle":"election pie"===a||"election donut"===a&&-1>e?"end":0>e?"middle":void 0},dy:5,"pointer-events":"none"}).style({fill:r.pointer_color,"font-size":r.pointer_size+"px","font-weight":r.pointer_weight,"font-family":r.pointer_family,display:function(t){return console.log(t.data.name,Math.abs(t.startAngle-t.endAngle)),Math.abs(t.startAngle-t.endAngle)>=.13?"block":"none"}}),n.exit().remove()}function e(){l.attr({x2:function(t,e){return 1*(r.outer_radius/1+12)*Math.cos((t.startAngle+t.endAngle)/2)},y2:function(t,e){return 1*(r.outer_radius/1+12)*Math.sin((t.startAngle+t.endAngle)/2)},transform:"rotate(-90)","stroke-width":r.pointer_thickness+"px",stroke:r.pointer_color}),l.exit().remove()}PykCharts["boolean"](r.pointer_overflow_enable)&&r.svgContainer.style("overflow","visible");r.ticks_text_width=[];var n=r.group.selectAll(".ticks_label").data(r.pie(r.new_data));n.attr("class","ticks_label"),n.enter().append("text").attr({x:0,y:0});var o,i;n.attr("transform",function(t){return t.endAngle-t.startAngle<.2?(o=1*(r.outer_radius+30)*Math.cos((t.startAngle+t.endAngle-Math.PI)/2),i=1*(r.outer_radius/1+20)*Math.sin((t.startAngle+t.endAngle-Math.PI)/2)):(o=1*(r.outer_radius+22)*Math.cos((t.startAngle+t.endAngle-Math.PI)/2),i=1*(r.outer_radius/1+24)*Math.sin((t.startAngle+t.endAngle-Math.PI)/2)),"translate("+o+","+i+")"}),n.text(""),setTimeout(t,r.transitions.duration());var l=r.group.selectAll("line").data(r.pie(r.new_data));return l.enter().append("line").attr("class","ticks"),l.attr({x1:function(t,e){return 1*r.outer_radius*Math.cos((t.startAngle+t.endAngle)/2)},y1:function(t,e){return 1*r.outer_radius*Math.sin((t.endAngle+t.startAngle)/2)},x2:function(t,e){return 1*r.outer_radius*Math.cos((t.startAngle+t.endAngle)/2)},y2:function(t,e){return 1*r.outer_radius*Math.sin((t.endAngle+t.startAngle)/2)}}),l.style("display",function(t){return Math.abs(t.startAngle-t.endAngle)>=.13?"block":"none"}),setTimeout(e,r.transitions.duration()),this},centerLabel:function(){function t(){n.text(function(t){return r.k.appendUnits(r.sum)}).text(function(t){return e=this.getBBox().height,r.k.appendUnits(r.sum)}).attr({"pointer-events":"none","text-anchor":"middle",y:function(){return"donut"===a?e/2:-.25*r.inner_radius},fill:r.show_total_at_center_color}).style({"font-family":r.show_total_at_center_family,"font-weight":r.show_total_at_center_weight,"font-size":r.show_total_at_center_size+"px"})}if(PykCharts["boolean"](r.show_total_at_center)&&("donut"===a||"election donut"===a)){var e,n=r.group.selectAll(r.selector+" .centerLabel").data([r.sum]);n.enter().append("text"),n.attr("class","centerLabel").text(""),setTimeout(t,r.transitions.duration()),n.exit().remove()}return this},set_start_end_angle:function(){return r.startAngle,r.endAngle,"pie"===a||"donut"===a?(r.start_angle=0*(Math.PI/180),r.end_angle=360*(Math.PI/180)):("election pie"===a||"election donut"===a)&&(r.start_angle=-90*(Math.PI/180),r.end_angle=90*(Math.PI/180)),this}};return e}},PykCharts.oneD.pyramid=function(t){var e=this;e.interval="";new PykCharts.Configuration.Theme({});this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),e.chart_height=t.chart_height?t.chart_height:e.chart_width,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width),e.stop||(e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("oned",t),e.data_length=e.data.length,e.compare_data=e.k.__proto__._groupBy("oned",t),e.k.remove_loading_bar(r),e.clubdata_enable=e.data_length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("oned",t),e.data_length=e.data.length,e.clubdata_enable=e.data_length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",e.refresh_data=e.k.__proto__._groupBy("oned",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.new_data=e.optionalFeatures().clubData(),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),shade_array.reverse(),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().createChart().label().ticks()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var t=e.selector.substring(1,e.selector.length),a=t+"_svg";e.fillChart=new PykCharts.Configuration.fillChart(e),e.transitions=new PykCharts.Configuration.transition(e),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+a,"pyramid").emptyDiv(e.selector).subtitle(),e.new_data=e.optionalFeatures().clubData(),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),shade_array.reverse(),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().svgContainer(a).createChart().label().ticks(),e.k.createFooter().lastUpdatedAt().credits().dataSource().tooltip().liveData(e),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e)):"infographics"===e.mode&&(e.new_data=e.data,"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.length),shade_array.reverse(),e.new_data.forEach(function(t,e){t.color=shade_array[e]})),e.k.backgroundColor(e)["export"](e,"#"+a,"pyramid").emptyDiv(e.selector),e.optionalFeatures().svgContainer(a).createChart().label().ticks(),e.k.tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e));var r=0;setTimeout(function(){e.ticks_text_width.length&&(r=d3.max(e.ticks_text_width,function(t){return t})),e.k.exportSVG(e,"#"+a,"pyramid",void 0,void 0,r)},e.transitions.duration());var n=e.k.resize(e.svgContainer);e.k.__proto__._ready(n),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.percentageValues=function(t){e.sum=d3.sum(t,function(t){return t.weight});var a=t.map(function(t){return t.weight/e.sum*100});return a.sort(function(t,e){return e-t}),a},this.pyramidLayout=function(){var t,a,r={data:function(e){return 0!==e.length&&(t=e),this},size:function(t){return 2===t.length&&(a=t),this},coordinates:function(r){function n(t){return d3.sum(s,function(e,a){return a>=t?e:void 0})}for(var o=a[0],i=a[1],l=o/2/i,s=e.percentageValues(t),_=[],c=o*i/2,d=0,u=t.length;u>d;d++){var h=n(d),p=h/100*c,g=Math.sqrt(p/l),m=2*l*g,f=(o-m)/2;0===d?_[d]={values:[{x:o/2,y:0},{x:f,y:g},{x:m+f,y:g}]}:_[d]={values:[_[d-1].values[1],{x:f,y:g},{x:m+f,y:g},_[d-1].values[2]]}}return _}};return r},this.optionalFeatures=function(){var a={svgContainer:function(t){return e.svgContainer=d3.select(e.selector).append("svg").attr({width:e.chart_width,height:e.chart_height,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height,id:t,"class":"svgcontainer PykCharts-oneD"}),e.group=e.svgContainer.append("g").attr("id","pyrgrp"),this},createChart:function(){var t=new PykCharts.Configuration.border(e);e.pyramid=e.pyramidLayout().data(e.new_data).size([e.chart_width,e.chart_height]),e.coordinates=e.pyramid.coordinates(),e.coordinates[0].values[1]=e.coordinates[e.coordinates.length-1].values[1],e.coordinates[0].values[2]=e.coordinates[e.coordinates.length-1].values[2];for(var a=e.new_data.length-1,r=(e.new_data.length-1,[]),n=0,o=e.new_data.length;o>n;n++)0==n?r[n]=e.new_data[n].tooltip||"<table class='PykCharts'><tr><th colspan='2'  class='tooltip-heading'>"+e.new_data[n].name+"</tr><tr><td class='tooltip-left-content'>"+e.k.appendUnits(e.new_data[n].weight)+"<td class='tooltip-right-content'>("+(100*e.new_data[n].weight/e.sum).toFixed(1)+"%) </tr></table>":(r[n]=e.new_data[a].tooltip||"<table class='PykCharts'><tr><th colspan='2'  class='tooltip-heading'>"+e.new_data[a].name+"</tr><tr><td class='tooltip-left-content'>"+e.k.appendUnits(e.new_data[a].weight)+"<td class='tooltip-right-content'>("+(100*e.new_data[a].weight/e.sum).toFixed(1)+"%) </tr></table>",a--);var i,l=d3.svg.line().interpolate("linear-closed").x(function(t,e){return t.x}).y(function(t,e){return t.y}),s=[{x:0,y:e.chart_height},{x:e.chart_width,y:e.chart_height},{x:0,y:e.chart_height},{x:e.chart_width,y:e.chart_height},{x:0,y:e.chart_height},{x:e.chart_width,y:e.chart_height}],a=e.new_data.length;return e.chart_data=e.group.selectAll(".pyr-path").data(e.coordinates),e.chart_data.enter().append("path"),e.chart_data.attr({"class":"pyr-path",d:function(t){return l(s)},stroke:t.color(),"stroke-width":t.width(),"stroke-dasharray":t.style(),fill:function(t,r){return 0===r?(i=e.new_data[r],t.color=e.new_data[r].color):(a--,i=e.new_data[a],t.color=e.new_data[a].color),e.fillChart.selectColor(i)},"fill-opacity":1,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},"data-id":function(t,a){return e.new_data[a].name}}).on({mouseover:function(t,a){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(e.selector+" .pyr-path",this),e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(r[a]))},mouseout:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(e.selector+" .pyr-path"),e.mouseEvent.tooltipHide(t))},mousemove:function(t,a){"default"===e.mode&&e.mouseEvent.tooltipPosition(t)},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(e.new_data[a].name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("d",function(t){return l(t.values)}),e.chart_data.exit().remove(),this},label:function(){function a(){e.chart_text.text(function(t,a){return 0===a?(100*e.new_data[a].weight/e.sum).toFixed(1)+"%":(r--,(100*e.new_data[r].weight/e.sum).toFixed(1)+"%")}).text(function(t,a){return this.getBBox().width<t.values[2].x-t.values[1].x&&this.getBBox().height<Math.abs(t.values[1].y-t.values[0].y)?0===a?(100*e.new_data[a].weight/e.sum).toFixed(1)+"%":(n--,(100*e.new_data[n].weight/e.sum).toFixed(1)+"%"):""})}var r=e.new_data.length,n=e.new_data.length;return e.chart_text=e.group.selectAll("text").data(e.coordinates),e.chart_text.enter().append("text"),e.chart_text.attr({"text-anchor":"middle","pointer-events":"none",fill:function(a){if("shade"===e.color_mode&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color},y:function(t,a){return 4===t.values.length?(t.values[0].y-t.values[1].y)/2+t.values[1].y+5:(t.values[0].y+e.coordinates[e.coordinates.length-1].values[1].y)/2+10},x:function(t,a){return e.chart_width/2}}).text("").style({"font-weight":e.label_weight,"font-size":e.label_size+"px","font-family":e.label_family}),setTimeout(a,e.transitions.duration()),e.chart_text.exit().remove(),this},ticks:function(){function t(){r.text(function(t,a){return 0===a?e.new_data[a].name:(s--,e.new_data[s].name)}).text(function(t,a){return 0===a?(i[a]=this.getBBox().height,e.ticks_text_width[a]=this.getBBox().width,this.getBBox().height<t.values[1].y-t.values[0].y?e.new_data[a].name:""):(i[a]=this.getBBox().height,this.getBBox().height<t.values[0].y-t.values[1].y?(l--,e.new_data[l].name):"")}).style({fill:e.pointer_color,"font-size":e.pointer_size+"px","font-family":e.pointer_family,"font-weight":e.pointer_weight}).attr("text-anchor","start")}function a(){_.attr("x2",function(t,a){return Math.abs(t.values[0].y-t.values[1].y)>i[a]?3===t.values.length?(t.values[0].x+e.coordinates[e.coordinates.length-1].values[2].x)/2+12:(t.values[2].x+t.values[3].x)/2+12:3===t.values.length?(t.values[0].x+e.coordinates[e.coordinates.length-1].values[2].x)/2:(t.values[2].x+t.values[3].x)/2})}PykCharts["boolean"](e.pointer_overflow_enable)&&e.svgContainer.style("overflow","visible");var r=e.group.selectAll(".ticks_label").data(e.coordinates);r.enter().append("text").attr({x:0,y:0,"class":"ticks_label"});var n,o,i=[];e.ticks_text_width=[];var l=e.new_data.length,s=e.new_data.length;r.attr("transform",function(t){return n=3===t.values.length?(t.values[0].x+e.coordinates[e.coordinates.length-1].values[2].x)/2+17:(t.values[2].x+t.values[3].x)/2+17,o=4===t.values.length?(t.values[0].y-t.values[1].y)/2+t.values[1].y+2:(t.values[0].y+e.coordinates[e.coordinates.length-1].values[1].y)/2,"translate("+n+","+(o+5)+")"}),r.text(""),setTimeout(t,e.transitions.duration()),r.exit().remove();var _=e.group.selectAll(".pyr-ticks").data(e.coordinates);return _.enter().append("line").attr("class","pyr-ticks"),_.attr({x1:function(t,a){return 3===t.values.length?(t.values[0].x+e.coordinates[e.coordinates.length-1].values[2].x)/2:(t.values[2].x+t.values[3].x)/2},y1:function(t,a){return 4===t.values.length?(t.values[0].y-t.values[1].y)/2+t.values[1].y+2:(t.values[0].y+e.coordinates[e.coordinates.length-1].values[1].y)/2},x2:function(t,a){return 3===t.values.length?(t.values[0].x+e.coordinates[e.coordinates.length-1].values[2].x)/2:(t.values[2].x+t.values[3].x)/2},y2:function(t,a){return 4===t.values.length?(t.values[0].y-t.values[1].y)/2+t.values[1].y+2:(t.values[0].y+e.coordinates[e.coordinates.length-1].values[1].y)/2},"stroke-width":e.pointer_thickness+"px",stroke:e.pointer_color}),setTimeout(a,e.transitions.duration()),_.exit().remove(),this},clubData:function(){if(PykCharts["boolean"](e.clubdata_enable)){var t=[];if(0!==e.clubdata_always_include_data_points.length){var a=e.clubdata_always_include_data_points.length;for(i=0;i<a;i++)t[i]=e.clubdata_always_include_data_points[i]}var r=[];for(i=0;i<t.length;i++)for(j=0;j<e.data.length;j++)t[i].toUpperCase()===e.data[j].name.toUpperCase()&&r.push(e.data[j]);e.data.sort(function(t,e){return e.weight-t.weight});for(var n=0;r.length<e.clubdata_maximum_nodes-1;){for(i=0;i<t.length;i++)e.data[n].name.toUpperCase()===t[i].toUpperCase()&&n++;r.push(e.data[n]),n++}var o=0;for(j=n;j<e.data.length;j++){for(i=0;i<r.length&&j<e.data.length;i++)e.data[j].name.toUpperCase()===r[i].name.toUpperCase()&&(o+=0,j++,i=-1);j<e.data.length&&(o+=e.data[j].weight)}for(var l=function(t,e){return e.weight-t.weight};r.length>e.clubdata_maximum_nodes;){r.sort(l);r.pop()}var s={name:e.clubdata_text,weight:o,tooltip:e.clubdata_tooltip};r.sort(function(t,e){return t.weight-e.weight}),r.length<e.clubdata_maximum_nodes&&r.push(s),e.new_data=r}else e.data.sort(function(t,e){return t.weight-e.weight}),e.new_data=e.data;return e.new_data}};return a}},PykCharts.oneD.treemap=function(t){var e=this;e.interval="";new PykCharts.Configuration.Theme({});this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"oneDimensionalCharts"),optional=t.optional,e.chart_height=t.chart_height?t.chart_height:e.chart_width,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width),e.stop||(e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("oned",t),e.compare_data=e.k.__proto__._groupBy("oned",t),e.k.remove_loading_bar(r),e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("oned",t),e.clubdata_enable=e.data.length>e.clubdata_maximum_nodes?e.clubdata_enable:"no",e.refresh_data=e.k.__proto__._groupBy("oned",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().clubData(),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.children.length),e.new_data.children.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().createChart().label()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var t=e.selector.substring(1,e.selector.length),a=t+"_svg";e.fillChart=new PykCharts.Configuration.fillChart(e),e.transitions=new PykCharts.Configuration.transition(e),"default"===e.mode&&e.k.title().backgroundColor(e)["export"](e,"#"+a,"treemap").emptyDiv(e.selector).subtitle(),e.k.tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+a,"treemap").emptyDiv(e.selector),e.new_data={children:e.data}),"default"===e.mode&&e.optionalFeatures().clubData(),"shade"===e.color_mode&&(shade_array=e.k.shadeColorConversion(e.shade_color,e.new_data.children.length),e.new_data.children.forEach(function(t,e){t.color=shade_array[e]})),e.optionalFeatures().svgContainer(a).createChart().label(),"default"===e.mode&&e.k.liveData(e).createFooter().lastUpdatedAt().credits().dataSource(),e.k.exportSVG(e,"#"+a,"treemap");var r=e.k.resize(e.svgContainer);e.k.__proto__._ready(r),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.optionalFeatures=function(){var a={svgContainer:function(t){return e.svgContainer=d3.select(e.selector).append("svg:svg").attr({width:e.chart_width,height:e.chart_height,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height,id:t,"class":"svgcontainer PykCharts-oneD"}),e.group=e.svgContainer.append("g").attr("id","treemap"),this},createChart:function(){e.treemap=d3.layout.treemap().sort(function(t,e){return t.weight-e.weight}).size([e.chart_width,e.chart_height]).value(function(t){return t.weight}).sticky(!1),e.sum=d3.sum(e.new_data.children,function(t){return t.weight});var t;return e.node=e.treemap.nodes(e.new_data),t=e.new_data.children.length,e.chart_data=e.group.selectAll(".cell").data(e.node),e.chart_data.enter().append("svg:g").attr("class","cell").append("svg:rect").attr("class","treemap-rect"),e.chart_data.attr("class","cell").select("rect").attr({"class":"treemap-rect",id:function(t,e){return"rect"+e},x:function(t){return t.x},y:function(t){return t.y},width:function(t){return t.dx-1},height:0,fill:function(t){return t.children?"white":e.fillChart.selectColor(t)},"fill-opacity":1,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},"data-id":function(t,e){return t.name}}).on({mouseover:function(t){t.children||"default"!==e.mode||(t.tooltip=t.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+t.name+"</tr><tr><td class='tooltip-left-content'>"+e.k.appendUnits(t.weight)+"<td class='tooltip-right-content'>("+(100*t.weight/e.sum).toFixed(1)+"%)</tr></table>",PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(e.selector+" .treemap-rect",this),e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(t.tooltip))},mouseout:function(t){"default"===e.mode&&(e.mouseEvent.tooltipHide(t),PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(e.selector+" .treemap-rect"))},mousemove:function(t){t.children||"default"!==e.mode||e.mouseEvent.tooltipPosition(t)},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("height",function(t){return t.dy-1}),e.chart_data.exit().remove(),this},label:function(){function a(){e.chart_text.text(function(t){return t.children?" ":t.name}).attr("pointer-events","none").text(function(t){return this.getBBox().width<t.dx&&this.getBBox().height<t.dy-15?t.children?" ":t.name:""})}function r(){e.chart_text1.text(function(t){return t.children?" ":e.k.appendUnits(t.weight)}).text(function(t){return this.getBBox().width<t.dx&&this.getBBox().height<t.dy-15?t.children?" ":(100*t.weight/e.sum).toFixed(1)+"%":""})}return e.chart_text=e.group.selectAll(".name").data(e.node),e.chart_text1=e.group.selectAll(".weight").data(e.node),e.chart_text.enter().append("svg:text").attr("class","name"),e.chart_text1.enter().append("svg:text").attr("class","weight"),e.chart_text.attr({"class":"name",x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2}}),e.chart_text1.attr({"class":"weight",x:function(t){return t.x+t.dx/2},y:function(t){return t.y+t.dy/2+e.label_size}}),e.chart_text.attr({"text-anchor":"middle",fill:function(a){if("shade"===e.color_mode&&!a.children&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color}}).style({"font-weight":e.label_weight,"font-size":e.label_size+"px","font-family":e.label_family}).text(""),setTimeout(a,e.transitions.duration()),e.chart_text1.attr({"text-anchor":"middle",fill:function(a){if("shade"===e.color_mode&&!a.children&&!t.label_color){var r=e.k.__proto__._colourBrightness(a.color);return"light"===r?"black":"white"}return e.label_color},"pointer-events":"none"}).style({"font-weight":e.label_weight,"font-size":e.label_size+"px","font-family":e.label_family}).text(""),setTimeout(r,e.transitions.duration()),e.chart_text.exit().remove(),e.chart_text1.exit().remove(),this},clubData:function(){if(PykCharts["boolean"](e.clubdata_enable)){var t=[],a=0,r=0;if(e.data.length<=e.clubdata_maximum_nodes)return e.new_data={children:e.data},this;if(0!==e.clubdata_always_include_data_points.length){var n=e.clubdata_always_include_data_points.length;for(i=0;i<n;i++)t[i]=e.clubdata_always_include_data_points[i]}var o=[];for(i=0;i<t.length;i++)for(j=0;j<e.data.length;j++)t[i].toUpperCase()===e.data[j].name.toUpperCase()&&o.push(e.data[j]);for(e.data.sort(function(t,e){return e.weight-t.weight});o.length<e.clubdata_maximum_nodes-1;){for(i=0;i<t.length;i++)e.data[r].name.toUpperCase()===t[i].toUpperCase()&&r++;o.push(e.data[r]),r++}for(j=r;j<e.data.length;j++){for(i=0;i<o.length&&j<e.data.length;i++)e.data[j].name.toUpperCase()===o[i].name.toUpperCase()&&(a+=0,j++,i=-1);j<e.data.length&&(a+=e.data[j].weight)}for(var l=function(t,e){return e.weight-t.weight};o.length>e.clubdata_maximum_nodes;){o.sort(l);o.pop()}var s={name:e.clubdata_text,weight:a,color:e.clubData_color,tooltip:e.clubData_tooltip};o.length<e.clubdata_maximum_nodes&&o.push(s),e.new_data={children:o}}else e.new_data={children:e.data};return this}};return a}},PykCharts.other.pictograph=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(){e=new PykCharts.validation.processInputs(e,t,"other");var r=(t.optional,a.otherCharts);e.pictograph_show_all_images=t.pictograph_show_all_images?t.pictograph_show_all_images.toLowerCase():r.pictograph_show_all_images,e.pictograph_total_count_enable=t.pictograph_total_count_enable?t.pictograph_total_count_enable.toLowerCase():r.pictograph_total_count_enable,e.pictograph_current_count_enable=t.pictograph_current_count_enable?t.pictograph_current_count_enable.toLowerCase():r.pictograph_current_count_enable,e.pictograph_image_per_line=t.pictograph_image_per_line?t.pictograph_image_per_line:r.pictograph_image_per_line,e.pictograph_current_count_size=t.pictograph_current_count_size?t.pictograph_current_count_size:r.pictograph_current_count_size,e.pictograph_current_count_color=t.pictograph_current_count_color?t.pictograph_current_count_color:r.pictograph_current_count_color,e.pictograph_current_count_weight=t.pictograph_current_count_weight?t.pictograph_current_count_weight.toLowerCase():r.pictograph_current_count_weight,e.pictograph_current_count_family=t.pictograph_current_count_family?t.pictograph_current_count_family.toLowerCase():r.pictograph_current_count_family,e.pictograph_total_count_size=t.pictograph_total_count_size?t.pictograph_total_count_size:r.pictograph_total_count_size,e.pictograph_total_count_color=t.pictograph_total_count_color?t.pictograph_total_count_color:r.pictograph_total_count_color,e.pictograph_total_count_weight=t.pictograph_total_count_weight?t.pictograph_total_count_weight.toLowerCase():r.pictograph_total_count_weight,e.pictograph_total_count_family=t.pictograph_total_count_family?t.pictograph_total_count_family.toLowerCase():r.pictograph_total_count_family,e.pictograph_image_width=t.pictograph_image_width?t.pictograph_image_width:r.pictograph_image_width,e.pictograph_image_height=t.pictograph_image_height?t.pictograph_image_height:r.pictograph_image_height,
e.pictograph_units_per_image=t.pictograph_units_per_image?t.pictograph_units_per_image:"",e.pictograph_units_per_image_text_family=t.pictograph_units_per_image_text_family?t.pictograph_units_per_image_text_family.toLowerCase():r.pictograph_units_per_image_text_family,e.pictograph_units_per_image_text_size=t.pictograph_units_per_image_text_size?t.pictograph_units_per_image_text_size:r.pictograph_units_per_image_text_size,e.pictograph_units_per_image_text_color=t.pictograph_units_per_image_text_color?t.pictograph_units_per_image_text_color:r.pictograph_units_per_image_text_color,e.pictograph_units_per_image_text_weight=t.pictograph_units_per_image_text_weight?t.pictograph_units_per_image_text_weight.toLowerCase():r.pictograph_units_per_image_text_weight,e.chart_height=t.chart_height?t.chart_height:e.chart_width,e.k.validator().validatingDataType(e.chart_height,"chart_height",e.chart_width).validatingDataType(e.pictograph_units_per_image_text_size,"pictograph_units_per_image_text_size",r.pictograph_units_per_image_text_size).validatingDataType(e.pictograph_current_count_size,"pictograph_current_count_size",r.pictograph_current_count_size).validatingDataType(e.pictograph_total_count_size,"pictograph_total_count_size",r.pictograph_total_count_size).validatingDataType(e.pictograph_image_width,"pictograph_image_width",r.pictograph_image_width).validatingDataType(e.pictograph_image_height,"pictograph_image_height",r.pictograph_image_height).validatingDataType(e.pictograph_image_per_line,"pictograph_image_per_line",r.pictograph_image_per_line).validatingFontWeight(e.pictograph_current_count_weight,"pictograph_current_count_weight",r.pictograph_current_count_weight).validatingFontWeight(e.pictograph_total_count_weight,"pictograph_total_count_weight",r.pictograph_total_count_weight).validatingFontWeight(e.pictograph_units_per_image_text_weight,"pictograph_units_per_image_text_weight",r.pictograph_units_per_image_text_weight).validatingColor(e.pictograph_current_count_color,"pictograph_current_count_color",r.pictograph_current_count_color).validatingColor(e.pictograph_total_count_color,"pictograph_total_count_color",r.pictograph_total_count_color).validatingColor(e.pictograph_units_per_image_text_color,"pictograph_units_per_image_text_color",r.pictograph_units_per_image_text_color),e.stop||(e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=t.sort(function(t,e){return e.weight-t.weight}),e.old_weight=0,e.compare_data=e.data,e.k.remove_loading_bar(r),void e.render())},e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},this.refresh=function(){e.executeRefresh=function(t){e.old_data=e.data,e.old_weight=e.weight;var a=e.k.validator().validatingJSON(t);if(!e.stop&&a!==!1){e.data=t.sort(function(t,e){return e.weight-t.weight}),e.refresh_data=e.data;var r=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=r[0];var n=r[1];n&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().labelText().enableLabel().createChart()}},e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){var t=e.selector.substring(1,e.selector.length),a=t+"_svg";e.transitions=new PykCharts.Configuration.transition(e),"default"===e.mode?e.k.title().backgroundColor(e)["export"](e,"#"+a,"pictograph").emptyDiv().subtitle().liveData(e):e.k.backgroundColor(e)["export"](e,"#"+a,"pictograph").emptyDiv(),e.optionalFeatures().svgContainer(a).labelText().enableLabel(),PykCharts["boolean"](e.pictograph_units_per_image)&&e.optionalFeatures().appendUnits(),e.optionalFeatures().createChart(),"default"===e.mode&&e.k.createFooter().lastUpdatedAt().credits().dataSource(),e.k.exportSVG(e,"#"+a,"pictograph");var r=e.k.resize(e.svgContainer);e.k.__proto__._ready(r),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.optionalFeatures=function(){var t={svgContainer:function(t){return e.svgContainer=d3.select(e.selector).append("svg").attr({width:e.chart_width,id:t,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height}),e.group=e.svgContainer.append("g").attr("id","pictograph_image_group"),e.group1=e.svgContainer.append("g").attr("transform","translate(0,0)"),PykCharts["boolean"](e.pictograph_units_per_image)&&(e.group2=e.svgContainer.append("g").attr("id","units-per-image")),this},createChart:function(){var t=0,a=0;e.optionalFeatures().showTotal();var r=0;e.textWidth||(e.textWidth=0),e.totalTxtWeight||(e.totalTxtWeight=0);var n=e.textWidth+e.totalTxtWeight+25;e.total_unit_width>n&&(n=e.total_unit_width+10),e.group.attr("transform","translate("+n+",0)");for(var o=1;o<=e.weight;o++){o<=e.data[1].weight?(!e.old_data||e.old_data&&o>e.old_data[1].weight)&&(e.group.append("image").attr({"xlink:href":e.data[1].image,id:"current_image"+o,x:a*(e.pictograph_image_width+1),y:t*(e.pictograph_image_height+10),width:0,height:e.pictograph_image_height+"px"}).transition().duration(e.transitions.duration()).attr("width",e.pictograph_image_width+"px"),setTimeout(function(){var t=d3.selectAll("#total_image"+o);t&&t.remove()},e.transitions.duration())):(o>e.old_weight&&e.weight>e.old_weight||e.old_data&&o<=e.old_data[1].weight)&&e.group.append("image").attr({"xlink:href":e.data[0].image,id:"total_image"+o,x:a*(e.pictograph_image_width+1),y:t*(e.pictograph_image_height+10),width:0,height:e.pictograph_image_height+"px"}).transition().duration(e.transitions.duration()).attr("width",e.pictograph_image_width+"px"),r++,a++,r>=e.pictograph_image_per_line&&(t++,a=0,r=0);var i=e.group.node().getBBox().height;o===+e.weight&&0!=i?(e.chart_height=i,e.svgContainer.attr({height:i,viewBox:"0 0 "+e.chart_width+" "+i})):e.svgContainer.attr({height:i,viewBox:"0 0 "+e.chart_width+" "+e.chart_height})}return setTimeout(function(){if(e.old_data&&e.old_data[1].weight>e.data[1].weight)for(var t=e.old_data[1].weight;t>e.data[1].weight;t--){var a=d3.selectAll("#current_image"+t);a&&a.remove()}if(e.old_data&&e.old_data[0].weight>e.data[0].weight)for(var t=e.old_data[0].weight;t>e.data[0].weight;t--){var r=d3.selectAll("#total_image"+t);r&&r.remove()}},e.transitions.duration()),e.pictograph_image_width*e.pictograph_image_per_line+n>e.chart_width&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px","Your Lable text size and image width exceeds the chart conatiner width"),this},showTotal:function(){return PykCharts["boolean"](e.pictograph_show_all_images)?e.weight=e.data[0].weight:e.weight=e.data[1].weight,this},enableLabel:function(){if(PykCharts["boolean"](e.pictograph_total_count_enable)){var t=d3.selectAll(e.selector+" .PykCharts-current-text");t.length>0&&t.remove(),e.textWidth||(e.textWidth=0);e.data[0].weight/e.pictograph_image_per_line;e.group1.append("text").attr({"class":"PykCharts-current-text","font-family":e.pictograph_total_count_family,"font-size":e.pictograph_total_count_size,"font-weight":e.pictograph_total_count_weight,fill:e.pictograph_total_count_color}).text("/"+e.data[0].weight).text(function(){return e.textHeight=this.getBBox().height,e.totalTxtWeight=this.getBBox().width,"/"+e.data[0].weight}).attr({x:e.textWidth+5,y:function(){return e.textHeight-10}})}return this},labelText:function(){if(PykCharts["boolean"](e.pictograph_current_count_enable)){var t=d3.selectAll(e.selector+" .PykCharts-total-text");t.length>0&&t.remove();e.data[0].weight/e.pictograph_image_per_line;e.group1.append("text").attr({x:0,"class":"PykCharts-total-text","font-family":e.pictograph_current_count_family,"font-size":e.pictograph_current_count_size,"font-weight":e.pictograph_current_count_weight,fill:e.pictograph_current_count_color}).text(e.data[1].weight).text(function(){return e.textHeight=this.getBBox().height,e.textWidth=this.getBBox().width,e.data[1].weight}).attr("y",function(){return e.textHeight-10})}return this},appendUnits:function(){e.textHeight||(e.textHeight=0);var t,a,r,n;return e.group2.attr("transform","translate(0,"+(e.textHeight+15)+")"),e.group2.append("text").attr({x:0,"class":"PykCharts-unit-text","font-family":e.pictograph_units_per_image_text_family,"font-size":e.pictograph_units_per_image_text_size,"font-weight":e.pictograph_units_per_image_text_weight,fill:e.pictograph_units_per_image_text_color}).text(function(){return"1 "}).text(function(){return n=this.getBBox().height,t=this.getBBox().width,"1 "}).attr({dy:0,y:n-5}),e.group2.append("image").attr({"xlink:href":e.data[1].image,id:"unit-image",x:t+2+"px",y:0,height:n+"px",width:n+"px"}),a=d3.select(e.selector+" #unit-image").attr("width"),e.group2.append("text").attr({x:function(){return parseFloat(a)+t+4},"class":"PykCharts-unit-text","font-family":e.pictograph_units_per_image_text_family,"font-size":e.pictograph_units_per_image_text_size,"font-weight":e.pictograph_units_per_image_text_weight,fill:e.pictograph_units_per_image_text_color}).text(function(){return"= "+e.pictograph_units_per_image}).text(function(){return r=this.getBBox().width,"= "+e.pictograph_units_per_image}).attr("y",function(){return n-5}),e.total_unit_width=t+parseFloat(a)+r+4,this}};return t}},PykCharts.multiD={};var theme=new PykCharts.Configuration.Theme({});PykCharts.multiD.configuration=function(t){var e=(new PykCharts.Configuration.fillChart(t),{opacity:function(e,a,r){if(PykCharts["boolean"](t.variable_circle_size_enable))return.8;var n=d3.scale.linear().domain(d3.extent(r,function(t){return t.weight})).range([.3,1]);return n(e?e:Math.min.apply(null,a))},legendsPosition:function(t,e,a,r,n){var o,i=0,l=0;if("vertical"===t.legends_display){t.legendsGroup.attr("height",30*a.length+20),t.legendsGroup_height=0,text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,c=function(t,e){return 36},d=function(t,e){return 20};var s=function(t,e){return 24*e+12},_=function(t,e){return 24*e+23}}else if("horizontal"===t.legends_display){t.legendsGroup_height=50,temp_i=i,final_rect_x=0,final_text_x=0,legend_text_widths=[],sum_text_widths=0,temp_text=temp_rect=0,text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y";var c=function(t,e){return legend_text_widths[e]=this.getBBox().width,legend_start_x=16,final_text_x=0===e?legend_start_x:legend_start_x+temp_text,temp_text=temp_text+legend_text_widths[e]+30,final_text_x};_=30,rect_parameter1value=13,rect_parameter2value=13;var d=function(t,e){return final_rect_x=0===e?0:temp_rect,temp_rect=temp_rect+legend_text_widths[e]+30,final_rect_x};s=18}if("scatter"===e)if("yes"===t.panels_enable){var u=[];u.push(t.map_group_data[0][n]),o=t.legendsGroup.selectAll("rect").data(u),t.legends_text=t.legendsGroup.selectAll(".legends_text").data(u)}else o=t.legendsGroup.selectAll("rect").data(t.map_group_data[0]),t.legends_text=t.legendsGroup.selectAll(".legends_text").data(t.map_group_data[0]);else o=t.legendsGroup.selectAll(".legends-rect").data(a),t.legends_text=t.legendsGroup.selectAll(".legends_text").data(a);t.legends_text.enter().append("text"),t.legends_text.attr("class","legends_text").attr("pointer-events","none").text(function(t){switch(e){case"groupColumn":case"groupBar":return t;case"spiderWeb":case"scatter":return t.group;case"stackedArea":return t.name}}).attr("fill",t.legends_text_color).attr("font-family",t.legends_text_family).style("font-size",t.legends_text_size+"px").attr("font-weight",t.legends_text_weight).attr(text_parameter1,c).attr(text_parameter2,_),o.enter().append("rect"),o.attr("class","legends-rect").attr(rect_parameter1,rect_parameter1value).attr(rect_parameter2,rect_parameter2value).attr(rect_parameter3,d).attr(rect_parameter4,s).attr("fill",function(a,n){switch(e){case"groupColumn":case"groupBar":return"color"===t.color_mode?r[n]:t.saturation_color;case"spiderWeb":case"scatter":return t.fillChart.colorPieW(a);case"stackedArea":return t.fillColor.colorPieMS(a,t.type)}}).attr("fill-opacity",function(a,r){switch(e){case"groupColumn":case"groupBar":if("saturation"===t.color_mode)return(r+1)/t.no_of_groups;break;case"spiderWeb":return.6;case"scatter":return 1;case"stackedArea":if("saturation"===t.color_mode)return(r+1)/t.new_data.length}});var l,h=t.legendsGroup.node().getBBox().width;t.legendsGroup_width="vertical"===t.legends_display?h+20:0,l="scatter"===e?"vertical"===t.legends_display?t.w-t.legendsGroup_width:PykCharts["boolean"](t.panels_enable)?t.chart_margin_left:t.chart_width-h-20:"vertical"===t.legends_display?t.chart_width-t.legendsGroup_width:t.chart_width-h-20,h<t.chart_width&&t.legendsGroup.attr("transform","translate("+l+",10)"),t.legendsGroup.style("visibility","visible"),t.legends_text.exit().remove(),o.exit().remove()},mapGroup:function(e,a){for(var r=[],n={},o=[],i=[],l={},s=[],_=0,c=!0,d=!0,u=0;u<e.length;u++)o[u]=e[u].group;i=t.k.__proto__._unique(o);for(var u=0;u<i.length;u++)l[i[u]]=[];for(var h in l)for(var p=0;p<e.length;p++)h===e[p].group&&l[h].push(e[p]);for(var h in l)for(var u=0;u<l[h].length;u++)s.push(l[h][u]);if(e=s,e.forEach(function(e){e.group?c=!0:(c=!1,t.chart_color?(c=!1,e.color=t.chart_color[0]):e.color?(d=!1,e.color=e.color):(d=!1,e.color=t.default_color[0]))}),u=0,c){e.forEach(function(a){!n[a.group]&&a.color?(n[a.group]=a,0!==t.chart_color.length&&PykCharts["boolean"](t.chart_color[_])?a.color=t.chart_color[_]:a.color?a.color=a.color:a.color=t.default_color,u<e.length-2&&a.group!==e[u+1].group&&_++,r.push(a)):u<e.length-2&&a.group!==e[u+1].group&&_++,u++}),_=0,u=0,e.forEach(function(a){n[a.group]?u<e.length-2&&a.group!==e[u+1].group&&_++:(n[a.group]=a,0!==t.chart_color.length&&PykCharts["boolean"](t.chart_color[_])?a.color=t.chart_color[_]:a.color=t.default_color,u<e.length-2&&a.group!==e[u+1].group&&_++,r.push(a)),u++});var g=[];_=0,r.forEach(function(t){g.push(t)});for(var m=g.length,f=e.length,u=0;m>u;u++)for(var p=0;f>p;p++)e[p].group===g[u].group&&(e[p].color=g[u].color);return[g,c]}return[e,c]}});return e},PykCharts.multiD.bubbleSizeCalculation=function(t,e,a){var r=function(r){if(r&&PykCharts["boolean"](t.variable_circle_size_enable)){var n=d3.scale.linear().domain(d3.extent(e,function(t){return t.weight})).range(a);return n(r)}return t.bubbleRadius};return r},PykCharts.multiD.sortDataByGroup=function(t){return t.sort(function(t,e){return t.group<e.group?-1:t.group>e.group?1:void 0}),t},PykCharts.annotation=function(t){t.k.annotation=function(e,a,r,n){var o=t.legendsGroup_height?t.legendsGroup_height:0;if("onclick"===t.annotation_view_mode){var i=d3.select(e).selectAll(".PykCharts-annotation-circle").data(a),l=d3.select(e).selectAll(".PykCharts-annotation-text").data(a);i.enter().append("circle").attr("class","PykCharts-annotation-circle"),i.attr("r",0),setTimeout(function(){i.attr("cx",function(e,a){return parseInt(r(e.x))+t.extra_left_margin+t.chart_margin_left}).attr("cy",function(e,a){return parseInt(n(e.y))-15+t.chart_margin_top+o}).attr("r","7").style("cursor","pointer").on("click",function(e,a){d3.selectAll(".pyk-tooltip").style("display","none"),t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(e.annotation)}).on("mouseover",function(e){t.mouseEvent.tooltipHide(e,t.panels_enable,"multilineChart")}).attr("fill",t.annotation_background_color)},t.transitions.duration()),i.exit().remove()}else if("onload"===t.annotation_view_mode){var s=[],_=[],c=d3.select(e).selectAll(".annotation-rect").data(a);c.enter().append("rect").attr("class","annotation-rect");var l=d3.select(e).selectAll(".annotation-text").data(a);l.enter().append("text").attr("class","annotation-text"),l.text(function(t){return""}),c.attr("width",0).attr("height",0),setTimeout(function(){l.attr("x",function(e){return parseInt(r(e.x)-5)+t.extra_left_margin+t.chart_margin_left}).attr("y",function(e){return parseInt(n(e.y)-18+t.chart_margin_top+o)}).attr("text-anchor","middle").style("font-size","12px").text(function(t){return t.annotation}).text(function(t,e){return s[e]=this.getBBox().width+20,_[e]=this.getBBox().height+10,t.annotation}).attr("fill",t.annotation_font_color).style("pointer-events","none"),c.attr("x",function(e,a){return parseInt(r(e.x)-5)+t.extra_left_margin+t.chart_margin_left-s[a]/2}).attr("y",function(e,a){return parseInt(n(e.y)-10+t.chart_margin_top)+o-_[a]}).attr("width",function(t,e){return s[e]}).attr("height",function(t,e){return _[e]}).attr("fill",t.annotation_background_color).style("pointer-events","none")},t.transitions.duration()),l.exit().remove(),c.exit().remove()}return this}},PykCharts.crossHair=function(t){t.k.crossHair=function(e,a,r,n,o){if(PykCharts["boolean"](t.crosshair_enable)&&"default"===t.mode)for(PykCharts.Configuration.cross_hair_v=e.append("line").attr({"class":"line-cursor",id:"cross-hair-v"}),PykCharts.Configuration.cross_hair_h=e.append("line").attr({"class":"line-cursor",id:"cross-hair-h"}).style("display","none"),j=0;j<a;j++)PykCharts.Configuration.focus_circle=e.append("g").attr({"class":"focus",id:"f_circle"+j}).attr("name",function(){return r[j].name}).style("display","none"),PykCharts.Configuration.focus_circle.append("circle").attr({fill:function(t){return n.colorPieMS(r[j],o)},id:"focus-circle"+j,r:"6",actual_color:function(){return n.colorPieMS(r[j],o)}});return this}},PykCharts.grid=function(t){t.k.yGrid=function(e,a,r,n){t.chart_width,t.chart_height;if(PykCharts["boolean"](t.chart_grid_y_enable)){var o=PykCharts.Configuration.makeYGrid(t,r,n);a.selectAll(t.selector+" g.y.grid-line").style("stroke",function(){return t.chart_grid_color}).call(o)}return this},t.k.xGrid=function(e,a,r,n){t.chart_width,t.chart_height;if(PykCharts["boolean"](t.chart_grid_x_enable)){var o=PykCharts.Configuration.makeXGrid(t,r,n);a.selectAll(t.selector+" g.x.grid-line").style("stroke",function(){return t.chart_grid_color}).call(o)}return this}},PykCharts.Configuration.makeXGrid=function(t,e,a){a||(a=0);var r=d3.svg.axis().scale(e).orient("bottom").ticks(t.axis_x_no_of_axis_value).tickFormat("").tickSize(t.chart_height-t.chart_margin_top-t.chart_margin_bottom-a).outerTickSize(0);return d3.selectAll(t.selector+" .x.axis .tick text").attr("font-size",t.axis_x_pointer_size+"px").style({"font-weight":t.axis_x_pointer_weight,"font-family":t.axis_x_pointer_family}),r},configuration.makeYGrid=function(t,e,a){var r;a||(a=0),r=PykCharts["boolean"](t.panels_enable)?t.w-t.chart_margin_left-t.chart_margin_right-a:t.chart_width-t.chart_margin_left-t.chart_margin_right-a;var n=d3.svg.axis().scale(e).orient("left").ticks(t.axis_y_no_of_axis_value).tickSize(-r).tickFormat("").outerTickSize(0);return d3.selectAll(t.selector+" .y.axis .tick text").attr("font-size",t.axis_y_pointer_size+"px").style({"font-weight":t.axis_y_pointer_weight,"font-family":t.axis_y_pointer_family}),n},PykCharts.scaleFunction=function(t){var e=t.k.__proto__._isNumber;t.k.scaleIdentification=function(t,e,a,r){var n;switch(t){case"ordinal":return n=d3.scale.ordinal().domain(e).rangeRoundBands(a,r);case"linear":return n=d3.scale.linear().domain(e).range(a);case"time":return n=d3.time.scale().domain(e).range(a)}},t.k.ordinalXAxisTickFormat=function(e,a){for(var r,n,o=d3.selectAll(t.selector+" g.x.axis .tick text")[0],i=o.length,l=0,s=2*a,_=0;i>_;_++)l=o[_].getBBox().width>l?o[_].getBBox().width:l;s>=l+10?n=1:s>=.75*l&&l>s?n=2:s>=.65*l&&.75*l>s?n=3:s>=.55*l&&.65*l>s?n=4:s>=.35*l&&.55*l>s?n=5:(20>=s||.35*l>s)&&(n=0);for(var _=0;i>_;_++)r=o[_].__data__,0===n?(r="",d3.selectAll(t.selector+" .x.axis .tick").remove()):s>=o[_].getBBox().width+10&&1===n||(s>=.75*o[_].getBBox().width&&s<o[_].getBBox().width&&2===n?r=r.substr(0,5)+"..":s>=.65*o[_].getBBox().width&&s<.75*o[_].getBBox().width&&3===n?r=r.substr(0,4)+"..":4===n?r=r.substr(0,3):5===n&&(r=r.substr(0,2))),d3.select(o[_]).text(r);return xaxistooltip=d3.selectAll(t.selector+" g.x.axis .tick text").data(e),"default"===t.mode&&xaxistooltip.on("mouseover",function(e){t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(e)}).on("mousemove",function(e){t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(e)}).on("mouseout",function(e){t.mouseEvent.tooltipHide(e)}),this},t.k.ordinalYAxisTickFormat=function(e){var a,r=d3.selectAll(t.selector+" g.y.axis .tick text")[0],n=r.length;for(i=0;i<n;i++)a=r[i].textContent,r[i].getBBox().width>.9*t.chart_margin_left&&(a=a.substr(0,3)+".."),d3.select(r[i]).text(a);return yaxistooltip=d3.selectAll(t.selector+" g.y.axis .tick text").data(e),"default"===t.mode&&yaxistooltip.on("mouseover",function(e){t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(e)}).on("mousemove",function(e){t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(e)}).on("mouseout",function(e){t.mouseEvent.tooltipHide(e)}),this},t.k.xAxis=function(e,a,r,n,o,i,l,s,_){if(PykCharts["boolean"](t.axis_x_enable)){t.chart_width,t.chart_height;void 0===l&&(l=0),d3.selectAll(t.selector+" .x.axis").attr("fill",function(){return _&&void 0!=_.axis_x_pointer_color&&""!=_.axis_x_pointer_color?_.axis_x_pointer_color:t.axis_x_pointer_color}),"bottom"===t.axis_x_position&&a.attr("transform","translate(0,"+(t.chart_height-t.chart_margin_top-t.chart_margin_bottom-l)+")");var c=PykCharts.Configuration.makeXAxis(t,r);i&&i.length&&c.tickValues(i),a.style("stroke",function(){return t.axis_x_line_color}).call(c),"string"===t.axis_x_data_format&&"no"===t.panels_enable&&t.k.ordinalXAxisTickFormat(o,n),d3.selectAll(t.selector+" .x.axis .tick text").attr("font-size",t.axis_x_pointer_size).style({"font-weight":t.axis_x_pointer_weight,"font-family":t.axis_x_pointer_family}),s&&"string"!==t.axis_x_data_format&&d3.selectAll(t.selector+" .x.axis .domain").remove()}return this},t.k.yAxis=function(e,a,r,n,o,i,l,s,_){if(PykCharts["boolean"](t.axis_y_enable)){i||(i=0);var c=(t.chart_width,t.chart_height,PykCharts["boolean"](t.panels_enable)?t.w:t.chart_width);"right"===t.axis_y_position&&a.attr("transform","translate("+(c-t.chart_margin_left-t.chart_margin_right-i)+",0)"),d3.selectAll(t.selector+" .y.axis").attr("fill",function(){return _&&void 0!=_.axis_y_pointer_color&&""!=_.axis_y_pointer_color?_.axis_y_pointer_color:t.axis_y_pointer_color});var d=PykCharts.Configuration.makeYAxis(t,r,s);o&&o.length&&d.tickValues(o);new PykCharts.Configuration.mouseEvent(t);a.style("stroke",function(){return t.axis_y_line_color}).call(d),"string"===t.axis_y_data_format&&"no"===t.panels_enable&&t.k.ordinalYAxisTickFormat(n),d3.selectAll(t.selector+" .y.axis .tick text").attr("font-size",t.axis_y_pointer_size).style({"font-weight":t.axis_y_pointer_weight,"font-family":t.axis_y_pointer_family}),l&&"string"!==t.axis_y_data_format&&d3.selectAll(t.selector+" .y.axis .domain").remove()}return this},t.k.xAxisTitle=function(e,a,r){if(t.axis_x_title){var n,o=PykCharts["boolean"](t.panels_enable)?t.w:t.chart_width;a||(a=0),r||(r=0),PykCharts["boolean"](t.axis_x_enable)||e.attr("transform","translate(0,"+(t.chart_height-t.chart_margin_top-t.chart_margin_bottom-a)+")"),"bottom"===t.axis_x_position?n=t.chart_margin_bottom:"top"===t.axis_x_position&&(n=-t.chart_margin_top+t.axis_x_title_size),e.append("text").attr({"class":"x-axis-title",x:(o-t.chart_margin_left-t.chart_margin_right-r)/2,y:n}).style({"text-anchor":"middle",fill:t.axis_x_title_color,"font-weight":t.axis_x_title_weight,"font-size":t.axis_x_title_size}).text(t.axis_x_title)}return this},t.k.yAxisTitle=function(e){if(t.axis_y_title){var a,r;PykCharts["boolean"](t.panels_enable)?t.w:t.chart_width;"left"===t.axis_y_position?(a=-(t.chart_margin_left-t.axis_y_title_size),r=0):"right"===t.axis_y_position&&(a=t.chart_margin_right-t.axis_y_title_size,r="0.71em"),e.append("text").attr({"class":"y-axis-title",x:-((t.chart_height-t.chart_margin_bottom-t.chart_margin_top)/2),transform:"rotate(-90)",y:a,dy:r}).style({fill:t.axis_y_title_color,"font-weight":t.axis_y_title_weight,"font-family":t.axis_y_title_family,"font-size":t.axis_y_title_size,"text-anchor":"middle"}).text(t.axis_y_title)}return this},t.k.isOrdinal=function(e,a,r,n,o){return".x.axis"===a&&PykCharts["boolean"](t.axis_x_enable)?(e.select(a).call(PykCharts.Configuration.makeXAxis(t,r)),"string"===t.axis_x_data_format&&"no"===t.panels_enable&&t.k.ordinalXAxisTickFormat(n,o)):".x.grid"===a?e.select(a).call(PykCharts.Configuration.makeXGrid(t,r)):".y.axis"===a&&PykCharts["boolean"](t.axis_y_enable)?(e.select(a).call(PykCharts.Configuration.makeYAxis(t,r)),"string"===t.axis_y_data_format&&"no"===t.panels_enable&&t.k.ordinalyAxisTickFormat(n)):".y.grid"===a&&e.select(a).call(PykCharts.Configuration.makeYGrid(t,r)),this},t.k.xAxisDataFormatIdentification=function(t){return e(t[0].x)||!isNaN(t[0].x)?"number":isNaN(new Date(t[0].x).getTime())?"string":"time"},t.k.yAxisDataFormatIdentification=function(t){return e(t[0].y)||!isNaN(t[0].y)?"number":isNaN(new Date(t[0].y).getTime())?"string":"time"},t.k.processXAxisTickValues=function(){var a=[],r=[],n=t.axis_x_pointer_values.length;if(n)for(var o=0;n>o;o++)"number"===t.axis_x_data_format?!e(t.axis_x_pointer_values[o])&&isNaN(t.axis_x_pointer_values[o])||""==t.axis_x_pointer_values[o]||a.push(parseFloat(t.axis_x_pointer_values[o])):"time"===t.axis_x_data_format&&(isNaN(new Date(t.axis_x_pointer_values[o]).getTime())||a.push(t.axis_x_pointer_values[o]));if(a.length){var i=a.length;if("time"===t.axis_x_data_format)for(var o=0;i>o;o++)r.push(t.k.dateConversion(a[o]));else r=a}return r},t.k.processYAxisTickValues=function(){var a=t.axis_y_pointer_values.length,r=[];if(a)for(var n=0;a>n;n++)"number"===t.axis_y_data_format&&(!e(t.axis_y_pointer_values[n])&&isNaN(t.axis_y_pointer_values[n])||""==t.axis_y_pointer_values[n]||r.push(t.axis_y_pointer_values[n]));return r}};var configuration=PykCharts.Configuration;configuration.makeXAxis=function(t,e){var r=(PykCharts.Configuration(t),d3.svg.axis().scale(e).tickSize(t.axis_x_pointer_length).outerTickSize(t.axis_x_outer_pointer_length).tickFormat(function(e,a){return"yes"===t.panels_enable&&"string"===t.axis_x_data_format?e.substr(0,2):e}).tickPadding(t.axis_x_pointer_padding).orient(t.axis_x_pointer_position));if(d3.selectAll(t.selector+" .x.axis .tick text").attr("font-size",t.axis_x_pointer_size+"px").style({"font-weight":t.axis_x_pointer_weight,"font-family":t.axis_x_pointer_family}),"time"===t.axis_x_data_format&&PykCharts["boolean"](t.axis_x_time_value_datatype)){switch(t.axis_x_time_value_datatype){case"month":a=d3.time.month,b="%b";break;case"date":a=d3.time.day,b="%d";break;case"year":a=d3.time.year,b="%Y";break;case"hours":a=d3.time.hour,b="%H";break;case"minutes":a=d3.time.minute,b="%M"}r.ticks(a,t.axis_x_time_value_interval).tickFormat(d3.time.format(b))}else"number"===t.axis_x_data_format&&r.ticks(t.axis_x_no_of_axis_value);return r},configuration.makeYAxis=function(t,e,a){var r=(PykCharts.Configuration(t),d3.svg.axis().scale(e).orient(t.axis_y_pointer_position).tickSize(t.axis_y_pointer_length).outerTickSize(t.axis_y_outer_pointer_length).tickPadding(t.axis_y_pointer_padding).tickFormat(function(t,e){return a?a(t):t}));return d3.selectAll(t.selector+" .y.axis .tick text").attr("font-size",t.axis_y_pointer_size+"px").style({"font-weight":t.axis_y_pointer_weight,"font-family":t.axis_y_pointer_family}),"number"===t.axis_y_data_format&&r.ticks(t.axis_y_no_of_axis_value),r},PykCharts.crossHairMovement=function(t){var e=this,a=PykCharts.Configuration.mouseEvent(t);return e.tooltip=configuration.tooltipp,e.cross_hair_v=configuration.cross_hair_v,e.cross_hair_h=configuration.cross_hair_h,e.focus_circle=configuration.focus_circle,e.pt_circle=configuration.pt_circle,e.start_pt_circle=configuration.start_pt_circle,a.crossHairPosition=function(e,a,r,n,o,l,s,_,c,d,u){if((PykCharts["boolean"](t.crosshair_enable)||PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.axis_onhover_highlight_enable))&&"default"===t.mode){var h=t.k.__proto__._offset,p=document.querySelector(t.selector+" #"+n[0][0][0].parentNode.parentNode.id),g=0,m=0;PykCharts["boolean"](c)?(g=1,height_percentge=1):(g=parseFloat(d3.select(p).style("width"))/t.chart_width,m=parseFloat(d3.select(p).style("height"))/t.chart_height);var f=t.legendsGroup_height?t.legendsGroup_height:0,x=(t.chart_margin_left+o)*g+h(p).left,y=h(p).top,v=e.length,k=t.chart_margin_left,w=(t.chart_margin_right,t.chart_margin_top),b=t.chart_margin_bottom,C=(t.chart_width,t.chart_height),P=parseInt(PykCharts.getEvent().target.id.substr(PykCharts.getEvent().target.id.length-1,1)),D=PykCharts.getEvent().pageX-x,S=PykCharts.getEvent().pageY-y-w,A=[];if("string"===t.axis_x_data_format)A=a.range();else for(temp=a.range(),pad=(temp[1]-temp[0])/(e[0].data.length-1),len=e[0].data.length,strt=0,i=0;i<len;i++)A[i]=strt,strt+=pad;var F,E,z,B,G,I,T,H,L=r.range(),M=(L.length,[]),q=[],N=A.length;for(F=0;N>F;F++){if(F+1>=N)return!1;if(I===A[F]&&T===A[F+1]&&H===L[0])return!1;if(D>=g*A[F]&&D<=g*A[F+1]&&S<L[0]+f){switch(T=g*A[F],I=g*A[F+1],H=L[0],z=T-D,B=D-I,z>=B?(E=e[0].data[F].x,M.push(e[0].data[F].y),tooltipText=e[0].data[F].tooltip||e[0].data[F].y):(E=e[0].data[F+1].x,M.push(e[0].data[F+1].y),tooltipText=e[0].data[F+1].tooltip||e[0].data[F+1].y),G=a(E)+o+k,q=r(tooltipText)+w,s){case"multi_series_line":var j=[];d3.selectAll(t.selector+" #pyk-tooltip").classed({"pyk-tooltip":!1,"pyk-multiline-tooltip":!0,"pyk-tooltip-table":!0});var R=e[0].data.length,V="";M=[];for(var O=0;v>O;O++)for(var U=0;R>U;U++)"time"===t.axis_x_data_format?cond=Date.parse(E)===Date.parse(e[O].data[U].x):cond=e[O].data[U].x===E,cond&&(M.push(e[O].data[U].y),j.push(r(e[O].data[U].y)+w),V+="<tr><td>"+e[O].name+"</td><td><b>"+(e[O].data[U].tooltip||("string"==typeof e[O].data[U].y?e[O].data[U].y:PykCharts.numberFormat(e[O].data[U].y)))+"</b></td></tr>");G+=6,tooltipText="<table><thead><th colspan='2'>"+E+"</th></thead><tbody>"+V+"</tbody></table>",PykCharts["boolean"](t.tooltip_enable)&&(this.tooltipPosition(tooltipText,G,S,60,-15,P,g,m,s),this.tooltipTextShow(tooltipText)),t.crosshair_enable?this.crossHairShowMultipleline(G,w,G,C-b,G,j,e):null;break;case"panels_of_line":G+=5;for(var R=e[0].data.length,W=C,Y=0,Q=0,O=0;v>O;O++)for(var J=h(document.querySelector(t.selector)),X=h(document.querySelector(t.selector+" #"+d+"-"+O)),$=X.left-J.left,U=(X.top-J.top,0);R>U;U++)"time"===t.axis_x_data_format?cond=Date.parse(E)===Date.parse(e[O].data[U].x):cond=e[O].data[U].x===E,cond&&(M.push(e[O].data[U].y),tooltipText=e[O].data[U].tooltip||e[O].data[U].y,O%u==0&&0!=O&&(++Y,Q=W*Y),q=r(e[O].data[U].y)+w,this.tooltipPosition(tooltipText,G+$-15-30,q+Q,-15,-15,O,g,m,s),this.tooltipTextShow(tooltipText,s,O),t.crosshair_enable?this.crossHairShowPanelOfLine(G,w,G,C-b,G,q,O,d):null);break;case"lineChart":case"areaChart":PykCharts["boolean"](t.tooltip_enable)&&("fixed"===t.tooltip_mode.toLowerCase()?this.tooltipPosition(tooltipText,-t.chart_margin_left,q,-14,23,P,g,m,s):"moving"===t.tooltip_mode.toLowerCase()&&this.tooltipPosition(tooltipText,G-t.chart_margin_left+10,q-5,0,-45,P,g,m,s),this.tooltipTextShow(tooltipText)),t.crosshair_enable?this.crossHairShowLineArea(G,w,G,C-b,G,q):null;break;case"stackedAreaChart":var j=[];d3.selectAll(t.selector+" #pyk-tooltip").classed({"pyk-tooltip":!1,"pyk-multiline-tooltip":!0,"pyk-tooltip-table":!0});var R=e[0].data.length,V="";M=[];for(var O=0;v>O;O++)for(var U=0;R>U;U++)"time"===t.axis_x_data_format?cond=Date.parse(E)===Date.parse(e[O].data[U].x):cond=e[O].data[U].x===E,cond&&(M.push(e[O].data[U].y),j.push(r(e[O].data[U].y+e[O].data[U].y0)+w+t.legendsGroup_height),V+="<tr><td>"+e[O].name+"</td><td><b>"+(e[O].data[U].tooltip||e[O].data[U].y)+"</b></td></tr>");G+=6,tooltipText="<table><thead><th colspan='2'>"+E+"</th></thead><tbody>"+V+"</tbody></table>",PykCharts["boolean"](t.tooltip_enable)&&(P=1,this.tooltipPosition(tooltipText,G,S,60,70,P,g,m),this.tooltipTextShow(tooltipText)),t.crosshair_enable?this.crossHairShowStackedArea(G,w+f,G,C-b,G,j,e):null}PykCharts["boolean"](c)||(this.axisHighlightShow(M,t.selector+" .y.axis",l),this.axisHighlightShow(E,t.selector+" .x.axis",l));
}}}},a.crossHairShowLineArea=function(a,r,n,o,i,l){return PykCharts["boolean"](t.crosshair_enable)&&(d3.selectAll(t.selector+" .line-cursor").style("display","block"),d3.select(t.selector+" #cross-hair-v").attr({x1:a,y1:r,x2:n,y2:o}),d3.select(t.selector+" #cross-hair-h").attr({x1:t.chart_margin_left,y1:l,x2:t.chart_width-t.chart_margin_right,y2:l}),e.focus_circle.style("display","block").attr("transform","translate("+i+","+l+")")),this},a.crossHairShowMultipleline=function(a,r,n,o,i,l,s){var _=d3.selectAll("#clipPath path")[0];if(PykCharts["boolean"](t.crosshair_enable)){e.cross_hair_v.style("display","block"),d3.select(t.selector+" #cross-hair-v").attr({x1:a-5,y1:r,x2:n-5,y2:o});for(var c=0;c<s.length;c++)l[c]?"no"===_[c].getAttribute("click_status")?(d3.select(t.selector+" #f_circle"+c).style("display","block").attr("transform","translate("+(i-3)+","+l[c]+")"),d3.select(t.selector+" #f_circle"+c+" circle").attr("fill","#ddd")):(d3.select(t.selector+" #f_circle"+c).style("display","block").attr("transform","translate("+(i-3)+","+l[c]+")"),d3.select(t.selector+" #f_circle"+c+" circle").attr("fill",d3.select(t.selector+" #f_circle"+c+" circle").attr("actual_color"))):d3.select(t.selector+" #f_circle"+c).style("display","none")}return this},a.crossHairShowPanelOfLine=function(e,a,r,n,o,i,l,s){return PykCharts["boolean"](t.crosshair_enable)&&(d3.selectAll(t.selector+" .line-cursor").style("display","block"),d3.selectAll(t.selector+" #cross-hair-v").attr({x1:e-5,y1:a,x2:r-5,y2:n}),d3.select(t.selector+" #"+s+"-"+l+" #cross-hair-h").attr({x1:t.chart_margin_left,y1:i,x2:t.w-t.chart_margin_right,y2:i}),d3.select(t.selector+" #"+s+"-"+l+" .focus").style("display","block").attr("transform","translate("+(o-5)+","+i+")")),this},a.crossHairShowStackedArea=function(e,a,r,n,o,i,l){if(PykCharts["boolean"](t.crosshair_enable)){d3.selectAll(t.selector+" .line-cursor").style("display","block"),d3.selectAll(t.selector+" #cross-hair-v").attr({x1:e-5,y1:a,x2:r-5,y2:n});for(var s=0;s<l.length;s++)d3.select(t.selector+" #f_circle"+s).style("display","block").attr("transform","translate("+(o-3)+","+i[s]+")")}return this},a.crossHairHide=function(a){return PykCharts["boolean"](t.crosshair_enable)&&(e.cross_hair_v.style("display","none"),"lineChart"===a||"areaChart"===a?(e.cross_hair_h.style("display","none"),e.focus_circle.style("display","none")):("multilineChart"===a||"stackedAreaChart"===a)&&(d3.selectAll(t.selector+" .line-cursor").style("display","none"),d3.selectAll(t.selector+" .focus").style("display","none"))),this},a.tooltipPosition=function(a,r,n,o,i,l,s,_,c){if(PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.annotation_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format){if(void 0!==r){var d=t.k.__proto__._offset,u=t.selector.substr(1,t.selector.length),h=document.getElementById(u),p=(document.querySelector("#tooltip-svg-container-"+l+"-pyk-tooltip"+u)?parseFloat(d3.select("#tooltip-svg-container-"+l+"-pyk-tooltip"+u).style("width")):0,document.querySelector("#tooltip-svg-container-"+l+"-pyk-tooltip"+u)?parseFloat(d3.select("#tooltip-svg-container-"+l+"-pyk-tooltip"+u).style("height")):0),g=d3.select("#tooltip-svg-container-"+l+"-pyk-tooltip"+u),m=d(h).left,f=d(h).top;if("lineChart"===c||"areaChart"===c)var x=n*_;else var x=n-p/2*_;g.style({display:"block",top:x+f+"px",left:(r+t.chart_margin_left)*s+m+"px"})}else e.tooltip.style({display:"block",top:PykCharts.getEvent().pageY-20+"px",left:PykCharts.getEvent().pageX+30+"px"});return e.tooltip}},a.tooltipTextShow=function(a,r,n){var o=t.selector.substr(1,t.selector.length);return PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.annotation_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format?("panels_of_line"===r?d3.selectAll("#tooltip-svg-container-"+n+"-pyk-tooltip"+o).html(a):e.tooltip.html(a),this):void 0},a.tooltipHide=function(a,r,n){return PykCharts["boolean"](t.tooltip_enable)||PykCharts["boolean"](t.annotation_enable)||"string"===t.axis_x_data_format||"string"===t.axis_y_data_format?"yes"===r&&"multilineChart"===n?d3.selectAll(".pyk-tooltip").style("display","none"):e.tooltip.style("display","none"):void 0},a},PykCharts.multiD.line=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.crossHair(e),PykCharts.annotation(e),PykCharts.scaleFunction(e),PykCharts.grid(e),!e.stop){e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading();var n=a.multiDimensionalCharts,o=a.stylesheet;t.optional;e.pointer_overflow_enable=t.pointer_overflow_enable?t.pointer_overflow_enable.toLowerCase():o.pointer_overflow_enable,e.crosshair_enable=t.crosshair_enable?t.crosshair_enable.toLowerCase():n.crosshair_enable,e.curvy_lines_enable=t.curvy_lines_enable?t.curvy_lines_enable.toLowerCase():n.curvy_lines_enable,e.interpolate=PykCharts["boolean"](e.curvy_lines_enable)?"cardinal":"linear",e.panels_enable="no",e.executeData=function(a){var r=e.k.validator().validatingJSON(a);e.selector.substring(1,e.selector.length);e.stop||r===!1||(e.data=e.k.__proto__._groupBy("line",a),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),"string"===e.axis_x_data_format?e.data_sort_enable="no":(e.data_sort_enable="yes",e.data_sort_type="time"===e.axis_x_data_format?"date":"numerically",e.data_sort_order="ascending"),PykCharts.multiD.lineFunctions(t,e,"line"))},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.multiSeriesLine=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.crossHair(e),PykCharts.annotation(e),PykCharts.scaleFunction(e),PykCharts.grid(e),!e.stop){e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading();var n=a.multiDimensionalCharts,o=a.stylesheet;t.optional;e.pointer_overflow_enable=t.pointer_overflow_enable?t.pointer_overflow_enable.toLowerCase():o.pointer_overflow_enable,e.crosshair_enable=t.crosshair_enable?t.crosshair_enable.toLowerCase():n.crosshair_enable,e.curvy_lines_enable=t.curvy_lines_enable?t.curvy_lines_enable.toLowerCase():n.curvy_lines_enable,e.interpolate=PykCharts["boolean"](e.curvy_lines_enable)?"cardinal":"linear",e.panels_enable="no",e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);return e.stop||r===!1?void e.k.remove_loading_bar(n):(e.data=e.k.__proto__._groupBy("line",a),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),"string"===e.axis_x_data_format?e.data_sort_enable="no":(e.data_sort_enable="yes",e.data_sort_type="time"===e.axis_x_data_format?"date":"numerically",e.data_sort_order="ascending"),void PykCharts.multiD.lineFunctions(t,e,"multi_series_line"))},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.panelsOfLine=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.crossHair(e),PykCharts.annotation(e),PykCharts.scaleFunction(e),PykCharts.grid(e),!e.stop){e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading();var n=a.multiDimensionalCharts,o=a.stylesheet;t.optional;e.pointer_overflow_enable=t.pointer_overflow_enable?t.pointer_overflow_enable.toLowerCase():o.pointer_overflow_enable,e.crosshair_enable=t.crosshair_enable?t.crosshair_enable.toLowerCase():n.crosshair_enable,e.curvy_lines_enable=t.curvy_lines_enable?t.curvy_lines_enable.toLowerCase():n.curvy_lines_enable,e.interpolate=PykCharts["boolean"](e.curvy_lines_enable)?"cardinal":"linear",e.panels_enable="yes",e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);return e.stop||r===!1?void e.k.remove_loading_bar(n):(e.data=e.k.__proto__._groupBy("line",a),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),"string"===e.axis_x_data_format?e.data_sort_enable="no":(e.data_sort_enable="yes",e.data_sort_type="time"===e.axis_x_data_format?"date":"numerically",e.data_sort_order="ascending"),void PykCharts.multiD.lineFunctions(t,e,"panels_of_line"))},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.lineFunctions=function(t,e,a){var r=e,o=r.selector.substring(1,r.selector.length);r.compare_data=r.data,r.data_length=r.data.length,r.k.remove_loading_bar(o),r.dataTransformation=function(){for(r.group_arr=[],r.new_data=[],r.ticks=[],r.x_arr=[],j=0;j<r.data_length;j++)r.group_arr[j]=r.data[j].name;r.uniq_group_arr=r.k.__proto__._unique(r.group_arr),r.uniq_color_arr=[];for(var t=r.uniq_group_arr.length,e=0;e<r.data_length;e++)r.x_arr[e]=r.data[e].x;var a=r.k.__proto__._unique(r.x_arr);for(e=0;t>e;e++)if(r.chart_color[e])r.uniq_color_arr[e]=r.chart_color[e];else{for(l=0;l<r.data_length;l++)if(r.uniq_group_arr[e]===r.data[l].name&&r.data[l].color){r.uniq_color_arr[e]=r.data[l].color;break}PykCharts["boolean"](r.uniq_color_arr[e])||(r.uniq_color_arr[e]=r.default_color[0])}for(r.flag=0,e=0;t>e;e++)for(r.new_data[e]={name:r.uniq_group_arr[e],data:[],color:r.uniq_color_arr[e]},l=0;l<r.data_length;l++)r.uniq_group_arr[e]===r.data[l].name&&r.new_data[e].data.push({x:r.data[l].x,y:r.data[l].y,tooltip:r.data[l].tooltip,annotation:r.data[l].annotation||""});r.new_data_length=r.new_data.length;for(var n=a.length,o=0;o<r.new_data_length;o++){for(var i=r.k.__proto__._unique(r.x_arr),s=r.new_data[o].data.length,_=0;s>_;_++)for(var e=0;n>e;e++)if(r.new_data[o].data[_].x==i[e]){i[e]=void 0;break}for(var c=0;n>c;c++)if(void 0!=i[c]){var d={x:i[c],y:"NA",tooltip:0,annotation:""};r.new_data[o].data.splice(c,0,d)}}},r.calculatePanelInRow=function(){var t,e=parseInt(r.k._getHighestParentsAttribute(r.selector,"width"));t=e?e:d3.select("body").style("width"),r.no_of_containers_in_row=Math.floor(parseInt(t)/r.chart_width),r.no_of_containers_in_row>r.new_data.length&&(r.no_of_containers_in_row=r.new_data.length),t<r.chart_width&&(r.no_of_containers_in_row=1)},r.render=function(){var e=r.selector.substring(1,r.selector.length);if(r.container_id=e+"_svg",r.dataLineGroup=[],r.clicked,r.multid=new PykCharts.multiD.configuration(r),r.fillColor=new PykCharts.Configuration.fillChart(r,null,t),r.transitions=new PykCharts.Configuration.transition(r),PykCharts["boolean"](r.panels_enable)&&(r.calculatePanelInRow(),r.new_width=r.no_of_containers_in_row*r.chart_width),"default"===r.mode){if(r.k.title(r.new_width),PykCharts["boolean"](r.panels_enable)){if(r.w=r.chart_width,r.chart_height=r.chart_height,r.chart_margin_left=r.chart_margin_left,r.chart_margin_right=r.chart_margin_right,r.k.backgroundColor(r)["export"](r,r.container_id+"-","lineChart",r.panels_enable,r.new_data,r.new_width).emptyDiv(r.selector).subtitle(r.new_width),d3.select(r.selector).append("div").attr("id","panels_of_line_main_div"),r.k.liveData(r),r.optionalFeature().chartType(),r.reducedWidth=r.w-r.chart_margin_left-r.chart_margin_right,r.reducedHeight=r.chart_height-r.chart_margin_top-r.chart_margin_bottom,r.fill_data=[],"time"===r.axis_x_data_format){for(i=0;i<r.new_data_length;i++)r.new_data[i].data.forEach(function(t){t.x=r.k.dateConversion(t.x)});r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)})}r.renderPanelOfLines()}else{r.k.backgroundColor(r)["export"](r,"#"+r.container_id+"-1","lineChart").emptyDiv(r.selector).subtitle(),r.w=r.chart_width,r.reducedWidth=r.w-r.chart_margin_left-r.chart_margin_right,r.reducedHeight=r.chart_height-r.chart_margin_top-r.chart_margin_bottom;var n=r.selector.substr(1,r.selector.length);if(d3.selectAll("#tooltip-svg-container-1-pyk-tooltip"+n).remove(),r.k.liveData(r).makeMainDiv(r.selector,1).tooltip(!0,r.selector,1,r.flag),r.optionalFeature().chartType(),"time"===r.axis_x_data_format){for(i=0;i<r.new_data_length;i++)r.new_data[i].data.forEach(function(t){t.x=r.k.dateConversion(t.x)});r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)})}try{if("multilineChart"===r.type&&"line"===a)throw"Invalid data in the JSON"}catch(o){return void console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+r.selector+'."'+o+'"  Visit www.pykcharts.com/errors#error_6')}r.renderLineChart()}r.k.createFooter(r.new_width).lastUpdatedAt().credits().dataSource(),PykCharts["boolean"](r.annotation_enable)&&r.annotation()}else if("infographics"===r.mode)if(PykCharts["boolean"](r.panels_enable)){if(r.k.backgroundColor(r)["export"](r,"#"+r.container_id+"-","lineChart",r.panels_enable,r.new_data,r.new_width).emptyDiv(r.selector),d3.select(r.selector).append("div").attr("id","panels_of_line_main_div"),r.optionalFeature().chartType(),r.w=r.chart_width,r.chart_height=r.chart_height,"time"===r.axis_x_data_format){for(i=0;i<r.new_data_length;i++)r.new_data[i].data.forEach(function(t){t.x=r.k.dateConversion(t.x)});r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)})}r.reducedWidth=r.w-r.chart_margin_left-r.chart_margin_right,r.reducedHeight=r.chart_height-r.chart_margin_top-r.chart_margin_bottom,r.fill_data=[],r.renderPanelOfLines()}else{if(r.k.backgroundColor(r)["export"](r,"#"+r.container_id+"-0","lineChart").emptyDiv(r.selector),r.w=r.chart_width,r.reducedWidth=r.w-r.chart_margin_left-r.chart_margin_right,r.reducedHeight=r.chart_height-r.chart_margin_top-r.chart_margin_bottom,r.k.makeMainDiv(r.selector,1),r.optionalFeature().chartType(),"time"===r.axis_x_data_format){for(i=0;i<r.new_data_length;i++)r.new_data[i].data.forEach(function(t){t.x=r.k.dateConversion(t.x)});r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)})}try{if("multilineChart"===r.type&&"line"===a)throw"Invalid data in the JSON"}catch(o){return void console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+r.selector+'."'+o+'"  Visit www.pykcharts.com/errors#error_6')}r.renderLineChart()}if(PykCharts["boolean"](r.panels_enable)){var l=r.k.resize(null,r.new_width);r.k.__proto__._ready(l),window.addEventListener("resize",function(t){return r.calculatePanelInRow(),r.k.resize(null,r.new_width)})}else{var l=r.k.resize(r.svgContainer);r.k.__proto__._ready(l),window.addEventListener("resize",function(t){return r.k.resize(r.svgContainer)})}},r.refresh=function(e){r.executeRefresh=function(t){r.data=r.k.__proto__._groupBy("line",t),r.data_length=r.data.length;var e=r.k.checkChangeInData(r.data,r.compare_data);r.compare_data=e[0];var a=e[1];if(r.dataTransformation(),(a||PykCharts["boolean"](r.zoom_enable)&&r.count>1&&r.count<=r.zoom_level||r.transition_duration)&&(r.k.lastUpdatedAt("liveData"),r.mouseEvent.tooltipHide(null,r.panels_enable,r.type),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")),r.optionalFeature().hightLightOnload(),"time"===r.axis_x_data_format){for(var n=0;n<r.new_data_length;n++)r.new_data[n].data.forEach(function(t){t.x=r.k.dateConversion(t.x)});r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)})}if(PykCharts["boolean"](r.panels_enable)){for(var n=0;n<r.previous_length;n++){var o=document.querySelector(r.selector+" #panels_of_line_main_div #chart-container-"+n);o.parentNode.removeChild(o)}r.renderPanelOfLines()}"multilineChart"!==r.type||PykCharts["boolean"](r.panels_enable)||(document.querySelector(r.selector+" #chart-container-1").innerHTML=null,r.renderLineChart()),"lineChart"===r.type&&(r.optionalFeature().createChart("liveData").ticks(),r.k.xAxis(r.svgContainer,r.xGroup,r.xScale,r.extra_left_margin,r.xdomain,r.x_tick_values).yAxis(r.svgContainer,r.yGroup,r.yScale,r.ydomain,r.y_tick_values).yGrid(r.svgContainer,r.group,r.yScale).xGrid(r.svgContainer,r.group,r.xScale),PykCharts["boolean"](r.annotation_enable)&&r.annotation())},PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeRefresh")):r.k.dataSourceFormatIdentification(t.data,r,"executeRefresh")},r.optionalFeature=function(){var t=r.selector.substring(1,r.selector.length),e={chartType:function(){for(var t=0;t<r.data_length;t++)for(var e=t+1;e<r.data_length;e++)if(r.data[t].x===r.data[e].x){r.type="multilineChart";break}return r.type=r.type||"lineChart",this},hightLightOnload:function(){if("multilineChart"===r.type&&r.new_data_length>0&&r.highlight)for(var t=0;t<r.uniq_group_arr.length;t++)r.highlight.toLowerCase()===r.uniq_group_arr[t].toLowerCase()?r.new_data[t].highlight=!0:r.new_data[t].highlight=!1;return this},svgContainer:function(e){var a=document.getElementById(t);return"multilineChart"!==r.type||a.classList.contains("PykCharts-line-chart")?"lineChart"!==r.type||a.classList.contains("PykCharts-line-chart")||(a.className+=" PykCharts-twoD PykCharts-line-chart"):a.className+=" PykCharts-twoD PykCharts-line-chart PykCharts-multi-series2D",r.svgContainer=d3.select(r.selector+" #chart-container-"+e).append("svg:svg").attr({id:r.container_id+"-"+e,width:r.w,height:r.chart_height,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+r.w+" "+r.chart_height}),PykCharts["boolean"](r.pointer_overflow_enable)&&!PykCharts["boolean"](r.panels_enable)&&r.svgContainer.style("overflow","visible"),this},createGroups:function(t){return r.group=r.svgContainer.append("g").attr({id:r.type+"-svg",transform:"translate("+r.chart_margin_left+","+r.chart_margin_top+")"}),PykCharts["boolean"](r.chart_grid_y_enable)&&r.group.append("g").attr({id:"ygrid","class":"y grid-line"}),PykCharts["boolean"](r.chart_grid_x_enable)&&r.group.append("g").attr({id:"xgrid","class":"x grid-line"}),r.clip=r.svgContainer.append("svg:clipPath").attr("id","clip"+t+r.selector).append("svg:rect").attr({width:r.reducedWidth,height:r.reducedHeight}),r.chartBody=r.svgContainer.append("g").attr({id:"clipPath","clip-path":"url(#clip"+t+r.selector+")",transform:"translate("+r.chart_margin_left+","+r.chart_margin_top+")"}),this},axisContainer:function(){return(PykCharts["boolean"](r.axis_x_enable)||r.axis_x_title)&&(r.xGroup=r.group.append("g").attr({id:"xaxis","class":"x axis"})),(PykCharts["boolean"](r.axis_y_enable)||r.axis_y_title)&&(r.yGroup=r.group.append("g").attr({id:"yaxis","class":"y axis"})),this},createChart:function(t,e){function a(t){r.dataLineGroup[t].transition().duration(r.transitions.duration()).attrTween("d",function(e){var a=d3.scale.quantile().domain([0,1]).range(d3.range(1,y.length+1));return function(e){return r.chart_path(r.new_data[t].data.slice(0,a(e)))}})}function o(t){r.dataLineGroup[t].transition().duration(r.transitions.duration()).attrTween("d",function(e){var a=d3.scale.quantile().domain([0,1]).range(d3.range(1,y.length+1));return function(e){return r.chart_path(r.new_data[t].data.slice(0,a(e)))}})}function i(t){r.dataLineGroup[0].transition().duration(r.transitions.duration()).attrTween("d",function(t){var e=d3.scale.quantile().domain([0,1]).range(d3.range(1,y.length+1));return function(t){return r.chart_path(y.slice(0,e(t)))}})}r.previous_length=r.new_data.length,r.x_tick_values=r.k.processXAxisTickValues(),r.y_tick_values=r.k.processYAxisTickValues();var l,s,_,c,d,u,h,p,g,m=[];if("number"===r.axis_y_data_format?(max=d3.max(r.new_data,function(t){return d3.max(t.data,function(t){return t.y})}),min=d3.min(r.new_data,function(t){return d3.min(t.data,function(t){return t.y})}),d=[min,max],s=r.k.__proto__._domainBandwidth(d,2),p=d3.min(r.y_tick_values),g=d3.max(r.y_tick_values),s[0]>p&&(s[0]=p),s[1]<g&&(s[1]=g),_=[r.reducedHeight,0],r.yScale=r.k.scaleIdentification("linear",s,_)):"string"===r.axis_y_data_format?(r.new_data[0].data.forEach(function(t){s.push(t.y)}),_=[0,r.reducedHeight],r.yScale=r.k.scaleIdentification("ordinal",s,_,0)):"time"===r.axis_y_data_format&&(s=d3.extent(r.data,function(t){return new Date(t.x)}),p=d3.min(r.y_tick_values,function(t){return new Date(t)}),g=d3.max(r.y_tick_values,function(t){return new Date(t)}),new Date(s[0])>new Date(p)&&(s[0]=p),new Date(s[1])<new Date(g)&&(s[1]=max__tick_value),_=[r.reducedHeight,0],r.yScale=r.k.scaleIdentification("time",s,_)),r.xdomain=[],"number"===r.axis_x_data_format?(max=d3.max(r.new_data,function(t){return d3.max(t.data,function(t){return+t.x})}),min=d3.min(r.new_data,function(t){return d3.min(t.data,function(t){return+t.x})}),l=[min,max],m=r.k.__proto__._domainBandwidth(l,2),u=d3.min(r.x_tick_values),h=d3.max(r.x_tick_values),m[0]>u&&(m[0]=u),m[1]<h&&(m[1]=h),c=[0,r.reducedWidth],r.xScale=r.k.scaleIdentification("linear",m,c),r.extra_left_margin=0,r.new_data[0].data.forEach(function(t){r.xdomain.push(+t.x)})):"string"===r.axis_x_data_format?(r.new_data[0].data.forEach(function(t){m.push(t.x)}),c=[0,r.reducedWidth],r.xScale=r.k.scaleIdentification("ordinal",m,c,0),r.extra_left_margin=r.xScale.rangeBand()/2,r.xdomain=r.xScale.domain()):"time"===r.axis_x_data_format&&(max=d3.max(r.new_data,function(t){return d3.max(t.data,function(t){return t.x})}),min=d3.min(r.new_data,function(t){return d3.min(t.data,function(t){return t.x})}),m=[min,max],c=[0,r.reducedWidth],u=d3.min(r.x_tick_values,function(t){return t=r.k.dateConversion(t)}),h=d3.max(r.x_tick_values,function(t){return t=r.k.dateConversion(t)}),m[0]>u&&(m[0]=u),m[1]<h&&(m[1]=h),r.xScale=r.k.scaleIdentification("time",m,c),r.extra_left_margin=0,r.new_data[0].data.forEach(function(t){r.xdomain.push(t.x)})),r.count=1,r.zoom_event=d3.behavior.zoom(),"string"!==r.axis_y_data_format&&"string"!==r.axis_x_data_format?r.zoom_event.x(r.xScale).y(r.yScale).scale(r.count).on("zoom",r.zoomed):r.zoom_event.y(r.yScale).scale(r.count).on("zoom",r.zoomed),PykCharts["boolean"](r.zoom_enable)&&"default"===r.mode){PykCharts["boolean"](r.panels_enable)?(n=r.new_data_length,j=0):(n=2,j=1);for(var f=j;f<n;f++)d3.selectAll(r.selector+" #"+r.container_id+"-"+f).call(r.zoom_event),d3.selectAll(r.selector+" #"+r.container_id+"-"+f).on("wheel.zoom",null).on("mousewheel.zoom",null)}r.chart_path=d3.svg.line().defined(function(t){return!isNaN(t.y)}).x(function(t){return r.xScale(t.x)}).y(function(t){return r.yScale(t.y)}).interpolate(r.interpolate);var x="lineChart"===r.type?"lineChart":"yes"===r.panels_enable?"panels_of_line":"multi_series_line";if(r.chartPathClass="lineChart"===r.type?"line":"multi-line","liveData"===t&&"lineChart"===r.type){for(var f=0;f<r.new_data_length;f++){var y=r.new_data[f].data,v=r.type+"-svg-"+f;r.svgContainer.select(r.selector+" #"+v).datum(r.new_data[f].data).attr("transform","translate("+r.extra_left_margin+",0)").style("stroke",function(){return r.new_data[f].highlight&&"multilineChart"===r.type&&!r.clicked?r.highlightLine(this,null):r.clicked?r.highlightLine(r.selected,null,r.previous_color):d3.select(this).classed({"multi-line-selected":!1,"multi-line":!0,"multi-line-hover":!1}),r.fillColor.colorPieMS(r.new_data[f],r.type)}).attr("data-id",function(t,e){return r.new_data[e]}),a(f),d3.selectAll(r.selector+" text#"+(r.type+"-svg-"+f)).style("fill",function(){return r.fillColor.colorPieMS(r.new_data[f],r.type)})}"default"===r.mode&&r.svgContainer.on("mouseout",function(t){r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")}).on("mousemove",function(){r.mouseEvent.crossHairPosition(r.new_data,r.xScale,r.yScale,r.dataLineGroup,r.extra_left_margin,r.xdomain,x,r.tooltipMode,null,r.container_id)})}else{if(r.clk=!0,PykCharts["boolean"](r.panels_enable))y=r.new_data[e].data,v=r.type+r.svgContainer.attr("id"),r.dataLineGroup[0]=r.chartBody.append("path"),r.dataLineGroup[0].datum(r.new_data1.data).attr({"class":"lines-hover "+r.chartPathClass,id:v,transform:"translate("+r.extra_left_margin+",0)","stroke-opacity":function(){return"saturation"===r.color_mode?(e+1)/r.new_data.length:1},"path-stroke-opacity":function(){return d3.select(this).attr("stroke-opacity")},"data-id":function(t,e){return r.new_data[e]}}).style("stroke",function(){return r.new_data[e].highlight&&r.highlightLine(this,null),r.fillColor.colorPieMS(r.new_data[e],r.type)}).on({click:function(t){"default"===r.mode&&(r.clicked=!0,r.highlightLine(PykCharts.getEvent().target,r.clicked,r.previous_color))},mouseover:function(t){this===r.selected||"saturation"!==r.color_mode&&!r.hover||"default"!==r.mode||(r.previous_color=d3.select(this).attr("stroke-opacity"),r.click_color=d3.select(this).style("stroke"),d3.select(this).classed({"multi-line-hover":!0,"multi-line":!1}).style("stroke","orange"))},mouseout:function(t,a){this===r.selected||"saturation"!==r.color_mode&&!r.hover||"default"!==r.mode||d3.select(this).classed({"multi-line-hover":!1,"multi-line":!0}).style("stroke",function(){return r.new_data[e].highlight&&r.highlightLine(this,null,r.previous_color),r.click_color}).attr("stroke-opacity",function(){return"saturation"===r.color_mode?r.previous_color:1})}}),i(e);else for(var f,f=0;f<r.new_data_length;f++){var v=r.type+"-svg-"+f;r.dataLineGroup[f]=r.chartBody.append("path");var y=r.new_data[f].data;r.dataLineGroup[f].datum(r.new_data[f].data).attr({"class":"lines-hover "+r.chartPathClass,id:v,transform:"translate("+r.extra_left_margin+",0)","stroke-opacity":function(){return"saturation"===r.color_mode?(f+1)/r.new_data.length:1},"path-stroke-opacity":function(){return d3.select(this).attr("stroke-opacity")}}).attr("name",function(t){return r.new_data[f].name}).attr("actual_color",function(){return r.fillColor.colorPieMS(r.new_data[f],r.type)}).attr("click_status",function(){var t=(new Date).getFullYear();return r.new_data[f].name===t.toString()||r.new_data[f].name===(t-1).toString()?"yes":"no"}).style("stroke",function(){r.new_data[f].highlight&&r.highlightLine(this,null);var t=(new Date).getFullYear();return r.new_data[f].name===t.toString()||r.new_data[f].name===(t-1).toString()?r.fillColor.colorPieMS(r.new_data[f],r.type):"#ddd"}).on("mouseover",function(){if("no"===this.getAttribute("click_status")){var t=d3.select(this).attr("actual_color"),e=this.getAttribute("name");d3.select(this).style("stroke",t),r.svgContainer.select(".legend-heading[name = '"+e+"']").style("stroke",t),r.svgContainer.select("g.focus[name = '"+e+"'] circle").style("fill",t)}}).on("mouseout",function(){if("no"===this.getAttribute("click_status")){var t=this.getAttribute("name");d3.select(this).style("stroke","#ddd"),r.svgContainer.select(".legend-heading[name = '"+t+"']").style("stroke","#ddd"),r.svgContainer.select("g.focus[name = '"+t+"'] circle").style("fill","#ddd")}}).on("click",function(){"no"===this.getAttribute("click_status")?this.setAttribute("click_status","yes"):(this.setAttribute("click_status","no"),d3.select(this).style("stroke","#ddd"),r.svgContainer.select(".legend-heading[name = '"+name+"']").style("stroke","#ddd"))}),o(f)}"lineChart"===r.type&&"default"===r.mode?r.svgContainer.on("mouseout",function(t){r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")}).on("mousemove",function(){r.mouseEvent.crossHairPosition(r.new_data,r.xScale,r.yScale,r.dataLineGroup,r.extra_left_margin,r.xdomain,x,r.tooltipMode,null,r.container_id)}):"multilineChart"===r.type&&"default"===r.mode&&r.svgContainer.on("mouseout",function(t){r.mouseEvent.tooltipHide(null,r.panels_enable,r.type),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")}).on("mousemove",function(){var t=[];t[0]=d3.select(r.selector+" #"+this.id+" .lines-hover"),r.mouseEvent.crossHairPosition(r.new_data,r.xScale,r.yScale,t,r.extra_left_margin,r.xdomain,x,r.tooltipMode,r.panels_enable,r.container_id,r.no_of_containers_in_row)})}return this},ticks:function(t){function e(){r.ticks.text(function(t,e){return t.name}).text(function(t,e){return r.ticks_text_width[e]=this.getBBox().width,t.name}).attr({dx:5,dy:5,name:function(t,e){return t.name}}).style({"font-size":r.pointer_size+"px","font-weight":function(t){return t.highlight?"bold":r.pointer_weight},"font-family":r.pointer_family,visibility:"visible",fill:function(t,e){var a=(new Date).getFullYear();return t.name===a.toString()||r.new_data[e].name===(a-1).toString()?r.fillColor.colorPieMS(r.new_data[e],r.type):"#ddd"},"pointer-events":"none"})}if(PykCharts["boolean"](r.pointer_size))if(PykCharts["boolean"](r.panels_enable)){var a=r.type+r.svgContainer.attr("id");"bottom"!==r.axis_x_position||"left"!==r.axis_y_position&&"right"!==r.axis_y_position?"top"!==r.axis_x_position||"left"!==r.axis_y_position&&"right"!==r.axis_y_position||(r.ticks[0]=r.svgContainer.append("text").attr({id:a,x:r.w-r.chart_margin_left,y:r.chart_height-r.chart_margin_bottom,dy:10,"text-anchor":"end"}).style({"font-size":r.pointer_size+"px","font-weight":r.pointer_weight,"font-family":r.pointer_family,fill:function(){return r.fillColor.colorPieMS(r.new_data1,r.type)}}).html(r.new_data1.name)):r.ticks[0]=r.svgContainer.append("text").attr({id:a,x:r.chart_margin_left,y:r.chart_margin_top,dy:-5}).style({"font-size":r.pointer_size+"px","font-weight":r.pointer_weight,"font-family":r.pointer_family,fill:function(){return r.fillColor.colorPieMS(r.new_data1,r.type)}}).html(r.new_data1.name)}else r.ticks_text_width=[],tickPosition=function(t,e){var a,n,o,i=r.new_data[e].data.length;if("left"===r.axis_y_position)if("NA"!==r.new_data[e].data[r.new_data[e].data.length-1].y)a=r.xScale(r.new_data[e].data[r.new_data[e].data.length-1].x)+r.extra_left_margin+r.chart_margin_left,n=r.yScale(r.new_data[e].data[r.new_data[e].data.length-1].y)+r.chart_margin_top;else{for(a=r.xScale(r.new_data[e].data[r.new_data[e].data.length-1].x)+r.extra_left_margin+r.chart_margin_left,o=0;i>o&&"NA"!==r.new_data[e].data[o].y;o++);n=r.yScale(r.new_data[e].data[o-1].y)+r.chart_margin_top}else"right"===r.axis_y_position&&(a=r.xScale(r.new_data[e].data[0].x)+r.extra_left_margin+r.chart_margin_left-10,n=r.yScale(r.new_data[e].data[0].y)+r.chart_margin_top);return text_x=a,text_y=n,text_rotate=0,"translate("+text_x+","+text_y+") rotate("+text_rotate+")"},orient=function(){return"left"===r.axis_y_position?"start":"right"===r.axis_y_position?"end":void 0},r.ticks=r.svgContainer.selectAll(".legend-heading").data(r.new_data),r.ticks.enter().append("text"),r.ticks.attr({id:function(t,e){return r.type+"-svg-"+e},"class":"legend-heading",transform:tickPosition,"text-anchor":orient}),r.ticks.text(function(t,e){return""}),setTimeout(e,r.transitions.duration()),r.ticks.exit().remove();return this}};return e},r.zoomed=function(){if(PykCharts["boolean"](r.panels_enable))for(var t=0;t<r.new_data_length;t++){
var e=r.type;currentContainer=d3.selectAll("#"+r.container_id+"-"+t),r.k.isOrdinal(currentContainer,".x.axis",r.xScale,r.xdomain,r.extra_left_margin),r.k.isOrdinal(currentContainer,".x.grid",r.xScale),r.k.isOrdinal(currentContainer,".y.axis",r.yScale,r.ydomain),r.k.isOrdinal(currentContainer,".y.grid",r.yScale),currentContainer.select("#"+e+r.container_id+"-"+t).attr({"class":"lines-hover "+r.chartPathClass,d:r.chart_path})}else{PykCharts["boolean"](r.pointer_overflow_enable)&&r.svgContainer.style("overflow","hidden"),r.k.isOrdinal(r.svgContainer,".x.axis",r.xScale,r.xdomain,r.extra_left_margin),r.k.isOrdinal(r.svgContainer,".x.grid",r.xScale),r.k.isOrdinal(r.svgContainer,".y.axis",r.yScale,r.ydomain),r.k.isOrdinal(r.svgContainer,".y.grid",r.yScale);for(var t=0;t<r.new_data_length;t++){var e=r.type+"-svg-"+t;r.svgContainer.select(r.selector+" #"+e).attr({"class":"lines-hover "+r.chartPathClass,d:r.chart_path})}}"dblclick"===PykCharts.getEvent().sourceEvent.type&&r.count++,r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis"),r.count===r.zoom_level+1&&r.zoomOut(),PykCharts["boolean"](r.annotation_enable)&&r.annotation(),r.optionalFeature().ticks()},r.zoomOut=function(){if(PykCharts["boolean"](r.pointer_overflow_enable)&&!PykCharts["boolean"](r.panels_enable)&&r.svgContainer.style("overflow","visible"),PykCharts["boolean"](r.panels_enable)){for(var t=0;t<r.previous_length;t++){var e=document.querySelector(r.selector+" #panels_of_line_main_div #chart-container-"+t);e.parentNode.removeChild(e)}r.renderPanelOfLines()}"lineChart"===r.type?r.optionalFeature().createChart("liveData"):"multilineChart"!==r.type||PykCharts["boolean"](r.panels_enable)||(document.querySelector(r.selector+" #chart-container-1").innerHTML=null,r.renderLineChart()),r.k.isOrdinal(r.svgContainer,".x.axis",r.xScale,r.xdomain,r.extra_left_margin),r.k.isOrdinal(r.svgContainer,".x.grid",r.xScale),r.k.isOrdinal(r.svgContainer,".y.axis",r.yScale,r.ydomain),r.k.isOrdinal(r.svgContainer,".y.grid",r.yScale)},r.onBrush=function(t,e){r.addEvents(t,e)},r.highlightLine=function(t,e,a){r.selected_line=t,r.selected_line_data=r.selected_line.__data__,r.selected_line_data_len=r.selected_line_data.length,r.deselected=r.selected,r.selected=t,"multilineChart"!==r.type||"saturation"!==r.color_mode&&!r.hover||d3.select(r.selected).style("stroke",function(t,e){return r.click_color}),e&&(d3.select(r.selected).classed("multi-line")?(d3.selectAll(r.selector+" path.multi-line").attr("stroke-opacity",.3),"color"===r.color_mode&&d3.selectAll(r.selector+" .legend-heading").style("opacity",.3),d3.select(r.selector+" text#"+r.selected.id).style("opacity",1).style("font-weight","bold"),d3.selectAll(".lines-hover").attr("stroke-opacity",.3).classed({"multi-line-selected":!1,"multi-line":!0}),d3.select(r.selected).attr("stroke-opacity",1).classed({"multi-line-selected":!0,"multi-line":!1})):("color"===r.color_mode?d3.selectAll(r.selector+" path.multi-line").attr("stroke-opacity",a):d3.selectAll(r.selector+" path.multi-line").attr("stroke-opacity",function(){return d3.select(this).attr("path-stroke-opacity")}),d3.selectAll(r.selector+" .legend-heading").style("opacity",1),d3.select(r.selector+" text#"+r.selected.id).style({opacity:1,"font-weight":"normal"}),d3.select(r.selected).attr("stroke-opacity",a).classed({"multi-line-selected":!1,"multi-line":!0})))},r.annotation=function(){function t(t,e){function a(){o.attr("class","PykCharts-annotation-line").attr("d",function(t,e){var a=[{x:parseInt(r.xScale(t.x)-.5*n)+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-n+r.chart_margin_top)},{x:parseInt(r.xScale(t.x)+.5*n)+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-n+r.chart_margin_top)},{x:parseInt(r.xScale(t.x))+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)+r.chart_margin_top)}];return r.line(a)}).attr("fill",r.annotation_background_color)}var o=d3.select(r.selector+" #"+r.container_id+"-"+e).selectAll(r.selector+" .PykCharts-annotation-line").data(t);o.enter().append("path"),o.attr("d",function(t,e){var a=[{x:parseInt(r.xScale(t.x))+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-n+r.chart_margin_top)},{x:parseInt(r.xScale(t.x))+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-n+r.chart_margin_top)}];return r.line(a)}),setTimeout(a,r.transitions.duration()),o.exit().remove()}if(r.line=d3.svg.line().interpolate("linear-closed").x(function(t,e){return t.x}).y(function(t,e){return t.y}),PykCharts["boolean"](r.panels_enable)){if(PykCharts["boolean"](r.panels_enable))for(var e=0;e<r.new_data_length;e++){var a=[],n=12;r.new_data[e].data.map(function(t){t.annotation&&a.push({annotation:t.annotation,x:t.x,y:t.y})}),t(a,e),r.k.annotation(r.selector+" #"+r.container_id+"-"+e,a,r.xScale,r.yScale)}}else{for(var n=12,a=[],e=0;e<r.new_data_length;e++)r.new_data[e].data.map(function(t){t.annotation&&a.push({annotation:t.annotation,x:t.x,y:t.y})});t(a,1),r.k.annotation(r.selector+" #svg-1",a,r.xScale,r.yScale)}},r.renderPanelOfLines=function(){for(var t=0;t<r.new_data_length;t++){var e=r.selector.substr(1,r.selector.length);d3.selectAll("#tooltip-svg-container-"+t+"-pyk-tooltip"+e).remove(),r.k.makeMainDiv(r.selector+" #panels_of_line_main_div",t).tooltip(!0,r.selector,t),r.new_data1=r.new_data[t],r.fill_data[0]=r.new_data1,r.optionalFeature().svgContainer(t).createGroups(t),r.k.crossHair(r.svgContainer,1,r.fill_data,r.fillColor,r.type),r.mouseEvent=new PykCharts.crossHairMovement(r),r.optionalFeature().createChart(null,t).ticks(t).axisContainer(),r.k.xAxis(r.svgContainer,r.xGroup,r.xScale,r.extra_left_margin,r.xdomain,r.x_tick_values).yAxis(r.svgContainer,r.yGroup,r.yScale,r.ydomain,r.y_tick_values).xAxisTitle(r.xGroup).yAxisTitle(r.yGroup),"default"===r.mode&&r.k.yGrid(r.svgContainer,r.group,r.yScale).xGrid(r.svgContainer,r.group,r.xScale)}r.k.exportSVG(r,r.container_id+"-","lineChart",r.panels_enable,r.new_data),r.k.emptyDiv(r.selector)},r.renderLineChart=function(){function t(){PykCharts["boolean"](r.pointer_size)&&(e=d3.max(r.ticks_text_width,function(t){return t})),r.k.exportSVG(r,"#"+r.container_id+"-1","lineChart",void 0,void 0,e)}r.optionalFeature().svgContainer(1).createGroups(1).hightLightOnload(),r.k.crossHair(r.svgContainer,r.new_data_length,r.new_data,r.fillColor,r.type),r.mouseEvent=new PykCharts.crossHairMovement(r),r.optionalFeature().createChart().ticks().axisContainer(),r.k.xAxis(r.svgContainer,r.xGroup,r.xScale,r.extra_left_margin,r.xdomain,r.x_tick_values).yAxis(r.svgContainer,r.yGroup,r.yScale,r.ydomain,r.y_tick_values).xAxisTitle(r.xGroup).yAxisTitle(r.yGroup),PykCharts["boolean"](r.interactive_enable)&&(r.brush=new PykCharts.Configuration.renderBrush(r,r.xScale,r.group,r.reducedHeight)),"default"===r.mode&&r.k.yGrid(r.svgContainer,r.group,r.yScale).xGrid(r.svgContainer,r.group,r.xScale);var e=0;setTimeout(t,r.transitions.duration())},r.dataTransformation(),r.render()},PykCharts.multiD.area=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.crossHair(e),PykCharts.annotation(e),PykCharts.scaleFunction(e),PykCharts.grid(e),e.k.storeInitialDivHeight(),!e.stop){"default"===e.mode&&e.k.loading();var n=a.multiDimensionalCharts;a.stylesheet,t.optional;e.crosshair_enable=t.crosshair_enable?t.crosshair_enable.toLowerCase():n.crosshair_enable,e.curvy_lines_enable=t.curvy_lines_enable?t.curvy_lines_enable.toLowerCase():n.curvy_lines_enable,e.panels_enable="no",e.interpolate=PykCharts["boolean"](e.curvy_lines_enable)?"cardinal":"linear",e.w=e.chart_width-e.chart_margin_left-e.chart_margin_right,e.h=e.chart_height-e.chart_margin_top-e.chart_margin_bottom,e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);return e.stop||r===!1?void e.k.remove_loading_bar(n):(e.data=e.k.__proto__._groupBy("area",a),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.compare_data=e.data,e.data_length=e.data.length,e.k.remove_loading_bar(n),"string"===e.axis_x_data_format?e.data_sort_enable="no":(e.data_sort_enable="yes",e.data_sort_type="time"===e.axis_x_data_format?"date":"numerically",e.data_sort_order="ascending"),PykCharts.multiD.areaFunctions(t,e,"area"),e.dataTransformation(),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.stackedArea=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){if(e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.crossHair(e),PykCharts.annotation(e),PykCharts.scaleFunction(e),PykCharts.grid(e),!e.stop){e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading();var n=a.multiDimensionalCharts;a.stylesheet,t.optional;e.crosshair_enable=t.crosshair_enable?t.crosshair_enable.toLowerCase():n.crosshair_enable,e.curvy_lines_enable=t.curvy_lines_enable?t.curvy_lines_enable.toLowerCase():n.curvy_lines_enable,e.panels_enable="no",e.interpolate=PykCharts["boolean"](e.curvy_lines_enable)?"cardinal":"linear",e.w=e.chart_width-e.chart_margin_left-e.chart_margin_right,e.h=e.chart_height-e.chart_margin_top-e.chart_margin_bottom,e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);return e.stop||r===!1?void e.k.remove_loading_bar(n):(e.data=e.k.__proto__._groupBy("area",a),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.compare_data=e.data,e.data_length=e.data.length,e.k.remove_loading_bar(n),"string"===e.axis_x_data_format?e.data_sort_enable="no":(e.data_sort_enable="yes",e.data_sort_type="time"===e.axis_x_data_format?"date":"numerically",e.data_sort_order="ascending"),PykCharts.multiD.areaFunctions(t,e,"stacked_area"),e.dataTransformation(),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.areaFunctions=function(t,e,a){var r=e;r.dataTransformation=function(){r.group_arr=[],r.new_data=[],r.ticks=[],r.x_arr=[];for(var t=0;t<r.data_length;t++)r.group_arr[t]=r.data[t].name;r.uniq_group_arr=r.k.__proto__._unique(r.group_arr),r.uniq_color_arr=[];for(var e=r.uniq_group_arr.length,a=0;a<r.data_length;a++)r.x_arr[a]=r.data[a].x;r.uniq_x_arr=r.k.__proto__._unique(r.x_arr);for(var a=0;e>a;a++)if(r.chart_color[a])r.uniq_color_arr[a]=r.chart_color[a];else{for(var n=0;n<r.data_length;n++)if(r.uniq_group_arr[a]===r.data[n].name&&r.data[n].color){r.uniq_color_arr[a]=r.data[n].color;break}PykCharts["boolean"](r.uniq_color_arr[a])||(r.uniq_color_arr[a]=r.default_color[0])}r.flag=0;for(var a=0;e>a;a++){r.new_data[a]={name:r.uniq_group_arr[a],data:[],color:r.uniq_color_arr[a]};for(var n=0;n<r.data_length;n++)r.uniq_group_arr[a]===r.data[n].name&&r.new_data[a].data.push({x:r.data[n].x,y:r.data[n].y,tooltip:r.data[n].tooltip,annotation:r.data[n].annotation||""})}r.new_data_length=r.new_data.length;for(var o=r.uniq_x_arr.length,i=0;i<r.new_data_length;i++){for(var l=r.k.__proto__._unique(r.x_arr),s=r.new_data[i].data.length,_=0;s>_;_++)for(var a=0;o>a;a++)if(r.new_data[i].data[_].x===l[a]){l[a]=void 0;break}for(var c=0;o>c;c++)if(void 0!=l[c]){var d={x:l[c],y:0,tooltip:0,annotation:""};r.new_data[i].data.splice(c,0,d)}}for(var a=0;a<r.new_data_length;a++)r.new_data[a].data=r.k.__proto__._sortData(r.new_data[a].data,"x","name",r)},r.render=function(){var e=r.selector.substring(1,r.selector.length);r.container_id=e+"_svg",r.dataLineGroup=[],r.dataLineGroupBorder=[],r.multid=new PykCharts.multiD.configuration(r),r.fillColor=new PykCharts.Configuration.fillChart(r,null,t),r.transitions=new PykCharts.Configuration.transition(r),r.border=new PykCharts.Configuration.border(r),r.xdomain=[],r.optional_feature().chartType();try{if("stackedAreaChart"===r.type&&"area"===a)throw"Invalid data in the JSON"}catch(n){return void console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+r.selector+'."'+n+'"  Visit www.pykcharts.com/errors#error_7')}if("time"===r.axis_x_data_format)for(var o=0;o<r.new_data_length;o++)r.new_data[o].data.forEach(function(t){t.x=r.k.dateConversion(t.x),r.xdomain.push(t.x)}),r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)});if("default"===r.mode){var i=r.selector.substr(1,r.selector.length);d3.selectAll("#tooltip-svg-container-1-pyk-tooltip"+i).remove(),r.k.title().backgroundColor(r)["export"](r,"#"+r.container_id+"-1","areaChart").liveData(r).emptyDiv(r.selector).subtitle().makeMainDiv(r.selector,1).tooltip(!0,r.selector,1),r.renderChart(),r.k.xAxis(r.svgContainer,r.xGroup,r.xScale,r.extra_left_margin,r.xdomain,r.x_tick_values,r.legendsGroup_height).yAxis(r.svgContainer,r.yGroup,r.yScale,r.ydomain,r.y_tick_values,r.legendsGroup_width).yGrid(r.svgContainer,r.group,r.yScale,r.legendsGroup_width).xGrid(r.svgContainer,r.group,r.xScale,r.legendsGroup_height).xAxisTitle(r.xGroup,r.legendsGroup_height,r.legendsGroup_width).yAxisTitle(r.yGroup).createFooter().lastUpdatedAt().credits().dataSource(),PykCharts["boolean"](r.annotation_enable)&&r.annotation()}else"infographics"===r.mode&&(r.k.backgroundColor(r)["export"](r,"#"+r.container_id+"-1","areaChart").emptyDiv(r.selector).makeMainDiv(r.selector,1),r.optional_feature().svgContainer(1).legendsContainer().createGroups(1).createChart().axisContainer(),r.k.xAxis(r.svgContainer,r.xGroup,r.xScale,r.extra_left_margin,r.xdomain,r.x_tick_values,r.legendsGroup_height).yAxis(r.svgContainer,r.yGroup,r.yScale,r.ydomain,r.y_tick_values,r.legendsGroup_width).xAxisTitle(r.xGroup,r.legendsGroup_height,r.legendsGroup_width).yAxisTitle(r.yGroup));PykCharts["boolean"](r.interactive_enable)&&(r.brush=new PykCharts.Configuration.renderBrush(r,r.xScale,r.group,r.h)),r.k.exportSVG(r,"#"+r.container_id+"-1","areaChart"),r.mouseEvent=new PykCharts.crossHairMovement(r);var l=r.k.resize(r.svgContainer);r.k.__proto__._ready(l),window.addEventListener("resize",function(t){return r.k.resize(r.svgContainer)})},r.refresh=function(e){r.xdomain=[],r.executeRefresh=function(t){r.data=r.k.__proto__._groupBy("area",t),r.data_length=r.data.length,r.dataTransformation();var e=r.k.checkChangeInData(r.data,r.compare_data);r.compare_data=e[0];var a=e[1];if((a||PykCharts["boolean"](r.zoom_enable)&&r.count>1&&r.count<=r.zoom_level||r.transition_duration)&&(r.k.lastUpdatedAt("liveData"),r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")),"time"===r.axis_x_data_format)for(var n=0;n<r.new_data_length;n++)r.new_data[n].data.forEach(function(t){t.x=r.k.dateConversion(t.x),r.xdomain.push(t.x)}),r.data.forEach(function(t){t.x=r.k.dateConversion(t.x)});"stackedAreaChart"===r.type?(document.querySelector(r.selector+" #chart-container-1").innerHTML=null,r.renderChart()):r.optional_feature().createChart("liveData"),r.k.xAxis(r.svgContainer,r.xGroup,r.xScale,r.extra_left_margin,r.xdomain,r.x_tick_values,r.legendsGroup_height).yAxis(r.svgContainer,r.yGroup,r.yScale,r.ydomain,r.y_tick_values,r.legendsGroup_width).yGrid(r.svgContainer,r.group,r.yScale,r.legendsGroup_width).xGrid(r.svgContainer,r.group,r.xScale,r.legendsGroup_height),PykCharts["boolean"](r.annotation_enable)&&r.annotation()},PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeRefresh")):r.k.dataSourceFormatIdentification(t.data,r,"executeRefresh")},r.optional_feature=function(){var t=r.selector.substring(1,r.selector.length),e={chartType:function(){for(var t=1;t<r.data_length;t++)if(r.data[0].x===r.data[t].x){r.type="stackedAreaChart";break}return r.type=r.type||"areaChart",this},svgContainer:function(e){var a=document.getElementById(t);return a.classList.contains("PykCharts-line-chart")||(a.className+=" PykCharts-twoD PykCharts-line-chart PykCharts-multi-series2D"),r.svgContainer=d3.select(r.selector+" #chart-container-"+e).append("svg:svg").attr({id:r.container_id+"-"+e,width:r.chart_width,height:r.chart_height,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+r.chart_width+" "+r.chart_height}),this},createGroups:function(t){return r.group=r.svgContainer.append("g").attr({id:r.type+"-group",transform:"translate("+r.chart_margin_left+","+(r.chart_margin_top+r.legendsGroup_height)+")"}),PykCharts["boolean"](r.chart_grid_y_enable)&&r.group.append("g").attr({id:"ygrid","class":"y grid-line"}),PykCharts["boolean"](r.chart_grid_x_enable)&&r.group.append("g").attr({id:"xgrid","class":"x grid-line"}),r.clip=r.svgContainer.append("svg:clipPath").attr("id","clip"+t+r.selector).append("svg:rect").attr({width:r.w-r.legendsGroup_width,height:r.h-r.legendsGroup_height}),r.chartBody=r.svgContainer.append("g").attr({id:"clipPath","clip-path":"url(#clip"+t+r.selector+" )",transform:"translate("+r.chart_margin_left+","+(r.chart_margin_top+r.legendsGroup_height)+")"}),r.stack_layout=d3.layout.stack().values(function(t){return t.data}),this},legendsContainer:function(t){return PykCharts["boolean"](r.legends_enable)&&"stackedAreaChart"===r.type&&"default"===r.mode?r.legendsGroup=r.svgContainer.append("g").attr("id","stackedArea-legends").style("visibility","visible").attr("transform","translate(0,10)"):(r.legendsGroup_height=0,r.legendsGroup_width=0),this},axisContainer:function(){return(PykCharts["boolean"](r.axis_x_enable)||r.axis_x_title)&&(r.xGroup=r.group.append("g").attr({id:"xaxis","class":"x axis"})),(PykCharts["boolean"](r.axis_y_enable)||r.axis_y_title)&&(r.yGroup=r.group.append("g").attr({id:"yaxis","class":"y axis"})),this},createChart:function(t){function e(t){r.dataLineGroup[t].transition().duration(r.transitions.duration()).attrTween("d",function(e){var a=d3.scale.quantile().domain([0,1]).range(d3.range(1,x.length+1));return function(e){return r.chart_path(r.new_data[t].data.slice(0,a(e)))}})}function n(t){r.dataLineGroupBorder[t].transition().duration(r.transitions.duration()).attrTween("d",function(e){var a=d3.scale.quantile().domain([0,1]).range(d3.range(1,r.layers[t].data.length+1));return function(e){return r.chart_path_border(r.layers[t].data.slice(0,a(e)))}})}function o(t){r.dataLineGroup[t].transition().duration(r.transitions.duration()).attrTween("d",function(e){var a=d3.scale.quantile().domain([0,1]).range(d3.range(1,x.length+1));return function(e){return r.chart_path(r.new_data[t].data.slice(0,a(e)))}})}function i(t){r.dataLineGroupBorder[t].transition().duration(r.transitions.duration()).attrTween("d",function(e){var a=d3.scale.quantile().domain([0,1]).range(d3.range(1,r.layers[t].data.length+1));return function(e){return r.chart_path_border(r.layers[t].data.slice(0,a(e)))}})}r.legend_text=[],r.layers=r.stack_layout(r.new_data);var l,s,_,c,d,u,h,p,g,m=[];if(r.count=1,r.x_tick_values=r.k.processXAxisTickValues(),r.y_tick_values=r.k.processYAxisTickValues(),"number"===r.axis_y_data_format?(max=d3.max(r.layers,function(t){return d3.max(t.data,function(t){return t.y0+t.y})}),min=0,d=[min,max],s=r.k.__proto__._domainBandwidth(d,1),_=[r.h-r.legendsGroup_height,0],p=d3.min(r.y_tick_values),g=d3.max(r.y_tick_values),s[0]>p&&(s[0]=p),s[1]<g&&(s[1]=g),r.yScale=r.k.scaleIdentification("linear",s,_)):"string"===r.axis_y_data_format?(r.new_data[0].data.forEach(function(t){s.push(t.y)}),_=[0,r.h],r.yScale=r.k.scaleIdentification("ordinal",s,_,0)):"time"===r.axis_y_data_format&&(r.layers.data.forEach(function(t){t.y0=new Date(t.y0),t.y=new Date(t.y)}),max=d3.max(r.layers,function(t){return d3.max(t.data,function(t){return t.y0+t.y})}),min=0,s=[min,max],_=[r.h,0],p=d3.min(r.y_tick_values,function(t){return new Date(t)}),g=d3.max(r.y_tick_values,function(t){return new Date(t)}),new Date(s[0])>new Date(p)&&(s[0]=p),new Date(s[1])<new Date(g)&&(s[1]=g),r.yScale=r.k.scaleIdentification("time",s,_)),"number"===r.axis_x_data_format?(max=d3.max(r.new_data,function(t){return d3.max(t.data,function(t){return+t.x})}),min=d3.min(r.new_data,function(t){return d3.min(t.data,function(t){return+t.x})}),l=[min,max],m=r.k.__proto__._domainBandwidth(l,2),c=[0,r.w-r.legendsGroup_width],u=d3.min(r.x_tick_values),h=d3.max(r.x_tick_values),m[0]>u&&(m[0]=u),m[1]<h&&(m[1]=h),r.xScale=r.k.scaleIdentification("linear",m,c),r.extra_left_margin=0,r.new_data[0].data.forEach(function(t){r.xdomain.push(+t.x)})):"string"===r.axis_x_data_format?(r.new_data[0].data.forEach(function(t){m.push(t.x)}),c=[0,r.w-r.legendsGroup_width],r.xScale=r.k.scaleIdentification("ordinal",m,c,0),r.extra_left_margin=r.xScale.rangeBand()/2,r.xdomain=r.xScale.domain()):"time"===r.axis_x_data_format&&(max=d3.max(r.new_data,function(t){return d3.max(t.data,function(t){return t.x})}),min=d3.min(r.new_data,function(t){return d3.min(t.data,function(t){return t.x})}),m=[min,max],c=[0,r.w-r.legendsGroup_width],u=d3.min(r.x_tick_values,function(t){return r.k.dateConversion(t)}),h=d3.max(r.x_tick_values,function(t){return r.k.dateConversion(t)}),new Date(m[0])>new Date(u)&&(m[0]=u),new Date(m[1])<new Date(h)&&(m[1]=h),r.xScale=r.k.scaleIdentification("time",m,c),r.extra_left_margin=0,r.new_data[0].data.forEach(function(t){r.xdomain.push(t.x)})),r.ydomain=r.yScale.domain(),r.zoom_event=d3.behavior.zoom(),"string"!==r.axis_y_data_format&&"string"!==r.axis_x_data_format?r.zoom_event.x(r.xScale).y(r.yScale).scale(r.count).on("zoom",r.zoomed):r.zoom_event.y(r.yScale).scale(r.count).on("zoom",r.zoomed),PykCharts["boolean"](r.zoom_enable)&&"default"===r.mode&&(r.svgContainer.call(r.zoom_event),r.svgContainer.on({"wheel.zoom":null,"mousewheel.zoom":null})),r.chart_path=d3.svg.area().x(function(t){return r.xScale(t.x)}).y0(function(t){return r.yScale(t.y0)}).y1(function(t){return r.yScale(t.y0+t.y)}).interpolate(r.interpolate),r.chart_path_border=d3.svg.line().x(function(t){return r.xScale(t.x)}).y(function(t){return r.yScale(t.y0+t.y)}).interpolate(r.interpolate),r.chartPathClass="areaChart"===r.type?"area":"stacked-area","liveData"===t){for(var f=0;f<r.new_data_length;f++){var x=r.new_data[f].data;a=r.chartPathClass+f,r.svgContainer.select("#"+a).datum(r.layers[f].data).attr("transform","translate("+r.extra_left_margin+",0)").style({stroke:r.border.color(),"stroke-width":r.border.width(),"stroke-dasharray":r.border.style()}),e(f),r.svgContainer.select("#border-stacked-area"+f).datum(r.layers[f].data).attr("transform","translate("+r.extra_left_margin+",0)"),n(f)}"areaChart"===r.type&&r.svgContainer.on("mouseout",function(t){r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")}).on("mousemove",function(){r.mouseEvent.crossHairPosition(r.new_data,r.xScale,r.yScale,r.dataLineGroup,r.extra_left_margin,r.xdomain,r.type,r.tooltip_mode)})}else{for(var f=0;f<r.new_data_length;f++){var x=r.new_data[f].data;a=r.chartPathClass+f,r.dataLineGroup[f]=r.chartBody.append("path"),r.dataLineGroup[f].datum(r.layers[f].data).attr({"class":r.chartPathClass,id:a,"fill-opacity":function(){return"stackedAreaChart"===r.type&&"saturation"===r.color_mode?(f+1)/r.new_data.length:void 0},"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},transform:"translate("+r.extra_left_margin+",0)","data-id":function(t,e){return r.new_data[e]}}).style("fill",function(t){return r.fillColor.colorPieMS(r.new_data[f],r.type)}),o(f),r.dataLineGroupBorder[f]=r.chartBody.append("path"),r.dataLineGroupBorder[f].datum(r.layers[f].data).attr({"class":"area-border",id:"border-stacked-area"+f,transform:"translate("+r.extra_left_margin+",0)"}).style({stroke:r.border.color(),"stroke-width":r.border.width(),"stroke-dasharray":r.border.style(),"pointer-events":"none"}),i(f)}r.svgContainer.on("mouseout",function(t){r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis")}).on("mousemove",function(){if("areaChart"===r.type)r.mouseEvent.crossHairPosition(r.new_data,r.xScale,r.yScale,r.dataLineGroup,r.extra_left_margin,r.xdomain,r.type,r.tooltip_mode);else if("stackedAreaChart"===r.type){var t=[];t[0]=d3.select(r.selector+" #"+this.id+" .stacked-area"),r.mouseEvent.crossHairPosition(r.new_data,r.xScale,r.yScale,t,r.extra_left_margin,r.xdomain,r.type,r.tooltipMode,r.color_from_data,"no")}})}return d3.selectAll(r.selector+" ."+r.chartPathClass).on({mouseover:function(){"default"===r.mode&&r.mouseEvent.highlight(r.selector+" ."+r.chartPathClass,this)},mouseout:function(){"default"===r.mode&&r.mouseEvent.highlightHide(r.selector+" ."+r.chartPathClass)}}),this},legends:function(){return PykCharts["boolean"](r.legends_enable)&&"stackedAreaChart"===r.type&&"default"===r.mode&&r.multid.legendsPosition(r,"stackedArea",r.new_data),this}};return e},r.zoomed=function(){for(r.k.isOrdinal(r.svgContainer,".x.axis",r.xScale,r.xdomain,r.extra_left_margin),r.k.isOrdinal(r.svgContainer,".x.grid",r.xScale),r.k.isOrdinal(r.svgContainer,".y.axis",r.yScale,r.ydomain),r.k.isOrdinal(r.svgContainer,".y.grid",r.yScale),i=0;i<r.new_data_length;i++)a=r.chartPathClass+i,r.svgContainer.select(r.selector+" #"+a).attr({"class":r.chartPathClass,d:r.chart_path}),r.svgContainer.select(r.selector+" #border-stacked-area"+i).attr({"class":"area-border",d:r.chart_path_border});"dblclick"===PykCharts.getEvent().sourceEvent.type&&r.count++,r.mouseEvent.tooltipHide(),r.mouseEvent.crossHairHide(r.type),r.mouseEvent.axisHighlightHide(r.selector+" .x.axis"),r.mouseEvent.axisHighlightHide(r.selector+" .y.axis"),r.count===r.zoom_level+1&&r.zoomOut(),PykCharts["boolean"](r.annotation_enable)&&r.annotation()},r.zoomOut=function(){r.optional_feature().createChart("liveData"),r.k.isOrdinal(r.svgContainer,".x.axis",r.xScale,r.xdomain,r.extra_left_margin),r.k.isOrdinal(r.svgContainer,".x.grid",r.xScale),r.k.isOrdinal(r.svgContainer,".y.axis",r.yScale,r.ydomain),r.k.isOrdinal(r.svgContainer,".y.grid",r.yScale)},r.onBrush=function(t,e){r.addEvents(t,e)},r.annotation=function(){function t(){n.attr("class","PykCharts-annotation-line").attr("d",function(t,a){var n=[{x:parseInt(r.xScale(t.x)-.5*e)+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-e+r.chart_margin_top+r.legendsGroup_height)},{x:parseInt(r.xScale(t.x)+.5*e)+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-e+r.chart_margin_top+r.legendsGroup_height)},{x:parseInt(r.xScale(t.x))+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)+r.chart_margin_top+r.legendsGroup_height)}];return r.line(n)}).attr("fill",r.annotation_background_color)}r.line=d3.svg.line().interpolate("linear-closed").x(function(t,e){return t.x}).y(function(t,e){return t.y});var e=12,a=[];if("areaChart"===r.type)r.new_data[0].data.map(function(t){t.annotation&&a.push({annotation:t.annotation,x:t.x,y:t.y})});else if("stackedAreaChart"===r.type&&"default"===r.mode)for(i=0;i<r.new_data_length;i++)r.new_data[i].data.map(function(t){t.annotation&&a.push({annotation:t.annotation,x:t.x,y:t.y+t.y0})});var n=r.svgContainer.selectAll(" .PykCharts-annotation-line").data(a);n.enter().append("path"),n.attr("d",function(t,a){var n=[{x:parseInt(r.xScale(t.x))+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-e+r.chart_margin_top+r.legendsGroup_height)},{x:parseInt(r.xScale(t.x))+r.extra_left_margin+r.chart_margin_left,y:parseInt(r.yScale(t.y)-e+r.chart_margin_top+r.legendsGroup_height)}];return r.line(n)}),setTimeout(t,r.transitions.duration()),n.exit().remove(),r.k.annotation(r.selector+" #"+r.container_id+"-1",a,r.xScale,r.yScale)},r.renderChart=function(){r.optional_feature().svgContainer(1).legendsContainer().legends().createGroups(1).createChart().axisContainer(),r.k.crossHair(r.svgContainer,r.new_data_length,r.new_data,r.fillColor,r.type)}},PykCharts.multiD.bar=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({}),r=a.multiDimensionalCharts;this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.scaleFunction(e),e.data_sort_enable=t.data_sort_enable?t.data_sort_enable.toLowerCase():r.data_sort_enable,e.data_sort_type=PykCharts["boolean"](e.data_sort_enable)&&t.data_sort_type?t.data_sort_type.toLowerCase():r.data_sort_type,e.data_sort_order=PykCharts["boolean"](e.data_sort_enable)&&t.data_sort_order?t.data_sort_order.toLowerCase():r.data_sort_order;try{if("ascending"!==e.data_sort_order&&"descending"!==e.data_sort_order)throw e.data_sort_order=r.data_sort_order,"data_sort_order"}catch(n){e.k.warningHandling(n,"9")}e.stop||(e.k.storeInitialDivHeight(),e.panels_enable="no","default"===e.mode&&e.k.loading(),e.multiD=new PykCharts.multiD.configuration(e),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("bar",t),e.compare_data=e.k.__proto__._groupBy("bar",t),e.axis_x_data_format="number",e.axis_y_data_format=e.k.yAxisDataFormatIdentification(e.data),"time"===e.axis_y_data_format&&(e.axis_y_data_format="string"),e.k.remove_loading_bar(r),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},this.transformData=function(){var a=[],r=[];if(e.optionalFeatures().sort(),void 0!=t.chart_color&&0!=t.chart_color.length)e.chart_color[0]=t.chart_color[0];else for(var n=0,o=e.data.length;o>n;n++)if(void 0!=e.data[n].color&&""!=e.data[n].color){e.chart_color[0]=e.data[n].color,(void 0==t.axis_y_pointer_color||""==t.axis_y_pointer_color)&&(e.axis_y_pointer_color=e.chart_color[0]);break}e.data.forEach(function(t){t.x="number"===e.axis_x_data_format?parseFloat(t.x):t.x,t.name=t.y,t.color=e.chart_color[0]});for(var i=0,o=e.data.length;o>i;i++)a[i]=e.data[i].group;r=e.k.__proto__._unique(a),e.no_of_groups=r.length},this.render=function(){var a=e.selector.substring(1,e.selector.length),r=a+"_svg";e.border=new PykCharts.Configuration.border(e),e.transitions=new PykCharts.Configuration.transition(e),e.mouseEvent1=new PykCharts.Configuration.mouseEvent(t),e.fillColor=new PykCharts.Configuration.fillChart(e,null,t),e.transformData();try{if(e.no_of_groups>1)throw"Invalid data in the JSON"}catch(n){return void console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+e.selector+'. "'+n+'"  Visit www.pykcharts.com/errors#error_9')}e.map_group_data=e.multiD.mapGroup(e.data),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+r,"barChart").emptyDiv(e.selector).subtitle().makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).createGroups(),e.k.liveData(e).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().createColumn().axisContainer().ticks(),e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values).xAxisTitle(e.xgroup).yAxisTitle(e.ygroup),
"string"!==e.axis_y_data_format?(e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values,null,"bar",null,e),e.optionalFeatures().newYAxis()):e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values,null,null,null,e)):"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+r,"barChart").emptyDiv(e.selector).makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).createGroups(),e.k.liveData(e).tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().createColumn().axisContainer().ticks(),e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values).xAxisTitle(e.xgroup).yAxisTitle(e.ygroup),"string"!==e.axis_y_data_format?(e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values,null,"bar",null,e),e.optionalFeatures().newYAxis()):e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values,null,null,null,e)),e.k.exportSVG(e,"#"+r,"barChart");var o=e.k.resize(e.svgContainer);e.k.__proto__._ready(o),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer,"")})},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("bar",t),e.refresh_data=e.k.__proto__._groupBy("bar",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];e.transformData(),"time"===e.axis_x_data_format&&e.data.forEach(function(t){t.x=e.k.dateConversion(t.x)}),e.map_group_data=e.multiD.mapGroup(e.data),r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().createColumn().ticks(),e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values),"string"!==e.axis_y_data_format?(e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values,null,"bar"),e.optionalFeatures().newYAxis()):e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values)},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.optionalFeatures=function(){var t=e.selector.substring(1,e.selector.length),a={svgContainer:function(a,r){return document.getElementById(t).className+=" PykCharts-twoD",e.svgContainer=d3.select(e.selector+" #chart-container-"+r).append("svg:svg").attr({width:e.chart_width,height:e.chart_height,id:a,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height}),this},createGroups:function(t){return e.group=e.svgContainer.append("g").attr({id:"bar-group",transform:"translate("+e.chart_margin_left+","+e.chart_margin_top+")"}),PykCharts["boolean"](e.chart_grid_y_enable)&&e.group.append("g").attr({id:"ygrid","class":"y grid-line"}),this},newYAxis:function(){if(PykCharts["boolean"](e.axis_y_enable)){"right"===e.axis_y_position&&gsvg.attr("transform","translate("+(e.chart_width-e.chart_margin_left-e.chart_margin_right)+",0)");var t=d3.svg.axis().scale(e.yScale).orient(e.axis_y_pointer_position).tickSize(0).outerTickSize(e.axis_y_outer_pointer_length);e.new_yAxisgroup.style("stroke",function(){return e.axis_y_line_color}).call(t),d3.selectAll(e.selector+" .y.new-axis text").style({display:function(){return"none"},stroke:"none"})}return this},axisContainer:function(){return(PykCharts["boolean"](e.axis_x_enable)||e.axis_x_title)&&(e.xgroup=e.group.append("g").attr({id:"xaxis","class":"x axis"}).style("stroke","none")),(PykCharts["boolean"](e.axis_y_enable)||e.axis_y_title)&&(e.ygroup=e.group.append("g").attr({id:"yaxis","class":"y axis"}),e.new_yAxisgroup=e.group.append("g").attr({id:"new-yaxis","class":"y new-axis"}).style("stroke","blue")),this},createColumn:function(){e.x_tick_values=e.k.processXAxisTickValues(),e.y_tick_values=e.k.processYAxisTickValues(),e.reducedWidth=e.chart_width-e.chart_margin_left-e.chart_margin_right,e.reducedHeight=e.chart_height-e.chart_margin_top-e.chart_margin_bottom;var t,a,r,n,o,i,l,s,_=(e.chart_height-e.chart_margin_top-e.chart_margin_bottom,[]),c=[];"number"===e.axis_y_data_format?(n=[0,d3.max(e.data,function(t){return t.y})],c=e.k._domainBandwidth(n,1),a=[e.chart_height-e.chart_margin_top-e.chart_margin_bottom,0],l=d3.min(e.y_tick_values),s=d3.max(e.y_tick_values),c[0]>l&&(c[0]=l),c[1]<s&&(c[1]=s),e.data.sort(function(t,e){return t.y-e.y}),e.yScale1=e.k.scaleIdentification("linear",c,a),y_data1=e.data.map(function(t){return t.y}),y_range1=[0,e.chart_height-e.chart_margin_top-e.chart_margin_bottom],e.yScale=e.k.scaleIdentification("ordinal",y_data1,y_range1,.3),e.extra_top_margin=e.yScale.rangeBand()/2):"string"===e.axis_y_data_format&&(c=e.data.map(function(t){return t.y}),a=[0,e.chart_height-e.chart_margin_top-e.chart_margin_bottom],e.yScale=e.k.scaleIdentification("ordinal",c,a,.3),e.extra_top_margin=e.yScale.rangeBand()/2),"number"===e.axis_x_data_format&&(t=[0,d3.max(e.data,function(t){return+t.x})],_=e.k._domainBandwidth(t,1),r=[0,e.reducedWidth],o=d3.min(e.x_tick_values),i=d3.max(e.x_tick_values),_[0]>o&&(_[0]=o),_[1]<i&&(_[1]=i),e.xScale=e.k.scaleIdentification("linear",_,r),e.extra_left_margin=0),e.x_domain=e.xScale.domain(),e.y_domain=e.yScale.domain(),e.bar=e.group.selectAll(".bar-rect").data(e.data),e.bar.enter().append("g").attr("class","bar-rect").append("svg:rect"),e.bar.attr("class","bar-rect").select("rect").attr({"class":"hbar",y:function(t){return e.yScale(t.y)},x:0,height:function(t){return e.yScale.rangeBand(t.y)},width:0,fill:function(t){return e.fillColor.colorPieMS(t)},stroke:e.border.color(),"stroke-width":e.border.width(),"stroke-dasharray":e.border.style(),"data-id":function(t,e){return t.name}}).on({mouseover:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent1.highlight(e.selector+" .hbar",this),PykCharts["boolean"](e.tooltip_enable)&&(e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(t.tooltip?t.tooltip:t.x)))},mouseout:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent1.highlightHide(e.selector+" .hbar"),PykCharts["boolean"](e.tooltip_enable)&&e.mouseEvent.tooltipHide(t),e.mouseEvent.axisHighlightHide(e.selector+" .y.axis"))},mousemove:function(t){"default"===e.mode&&(PykCharts["boolean"](e.tooltip_enable)&&e.mouseEvent.tooltipPosition(t),e.mouseEvent.axisHighlightShow([t.y],e.selector+" .y.axis",e.y_domain))},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr("width",function(t){return e.xScale(t.x)}),e.bar.exit().remove();var d=d3.transform(d3.select(d3.selectAll(e.selector+" .bar-rect")[0][e.data.length-1]).attr("transform")),u=(d.translate[0],d.translate[1]);return a=[e.reducedHeight-u-e.yScale.rangeBand()/2,u+e.yScale.rangeBand()/2],e.yScale1=e.k.scaleIdentification("linear",c,a),this},ticks:function(){function t(){a.attr({x:function(t){return e.xScale(t.x)},y:function(t){return e.yScale(t.name)+e.yScale.rangeBand(t.y)/2},dx:4,dy:4}).text(function(t){return t.x})}if(e.pointer_size){var a=e.group.selectAll(".ticks_label").data(e.data);a.enter().append("text"),a.attr("class","ticks_label").attr("fill",e.pointer_color).style({"font-weight":e.pointer_weight,"font-size":e.pointer_size+"px","font-family":e.pointer_family}).text(""),setTimeout(t,e.transitions.duration())}return this},sort:function(){if("string"===e.axis_y_data_format){try{if("alphabetically"!==e.data_sort_type&&"numerically"!==e.data_sort_type)throw e.data_sort_type=r.data_sort_type,"data_sort_type"}catch(t){e.k.warningHandling(t,"8")}var a="";switch(e.data_sort_type){case"alphabetically":case"date":a="y";break;case"numerically":a="x"}e.data=e.k.__proto__._sortData(e.data,a,"group",e,"notApplicable")}}};return a}},PykCharts.multiD.groupedBar=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({}),r=a.multiDimensionalCharts;this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.scaleFunction(e),e.data_sort_enable=t.data_sort_enable?t.data_sort_enable.toLowerCase():r.data_sort_enable,e.data_sort_type=PykCharts["boolean"](e.data_sort_enable)&&t.data_sort_type?t.data_sort_type.toLowerCase():r.data_sort_type,e.data_sort_order=PykCharts["boolean"](e.data_sort_enable)&&t.data_sort_order?t.data_sort_order.toLowerCase():r.data_sort_order;try{if("ascending"!==e.data_sort_order&&"descending"!==e.data_sort_order)throw e.data_sort_order=r.data_sort_order,"data_sort_order"}catch(n){e.k.warningHandling(n,"9")}e.stop||(e.k.storeInitialDivHeight(),e.panels_enable="no","default"===e.mode&&e.k.loading(),e.multiD=new PykCharts.multiD.configuration(e),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("bar",t),e.compare_data=e.k.__proto__._groupBy("bar",t),e.axis_x_data_format="number",e.axis_y_data_format=e.k.yAxisDataFormatIdentification(e.data),"time"===e.axis_y_data_format&&(e.axis_y_data_format="string"),e.k.remove_loading_bar(r),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},e.dataTransformation=function(){PykCharts["boolean"](e.data_sort_enable)&&(e.data=e.optionalFeatures().sort(e.data,"group")),e.group_arr=[],e.new_data=[],e.data_length=e.data.length;for(var t=0;t<e.data_length;t++)e.group_arr[t]=e.data[t].y;e.uniq_group_arr=e.k.__proto__._unique(e.group_arr);for(var a=e.uniq_group_arr.length,r=0;a>r;r++){e.new_data[r]={name:e.uniq_group_arr[r],data:[]};for(var n=0;n<e.data_length;n++)e.uniq_group_arr[r]===e.data[n].y&&e.new_data[r].data.push({x:e.data[n].x,name:e.data[n].group,tooltip:e.data[n].tooltip,color:e.data[n].color})}if(e.new_data_length=e.new_data.length,!PykCharts["boolean"](e.data_sort_enable))for(var o=0;o<e.new_data_length;o++)e.new_data[o].data=e.optionalFeatures().sort(e.new_data[o].data,"name")},e.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("bar",t),e.refresh_data=e.k.__proto__._groupBy("bar",t),e.dataTransformation(),e.optionalFeatures().mapColors();var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().createChart().legends().ticks().highlightRect(),e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height),"string"!==e.axis_y_data_format?(e.k.yAxis(e.svgContainer,e.yGroup,e.yScale1,e.ydomain,e.y_tick_values,e.legendsGroup_width,"groupbar"),e.optionalFeatures().newYAxis()):e.k.yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain,e.y_tick_values,e.legendsGroup_width)},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},e.render=function(){var e=this,a=e.selector.substring(1,e.selector.length),r=a+"_svg";e.dataTransformation(),e.optionalFeatures().mapColors(),e.border=new PykCharts.Configuration.border(e),e.transitions=new PykCharts.Configuration.transition(e),e.mouseEvent1=new PykCharts.Configuration.mouseEvent(e),e.fillColor=new PykCharts.Configuration.fillChart(e,null,t),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+r,"groupbarChart").emptyDiv(e.selector).subtitle().makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).legendsContainer(1),e.k.liveData(e).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().legends().createGroups(1).createChart().axisContainer().highlightRect().ticks(),e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup),"string"!==e.axis_y_data_format?(e.k.yAxis(e.svgContainer,e.yGroup,e.yScale1,e.ydomain,e.y_tick_values,e.legendsGroup_width,"groupbar"),e.optionalFeatures().newYAxis()):e.k.yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain,e.y_tick_values,e.legendsGroup_width)):"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+r,"groupbarChart").emptyDiv(e.selector).makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).legendsContainer(1).createGroups(1).createChart().axisContainer().highlightRect(),e.k.tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup),"string"!==e.axis_y_data_format?(e.k.yAxis(e.svgContainer,e.yGroup,e.yScale1,e.ydomain,e.y_tick_values,e.legendsGroup_width,"groupbar"),e.optionalFeatures().newYAxis()):e.k.yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain,e.y_tick_values,e.legendsGroup_width)),e.k.exportSVG(e,"#"+r,"groupbarChart");var n=e.k.resize(e.svgContainer);e.k.__proto__._ready(n),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},e.optionalFeatures=function(){var t=this,e=t.selector.substring(1,t.selector.length),a={svgContainer:function(a,r){return document.getElementById(e).className+=" PykCharts-twoD",t.svgContainer=d3.select(t.selector+" #chart-container-"+r).append("svg:svg").attr({width:t.chart_width,height:t.chart_height,id:a,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+t.chart_width+" "+t.chart_height}),this},createGroups:function(e){return t.group=t.svgContainer.append("g").attr({id:"groupedBar-group",transform:"translate("+t.chart_margin_left+","+(t.chart_margin_top+t.legendsGroup_height)+")"}),this},legendsContainer:function(e){return PykCharts["boolean"](t.legends_enable)&&"default"===t.mode?t.legendsGroup=t.svgContainer.append("g").attr({id:"groupedBar-legends","class":"legends",transform:"translate(0,10)"}).style("visibility","hidden"):(t.legendsGroup_height=0,t.legendsGroup_width=0),this},axisContainer:function(){return(PykCharts["boolean"](t.axis_x_enable)||t.axis_x_title)&&(t.xGroup=t.group.append("g").attr({"class":"x axis",id:"xaxis"}).style("stroke","black")),(PykCharts["boolean"](t.axis_y_enable)||t.axis_y_title)&&(t.yGroup=t.group.append("g").attr({"class":"y axis",id:"yaxis"}).style("stroke","blue"),t.new_yAxisgroup=t.group.append("g").attr({"class":"y new-axis",id:"new-yaxis"}).style("stroke","blue")),this},createChart:function(){t.reduced_width=t.chart_width-t.chart_margin_left-t.chart_margin_right-t.legendsGroup_width,t.reduced_height=t.chart_height-t.chart_margin_top-t.chart_margin_bottom-t.legendsGroup_height,t.getuniqueGroups=t.data.map(function(t){return t.group}),t.getuniqueGroups=t.k.__proto__._unique(t.getuniqueGroups),t.getuniqueGroups.sort(function(t,e){return t>e?1:-1}),t.x_tick_values=t.k.processXAxisTickValues(),t.y_tick_values=t.k.processYAxisTickValues();var e,a,r,n,o,i,l,s,_,c=[];"number"===t.axis_y_data_format?(max=d3.max(t.new_data,function(t){return t.name}),min=d3.min(t.new_data,function(t){return t.name}),o=[min,max],a=o,s=d3.min(t.y_tick_values),_=d3.max(t.y_tick_values),a[0]>s&&(a[0]=s),a[1]<_&&(a[1]=_),t.new_data.sort(function(t,e){return t.name-e.name}),y_data1=t.new_data.map(function(t){return t.name}),y_range1=[t.reduced_height,0],t.yScale=t.k.scaleIdentification("ordinal",y_data1,y_range1,.3),t.extra_top_margin=t.yScale.rangeBand()/2,t.y1=d3.scale.ordinal().domain(t.getuniqueGroups).rangeRoundBands([t.yScale.rangeBand(),0]),t.extra_top_margin=0):"string"===t.axis_y_data_format&&(a=t.new_data.map(function(t){return t.name}),r=[0,t.reduced_height],t.yScale=t.k.scaleIdentification("ordinal",a,r,.3),t.extra_top_margin=t.yScale.rangeBand()/2,t.y1=d3.scale.ordinal().domain(t.getuniqueGroups).rangeRoundBands([0,t.yScale.rangeBand()])),"number"===t.axis_x_data_format&&(t.max_x_value=d3.max(t.new_data,function(t){return d3.max(t.data,function(t){return t.x})}),e=[0,t.max_x_value],c=t.k._domainBandwidth(e,1),n=[0,t.reduced_width],i=d3.min(t.x_tick_values),l=d3.max(t.x_tick_values),c[0]>i&&(c[0]=i),c[1]<l&&(c[1]=l),t.xScale=t.k.scaleIdentification("linear",c,n),t.extra_left_margin=0),t.xdomain=t.xScale.domain(),t.ydomain=t.yScale.domain(),t.highlight_x_positions=[];var d=t.group.selectAll(".groupedBar-rect").data(t.new_data);d.enter().append("g").attr("class","groupedBar-rect"),t.highlight_y_positions="",d.attr("transform",function(e){return t.optionalFeatures().checkIfHighLightDataExists(e.name),t.highlight_group_exits&&(t.flag=!0,t.highlight_y_positions=t.yScale(e.name)),"translate(0,"+t.yScale(e.name)+")"}).on({mouseout:function(e){"default"===t.mode&&(PykCharts["boolean"](t.chart_onhover_highlight_enable)&&t.mouseEvent.highlightGroupHide(t.selector+" .groupedBar-rect","rect"),t.mouseEvent.axisHighlightHide(t.selector+" .y.axis"))},mousemove:function(e){"default"===t.mode&&(PykCharts["boolean"](t.chart_onhover_highlight_enable)&&t.mouseEvent.highlightGroup(t.selector+" .groupedBar-rect",this,"rect"),t.mouseEvent.axisHighlightShow(e.name,t.selector+" .y.axis",t.ydomain,"bar"))}});var u=d.selectAll("rect").data(function(t){return t.data});u.enter().append("rect"),u.attr({height:0,y:function(e){return t.y1(e.name)},x:0,width:0,height:function(e){return.98*t.y1.rangeBand()},fill:function(e,a){return t.fillColor.colorGroup(e)},"fill-opacity":function(e,a){return"saturation"===t.color_mode?(a+1)/t.no_of_groups:1},stroke:t.border.color(),"stroke-width":t.border.width(),"stroke-dasharray":t.border.style(),"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},"data-id":function(t,e){return t.name}}).on({mouseover:function(e){if("default"===t.mode&&PykCharts["boolean"](t.tooltip_enable)){var a=e.tooltip?e.tooltip:e.x;t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(a)}},mouseout:function(e){"default"===t.mode&&PykCharts["boolean"](t.tooltip_enable)&&t.mouseEvent.tooltipHide(e)},mousemove:function(e){"default"===t.mode&&PykCharts["boolean"](t.tooltip_enable)&&t.mouseEvent.tooltipPosition(e)},click:function(e,a){PykCharts["boolean"](t.click_enable)&&t.addEvents(e.name,d3.select(this).attr("data-id"))}}).transition().duration(t.transitions.duration()).attr("width",function(e){return t.xScale(e.x)}),u.exit().remove(),d.exit().remove();var h=d3.transform(d3.select(d3.selectAll(".groupedBar-rect")[0][t.new_data.length-1]).attr("transform")),p=(h.translate[0],h.translate[1]);return r=[t.reduced_height-p-2*t.y1.rangeBand(),p+2*t.y1.rangeBand()],t.yScale1=t.k.scaleIdentification("linear",a,r),this},ticks:function(){function e(){r.attr({x:function(e){return t.xScale(e.x)},y:function(e){return t.y1(e.name)+t.y1.rangeBand()/2},dx:4,dy:2}).transition().text(function(t){return t.x?t.x.toFixed():void 0}).attr({"pointer-events":"none"}).text(function(e){return e.x&&(t.txt_width=this.getBBox().width,t.txt_height=this.getBBox().height,e.x&&t.txt_width<t.xScale(e.x)&&t.txt_height<t.y1.rangeBand())?e.x:void 0})}if(t.pointer_size){var a=t.group.selectAll(".groupedBar-ticks").data(t.new_data);a.enter().append("g").attr("class","groupedBar-ticks"),a.attr("transform",function(e){return"translate(0,"+t.yScale(e.name)+")"});var r=a.selectAll(".ticks_label").data(function(t){return t.data});r.enter().append("text"),r.attr("class","ticks_label").style("font-weight",t.pointer_weight).style("font-size",t.pointer_size+"px").attr("fill",t.pointer_color).style("font-family",t.pointer_family).text(""),setTimeout(e,t.transitions.duration()),r.exit().remove(),a.exit().remove()}return this},mapColors:function(){t.no_of_groups=d3.max(t.new_data,function(t){return t.data.length});for(var e=0;e<t.new_data_length;e++)if(t.new_data[e].data.length===t.no_of_groups){t.group_data=t.new_data[e].data,t.group_data_length=t.group_data.length;break}for(var e=0;e<t.group_data_length;e++)"color"===t.color_mode&&t.chart_color[e]?t.group_data[e].color=t.chart_color[e]:t.group_data[e].color=t.default_color[0];t.new_data.forEach(function(e){e.data.forEach(function(e){for(var a=0;a<t.group_data_length;a++)if(t.group_data[a].name===e.name){e.color=t.group_data[a].color;break}})})},legends:function(){if(PykCharts["boolean"](t.legends_enable)){var e,a=t.group_data;e=a.map(function(t){return t.color}),a=a.map(function(t){return t.name}),a=t.k.__proto__._unique(a),t.multiD.legendsPosition(t,"groupBar",a,e)}return this},checkIfHighLightDataExists:function(e){return t.highlight&&("number"===t.axis_y_data_format?t.highlight_group_exits=t.highlight===e:"string"===t.axis_y_data_format&&(t.highlight_group_exits=t.highlight.toLowerCase()===e.toLowerCase())),this},highlightRect:function(){function e(){y=t.highlight_y_positions-5;var e=t.group.selectAll(".highlight-groupedBar-rect").data([t.highlight]);e.enter().append("rect"),e.attr("class","highlight-groupedBar-rect").attr({x:0,y:y,height:t.y1.rangeBand()*t.group_data_length+10,width:t.reduced_width+5,fill:"none",stroke:t.highlight_color,"stroke-width":"1.5px","stroke-dasharray":"5,5","stroke-opacity":1}),e.exit().remove(),PykCharts["boolean"](t.highlight_y_positions)?highlight_array=t.highlight:e.remove()}return t.flag&&setTimeout(e,t.transitions.duration()),this},newYAxis:function(){if(PykCharts["boolean"](t.axis_y_enable)){"right"===t.axis_y_position&&t.new_yAxisgroup.attr("transform","translate("+(t.chart_width-t.chart_margin_left-t.chart_margin_right-t.legendsGroup_width)+",0)");var e=d3.svg.axis().scale(t.yScale).orient(t.axis_y_pointer_position).tickSize(0).outerTickSize(t.axis_y_outer_pointer_length);t.new_yAxisgroup.style("stroke",function(){return t.axis_y_line_color}).call(e),d3.selectAll(t.selector+" .y.new-axis text").style({display:function(){return"none"},stroke:"none"})}return this},sort:function(e,a){if("string"===t.axis_y_data_format){try{if("alphabetically"!==t.data_sort_type)throw t.data_sort_type=r.data_sort_type,"data_sort_type"}catch(n){t.k.warningHandling(n,"8")}return e=t.k.__proto__._sortData(e,"y",a,t)}return e}};return a}},PykCharts.multiD.column=function(t){var e=this;e.interval="";new PykCharts.Configuration.Theme({});this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.scaleFunction(e),PykCharts.grid(e),e.stop||(e.panels_enable="no",e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.multiD=new PykCharts.multiD.configuration(e),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("column",t),e.compare_data=e.k.__proto__._groupBy("column",t),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.k.remove_loading_bar(r),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},this.transformData=function(){var a=[],r=[];if(0!=t.chart_color&&void 0!=t.chart_color)e.chart_color[0]=t.chart_color[0];else for(var n=0,o=e.data.length;o>n;n++)if(""!=e.data[n].color&&void 0!=e.data[n].color){e.chart_color[0]=e.data[n].color,(void 0==t.axis_x_pointer_color||""==t.axis_x_pointer_color)&&(e.axis_x_pointer_color=e.chart_color[0]);break}e.data.forEach(function(t){t.name=t.x,t.color=e.chart_color[0]});for(var i=0,o=e.data.length;o>i;i++)a[i]=e.data[i].group;r=e.k.__proto__._unique(a),e.no_of_groups=r.length},this.render=function(){var a=e.selector.substring(1,e.selector.length),r=a+"_svg";e.border=new PykCharts.Configuration.border(e),e.transitions=new PykCharts.Configuration.transition(e),e.mouseEvent1=new PykCharts.Configuration.mouseEvent(t),e.fillColor=new PykCharts.Configuration.fillChart(e,null,t),e.transformData();try{if(e.no_of_groups>1)throw"Invalid data in the JSON"}catch(n){return void console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+e.selector+'. "'+n+'"  Visit www.pykcharts.com/errors#error_8')}"time"===e.axis_x_data_format&&e.data.forEach(function(t){t.x=e.k.dateConversion(t.x)}),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+r,"columnChart").emptyDiv(e.selector).subtitle().makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).createGroups(),e.k.liveData(e).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().createColumn().axisContainer(),e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values).yGrid(e.svgContainer,e.group,e.yScale).xAxisTitle(e.xgroup).yAxisTitle(e.ygroup),"string"!==e.axis_x_data_format?(console.log(e.xScale1.domain()),e.k.xAxis(e.svgContainer,e.xgroup,e.xScale1,e.extra_left_margin,e.x_domain,e.x_tick_values,null,"bar",e),e.optionalFeatures().newXAxis()):e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values,null,null,e)):"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+r,"columnChart").emptyDiv(e.selector).makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).createGroups(),e.k.liveData(e).tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().createColumn().axisContainer(),e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values).xAxisTitle(e.xgroup).yAxisTitle(e.ygroup),"string"!==e.axis_x_data_format?(e.k.xAxis(e.svgContainer,e.xgroup,e.xScale1,e.extra_left_margin,e.x_domain,e.x_tick_values,null,"bar"),e.optionalFeatures().newXAxis()):e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values)),e.k.exportSVG(e,"#"+r,"columnChart");var o=e.k.resize(e.svgContainer);e.k.__proto__._ready(o),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("column",t),e.refresh_data=e.k.__proto__._groupBy("column",t);var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];e.transformData(),"time"===e.axis_x_data_format&&e.data.forEach(function(t){t.x=e.k.dateConversion(t.x),t.color=e.chart_color[0]});try{if(e.no_of_groups>1)throw"Invalid data in the JSON"}catch(n){return void console.error("%c[Error - Pykih Charts] ","color: red;font-weight:bold;font-size:14px"," at "+e.selector+'. "'+n+'"  Visit www.pykcharts.com/errors#error_8')}r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().createColumn(),e.k.yAxis(e.svgContainer,e.ygroup,e.yScale,e.y_domain,e.y_tick_values).yGrid(e.svgContainer,e.group,e.yScale),"string"!==e.axis_x_data_format?(e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values,null,"bar"),e.optionalFeatures().newXAxis()):e.k.xAxis(e.svgContainer,e.xgroup,e.xScale,e.extra_left_margin,e.x_domain,e.x_tick_values)},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.optionalFeatures=function(){var t=e.selector.substring(1,e.selector.length),a={svgContainer:function(a,r){return document.getElementById(t).className+=" PykCharts-twoD",e.svgContainer=d3.select(e.selector+" #chart-container-"+r).append("svg:svg").attr({width:e.chart_width,height:e.chart_height,id:a,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+e.chart_width+" "+e.chart_height}),this},createGroups:function(t){return e.group=e.svgContainer.append("g").attr({id:"column-group",transform:"translate("+e.chart_margin_left+","+e.chart_margin_top+")"}),PykCharts["boolean"](e.chart_grid_y_enable)&&e.group.append("g").attr({id:"ygrid","class":"y grid-line"}),this},axisContainer:function(){return(PykCharts["boolean"](e.axis_x_enable)||e.axis_x_title)&&(e.xgroup=e.group.append("g").attr({id:"xaxis","class":"x axis"}).style("stroke","none")),(PykCharts["boolean"](e.axis_y_enable)||e.axis_y_title)&&(e.ygroup=e.group.append("g").attr({id:"yaxis","class":"y axis"}),e.new_xAxisgroup=e.group.append("g").attr({"class":"x new-axis",id:"new-xaxis"}).style("stroke","blue")),this},createColumn:function(){e.x_tick_values=e.k.processXAxisTickValues(),e.y_tick_values=e.k.processYAxisTickValues(),e.reducedWidth=e.chart_width-e.chart_margin_left-e.chart_margin_right;var t,a,r,n,o,i,l,s,_=e.chart_height-e.chart_margin_top-e.chart_margin_bottom,c=[],d=[];"number"===e.axis_y_data_format?(n=[0,d3.max(e.data,function(t){return t.y})],d=e.k._domainBandwidth(n,1),a=[e.chart_height-e.chart_margin_top-e.chart_margin_bottom,0],l=d3.min(e.y_tick_values),s=d3.max(e.y_tick_values),d[0]>l&&(d[0]=l),d[1]<s&&(d[1]=s),e.yScale=e.k.scaleIdentification("linear",d,a),e.extra_top_margin=0):"string"===e.axis_y_data_format?(d=e.data.map(function(t){return t.y}),a=[0,e.chart_height-e.chart_margin_top-e.chart_margin_bottom],e.yScale=e.k.scaleIdentification("ordinal",d,a,.3),e.extra_top_margin=e.yScale.rangeBand()/2):"time"===e.axis_y_data_format&&(d=d3.extent(e.data,function(t){return parseDate(t.y)}),l=d3.min(e.y_tick_values,function(t){return new Date(t)}),s=d3.max(e.y_tick_values,function(t){return new Date(t)}),new Date(d[0])>new Date(l)&&(d[0]=l),new Date(d[1])<new Date(s)&&(d[1]=max__tick_value),a=[e.chart_height-e.chart_margin_top-e.chart_margin_bottom,0],e.yScale=e.k.scaleIdentification("time",d,a),e.extra_top_margin=0),"number"===e.axis_x_data_format?(t=[d3.min(e.data,function(t){return+t.x}),d3.max(e.data,function(t){return+t.x})],console.log(t),c=e.k._domainBandwidth(t),r=[0,e.reducedWidth],o=d3.min(e.x_tick_values),i=d3.max(e.x_tick_values),c[0]>o&&(c[0]=o),c[1]<i&&(c[1]=i),e.data.sort(function(t,e){return t.x-e.x}),console.log(c),e.xScale1=e.k.scaleIdentification("linear",c,r),x_data1=e.data.map(function(t){return t.x}),x_range1=[0,e.reducedWidth],e.xScale=e.k.scaleIdentification("ordinal",x_data1,x_range1,.3),e.extra_left_margin=e.xScale.rangeBand()/2):"string"===e.axis_x_data_format?(c=e.data.map(function(t){return t.x}),r=[0,e.reducedWidth],e.xScale=e.k.scaleIdentification("ordinal",c,r,.3),e.extra_left_margin=e.xScale.rangeBand()/2):"time"===e.axis_x_data_format&&(max=d3.max(e.data,function(t){return t.x}),min=d3.min(e.data,function(t){return t.x}),t=[min.getTime(),max.getTime()],o=d3.min(e.x_tick_values,function(t){return e.k.dateConversion(t)}),i=d3.max(e.x_tick_values,function(t){return e.k.dateConversion(t)}),c[0]>o&&(c[0]=o),c[1]<i&&(c[1]=i),r=[0,e.reducedWidth],e.xScale=e.k.scaleIdentification("time",t,r),e.data.sort(function(t,e){return t.x<e.x?-1:t.x>e.x?1:void 0}),console.log(data),e.xScale1=e.k.scaleIdentification("linear",c,r),x_data1=e.data.map(function(t){return t.x}),x_range1=[0,e.reducedWidth],e.xScale=e.k.scaleIdentification("ordinal",x_data1,x_range1,.3),e.extra_left_margin=e.xScale.rangeBand()/2),e.x_domain=e.xScale.domain(),e.y_domain=e.yScale.domain(),e.bar=e.group.selectAll(".column-rect").data(e.data),e.bar.enter().append("g").attr("class","column-rect").append("svg:rect"),e.bar.attr("class","column-rect").select("rect").attr({"class":"vcolumn",x:function(t){return e.xScale(t.x)},y:_,height:0,width:function(t){return e.xScale.rangeBand(t.x)},fill:function(t){return e.fillColor.colorPieMS(t)},stroke:e.border.color(),"stroke-width":e.border.width(),"stroke-dasharray":e.border.style(),"data-id":function(t,e){return t.name}}).on({mouseover:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent1.highlight(e.selector+" .vcolumn",this),PykCharts["boolean"](e.tooltip_enable)&&(e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(t.tooltip?t.tooltip:t.y)));
},mouseout:function(t){"default"===e.mode&&(PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent1.highlightHide(e.selector+" .vcolumn"),PykCharts["boolean"](e.tooltip_enable)&&e.mouseEvent.tooltipHide(t),e.mouseEvent.axisHighlightHide(e.selector+" .x.axis"))},mousemove:function(t){"default"===e.mode&&(PykCharts["boolean"](e.tooltip_enable)&&e.mouseEvent.tooltipPosition(t),e.mouseEvent.axisHighlightShow(t.x,e.selector+" .x.axis",e.x_domain))},click:function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.name,d3.select(this).attr("data-id"))}}).transition().duration(e.transitions.duration()).attr({y:function(t){return e.yScale(t.y)},height:function(t){return _-e.yScale(t.y)}}),e.bar.exit().remove();var u=d3.transform(d3.select(d3.selectAll(e.selector+" .column-rect")[0][e.data.length-1]).attr("transform")),h=u.translate[0];u.translate[1];return r=[h+e.xScale.rangeBand(),e.reducedWidth-h-e.xScale.rangeBand()],e.xScale1=e.k.scaleIdentification("linear",c,r),this},newXAxis:function(){if(PykCharts["boolean"](e.axis_x_enable)){"bottom"===e.axis_x_position&&e.new_xAxisgroup.attr("transform","translate(0,"+(e.chart_height-e.chart_margin_top-e.chart_margin_bottom)+")");var t=d3.svg.axis().scale(e.xScale).orient(e.axis_x_pointer_position).tickSize(0).ticks(e.axis_x_no_of_axis_value).outerTickSize(e.axis_x_outer_pointer_length);e.new_xAxisgroup.style("stroke",function(){return e.axis_x_line_color}).call(t),d3.selectAll(e.selector+" .x.new-axis text").style({display:function(){return"none"},stroke:"none"})}return this}};return a}},PykCharts.multiD.groupedColumn=function(t){var e=this;e.interval="";new PykCharts.Configuration.Theme({});this.execute=function(a){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.scaleFunction(e),PykCharts.grid(e),e.stop||(e.panels_enable="no",e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.multiD=new PykCharts.multiD.configuration(e),e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("column",t),e.compare_data=e.k.__proto__._groupBy("column",t),e.axis_y_data_format="number",e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.k.remove_loading_bar(r),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},e.dataTransformation=function(){e.group_arr=[],e.new_data=[],e.data_length=e.data.length;for(var t=0;t<e.data_length;t++)e.group_arr[t]=e.data[t].x;e.uniq_group_arr=e.k.__proto__._unique(e.group_arr);for(var a=e.uniq_group_arr.length,r=0;a>r;r++){e.new_data[r]={name:e.uniq_group_arr[r],data:[]};for(var n=0;n<e.data_length;n++)e.uniq_group_arr[r]===e.data[n].x&&e.new_data[r].data.push({y:e.data[n].y,name:e.data[n].group,tooltip:e.data[n].tooltip,color:e.data[n].color})}e.new_data_length=e.new_data.length},e.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("column",t),e.refresh_data=e.k.__proto__._groupBy("column",t),e.map_group_data=e.multiD.mapGroup(e.data),e.dataTransformation(),e.optionalFeatures().mapColors(),"time"===e.axis_x_data_format&&(e.new_data.forEach(function(t){t.name=e.k.dateConversion(t.name)}),e.data.forEach(function(t){t.x=e.k.dateConversion(t.x)}));var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().createChart().legends().highlightRect(),e.k.yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain,e.y_tick_values,e.legendsGroup_width).yGrid(e.svgContainer,e.group,e.yScale,e.legendsGroup_width),"string"!==e.axis_y_data_format?(e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height,"groupcolumn"),e.optionalFeatures().newXAxis()):e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height)},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},e.render=function(){var e=this,a=e.selector.substring(1,e.selector.length),r=a+"_svg";e.map_group_data=e.multiD.mapGroup(e.data),e.dataTransformation(),e.optionalFeatures().mapColors(),"time"===e.axis_x_data_format&&(e.new_data.forEach(function(t){t.name=e.k.dateConversion(t.name)}),e.data.forEach(function(t){t.x=e.k.dateConversion(t.x)})),e.border=new PykCharts.Configuration.border(e),e.transitions=new PykCharts.Configuration.transition(e),e.mouseEvent1=new PykCharts.Configuration.mouseEvent(e),e.fillColor=new PykCharts.Configuration.fillChart(e,null,t),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+r,"groupColumnChart").emptyDiv(e.selector).subtitle().makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).legendsContainer(1),e.k.liveData(e).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().legends().createGroups(1).createChart().axisContainer().highlightRect(),e.k.yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain,e.y_tick_values,e.legendsGroup_width).yGrid(e.svgContainer,e.group,e.yScale,e.legendsGroup_width).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup),"string"!==e.axis_y_data_format?(e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height,"groupcolumn"),e.optionalFeatures().newXAxis()):e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height)):"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+r,"groupColumnChart").emptyDiv(e.selector).makeMainDiv(e.selector,1),e.optionalFeatures().svgContainer(r,1).legendsContainer(1).createGroups(1).createChart().axisContainer().highlightRect(),e.k.tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.k.yAxis(e.svgContainer,e.yGroup,e.yScale,e.ydomain,e.y_tick_values,e.legendsGroup_width).xAxisTitle(e.xGroup).yAxisTitle(e.yGroup),"string"!==e.axis_y_data_format?(e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height,"groupcolumn"),e.optionalFeatures().newXAxis()):e.k.xAxis(e.svgContainer,e.xGroup,e.xScale,e.extra_left_margin,e.xdomain,e.x_tick_values,e.legendsGroup_height)),e.k.exportSVG(e,"#"+r,"groupColumnChart");var n=e.k.resize(e.svgContainer);e.k.__proto__._ready(n),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},e.optionalFeatures=function(){var t=this,e=t.selector.substring(1,t.selector.length),a={svgContainer:function(a,r){return document.getElementById(e).className+=" PykCharts-twoD",t.svgContainer=d3.select(t.selector+" #chart-container-"+r).append("svg:svg").attr({width:t.chart_width,height:t.chart_height,id:a,"class":"svgcontainer",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+t.chart_width+" "+t.chart_height}),this},createGroups:function(e){return t.group=t.svgContainer.append("g").attr({id:"groupedColumn-group",transform:"translate("+t.chart_margin_left+","+(t.chart_margin_top+t.legendsGroup_height)+")"}),PykCharts["boolean"](t.chart_grid_y_enable)&&t.group.append("g").attr({id:"ygrid","class":"y grid-line"}),this},legendsContainer:function(e){return PykCharts["boolean"](t.legends_enable)&&"default"===t.mode?t.legendsGroup=t.svgContainer.append("g").attr({id:"groupedColumn-legends","class":"legends",transform:"translate(0,10)"}).style("visibility","hidden"):(t.legendsGroup_height=0,t.legendsGroup_width=0),this},axisContainer:function(){return(PykCharts["boolean"](t.axis_x_enable)||t.axis_x_title)&&(t.xGroup=t.group.append("g").attr({"class":"x axis",id:"xaxis"}).style("stroke","black"),t.new_xAxisgroup=t.group.append("g").attr({"class":"x new-axis",id:"new-xaxis"}).style("stroke","blue")),(PykCharts["boolean"](t.axis_y_enable)||t.axis_y_title)&&(t.yGroup=t.group.append("g").attr({"class":"y axis",id:"yaxis"}).style("stroke","blue")),this},createChart:function(){t.reduced_width=t.chart_width-t.chart_margin_left-t.chart_margin_right-t.legendsGroup_width,t.reduced_height=t.chart_height-t.chart_margin_top-t.chart_margin_bottom-t.legendsGroup_height,t.getuniqueGroups=t.data.map(function(t){return t.group}),t.getuniqueGroups=t.k.__proto__._unique(t.getuniqueGroups),t.x_tick_values=t.k.processXAxisTickValues(),t.y_tick_values=t.k.processYAxisTickValues();var e,a,r,n,o,i,l,s,_,c=[];"number"===t.axis_y_data_format&&(t.max_y_value=d3.max(t.new_data,function(t){return d3.max(t.data,function(t){return t.y})}),o=[0,t.max_y_value],a=t.k.__proto__._domainBandwidth(o,1),s=d3.min(t.y_tick_values),_=d3.max(t.y_tick_values),a[0]>s&&(a[0]=s),a[1]<_&&(a[1]=_),r=[t.reduced_height,0],t.yScale=t.k.scaleIdentification("linear",a,r)),"number"===t.axis_x_data_format?(max=d3.max(t.new_data,function(t){return t.name}),min=d3.min(t.new_data,function(t){return t.name}),e=[min,max],c=[min,max],i=d3.min(t.x_tick_values),l=d3.max(t.x_tick_values),c[0]>i&&(c[0]=i),c[1]<l&&(c[1]=l),t.new_data.sort(function(t,e){return t.name-e.name}),n=[0,t.reduced_width],t.xScale1=t.k.scaleIdentification("linear",c,n),x_data1=t.new_data.map(function(t){return t.name}),x_range1=[0,t.reduced_width],t.xScale=t.k.scaleIdentification("ordinal",x_data1,x_range1,.2),t.extra_left_margin=t.xScale.rangeBand()/2,t.xdomain=t.xScale.domain(),t.x1=d3.scale.ordinal().domain(t.getuniqueGroups).rangeRoundBands([0,t.xScale.rangeBand()])):"string"===t.axis_x_data_format?(c=t.new_data.map(function(t){return t.name}),n=[0,t.reduced_width],t.xScale=t.k.scaleIdentification("ordinal",c,n,.2),t.extra_left_margin=t.xScale.rangeBand()/2,t.xdomain=t.xScale.domain(),t.x1=d3.scale.ordinal().domain(t.getuniqueGroups).rangeRoundBands([0,t.xScale.rangeBand()])):"time"===t.axis_x_data_format&&(max=d3.max(t.new_data,function(t){return t.name}),min=d3.min(t.new_data,function(t){return t.name}),e=[min.getTime(),max.getTime()],c=[min,max],n=[0,t.reduced_width],i=d3.min(t.x_tick_values,function(e){return e=t.k.dateConversion(e)}),l=d3.max(t.x_tick_values,function(e){return e=t.k.dateConversion(e)}),c[0]>i&&(c[0]=i),c[1]<l&&(c[1]=l),t.xScale=t.k.scaleIdentification("time",c,n),t.new_data.sort(function(t,e){return new Date(t.name)<new Date(e.name)?-1:new Date(t.name)>new Date(e.name)?1:void 0}),x_data1=t.new_data.map(function(t){return t.name}),x_range1=[0,t.reduced_width],t.xScale1=t.k.scaleIdentification("ordinal",x_data1,x_range1,.2),x_data1=t.new_data.map(function(t){return t.name}),x_range1=[0,t.reduced_width],t.xScale=t.k.scaleIdentification("ordinal",x_data1,x_range1,.2),t.extra_left_margin=t.xScale.rangeBand()/2,t.xdomain=t.xScale.domain(),t.x1=d3.scale.ordinal().domain(t.getuniqueGroups).rangeRoundBands([0,t.xScale.rangeBand()])),t.xdomain=t.xScale.domain(),t.ydomain=t.yScale.domain(),t.highlight_y_positions=[];var d=t.group.selectAll(".groupedColumn-rect").data(t.new_data);d.enter().append("g").attr("class","groupedColumn-rect"),d.attr("transform",function(e){return t.optionalFeatures().checkIfHighLightDataExists(e.name),t.highlight_group_exits&&(t.flag=!0,t.highlight_x_positions=t.xScale(e.name)),"translate("+t.xScale(e.name)+",0)"}).on({mouseout:function(e){"default"===t.mode&&(PykCharts["boolean"](t.chart_onhover_highlight_enable)&&t.mouseEvent.highlightGroupHide(t.selector+" .groupedColumn-rect","rect"),t.mouseEvent.axisHighlightHide(t.selector+" .x.axis"))},mousemove:function(e){"default"===t.mode&&(PykCharts["boolean"](t.chart_onhover_highlight_enable)&&t.mouseEvent.highlightGroup(t.selector+" .groupedColumn-rect",this,"rect"),t.mouseEvent.axisHighlightShow(e.name,t.selector+" .x.axis",t.xdomain))}});var u=d.selectAll("rect").data(function(t){return t.data});u.enter().append("rect"),u.attr("height",0).attr({x:function(e){return t.x1(e.name)},y:t.reduced_height,width:function(e){return.98*t.x1.rangeBand()},fill:function(e,a){return t.fillColor.colorGroup(e)},"fill-opacity":function(e,a){return"saturation"===t.color_mode?(a+1)/t.no_of_groups:1},stroke:t.border.color(),"srtoke-width":t.border.width(),"stroke-dasharray":t.border.style(),"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},"data-id":function(t,e){return t.name}}).on({mouseover:function(e){if("default"===t.mode&&PykCharts["boolean"](t.tooltip_enable)){var a=e.tooltip?e.tooltip:e.y;t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(a)}},mouseout:function(e){"default"===t.mode&&PykCharts["boolean"](t.tooltip_enable)&&t.mouseEvent.tooltipHide(e)},mousemove:function(e){"default"===t.mode&&PykCharts["boolean"](t.tooltip_enable)&&t.mouseEvent.tooltipPosition(e)},click:function(e,a){PykCharts["boolean"](t.click_enable)&&t.addEvents(e.name,d3.select(this).attr("data-id"))}}).transition().duration(t.transitions.duration()).attr({height:function(e){return t.reduced_height-t.yScale(e.y)},y:function(e){return t.flag&&t.highlight_y_positions.push(t.yScale(e.y)),t.yScale(e.y)}}),d.exit().remove(),u.exit().remove();var h=d3.transform(d3.select(d3.selectAll(".groupedColumn-rect")[0][t.new_data.length-1]).attr("transform")),p=h.translate[0];h.translate[1];return n=[t.reduced_height-p-2*t.x1.rangeBand(),p+2*t.x1.rangeBand()],t.xScale1=t.k.scaleIdentification("linear",c,n),this},mapColors:function(){t.no_of_groups=d3.max(t.new_data,function(t){return t.data.length});for(var e=0;e<t.new_data_length;e++)if(t.new_data[e].data.length===t.no_of_groups){t.group_data=t.new_data[e].data,t.group_data_length=t.group_data.length;break}t.new_data.forEach(function(e){e.data.forEach(function(e){for(var a=0;a<t.group_data_length;a++)if(t.group_data[a].name===e.name){e.color=t.group_data[a].color;break}})})},legends:function(){if(PykCharts["boolean"](t.legends_enable)){var e,a=t.group_data;e=a.map(function(t){return t.color}),a=a.map(function(t){return t.name}),a=t.k.__proto__._unique(a),t.multiD.legendsPosition(t,"groupColumn",a,e)}return this},checkIfHighLightDataExists:function(e){return t.highlight&&("number"===t.axis_x_data_format?t.highlight_group_exits=t.highlight===e:"string"===t.axis_x_data_format&&(t.highlight_group_exits=t.highlight.toLowerCase()===e.toLowerCase())),this},newXAxis:function(){if(PykCharts["boolean"](t.axis_x_enable)){"bottom"===t.axis_x_position&&t.new_xAxisgroup.attr("transform","translate(0,"+(t.chart_height-t.chart_margin_top-t.chart_margin_bottom-t.legendsGroup_height)+")");var e=d3.svg.axis().scale(t.xScale).orient(t.axis_x_pointer_position).tickSize(0).outerTickSize(t.axis_x_outer_pointer_length);t.new_xAxisgroup.style("stroke",function(){return t.axis_x_line_color}).call(e),d3.selectAll(t.selector+" .x.new-axis text").style({display:function(){return"none"},stroke:"none"})}return this},highlightRect:function(){function e(){x=t.highlight_x_positions-5;var e=t.group.selectAll(".highlight-groupedColumn-rect").data([t.highlight]);e.enter().append("rect"),e.attr({"class":"highlight-groupedColumn-rect",x:x,y:0,width:t.x1.rangeBand()*t.group_data.length+10,height:t.reduced_height+5,fill:"none",stroke:t.highlight_color,"stroke-width":"1.5px","stroke-dasharray":"5,5","stroke-opacity":1}),e.exit().remove(),PykCharts["boolean"](t.highlight_x_positions)?highlight_array=t.highlight:e.remove()}return t.flag&&setTimeout(e,t.transitions.duration()),this}};return a}},PykCharts.multiD.scatter=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),e.bubbleRadius=t.scatterplot_radius?t.scatterplot_radius:a.multiDimensionalCharts.scatterplot_radius,e.panels_enable="no",PykCharts.scaleFunction(e);try{if(!e.k.__proto__._isNumber(e.bubbleRadius))throw e.bubbleRadius=a.multiDimensionalCharts.scatterplot_radius,"bubbleRadius"}catch(n){e.k.warningHandling(n,"1")}if(!e.stop){e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading();var o=a.multiDimensionalCharts;a.stylesheet;e.multiD=new PykCharts.multiD.configuration(e),e.scatterplot_pointer_enable=t.scatterplot_pointer_enable?t.scatterplot_pointer_enable.toLowerCase():o.scatterplot_pointer_enable,e.zoomed_out=!0,PykCharts["boolean"](e.panels_enable)?e.radius_range=[2*e.k.__proto__._radiusCalculation(1.1),2*e.k.__proto__._radiusCalculation(2.6)]:e.radius_range=[2*e.k.__proto__._radiusCalculation(4.5),2*e.k.__proto__._radiusCalculation(11)],e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("scatterplot",a),e.axis_y_data_format=e.k.yAxisDataFormatIdentification(e.data),e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),"time"===e.axis_y_data_format&&""===e.axis_y_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.compare_data=e.k.__proto__._groupBy("scatterplot",a),e.k.remove_loading_bar(n);var o=new PykCharts.multiD.scatterplotFunctions(t,e,"scatterplot");o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.panelsOfScatter=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.scaleFunction(e),e.bubbleRadius=t.scatterplot_radius?t.scatterplot_radius:a.multiDimensionalCharts.scatterplot_radius,e.panels_enable="yes",e.legends_display="horizontal";try{if(!e.k.__proto__._isNumber(e.bubbleRadius))throw e.bubbleRadius=a.multiDimensionalCharts.scatterplot_radius,"bubbleRadius"}catch(n){e.k.warningHandling(n,"1")}if(!e.stop){e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading();var o=a.multiDimensionalCharts;a.stylesheet;e.multiD=new PykCharts.multiD.configuration(e),e.scatterplot_pointer_enable=t.scatterplot_pointer_enable?t.scatterplot_pointer_enable.toLowerCase():o.scatterplot_pointer_enable,e.zoomed_out=!0,PykCharts["boolean"](e.panels_enable)?e.radius_range=[2*e.k.__proto__._radiusCalculation(3.5),2*e.k.__proto__._radiusCalculation(8)]:e.radius_range=[2*e.k.__proto__._radiusCalculation(4.5),2*e.k.__proto__._radiusCalculation(11)],e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("scatterplot",a),e.axis_y_data_format=e.k.yAxisDataFormatIdentification(e.data),e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"time"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),"time"===e.axis_y_data_format&&""===e.axis_y_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to have passed Date data so please pass the value for axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.compare_data=e.k.__proto__._groupBy("scatterplot",a),e.k.remove_loading_bar(n);var o=new PykCharts.multiD.scatterplotFunctions(t,e,"scatterplot");o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}}},PykCharts.multiD.pulse=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),PykCharts.scaleFunction(e);var n=a.multiDimensionalCharts;a.stylesheet;e.multiD=new PykCharts.multiD.configuration(e),e.bubbleRadius=t.scatterplot_radius?t.scatterplot_radius:.6*n.scatterplot_radius,e.panels_enable="no";try{if(!e.k.__proto__._isNumber(e.bubbleRadius))throw e.bubbleRadius=.6*n.scatterplot_radius,"bubbleRadius"}catch(o){e.k.warningHandling(o,"1")}e.stop||(e.k.storeInitialDivHeight(),e.zoomed_out=!0,e.radius_range=[2*e.k.__proto__._radiusCalculation(1.1),2*e.k.__proto__._radiusCalculation(3.5)],"default"===e.mode&&e.k.loading(),e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);if(e.stop||r===!1)return void e.k.remove_loading_bar(n);e.data=e.k.__proto__._groupBy("pulse",a),e.axis_y_data_format=e.k.yAxisDataFormatIdentification(e.data),e.axis_x_data_format=e.k.xAxisDataFormatIdentification(e.data),"date"===e.axis_x_data_format&&""===e.axis_x_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to pass Date data so please pass axis_x_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),"date"===e.axis_y_data_format&&""===e.axis_y_time_value_datatype&&console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+'.("You seem to pass Date data so please pass axis_y_time_value_datatype")  Visit www.pykcharts.com/errors#warning_15'),e.compare_data=e.k.__proto__._groupBy("pulse",a),e.k.remove_loading_bar(n);var o=new PykCharts.multiD.scatterplotFunctions(t,e,"pulse");o.render()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))}},PykCharts.multiD.scatterplotFunctions=function(t,e,a){function r(){n.zoomed_out=!1;for(var t,e=PykCharts["boolean"](n.panels_enable)?n.no_of_groups:1,a=0;e>a;a++){var r=d3.select(n.selector+" #"+n.container_id+a);n.k.isOrdinal(r,".x.axis",n.x),n.k.isOrdinal(r,".y.axis",n.yScale),n.optionalFeatures().plotCircle().label().ticks(),d3.select(n.selector+" #"+n.container_id+a).selectAll(".scatterplot-dot").attr({r:function(e){return t=n.sizes(e.weight)*PykCharts.getEvent().scale},cx:function(t){return n.x(t.x)+n.extra_left_margin},cy:function(t){return n.yScale(t.y)+n.extra_top_margin}}),d3.select(n.selector+" #"+n.container_id+a).selectAll(".scatterplot-label").attr({x:function(t){return n.x(t.x)+n.extra_left_margin},y:function(t){return n.yScale(t.y)+n.extra_top_margin+5}}).style("font-size",n.label_size+"px"),d3.select(n.selector+" #"+n.container_id+a).selectAll(".tick_label").attr({x:function(t){return n.x(t.x)},y:function(e){return n.yScale(e.y)-t}})}if("dblclick"===PykCharts.getEvent().sourceEvent.type&&n.count++,n.count===n.zoom_level+1)for(var a=0;e>a;a++){if("yes"===n.panels_enable){n.new_data=[];for(var o=0;o<n.data_length;o++)n.data[o].group===n.uniq_group_arr[a]&&n.new_data.push(n.data[o])}else n.new_data=n.data;d3.select(n.selector+" #"+n.container_id+a).call(function(){return n.zoomOut(a)}),n.count=1}}var n=e;n.refresh=function(e){n.executeRefresh=function(t){n.data=n.k.__proto__._groupBy("scatterplot",t),n.refresh_data=n.k.__proto__._groupBy("scatterplot",t);var e=n.k.checkChangeInData(n.refresh_data,n.compare_data);n.compare_data=e[0];e[1];n.uniq_group_arr=n.k.__proto__._unique(n.data.map(function(t){return t.group})),e[1]&&n.k.lastUpdatedAt("liveData"),n.map_group_data=n.multiD.mapGroup(n.data),"time"===n.axis_x_data_format&&n.data.forEach(function(t){t.x=n.k.dateConversion(t.x)}),PykCharts["boolean"](n.panels_enable)?PykCharts["boolean"](n.panels_enable)&&"scatterplot"===a&&(document.querySelector(n.selector+" #panels_of_scatter_main_div").innerHTML=null,n.renderChart()):(n.new_data=n.data,n.optionalFeatures().createChart().legends().plotCircle().ticks(),"scatterplot"===a&&n.optionalFeatures().label(0).labelPosition()),n.k.xAxis(n.svgContainer,n.xGroup,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(n.svgContainer,n.yGroup,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width)},PykCharts["boolean"](n.interactive_enable)?(n.k.dataFromPykQuery(e),n.k.dataSourceFormatIdentification(n.data,n,"executeRefresh")):n.k.dataSourceFormatIdentification(t.data,n,"executeRefresh")},n.calculatePanelInRow=function(){var t,e=parseInt(n.k._getHighestParentsAttribute(n.selector,"width"));t=e?e:d3.select("body").style("width"),n.no_of_containers_in_row=Math.floor(parseInt(t)/n.chart_width),n.no_of_containers_in_row>n.uniq_group_arr.length&&(n.no_of_containers_in_row=n.uniq_group_arr.length),t<n.chart_width&&(n.no_of_containers_in_row=1)},this.render=function(){var t=n.selector.substring(1,n.selector.length);if(n.container_id=t+"_svg",n.map_group_data=n.multiD.mapGroup(n.data),n.fillChart=new PykCharts.Configuration.fillChart(n),n.transitions=new PykCharts.Configuration.transition(n),n.border=new PykCharts.Configuration.border(n),n.uniq_group_arr=n.k.__proto__._unique(n.data.map(function(t){return t.group})),n.no_of_groups=1,PykCharts["boolean"](n.panels_enable)&&n.calculatePanelInRow(),"time"===n.axis_x_data_format&&n.data.forEach(function(t){t.x=n.k.dateConversion(t.x)}),"default"===n.mode)PykCharts["boolean"](n.panels_enable)&&"scatterplot"===a?(n.w=n.chart_width,n.chart_height=n.chart_height,n.chart_margin_left=n.chart_margin_left,n.chart_margin_right=n.chart_margin_right,n.k.title(n.new_width).backgroundColor(n)["export"](n,n.container_id,a,n.panels_enable,n.uniq_group_arr,n.new_width).emptyDiv(n.selector).subtitle(n.new_width),d3.select(n.selector).append("div").attr("id","panels_of_scatter_main_div"),n.renderChart(),n.k.xAxis(n.svgContainer,n.xGroup,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(n.svgContainer,n.yGroup,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width).xAxisTitle(n.xGroup,n.legendsGroup_height,n.legendsGroup_width).yAxisTitle(n.yGroup)):(n.k.title().backgroundColor(n)["export"](n,"#"+n.container_id+"0",a).emptyDiv(n.selector).subtitle(),n.w=n.chart_width,n.chart_height=n.chart_height,n.new_data=n.data,n.k.makeMainDiv(n.selector,0),n.optionalFeatures().svgContainer(0).legendsContainer(0),n.k.liveData(n).tooltip(),n.mouseEvent=new PykCharts.Configuration.mouseEvent(n),n.sizes=new PykCharts.multiD.bubbleSizeCalculation(n,n.data,n.radius_range),n.optionalFeatures().legends().createGroups(0).createChart().ticks(),"scatterplot"===a&&n.optionalFeatures().label(0).labelPosition(),n.k.xAxis(n.svgContainer,n.xGroup,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(n.svgContainer,n.yGroup,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width).xAxisTitle(n.xGroup,n.legendsGroup_height,n.legendsGroup_width).yAxisTitle(n.yGroup),n.k.exportSVG(n,"#"+n.container_id+"0",a)),n.k.createFooter(n.new_width).lastUpdatedAt().credits().dataSource();else if("infographics"===n.mode)if(PykCharts["boolean"](n.panels_enable)&&"scatterplot"===a){n.k.backgroundColor(n)["export"](n,n.container_id,a,n.panels_enable,n.uniq_group_arr,n.new_width).emptyDiv(n.selector),n.no_of_groups=n.uniq_group_arr.length,n.data_length=n.data.length,n.w=n.chart_width,n.chart_height=n.chart_height,n.chart_margin_left=n.chart_margin_left,n.chart_margin_right=n.chart_margin_right;for(var e=0;e<n.no_of_groups;e++){n.new_data=[];for(var r=0;r<n.data_length;r++)n.data[r].group===n.uniq_group_arr[e]&&n.new_data.push(n.data[r]);n.k.makeMainDiv(n.selector,e),n.optionalFeatures().svgContainer(e).legendsContainer(e),n.k.tooltip(),n.mouseEvent=new PykCharts.Configuration.mouseEvent(n),n.sizes=new PykCharts.multiD.bubbleSizeCalculation(n,n.data,n.radius_range),n.optionalFeatures().legends(e).createGroups(e).createChart().label(e).ticks(),n.k.xAxis(n.svgContainer,n.xGroup,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(n.svgContainer,n.yGroup,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width).xAxisTitle(n.xGroup,n.legendsGroup_height,n.legendsGroup_width).yAxisTitle(n.yGroup)}n.optionalFeatures().labelPosition(),n.k.exportSVG(n,n.container_id,a,n.panels_enable,n.uniq_group_arr),n.k.emptyDiv(n.selector)}else n.k.backgroundColor(n)["export"](n,"#"+n.container_id+"0",a).emptyDiv(n.selector),n.w=n.chart_width,n.new_data=n.data,n.k.makeMainDiv(n.selector,0),n.optionalFeatures().svgContainer(0).legendsContainer(0),n.k.liveData(n).tooltip(),n.mouseEvent=new PykCharts.Configuration.mouseEvent(n),n.sizes=new PykCharts.multiD.bubbleSizeCalculation(n,n.data,n.radius_range),n.optionalFeatures().legends().createGroups(0).createChart().ticks(),"scatterplot"===a&&n.optionalFeatures().label(0).labelPosition(),n.k.xAxis(n.svgContainer,n.xGroup,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(n.svgContainer,n.yGroup,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width).xAxisTitle(n.xGroup,n.legendsGroup_height,n.legendsGroup_width).yAxisTitle(n.yGroup),n.k.exportSVG(n,"#"+n.container_id+"0",a);if(PykCharts["boolean"](n.panels_enable)){var o=n.k.resize(void 0,n.new_width);n.k.__proto__._ready(o),window.addEventListener("resize",function(t){return n.calculatePanelInRow(),n.k.resize(void 0,n.new_width)})}else{var o=n.k.resize(n.svgContainer);n.k.__proto__._ready(o),window.addEventListener("resize",function(t){return n.k.resize(n.svgContainer)})}},n.optionalFeatures=function(){var t=n.selector.substring(1,n.selector.length),e={svgContainer:function(e){document.querySelector(n.selector+" #chart-container-"+e).style.width=n.w;var a=document.getElementById(t);return a.classList.contains("PykCharts-weighted")||(a.className+=" PykCharts-weighted"),n.svgContainer=d3.select(n.selector+" #chart-container-"+e).append("svg").attr({width:n.w,height:n.chart_height,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+n.w+" "+n.chart_height,id:n.container_id+""+e,"class":"svgcontainer"}),this},createGroups:function(t){return n.group=n.svgContainer.append("g").attr({transform:"translate("+n.chart_margin_left+","+(n.chart_margin_top+n.legendsGroup_height)+")",id:"main"}),n.ticksElement=n.svgContainer.append("g").attr({transform:"translate("+n.chart_margin_left+","+(n.chart_margin_top+n.legendsGroup_height)+")",id:"main2"}),(PykCharts["boolean"](n.axis_x_enable)||n.axis_x_title)&&(n.xGroup=n.group.append("g").attr({"class":"x axis",id:"xaxis"}).style("stroke","black")),(PykCharts["boolean"](n.axis_y_enable)||n.axis_y_title)&&(n.yGroup=n.group.append("g").attr({"class":"y axis",id:"yaxis"}).style("stroke","blue")),n.clip=n.group.append("svg:clipPath").attr("id","clip"+t+n.selector).append("svg:rect").attr({width:n.w-n.chart_margin_left-n.chart_margin_right-n.legendsGroup_width,height:n.chart_height-n.chart_margin_top-n.chart_margin_bottom-n.legendsGroup_height}),n.chartBody=n.group.append("g").attr({id:"clip"+t,"clip-path":"url(#clip"+t+n.selector+")"}),this},legendsContainer:function(t){return PykCharts["boolean"](n.legends_enable)&&n.map_group_data[1]&&"default"===n.mode?n.legendsGroup=n.svgContainer.append("g").attr("id","scatterplot-legends").style("visibility","visible"):(n.legendsGroup_width=0,n.legendsGroup_height=0),this},createChart:function(t){if("scatterplot"==a){
n.new_data.sort(function(t,e){return e.weight-t.weight}),n.weight=n.new_data.map(function(t){return t.weight});for(var e=n.weight.length,o=[],i=0;e>i;i++)0!==n.weight[i]&&o.push(n.weight[i]);n.weight=o,n.sorted_weight=n.weight.slice(0).reverse()}else{n.weight=n.new_data.map(function(t){return t.weight});for(var e=n.weight.length,o=[],i=0;e>i;i++)0!==n.weight[i]&&o.push(n.weight[i]);n.weight=o,n.sorted_weight=n.weight.slice(0)}if(n.sorted_weight.sort(function(t,e){return t-e}),n.x_tick_values=n.k.processXAxisTickValues(),n.y_tick_values=n.k.processYAxisTickValues(),n.group.append("text").attr({fill:"black","text-anchor":"end",x:n.w-70,y:n.chart_height+40}),n.zoomed_out===!0){var l,s,_,c,d,u,h,p,g=[],m=[];if("number"===n.axis_y_data_format?(c=d3.extent(n.data,function(t){return parseFloat(t.y)}),m=n.k.__proto__._domainBandwidth(c,2,"number"),s=[n.chart_height-n.chart_margin_top-n.chart_margin_bottom-n.legendsGroup_height,0],h=d3.min(n.y_tick_values),p=d3.max(n.y_tick_values),m[0]>h&&(m[0]=h),m[1]<p&&(m[1]=p),n.yScale=n.k.scaleIdentification("linear",m,s),n.extra_top_margin=0):"string"===n.axis_y_data_format?(n.data.forEach(function(t){m.push(t.y)}),s=[0,n.chart_height-n.chart_margin_top-n.chart_margin_bottom-n.legendsGroup_height],n.yScale=n.k.scaleIdentification("ordinal",m,s,0),n.extra_top_margin=n.yScale.rangeBand()/2):"time"===n.axis_y_data_format&&(m=d3.extent(n.data,function(t){return new Date(t.x)}),h=d3.min(n.y_tick_values,function(t){return new Date(t)}),p=d3.max(n.y_tick_values,function(t){return new Date(t)}),new Date(m[0])>new Date(h)&&(m[0]=h),new Date(m[1])<new Date(p)&&(m[1]=max__tick_value),s=[n.chart_height-n.chart_margin_top-n.chart_margin_bottom-n.legendsGroup_height,0],n.yScale=n.k.scaleIdentification("time",m,s),n.extra_top_margin=0),"number"===n.axis_x_data_format?(l=d3.extent(n.data,function(t){return parseFloat(t.x)}),g=n.k.__proto__._domainBandwidth(l,2),d=d3.min(n.x_tick_values),u=d3.max(n.x_tick_values),g[0]>d&&(g[0]=d),g[1]<u&&(g[1]=u),_=[0,n.w-n.chart_margin_left-n.chart_margin_right-n.legendsGroup_width],n.x=n.k.scaleIdentification("linear",g,_),n.extra_left_margin=0):"string"===n.axis_x_data_format?(n.data.forEach(function(t){g.push(t.x)}),_=[0,n.w-n.chart_margin_left-n.chart_margin_right-n.legendsGroup_width],n.x=n.k.scaleIdentification("ordinal",g,_,0),n.extra_left_margin=n.x.rangeBand()/2):"time"===n.axis_x_data_format&&(max=d3.max(n.data,function(t){return t.x}),min=d3.min(n.data,function(t){return t.x}),l=[min.getTime(),max.getTime()],g=n.k.__proto__._domainBandwidth(l,2,"time"),d=d3.min(n.x_tick_values,function(t){return n.k.dateConversion(t)}),u=d3.max(n.x_tick_values,function(t){return n.k.dateConversion(t)}),g[0]>d&&(g[0]=d),g[1]<u&&(g[1]=u),_=[0,n.w-n.chart_margin_left-n.chart_margin_right],n.x=n.k.scaleIdentification("time",g,_),n.extra_left_margin=0),n.xdomain=n.x.domain(),n.ydomain=n.yScale.domain(),n.x1=1,n.y1=12,n.count=1,"pulse"!==a)var f=d3.behavior.zoom().scale(n.count).x(n.x).y(n.yScale).on("zoom",r);if(PykCharts["boolean"](n.zoom_enable)&&"string"!==n.axis_y_data_format&&"string"!==n.axis_x_data_format&&"default"===n.mode){var x;x=PykCharts["boolean"](n.panels_enable)?n.no_of_groups:1;for(var i=0;i<n.no_of_groups;i++)d3.select(n.selector+" #"+n.container_id+i).call(f),d3.select(n.selector+" #"+n.container_id+i).on({"wheel.zoom":null,"mousewheel.zoom":null})}n.optionalFeatures().plotCircle(t)}return this},legends:function(t){return PykCharts["boolean"](n.legends_enable)&&n.map_group_data[1]&&"default"===n.mode&&n.multiD.legendsPosition(n,"scatter",n.map_group_data[0],void 0,t),this},ticks:function(){function t(){e.text(function(t){return t.name})}if(PykCharts["boolean"](n.scatterplot_pointer_enable)){var e=n.ticksElement.selectAll(".ticks_label").data(n.new_data);e.enter().append("text"),e.attr({"class":"ticks_label",x:function(t){return n.x(t.x)},y:function(t){return n.yScale(t.y)},"pointer-events":"none",dx:-1,dy:function(t){return-n.sizes(t.weight)-4}}).style({"text-anchor":"middle","font-family":n.label_family,"font-size":n.label_size+"px"}).text(""),setTimeout(t,n.transitions.duration()),e.exit().remove()}return this},plotCircle:function(){return n.circlePlot=n.chartBody.selectAll(".scatterplot-dot").data(n.new_data),n.circlePlot.enter().append("circle").attr("class","scatterplot-dot"),n.circlePlot.attr({r:0,cx:function(t){return n.x(t.x)+n.extra_left_margin},cy:function(t){return n.yScale(t.y)+n.extra_top_margin},fill:function(t){return n.fillChart.colorPieW(t)},"fill-opacity":function(t){return"pulse"==a&&PykCharts["boolean"](n.variable_circle_size_enable)?1:n.multiD.opacity(t.weight,n.weight,n.data)},"data-fill-opacity":function(t){return d3.select(this).attr("fill-opacity")},"data-id":function(t){return t.x},stroke:n.border.color(),"stroke-width":n.border.width(),"stroke-dasharray":n.border.style(),"stroke-opacity":1}).on({mouseover:function(t,e){"default"===n.mode&&(PykCharts["boolean"](n.tooltip_enable)&&(tooltipText=t.tooltip?t.tooltip:"<table><thead><th colspan='2'><b>"+t.name+"</b></th></thead><tr><td>X</td><td><b>"+t.x+"</b></td></tr><tr><td>Y</td><td><b>"+t.y+"<b></td></tr><tr><td>Weight</td><td><b>"+t.weight+"</b></td></tr></table>",n.mouseEvent.tooltipPosition(t),n.mouseEvent.tooltipTextShow(tooltipText)),PykCharts["boolean"](n.chart_onhover_highlight_enable)&&(PykCharts["boolean"](n.panels_enable)?n.mouseEvent.highlight(n.selector+" #"+this.parentElement.parentElement.parentElement.parentElement.id+" .scatterplot-dot",this):n.mouseEvent.highlight(n.selector+" .scatterplot-dot",this)))},mouseout:function(t,e){"default"===n.mode&&(PykCharts["boolean"](n.tooltip_enable)&&n.mouseEvent.tooltipHide(t),PykCharts["boolean"](n.chart_onhover_highlight_enable)&&(PykCharts["boolean"](n.panels_enable)?n.mouseEvent.highlightHide(n.selector+" #"+this.parentElement.parentElement.parentElement.parentElement.id+" .scatterplot-dot"):n.mouseEvent.highlightHide(n.selector+" .scatterplot-dot")))},mousemove:function(t){"default"===n.mode&&PykCharts["boolean"](n.tooltip_enable)&&n.mouseEvent.tooltipPosition(t)},dblclick:function(){PykCharts.getEvent().stopPropagation()},mousedown:function(){PykCharts.getEvent().stopPropagation()},click:function(t,e){PykCharts["boolean"](n.click_enable)&&n.addEvents(t.x,d3.select(this).attr("data-id"))}}).transition().duration(n.transitions.duration()).attr("r",function(t){return n.sizes(t.weight)}),n.circlePlot.exit().remove(),this},label:function(t){if(PykCharts["boolean"](n.label_size)){var e=n.selector.substring(1,n.selector.length);n.circleLabel=n.chartBody.selectAll(".scatterplot-label").data(n.new_data),n.circleLabel.enter().append("text"),n.circleLabel.attr("class","scatterplot-label").attr("id",e+"-bubble-label-"+t).text(""),n.circleLabel.exit().remove()}return this},labelPosition:function(){function t(){for(var t=0;t<n.no_of_groups;t++)d3.selectAll(n.selector+"-bubble-label-"+t).attr({x:function(t){return n.x(t.x)+n.extra_left_margin},y:function(t){return n.yScale(t.y)+n.extra_top_margin+5},"text-anchor":"middle","pointer-events":"none",fill:n.label_color}).style({"font-weight":n.label_weight,"font-size":n.label_size+"px","font-family":n.label_family}).text(function(t){return t.weight}).text(function(t){return this.getBBox().width<2*n.sizes(t.weight)&&this.getBBox().height<2*n.sizes(t.weight)?t.weight:""})}return setTimeout(t,n.transitions.duration()),this}};return e},n.zoomOut=function(t){n.zoomed_out=!0,n.x1=1,n.y1=12,n.optionalFeatures().createChart(t).label().ticks();var e=d3.select(n.selector+" #"+n.container_id+t),a=e.select("#xaxis"),r=e.select("#yaxis");n.k.xAxis(e,a,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(e,r,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width),d3.select(n.selector+" #"+n.container_id+t).selectAll(".scatterplot-dot").attr({r:function(t){return n.sizes(t.weight)},cx:function(t){return n.x(t.x)+n.extra_left_margin},cy:function(t){return n.yScale(t.y)+n.extra_top_margin}}),d3.select(n.selector+" #"+n.container_id+t).selectAll(".scatterplot-label").style("font-size",n.label_size+"px").attr({x:function(t){return n.x(t.x)+n.extra_left_margin},y:function(t){return n.yScale(t.y)+n.extra_top_margin+5}})},n.renderChart=function(){n.no_of_groups=n.uniq_group_arr.length,n.data_length=n.data.length;for(var t=0;t<n.no_of_groups;t++){n.new_data=[];for(var e=0;e<n.data_length;e++)n.data[e].group===n.uniq_group_arr[t]&&n.new_data.push(n.data[e]);n.k.makeMainDiv(n.selector+" #panels_of_scatter_main_div",t),n.optionalFeatures().svgContainer(t).legendsContainer(t);var r=n.selector.substr(1,n.selector.length);d3.selectAll("#tooltip-svg-container-"+t+"-pyk-tooltip"+r).remove(),n.k.liveData(n).tooltip(!0,n.selector,t),n.mouseEvent=new PykCharts.Configuration.mouseEvent(n),n.sizes=new PykCharts.multiD.bubbleSizeCalculation(n,n.data,n.radius_range),n.optionalFeatures().legends(t).createGroups(t).createChart().label(t).ticks(),n.k.xAxis(n.svgContainer,n.xGroup,n.x,n.extra_left_margin,n.xdomain,n.x_tick_values,n.legendsGroup_height).yAxis(n.svgContainer,n.yGroup,n.yScale,n.ydomain,n.y_tick_values,n.legendsGroup_width).xAxisTitle(n.xGroup,n.legendsGroup_height,n.legendsGroup_width).yAxisTitle(n.yGroup)}n.optionalFeatures().labelPosition(),n.k.exportSVG(n,n.container_id,a,n.panels_enable,n.uniq_group_arr),n.k.emptyDiv(n.selector)}},PykCharts.multiD.spiderWeb=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){var n=a.multiDimensionalCharts;e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),e.bubbleRadius=t.spiderweb_radius?t.spiderweb_radius:.6*n.scatterplot_radius,e.spiderweb_outer_radius_percent=t.spiderweb_outer_radius_percent?t.spiderweb_outer_radius_percent:n.spiderweb_outer_radius_percent,e.panels_enable="no",e.data_sort_enable="yes",e.data_sort_type="alphabetically",e.data_sort_order="ascending";try{if(!e.k.__proto__._isNumber(e.bubbleRadius))throw e.bubbleRadius=.6*n.scatterplot_radius,"spiderweb_radius"}catch(o){e.k.warningHandling(o,"1")}try{if(!e.k.__proto__._isNumber(e.spiderweb_outer_radius_percent))throw e.bubbleRadius=n.spiderweb_outer_radius_percent,"spiderweb_outer_radius_percent"}catch(o){e.k.warningHandling(o,"1")}e.stop||(e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.spiderweb_outer_radius_percent>100&&(e.spiderweb_outer_radius_percent=100),e.multiD=new PykCharts.multiD.configuration(e),e.inner_radius=0,e.executeData=function(t){var a=e.k.validator().validatingJSON(t),r=e.selector.substring(1,e.selector.length);return e.stop||a===!1?void e.k.remove_loading_bar(r):(e.data=e.k.__proto__._groupBy("spiderweb",t),e.compare_data=e.k.__proto__._groupBy("spiderweb",t),e.k.remove_loading_bar(r),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))},e.dataTransformation=function(){e.group_arr=[],e.uniq_group_arr=[],e.x_arr=[],e.uniq_x_arr=[],e.data=e.k.__proto__._sortData(e.data,"x","group",e),e.data_length=e.data.length;for(var t=0;t<e.data_length;t++)e.group_arr[t]=e.data[t].group;e.uniq_group_arr=e.k.__proto__._unique(e.group_arr);for(var a=e.uniq_group_arr.length,r=0;r<e.data_length;r++)e.x_arr[r]=e.data[r].x;e.k.__proto__._unique(e.x_arr);e.new_data=[];for(var r=0;a>r;r++){e.new_data[r]={name:e.uniq_group_arr[r],data:[]};for(var n=0;n<e.data_length;n++)e.uniq_group_arr[r]===e.data[n].group&&e.new_data[r].data.push({x:e.data[n].x,y:e.data[n].y,weight:e.data[n].weight,color:e.data[n].color,tooltip:e.data[n].tooltip})}e.new_data_length=e.new_data.length},e.refresh=function(a){e.executeRefresh=function(t){e.data=e.k.__proto__._groupBy("spiderweb",t),e.refresh_data=e.k.__proto__._groupBy("spiderweb",t),e.map_group_data=e.multiD.mapGroup(e.data),e.dataTransformation();var a=e.k.checkChangeInData(e.refresh_data,e.compare_data);e.compare_data=a[0];var r=a[1];r&&e.k.lastUpdatedAt("liveData"),e.optionalFeatures().createChart().legends().xAxis().yAxis()},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(a),e.k.dataSourceFormatIdentification(e.data,e,"executeRefresh")):e.k.dataSourceFormatIdentification(t.data,e,"executeRefresh")},this.render=function(){e.fillChart=new PykCharts.Configuration.fillChart(e);var t=e.selector.substring(1,e.selector.length),a=t+"_svg";e.border=new PykCharts.Configuration.border(e),e.map_group_data=e.multiD.mapGroup(e.data),e.dataTransformation(),"default"===e.mode?(e.k.title().backgroundColor(e)["export"](e,"#"+a,"spiderweb").emptyDiv(e.selector).subtitle().makeMainDiv(e.selector,1),e.h=e.chart_height,e.optionalFeatures().svgContainer(a,1).legendsContainer(1),e.k.liveData(e).tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e),e.optionalFeatures().legends().createGroups(),e.spiderweb_outer_radius_percent=e.k.__proto__._radiusCalculation(e.spiderweb_outer_radius_percent,"spiderweb"),e.radius_range=[3*e.spiderweb_outer_radius_percent/100,.09*e.spiderweb_outer_radius_percent],e.sizes=new PykCharts.multiD.bubbleSizeCalculation(e,e.data,e.radius_range),e.optionalFeatures().createChart().xAxis().yAxis(),e.k.createFooter().lastUpdatedAt().credits().dataSource()):"infographics"===e.mode&&(e.k.backgroundColor(e)["export"](e,"#"+a,"spiderweb").emptyDiv(e.selector),e.k.makeMainDiv(e.selector,1),e.h=e.chart_height,e.optionalFeatures().svgContainer(a,1).legendsContainer().createGroups(),e.spiderweb_outer_radius_percent=e.k.__proto__._radiusCalculation(e.spiderweb_outer_radius_percent,"spiderweb"),e.radius_range=[3*e.spiderweb_outer_radius_percent/100,.09*e.spiderweb_outer_radius_percent],e.sizes=new PykCharts.multiD.bubbleSizeCalculation(e,e.data,e.radius_range),e.optionalFeatures().createChart().xAxis().yAxis(),e.k.tooltip(),e.mouseEvent=new PykCharts.Configuration.mouseEvent(e)),e.k.exportSVG(e,"#"+a,"spiderweb");var r=e.k.resize(e.svgContainer);e.k.__proto__._ready(r),window.addEventListener("resize",function(t){return e.k.resize(e.svgContainer)})},this.degrees=function(t){return t/Math.PI*180-90},this.optionalFeatures=function(){var t=this,e=t.selector.substring(1,t.selector.length),a={svgContainer:function(a,r){return document.getElementById(e).className+=" PykCharts-spider-web",t.svgContainer=d3.select(t.selector+" #chart-container-"+r).append("svg").attr({"class":"svgcontainer",id:a,width:t.chart_width,height:t.chart_height,preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+t.chart_width+" "+t.chart_height}),this},createGroups:function(){return t.group=t.svgContainer.append("g").attr({id:"spider-group",transform:"translate("+(t.chart_width-t.legendsGroup_width)/2+","+(t.h+t.legendsGroup_height+20)/2+")"}),t.ticksElement=t.svgContainer.append("g").attr("transform","translate("+(t.chart_width-t.legendsGroup_width)/2+","+(t.h+t.legendsGroup_height+20)/2+")"),this},legendsContainer:function(e){return PykCharts["boolean"](t.legends_enable)&&t.map_group_data[1]&&"default"===t.mode?t.legendsGroup=t.svgContainer.append("g").attr({"class":"spiderweb-legends",id:"legends"}):(t.legendsGroup_width=0,t.legendsGroup_height=0),this},createChart:function(){var e,a,r,n=t.new_data[0].data,o=n.length;r=d3.max(t.new_data,function(t,e){return d3.max(t.data,function(t){return t.y})}),a=d3.min(t.new_data,function(t,e){return d3.min(t.data,function(t){return t.y})}),t.yScale=d3.scale.linear().domain([a,r]).range([t.inner_radius,t.spiderweb_outer_radius_percent]),t.y_domain=[],t.nodes=[];for(var i=[],e=0;e<t.new_data_length;e++){for(var l=[],s=0;s<t.new_data[e].data.length;s++)i.push(t.yScale(t.new_data[e].data[s].y)),l[s]=t.yScale(t.new_data[e].data[s].y);t.y_domain[e]=l}t.y=d3.scale.linear().domain(d3.extent(i,function(t){return parseFloat(t)})).range([.1,.9]);for(var e=0;e<t.new_data_length;e++){for(var _=[],s=0;o>s;s++)_[s]={x:s,y:t.y(t.y_domain[e][s]),tooltip:t.new_data[e].data[s].tooltip||t.new_data[e].data[s].weight};t.nodes[e]=_}t.radius=d3.scale.linear().range([t.inner_radius,t.spiderweb_outer_radius_percent]);for(var c=0;c<t.new_data_length;c++){var d=[];for(s=0;s<t.new_data[c].data.length;s++)d[s]=t.new_data[c].data[s].tooltip;t.angle=d3.scale.ordinal().domain(d3.range(t.new_data[c].data.length+1)).rangePoints([0,2*Math.PI]),t.yAxis=[];for(var e=0;e<t.new_data[c].data.length;e++)t.yAxis.push({x:e,y:.25},{x:e,y:.5},{x:e,y:.75},{x:e,y:1});var u,h=[];t.yAxis_length=t.yAxis.length;for(var e=0;e<t.yAxis_length;e++)u=e<t.yAxis_length-4?t.yAxis[e+4]:t.yAxis[e-t.yAxis_length+4],h.push({source:t.yAxis[e],target:u});for(var p,g=[],e=0;e<t.nodes[c].length;e++)e<t.nodes[c].length-1?(u=t.nodes[c][e+1],p=t.fillChart.colorPieW(t.new_data[c].data[e])):(u=t.nodes[c][0],p=t.fillChart.colorPieW(t.new_data[c].data[e])),g.push({source:t.nodes[c][e],target:u,color:p});var m=t.group.selectAll("#link"+c).data(g);m.enter().append("path").attr("class","link"),m.attr({"class":"link",stroke:function(t){return t.color},"stroke-opacity":1,id:"link"+c,d:d3.customHive.link().angle(function(e){return t.angle(e.x)}).radius(function(e){return t.radius(e.y)})}),m.exit().remove(),t.weight=t.new_data[c].data.map(function(t){return t.weight});for(var f=t.weight.length,x=[],e=0;f>e;e++)0!==t.weight[e]&&x.push(t.weight[e]);t.weight=x,t.sorted_weight=t.weight.slice(0),t.sorted_weight.sort(function(t,e){return t-e});var y=t.group.selectAll(".node"+c).data(t.nodes[c]);y.enter().append("circle").attr({"class":"dot node"+c,transform:function(e){return"rotate("+t.degrees(t.angle(e.x))+")"}}),y.attr({"class":"dot node"+c,cx:function(e){return t.radius(e.y)},r:function(e,a){return t.sizes(t.new_data[c].data[a].weight)},"fill-opacity":function(e,a){return t.multiD.opacity(t.new_data[c].data[a].weight,t.weight,t.data)},"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},stroke:t.border.color(),"stroke-width":t.border.width(),"stroke-dasharray":t.border.style(),"data-id":function(e,a){return t.new_data[0].data[a].x}}).style("fill",function(e,a){return t.fillChart.colorPieW(t.new_data[c].data[a])}).on({mouseover:function(e,a){"default"===t.mode&&(t.mouseEvent.tooltipPosition(e),t.mouseEvent.tooltipTextShow(e.tooltip),PykCharts["boolean"](t.chart_onhover_highlight_enable)&&t.mouseEvent.highlight(t.selector+" .dot",this))},mouseout:function(e){"default"===t.mode&&(t.mouseEvent.tooltipHide(e),PykCharts["boolean"](t.chart_onhover_highlight_enable)&&t.mouseEvent.highlightHide(t.selector+" .dot"))},mousemove:function(e){"default"===t.mode&&t.mouseEvent.tooltipPosition(e)},click:function(e,a){PykCharts["boolean"](t.click_enable)&&t.addEvents(t.new_data[0].data[a].x,d3.select(this).attr("data-id"))}}),y.exit().remove()}return t.group.selectAll(".axis").data(d3.range(t.new_data[0].data.length)).enter().append("line").attr({"class":"axis",transform:function(e){return"rotate("+t.degrees(t.angle(e))+")"},x1:t.radius.range()[0],x2:t.radius.range()[1]}),t.group.selectAll(".grid").data(h).enter().append("path").attr({"class":"grid",d:d3.customHive.link().angle(function(e){return t.angle(e.x)}).radius(function(e){return t.radius(e.y)})}),this},legends:function(){return PykCharts["boolean"](t.legends_enable)&&t.map_group_data[1]&&"default"===t.mode&&t.multiD.legendsPosition(t,"spiderWeb",t.map_group_data[0]),this},xAxis:function(){t.length=t.new_data[0].data.length;var e=t.group.selectAll("text.x-axis-title").data(t.nodes[0]);return e.enter().append("text").attr("class","x-axis-title"),e.attr({transform:function(e,a){return"translate("+-t.spiderweb_outer_radius_percent+","+-t.spiderweb_outer_radius_percent+")"},x:function(e,a){return t.spiderweb_outer_radius_percent*(1-.2*Math.sin(2*a*Math.PI/t.length))+1.25*t.spiderweb_outer_radius_percent*Math.sin(2*a*Math.PI/t.length)},y:function(e,a){return t.spiderweb_outer_radius_percent*(1-.6*Math.cos(2*a*Math.PI/t.length))-.47*t.spiderweb_outer_radius_percent*Math.cos(2*a*Math.PI/t.length)}}).style({"text-anchor":"middle","font-size":t.axis_x_pointer_size+"px","font-family":t.axis_x_pointer_family,"font-weight":t.axis_x_pointer_weight,fill:t.axis_x_pointer_color}),e.text(function(e,a){return t.new_data[0].data[a].x}),e.exit().remove(),this},yAxis:function(){for(var e=t.yScale.domain(),a=e[1]/4,r=[],n=4,o=0;n>=0;n--,o++)r[o]=n*a;var i=t.ticksElement.selectAll("text.y-axis-ticks").data(r);return i.enter().append("text").attr("class","y-axis-ticks"),i.style("text-anchor","start").attr({transform:"translate(5,"+-t.spiderweb_outer_radius_percent+")",x:0,y:function(e,a){return a*(t.spiderweb_outer_radius_percent/4)},dy:-2}),i.text(function(t,e){return t}).style({"font-size":t.axis_y_pointer_size+"px","font-family":t.axis_y_pointer_family,"font-weight":t.axis_y_pointer_weight,fill:t.axis_y_pointer_color}),i.exit().remove(),this},sort:function(){if("string"===t.axis_y_data_format)try{if("alphabetically"!==t.data_sort_type)throw t.data_sort_type=multiDimensionalCharts.data_sort_type,"data_sort_type";t.data=t.k.__proto__._sortData(t.data,"y","group",t)}catch(e){t.k.warningHandling(e,"8")}return this}};return a}},PykCharts.multiD.waterfall=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({}),r=a.multiDimensionalCharts;this.execute=function(n){e=new PykCharts.validation.processInputs(e,t,"multiDimensionalCharts"),e.calculate_total=t.calculate_total?t.calculate_total:r.calculate_total,e.calculate_total_of=t.calculate_total_of?t.calculate_total_of:[],e.axis_y_background_color=t.axis_y_background_color?t.axis_y_background_color:a.multiDimensionalCharts.axis_y_background_color,PykCharts.scaleFunction(e),e.color_mode="color",e.grid_y_enable="no",e.grid_color="#fff",e.panels_enable="no",e.longest_tick_width=0,e.ticks_formatter=d3.format("s");try{if(0==e.chart_color.length)throw e.chart_color=["rgb(255, 60, 131)","rgb(0, 185, 250)","grey"],"chart_color";if(1==e.chart_color.length)throw e.chart_color.push("rgb(0, 185, 250)","grey"),"chart_color";if(2==e.chart_color.length)throw e.chart_color.push("grey"),"chart_color"}catch(o){console.warn("%c[Warning - Pykih Charts] ","color: #F8C325;font-weight:bold;font-size:14px"," at "+e.selector+".(\"You seem to have passed less than three colors for '"+o+"', in a waterfall chart.\")  Visit www.pykcharts.com/errors#warning_18")}e.stop||(e.k.storeInitialDivHeight(),"default"===e.mode&&e.k.loading(),e.multiD=new PykCharts.multiD.configuration(e),e.executeData=function(a){var r=e.k.validator().validatingJSON(a),n=e.selector.substring(1,e.selector.length);return e.stop||r===!1?void e.k.remove_loading_bar(n):(e.data=e.k.__proto__._groupBy("waterfall",a),e.compare_data=e.k.__proto__._groupBy("waterfall",a),e.axis_y_data_format=e.k.yAxisDataFormatIdentification(e.data),e.axis_x_data_format="number",e.k.remove_loading_bar(n),PykCharts.multiD.waterfallFunctions(t,e,"waterfall"),void e.render())},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(n),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData"))}},PykCharts.multiD.waterfallFunctions=function(t,e,a){var r=e;r.refresh=function(e){for(var a=document.querySelectorAll(".custom-axis"),n=0;n<a.length;n++)a[n].parentNode.removeChild(a[n]);r.executeRefresh=function(t){r.data=r.k.__proto__._groupBy("waterfall",t),r.refresh_data=r.k.__proto__._groupBy("waterfall",t);var e=r.k.checkChangeInData(r.refresh_data,r.compare_data);r.compare_data=e[0];var a=e[1];a&&r.k.lastUpdatedAt("liveData"),r.groupData(),r.sortData(),r.calculateRiverData(),r.optionalFeatures().createScales().ticks().createChart(),r.k.yAxis(r.svgContainer,r.yGroup,r.yScale,r.yDomain,r.y_tick_values,void 0,void 0,r.tick_format_function),r.xaxis()},PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeRefresh")):r.k.dataSourceFormatIdentification(t.data,r,"executeRefresh")},r.render=function(){var t=this,e=t.selector.substring(1,t.selector.length);t.container_id=e+"_svg",t.groupData(),t.sortData(),t.calculateRiverData(),t.transitions=new PykCharts.Configuration.transition(t),t.mouseEvent1=new PykCharts.Configuration.mouseEvent(t),t.border=new PykCharts.Configuration.border(t),t.reducedWidth=t.chart_width-t.chart_margin_left-t.chart_margin_right,t.reducedHeight=t.chart_height-t.chart_margin_top-t.chart_margin_bottom,"default"===t.mode?(t.k.title().backgroundColor(t)["export"](t,"#"+t.container_id,"waterfallChart").subtitle().makeMainDiv(t.selector,1),t.optionalFeatures(e).svgContainer(1,t.container_id).createGroups(),t.k.liveData(t).tooltip().createFooter().lastUpdatedAt().credits().dataSource(),t.mouseEvent=new PykCharts.Configuration.mouseEvent(t),t.optionalFeatures(e).axisContainer().createScales().ticks().createChart()):"infographics"===t.mode&&(t.k.backgroundColor(t)["export"](t,"#"+t.container_id,"waterfallChart").emptyDiv().makeMainDiv(t.selector,1),t.optionalFeatures(e).svgContainer(1,t.container_id).createGroups().axisContainer().createScales().ticks().createChart(),t.k.tooltip(),t.mouseEvent=new PykCharts.Configuration.mouseEvent(t)),t.k.yAxis(t.svgContainer,t.yGroup,t.yScale,t.yDomain,t.y_tick_values,void 0,void 0,t.tick_format_function).yAxisTitle(t.yGroup,void 0),t.xaxis(),t.optionalFeatures().axis_background(t.container_id),t.k.exportSVG(t,"#"+t.container_id,"waterfallChart");var a=t.k.resize(t.svgContainer);t.k.__proto__._ready(a),window.addEventListener("resize",function(e){return t.k.resize(t.svgContainer)})},r.optionalFeatures=function(t){var e=this,a={svgContainer:function(a,r){return document.getElementById(t).className+=" PykCharts-twoD",e.svgContainer=d3.select(e.selector+" #chart-container-"+a).append("svg:svg").attr("width",e.chart_width).attr("height",e.chart_height).attr("id",r).attr("class","svgcontainer").attr("preserveAspectRatio","xMinYMin").attr("viewBox","0 0 "+e.chart_width+" "+e.chart_height),e.background_rect=e.svgContainer.selectAll(".background-rect").data(["rect"]),e.background_rect.enter().append("rect").attr("class","background-rect"),e.background_rect.attr("y",e.chart_margin_top).attr("width",e.longest_tick_width).attr("height",e.reducedHeight).attr("fill",e.axis_y_background_color),this},createGroups:function(){return e.group=e.svgContainer.append("g").attr("id","chartsvg").attr("transform","translate("+e.chart_margin_left+","+e.chart_margin_top+")"),this},createScales:function(){e.y_values=[],e.x_values=[];for(var t=e.river_data.length,a=[],r=0;t>r;r++)a.push(e.river_data[r].y),e.y_values.push(e.river_data[r].unique_name),e.x_values.push(e.river_data[r].end);return e.y_values.reverse(),a.reverse(),e.tick_format_function=function(t){var e=t.lastIndexOf("-");return-1!=e?t.substring(0,e):t},e.yScale=d3.scale.ordinal().domain(e.y_values).rangeRoundBands([e.reducedHeight,0],.1),e.yDomain=a,e.data_length=e.data.length,e.bars=e.group.selectAll(".bar").data(e.river_data),e.bars.attr("transform",function(t){return"translate(5, "+e.yScale(t.unique_name)+")"}),e.bars.enter().append("g").attr("class",function(t){return"bar "+t.group}).attr("transform",function(t){return"translate(5, "+e.yScale(t.unique_name)+")"}),this},axisContainer:function(){return(PykCharts["boolean"](e.axis_y_enable)||e.axis_y_title)&&(e.yGroup=e.group.append("g").attr("id","yaxis").attr("class","y axis")),this},createChart:function(){e.y_tick_values=e.k.processYAxisTickValues(),e.xScale=d3.scale.linear().domain([0,d3.max(e.x_values,function(t){return t})]).range([0,e.reducedWidth-e.longest_tick_width-15]);var t=e.bars.selectAll(".rect").data(function(t){return[t]});t.enter().append("rect").attr("class","rect").attr("stroke",e.border.color()).attr("stroke-width",e.border.width()).attr("stroke-dasharray",e.border.style()).attr("stroke-opacity",1);var a=0;return t.attr("x",function(t){return e.xScale(t.start)+e.longest_tick_width+15}).attr("height",e.yScale.rangeBand()).attr("width",0).attr("fill",function(t,e){return t.color}).attr("fill-opacity",1).attr("data-id",function(t,e){return t.unique_name}).on("mouseover",function(t){if("default"===e.mode){if(PykCharts["boolean"](e.tooltip_enable)){var a=t.tooltip?t.tooltip:"<table><thead><th colspan='2'><b>"+t.y+"</b></th></thead><tr><td>Start</td><td><b>"+e.ticks_formatter(t.start)+"</b></td></tr><tr><td>Weight</td><td><b>"+e.ticks_formatter(t.x)+"</b></td></tr></table>";e.mouseEvent.tooltipPosition(t),e.mouseEvent.tooltipTextShow(a)}e.mouseEvent.axisHighlightShow(t.unique_name,e.selector+" .y.axis",e.y_values,"waterfall"),PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlight(e.selector+" .rect",this)}}).on("mouseout",function(t){"default"===e.mode&&(PykCharts["boolean"](e.tooltip_enable)&&e.mouseEvent.tooltipHide(t),e.mouseEvent.axisHighlightHide(e.selector+" .y.axis"),PykCharts["boolean"](e.chart_onhover_highlight_enable)&&e.mouseEvent.highlightHide(e.selector+" .rect"))}).on("mousemove",function(t){"default"===e.mode&&PykCharts["boolean"](e.tooltip_enable)&&e.mouseEvent.tooltipPosition(t)}).on("click",function(t,a){PykCharts["boolean"](e.click_enable)&&e.addEvents(t.unique_name,d3.select(this).attr("data-id"))}).transition().duration(e.transitions.duration()).delay(function(t){return a++,a/e.data_length*e.transitions.duration()}).attr("x",function(t){return e.xScale("negative"==t.group?t.end:t.start)+e.longest_tick_width+15}).attr("width",function(t){return Math.abs(e.xScale(t.x))}),t.exit().remove(),e.bars.exit().remove(),this},ticks:function(){if(e.pointer_size){var t=e.bars.selectAll(".ticks-text").data(function(t){return[t]});t.enter().append("text").attr("class","ticks-text").style("font-weight",e.pointer_weight).style("font-size",e.pointer_size+"px").style("font-family",e.pointer_family).text(""),t.text(function(t){return e.ticks_formatter(t.x)}).style("visibility","hidden").attr("y",function(t){return e.yScale.rangeBand()/2+this.getBBox().height/3}).attr("dx",".25em").attr("fill",function(t){return e.longest_tick_width=e.longest_tick_width<this.getBBox().width?this.getBBox().width:e.longest_tick_width,"negative"==t.group?e.chart_color[0]:"positive"==t.group?e.chart_color[1]:void 0}).style("visibility","visible"),t.exit().remove()}return this},axis_background:function(t){if(PykCharts["boolean"](e.axis_y_enable)&&e.axis_y_pointer_size){for(var a=document.querySelectorAll("#"+t+" #yaxis .tick text"),r=a.length,n=[],o=0;r>o;o++)n.push(a[o].getBBox().width);var i=d3.max(n,function(t){return t});e.background_rect.attr("x",e.chart_margin_left-i-10).attr("width",i+10),e.background_rect.exit().remove()}return this}};return a},r.groupData=function(){for(r.group_arr=[],r.new_data=[],r.ticks=[],r.x_arr=[],j=0;j<r.data.length;j++)r.group_arr[j]=r.data[j].group;r.uniq_group_arr=r.k.__proto__._unique(r.group_arr);for(var t=r.uniq_group_arr.length,e=0;e<r.data.length;e++)r.x_arr[e]=+r.data[e].x;r.k.__proto__._unique(r.x_arr);r.flag=0;for(var e=0;t>e;e++){r.new_data[e]={name:r.uniq_group_arr[e],data:[]};for(var a=0;a<r.data.length;a++)r.uniq_group_arr[e]===r.data[a].group&&r.new_data[e].data.push({x:+r.data[a].x,y:r.data[a].y,tooltip:r.data[a].tooltip,name:r.data[a].group,unique_name:r.data[a].group?r.data[a].y+"-"+r.data[a].group:r.data[a].y})}r.new_data_length=r.new_data.length},r.dataTransformation=function(t){for(var e=0,a=0,n=t.data,o="Total",i=(n.length,0);i<r.data.length;i++)a+=r.data[i].x,e>a&&(e=a);return t.name&&(o=o+" "+t.name),e=0>e?Math.abs(e):0,n=r.rivergroup(e,n,o,e,t.name)},r.check_total_is_present=function(t){for(var e=!1,a=0;a<r.calculate_total_of.length;a++)if(t===r.calculate_total_of[a]){e=!0;break}return e},r.rivergroup=function(t,e,a,n,o){for(var i=0;i<e.length;i++)e[i].start=n,n+=e[i].x,e[i].end=n,e[i].group=e[i].x>0?"positive":"negative",e[i].color=e[i].x>0?r.chart_color[1]:r.chart_color[0],e[i].name=e[i].name,r.river_data.push(e[i]);return total_start=t,total_end=e[e.length-1].end,total_weight=total_end-total_start,totol_group=total_weight<0?"negative":"positive",r.river_data.push({y:a,x:total_weight,end:total_end,start:total_start,group:totol_group,color:r.chart_color[2],name:e[e.length-1].name,unique_name:o?a+"-"+o:a
}),e},r.calculateRiverData=function(){r.river_data=[];for(var t,e=0;e<r.new_data_length;e++)if(0===e)r.dataTransformation(r.new_data[e]);else{var a=r.river_data.length;t=r.river_data[a-1];var n=r.check_total_is_present(t.name);PykCharts["boolean"](r.calculate_total)?!n&&r.calculate_total_of.length&&r.river_data.pop():r.river_data.pop(),name="Total "+r.new_data[e].name,r.rivergroup(r.river_data[0].start,r.new_data[e].data,name,t.end,r.new_data[e].name)}n=r.check_total_is_present(r.river_data[r.river_data.length-1].name),PykCharts["boolean"](r.calculate_total)?!n&&r.calculate_total_of.length&&r.river_data.pop():r.river_data.pop()},r.xaxis=function(){function t(t,e,a,n){r.group.append("line").attr("x1",t).attr("y1",a).attr("x2",e).attr("y2",n).attr("class","custom-axis").attr("stroke",r.axis_x_line_color).attr("stroke-width",1).style("shape-rendering","crispEdges")}var e=r.xScale.domain(),a=r.xScale(e[0])+r.longest_tick_width+15,n=r.xScale(e[1])+r.longest_tick_width+15,o=5,i=r.xScale(r.new_data[0].data[0].start)+r.longest_tick_width+15;if(PykCharts["boolean"](r.axis_x_enable)){t(a+o,n+o+1,r.reducedHeight,r.reducedHeight),t(a+o,a+o,r.reducedHeight,r.reducedHeight+r.axis_x_outer_pointer_length),t(n+o,n+o,r.reducedHeight,r.reducedHeight+r.axis_x_pointer_length),t(i+o,i+o,r.reducedHeight,r.reducedHeight+r.axis_x_pointer_length);var l=r.group.selectAll(".custom-axis-text").data([0]);l.enter().append("text"),l.attr("class","custom-axis-text").attr("x",i+o).attr("y",r.reducedHeight+r.axis_x_pointer_length).attr("dy",12).attr("text-anchor","middle").attr("fill",r.axis_x_pointer_color).style("font-family",r.axis_x_pointer_family).style("font-size",r.axis_x_pointer_size).style("font-weight",r.axis_x_pointer_weight).text("0"),l.exit().remove()}},r.sortData=function(){if("number"===r.axis_y_data_format||"time"===r.axis_y_data_format)for(var t=0;t<r.new_data_length;t++)r.new_data[t].data=r.k.__proto__._sortData(r.new_data[t].data,void 0,"y",r)}},PykCharts.maps={},PykCharts.maps.processInputs=function(t,e){var a=new PykCharts.Configuration.Theme({}),r=a.stylesheet,n=(a.functionality,a.mapsTheme);e.optional;if(t.timeline_duration="timeline_duration"in e?e.timeline_duration:n.timeline_duration,t.margin_left=e.timeline_margin_left?e.timeline_margin_left:n.timeline_margin_left,t.margin_right=e.timeline_margin_right?e.timeline_margin_right:n.timeline_margin_right,t.margin_top=e.timeline_margin_top?e.timeline_margin_top:n.timeline_margin_top,t.margin_bottom=e.timeline_margin_bottom?e.timeline_margin_bottom:n.timeline_margin_bottom,t.tooltip_position_top=e.tooltip_position_top?e.tooltip_position_top:n.tooltip_position_top,t.tooltip_position_left=e.tooltip_position_left?e.tooltip_position_left:n.tooltip_position_left,t.tooltipTopCorrection=d3.select(t.selector).style("top"),t.tooltipLeftCorrection=d3.select(t.selector).style("left"),t.chart_color=e.chart_color?e.chart_color:[],t.saturation_color=e.saturation_color?e.saturation_color:"",t.palette_color=e.palette_color?e.palette_color:n.palette_color,t.label_enable=e.label_enable?e.label_enable.toLowerCase():n.label_enable,t.chart_onhover_effect=e.chart_onhover_effect?e.chart_onhover_effect.toLowerCase():n.chart_onhover_effect,t.default_zoom_level=e.default_zoom_level?e.default_zoom_level:80,t.k=new PykCharts.Configuration(t),t.total_no_of_colors=e.total_no_of_colors&&t.k.__proto__._isNumber(parseInt(e.total_no_of_colors,10))?parseInt(e.total_no_of_colors,10):n.total_no_of_colors,t.default_color=e.default_color?e.default_color:r.chart_color,t.k.validator().validatingSelector(t.selector.substring(1,t.selector.length)).isArray(t.chart_color,"chart_color").validatingDataType(t.margin_left,"timeline_margin_left",n.timeline_margin_left,"margin_left").validatingDataType(t.margin_right,"timeline_margin_right",n.timeline_margin_right,"margin_right").validatingDataType(t.margin_top,"timeline_margin_top",n.timeline_margin_top,"margin_top").validatingDataType(t.margin_bottom,"timeline_margin_bottom",n.timeline_margin_bottom,"margin_bottom").validatingDataType(t.tooltip_position_top,"tooltip_position_top",n.tooltip_position_top).validatingDataType(t.tooltip_position_left,"tooltip_position_left",n.tooltip_position_left).validatingColor(t.highlight_color,"highlight_color",r.highlight_color).validatingColor(t.saturation_color,"saturation_color",r.saturation_color),t.chart_color.constructor===Array&&t.chart_color[0]&&t.k.validator().validatingColor(t.chart_color[0],"chart_color",r.chart_color),"saturation"===t.color_mode)try{if(t.total_no_of_colors<3||t.total_no_of_colors>9)throw t.total_no_of_colors=n.total_no_of_colors,"total_no_of_colors"}catch(o){t.k.warningHandling(o,"10")}try{if("shadow"!==t.chart_onhover_effect.toLowerCase()&&"none"!==t.chart_onhover_effect.toLowerCase()&&"highlight_border"!==t.chart_onhover_effect.toLowerCase()&&"color_saturation"!==t.chart_onhover_effect.toLowerCase())throw t.chart_onhover_effect=n.chart_onhover_effect,"chart_onhover_effect"}catch(o){t.k.warningHandling(o,"12")}try{if(!t.k.__proto__._isNumber(t.default_zoom_level))throw t.default_zoom_level=80,"default_zoom_level"}catch(o){t.k.warningHandling(o,"1")}return t.timeline_duration=1e3*t.timeline_duration,t},PykCharts.maps.oneLayer=function(t){var e=this;e.interval="";var a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"maps"),e=PykCharts.maps.processInputs(e,t),e.executeData=function(r){var n=e.k.validator().validatingJSON(r),o=e.selector.substring(1,e.selector.length);return e.stop||n===!1?void e.k.remove_loading_bar(o):(e.k.storeInitialDivHeight(),e.data=r,e.data_length=e.data.length,e.compare_data=r,e.k.totalColors(e.total_no_of_colors).colorType(e.color_mode).loading(e.loading).tooltip(),d3.json(PykCharts.assets+"ref/"+e.map_code+"-topo.json",function(r,n){if(r&&404===r.status)return e.k.errorHandling("map_code","3"),void e.k.remove_loading_bar(o);e.map_data=n;for(var i=e.map_data.objects.geometries.length,l=0;i>l;l++){var s=e.map_data.objects.geometries[l].properties.NAME_1.replace("'","&#39;");e.map_data.objects.geometries[l].properties.NAME_1=s}d3.json(PykCharts.assets+"ref/colorPalette.json",function(r){e.color_palette_data=r;var n=e.k.__proto__._where(e.color_palette_data,{name:e.palette_color});try{if(!n.length)throw e.palette_color=a.mapsTheme.palette_color,"palette_color"}catch(o){e.k.warningHandling(o,"11")}d3.select(e.selector).html(""),d3.select(e.selector).style("height","auto");var i=new PykCharts.maps.mapFunctions(t,e,"oneLayer");i.render()})}),e.extent_size=d3.extent(e.data,function(t){return parseInt(t.size,10)}),void(e.difference=e.extent_size[1]-e.extent_size[0]))},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}},PykCharts.maps.timelineMap=function(t){var e=this,a=new PykCharts.Configuration.Theme({});this.execute=function(r){e=new PykCharts.validation.processInputs(e,t,"maps"),e=PykCharts.maps.processInputs(e,t),PykCharts.scaleFunction(e),e.executeData=function(r){var n=e.k.validator().validatingJSON(r),o=e.selector.substring(1,e.selector.length);if(e.stop||n===!1)return void e.k.remove_loading_bar(o);e.k.storeInitialDivHeight(),e.timeline_data=r,e.compare_data=r;var i=d3.extent(r,function(t){return t.timestamp});r.length;e.data=e.k.__proto__._where(r,{timestamp:i[0]}),e.data_length=e.data.length,e.redeced_width=e.chart_width-2*e.margin_left-e.margin_left,e.k.totalColors(e.total_no_of_colors).colorType(e.color_mode).loading(e.loading).tooltip(e.tooltip_enable),d3.json(PykCharts.assets+"ref/"+e.map_code+"-topo.json",function(r){e.map_data=r;for(var n=e.map_data.objects.geometries.length,o=0;n>o;o++){var i=e.map_data.objects.geometries[o].properties.NAME_1.replace("'","&#39;");e.map_data.objects.geometries[o].properties.NAME_1=i}d3.json(PykCharts.assets+"ref/colorPalette.json",function(r){e.color_palette_data=r;var n=e.k.__proto__._where(e.color_palette_data,{name:e.palette_color});try{if(!n.length)throw e.palette_color=a.mapsTheme.palette_color,"palette_color"}catch(o){e.k.warningHandling(o,"11")}var i=d3.extent(e.timeline_data,function(t){return t.timestamp});e.data=e.k.__proto__._where(e.timeline_data,{timestamp:i[0]}),e.data_length=e.data.length,e.data.sort(function(t,e){return t.timestamp-e.timestamp}),d3.select(e.selector).html("");var l=new PykCharts.maps.mapFunctions(t,e,"timeline");l.render()})}),e.extent_size=d3.extent(e.data,function(t){return parseInt(t.size,10)}),e.difference=e.extent_size[1]-e.extent_size[0]},PykCharts["boolean"](e.interactive_enable)?(e.k.dataFromPykQuery(r),e.k.dataSourceFormatIdentification(e.data,e,"executeData")):e.k.dataSourceFormatIdentification(t.data,e,"executeData")}},PykCharts.maps.mapFunctions=function(t,e,a){var r=e,n=r.selector.substring(1,r.selector.length),o=n+"_svg";this.render=function(){r.border=new PykCharts.Configuration.border(r),r.mouseEvent=new PykCharts.Configuration.mouseEvent(r),r.k.title().backgroundColor(r),"oneLayer"===a&&r.k["export"](r,"#"+o,a).emptyDiv().subtitle().exportSVG(r,"#"+o,a),r.current_palette=r.k.__proto__._where(r.color_palette_data,{name:r.palette_color,number:r.total_no_of_colors})[0],"timeline"===a&&r.k.subtitle(),r.optionalFeatures().svgContainer(o).legendsContainer(r.legends_enable).legends(r.legends_enable).createMap().label(r.label_enable).enableClick(r.click_enable),r.redeced_height=r.chart_height-r.margin_top-r.margin_bottom,r.k.createFooter().lastUpdatedAt().credits().dataSource(),"timeline"===a&&(r.optionalFeatures().axisContainer(!0),r.renderDataForTimescale(),r.backgroundColor(),r.renderButtons(),r.renderTimeline());var t=r.k.resize(r.svgContainer);r.k.__proto__._ready(t),window.addEventListener("resize",function(t){return r.k.resize(r.svgContainer)})},r.refresh=function(e){r.executeRefresh=function(t){r.data=t,r.data_length=r.data.length,r.refresh_data=t;var e=r.k.checkChangeInData(r.refresh_data,r.compare_data);r.compare_data=e[0];var a=e[1];a&&r.k.lastUpdatedAt("liveData"),r.extent_size=d3.extent(r.data,function(t){return parseInt(t.size,10)}),r.difference=r.extent_size[1]-r.extent_size[0],r.optionalFeatures().legends(r.legends_enable).createMap()},"oneLayer"===a&&(PykCharts["boolean"](r.interactive_enable)?(r.k.dataFromPykQuery(e),r.k.dataSourceFormatIdentification(r.data,r,"executeRefresh")):r.k.dataSourceFormatIdentification(t.data,r,"executeRefresh"))},r.optionalFeatures=function(){var t=r.selector.substring(1,r.selector.length),e={legends:function(t){return PykCharts["boolean"](t)&&r.renderLegend(),this},legendsContainer:function(t){return PykCharts["boolean"](t)&&"saturation"===r.color_mode?r.legendsContainer=r.svgContainer.append("g").attr("id","legend-container"):(r.legendsGroup_height=0,r.legendsGroup_width=0),this},label:function(t){return PykCharts["boolean"](t)&&r.renderLabel(),this},svgContainer:function(e){document.getElementById(t).style.width="100%",r.svgContainer=d3.select(r.selector).append("svg").attr({width:r.chart_width,height:r.chart_height,id:e,"class":"PykCharts-map",preserveAspectRatio:"xMinYMin",viewBox:"0 0 "+r.chart_width+" "+r.chart_height}),r.map_cont=r.svgContainer.append("g").attr("id","map_group");var a=r.map_cont.append("defs"),n=a.append("filter").attr("id","dropshadow");n.append("feGaussianBlur").attr({"in":"SourceAlpha",stdDeviation:1,result:"blur"}),n.append("feOffset").attr({"in":"blur",dx:1,dy:1,result:"offsetBlur"});var o=n.append("feMerge");return o.append("feMergeNode").attr('in", "offsetBlur'),o.append("feMergeNode").attr("in","SourceGraphic"),this},createMap:function(){var e=r.chart_width-r.legendsGroup_width,a=r.chart_height-r.legendsGroup_height-r.margin_bottom-r.margin_top-10,n=150,o=[e/2,a/2];if(document.getElementById(t).style.backgroundColor=r.background_color,r.group=r.map_cont.selectAll(".map_group").data(topojson.feature(r.map_data,r.map_data.objects).features),r.group.enter().append("g").attr("class","map_group").append("path"),"world"===r.map_code||"world_with_antarctica"===r.map_code)var i=[0,0];else var i=d3.geo.centroid(topojson.feature(r.map_data,r.map_data.objects));var l=d3.geo.mercator().center(i).scale(n).translate(o);r.path=d3.geo.path().projection(l);var s=r.path.bounds(topojson.feature(r.map_data,r.map_data.objects)),_=n*e/(s[1][0]-s[0][0]),c=n*a/(s[1][1]-s[0][1]),n=c>_?_:c,o=[e-(s[0][0]+s[1][0])/2,a-(s[0][1]+s[1][1])/2];l=d3.geo.mercator().center(i).scale(r.default_zoom_level/100*n).translate(o),r.path=r.path.projection(l);var d=d3.select("#pyk-tooltip");return r.chart_data=r.group.select("path").attr({d:r.path,"class":"area",iso2:function(t){return t.properties.iso_a2},area_name:function(t){return t.properties.NAME_1},fill:r.renderColor,prev_fill:function(t){return d3.select(this).attr("fill")},"fill-opacity":r.renderOpacity,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")},"data-id":function(t,e){return t.properties.iso_a2}}).style({stroke:r.border.color(),"stroke-width":r.border.width(),"stroke-dasharray":r.border.style()}).on({mouseover:function(t){var e=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0];if(e){if(PykCharts["boolean"](r.tooltip_enable)){var a=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0].tooltip?r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0].tooltip:"<table><thead><th colspan='2'><b>"+t.properties.NAME_1+"</b></th></thead><tr><td>"+(r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0].tooltip_column_name||"Size")+"</td><td><b>"+PykCharts.numberFormat(r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0].size)+"</b></td></tr></table>";d.style("display","block"),d.html(a),"moving"===r.tooltip_mode?d.style("top",function(){return PykCharts.getEvent().pageY-20+"px"}).style("left",function(){return PykCharts.getEvent().pageX+20+"px"}):"fixed"===r.tooltip_mode&&d.style("top",r.tooltip_position_top+"px").style("left",r.tooltip_position_left+"px")}r.enable_custom_hover?d3.select(this).style("fill",r.active_color||"red"):"color_saturation"===r.onhover1&&PykCharts["boolean"](r.chart_onhover_highlight_enable)?r.mouseEvent.highlight(r.selector+" .area",this):r.bodColor(t)}},mouseout:function(t){r.enable_custom_hover?(d3.select(this).style("fill",d3.select(this).attr("prev_fill")),d.style("display","none")):(PykCharts["boolean"](r.tooltip_enable)&&d.style("display","none"),r.bodUncolor(t),r.mouseEvent.highlightHide(r.selector+" .area"))},click:function(t,e){if(PykCharts["boolean"](r.click_enable)){var a=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0];window.location.href=location.origin+a.url}}}),r.group.exit().remove(),this},enableClick:function(t){return PykCharts["boolean"](t)?r.onhover1=r.chart_onhover_effect:r.onhover1=r.chart_onhover_effect,this},axisContainer:function(t){return PykCharts["boolean"](t)&&(r.gxaxis=r.svgContainer.append("g").attr({id:"xaxis","class":"x axis",transform:"translate("+2*r.margin_left+","+r.redeced_height+")"})),this}};return e},r.renderColor=function(t,e){if(!PykCharts["boolean"](t))return!1;var a,n=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2});if(n.length>0){if("color"===r.color_mode)return r.chart_color[0]?r.chart_color[0]:n.length>0&&PykCharts["boolean"](n[0].color)?n[0].color:r.default_color[0];if("saturation"===r.color_mode){if(r.highlight===r.map_data.objects.geometries[e].properties.iso_a2)return r.highlight_color;if(""!==r.saturation_color)return r.saturation_color;if(""!==r.palette_color)for(a=n[0].size,e=0;e<r.current_palette.colors.length;e++)if(a>=r.extent_size[0]+e*(r.difference/r.current_palette.colors.length)&&a<=r.extent_size[0]+(e+1)*(r.difference/r.current_palette.colors.length))return 1===r.data.length?r.current_palette.colors[r.current_palette.colors.length-1]:r.enable_custom_hover&&r.inactive_color?r.inactive_color:r.current_palette.colors[e]}return r.default_color[0]}return r.enable_custom_hover?r.no_data_color||r.default_color[0]:r.default_color[0]},r.renderOpacity=function(t){var e=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0];return"undefined"!=typeof e&&""!==r.saturation_color&&"saturation"===r.color_mode?(r.oneninth=+d3.format(".2f")(r.difference/r.total_no_of_colors),r.opacity=(parseInt(r.extent_size[0])+parseInt(r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0].size)+parseInt(r.oneninth))/r.difference,r.opacity):1},r.renderLegend=function(){var t;if("saturation"===r.color_mode){if("vertical"===r.legends_display){var e=0,a=0;""===r.palette_color?(r.legendsContainer.attr("height",290),r.legendsGroup_height=0):(r.legendsContainer.attr("height",30*r.current_palette.number+20),r.legendsGroup_height=0),text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y",rect_parameter1value=13,rect_parameter2value=13,s=function(t,e){return 38},_=function(t,e){return 20};var n=function(t){return a++,24*a+12},o=function(t){return e++,24*e+23}}else if("horizontal"===r.legends_display){var i=0,l=0;""===r.palette_color?(i=9,l=9):(i=r.current_palette.number,l=r.current_palette.number,r.legendsContainer.attr("height",30*r.current_palette.number+20),r.legendsGroup_height=30*r.current_palette.number+20),r.legendsContainer.attr("height",50),r.legendsGroup_height=50,final_rect_x=0,final_text_x=0,legend_text_widths=[],temp_text=temp_rect=0,text_parameter1="x",text_parameter2="y",rect_parameter1="width",rect_parameter2="height",rect_parameter3="x",rect_parameter4="y";var s=function(t,e){return legend_text_widths[e]=this.getBBox().width,legend_start_x=16,final_text_x=0===e?legend_start_x:legend_start_x+temp_text,temp_text=temp_text+legend_text_widths[e]+30,final_text_x};o=30,rect_parameter1value=13,rect_parameter2value=13;var _=function(t,e){return final_rect_x=0===e?0:temp_rect,temp_rect=temp_rect+legend_text_widths[e]+30,final_rect_x};n=18}if(""!==r.saturation_color){for(var t,c=[],l=1;l<=r.total_no_of_colors;l++)c.push(l);t=d3.format(".1f")(r.extent_size[1]/r.total_no_of_colors),r.leg=function(e,a){return"<"+d3.format(".2s")(d3.round(t*(a+1)))};var d=r.legendsContainer.selectAll(".rect").data(c);r.legends_text=r.legendsContainer.selectAll(".text").data(c),r.legends_text.enter().append("text"),r.legends_text.attr("class","text").attr("pointer-events","none").text(r.leg).attr({fill:r.legends_text_color,"font-family":r.legends_text_family,"font-size":r.legends_text_size,"font-weight":r.legends_text_weight,x:s,y:o}),d.enter().append("rect"),d.attr("class","rect").attr({x:_,y:n,width:rect_parameter1value,height:rect_parameter2value,fill:r.saturation_color,"fill-opacity":function(t,e){return(e+1)/r.total_no_of_colors}});var u,h=r.legendsContainer.node().getBBox().width;"vertical"===r.legends_display?r.legendsGroup_width=h+20:r.legendsGroup_width=0,u="vertical"===r.legends_display?r.chart_width-r.legendsGroup_width:r.chart_width-h-20,h<r.chart_width&&r.legendsContainer.attr("transform","translate("+(u-20)+",10)"),r.legendsContainer.style("visibility","visible"),r.legends_text.exit().remove(),d.exit().remove()}else{r.leg=function(t,e){return"<"+d3.round(r.extent_size[0]+(e+1)*(r.difference/r.current_palette.number))};var d=r.legendsContainer.selectAll(".rect").data(r.current_palette.colors);r.legends_text=r.legendsContainer.selectAll(".text").data(r.current_palette.colors),r.legends_text.enter().append("text"),r.legends_text.attr("class","text").attr("pointer-events","none").text(r.leg).attr({fill:r.legends_text_color,"font-family":r.legends_text_family,"font-size":r.legends_text_size,"font-weight":r.legends_text_weight,x:s,y:o}),d.enter().append("rect"),d.attr({"class":"rect",width:rect_parameter1value,height:rect_parameter2value,fill:function(t){return t},x:_,y:n});var u,h=r.legendsContainer.node().getBBox().width;"vertical"===r.legends_display?r.legendsGroup_width=h+20:r.legendsGroup_width=0,u="vertical"===r.legends_display?r.chart_width-r.legendsGroup_width:r.chart_width-h-20,h<r.chart_width&&r.legendsContainer.attr("transform","translate("+u+",10)"),r.legendsContainer.style("visibility","visible"),r.legends_text.exit().remove(),d.exit().remove()}}else{var p=document.getElementById("legend-container");p&&p.parentNode.removeChild(p)}},r.renderLabel=function(){r.group.append("text").attr({x:function(t){return r.path.centroid(t)[0]},y:function(t){return r.path.centroid(t)[1]},"text-anchor":"middle","font-size":"10px",fill:r.label_color,"pointer-events":"none"}).text(function(t){return t.properties.NAME_1.replace("&#39;","'")})},r.bodColor=function(t){var e=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2});PykCharts["boolean"](r.chart_onhover_highlight_enable)?"highlight_border"===r.onhover1?d3.select("path[area_name='"+t.properties.NAME_1+"']").style({stroke:r.border.color(),"stroke-width":parseFloat(r.border.width())+1.5+"px","stroke-dasharray":r.border.style()}):"shadow"===r.onhover1&&d3.select("path[area_name='"+t.properties.NAME_1+"']").attr({filter:"url(#dropshadow)","fill-opacity":function(){return""===r.palette_color&&"saturation"===r.color_mode?(r.oneninth_dim=+d3.format(".2f")(r.difference/r.total_no_of_colors),r.opacity_dim=(r.extent_size[0]+e[0].size+r.oneninth_dim)/r.difference,r.opacity_dim/2):.5}}):r.bodUncolor(t)},r.bodUncolor=function(t){d3.select("path[area_name='"+t.properties.NAME_1+"']").style({stroke:r.border.color(),"stroke-width":r.border.width(),"stroke-dasharray":r.border.style()}).attr({filter:null,"fill-opacity":function(){var e=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0];return"undefined"!=typeof e&&""!==r.saturation_color&&"saturation"===r.color_mode?(r.oneninth_high=+d3.format(".2f")(r.difference/r.total_no_of_colors),r.opacity_high=(parseInt(r.extent_size[0])+parseInt(e.size)+parseInt(r.oneninth_high))/r.difference,r.opacity_high):1}})},this.clicked=function(t){var e={};e.container=PykCharts.getEvent().target.ownerSVGElement.parentNode.id,e.area=t.properties,e.data=r.k.__proto__._where(r.data,{iso2:t.properties.iso_a2})[0];try{customFunction(e)}catch(a){}},r.backgroundColor=function(){function t(n){return a=n,e=d3.select(n).style("background-color"),"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e?r.k.__proto__._colourBrightness(e,d3.selectAll(n)[0]):void 0!==d3.select(n)[0][0].parentNode.tagName&&"body"!==d3.select(n)[0][0].parentNode.tagName.toLowerCase()?t(d3.select(n)[0][0].parentNode):void r.k.__proto__._colourBrightness("rgb(255,255,255)",d3.select(n)[0])}var e,a;t(r.selector),d3.select(a)[0][0].classList.contains("light")||"/overview"===window.location.pathname?(r.play_image_url=PykCharts.assets+"img/play.png",r.pause_image_url=PykCharts.assets+"img/pause.png",r.marker_image_url=PykCharts.assets+"img/marker.png"):(r.play_image_url=PykCharts.assets+"img/play-light.png",r.pause_image_url=PykCharts.assets+"img/pause-light.png",r.marker_image_url=PykCharts.assets+"img/marker-light.png")},r.renderDataForTimescale=function(){r.unique=[],x_extent=d3.extent(r.timeline_data,function(t){return t.timestamp}),x_range=[0,r.redeced_width],r.xScale=r.k.scaleIdentification("linear",x_extent,x_range);for(var t=r.timeline_data.length,e=0;t>e;e++)-1===r.unique.indexOf(r.timeline_data[e].timestamp)&&r.unique.push(r.timeline_data[e].timestamp);r.unique.sort(function(t,e){return t-e}),r.k.xAxis(r.svgContainer,r.gxaxis,r.xScale),r.gxaxis&&r.gxaxis.attr("transform","translate("+2*r.margin_left+","+r.redeced_height+")")},r.renderTimeline=function(){var t=interval1=r.interval_index=1;r.play.on("click",function(){e()}),r.timeline_status="";var e=function(){if("playing"===r.timeline_status)r.play.attr("xlink:href",r.play_image_url),r.timeline_status="paused",r.interval_index=t,clearInterval(r.play_interval);else{r.timeline_status="playing",r.play.attr("xlink:href",r.pause_image_url),t=r.interval_index;var e=function(){t===r.unique.length&&(t=0),r.marker.attr("x",2*r.margin_left+r.xScale(r.unique[t])-7),r.data=r.k.__proto__._where(r.timeline_data,{timestamp:r.unique[t]}),r.data_length=r.data.length,r.data.sort(function(t,e){return t.timestamp-e.timestamp}),r.extent_size=d3.extent(r.data,function(t){return parseInt(t.size,10)}),r.difference=r.extent_size[1]-r.extent_size[0];for(var e=0;e<r.data_length;e++)d3.select(r.selector+" path[iso2='"+r.data[e].iso2+"']").attr({fill:r.renderColor,"fill-opacity":r.renderOpacity,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")}});t++};r.play_interval=setInterval(function(){e(),1===t&&(r.play.attr("xlink:href",r.play_image_url),r.interval_index=1,r.timeline_status="",clearInterval(r.play_interval))},r.timeline_duration),e()}}},r.renderButtons=function(){function t(t){if(document.getElementsByTagName("body")[0].style.cursor="pointer","playing"!==r.timeline_status){for(var e,a,n,o,i=PykCharts.getEvent().sourceEvent.pageX-r.margin_left,l=[],s=r.xScale.range(),_=r.unique.length,c=(s[1]-s[0])/_,d=0,u=0;_>u;u++)d+=c,l[u]=parseInt(d);for(var h=0;_>h;h++)if(i>=l[h]&&i<=l[h+1]){if(e=l[h],a=l[h+1],n=i-e,o=a-i,n>=o&&_-2>=h){r.marker.attr("x",2*r.margin_left+r.xScale(r.unique[h])-7),r.data=r.k.__proto__._where(r.timeline_data,{timestamp:r.unique[h]}),r.data_length=r.data.length,r.data.sort(function(t,e){return t.timestamp-e.timestamp}),r.extent_size=d3.extent(r.data,function(t){return parseInt(t.size,10)}),r.difference=r.extent_size[1]-r.extent_size[0];for(var p=0;p<r.data_length;p++)d3.select(r.selector+" path[iso2='"+r.data[p].iso2+"']").attr({fill:r.renderColor,"fill-opacity":r.renderOpacity,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")}});r.interval_index=h}}else if(i>l[h]&&h>_-2){r.marker.attr("x",2*r.margin_left+r.xScale(r.unique[h])-7),r.data=r.k.__proto__._where(r.timeline_data,{timestamp:r.unique[h]}),r.data_length=r.data.length,r.data.sort(function(t,e){return t.timestamp-e.timestamp}),r.extent_size=d3.extent(r.data,function(t){return parseInt(t.size,10)}),r.difference=r.extent_size[1]-r.extent_size[0];for(var p=0;p<r.data_length;p++)d3.select(r.selector+" path[iso2='"+r.data[p].iso2+"']").attr({fill:r.renderColor,"fill-opacity":r.renderOpacity,"data-fill-opacity":function(){return d3.select(this).attr("fill-opacity")}});r.interval_index=h}}}var e=d3.select(r.selector+" .axis").node().getBBox();drag=d3.behavior.drag().origin(Object).on("drag",t).on("dragend",function(){document.getElementsByTagName("body")[0].style.cursor="default"}),r.play=r.svgContainer.append("image").attr({"xlink:href":r.play_image_url,x:r.margin_left/2,y:r.redeced_height-r.margin_top-e.height/2,width:"24px",height:"21px"}).style("cursor","pointer"),r.marker=r.svgContainer.append("image").attr({"xlink:href":r.marker_image_url,x:2*r.margin_left+r.xScale(r.unique[0])-7,y:r.redeced_height,width:"14px",height:"12px"}).style("cursor","pointer").call(drag)}};var anonymousFunc=function(){function t(t){var e=document.createElement("script");e.type="text/javascript",e.async=!1,e.onload=function(){try{PykCharts.numberFormat=d3.format(","),d3&&d3.customHive&&topojson&&$c&&paper&&(window.PykChartsInit(),document.querySelector("body").onclick=function(){0===PykCharts.export_menu_status&&d3.selectAll(".dropdown-multipleConatiner-export").style("visibility","hidden"),PykCharts.export_menu_status=0})}catch(t){}},e.src=t;var a=document.getElementsByTagName("link")[0];a.parentNode.insertBefore(e,a)}var e=[PykCharts.assets+"lib/d3.min.js",PykCharts.assets+"lib/topojson.min.js",PykCharts.assets+"lib/custom-hive.min.js",PykCharts.assets+"lib/colors.min.js"];try{d3||t(e[0])}catch(a){t(e[0])}try{d3.customHive||t(e[1])}catch(a){t(e[1])}try{topojson||t(e[2])}catch(a){t(e[2])}try{$c||t(e[3])}catch(a){t(e[3])}};window.onload=anonymousFunc();
PykUtil={},PykUtil.init=function(){this.pushToArray=function(b,c){return b=a.length?a.push(c):[c]},this.concatAndUniq=function(a,b){return void 0!=a&&void 0!=b&&(a=a.concat(b).filter(function(a,b,c){return c.indexOf(a)===b})),a},this.isExactlySame=function(a,b){if(a&&b){var c=a.length===b.length&&a.every(function(a,c){return _.isEqual(a,b[c])});return c}return!1},this.subtractArray=function(a,b){if(a&&b){if(0===a.length)return a=void 0;for(var c=b.length,d=0;c>d;d++){var e=a.indexOf(b[d]);if(e>-1&&a.splice(e,1),0===a.length)return a=void 0}}return a},this.subtractObjectAttribute=function(a,b){if(a&&b){if(0===Object.keys(a).length)return a=void 0;for(var c=b.length,d=0;c>d;d++)if(a[b[d]]&&delete a[b[d]],0===Object.keys(a).length)return a=void 0}return a},this.isBlank=function(a){return a?!1:!0}};var PykQuery={};PykQuery.global_names=[],PykQuery.local_names=[],PykQuery.query_json={};var queryjson={},query_restore=!0,restoreFilters=function(){for(var a in PykQuery.query_json){for(var b,c=PykQuery.query_json[a],d=window[a],e=c.length,f=0;e>f;f++)b="local"===d.scope?!1:!0,d.addFilter([c[f]],b,!0,d.localdividtriggeringevent,!0);if(0===e&&"global"===d.scope){var g=document.getElementsByClassName("filter_list");if(g.length>0){var h=g[0].parentNode.id;d.listFilters(h)}}}};Object.defineProperty(PykQuery,"query_json",{get:function(){return queryjson},set:function(a){queryjson=a,query_restore&&restoreFilters()}});var setQueryJSON=function(a,b,c){PykQuery.query_json[a]=c};PykQuery.init=function(a,b,c,d){var e,f,g,h,i,j,k,l,m=this,n=d,o=[],p=["aggregation","unique","select","datatype","global"],q=["local","global"],r=["inbrowser","rumi"],s=["csv","json","array"],t=new PykUtil.init,u=t.isBlank,v=t.concatAndUniq,w=t.subtractArray,x=t.subtractObjectAttribute,y=function(a,b){var c="";100>a&&(c="Visit http://0.0.0.0:4567/#error_"+a),console.error("%c[Error - PykQuery] ","color: red;font-weight:bold;font-size:14px",'("'+b+'"). '+c)},z=function(a,b){console.warn("%c[Warning - PykQuery] ","color: #F8C325;font-weight:bold;font-size:14px",'("'+b+'"). Visit http://0.0.0.0:4567/#warning_'+a)};if(!(p.indexOf(a)>-1&&q.indexOf(b)>-1&&!u(c)&&r.indexOf(d)>-1))return-1===p.indexOf(a)&&y(2,c+": mode has invalid value. It should be one of "+p),-1===q.indexOf(b)&&y(3,c+": scope has invalid value. It should be one of "+q),-1===r.indexOf(d)&&y(4,c+": adapters has invalid value. It should be one of "+r),u(c)&&y(5,c+": DivID cannot be undefined"),!1;if(f=a,g=b,h=d,e="local"===g?c.replace("#",""):c,i="global"===g?_.find(PykQuery.global_names,function(a){return a===e}):null,j="local"===g?_.find(PykQuery.local_names,function(a){return a===e}):null,"global"==f&&"global"!=g)return y(1,e+": scope and mode both should be global"),!1;if(void 0==i&&"global"==g)PykQuery.global_names.push(e),flag=!0;else{if(void 0!=j||"local"!=g)return flag=!1,!1;PykQuery.local_names.push(e),flag=!0}var A,B,C,D,E=[],F=[],G={},H=[],I=[],J=2e3,K=[],L=[],M=0,N={},O=[],P=!0;switch(this.executeOnFilter=function(){},"global"===f&&"global"===g&&"inbrowser"===h&&Object.defineProperty(this,"rawdata",{get:function(){return B},set:function(a){B=a}}),"local"===g&&"inbrowser"===h&&Object.defineProperty(this,"global_divid_for_raw_data",{get:function(){return C},set:function(a){C=a}}),"rumi"===h&&(Object.defineProperty(this,"rumiparams",{get:function(){return n},set:function(a){n=a}}),Object.defineProperty(this,"dataformat",{get:function(){return D},set:function(a){s.indexOf(a.toLowerCase())>-1?D=a:y(6,"The accepted data formats are csv, json and array only. Kindly set a valid data format")}})),Object.defineProperty(this,"scope",{get:function(){return g}}),f){case"select":Object.defineProperty(this,"select",{get:function(){return H},set:function(a){H=a}});break;case"aggregation":Object.defineProperty(this,"dimensions",{get:function(){return F},set:function(a){F=v(F,a)}}),Object.defineProperty(this,"metrics",{get:function(){return G},set:function(a){if($(a))for(var b in a)G[b]=a[b]}});break;case"unique":Object.defineProperty(this,"unique",{get:function(){return H},set:function(a){_.each(a,function(a){H.push(a)})}});break;case"datatype":"datatype"===f&&"local"===g&&"rumi"===h&&Object.defineProperty(this,"datatype",{get:function(){return O},set:function(a){O=v(O,a)}})}Object.defineProperty(this,"div_id",{get:function(){return e}}),Object.defineProperty(this,"localdividtriggeringevent",{get:function(){return k},set:function(a){k=a}}),Object.defineProperty(this,"limit",{get:function(){return J},set:function(a){J=a}}),Object.defineProperty(this,"mode",{get:function(){return f}}),Object.defineProperty(this,"offset",{get:function(){return M},set:function(a){M=a}}),Object.defineProperty(this,"impacts",{get:function(){return K},set:function(a){Y(a)&&K.push(a)}}),Object.defineProperty(this,"impactedby",{get:function(){return L},set:function(a){L.push(a)}}),Object.defineProperty(this,"alias",{get:function(){return N},set:function(a){if(columns=Object.keys(a),columns.length<1)return void z(1,"Need atleast 1 alias name to add.");for(var b in a)N[b]=a[b]}}),Object.defineProperty(this,"sort",{get:function(){return I},set:function(a){for(var b=a.length,c=0;b>c;c++){var d=Object.keys(a[c])[0],e=I.length,f=!1;if(u(d))return void y(8,"Column name is undefined in sort");(u(a[c][d])||"asc"!=a[c][d]&&"desc"!=a[c][d])&&(a[c][d]="asc");for(var g=0;e>g;g++)if(I[g][d]){I[g][d]=a[c][d],f=!0;break}f||(I=v(I,a))}}}),Object.defineProperty(this,"filters",{get:function(){return E},set:function(a){E=a}}),this.addFilter=function(a,b,c,d,e){b&&"global"===g?(Q(a,b,c,this,e),document.getElementsByClassName("filter_list").length>0&&eb()):b&&"local"===g?R(a,c):b||"local"!==g||Q(a,b,c,this,e)};var Q=function(a,b,c,d,e){for(var f=!1,g=E.length,h=a.length,i=!0,j=0;h>j;j++){var k=a[j],l=k.length,m=document.querySelectorAll("[data-id='"+k[0].selected_dom_id+"']");if(l>1){for(var n=0;l-1>n;n++)k[n].group=!0;k[l-1].group=!1}if(0===g)E.push(k),f=!0,i=!1;else{for(var o=!1,p=0;g>p;p++){var q=t.isExactlySame(k,E[p]),r=t.isExactlySame(k,E[p]);if(r&&q){z(2,"Clean up your JS: Same filter cannot add"),o=!0;break}}if(o)break;if(m.length>0&&m[0].classList.contains("pykquery-selected")&&!k.override_filter);else{for(var s=!1,u=0;l>u;u++)for(var v=k[u],w=!1,x=0;g>x;x++){var y=E[x],A=y.length;if(Z(v)){for(var B=0;A>B;B++){var C=y[B],D=C.column_name,F=C.condition_type;if(D===v.column_name&&F===v.condition_type)if("values"===F||"datatype"===F){var G=t.isExactlySame(v.not_in,C["in"]),H=t.isExactlySame(v["in"],C.not_in);if(v.override_filter&&(G||H)){E[x][B]=v,P=!1,w=!0,s=!0;break}}else if("range"===F){var I=v.condition,J=C.condition;if(I.min===J.min&&I.max===J.max&&I.not===J.not){z(2,"Clean up your JS: Same filter cannot add");break}if(v.override_filter){E[x][B]=v,P=!1,w=!0,s=!0;break}}}if(w){i=!1;break}}}s||(E.push(k),f=!0,i=!1)}}}i?d.removeFilter(a,b,c):(f===!0?d&&"global"===d.scope&&c&&d.call():!P&&c&&d.call(),query_restore=e,e||setQueryJSON(d.div_id,d.scope,E),query_restore=!0)},R=function(a,b){for(var c=a.length,d=0;c>d;d++)for(var f=a[d],h=f.length,i=0;h>i;i++)f[i].local_div_id_triggering_event=e;if("local"===g)for(var j=K.length,i=0;j>i;i++)window[K[i]].addFilter(a,!0,b,e)};this.removeFilter=function(a,b,c){b&&"global"===g?(S(a,this,c),document.getElementsByClassName("filter_list").length>0&&eb()):b&&"local"===g?T(a,this,c):b||"local"!==g||S(a,this,c)};var S=function(a,b,c){for(var d=b.filters,e=d.length,f=a.length,g=!1,h=0;f>h;h++){for(var i=a[h],j=i.length,k=!1,l=0;e>l;l++){var m=t.isExactlySame(i,d[l]),n=t.isExactlySame(i,d[l]);if(n&&m){d.splice(l,1),g=!0,k=!0;break}}if(!k&&1===j)for(var o=0;j>o;o++){var p=i[o];if(column_name=p.column_name,condition_type=p.condition_type,Z(p))for(var q=0;e>q;q++){var r=d[q],s=r.length,v=d.slice(0);if(1===s)for(var w=0;e>w;w++){var x=r[w],y=(x.column_name,x.condition_type,v[w]);if(y.column_name===column_name&&y.condition_type===condition_type)if("values"===condition_type||"datatype"===condition_type)0===_.difference(y.in,name_j.in).length&&0===_.difference(y.not_in,name_j.not_in).length&&(d.splice(w,1),g=!0);else if("range"===condition_type){var z=name_j.condition.min,A=name_j.condition.max;u(z)||u(A)||z===y.condition.min&&A===y.condition.max&&(d.splice(w,1),g=!0)}}}}}b&&g&&c&&b.call(),query_restore=!1,setQueryJSON(b.div_id,b.scope,d)},T=function(a,b,c){if("local"===g)for(var d=K.length,e=0;d>e;e++)window[K[e]].removeFilter(a,b,c)},U=function(a,b){for(var c=E.length,d=a.length,e=0;d>e;e++)V(a[e],b),E=_.reject(E,function(b){for(var c=b.length,d=0;c>d;d++)return b[d].column_name==a[e]});E.length!==c&&(document.getElementsByClassName("filter_list").length>0&&eb(),b.call())},V=function(a,b){var c=b.alias,d=b.select,e=b.sort;if(c&&delete c[a],d){var f=d.indexOf(a);f>-1&&d.splice(f,1)}e&&(e=_.reject(e,function(b){return Object.keys(b)[0]==a}))};this.resetFilters=function(){if("global"===g){for(;E.length>0;)E.pop();this.call(),query_restore=!1,setQueryJSON(this.div_id,this.scope,E),document.getElementsByClassName("filter_list").length>0&&eb()}else y(9,"You cannot run resetFilters on local. Please run it on a Global")},this.resetDimensions=function(){if("local"===g){for(;this.dimensions.length>0;)V(this.dimensions[this.dimensions.length-1],this),this.dimensions.pop();query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else y(10,"Globals do not have dimensions. Please run it on a local")},this.resetDatatypes=function(){if("local"===g){for(;this.datatype.length>0;)this.datatype.pop();query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else y(11,"Globals do not have datatypes. Please run it on a local")},this.resetMetrics=function(){if("local"===g){for(var a in this.metrics)V(a,this),delete this.metrics[a];query_restore=!1,setQueryJSON(this.div_id,this.scope,[])}else y(12,"Globals do not have metrics. Please run it on a local")},this.removeDimensions=function(a){if(u(a)||0===a.length)return y(27,a+": Columns cannot be blank. Kindly pass an array of dimensions"),!1;if(this.dimensions){var b=this.dimensions.length;if(b>0&&(w(this.dimensions,a),b===this.dimensions.length))return!1}return U(a,this),query_restore=!1,setQueryJSON(this.div_id,this.scope,this.filters),!0},this.removeMetrics=function(a){if(u(a)||0===a.length)return y(27,a+": Columns cannot be blank. Kindly pass an array of metrics"),!1;if(this.metrics){var b=Object.keys(this.metrics).length;if(b>0&&(x(this.metrics,a),b===Object.keys(this.metrics).length))return!1}return U(a,this),query_restore=!1,setQueryJSON(this.div_id,this.scope,this.filters),!0},this.destroyColumn=function(a){if("global"===g){this.removeDimensions([a]),this.removeMetrics([a]);for(var b=K.length,c=0;b>c;c++)window[K[c]].removeDimensions([a]),window[K[c]].removeMetrics([a])}else this.removeDimensions([a]),this.removeMetrics([a])};var W=function(a,b,c){var d=a.filters;if("local"===g){var e=a.dimensions,f=a.metrics,h=a.alias,i=a.select,j=a.sort;if(e){var k=e.indexOf(b);k>-1&&(e[k]=c)}if(f&&f[b]&&(f[c]=f[b],delete f[b]),h&&h[b]&&(h[b]=h[c],delete h[b]),i){var l=i.indexOf(b);l>-1&&(i[l]=c)}if(j)for(var m=j.length,n=0;m>n;n++)j[n][b]&&(j[n][c]=j[n][b],delete j[n][b])}if(d)for(var o=d.length,n=0;o>n;n++)d[n].column_name===b&&(d[n].column_name=c,document.getElementsByClassName("filter_list").length>0&&eb())};this.changeColumnName=function(a,b,c){if("global"===g){W(this,a,b);for(var d=K.length,e=0;d>e;e++)window[K[e]].changeColumnName(a,b,!0)}else if(W(this,a,b),!c)for(var d=K.length,e=0;d>e;e++)window[K[e]].changeColumnName(a,b)},this.addImpacts=function(a,b){if(Y(a)){len=a.length;for(var c=0;len>c;c++){K.push(a[c]);var d=window[a[c]];d.impactedby=this.div_id,"local"===this.scope?X(this,a[c]):X(d,this.div_id),b&&(L.push(a[c]),d.impacts.push(this.div_id),X(d,this.div_id))}}};var X=function(a,b){a.global_divid_for_raw_data||(a.global_divid_for_raw_data=b)},Y=function(a){var b,c,d=a.length;"local"===g?(error_code=13,b="global"):(error_code=7,b="local");for(var e=0;d>e;e++)if(c=window[a[e]],c&&c.scope===g)return y(error_code,"A "+g+" can only impact a "+b),!1;return!0},Z=function(a){{var b=a.next;a.condition_type}return 0===Object.keys(a).length?(y(14,"Empty filter object is not allowed"),!1):u(a.column_name)?(y(15,"'column_name' cannot be empty"),!1):u(b)||"OR"===b||"AND"===b?"range"===a.condition_type?u(a.condition)?(y(17,"'condition' cannot be empty"),!1):u(a.condition.min)&&u(a.condition.max)?(y(18,"Either 'min' or 'max' or both must always be present"),!1):!0:"values"===a.condition_type||"datatype"===a.condition_type?u(a.not_in)&&u(a["in"])?(y(19,"Either 'in' or 'not_in' or both must always be present with array of some value"),!1):void 0!==a.not_in&&void 0!==a["in"]&&0===a.not_in.length&&0===a["in"].length?(y(19,"Either 'in' or 'not_in' or both must always be present with array of some value"),!1):!0:(y(20,e+": 'condition_type' must be one of "+["range","values","datatype"]),!1):(y(16,"'next' must either be empty or OR or AND"),!1)},$=function(a){var b=["min","max","avg","sum","median","count"];if(0===Object.keys(a).length)return y(21,"'metrics' object cannot be empty"),!1;for(var c in a){if(u(c))return y(22,"Column name is undefined in 'metrics'"),!1;if(u(a[c])||0===a[c].length)return y(23,"Please pass an Array of aggregation functions for column name '"+c),!1;for(var d=a[c].length,e=0;d>e;e++)if(b.indexOf(a[c][e])<=-1)return y(24,"Wrong aggregation function passed for column name '"+c),!1}return!0};this.flushToGet=function(){if("local"===g){var a=A;return A="",a}y(25,"Cannot call flushToGet to on a Global PykQuery")},this.call=function(){var a=this;if("local"===g)cb(db(a));else{for(var b=K.length,c=0;b>c;c++){var d=window[K[c]];d.filter_data=d.call()}P&&this.appendClassSelected()}return!0};var ab=function(){for(var a,b,c,d,f=_.flatten(window[e].filters),g=(f.length,L.length),h=0;g>h;h++){a=window[L[h]].filters,b=a.length;for(var i=0;b>i;i++){c=a[i],d=c.length;for(var j=0;d>j;j++)c[j]&&c[j].local_div_id_triggering_event!==e&&f.push(c[j])}}return f},bb=function(){var a=o.length,b=[],c=[],d=[];if(Object.keys(PykQuery.query_json).length>0&&(d=[]),o&&o.length>0){d=[];for(var e=0;a>e;e++)o[e].hasOwnProperty("group")?b.push(o[e]):c.push(o[e]);var f=_.groupBy(c,function(a){return a.hasOwnProperty("group")?void 0:a.column_name+"-"+a.condition_type});for(var g in f){var h=f[g],i=h.length,j={column_name:h[0].column_name,condition_type:h[0].condition_type,local_div_id_triggering_event:h[0].local_div_id_triggering_event,next:h[0].next};if(h[0].hasOwnProperty("group")&&(j.group=h[0].group),"values"===h[0].condition_type||"datatype"===h[0].condition_type){for(var k=[],l=[],m=0;i>m;m++)k=h[m].in?v(k,h[m].in):k,l=h[m].not_in?v(l,h[m].not_in):l;j.in=k,j.not_in=l}else if("range"===h[0].condition_type){j.condition=[];for(var m=0;i>m;m++)j.condition.push({min:h[m].condition.min,max:h[m].condition.max,not:h[m].condition.not})}d.push(j)}}return b.concat(d)},cb=function(a){if(o=ab(),l=bb(),"inbrowser"===h){var b=new PykQuery.adapter.inbrowser.init(a,l);return A=b.call(),"local"===g&&m.executeOnFilter(),A}var b=new PykQuery.adapter.rumi.init(a,n,l);return b.call(function(a){return A=a,"local"===g&&m.executeOnFilter(),A})},db=function(a){for(var b={},c=Object.getOwnPropertyNames(a),d=c.length,e=0;d>e;e++)a.propertyIsEnumerable(c[e])===!1&&(b[c[e]]=a[c[e]]);return b};this.appendClassSelected=function(){if("global"===this.scope){if(E){for(var a=document.querySelectorAll(".pykquery-selected"),b=a.length,c=E.length,d=0;b>d;d++)a[d].classList.remove("pykquery-selected");for(var d=0;c>d;d++)for(var e=E[d],f=e.length,g=0;f>g;g++)if(e[g].selected_dom_id){var h=document.querySelectorAll("[data-id='"+e[g].selected_dom_id+"']");h.length>0&&!h[0].classList.contains("pykquery-selected")&&h[0].classList.add("pykquery-selected")}}}else y(26,"Cannot call appendClassSelected() on local")},this.toSql=function(){that=this;var a,b,c=that.filters,d=that.mode,e=that.unique,f=that.metrics,g=that.select,h=that.sort,i=that.dimensions,j=that.limit,k=that.offset,l=that.div_id,m="__",n=that.columns,o=[],p=[],q=[],r="",s="FROM "+m+" ",t=[],u="",v="",w="",x="",y=!1;if(i&&"aggregation"===d){if(f&&!_.isEmpty(f))for(var z in f)for(var A=f[z].length,B=0;A>B;B++)o.push(f[z][B]+"("+z+")");if(!_.isEmpty(i))for(var C=i.length,z=0;C>z;z++)_.has(f,i[z])===!1&&(o.push(i[z]),p.push(i[z]))}if(g&&"select"===d){if(0===_.intersection(n,g).length&&g.toString()!==["*"].toString())return!1;_.each(g,function(a){o.push(a)})}if(e&&"unique"===d){if(0===_.intersection(n,e).length)return!1;_.each(e,function(a){o.push(a)})}if(r=_.isEmpty(o)&&_.isEmpty(i)&&"unique"!=d?"SELECT * ":"unique"===d?"SELECT DISTINCT "+o.join(", ")+" ":"SELECT "+o.join(", ")+" ",c&&!_.isEmpty(c)&&(a=!1,_.each(c,function(d,e){switch(t[e]="",d.condition_type){case"values":b=[],d["in"]&&0!==d["in"].length&&(y=!0,t[e]+=d.column_name+" IN (",_.each(d["in"],function(a){t[e]+=a+", "}),t[e]=t[e].slice(0,-2)+") "),d.not_in&&0!==d.not_in.length&&(t[e]+=y?"AND "+d.column_name+" NOT IN (":d.column_name+" NOT IN (",_.each(d.not_in,function(a){t[e]+=a+", "}),t[e]=t[e].slice(0,-2)+") "),d.next&&e!=c.length-1?(t[e]=t[e]+d.next,a=d.next):a=!1;break;case"range":_.isEmpty(d.condition)||(t[e]+=d.column_name+" ",d.condition.not&&(t[e]+="NOT "),t[e]+="BETWEEN "+d.condition.min+" AND "+d.condition.max+" ",d.next&&e!==c.length-1?(t[e]=t[e]+d.next,a=d.next):a=!1);break;case"data_types":}})),i&&"aggregation"===d&&(u="GROUP BY "+p.join(", ")+" "),h&&!_.isEmpty(h)){v="ORDER BY ";for(key in h)v+=key+" "+h[key]+", ";v=v.slice(0,-2)+" "}w=j?"LIMIT "+j+" ":w,x=k?"OFFSET "+k+" ":x,q=l+": \n "+r+" \n "+s+" \n WHERE";for(var D=t.length,z=0;D>z;z++)q=q+" \n	 "+t[z];return q=q+" \n "+u+" \n "+v+" \n "+w+" \n "+x,console.log(q),q},this.listFilters=function(a){var b=document.getElementById(a);b.innerHTML="",b.innerHTML="<div class='filter_list'></div>",eb()};var eb=function(){var a=document.getElementsByClassName("filter_list")[0],b=E.length,c="";a.innerHTML="";for(var d=0;b>d;d++){for(var e=E[d],f=e.length,g="",h=0;f>h;h++){var i=e[h];if(c=h!==f-1?i.next:"",i.in)g+="<b>"+e[h].column_name+" IN</b> ("+i.in+") <i>"+c+" </i>";else if(i.not_in)g+="<b>"+e[h].column_name+" NOT IN</b> ("+i.not_in+")";else if(i.condition){var j="";i.condition.not&&(j="NOT"),g+="<b>"+e[h].column_name+" "+j+" BETWEEN</b> "+i.condition.min.toFixed(2)+" <b>AND</b> "+i.condition.max.toFixed(2)}}var k=document.createElement("div");k.setAttribute("class","filter_block"),k.setAttribute("style","padding: 0px 10px;"),k.setAttribute("id","filter_block"+d),a.appendChild(k);var l=document.createElement("div");l.setAttribute("class","filter_value"),l.innerHTML=g,document.getElementById("filter_block"+d).appendChild(l);var m=document.createElement("div");m.setAttribute("class","filter_remove"),m.setAttribute("id","filter_remove_"+d),m.innerHTML="<b class='glyphicon glyphicon-trash' style='font-size: 11px;cursor:pointer'></b>",document.getElementById("filter_block"+d).appendChild(m)}for(var n=document.getElementsByClassName("filter_remove"),o=n.length,d=0;o>d;d++)n[d].onclick=function(){var a=this.id.split("_");fb(E[a[2]])}},fb=function(a){var b=a[0].local_div_id_triggering_event;window[b].removeFilter([a],!0,!0)}},PykQuery.adapter=PykQuery.adapter||{},PykQuery.adapter.rumi={},PykQuery.adapter.rumi.init=function(a,b,c){this.call=function(d){if(!b)return!1;a.filters=c;var e={config:a,token:gon.token};$.ajax({url:rumi_api_endpoint+b+"filter/show",data:e,dataType:"json",type:"POST",async:!0,success:function(a){d(a)},error:function(){console.log("Save error.")}})}},_.mixin({sum:function(a,b,c){if(!b&&_.isEmpty(a))return 0;var d=0;if(!b&&_.isArray(a)){for(var e=a.length-1;e>-1;e-=1)d+=a[e];return d}return _.each(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;d+=g}),d},mean:function(a,b,c){return!b&&_.isEmpty(a)?1/0:!b&&_.isArray(a)?_.sum(a)/a.length:_.isArray(a)&&!_.isEmpty(a)?_.sum(a,b,c)/a.length:void 0},median:function(a,b,c){if(_.isEmpty(a))return 1/0;var d=[];return!b&&_.isArray(a)?(d=_.clone(a),d.sort(function(a,b){return a-b})):_.isArray(a)&&each(a,function(a,e,f){d.push(b?b.call(c,a,e,f):a),d.sort()}),d.length%2?d[Math.floor(d.length/2)]:_.isNumber(d[d.length/2-1])&&_.isNumber(d[d.length/2])?(d[d.length/2-1]+d[d.length/2])/2:d[d.length/2-1]},nrange:function(a,b,c){if(arguments.length<=1){if(0===a)return[];b=a||0,a=0}c=arguments[2]||1*(b>a)||-1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);do f[e]=a,a+=c;while((e+=1)<d);return f}}),PykQuery.adapter=PykQuery.adapter||{},PykQuery.adapter.inbrowser={},PykQuery.adapter.inbrowser.init=function(a,b){var c,d=a,e=a.global_divid_for_raw_data,e=window[e];c=e.rawdata,d.filters=b,this.call=function(){var b,c=a.mode;switch(d.filters&&d.filters.length>0&&i(d),c){case"aggregation":b=h(d);break;case"unique":break;case"datatype":}return d.sort&&d.sort>0&&(b=f(b)),b};var f=function(a){var b=d.sort,c=b.length;return a.sort(function(a,d){for(var e=0;c>e;e++){var f=Object.keys(b[e])[0],h=l(f);if(a[h]!==d[h])return g(a,d,h,b[e][f])}})},g=function(a,b,c,d){return"asc"===d?a[c]<b[c]?-1:a[c]>b[c]?1:0:a[c]>b[c]?-1:a[c]<b[c]?1:0},h=function(b){var d=b.metrics,e=b.dimensions,f=e.length;local_data=_.groupBy(c,function(a){for(var b="",c=0;f>c;c++){var d=e[c];0===c?b=a[d]:b+="<>"+a[d]}return b});var g=[];return _.map(local_data,function(b,c){for(var e={},f=c.split("<>"),h=f.length,i=0;h>i;i++)e[l(a.dimensions[i])]=f[i];for(var j=Object.keys(d),k=j.length,m=0;k>m;m++)for(var n=d[j[m]],o=n.length,i=0;o>i;i++)switch(n[i]){case"count":e[l(j[m],n[i])]=b.length;break;case"sum":e[l(j[m],n[i])]=_.sum(b,function(a){return parseInt(a[j[m]],10)})}g.push(e)}),g},i=function(a){var b,d=a.mode,e=a.filters,f=e.length;b="select"===d?a.select:[];for(var g=0;f>g;g++)switch(e[g].condition_type){case"values":j(e[g],b,d);break;case"range":k(e[g],b);break;case"datatype":}return c},j=function(a,b,d){var e=a["in"],f=a.not_in,g=a.column_name,h=c,i=h.length;c=[];for(var j=0;i>j;j++){var k=h[j][g];e&&e.indexOf(k)>-1?c.push(h[j]):f&&f.length>0&&-1===f.indexOf(k)&&c.push(h[j])}0!=b.length&&"select"===d&&(c=_.map(c,function(a){return _.pick(a,b)}))},k=function(a,b,d){var e,f,g,h=a.column_name,i=a.condition.length;c=_.filter(c,function(b){for(var c=0;i>c;c++){if(e=a.condition[c].min,f=a.condition[c].max,g=a.condition[c].not,g&&(b[h]>f||b[h]<e))return b;if(!g&&b[h]<=f&&b[h]>=e)return b}}),0!=b.length&&"select"===d&&(c=_.map(c,function(a){return _.pick(a,b)}))},l=function(a,b){var c=d.alias;return"string"==typeof c[a]?c[a]:"object"==typeof c[a]?b?c[a][b]:c[a][a]:a}};
var Rumali = {};
function generate_notify(config) {

  if (!config.text) {
    config.text = "Opps something went wrong.";
  }
  if (!config.notify) {
    config.notify = "success";
  }

  if (!config.position) {
    config.position = "bottomRight";
    //top - topLeft - topCenter - topRight - center - centerLeft - centerRight - bottom - bottomLeft - bottomCenter - bottomRight
  }
  if(!config.timeout){
    config.timeout = false;
  }
  
  $.noty.closeAll();
  var n = noty({
      text        : config.text,
      type        : config.notify,
      dismissQueue: false,
      layout      : config.position,
      theme       : 'defaultTheme',
      timeout     : config.timeout,
      animation: {
        open: {height: 'toggle'},
        close: {height: 'toggle'},
        easing: 'swing',
        speed: 1000
    },
  });
  return n;
}

function showAllValidationErrors(errors) {
  for (i in errors) {
    error = errors[i];
    noty({
      text        : error,
      type        : "error",
      dismissQueue: false,
      layout      : "bottomRight",
      theme       : 'defaultTheme'
    });
  }
}
;
$(document).ready(function() {
  $(".s3-publish-details").click(function(event) {
    var link = "<a href='"+$(this).attr("s3-url")+"' target='_blank'>"+$(this).attr("s3-url")+"</a>"
    $("#s3-published-url").html(link);
    $("#s3-published-last-updated").html($(this).attr("s3-published-at"));
    $("#s3-published-requested-at").html($(this).attr("s3-requested-at"));
    event.preventDefault();
  });
});
Object.size = function(obj) {
    var size = 0, key;
    for (key in obj) {
        if (obj.hasOwnProperty(key)) size++;
    }
    return size;
};

Rumali.object = {
  //url first half
  datacast_url : rumi_api_endpoint + 'datacast/'
}

Rumali.data_objects = {}

//finding distinct values of the attributes from the array that is being passed.
var findDistinct = function(data,attribute_name){
	var value = [];
	value = _.map(data, function(obj){ return obj[attribute_name] });
	value = _.uniq(value);
	return value;
}
//rendering filter common function
var renderFilter = function(data,metric,id){
	var values,html_string,i,length;
	values = findDistinct(data,metric);
	length = values.length;

	if(length >= 5){
		html_string = smallDropDown(id,values,length);
	}
	else{
		html_string = largeDropDown(id,values,length);	
	}
	return html_string;
} 
//Render dropdown less than or equal to 5
var smallDropDown = function(id,values,length){
	var html_string = '<select id='+id+' class="form-control" style="width:12.5%!important">';
		for(i=0;i<length;i++){
			html_string += '<option value="'+values[i]+'">'+values[i];
		}
		html_string += '</select>';
		return html_string;
}

//Render dropdown greater than 5
var largeDropDown = function(id,values,length){
	var html_string = '<select id='+id+' class="form-control" style="width:12.5%!important">';
		for(i=0;i<length;i++){
			html_string += '<option value="'+values[i]+'">'+values[i];
		}
		html_string += '</select>';
		return html_string;
}	

//Set up the data json once so that we don't need to call service again.It is saved in return_data object
var getJSON = function(url,callbackfn){
	var args = arguments;
  if (Rumali.data_objects[url]) {
		if (args[2] && args[3] && args[4] && args[5]) {
			callbackfn(Rumali.data_objects[url],args[2],args[3],args[4],args[5]);
		} else {
			callbackfn(Rumali.data_objects[url]);
		}
  }else {
	  $.getJSON(url) //jquery function to parse url and get data in done method.
	    .done(function(data){
				Rumali.data_objects[url] = data
				if (args[2] && args[3] && args[4] && args[5]) {
					callbackfn(data,args[2],args[3],args[4],args[5]);
				} else {
					callbackfn(data);
				}
	    });
  }
}
//find all the keys in an array.
var findKeyArray = function(obj){
	var key_array = Object.keys(obj);
	return key_array;
}


var renderHTMLForCard = function(data,id,col_sm){

	//id,title,key,value,content
	var id = id,
		title = data[0].title ? data[0].title : '',
		key = data[0].key ? data[0].key : '<br/>',
		value = data[0].value ? data[0].value : '',
		content = data[0].content ? data[0].content : '';
		diff_in_value = data[0].diff_in_value ? data[0].diff_in_value : '' ,
		diff_string = '';

	if(typeof +value === "number"){
		value = +value;
		value = applyConditionalFormatting(value);
	}
	if(typeof +diff_in_value === 'number'){
		if(+diff_in_value > 0){
			diff_string = '(<span class="'+applyConditionalCssPositiveOrNegative(1)+'">'+diff_in_value;
			diff_string +=  '&#9652;</span>)';
		}
		if(+diff_in_value < 0){
			diff_string = '(<span class="'+applyConditionalCssPositiveOrNegative(2)+'">'+((+diff_in_value)*-1);
			diff_string +=  '&#9660;</span>)';
		}
		if(+diff_in_value === 0){
			diff_string = '(<span class="'+applyConditionalCssPositiveOrNegative(3)+'">'+diff_in_value;
			diff_string += '-</span>)';
		}
	}


	var div = $('<div />').appendTo('body');
	div.attr('id', id);
	var htmlcontent = '<span class = "'+col_sm+' card_layout">';
	htmlcontent += '<span class= "col-sm-12 card_layout_header_span"><h4 class="card_layout_header"><b>'+title+'</b></h4></span>';
	htmlcontent += '<span class= "col-sm-12 card_layout_key">'+key+'</b></span>';
	htmlcontent += '<span class= "col-sm-12 card_layout_value">'+value+'</b>';
	if(diff_in_value !== ''){
		htmlcontent +=  diff_string;
	}
	htmlcontent += '<span class= "col-sm-12 card_layout_content">'+content;
	htmlcontent += '</span>';

	$('#'+id).html(htmlcontent);
}

var applyConditionalFormatting = function(value){
	var result = value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	return result;
}
var applyConditionalCssPositiveOrNegative = function(value){
	if(value === 1){
		return 'positive_value_css';
	}
	else if(value === 2){
		return 'negative_value_css';
	}
	else if(value === 3){
		return 'no_class';
	}
	else{
		return 'no_class';
	}
		//Convert it to switch case
}
var filterChart = function(data,column_name,column_value){
	var index,filtered_data = [],count=-1;
	for(index = 0;index < data.length;index++){
			if(column_value === data[index][column_name]){
				filtered_data[++count] = {};
				for(var k in data[index]){
					if(k !== column_name){
						filtered_data[count][k]=data[index][k];
						//Copying all the items from original array to new array.
						//value to be pushed in the new array
				}
			} 	//Filter data is the data that is to be displayed on the ui.
		}
	}
	return filtered_data;
}

var getApiFromString = function(api){
  api = api.split(".");
  return PykCharts[api[1]][api[2]];
}

var genereteChartInMarkdown =  function () {
	$(".d3-pykcharts").each(function (){
    callGetJson(this);
  });
  $(".card_with_value").each(function (){
    callGetJson(this);
  });
}

var callGetJson = function(that) {
	var chart_id = that.id,
		datacast_url = Rumali.object.datacast_url + that.dataset.datacast_identifier,
    chart_api = that.dataset.api,
    filter_present = that.dataset.filter_present,
    filter_column_name = that.dataset.filter_column_name || "";
  getJSON(datacast_url,generateChart,chart_id ,chart_api, filter_present, filter_column_name);
}

var generateChart = function (data,chart_id,chart_api,filter_present, filter_column_name) {
	var parent_chart = document.getElementById(chart_id),
		filter_div,
		chart_div;
	if(filter_present == "true") {
		filter_div = document.createElement('div');
		filter_div.id = chart_id + "_"+"chart_filters"
		parent_chart.appendChild(filter_div);
	}
	chart_div = document.createElement('div');
	chart_div.id = chart_id + "_"+"charts"
	parent_chart.appendChild(chart_div);

	if(filter_present === 'true'){

		unique_filter_html = renderFilter(data,filter_column_name,filter_div.id);
		$('#'+filter_div.id).html(unique_filter_html);

		$('#'+filter_div.id).change(function(){
			filter_val = $('#'+filter_div.id+' option:selected').val();
			parsed_data = filterChart(data,filter_column_name,filter_val);
			createChart(parsed_data, chart_div.id, chart_id,chart_api);
		});

		$("select#"+filter_div.id).prop('selectedIndex', 0);
    filter_val = $('#'+filter_div.id+' option:selected').val();
		parsed_data = filterChart(data,filter_column_name,filter_val);
		createChart(parsed_data, chart_div.id, chart_id,chart_api);
	}else{
		parsed_data = data;
		createChart(parsed_data, chart_div.id, chart_id,chart_api);
	}
}

var createChart = function (data,chart_id,chart_key,api) {
	var config = gon.chart_config_objects[chart_key] || {}
	config.data = data
	if (api == "handsontable")
		$("#"+chart_id).handsontable(config)
	else if (api == "one-number-indicator") {
		renderHTMLForCard(data, chart_id,"col-sm-12");
	} else {
		initializer_api = getApiFromString(api);
		config.selector = "#"+chart_id
		config.background_color = ""
		var k = new initializer_api(config)
		k.execute();
	}
};
/*! ====================================================== *
Copyright (c) 2015, Pykih Software LLP
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* ====================================================== */


var PykCharts = {};
PykCharts.assets = "/pykih-charts/assets/";
PykCharts.export_menu_status = 0;

PykCharts['boolean'] = function(d) {
    var false_values = ['0','f',"false",'n','no','',0,"0.00","0.0",0.0,0.00];
    var false_keywords = [undefined,null,NaN];
    if(false_keywords.indexOf(d) !== -1) {
        return false;
    }
    value = d.toLocaleString();
    value = value.toLowerCase();
    return (false_values.indexOf(value) > -1)? false : true;
};

PykCharts.getEvent = function () {
  try {
    return d3.event || event;
  } catch (e) {
    return event;
  }
}

PykCharts.Configuration = function (options){
    var that = this,
        options_selector = options.selector;

    var configuration = {
        liveData: function (chart) {
            var frequency = options.real_time_charts_refresh_frequency,
                interval;
            if(PykCharts['boolean'](frequency)) {
                clearInterval(options.interval);
                options.interval = setInterval(chart.refresh,frequency*1000);
            }
            return this;
        },
        emptyDiv: function (id) {
            d3.select(id).append("div")
                .style("clear","both");

            return this;
        },
        storeInitialDivHeight : function () {
            var height = parseFloat(d3.select(options.selector).style("height"));
            if(height) {
                options.original_div_height = parseFloat(d3.select(options.selector).style("height"));
            } else {
                options.original_div_height = "auto";
            }
            return this;
        },
        appendUnits: function (text) {
            text = PykCharts.numberFormat(text);
            var label,prefix,suffix;
                prefix = options.units_prefix,
                suffix = options.units_suffix;
                if(prefix) {
                    label = prefix + " " + text;
                    if(suffix) {
                        label += " " + suffix;
                    }
                } else if(suffix) {
                    label = text + " " + suffix;
                } else {
                    label = text;
                }
            return label;
        },
        title: function (width) {
            if(PykCharts['boolean'](options.title_text) && options.title_size) {
            var chart_width = options.chart_width;
            if(width) {
                chart_width = width;
            }
            var div_width = PykCharts['boolean'](options.export_enable) ? 0.9*chart_width : chart_width;
                that.titleDiv = d3.select(options.selector)
                    .append("div")
                        .attr("id","title")
                        .style({
                            "width": (div_width) + "px",
                            "text-align":"left",
                            "float":"left"
                        })
                        .html("<span style='pointer-events:none;font-size:" +
                        options.title_size+
                        "vw;color:" +
                        options.title_color+
                        ";font-weight:" +
                        options.title_weight+
                        ";padding-left:1px;font-family:" +
                        options.title_family
                        + "'>" +
                        options.title_text +
                        "</span>");
            }
            return this;
        },
        subtitle: function (width) {
            if(PykCharts['boolean'](options.subtitle_text) && options.subtitle_size) {
                var chart_width = options.chart_width;
                if(width) {
                    chart_width = width;
                }
                that.subtitleDiv = d3.select(options.selector)
                    .append("div")
                        .attr("id","sub-title")
                        .style({
                            "width": chart_width + "px",
                            "text-align": "left"
                        })
                        .html("<span style='pointer-events:none;font-size:" +
                        options.subtitle_size+"vw;color:" +
                        options.subtitle_color +
                        ";font-weight:" +
                        options.subtitle_weight+";padding-left:1px;font-family:" +
                        options.subtitle_family + "'>"+
                        options.subtitle_text + "</span>");
            }
            return this;
        },
        createFooter: function (width) {
            var chart_width = options.chart_width;
            if(width) {
                chart_width = width;
            }
            d3.select(options.selector).append("table")
                .attr({
                    "id" : "footer",
                    "width": chart_width + "px"
                })
                .style("background", options.bg);
            return this;
        },
        lastUpdatedAt: function (a) {
            if(PykCharts['boolean'](options.real_time_charts_refresh_frequency) && PykCharts['boolean'](options.real_time_charts_last_updated_at_enable)) {
                var currentdate = new Date();
                var date = currentdate.getDate() + "/"+(currentdate.getMonth()+1)
                        + "/" + currentdate.getFullYear() + " "
                        + currentdate.getHours() + ":"
                        + currentdate.getMinutes() + ":" + currentdate.getSeconds();
                if(a === "liveData"){
                    document.querySelectorAll(options.selector+" #lastUpdatedAt").innerHTML = "<span style='pointer-events:none;'>Last Updated At: </span><span style='pointer-events:none;'>"+ date +"</span>";
                } else {
                    d3.select(options.selector+" #footer")
                        .append("tr")
                        .attr("class","PykCharts-credits")
                        .html("<td colspan=2 style='text-align:right' id='lastUpdatedAt'><span style='pointer-events:none;'>Last Updated At: </span><span style='pointer-events:none;'>"+ date +"</span></tr>")
                }
            }
            return this;
        },
        checkChangeInData: function (data, compare_data) { // this function checks if the data in json has been changed
            var key1 = Object.keys(compare_data[0]),
                key2 = Object.keys(data[0]),
                changed = false,
                data_length = data.length,
                key1_length = key1.length;

            if(key1.length === key2.length && compare_data.length === data.length) {
                for(var i=0;i<data_length;i++) {
                    for(var j=0;j<key1_length;j++){
                        if(typeof data[i][key2[j]] !== "object" && typeof compare_data[i][key1[j]] !== "object") {
                            if(data[i][key2[j]] !== compare_data[i][key1[j]] || key1[j] !== key2[j]) {
                                changed = true;
                                break;
                            }
                        } else {
                            if(!(options.k.__proto__._isEqual(data[i][key2[j]],compare_data[i][key1[j]])) || key1[j] !== key2[j]) {
                                changed = true;
                                break;
                            }
                        }
                    }
                }
            } else {
                changed = true;
            }
            that.compare_data = data;
            return [that.compare_data, changed];
        },
        credits: function () {
            if(PykCharts['boolean'](options.credit_my_site_name) || PykCharts['boolean'](options.credit_my_site_url)) {
                var enable = true;

                if(options.credit_my_site_name === "") {
                    options.credit_my_site_name = options.credit_my_site_url;
                }
                if(options.credit_my_site_url === "") {
                    enable = false;
                }

                d3.select(options.selector+" #footer").append("tr")
                    .attr({
                        "class" : "PykCharts-credits",
                        "id" : "credit-datasource"
                    })
                    .append("td")
                    .style("text-align","left")
                    .html("<span style='pointer-events:none;'>Credits: </span><a href='" +  options.credit_my_site_url + "' target='_blank' onclick='return " + enable +"'>"+  options.credit_my_site_name +"</a>");

            }
            return this;
        },
        dataSource: function () {
            if( (PykCharts['boolean'](options.data_source_name) || PykCharts['boolean'](options.data_source_url))) {
                var enable = true;
                if(options.data_source_name === "") {
                    options.data_source_name =options.data_source_url;
                }
                if(options.data_source_url === "") {
                    enable = false;
                }
                var data_source_content = "<span style='pointer-events:none;'>Source: </span><a href='" + options.data_source_url + "' target='_blank' onclick='return " + enable +"'>"+ options.data_source_name +"</a></tr>";

                if(d3.selectAll(options.selector+" #footer").length) {
                    d3.select(options.selector+" table #credit-datasource")
                        .style({
                            "background" : options.bg,
                            "text-align" : "right"
                        })
                        .append("td")
                        .html(data_source_content);
                }
                else {
                    d3.select(options.selector).append("table")
                        .attr({
                            "id" : "footer",
                            "class" : "PykCharts-credits",
                            "width" : options.chart_width + "px"
                        })
                        .style({
                            "background" : options.bg,
                            "text-align" : "right"
                        })
                        .append("tr")
                        .append("td")
                        .html(data_source_content);
                }
            }
            return this;
        },
        makeMainDiv: function (selection,i) {
            var d = d3.select(selection).append("div")
                .attr({
                    "id" : "chart-container-"+i,
                    "class" : "main-div"
                })
                .style("width", "100%");
                // .style("width",options.chart_width + "px");

            if(PykCharts['boolean'](options.panels_enable)){
                d.style({
                    "float": "left",
                    "width": "auto"
                });
            }
            return this;
        },
        tooltip: function (d,selection,i,flag) {
            if((PykCharts['boolean'](options.tooltip_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string" || PykCharts['boolean'](options.annotation_enable)) && options.mode === "default") {
                var id;
                if(selection !== undefined){
                    var selector = options.selector.substr(1,options.selector.length);
                        id = "tooltip-svg-container-" + i + "-pyk-tooltip"+selector;
                } else {
                    id = "pyk-tooltip";
                }
                PykCharts.Configuration.tooltipp = d3.select("body")
                        .append("div")
                        .attr({
                            "id" : id,
                            "class" : "pyk-tooltip"
                        });

            } else if (PykCharts['boolean'](options.tooltip_enable)) {
                    PykCharts.Configuration.tooltipp = d3.select("body")
                        .append("div")
                        .attr({
                            "id" : "pyk-tooltip",
                            "class" : "pyk-tooltip"
                        });
            }
            return this;
        },
        dateConversion: function (d) {
            d = new Date(d);
            var time_zone = d.getTimezoneOffset();
            d = new Date(d.getTime() + (time_zone * 60 * 1000));
            return d;
        },
        loading: function () {
            d3.select(options.selector).style("height",options.chart_height);
            var loading_content = options.loading_type === "image" ? "<img src=" + options.loading_source + ">" : options.loading_source;
            d3.select(options.selector).html("<div id='chart-loader'>" + loading_content + "</div>");
            var initial_height_div = parseFloat(d3.select(options.selector).style("height"));
            d3.select(options.selector + " #chart-loader").style({"visibility":"visible","padding-left":(options.chart_width/2) +"px","padding-top":(initial_height_div/2) + "px"});
            return this;
        },
        remove_loading_bar: function (id) {
            var loading = document.querySelector(options.selector+" #chart-loader"),height;
            if(loading) {
                loading.parentNode.removeChild(loading);
            }
            document.getElementById(id).style.height = options.original_div_height;
            return this;
        },
        dataFromPykQuery : function (data) {
            if (PykCharts.boolean(options.interactive_enable)) {
                options.data = data;
            }
        },
        totalColors: function (tc) {
            var n = parseInt(tc, 10)
            if (n > 2 && n < 10) {
                that.total_colors = n;
                return this;
            };
            that.total_colors = 9;
            return this;
        },
        colorType: function (ct) {
            if (ct === "color") {
                that.legends = "no";
            };
            return this;
        },
        resize: function (svg,width) {
            var chart_width = options.chart_width;
            if(PykCharts["boolean"](options.panels_enable) && width) {
                chart_width = width;
            }

            console.log(d3.select(options.selector).style("width"), document.querySelector(options.selector).clientWidth);
            var aspect = (chart_width/options.chart_height),
                targetWidth = !isNaN(parseFloat(d3.select(options.selector).style("width"))) ? parseFloat(d3.select(options.selector).style("width")) : 0,
                a = d3.selectAll(options.selector + " #footer"),
                b = d3.selectAll(options.selector + " .main-div"),
                title_div_width;

            if(targetWidth > chart_width || targetWidth === 0) {
                targetWidth = chart_width;
            }

            if (options.constructor === PykCharts.multiD.multiSeriesLine) {
                targetWidth = window.innerWidth - (0.15 * window.innerWidth);
                if (targetWidth > chart_width) {
                    targetWidth = chart_width
                }
            }

            if(PykCharts['boolean'](svg)) {
                svg.attr({
                    "width" : targetWidth,
                    "height" : (targetWidth / aspect)
                });
                d3.selectAll(options.selector + ' .main-div')
                    .style("width", "100%");
                    // .style("width", targetWidth+"px");
            }
            if(PykCharts['boolean'](options.title_text)) {
                if(PykCharts['boolean'](options.export_enable)) {
                    title_div_width = 0.9*targetWidth;
                    d3.select(options.selector + " #title").style("width",title_div_width + "px");
                }
            }
            if(PykCharts['boolean'](options.subtitle_text)) {
                title_div_width = 0.9*targetWidth;
                d3.select(options.selector + " #sub-title").style("width", title_div_width + "px");
            }
            if(PykCharts['boolean'](options.export_enable)) {
                div_size = targetWidth
                div_float ="none"
                div_left = targetWidth-16;
                if(PykCharts['boolean'](options.title_text) && options.title_size && options.mode === "default") {
                    div_size = 0.1*targetWidth;
                    div_float ="left";
                    div_left = 0;
                }

                d3.select(options.selector + " #export").style({
                    "width": div_size + "px",
                    "left":div_left + "px",
                     "float":div_float
                });

                d3.select(options.selector + " .dropdown-multipleConatiner-export")
                        .style("left",(targetWidth - 80)+"px");
            }

            if(a) {
                a.attr("width",targetWidth);
            }

            if(b && !(PykCharts['boolean'](options.panels_enable))) {
                var select = document.querySelector(options.selector + " .main-div");
                if(select) {
                    select.style.width = targetWidth;
                }
            }
        },
        __proto__: {
            _downloadDataURI : function(t) {
                function isPlainObject(t) {
                   return "object" != typeof t || t.nodeType || null != t && t === t.window ? !1 : t.constructor && !t.constructor.prototype.hasOwnProperty("isPrototypeOf") ? !1 : !0
                }
                if (t) {
                    isPlainObject(t) || (t = {
                        data: t
                    }), t.filename || (t.filename = "download." + t.data.split(",")[0].split(";")[0].substring(5).split("/")[1]), t.url || (t.url = "http://download-data-uri.appspot.com/");
                    var e = (d3.select("body").append("form").attr("id", "export-form").attr("method", "post").attr("action", t.url).style("display", "none").html("<input type='hidden' name='filename' value='" + t.filename + "'/><input type='hidden' name='data' value='" + t.data + "'/>"), document.getElementById("export-form"));
                    e.submit(), e.parentNode.removeChild(e)
                }
            },
            _xmlToJson : function(xml,flag) {
                var obj = [],
                    element_node,
                    data_point,
                    key_of_data_point,
                    value_of_data_point,
                    element_object,
                    root_len = xml.firstChild.childElementCount,
                    i , j, increment_counter, condition_checking;

                if (flag == 0) {
                    i = flag;
                    condition_checking = root_len;
                    increment_counter = 1;
                }
                else if (flag == 1) {
                    i = flag;
                    condition_checking = ((root_len*2)+1);
                    increment_counter = 2;
                }

                for (; i<condition_checking ; i+=increment_counter) {
                    element_node = xml.firstChild.childNodes[i];
                    element_object = {};

                    for(j=0, element_len=element_node.childElementCount ; j<element_len ; j++) {
                        data_point = element_node.children.item(j);
                        key_of_data_point = data_point.nodeName;
                        value_of_data_point = data_point.textContent;
                        element_object[key_of_data_point] = value_of_data_point;
                    }
                    obj.push(element_object);
                }

                return obj;
            },
            _domainBandwidth: function (domain_array, count, type) {
                addFactor = 0;
                if(type === "time") {
                    var a = domain_array[0],
                        b = domain_array[1], new_array = [];
                    padding = (b - a) * 0.1;
                    switch( count ) {
                        case 0: new_array[0] = a - (padding + addFactor);
                        break;
                        case 1:  new_array[1] = b + (padding + addFactor);
                        break;
                        case 2:
                            new_array[0] = a - (padding + addFactor);
                            new_array[1] = b + (padding + addFactor);
                            break;
                    }
                    return [options.k.dateConversion(new_array[0]),options.k.dateConversion(new_array[1])];
                }else {
                    padding = (domain_array[1] - domain_array[0]) * 0.1;
                    switch( count ) {
                        case 0: domain_array[0] -= (padding + addFactor);
                        break;
                        case 1: domain_array[1] = parseFloat(domain_array[1],10) + (padding + addFactor);
                        break;
                        case 2:
                            domain_array[0] -= (padding + addFactor);
                            domain_array[1] = parseFloat(domain_array[1],10) + (padding + addFactor);
                            break;
                    }
                    return domain_array;
                }
            },
            _radiusCalculation: function (radius_percent,type) {
                var min_value;
                if(type === "percentageBar") {
                    min_value = options.chart_height;
                } else if(type === "spiderweb") {
                    min_value = d3.min([(options.chart_width - options.legendsGroup_width),(options.chart_height-options.legendsGroup_height-20)])
                } else if(type !== undefined) {
                    min_value = options.chart_width;
                } else {
                    min_value = d3.min([options.chart_width,options.chart_height]);
                }
                return (min_value*radius_percent)/200;
            },
            _getHighestParentsAttribute: function(id,styleAttribute) {
                var element = document.querySelector(id),value;
                searchFunction(element);
                function searchFunction(element) {
                    if(element.tagName.toLowerCase() === "body") {
                        value = null;
                        return;
                    }
                    value = element.style[styleAttribute];
                    if(!value) {
                        value = d3.select(element).style(styleAttribute);
                    }
                    if(value) {
                        return;
                    } else {
                        searchFunction(element.parentNode)
                    }
                }
                return value;
            },
            _groupBy: function (chart,arr) {
                var gd = []
                , i
                , obj
                , dimensions = {
                    "oned": ["name"],
                    "line": ["x","name"],
                    "area": ["x","name"],
                    "bar": ["y","group"],
                    "column": ["x","group"],
                    "scatterplot": ["x","y","name","group"],
                    "pulse": ["x","y","name","group"],
                    "spiderweb": ["x","group"],
                    "waterfall": ["x","y"],
                    "simple2x2": ["group"]
                  }
                , charts = {
                    "oned": {
                        "dimension": "name",
                        "fact": "weight"
                    },
                    "line": {
                      "dimension": "x",
                      "fact": "y",
                      "name": "name"
                    },
                    "area": {
                      "dimension": "x",
                      "fact": "y",
                      "name": "name"
                    },
                    "bar": {
                      "dimension": "y",
                      "fact": "x",
                      "name": "group"
                    },
                    "column": {
                      "dimension": "x",
                      "fact": "y",
                      "name": "group"
                    },
                    "scatterplot": {
                      "dimension": "x",
                      "fact": "y",
                      "weight": "weight",
                      "name": "name",
                      "group": "group"
                    },
                    "pulse": {
                      "dimension": "y",
                      "fact": "x",
                      "weight": "weight",
                      "name": "name",
                      "group": "group"
                    },
                    "spiderweb": {
                      "dimension": "x",
                      "fact": "y",
                      "name": "name",
                      "weight": "weight"
                    },
                    "waterfall": {
                        "dimension": "y",
                        "fact": "x",
                        "name": "group"
                    },
                    "simple2x2": {
                      "dimension": "group",
                      "fact": "weight"
                    }
                },
                properties = dimensions[chart],
                groups = [];
                var len = arr.length;
                for(var i = 0; i<len; i+=1){
                    var obj = arr[i];
                    if(groups.length == 0){
                        groups.push([obj]);
                    }
                    else{
                        var equalGroup = false,
                            glen = groups.length;
                        for(var a = 0;a<glen;a+=1){
                            var group = groups[a],
                            equal = true,
                            firstElement = group[0];
                            properties.forEach(function(property){
                                if(firstElement[property] !== obj[property]){
                                    equal = false;
                                }
                            });
                            if(equal){
                                equalGroup = group;
                            }
                        }
                        equalGroup ? equalGroup.push(obj) : groups.push([obj]);
                    }
                }

                for(i in groups) {
                    if (groups[i].constructor === Array) {
                        obj = {};
                        var grp = groups[i],
                            chart_name = charts[chart],
                            values_charts_chart = [],
                            obj_with_omitted_properties = {},
                            f = {};
                        obj[chart_name.dimension] = grp[0][chart_name.dimension];
                        if (chart_name.name) {
                            obj[chart_name.name] = grp[0][chart_name.name];
                        }
                        if (chart_name.weight) {
                            obj[chart_name.weight] = d3.sum(grp, function (d) { return d[charts[chart].weight]; });
                            if(chart === "spiderweb") {
                                obj[chart_name.fact] = d3.sum(grp, function (d) { return d[charts[chart].fact]; });
                            } else {
                                obj[chart_name.fact] = grp[0][chart_name.fact];
                            }
                        } else {
                            obj[chart_name.fact] = d3.sum(grp, function (d) { return d[charts[chart].fact]; });
                        }
                        if (chart_name.group) {
                            obj[chart_name.group] = grp[0][chart_name.group];
                        }

                        for (var key in charts[chart]) {
                            values_charts_chart.push(charts[chart][key]);
                        }
                        for (var key in grp[0]) {
                            var flag = 0;
                            for (var i=0 ; i<values_charts_chart.length ; i++) {
                                if (key === values_charts_chart[i]) {
                                    flag = 1;
                                    break;
                                }
                            }
                            if (flag === 0) {
                                obj_with_omitted_properties[key] = grp[0][key];
                            }
                        }
                        for (var key in obj) {
                            f[key] = obj[key];
                        }
                        for (var key in obj_with_omitted_properties) {
                            f[key] = obj_with_omitted_properties[key];
                        }
                        gd.push(f);
                    }
                };
                return gd;
            },
            _sortData: function (data, column_to_be_sorted, group_column_name, options,notApplicable) {
                if(!PykCharts['boolean'](options.data_sort_enable) && !notApplicable) {
                    console.log('if');
                    console.log(data)
                    data.sort(function(a,b) {
                        console.log(data,a,b)
                        if (a[group_column_name] > b[group_column_name]) {
                            console.log('if');
                            return 1;
                        }
                        else if (a[group_column_name] < b[group_column_name]) {
                             console.log('else if');
                            return -1;
                        }
                    });
                } else if (PykCharts['boolean'](options.data_sort_enable)) {
                    console.log('else if');
                    switch (options.data_sort_type) {
                        case "numerically":
                            data.sort(function (a,b) {
                                return ((options.data_sort_order === "descending") ? (b[column_to_be_sorted] - a[column_to_be_sorted]) : (a[column_to_be_sorted] - b[column_to_be_sorted]));
                            });
                            break;
                        case "alphabetically":
                            data.sort(function (a,b) {
                                if (a[column_to_be_sorted] < b[column_to_be_sorted]) {
                                    return (options.data_sort_order === "descending") ? 1 : -1;
                                }
                                else if (a[column_to_be_sorted] > b[column_to_be_sorted]) {
                                    return (options.data_sort_order === "descending") ? -1 : 1;
                                }
                                else if (a[group_column_name] < b[group_column_name]) {
                                    return (options.data_sort_order === "descending") ? 1 : -1;
                                }
                                else if (a[group_column_name] > b[group_column_name]) {
                                    return (options.data_sort_order === "descending") ? -1 : 1;
                                }
                                return 0;
                            });
                            break;
                        case "date":
                            data.sort(function (a,b) {
                                if (new Date(a[column_to_be_sorted]) < new Date(b[column_to_be_sorted])) {
                                    return (options.data_sort_order === "descending") ? 1 : -1;
                                }
                                else if (new Date(a[column_to_be_sorted]) > new Date(b[column_to_be_sorted])) {
                                    return (options.data_sort_order === "descending") ? -1 : 1;
                                }
                                else if (a[group_column_name] < b[group_column_name]) {
                                    return (options.data_sort_order === "descending") ? 1 : -1;
                                }
                                else if (a[group_column_name] > b[group_column_name]) {
                                    return (options.data_sort_order === "descending") ? -1 : 1;
                                }
                                return 0;
                            });
                            break;
                    }
                }
                return data;
            },
            _unique : function (data,parameter) {
                var n = {},r=[];
                    // if(parameter) {
                    //     for(var i = 0,len=data.length; i < len; i++) {

                    //     }
                    // }

                    for(var i = 0,len=data.length; i < len; i++)
                    {
                        if(parameter) {
                            data[i] = data[i][parameter];
                        }

                        if (!n[data[i]])
                        {
                            n[data[i]] = true;
                            r.push(data[i]);
                        }
                    }
                    return r;
            },
            _ready: function (fn) {
                function completed() {
                    document.removeEventListener( "DOMContentLoaded", completed, false );
                    window.removeEventListener( "load", completed, false );
                }

                if ( document.addEventListener ) {
                    document.addEventListener( "DOMContentLoaded", completed, false );
                    window.addEventListener( "load", completed, false );
                    fn;
                } else if ( document.attachEvent ) { // if IE event model is used
                    document.attachEvent("onreadystatechange", function(){
                        if ( document.readyState === "complete" ) {
                            document.detachEvent( "onreadystatechange", arguments.callee );
                            fn;
                        }
                    });
                }
                return this;
            },
            _colourBrightness: function (bg,element){
                var r,g,b,a=1,brightness,
                    colour = bg;

                if (colour.match(/^rgba/)) {
                    colour = colour.match(/rgba\(([^)]+)\)/)[1];
                    colour = colour.split(/ *, */).map(Number);
                    r = colour[0];
                    g = colour[1];
                    b = colour[2];
                    a = colour[3];
                }
                else if (colour.match(/^rgb/)) {
                    colour = colour.match(/rgb\(([^)]+)\)/)[1];
                    colour = colour.split(/ *, */).map(Number);
                    r = colour[0];
                    g = colour[1];
                    b = colour[2];
                } else if ('#' == colour[0] && 7 == colour.length) {
                    r = parseInt(colour.slice(1, 3), 16);
                    g = parseInt(colour.slice(3, 5), 16);
                    b = parseInt(colour.slice(5, 7), 16);
                } else if ('#' == colour[0] && 4 == colour.length) {
                    r = parseInt(colour[1] + colour[1], 16);
                    g = parseInt(colour[2] + colour[2], 16);
                    b = parseInt(colour[3] + colour[3], 16);
                } else {

                }
                brightness = (r * 299 + g * 587 + b * 114) / 1000;
                if (brightness < 125 && a > 0.5) {
                     if(element) {
                        d3.selectAll(element).classed({'light': false, 'dark': true});
                    } else {
                        return "dark";
                    }
                }
                else if (brightness < 125 && a <= 0.5) {
                    if(element) {
                        d3.selectAll(element).classed({'light': true, 'dark': false});
                    } else {
                        return "light";
                    }
                }
                else {
                    if(element) {
                        d3.selectAll(element).classed({'light': true, 'dark': false});
                    } else {
                        return "light";
                    }
                }
            },
            _isNumber: function (n) {
                return (!isNaN(parseFloat(n)) && isFinite(n));
            },
            _where: function (list, key_value_pairs_to_be_searched) {
                var list_length = list.length,
                    data_result = [];
                if(typeof list === "object") {
                    for (var z in list) {
                        var flag = 0,
                            no_of_keys = 0;
                        for (var key in key_value_pairs_to_be_searched) {
                            if (list[z].hasOwnProperty(key) && list[z][key] === key_value_pairs_to_be_searched[key]) {
                                flag += 1;
                            }
                            else {
                                flag = 0;
                            }
                            no_of_keys += 1;
                        }
                        if (flag === no_of_keys) {
                            data_result.push(list[z]);
                        }
                    }
                } else {
                    for (var z=0 ; z<list_length ; z++) {
                        var flag = 0,
                            no_of_keys = 0;
                        for (var key in key_value_pairs_to_be_searched) {
                            if (list[z].hasOwnProperty(key) && list[z][key] === key_value_pairs_to_be_searched[key]) {
                                flag += 1;
                            }
                            else {
                                flag = 0;
                            }
                            no_of_keys += 1;
                        }
                        if (flag === no_of_keys) {
                            data_result.push(list[z]);
                        }
                    }
                }
                return data_result;
            },
            _isEqual : function(a, b) {
                var eq = function(a, b, aStack, bStack) {
                    if (a === b) return a !== 0 || 1 / a === 1 / b;
                    if (a == null || b == null) return a === b;
                    var className = toString.call(a);
                    if (className !== toString.call(b)) return false;
                    switch (className) {
                      case '[object RegExp]':
                      case '[object String]':
                        return '' + a === '' + b;
                      case '[object Number]':
                        if (+a !== +a) return +b !== +b;
                        return +a === 0 ? 1 / +a === 1 / b : +a === +b;
                      case '[object Date]':
                      case '[object Boolean]':
                        return +a === +b;
                    }
                    if (typeof a != 'object' || typeof b != 'object') return false;
                    var length = aStack.length;
                    while (length--) {
                      if (aStack[length] === a) return bStack[length] === b;
                    }
                    var aCtor = a.constructor, bCtor = b.constructor;
                    if (
                      aCtor !== bCtor &&
                      'constructor' in a && 'constructor' in b &&
                      !(isFunction(aCtor) && aCtor instanceof aCtor &&
                        isFunction(bCtor) && bCtor instanceof bCtor)
                    ) {
                      return false;
                    }
                    aStack.push(a);
                    bStack.push(b);
                    var size, result;
                    if (className === '[object Array]') {
                      size = a.length;
                      result = size === b.length;
                      if (result) {
                        while (size--) {
                          if (!(result = eq(a[size], b[size], aStack, bStack))) break;
                        }
                      }
                    } else {
                      var keys = Object.getOwnPropertyNames(a), key;
                      size = keys.length;
                      result = Object.getOwnPropertyNames(b).length === size;
                      if (result) {
                        while (size--) {
                          key = keys[size];
                          if (!(result = hasOwnProperty.call(b, key) && eq(a[key], b[key], aStack, bStack))) break;
                        }
                      }
                    }
                    aStack.pop();
                    bStack.pop();
                    return result;
                  };
                var isFunction = function(obj) {
                    return typeof obj == 'function' || false;
                };
                return eq(a, b, [], []);
            },
            _offset:  function (elem) {
                var strundefined = typeof undefined;
                var docElem, win,
                    box = { top: 0, left: 0 },
                    doc = elem && elem.ownerDocument;
                if ( !doc ) {
                    return;
                }
                docElem = doc.documentElement;
                if ( typeof elem.getBoundingClientRect !== strundefined ) {
                    box = elem.getBoundingClientRect();
                }
                win=(doc != null && doc === doc.window) ? doc : doc.nodeType === 9 && doc.defaultView;
                return {
                    top: box.top + win.pageYOffset - docElem.clientTop,
                    left: box.left + win.pageXOffset - docElem.clientLeft
                };
            }
        },
        backgroundColor: function (options) {
            d3.select(options.selector).style({"background-color":options.background_color,"position":"relative"})
            var bg,child1;
            bgColor(options.selector);

            function bgColor(child) {
                child1 = child;
                bg  = d3.select(child).style("background-color");
                if (bg === "transparent" || bg === "rgba(0, 0, 0, 0)") {
                    if(d3.select(child)[0][0].parentNode.tagName === undefined || d3.select(child)[0][0].parentNode.tagName.toLowerCase() === "body") {
                        options.k.__proto__._colourBrightness("rgb(255,255,255)",d3.select(child)[0]);
                    } else {
                        return bgColor(d3.select(child)[0][0].parentNode);
                    }
                } else {
                    return options.k.__proto__._colourBrightness(bg,d3.selectAll(child)[0]);
                }
            }
            if (d3.select(child1)[0][0].classList.contains("light")) {
                options.img = PykCharts.assets+"img/download.png";
            } else {
                options.img = PykCharts.assets+"img/download-light.png";
            }

            return this;
        },
        dataSourceFormatIdentification: function (data,chart,executeFunction) {
            if (typeof data === "object") {
                chart.data = data;
                chart[executeFunction](chart.data);
            } else {
                var dot_index = data.lastIndexOf('.'),
                len = data.length - dot_index,
                cache_avoidance_value = Math.floor((Math.random() * 100) + 1);

                if (data.constructor == Array) {
                    chart.data = data;
                    chart[executeFunction](chart.data);
                }
                else {
                    var format = data.substr(dot_index+1,len);
                    if (data.indexOf("<root>") != -1) {
                        var xml_data_converted_from_string,
                            json_data_converted_from_xml;

                        if (window.DOMParser) {
                            parser = new DOMParser();
                            xml_data_converted_from_string = parser.parseFromString(data,"text/xml");
                        } else { // Internet Explorer
                            xml_data_converted_from_string = new ActiveXObject("Microsoft.XMLDOM");
                            xml_data_converted_from_string.async = false;
                            xml_data_converted_from_string.loadXML(data);
                        }

                        json_data_converted_from_xml = options.k.__proto__._xmlToJson(xml_data_converted_from_string,0);
                        chart[executeFunction](json_data_converted_from_xml);
                    }
                    else if(data.indexOf("{")!= -1) {
                        chart.data = JSON.parse(data);
                        chart[executeFunction](chart.data);
                    } else if (data.indexOf(",")!= -1) {
                        chart.data = d3.csv.parse(data);
                        chart[executeFunction](chart.data);
                    } else if (format === "json") {
                        d3.json(data+"?"+cache_avoidance_value,chart[executeFunction]);
                    } else if(format === "csv") {
                        d3.csv(data+"?"+cache_avoidance_value,chart[executeFunction]);
                    } else if (format === "xml") {
                        d3.xml(data+"?"+cache_avoidance_value, function(data) {
                            var json_data_converted_from_xml;
                            json_data_converted_from_xml = options.k.__proto__._xmlToJson(data,1);
                            chart[executeFunction](json_data_converted_from_xml);
                        });
                    }
                }
            }
        },
        export: function(chart,svgId,chart_name,panels_enable,containers,chart_width) {
            if(PykCharts['boolean'](options.export_enable)) {
                var chart_width = options.chart_width;
                if(PykCharts['boolean'](panels_enable) && chart_width) {
                    chart_width = chart_width;
                }

                var id = "export",
                div_size = chart_width,
                div_float ="none",
                div_left = chart_width-16;

                d3.select(options.selector)
                        .append("div")
                        .style("left",chart_width - 80 + "px")
                        .attr("class","dropdown-multipleConatiner-export")

                if(PykCharts['boolean'](panels_enable)) {
                    var containers_length = containers.length;
                    for(var i = 0; i < containers_length; i++) {
                        d3.select(options.selector + " .dropdown-multipleConatiner-export")
                            .append("span")
                            .attr("id",chart_name + i)
                            .on("mouseover",function () {
                                d3.select(this).style("background-color","#E0E0E1");
                            })
                            .on("mouseout",function() {
                                d3.select(this).style('background-color',"#fff")
                            })
                            .style({
                                "margin-bottom" : "3px",
                                "cursor" : "pointer"
                            })
                            .html("Panel " + (i+1) + "<br>");
                    }
                } else {
                    d3.select(options.selector + " .dropdown-multipleConatiner-export")
                        .append("span")
                        .attr("id","span")
                        .on("mouseover",function () {
                            d3.select(this).style("background-color","#E0E0E1");
                        })
                        .on("mouseout",function() {
                            d3.select(this).style('background-color',"#fff")
                        })
                        .style({
                                "margin-bottom" : "3px",
                                "cursor" : "pointer"
                        })
                        .html("Export as SVG" + "<br>");
                }

                if(PykCharts['boolean'](options.title_text) && options.title_size  && options.mode === "default") {
                    div_size = 0.1*chart_width;
                    div_float ="left";
                    div_left = 0;
                }

                var export_div = d3.select(chart.selector)
                    .append("div")
                    .attr("id",id)
                    .style({
                        "width":div_size + "px",
                        "left":div_left+"px",
                        "float":div_float,
                        'text-align':'right'
                    })

                setTimeout(function () {
                    export_div.html("<img title='Export to SVG' src='"+options.img+"' style='left:"+div_left+"px;margin-bottom:3px;cursor:pointer;'/>");
                },options.transition_duration*1000);

            }
            return this;
        },
        exportSVG: function (chart,svgId,chart_name,panels_enable,containers,add_extra_width,add_extra_height) {
            if(PykCharts['boolean'](options.export_enable)) {
                if(!add_extra_width) {
                    add_extra_width = 0;
                }
                if(!add_extra_height) {
                    add_extra_height = 0;
                }

                var id = "export";
                var canvas_id = chart_name+"canvas";
                var canvas = document.createElement("canvas");
                canvas.setAttribute('id', canvas_id);
                var get_canvas = document.getElementById(canvas_id);
                paper.setup(get_canvas);
                var project = new paper.Project();
                project._view._viewSize.width = chart.chart_width + add_extra_width;
                project._view._viewSize.height = chart.chart_height +  add_extra_height;

                var name = chart_name + ".svg";
                d3.select(chart.selector + " #"+id).on("click",function () {
                    PykCharts.export_menu_status = 1;
                    d3.select(options.selector + " .dropdown-multipleConatiner-export").style("visibility", "visible");
                });

                if(!PykCharts['boolean'](panels_enable)) {
                    d3.selectAll(chart.selector + " #span").on("click",function () {
                        d3.select(options.selector + " .dropdown-multipleConatiner-export").style("visibility", "hidden");
                        chart.k.processSVG(document.querySelector(options.selector +" "+svgId),chart_name);
                        project.importSVG(document.querySelector(options.selector +" "+svgId));
                        var svg = project.exportSVG({ asString: true });
                        options.k.__proto__._downloadDataURI({
                            data: 'data:image/svg+xml;base64,' + btoa(svg),
                            filename: name
                        });
                        project.clear();
                    });
                } else {
                    var containers_length = containers.length;
                    for(var i = 0; i<containers_length; i++) {
                        d3.selectAll(chart.selector + " #"+chart_name + i).on("click",function () {
                            d3.select(options.selector + " .dropdown-multipleConatiner-export").style("visibility", "hidden");
                            var id = this.id.substring(this.id.length-1,this.id.length);
                            chart.k.processSVG(document.querySelector(options.selector + " #" +svgId + id),chart_name);
                            project.importSVG(document.querySelector(options.selector + " #" +svgId + id));
                            var svg = project.exportSVG({ asString: true });;
                            options.k.__proto__._downloadDataURI({
                                data: 'data:image/svg+xml;base64,' + btoa(svg),
                                filename: name
                            });
                            project.clear();
                        });
                    }
                }
            }
            return this;
        },
        shadeColorConversion: function (color, data_length) {
            var r,g,b, division,array = [], increment_ratio = (150/data_length),color_value,color_validation;

            color = d3.rgb(color);
            color_validation = "rgb(" + color.r + "," + color.g + "," + color.b +")"
            color_value = options.k.__proto__._colourBrightness(color_validation);
            if(color_value === "light") {
                inc = -1;
            } else {
                inc = 1;
            }
            var magnitude = Math.sqrt((color.r*color.r) + (color.g*color.g)) + Math.sqrt((color.r*color.r) + (color.b*color.b)) +  Math.sqrt((color.g*color.g) + (color.b*color.b))
            for(i = 0; Math.abs(i) < data_length; i += inc) {
                var rgb_color = {
                    "r":parseInt((color.r+(i*increment_ratio)),10),
                    "g":parseInt((color.g+(i*increment_ratio)),10),
                    "b":parseInt((color.b+(i*increment_ratio)),10)
                }
                var hex_color = "rgb(" + rgb_color.r + "," + rgb_color.g + "," + rgb_color.b +")"
                array.push(hex_color);
            }
            if(inc === -1) {
                array.reverse();
            }
            return array;
        },
        processSVG: function (svg,svgId) {
            var x = svg.querySelectorAll("text"),
                x_length = x.length;
            for (var i = 0; i < x_length; i++) {
                if(x[i].hasAttribute("dy")) {
                    var attr_value = x[i].getAttribute("dy"),
                        attr_length = attr_value.length;
                    if(attr_value.substring(attr_length-2,attr_length) == "em") {
                        var font_size, value;
                        if(x[i].hasAttribute('font-size')) {
                            font_size = x[i].getAttribute('font-size');
                            value = parseFloat(font_size)*parseFloat(attr_value);

                        } else {
                            value = 12*parseFloat(attr_value);
                        }
                        x[i].setAttribute("dy", value);
                    }
                }
            }
            return this;
        },
        errorHandling: function(error_msg,error_code,err_url) {
            console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+options.selector+".(Invalid value for attribute \""+error_msg+"\")  Visit https://github.com/pykih/PykCharts.js/wiki/Errors#error_"+error_code);
            return;
        },
        warningHandling: function(error_msg,error_code,err_url) {
            console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+options.selector+".(Invalid value for attribute \""+error_msg+"\")  Visit https://github.com/pykih/PykCharts.js/wiki/Warnings#warning_"+error_code);
            return;
        },
        validator: function () {
            var validator = {
                validatingSelector: function (selector) {
                    if(selector.charAt(0) === "#") {
                        selector = selector.substring(1,selector.length);
                    }
                    try {
                        if(!document.getElementById(selector)) {
                            options.stop = true;
                            throw "selector";
                        }
                    }
                    catch (err) {
                        options.k.errorHandling(err,"1");
                    }
                    return this;
                },
                validatingDataType: function (attr_value,config_name,default_value,name) {
                    try {
                        if(!options.k.__proto__._isNumber(attr_value)) {
                            if(name) {
                                options[name] = default_value;
                            } else {
                                options[config_name] = default_value;
                            }
                            throw config_name;
                        } else {
                            options[config_name] = parseFloat(attr_value);
                        }
                    }
                    catch (err) {
                        options.k.warningHandling(err,"1");
                    }
                    return this;
                },
                validatingChartMode: function (mode,config_name,default_value) {
                    try {
                        if(mode === "default" || mode === "infographics") {
                        } else {
                            options[config_name] = default_value;
                            throw "mode";
                        }
                    }
                    catch (err) {
                        options.k.warningHandling(err,"2");
                    }
                    return this;
                },
                validatingAxisDataFormat: function (axis_data_format,config_name) {
                    if(axis_data_format) {
                        try {
                            if(axis_data_format === "number" || axis_data_format === "string" || axis_data_format === "time") {
                            } else {
                                options.stop = true;
                                throw config_name;
                            }
                        }
                        catch (err) {

                            options.k.errorHandling(err,"9");
                        }
                    }
                    return this;
                },
                validatingColorMode: function (color_mode,config_name,default_value,chart_type) {
                    if(color_mode) {
                        try {
                            if(chart_type === "oneDimensionalCharts") {
                                if(color_mode === "color" || color_mode === "shade") {
                                } else {
                                    options[config_name] = default_value;
                                    throw "color_mode";
                                }
                            } else {
                                if(color_mode === "color" || color_mode === "saturation") {
                                } else {
                                    options[config_name] = default_value;
                                    throw "color_mode";
                                }
                            }
                        }
                        catch (err) {
                            options.k.warningHandling(err,"3");
                        }
                    }
                    return this;
                },
                validatingYAxisPointerPosition: function (axis_pointer_position,config_name,default_value) {
                        try {
                            if(axis_pointer_position === "left" || axis_pointer_position === "right" ) {
                            } else {
                                options[config_name] = default_value;
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.k.warningHandling(err,"7");
                        }
                    return this;
                },
                validatingXAxisPointerPosition: function (axis_pointer_position,config_name,default_value) {
                        try {
                            if(axis_pointer_position === "top" || axis_pointer_position === "bottom") {
                            } else {
                                options[config_name] = default_value;
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.k.warningHandling(err,"7");
                        }
                    return this;
                },
                validatingBorderBetweenChartElementsStyle: function (border_between_chart_elements_style,config_name) {
                        try {
                            if(border_between_chart_elements_style === "1,3" || border_between_chart_elements_style === "5,5" || border_between_chart_elements_style === "0") {
                            } else {
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.k.errorHandling(err,"#7");
                        }
                    return this;
                },
                validatingLegendsPosition: function (legends_display,config_name,default_value) {
                        try {
                            if(legends_display === "horizontal" || legends_display === "vertical") {
                            } else {
                                options[config_name] = default_value;
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.k.warningHandling(err,"13");
                        }
                    return this;
                },
                isArray: function (value,config_name) {
                        try {
                            if(!(value.constructor === Array)) {
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.stop = true;
                            options.k.errorHandling(err,"4");
                        }
                    return this;
                },
                validatingTimeScaleDataType: function (axis_time_value_datatype,config_name) {
                    if(axis_time_value_datatype) {
                        try {
                            if(axis_time_value_datatype === "date" || axis_time_value_datatype === "year" || axis_time_value_datatype === "month" || axis_time_value_datatype === "hours" || axis_time_value_datatype === "minutes") {
                            } else {
                                options.stop = true;
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.k.errorHandling(err,"5");
                        }
                    }
                    return this;
                },
                validatingTooltipMode: function (tooltip_mode,config_name,default_value) {
                    if(tooltip_mode) {
                        try {
                            if(tooltip_mode === "fixed" || tooltip_mode === "moving") {
                            } else {
                                options[config_name] = default_value;
                                throw config_name;
                            }
                        }
                        catch (err) {
                            options.k.warningHandling(err,"14");
                        }
                    }
                    return this;
                },
                validatingFontWeight: function (font_weight,config_name,default_value,name) {
                    try {
                        if(font_weight === "bold" || font_weight === "normal") {
                        } else {
                            if(name) {
                                options[name] = default_value;
                            } else {
                                options[config_name] = default_value;
                            }

                            throw config_name;
                        }
                    }
                    catch (err) {
                        options.k.warningHandling(err,"5");
                    }
                    return this;
                },
                validatingColor: function (color,config_name,default_value,name) {
                    if(color) {
                        try {
                            var checked;
                            if(typeof color != "string" ) {

                                throw config_name;
                            }

                            if(color.charAt(0)!= "#" && color.substring(0,3).toLowerCase() !="rgb" && color.toLowerCase()!= "transparent") {
                                checked = $c.name2hex(color) ;
                                if(checked === "Invalid Color Name") {
                                    throw config_name;
                                }
                            } else if (color.charAt(0) === "#") {
                                checked = /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(color);
                                if(!checked) {
                                    throw config_name;
                                }
                            }
                        }
                        catch (err) {
                            if(name) {
                                options[name] = default_value;
                            } else {
                                options[config_name] = default_value;
                            }
                            options.k.warningHandling(err,"4");
                        }
                    }
                    return this;
                },
                validatingDataMode : function (mode,config_name,default_value,name) {
                    try {
                        if(mode === "absolute" || mode === "percentage") {
                        } else {
                            options[config_name] = default_value;
                            throw config_name;
                        }
                    }
                    catch (err) {
                        options.k.warningHandling(err,"16");
                    }
                    return this;
                },
                validatingLegendsMode : function (mode,config_name,default_value,name) {
                    try {
                        if(mode === "default" || mode === "interactive") {
                        } else {
                            options[config_name] = default_value;
                            throw config_name;
                        }
                    }
                    catch (err) {
                        options.k.warningHandling(err,"17");
                    }
                    return this;
                },
                validatingJSON : function (data) { // note: this method method cannot be used for chaining as it return fasle and not this;
                    if(!data) {
                        try {
                            options.stop = true;
                            throw "Data is not in the valid JSON format";
                        }
                        catch (err) {
                            console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+ options.selector+".(\""+err+"\")  Visit www.pykcharts.com/errors#error_2");
                        }
                    }
                    return (options.stop) ? false : true;
                }
            };
            return validator;
        }
    };
    return configuration;
};
var configuration = PykCharts.Configuration;
configuration.mouseEvent = function (options) {
    var that = this;
    that.tooltip = configuration.tooltipp;
    var action = {
        tooltipPosition: function (d) {
            if(PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.annotation_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string") {
                that.tooltip
                    .style({
                        "display" : "block",
                        "top" : (PykCharts.getEvent().pageY - 20) + "px",
                        "left" : (PykCharts.getEvent().pageX + 30) + "px"
                    });
                return that.tooltip;
            }

        },
        tooltipTextShow: function (d,panels_enable,type,group_index,axis_tooltip) {
            var selector = options.selector.substr(1,options.selector.length)
            if(PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.annotation_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string") {
                if(panels_enable === "yes" && type === "multilineChart") {
                    d3.selectAll("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector).html(d);
                } else {
                    that.tooltip.html(d);
                }
                return this;
            }
        },
        tooltipHide: function (d,panels_enable,type,axis_tooltip) {
            if(PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.annotation_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string") {
                if(panels_enable === "yes" && type === "multilineChart") {
                    return d3.selectAll(".pyk-tooltip").style("display","none");
                }
                else {
                    return that.tooltip.style("display", "none");
                }
            }
        },
        axisHighlightShow: function (active_tick,axisHighlight,domain,a) {
            var curr_tick,prev_tick,axis_pointer_color,selection,axis_data_length,active_tick_length,domain_length;
            if(PykCharts['boolean'](options.axis_onhover_highlight_enable)/* && options.mode === "default"*/){
                if(axisHighlight === options.selector + " .y.axis" && a == undefined){
                    selection = axisHighlight+" .tick text";
                    axis_pointer_color = options.axis_y_pointer_color;
                    axis_data_length = d3.selectAll(selection)[0].length;
                    active_tick_length = active_tick.length;

                    d3.selectAll(selection)
                        .style("fill","#bbb")
                        .style("font-weight","normal");

                    for(var b=0;b < axis_data_length;b++) {
                        for(var c=0;c < active_tick_length;c++) {
                            if(d3.selectAll(selection)[0][b].__data__ === active_tick[c]) {
                                d3.select(d3.selectAll(selection)[0][b])
                                    .style("fill",axis_pointer_color)
                                    .style("font-weight","bold");
                            }
                        }
                    }
                }
                else {
                    if(axisHighlight === options.selector + " .x.axis") {
                        selection = axisHighlight+" .tick text";
                        axis_pointer_color = options.axis_x_pointer_color;
                    } else if(axisHighlight === options.selector + " .axis-text" && a === "column") {
                        selection = axisHighlight;
                        axis_pointer_color = options.axis_x_pointer_color;
                    } else if(axisHighlight === options.selector + " .axis-text" && a === "bar") {
                        selection = axisHighlight;
                        axis_pointer_color = options.axis_y_pointer_color;
                    } else if(axisHighlight === options.selector + " .y.axis" && a == "waterfall") {
                        selection = axisHighlight+" .tick text";
                        axis_pointer_color = options.axis_y_pointer_color;
                    } else if(axisHighlight === options.selector + " .y.axis" && a === "bar") {
                        selection = axisHighlight+" .tick text";
                        axis_pointer_color = options.axis_x_pointer_color;
                    }

                    if(prev_tick !== undefined) {
                        d3.select(d3.selectAll(selection)[0][prev_tick])
                            .style({
                                "fill" : axis_pointer_color,
                                "font-weight" : "normal"
                            });
                    }

                    axis_data_length = d3.selectAll(selection)[0].length;

                    var len = domain.length;
                    if(options.axis_x_data_format === "number"/* && a === undefined*/) {
                        for(var curr_tick=0 ; curr_tick<axis_data_length ; curr_tick++) {
                            if(d3.selectAll(selection)[0][curr_tick].__data__ == active_tick) {
                                break;
                            }
                        }
                    } else {
                        for(curr_tick = 0;curr_tick < len;curr_tick++) {
                            if(domain[curr_tick] === active_tick) {
                                break;
                            }
                        }
                    }
                    prev_tick = curr_tick;
                    d3.selectAll(selection)
                        .style("fill","#bbb");
                    d3.select(d3.selectAll(selection)[0][curr_tick])
                        .style({
                            "fill" : axis_pointer_color,
                            "font-weight" : "bold"
                        });
                }
            }
            return this;
        },
        axisHighlightHide: function (axisHighlight,a) {
            var fill_color,selection,font_weight;
            if(PykCharts['boolean'](options.axis_onhover_highlight_enable)/* && options.mode === "default"*/){
                if(axisHighlight === options.selector + " .y.axis") {
                    selection = axisHighlight+" .tick text";
                    fill_color = options.axis_y_pointer_color;
                    font_weight = options.axis_y_pointer_weight;
                } else if(axisHighlight === options.selector + " .x.axis") {
                    selection = axisHighlight+" .tick text";
                    fill_color = options.axis_x_pointer_color;
                    font_weight = options.axis_x_pointer_weight;
                } else if(axisHighlight === options.selector + " .axis-text" && a === "column") {
                    selection = axisHighlight;
                    fill_color = options.axis_x_pointer_color;
                    font_weight = options.axis_x_pointer_weight;
                } else if(axisHighlight === options.selector + " .axis-text" && a === "bar") {
                    selection = axisHighlight;
                    fill_color = options.axis_y_pointer_color;
                    font_weight = options.axis_y_pointer_weight;
                }
                d3.selectAll(selection)
                    .style({
                        "fill" : fill_color,
                        "font-weight" : font_weight
                    });
            }

            return this;
        },
        highlight: function (selectedclass, that, has_svg_element_as_container) {
            var t = d3.select(that);
            d3.selectAll(selectedclass)
                .attr("fill-opacity", function(d,i) {
                    return (d.children && has_svg_element_as_container) ? 0 : 0.5;
                });
            t.attr("fill-opacity",1);
            return this;
        },
        highlightHide: function (selectedclass) {
            d3.selectAll(selectedclass)
                .attr("fill-opacity",function (d,i) {
                    return d3.select(this).attr("data-fill-opacity");
                });
            return this;
        },
        highlightGroup: function (selectedclass, that, element) {
            var t = d3.select(that);

            var group = d3.selectAll(selectedclass);

                group.selectAll(element)
                    .attr("fill-opacity",.5)

            t.selectAll(element).attr("fill-opacity",1);

            return this;
        },
        highlightGroupHide : function (selectedclass,element) {
            d3.selectAll(selectedclass+" "+element)
                .attr("fill-opacity",function (d,i) {
                    return d3.select(this).attr("data-fill-opacity");
                });
            return this;
        }
    };
    return action;
};

configuration.fillChart = function (options,theme,config) {
    var that = this;
    var fillchart = {
        selectColor: function (d) {
            theme = new PykCharts.Configuration.Theme({});
            if(options.color_mode === "color") {
                if(d.name.toLowerCase() === options.highlight.toLowerCase()) {
                    return options.highlight_color;
                } else if (options.chart_color.length && options.chart_color[0]){
                    return options.chart_color[0];
                } else {
                    return theme.stylesheet.chart_color
                }
            } else {
                return d.color;
            }
        },
        colorChart: function (d) {
            if(d.name === options.highlight) {
                return theme.stylesheet.highlight_color;
            } else{
                return theme.stylesheet.chart_color;
            }
        },
        colorPieW: function (d) {
            if(d.color) {
                return d.color;
            } else if(options.chart_color.length) {
                return options.color;
            }
            else return options.chart_color[0];
        },
        colorPieMS: function (d,chart_type) {
            if(chart_type !== "lineChart" && chart_type !== "areaChart" && d.name.toLowerCase() === options.highlight.toLowerCase()) {
                return options.highlight_color;
            } else if(options.color_mode === "saturation") {
                return options.saturation_color;
            } else if(options.color_mode === "color") {
                return d.color;
            }
        },
        colorGroup: function (d) {
            if(options.color_mode === "saturation") {
                return options.saturation_color;
            } else if(options.color_mode === "color") {
                return d.color;
            }
        },
        colorLegends: function (d) {
            if(options.color_mode === "saturation") {
                return options.saturation_color;
            } else if(options.color_mode === "color" && d) {
                return d;
            } else if(options.color_mode === "color"){
                return options.chart_color;
            } else {
                return options.chart_color[0];
            } return options.chart_color;
        }
    }
    return fillchart;
};

configuration.border = function (options) {
    var that = this;
    var border = {
        width: function () {
            return options.border_between_chart_elements_thickness +"px";
        },
        color: function () {
            return options.border_between_chart_elements_color;
        },
        style: function () {
            return options.border_between_chart_elements_style;
        }
    };
    return border;
};


configuration.transition = function (options) {
    var that = this;
    var transition = {
        duration: function() {
            if(options.mode === "default" && PykCharts['boolean'](options.transition_duration)) {
                return options.transition_duration * 1000;
            } else {
                return 0;
            }
        }
    };
    return transition;
};

configuration.renderBrush = function (options,xScale,group,height) {
    function resizeHandle (d) {
        var e = +(d == "e"), x = e ? 1 : -1, y = height / 3;
        return ("M" + (0.5 * x) + "," + y
                + "A6,6 0 0 " + e + " " + (6.5 * x) + "," + (y + 6)
                + "V" + (2 * y - 6)
                + "A6,6 0 0 " + e + " " + (0.5 * x) + "," + (2 * y)
                + "Z"
                + "M" + (2.5 * x) + "," + (y + 8)
                + "V" + (2 * y - 8)
                + "M" + (4.5 * x) + "," + (y + 8)
                + "V" + (2 * y - 8));

    }

    options.make_brush = d3.svg.brush().x(xScale)
           .on("brushend", brushend)

    var brush = group.append("g")
        .attr("class", "brush")
        .call(options.make_brush);

    brush.selectAll("rect")
      .attr("height",height)
      .attr("fill","blue")
      .attr("fill-opacity",0.3);
    brush.selectAll(".resize").append("path").attr("d", resizeHandle)
            .attr("fill","#4C7190")
            .attr("stroke","#4C7190")
            .attr("stroke-width","1.5px");

    function brushend() {
        options.brush_extent = d3.event.target.extent();
        min = options.brush_extent[0];
        max = options.brush_extent[1];
        options.onBrush(xScale(min),xScale(max));
        console.log(xScale(min),xScale(max))
        return options.brush_extent;
    }
};

configuration.Theme = function(){
    var that = this;
    that.stylesheet = {
        "mode": "default",
        "selector": "",
        "interactive_enable": "no",
        "click_enable": "no",

        "chart_height": 430,
        "chart_width": 600,
        "chart_margin_top": 35,
        "chart_margin_right": 50,
        "chart_margin_bottom": 35,
        "chart_margin_left": 50,

        "title_text": "",
        "title_size": 2,
        "title_color": "#1D1D1D",
        "title_weight": "bold",
        "title_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "subtitle_size": 1,
        "subtitle_color": "black",
        "subtitle_weight": "normal",
        "subtitle_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "highlight": "",
        "highlight_color": "#08306b",
        "background_color": "transparent",
        "chart_color": ["#255AEE"],
        "saturation_color": "#255AEE",

        "border_between_chart_elements_thickness": 1,
        "border_between_chart_elements_color": "white",
        "border_between_chart_elements_style": "solid",

        "legends_enable": "yes",
        "legends_display": "horizontal",
        "legends_text_size": 11,
        "legends_text_color": "#1D1D1D",
        "legends_text_weight": "normal",
        "legends_text_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "label_size": 11,
        "label_color": "white",
        "label_weight": "normal",
        "label_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "pointer_overflow_enable": "yes",
        "pointer_thickness": 1,
        "pointer_weight": "normal",
        "pointer_size": 11,
        "pointer_color": "#1D1D1D",
        "pointer_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "export_enable": "no",

        "color_mode": "color",

        "axis_x_pointer_size": 11,
        "axis_x_pointer_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",
        "axis_x_pointer_weight": "normal",
        "axis_x_pointer_color": "#1D1D1D",

        "axis_x_enable": "yes",

        "axis_x_title": "",
        "axis_x_title_size": 14,
        "axis_x_title_color": "#1D1D1D",
        "axis_x_title_weight": "bold",
        "axis_x_title_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "axis_x_position": "bottom",
        "axis_x_pointer_position": "bottom", //axis orient
        "axis_x_line_color": "#1D1D1D",
        "axis_x_no_of_axis_value": 5,
        "axis_x_pointer_length": 5,
        "axis_x_pointer_padding": 6,
        "axis_x_pointer_values": [],
        "axis_x_outer_pointer_length": 0,
        "axis_x_time_value_datatype":"",
        "axis_x_time_value_interval":0,
        "axisHighlight_x_data_format": "string",

        "loading_source": "<div class='PykCharts-loading'>loading...</div>",
        "loading_type": "css",

        "tooltip_enable": "yes",
        "tooltip_mode": "moving",

        "credit_my_site_name": "PykCharts",
        "credit_my_site_url": "http://www.pykcharts.com/",
        "chart_onhover_highlight_enable": "yes",
        "units_prefix": false,
        "units_suffix":false
    };

    that.functionality = {
        "real_time_charts_refresh_frequency": 0,
        "real_time_charts_last_updated_at_enable": "yes",
        "transition_duration": 0
    };

    that.oneDimensionalCharts = {
        "clubdata_enable": "yes",
        "clubdata_text": "Others",
        "clubdata_maximum_nodes": 5,
        "shade_color": "#255AEE",
        "pie_radius_percent": 70,
        "donut_radius_percent": 70,
        "donut_inner_radius_percent": 40,
        "donut_show_total_at_center": "yes",
        "donut_show_total_at_center_size": 24,
        "donut_show_total_at_center_color": "#1D1D1D",
        "donut_show_total_at_center_weight": "bold",
        "donut_show_total_at_center_family":"'Helvetica Neue',Helvetica,Arial,sans-serif",

        "funnel_rect_width": 100,
        "funnel_rect_height": 100,

        "percent_column_rect_width": 20,
        "percent_row_rect_height": 10,
    };

    that.otherCharts = {
        "pictograph_show_all_images": "yes",
        "pictograph_total_count_enable": "yes",
        "pictograph_current_count_enable": "yes",
        "pictograph_image_per_line": 3,
        "pictograph_image_width": 79,
        "pictograph_image_height": 66,
        "pictograph_current_count_size": 64,
        "pictograph_current_count_color": "#255aee",
        "pictograph_current_count_weight": "normal",
        "pictograph_current_count_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",
        "pictograph_total_count_size": 64,
        "pictograph_total_count_color": "grey",
        "pictograph_total_count_weight": "normal",
        "pictograph_total_count_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",
        "pictograph_units_per_image_text_size": 24,
        "pictograph_units_per_image_text_color": "grey",
        "pictograph_units_per_image_text_weight": "normal",
        "pictograph_units_per_image_text_family": "'Helvetica Neue',Helvetica,Arial,sans-serif"
    };

    that.multiDimensionalCharts = {

        "chart_grid_x_enable": "yes",
        "chart_grid_y_enable": "yes",
        "chart_grid_color":"#ddd",

        "axis_onhover_highlight_enable": "yes",

        "axis_y_pointer_size": 11,
        "axis_y_pointer_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",
        "axis_y_pointer_weight": "normal",
        "axis_y_pointer_color": "#1D1D1D",
        "axis_y_enable": "yes",

        "axis_y_title": "",
        "axis_y_title_size": 14,
        "axis_y_title_color": "#1D1D1D",
        "axis_y_title_weight": "bold",
        "axis_y_title_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",

        "axis_y_position": "left",
        "axis_y_pointer_position": "left",
        "axis_y_line_color": "#1D1D1D",
        "axis_y_no_of_axis_value": 5,
        "axis_y_pointer_length": 5,
        "axis_y_pointer_padding": 6,
        "axis_y_pointer_values": [],
        "axis_y_outer_pointer_length": 0,
        "axis_y_time_value_datatype":"",
        "axis_y_time_value_interval":0,
        "axis_y_data_format": "number",
        "variable_circle_size_enable": "yes",

        "crosshair_enable": "yes",
        "zoom_enable": "no",
        "zoom_level": 3,

        "spiderweb_outer_radius_percent": 100,

        "scatterplot_radius": 20,
        "scatterplot_pointer_enable": "no",

        "curvy_lines_enable": "no",

        "annotation_enable": "no",
        "annotation_view_mode": "onload", // "onload" / "onclick"

        "annotation_background_color" : "#C2CBCF", /*"#EEEEEE"*/
        "annotation_font_color" : "black",
        "legends_mode":"default", // or interactive
        "expand_group": "yes",
        "data_mode_enable" : "no",
        "data_mode_legends_color" : "black",
        "data_mode_default" : "percentage",
        "connecting_lines_color" : "#ddd",
        "connecting_lines_style": "solid",
        "text_between_steps_color": "#aaa",
        "text_between_steps_family": "'Helvetica Neue',Helvetica,Arial,sans-serif",
        "text_between_steps_size": 10,
        "text_between_steps_weight" : "normal",
        "data_mode_enable" : "no",
        "data_mode_legends_color" : "black",
        "data_mode_default" : "percentage",
        "connecting_lines_color" : "#ddd",
        "connecting_lines_style": "solid",

        "data_sort_enable": "yes",
        "data_sort_type": "alphabetically", // sort type --- "alphabetically" / "numerically" / "date"
        "data_sort_order": "ascending", // sort order --- "descending" / "ascending"
        "calculate_total": "yes",
        "axis_y_background_color": "transparent"
    };

    that.treeCharts = {
        "zoom_enable": "no",
        "nodeRadius": 4.5
    };

    that.mapsTheme = {
        "total_no_of_colors": 3,
        "palette_color": "Blue-1",

        "tooltip_position_top": 0,
        "tooltip_position_left": 0,

        "timeline_duration": 1,
        "timeline_margin_top": 5,
        "timeline_margin_right": 25,
        "timeline_margin_bottom": 25,
        "timeline_margin_left": 45,

        "label_enable": "no",
        "click_enable": "yes",

        "chart_onhover_effect": "shadow"
    };
    return that;
}

PykCharts.validation = {};
PykCharts.oneD = {};
PykCharts.other = {};
PykCharts.validation.processInputs = function (chartObject, options, chart_type) {
    var theme = new PykCharts.Configuration.Theme({})
	    , stylesheet = theme.stylesheet
	    , functionality = theme.functionality
	    , oneDimensionalCharts = theme.oneDimensionalCharts
	    , multiDimensionalCharts = theme.multiDimensionalCharts
        , mapsTheme = theme.mapsTheme;

        chartObject.title_text = options.title_text;
        chartObject.subtitle_text = options.subtitle_text;
        if(options.credit_my_site_name || options.credit_my_site_url) {
            chartObject.credit_my_site_name = options.credit_my_site_name ? options.credit_my_site_name : "";
            chartObject.credit_my_site_url = options.credit_my_site_url ? options.credit_my_site_url : "";
        } else {
            chartObject.credit_my_site_name = stylesheet.credit_my_site_name;
            chartObject.credit_my_site_url = stylesheet.credit_my_site_url;
        }
        chartObject.data_source_name = options.data_source_name ? options.data_source_name : "";
        chartObject.data_source_url = options.data_source_url ? options.data_source_url : "";
        chartObject.default_color = stylesheet.chart_color;

    var config_param_info = [
    	{
    		'config_name': 'selector',
    		'default_value': stylesheet,
    		'validation_type': 'validatingSelector',
            'all_charts': true
    	},
    	{
    		'config_name': 'chart_color',
    		'default_value': stylesheet,
    		'validation_type': 'isArray',
            'all_charts': true
    	},
        {
            'config_name': 'axis_x_pointer_values',
            'default_value': stylesheet,
            'validation_type': 'isArray',
            'maps':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_y_pointer_values',
            'default_value': multiDimensionalCharts,
            'validation_type': 'isArray',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'mode',
            'default_value': stylesheet,
            'validation_type': 'validatingChartMode',
            'condition2': convertToLowerCase,
            'oneDimensionalCharts': true,
            'multiDimensionalCharts':true,
            'other': true
        },
    	{
    		'config_name': 'chart_width',
    		'default_value': stylesheet,
    		'validation_type': 'validatingDataType',
            'all_charts':true
    	},
        {
            'config_name': 'title_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'all_charts':true

        },
        {
            'config_name': 'subtitle_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'all_charts':true
        },
        {
            'config_name': 'border_between_chart_elements_thickness',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'all_charts':true
        },
        {
            'config_name': 'label_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'all_charts':true
        },
        {
            'config_name': 'pointer_thickness',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'oneDimensionalCharts':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'pointer_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'oneDimensionalCharts':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_x_title_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_y_title_size',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'legends_text_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'maps':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_x_pointer_size',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'maps':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_y_pointer_size',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_x_pointer_length',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'maps':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_y_pointer_length',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_outer_pointer_length',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'maps':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'axis_y_outer_pointer_length',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'real_time_charts_refresh_frequency',
            'default_value': functionality,
            'validation_type': 'validatingDataType',
            'all_charts':true
        },
        {
            'config_name': 'transition_duration',
            'default_value': functionality,
            'validation_type': 'validatingDataType',
            'oneDimensionalCharts': true,
            'multiDimensionalCharts':true,
            'other': true
        },
        {
            'config_name': 'clubdata_maximum_nodes',
            'default_value': oneDimensionalCharts,
            'validation_type': 'validatingDataType',
            'oneDimensionalCharts':true
        },
        {
            'config_name': 'title_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'all_charts': true
        },
        {
            'config_name': 'subtitle_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'all_charts': true
        },
        {
            'config_name': 'pointer_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'oneDimensionalCharts': true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'label_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'all_charts': true
        },
        {
            'config_name': 'background_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'all_charts': true
        },
        {
            'config_name': 'shade_color',
            'default_value': oneDimensionalCharts,
            'validation_type': 'validatingColor',
            'oneDimensionalCharts': true
        },
        {
            'config_name': 'title_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'all_charts': true
        },
        {
            'config_name': 'subtitle_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'all_charts': true
        },
        {
            'config_name': 'highlight_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'all_charts': true
        },
        {
            'config_name': 'label_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'all_charts': true
        },
        {
            'config_name': 'pointer_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'oneDimensionalCharts': true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'border_between_chart_elements_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'all_charts': true
        },
        {
            'config_name': 'axis_x_time_value_datatype',
            'default_value': stylesheet,
            'validation_type': 'validatingTimeScaleDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_time_value_datatype',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingTimeScaleDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'chart_height',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'chart_margin_left',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'chart_margin_right',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'chart_margin_top',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'chart_margin_bottom',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'condition1': findInObject,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'zoom_level',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_pointer_padding',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_y_pointer_padding',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_no_of_axis_value',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_no_of_axis_value',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_time_value_interval',
            'default_value': stylesheet,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_time_value_interval',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingDataType',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'legends_text_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_x_pointer_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_y_pointer_color',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_title_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_title_color',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_line_color',
            'default_value': stylesheet,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_y_line_color',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'annotation_font_color',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'annotation_background_color',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'chart_grid_color',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingColor',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'legends_display',
            'default_value': stylesheet,
            'validation_type': 'validatingLegendsPosition',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'tooltip_mode',
            'default_value': stylesheet,
            'validation_type': 'validatingTooltipMode',
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'legends_text_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_y_pointer_weight',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_pointer_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_y_title_weight',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_title_weight',
            'default_value': stylesheet,
            'validation_type': 'validatingFontWeight',
            'condition2' : convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_position',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingYAxisPointerPosition',
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_position',
            'default_value': stylesheet,
            'validation_type': 'validatingXAxisPointerPosition',
            'condition2': convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_pointer_position',
            'default_value': multiDimensionalCharts,
            'validation_type': 'validatingYAxisPointerPosition',
            'condition2': convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_x_pointer_position',
            'default_value': stylesheet,
            'validation_type': 'validatingXAxisPointerPosition',
            'condition2': convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'color_mode',
            'default_value': stylesheet,
            'validation_type': 'validatingColorMode',
            'condition2': convertToLowerCase,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'border_between_chart_elements_style',
            'default_value': stylesheet,
            'condition2': convertToLowerCase,
            'all_charts': true
        },
        {
            'config_name': 'clubdata_text',
            'default_value':oneDimensionalCharts,
            'oneDimensionalCharts': true
        },
        {
            'config_name': 'saturation_color',
            'default_value': stylesheet,
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'timeline_duration',
            'default_value': mapsTheme,
            'maps': true,
            'condition1':findInObject
        }
    ];


    chartObject.k = new PykCharts.Configuration(chartObject);
    var validator = chartObject.k.validator();

    for (var i=0,config_length=config_param_info.length; i<config_length; i++) {
        var config = config_param_info[i];
        if(config[chart_type] || config.all_charts) {
            var config_name = config.config_name
            , default_value = config.default_value[config_name]
            , condition1 = !config.condition1 ? options[config_name] : config.condition1(config_name);

            if(config_name in options) {
                var condition2  = !config.condition2 ? options[config_name] : config.condition2(options[config_name]);
            }
            chartObject[config_name] = condition1 ? condition2 : default_value;
            if(config.validation_type) {
                validator[config.validation_type](chartObject[config_name],config_name,default_value);
            }
        }
    }

    if (chart_type === "maps") {
        chartObject.axis_x_pointer_position = options.axis_x_pointer_position ? options.axis_x_pointer_position : "top";
        validator.validatingXAxisPointerPosition(chartObject.axis_x_pointer_position,"axis_x_pointer_position","top");
    }

    if(chart_type === "oneDimensionalCharts") {
        chartObject.color_mode = options.color_mode ? options.color_mode : "shade";
        validator.validatingColorMode(chartObject.color_mode,"color_mode","shade",chart_type);
    }
    else if (chart_type === "maps") {
        chartObject.color_mode = options.color_mode ? options.color_mode : "saturation";
        validator.validatingColorMode(chartObject.color_mode,"color_mode","saturation",chart_type);
    }

    var enable_config_param = [
        {
            'config_name':'interactive_enable',
            'default_value': stylesheet,
            'all_charts':true
        },
        {
            'config_name':'click_enable',
            'default_value': stylesheet,
            'all_charts':true
        },
        {
            'config_name': 'tooltip_enable',
            'default_value': stylesheet,
            'all_charts': true
        },
        {
            'config_name': 'export_enable',
            'default_value': stylesheet,
            'all_charts': true
        },
        {
            'config_name': 'real_time_charts_last_updated_at_enable',
            'default_value': functionality,
            'all_charts': true
        },
        {
            'config_name': 'clubdata_enable',
            'default_value': oneDimensionalCharts,
            'oneDimensionalCharts': true
        },
        {
            'config_name': 'pointer_overflow_enable',
            'default_value': stylesheet,
            'oneDimensionalCharts': true
        },
        {
            'config_name': 'chart_onhover_highlight_enable',
            'default_value': stylesheet,
            'all_charts': true
        },
        {
            'config_name': 'chart_grid_x_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'chart_grid_y_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name':'axis_x_enable',
            'default_value': stylesheet,
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'axis_y_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_onhover_highlight_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'zoom_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'annotation_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'legends_enable',
            'default_value': stylesheet,
            'multiDimensionalCharts': true,
            'maps': true
        },
        {
            'config_name': 'variable_circle_size_enable',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'title_family',
            'default_value':stylesheet,
            'all_charts':true
        },
        {
            'config_name': 'subtitle_family',
            'default_value':stylesheet,
            'all_charts':true
        },
        {
            'config_name': 'pointer_family',
            'default_value':stylesheet,
            'oneDimensionalCharts':true,
            'multiDimensionalCharts':true
        },
        {
            'config_name': 'title_family',
            'default_value':stylesheet,
            'all_charts':true
        },
        {
            'config_name': 'label_family',
            'default_value':stylesheet,
            'all_charts':true
        },
        {
            'config_name': 'units_suffix',
            'default_value':stylesheet,
            'oneDimensionalCharts':true
        },
        {
            'config_name': 'units_prefix',
            'default_value':stylesheet,
            'oneDimensionalCharts':true
        },
        {
            'config_name':'highlight',
            'default_value': stylesheet,
            'all_charts': true
        },
        {
            'config_name': 'axis_x_title_family',
            'default_value': stylesheet,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_title_family',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'legends_text_family',
            'default_value': stylesheet,
            'multiDimensionalCharts': true,

        },
        {
            'config_name': 'axis_x_title',
            'default_value': stylesheet,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'axis_y_title',
            'default_value': stylesheet,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'map_code',
            'default_value': mapsTheme,
            'maps': true
        },
        {
            'config_name': 'click_enable',
            'default_value': mapsTheme,
            'maps': true
        },
        {
            'config_name': 'annotation_view_mode',
            'default_value': multiDimensionalCharts,
            'multiDimensionalCharts': true
        },
        {
            'config_name': 'loading_type',
            'default_value': stylesheet,
            'all_charts': true
        },
        {
            'config_name': 'loading_source',
            'default_value': stylesheet,
            'all_charts': true
        }
    ];


    for (var i = 0, len = enable_config_param.length; i<len; i++) {
        var config = enable_config_param[i];
        if(config[chart_type] || config.all_charts) {
            var config_name = config.config_name;
            var default_value = config.default_value[config_name];
            chartObject[config_name] = options[config_name] ? options[config_name] : default_value;
        }
    }

    chartObject.clubdata_always_include_data_points = PykCharts['boolean'](chartObject.clubdata_enable) && options.clubdata_always_include_data_points ? options.clubdata_always_include_data_points : [];
    validator.isArray(chartObject.clubdata_always_include_data_points,"clubdata_always_include_data_points");

    switch(chartObject.border_between_chart_elements_style) {
        case "dotted" : chartObject.border_between_chart_elements_style = "1,3";
                        break;
        case "dashed" : chartObject.border_between_chart_elements_style = "5,5";
                       break;
        default : chartObject.border_between_chart_elements_style = "0";
                  break;
    }

    if(chart_type === 'oneDimensionalCharts' || chart_type === 'maps') {
        if(chartObject.chart_color[0]) {
            chartObject.k.validator()
                .validatingColor(chartObject.chart_color[0],"chart_color",stylesheet.chart_color);
        }
    } else {
        for(var i = 0;i < chartObject.chart_color.length;i++) {
            if(chartObject.chart_color[i]) {
                chartObject.k.validator()
                    .validatingColor(chartObject.chart_color[i],"chart_color",stylesheet.chart_color);
            }
        }
    }

    function convertToLowerCase(value) {
        return value.toLowerCase();
    }

    function findInObject(value) {
        return value in options;
    }
    chartObject.k = new PykCharts.Configuration(chartObject);
    return chartObject;
}
PykCharts.oneD.bubble = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options,'oneDimensionalCharts');
        that.chart_height = options.chart_height ? options.chart_height : that.chart_width;

        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width);

        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
            that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);

            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };

    this.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("oned",data);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data)
                , shade_array = [];
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.new_data = that.optionalFeatures().clubData();
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.children.length);
                shade_array.reverse();
                that.new_data.children.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures()
                .createChart()
                .label();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function () {

        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg"
            , shade_array = [];

        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);
        if (that.mode ==="default") {

            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"bubble")
                .emptyDiv(that.selector)
                .subtitle();

            that.new_data = that.optionalFeatures().clubData();
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.children.length);
                shade_array.reverse();
                that.new_data.children.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures().svgContainer(container_id)
                .createChart()
                .label();

            that.k.createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource()
                .liveData(that)
                .tooltip();
        }
        else if (that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#" + container_id,"bubble")
                .emptyDiv(that.selector);

            that.new_data = {"children" : that.data};
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.children.length);
                shade_array.reverse();
                that.new_data.children.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures().svgContainer(container_id)
                .createChart()
                .label();

            that.k.tooltip();

        }
        that.k.exportSVG(that,"#"+container_id,"bubble")
        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    this.optionalFeatures = function () {
        var optional = {
            svgContainer: function (container_id) {
                that.svgContainer = d3.select(that.selector).append("svg")
                    .attr({
                        "class": "svgcontainer PykCharts-oneD",
                        "id": container_id,
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "width": that.chart_width,
                        "height": that.chart_height
                    });
                that.group = that.svgContainer.append("g")
                    .attr("id","bubgrp");
                return this;
            },
            createChart : function () {
                var bubble = d3.layout.pack()
                    .sort(function (a,b) { return b.weight - a.weight; })
                    .size([that.chart_width, that.chart_height])
                    .value(function (d) { return d.weight; })
                    .padding(20);

                that.sum = d3.sum(that.new_data.children, function (d) {
                    return d.weight;
                });

                var l = that.new_data.children.length;
                that.node = bubble.nodes(that.new_data);

                var chart_data = that.group.selectAll(".bubble-node")
                    .data(that.node);

                chart_data.enter()
                    .append("g")
                    .attr("class","bubble-node")
                    .append("circle");

                chart_data.attr("class","bubble-node")
                    .select("circle")
                    .attr({
                        "class": "bubble",
                        "id":function (d,i) {
                            return "bubble"+i;
                        },
                        "x":function (d) { return d.x; },
                        "y":function (d) { return d.y; },
                        "r": 0,
                        "transform": function (d) { return "translate(" + d.x + "," + d.y +")"; },
                        "fill": function (d) {
                            return d.children ? that.background_color : that.fillChart.selectColor(d);
                        },
                        "fill-opacity": function(d) {
                            return d.children ? 0 : 1;
                        },
                        "data-fill-opacity": function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "data-id":function (d,i) {
                            return d.name;
                        }
                    })
                    .on({
                        "mouseover": function (d) {
                            if(!d.children && that.mode==="default") {
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlight(that.selector+" "+".bubble", this, true);
                                }
                                d.tooltip = d.tooltip ||"<table><thead><th colspan='2' class='tooltip-heading'>"+d.name+"</th></thead><tr><td class='tooltip-left-content'>"+that.k.appendUnits(d.weight)+"  <td class='tooltip-right-content'>("+((d.weight*100)/that.sum).toFixed(1)+"%)</tr></table>";
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(d.tooltip);
                            }
                        },
                        "mouseout": function (d) {
                            if(that.mode==="default") {
                                that.mouseEvent.tooltipHide(d)
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightHide(that.selector+" "+".bubble");
                                }
                            }
                        },
                        "mousemove": function (d) {
                            if(!d.children && that.mode==="default") {
                                that.mouseEvent.tooltipPosition(d);
                            }
                        },
                        'click': function (d,i) {
                            if(PykCharts['boolean'](that.click_enable)){
                               that.addEvents(d.name, d3.select(this).attr("data-id"));
                            }
                        }
                    })
                    .transition()
                    .duration(that.transitions.duration())
                    .attr("r",function (d) {return d.r; });
                chart_data.exit().remove();

                return this;
            },
            label : function () {
                var chart_text = that.group.selectAll(".name")
                        .data(that.node);

                var chart_text1 = that.group.selectAll(".weight")
                    .data(that.node);

                chart_text.enter()
                    .append("svg:text")
                    .attr("class","name");

                chart_text1.enter()
                    .append("svg:text")
                    .attr("class","weight");

                chart_text.attr("class","name")
                    .attr({
                        "x": function (d) { return d.x },
                        "y": function (d) { return d.y -5 }
                    });

                chart_text1.attr("class","weight")
                    .attr({
                        "x": function (d) { return d.x },
                        "y": function (d) { return + d.y + that.label_size; }
                    });

                chart_text.attr("text-anchor","middle")
                    .attr("fill", function(d) {
                        if(that.color_mode === "shade" && !d.children && !options.label_color) {
                            var color_value = that.k.__proto__._colourBrightness(d.color);
                            if(color_value === "light") {
                                return "black";
                            } else {
                                return "white";
                            }
                        }
                        return that.label_color;
                    })
                    .style({
                        "font-weight": that.label_weight,
                        "font-size": that.label_size + "px",
                        "font-family": that.label_family
                    })
                    .text("")

                    function chart_text_timeout() {
                        chart_text
                            .text(function (d) { return d.children ? " " :  d.name; })
                            .attr("pointer-events","none")
                            .text(function (d) {
                                if(this.getBBox().width< 0.85*(2*d.r) && this.getBBox().height<2*d.r) {
                                    return d.children ? " " :  d.name;
                                }
                                else {
                                    return "";
                                }
                            });
                    }
                    setTimeout(chart_text_timeout,that.transitions.duration());

                    chart_text1
                        .attr({
                            "text-anchor":"middle",
                            "fill": function(d) {
                                if(that.color_mode === "shade" && !d.children && !options.label_color) {
                                    var color_value = that.k.__proto__._colourBrightness(d.color);
                                    if(color_value === "light") {
                                        return "black";
                                    } else {
                                        return "white";
                                    }
                                }
                                return that.label_color;
                            },
                            "pointer-events": "none"
                        })
                        .style({
                            "font-family": that.label_family,
                            "font-weight": that.label_weight,
                            "font-size": that.label_size + "px"
                        })
                        .text("")

                    function label_timeout() {
                        chart_text1.text(function (d) { return d.children ? " " :  that.k.appendUnits(d.weight); })
                            .text(function (d) {
                                if(this.getBBox().width<2*d.r*0.55 && this.getBBox().height<2*d.r*0.55) {
                                    return d.children ? " " :  ((d.weight*100)/that.sum).toFixed(1)+"%"; /*that.k.appendUnits(d.weight);*/
                                }
                                else {
                                    return "";
                                }
                            });
                    }
                    setTimeout(label_timeout,that.transitions.duration());

                    chart_text.exit()
                        .remove();
                    chart_text1.exit()
                        .remove();
                return this;
            },
            clubData : function () {
                var new_data1,data_length = that.data.length;

                if (PykCharts['boolean'](that.clubdata_enable)) {
                    var clubdata_content = [];
                    var k = 0, j, i, new_data = [];
                    if(data_length <= that.clubdata_maximum_nodes) {
                        new_data1 = { "children" : that.data };
                        return new_data1;
                    }
                    if (that.clubdata_always_include_data_points.length!== 0) {
                        var l = that.clubdata_always_include_data_points.length;
                        for (i =0; i<l; i++) {
                            clubdata_content[i] = that.clubdata_always_include_data_points[i];
                        }
                    }
                    for (i=0; i<clubdata_content.length; i++) {
                        for (j=0; j<data_length; j++) {
                            if (clubdata_content[i].toUpperCase() === that.data[j].name.toUpperCase()) {
                                new_data.push(that.data[j]);
                            }
                        }
                    }

                    that.data.sort (function (a,b) { return b.weight - a.weight;});
                    while (new_data.length < that.clubdata_maximum_nodes-1) {
                        for(i=0;i<clubdata_content.length;i++) {
                            if(that.data[k].name.toUpperCase() === clubdata_content[i].toUpperCase()) {
                                k++;
                            }
                        }
                        new_data.push(that.data[k]);
                        k++;
                    }
                    var sum_others = 0;
                    for(j=k; j<data_length; j++) {
                        for (i=0; i<new_data.length && j<that.data.length; i++) {
                            if(that.data[j].name.toUpperCase() === new_data[i].name.toUpperCase()) {
                                sum_others+=0;
                                j++;
                                i = -1;
                            }
                        }
                        if(j<that.data.length) {
                            sum_others += that.data[j].weight;
                        }
                    }
                    var f = function (a,b) {return b.weight- a.weight;};
                    while (new_data.length > that.clubdata_maximum_nodes) {
                        new_data.sort(f);
                        var a = new_data.pop();
                    }

                    var others_Slice = {"name": that.clubdata_text,"weight": sum_others, "color": that.clubData_color,"tooltip": that.clubData_tooltipText,"highlight":false};

                    if (new_data.length < that.clubdata_maximum_nodes) {
                        new_data.push(others_Slice);

                    }
                    new_data.sort(function (a,b) {
                        return a.weight - b.weight;
                    })

                    new_data1 = {"children": new_data};
                    that.map1 = new_data1.children.map(function (d) { return d.weight;});
                }
                else {
                    that.data.sort(function (a,b) {
                        return a.weight - b.weight;
                    })
                    new_data1 = { "children" : that.data };
                }
                return new_data1;
            }
        };
        return optional;
    };
};

PykCharts.oneD.funnel = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'oneDimensionalCharts');
        that.chart_height = options.chart_height ? options.chart_height : that.chart_width;
        var optional = options.optional,
            functionality = theme.oneDimensionalCharts;
        that.funnel_rect_width =  options.funnel_rect_width   ? options.funnel_rect_width : functionality.funnel_rect_width;
        that.funnel_rect_height = options.funnel_rect_height  ? options.funnel_rect_height : functionality.funnel_rect_height;
        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width)
            .validatingDataType(that.funnel_rect_width,"funnel_rect_width",functionality.funnel_rect_width)
            .validatingDataType(that.funnel_rect_height,"funnel_rect_height",functionality.funnel_rect_height);

        try {
            if(that.funnel_rect_width >= that.chart_width) {
                throw "funnel_rect_width";
            }
        }
        catch (e) {
            that.funnel_rect_width  = functionality.funnel_rect_width;
            console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(Invalid value for attribute \"funnel_rect_width\")  Visit www.pykcharts.com/errors#warning_19");
        }

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            that.render();
        };
        if (PykCharts['boolean'](options.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }

    };
    this.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("oned",data);
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.optionalFeatures()
                    .createChart()
                    .label()
                    .ticks();
        };
        if (PykCharts['boolean'](options.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function () {
        var that = this;
        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg";
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);

        if(that.mode === "default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"funnel")
                .emptyDiv(that.selector)
                .subtitle();
        }
        that.k.tooltip();
        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"funnel")
                .emptyDiv(that.selector);

            that.new_data = that.data;
        }
        if(that.mode === "default") {
            that.optionalFeatures();
        }
        that.optionalFeatures().svgContainer(container_id)
            .createChart()
            .label()
            .ticks();
        if(that.mode === "default") {
            that.k.liveData(that)
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();
        }

        var add_extra_width = 0;
            setTimeout(function () {
                if(that.ticks_text_width.length) {
                    add_extra_width = d3.max(that.ticks_text_width,function(d){
                            return d;
                        });
                }
                that.k.exportSVG(that,"#"+container_id,"funnel",undefined,undefined,add_extra_width)
            },that.transitions.duration());

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    this.funnelLayout = function (){
        var that = this;
        var data,
            size,
            mouth,
            sort_data,
            coordinates;

        var funnel = {
            data: function(d){
                if (d.length===0){
                } else {
                    data = d;
                }
                return this;
            },
            size: function(s){
                if (s.length!==2){
                } else {
                    size = s;
                }
                return this;
            },
            mouth: function(m){
                if (m.length!==2){
                } else {
                    mouth = m;
                }
                return this;
            },
            coordinates: function(){
                var w = size[0],
                    h = size[1],
                    rw = mouth[0], //rect width
                    rh = mouth[1], //rect height
                    tw = (w - rw)/2, //triangle width
                    th = h - rh, //triangle height
                    height1=0,
                    height2=0,
                    height3=0,
                    merge = 0,
                    coordinates = [],
                    ratio = tw/th,
                    area_of_trapezium = (w + rw) / 2 * th,
                    area_of_rectangle = rw * rh,
                    total_area = area_of_trapezium + area_of_rectangle,
                    percent_of_rectangle = area_of_rectangle / total_area * 100;
                for (var i=data.length-1; i>=0; i--){
                    var selectedPercentValues = that.percentageValues(data)[i];
                    if (percent_of_rectangle>=selectedPercentValues){
                        height3 = selectedPercentValues / percent_of_rectangle * rh;
                        height1 = h - height3;
                        if (i===data.length-1){
                            coordinates[i] = {"values":[{"x":(w-rw)/2,"y":height1},{"x":(w-rw)/2,"y":h},{"x":((w-rw)/2)+rw,"y":h},{"x":((w-rw)/2)+rw,"y":height1}]};
                        }else{
                            coordinates[i] = {"values":[{"x":(w-rw)/2,"y":height1},coordinates[i+1].values[0],coordinates[i+1].values[3],{"x":((w-rw)/2)+rw,"y":height1}]};
                        }
                    }else{
                        var area_of_element = ((selectedPercentValues)/100 * total_area) - area_of_rectangle,
                            a = 2 * ratio,
                            b = 2 * rw,
                            c = 2 * area_of_element;
                        height2 = (-b + Math.sqrt(Math.pow(b,2) - (4 * a * -c))) / (2 * a);
                        height1 = h - height2 - rh;
                        var base = 2*(ratio * height2)+rw,
                        xwidth = (w-base)/2;

                        if(merge===0){
                            if (i===data.length-1){
                                coordinates[i] = {"values":[{"x":xwidth,"y":height1},{"x":(w-rw)/2,"y":th},{"x":(w-rw)/2,"y":h},{"x":((w-rw)/2)+rw,"y":h},{"x":((w-rw)/2)+rw,"y":th},{"x":base+xwidth,"y":height1}]};
                            }else{
                                coordinates[i] = {"values":[{"x":xwidth,"y":height1},{"x":(w-rw)/2,"y":th},coordinates[i+1].values[0],coordinates[i+1].values[3],{"x":((w-rw)/2)+rw,"y":th},{"x":base+xwidth,"y":height1}]};
                            }
                        }
                        else{
                            var coindex;
                            if(coordinates[i+1].values.length===6){
                                coindex = 5;
                            }else{
                                coindex = 3;
                            }
                            coordinates[i] = {"values":[{"x":xwidth,"y":height1},coordinates[i+1].values[0],coordinates[i+1].values[coindex],{"x":base+xwidth,"y":height1}]};
                        }
                        merge = 1;
                    }
                }

                return coordinates;
            }
        };
        return funnel;
    };

   this.percentageValues = function (data){
        var that = this;
        var percentValues = data.map(function (d){
            var weight_max = d3.max(data, function (d) {
                return d.weight;
            })
            return d.weight/weight_max*100;
        });
        percentValues.sort(function(a,b){
            return b-a;
        });
        return percentValues;
    };

    this.optionalFeatures = function () {

        var optional = {
            svgContainer :function (container_id) {
                that.svgContainer = d3.select(options.selector)
                    .append('svg')
                    .attr({
                        "width": that.chart_width + "px",
                        "height": that.chart_height + "px",
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer PykCharts-oneD"
                    });

                that.group = that.svgContainer.append("g")
                    .attr("id","funnel");

                return this;
            },
            createChart: function () {
                var border = new PykCharts.Configuration.border(that);
                that.new_data = that.data.sort(function(a,b) {
                    return b.weight-a.weight;
                })
                if(that.color_mode === "shade") {
                    shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                    that.new_data.forEach(function (d,i) {
                        d.color = shade_array[i];
                    })
                }
                that.per_values = that.percentageValues(that.new_data);
                that.funnel = that.funnelLayout()
                                .data(that.new_data)
                                .size([that.chart_width,that.chart_height])
                                .mouth([that.funnel_rect_width,that.funnel_rect_height]);

                that.coordinates = that.funnel.coordinates();
                var line = d3.svg.line()
                                .interpolate('linear-closed')
                                .x(function(d,i) { return d.x; })
                                .y(function(d,i) { return d.y; });

                that.chart_data = that.group.selectAll('.fun-path')
                                .data(that.coordinates);
                var a = [{x:0,y:0},{x:that.chart_width,y:0},{x:0,y:0},{x:that.chart_width,y:0},{x:0,y:0},{x:that.chart_width,y:0}];
                that.chart_data.enter()
                    .append('path')
                    .attr("class", "fun-path")

                that.chart_data
                    .attr({
                        "class": "fun-path",
                        'd': function(d){ return line(a); },
                        "fill": function (d,i) {
                            d.color = that.new_data[i].color;
                            return that.fillChart.selectColor(that.new_data[i]);
                        },
                        "fill-opacity": 1,
                        "data-fill-opacity":function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "stroke": border.color(),
                        "stroke-width": border.width(),
                        "stroke-dasharray": border.style(),
                        "stroke-opacity": 1,
                        "data-id": function (d,i) {
                            return that.new_data[i].name;
                        }
                    })
                    .on({
                        "mouseover": function (d,i) {
                            if(that.mode === "default") {
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlight(options.selector +" "+".fun-path",this);
                                }
                                tooltip = that.data[i].tooltip || "<table><tr><th colspan='2' class='tooltip-heading'>"+that.new_data[i].name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(that.new_data[i].weight)+"<td class='tooltip-right-content'>("+that.per_values[i].toFixed(1)+"%) </tr></table>";
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(tooltip);
                            }
                        },
                        "mouseout": function (d) {
                            if(that.mode === "default") {
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightHide(options.selector +" "+".fun-path");
                                }
                                that.mouseEvent.tooltipHide(d);
                            }
                        },
                        "mousemove": function (d,i) {
                            if(that.mode === "default") {
                                that.mouseEvent.tooltipPosition(d);
                            }
                        },
                        "click" : function (d,i) {
                            if(PykCharts['boolean'](options.click_enable)){
                               that.addEvents(that.new_data[i].name, d3.select(this).attr("data-id"));
                            }
                        }
                    })
                    .transition()
                    .duration(that.transitions.duration())
                    .attr('d',function(d){ return line(d.values); });

               that.chart_data.exit()
                   .remove();

                return this;
            },
            label : function () {
                that.chart_text = that.group.selectAll("text")
                    .data(that.coordinates)

                    that.chart_text.enter()
                        .append("text")

                    that.chart_text.attr({
                        "y": function (d,i) {
                            if(d.values.length===4){
                                return (((d.values[0].y-d.values[1].y)/2)+d.values[1].y) + 5;
                            } else {
                                return (((d.values[0].y-d.values[2].y)/2)+d.values[2].y) + 5;
                            }
                        },
                        "x": function (d,i) { return that.chart_width/2;}
                    });

                    that.chart_text.text("");
                    function chart_text_timeout(){
                        that.chart_text.text(function (d,i) {
                                return that.per_values[i].toFixed(1) + "%";
                            })
                            .attr({
                                "text-anchor": "middle",
                                "pointer-events": "none",
                                "fill": function(d) {
                                    if(that.color_mode === "shade" && !options.label_color) {
                                        var color_value = that.k.__proto__._colourBrightness(d.color);
                                        if(color_value === "light") {
                                            return "black";
                                        } else {
                                            return "white";
                                        }
                                    }
                                    return that.label_color;
                                }
                            })
                            .style({
                                "font-weight": that.label_weight,
                                "font-size": that.label_size + "px",
                                "font-family": that.label_family
                            })
                            .text(function (d,i) {
                                if(this.getBBox().width<(d.values[3].x - d.values[1].x) && this.getBBox().height < (d.values[2].y - d.values[0].y)) {
                                    return that.per_values[i].toFixed(1) + "%";
                                }
                                else {
                                    return "";
                                }
                            });
                    }
                    setTimeout(chart_text_timeout,that.transitions.duration());

                    that.chart_text.exit()
                         .remove();
                return this;
            },
            ticks : function () {
                if(PykCharts['boolean'](that.pointer_overflow_enable)) {
                    that.svgContainer.style("overflow","visible");
                }

                var w =[];
                that.ticks_text_width = [];
                    var tick_label = that.group.selectAll(".ticks_label")
                                        .data(that.coordinates);

                    tick_label.attr("class","ticks_label");

                    tick_label.enter()
                        .append("text")
                        .attr({
                            "x": 0,
                            "y": 0
                        });

                    var x,y;

                    tick_label.attr("transform",function (d) {
                        if (d.values.length === 4) {
                            x = ((d.values[3].x + d.values[2].x)/2 ) + 17;
                            y = ((d.values[0].y + d.values[2].y)/2) + 5;
                        } else {
                            x = (d.values[4].x) + 17;
                            y = (d.values[4].y) + 5;
                        }
                        return "translate(" + x + "," + y + ")";});

                    tick_label.text("");
                    function tick_timeout() {
                        tick_label.text(function (d,i) { return that.data[i].name; })
                            .text(function (d,i) {
                                w[i] = this.getBBox().height;
                                that.ticks_text_width.push(this.getBBox().width);
                                if (this.getBBox().height < (d.values[2].y - d.values[0].y)) {
                                    return that.data[i].name;
                                }
                                else {
                                    return "";
                                }
                            })
                            .style({
                                "font-size": that.pointer_size + "px",
                                "text-anchor":"start",
                                "fill": that.pointer_color,
                                "pointer-events":"none",
                                "font-family": that.pointer_family,
                                "font-weight":that.pointer_weight
                            })
                    }

                    setTimeout(tick_timeout,that.transitions.duration());

                    tick_label.exit().remove();
                    var tick_line = that.group.selectAll(".funnel-ticks")
                        .data(that.coordinates);

                    tick_line.enter()
                        .append("line")
                        .attr("class", "funnel-ticks");

                    tick_line.attr({
                        "x1": function (d,i) {
                           if (d.values.length === 4) {
                                return ((d.values[3].x + d.values[2].x)/2 );
                           } else {
                                return (d.values[4].x);
                           }
                        },
                        "y1": function (d,i) {
                            if (d.values.length === 4) {
                                return ((d.values[0].y + d.values[2].y)/2);
                           } else {
                                return (d.values[4].y);
                           }
                        },
                        "x2": function (d, i) {
                            if (d.values.length === 4) {
                                return ((d.values[3].x + d.values[2].x)/2 );
                           } else {
                                return (d.values[4].x);
                           }
                        },
                        "y2": function (d, i) {
                            if (d.values.length === 4) {
                                return ((d.values[0].y + d.values[2].y)/2);
                           } else {
                                return (d.values[4].y);
                           }
                        },
                        "stroke-width": that.pointer_thickness + "px",
                        "stroke": that.pointer_color
                    });

                    function tick_line_timeout(){
                        tick_line.attr("x2", function (d, i) {
                            if(( d.values[2].y - d.values[0].y) > w[i]) {
                                if (d.values.length === 4) {
                                    return ((d.values[3].x + d.values[2].x)/2 ) + 12;
                                } else {
                                    return ((d.values[4].x) + 12);
                                }
                            } else {
                                if (d.values.length === 4) {
                                    return ((d.values[3].x + d.values[2].x)/2 );
                                } else {
                                    return (d.values[4].x);
                                }
                            }
                        });
                    }

                    setTimeout(tick_line_timeout,that.transitions.duration());

                    tick_line.exit().remove();

                return this;
            }
        };
        return optional;
    };
};

PykCharts.oneD.percentageColumn = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data) {
        var that = this;

        that = new PykCharts.validation.processInputs(that, options, 'oneDimensionalCharts');

        that.chart_height = PykCharts['boolean'](options.chart_height) ? options.chart_height : that.chart_width;
        that.percent_column_rect_width = options.percent_column_rect_width ? options.percent_column_rect_width : theme.oneDimensionalCharts.percent_column_rect_width;

        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width)
            .validatingDataType(that.percent_column_rect_width,"percent_column_rect_width",theme.oneDimensionalCharts.percent_column_rect_width);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.percent_column_rect_width > 100) {
            that.percent_column_rect_width = 100;
        }

        that.percent_column_rect_width = that.k.__proto__._radiusCalculation(that.percent_column_rect_width,"percentageBar") * 2;

        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
    this.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("oned",data);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.optionalFeatures()
                    .clubData()
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures()
                    .createChart()
                    .label()
                    .ticks();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function () {
        var that = this;
        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg";
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);

        if(that.mode === "default") {
            that.k.title()
                    .backgroundColor(that)
                    .export(that,"#"+container_id,"percentageColumn")
                    .emptyDiv(that.selector)
                    .subtitle();
        }
        if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"percentageColumn")
                    .emptyDiv(that.selector);

            that.new_data = that.data;
        }

        that.k.tooltip();

        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        if(that.mode === "default") {
            percent_column = that.optionalFeatures()
                            .clubData();
        }
        if(that.color_mode === "shade") {
            shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
            that.new_data.forEach(function (d,i) {
                d.color = shade_array[i];
            })
        }
        that.optionalFeatures().svgContainer(container_id)
            .createChart()
            .label()
            .ticks();
        if(that.mode === "default") {
            that.k.liveData(that)
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();
        }

        var add_extra_width = 0;

        setTimeout(function () {
            if(that.ticks_text_width.length) {
                add_extra_width = d3.max(that.ticks_text_width,function(d){
                    return d;
                });
            }
            that.k.exportSVG(that,"#"+container_id,"percentageColumn",undefined,undefined,(add_extra_width+15))
            if(!PykCharts['boolean'](options.chart_width)) {
                that.chart_width = that.percent_column_rect_width + 10 + add_extra_width;
                that.svgContainer.attr("viewBox","0 0 " + that.chart_width + " " + that.chart_height);
            }
            var resize = that.k.resize(that.svgContainer);
            that.k.__proto__._ready(resize);
        },that.transitions.duration());


        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });

    };
    this.optionalFeatures = function () {
        var optional = {
            createChart: function () {
                var border = new PykCharts.Configuration.border(that);
                var arr = that.new_data.map(function (d) {
                    return d.weight;
                });
                arr.sum = function () {
                    var sum = 0;
                    for(var i = 0 ; i < this.length; ++i) {
                        sum += this[i];
                    }
                    return sum;
                };

                var sum = arr.sum();
                that.new_data.forEach(function (d, i) {
                    this[i].percentValue= d.weight * 100 / sum;
                }, that.new_data);
               // that.new_data.sort(function (a,b) { return b.weight - a.weight; })
                that.chart_data = that.group.selectAll('.per-rect')
                    .data(that.new_data)

                that.chart_data.enter()
                    .append('rect')
                    .attr("class","per-rect")

                that.chart_data.attr({
                    'x': 0,
                    'y': function (d, i) {
                        if (i === 0) {
                            return 0;
                        } else {
                            var sum = 0,
                                subset = that.new_data.slice(0,i);

                            subset.forEach(function(d, i){
                                sum += this[i].percentValue;
                            },subset);

                            return sum * that.chart_height / 100;
                        }
                    },
                    'width': that.percent_column_rect_width,
                    'height': 0,
                    "fill": function (d) {
                        return that.fillChart.selectColor(d);
                    },
                    "fill-opacity": 1,
                    "data-fill-opacity": function () {
                        return d3.select(this).attr("fill-opacity");
                    },
                    "stroke": border.color(),
                    "stroke-width": border.width(),
                    "stroke-dasharray": border.style(),
                    "data-id" : function (d,i) {
                        return d.name;
                    }
                })
                .on({
                    "mouseover": function (d,i) {
                        if(that.mode === "default") {
                            d.tooltip=d.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+d.name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(d.weight)+"<td class='tooltip-right-content'>("+d.percentValue.toFixed(1)+"%)</tr></table>"
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlight(that.selector+" "+".per-rect",this);
                            }
                            that.mouseEvent.tooltipPosition(d);
                            that.mouseEvent.tooltipTextShow(d.tooltip);
                        }
                    },
                    "mouseout": function (d) {
                        if(that.mode === "default") {
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlightHide(that.selector+" "+".per-rect");
                            }
                            that.mouseEvent.tooltipHide(d);
                        }
                    },
                    "mousemove": function (d,i) {
                        if(that.mode === "default") {
                            that.mouseEvent.tooltipPosition(d);
                        }
                    },
                    "click" :  function (d,i) {
                        if(PykCharts['boolean'](that.click_enable)){
                           that.addEvents(d.name, d3.select(this).attr("data-id"));
                        }
                    }
                })
                .transition()
                .duration(that.transitions.duration())
                .attr('height', function (d) {
                    return d.percentValue * that.chart_height / 100;
                });
                that.chart_data.exit()
                    .remove();

                return this;
            },
            svgContainer :function (container_id) {

                that.svgContainer = d3.select(that.selector)
                    .append('svg')
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer PykCharts-oneD"
                    });

                    that.group = that.svgContainer.append("g")
                        .attr("id","percentageColumn");

                return this;
            },
            label : function () {
                    that.chart_text = that.group.selectAll(".per-text")
                        .data(that.new_data);
                    var sum = 0;
                    that.chart_text.enter()
                        .append("text")
                        .attr("class","per-text");

                    that.chart_text.attr({
                        "class": "per-text",
                        "x": (that.percent_column_rect_width/2 ),
                        "y": function (d,i) {
                            sum = sum + d.percentValue;
                            if (i===0) {
                                return (0 + (sum * that.chart_height / 100))/2+5;
                            } else {
                                return (((sum - d.percentValue) * that.chart_height/100)+(sum * that.chart_height / 100))/2+5;
                            }
                        }
                    });
                    sum = 0;

                    that.chart_text.text("")
                        .attr({
                            "fill": function(d) {
                                if(that.color_mode === "shade" && !options.label_color) {
                                    var color_value = that.k.__proto__._colourBrightness(d.color);
                                    if(color_value === "light") {
                                        return "black";
                                    } else {
                                        return "white";
                                    }
                                }
                                return that.label_color;
                            },
                            "text-anchor": "middle",
                            "pointer-events": "none"
                        })
                        .style({
                            "font-size": that.label_size + "px",
                            "font-weight": that.label_weight,
                            "font-family": that.label_family
                        });
                        function chart_text_timeout(){
                            that.chart_text.text(function (d) {
                                return d.percentValue.toFixed(1)+"%";
                            })
                            .text(function (d) {
                                if(this.getBBox().width < (0.92*that.percent_column_rect_width) && this.getBBox().height < (d.percentValue * that.chart_height / 100)) {
                                    return d.percentValue.toFixed(1)+"%";
                                }else {
                                    return "";
                                }
                            });
                        }
                        setTimeout(chart_text_timeout, that.transitions.duration());

                    that.chart_text.exit()
                        .remove();
                return this;
            },
            ticks : function () {
                if(PykCharts['boolean'](that.pointer_overflow_enable)) {
                    that.svgContainer.style("overflow","visible");
                }
                    var sum = 0, sum1 = 0;

                    var x, y, w = [];
                    sum = 0;
                    that.ticks_text_width = [];

                    var tick_line = that.group.selectAll(".per-ticks")
                        .data(that.new_data);

                    tick_line.enter()
                        .append("line")
                        .attr("class", "per-ticks");

                    var tick_label = that.group.selectAll(".ticks_label")
                                        .data(that.new_data);

                    tick_label.enter()
                        .append("text")
                        .attr("class", "ticks_label")

                    tick_label.attr("class", "ticks_label")
                        .attr("transform",function (d) {
                            sum = sum + d.percentValue
                            x = (that.percent_column_rect_width) + 15;
                            y = (((sum - d.percentValue) * that.chart_height/100)+(sum * that.chart_height / 100))/2 + 5;

                            return "translate(" + x + "," + y + ")";
                        });

                    tick_label.text(function (d) {
                            return "";
                        })
                        .attr({
                            "font-size": that.pointer_size,
                            "text-anchor": "start",
                            "fill": that.pointer_color,
                            "font-family": that.pointer_family,
                            "font-weight": that.pointer_weight,
                            "pointer-events": "none"
                        });

                        function tick_label_timeout() {
                            tick_label.text(function (d) {
                                return d.name;
                            })
                            .text(function (d,i) {
                                w[i] = this.getBBox().height;
                                that.ticks_text_width[i] = this.getBBox().width;
                                if (this.getBBox().height < (d.percentValue * that.chart_height / 100)) {
                                    return d.name;
                                }
                                else {
                                    return "";
                                }
                            });

                            sum = 0;
                            tick_line
                                .attr({
                                    "x1": function (d,i) {
                                        return that.percent_column_rect_width;
                                    },
                                    "y1": function (d,i) {
                                        sum = sum + d.percentValue;
                                        if (i===0){
                                            return (0 + (sum * that.chart_height / 100))/2;
                                        }else {
                                            return (((sum - d.percentValue) * that.chart_height/100)+(sum * that.chart_height / 100))/2;
                                        }
                                    },
                                    "x2": function (d, i) {
                                         return (that.percent_column_rect_width);
                                    },
                                    "y2": function (d,i) {
                                        sum1 = sum1 + d.percentValue;
                                        if (i===0){
                                            return (0 + (sum1 * that.chart_height / 100))/2;
                                        }else {
                                            return (((sum1 - d.percentValue) * that.chart_height/100)+(sum1 * that.chart_height / 100))/2;
                                        }
                                    },
                                    "stroke-width": that.pointer_thickness + "px",
                                    "stroke": that.pointer_color,
                                    "x2": function (d, i) {
                                        if((d.percentValue * that.chart_height / 100) > w[i]) {
                                            return (that.percent_column_rect_width) + 10;
                                        } else {
                                            return (that.percent_column_rect_width) ;
                                        }
                                    }
                                });
                        }
                        setTimeout(tick_label_timeout,that.transitions.duration());

                    tick_label.exit().remove();

                    tick_line.exit().remove();

                return this;
            },
            clubData : function () {

                if(PykCharts['boolean'](that.clubdata_enable)) {
                    var clubdata_content = [];
                    if(that.clubdata_always_include_data_points.length!== 0){
                        var l = that.clubdata_always_include_data_points.length;
                        for(i=0; i < l; i++){
                            clubdata_content[i] = that.clubdata_always_include_data_points[i];
                        }
                    }
                    var new_data1 = [];
                    for(i=0;i<clubdata_content.length;i++){
                        for(j=0;j<that.data.length;j++){
                            if(clubdata_content[i].toUpperCase() === that.data[j].name.toUpperCase()){
                                new_data1.push(that.data[j]);
                            }
                        }
                    }
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    var k = 0;

                    while(new_data1.length<that.clubdata_maximum_nodes-1){
                        for(i=0;i<clubdata_content.length;i++){
                            if(that.data[k].name.toUpperCase() === clubdata_content[i].toUpperCase()){
                                k++;
                            }
                        }
                        new_data1.push(that.data[k]);
                        k++;
                    }
                    var sum_others = 0;
                    for(j=k; j < that.data.length; j++){
                        for(i=0; i<new_data1.length && j<that.data.length; i++){
                            if(that.data[j].name.toUpperCase() === new_data1[i].name.toUpperCase()){
                                sum_others +=0;
                                j++;
                                i = -1;
                            }
                        }
                        if(j < that.data.length){
                            sum_others += that.data[j].weight;
                        }
                    }
                    var sortfunc = function (a,b) { return b.weight - a.weight; };

                    while(new_data1.length > that.clubdata_maximum_nodes){
                        new_data1.sort(sortfunc);
                        var a=new_data1.pop();
                    }
                    var others_Slice = { "name":that.clubdata_text, "weight": sum_others, /*"color": that.clubData_color,*/ "tooltip": that.clubdata_tooltip };
                    new_data1.sort(function(a,b){
                        return b.weight - a.weight;
                    })
                    if(new_data1.length < that.clubdata_maximum_nodes){
                        new_data1.push(others_Slice);
                    }
                    that.new_data = new_data1;
                }
                else {
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    that.new_data = that.data;
                }
                return this;
            }
        };
        return optional;
    };
};

PykCharts.oneD.percentageBar = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data) {
        var that = this;

        that = new PykCharts.validation.processInputs(that, options,'oneDimensionalCharts');
        that.percent_row_rect_height = options.percent_row_rect_height ? options.percent_row_rect_height : theme.oneDimensionalCharts.percent_row_rect_height;
        if(that.percent_row_rect_height > 100) {
            that.percent_row_rect_height = 100;
        }

        that.percent_row_rect_height = that.k.__proto__._radiusCalculation(that.percent_row_rect_height) * 2;
        that.chart_height = PykCharts['boolean'](options.chart_height) ? options.chart_height : (that.percent_row_rect_height + 10 + that.pointer_size);

        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width/2)
            .validatingDataType(that.percent_row_rect_height,"percent_row_rect_height",theme.oneDimensionalCharts.percent_row_rect_height);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.render();
        }
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
    this.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {

            that.data = that.k.__proto__._groupBy("oned",data);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.optionalFeatures()
                    .clubData()
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures()
                    .createChart()
                    .label()
                    .ticks();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function () {
        var that = this;
        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg";
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);

        if(that.mode === "default") {

            that.k.title()
                    .backgroundColor(that)
                    .export(that,"#"+container_id,"percentageBar")
                    .emptyDiv(that.selector)
                    .subtitle();
        }
        if(that.mode === "infographics") {
            that.k.backgroundColor(that)
            .export(that,"#"+container_id,"percentageBar").emptyDiv(that.selector);
            that.new_data = that.data;
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
        }

        that.k.tooltip();

        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        if(that.mode === "default") {

            percent_bar = that.optionalFeatures()
                            .clubData();
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
        }

        that.optionalFeatures().svgContainer(container_id)
            .createChart()
            .label()
            .ticks();
        if(that.mode === "default") {
            that.k.liveData(that)
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();
        }

        var add_extra_height = 0;

        setTimeout(function () {
            if(that.ticks_text_height) {
                add_extra_height = that.ticks_text_height + 10;
            }

            that.k.exportSVG(that,"#"+container_id,"percentageBar",undefined,undefined,0,add_extra_height);
        },that.transitions.duration());

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };
    this.optionalFeatures = function () {
        var optional = {
            createChart: function () {
                var border = new PykCharts.Configuration.border(that);
                var arr = that.new_data.map(function (d) {
                    return d.weight;
                });
                arr.sum = function () {
                    var sum = 0;
                    for(var i = 0 ; i < this.length; ++i) {
                        sum += this[i];
                    }
                    return sum;
                };

                var sum = arr.sum();
                that.new_data.forEach(function (d, i) {
                    this[i].percentValue= d.weight * 100 / sum;
                }, that.new_data);

               // that.new_data.sort(function (a,b) { return b.weight - a.weight; })
                that.chart_data = that.group.selectAll('.per-rect')
                    .data(that.new_data)

                that.chart_data.enter()
                    .append('rect')
                    .attr("class","per-rect")

                that.chart_data.attr({
                    'x': 0,
                    'x': function (d, i) {
                        if (i === 0) {
                            return 0;
                        } else {
                            var sum = 0,
                                subset = that.new_data.slice(0,i);

                            subset.forEach(function(d, i){
                                sum += this[i].percentValue;
                            },subset);

                            return sum * that.chart_width / 100;
                        }
                    },
                    "width": 0,
                    'height': function (d) {
                        return that.percent_row_rect_height;
                    },
                    "fill": function (d) {
                        return that.fillChart.selectColor(d);
                    },
                    "fill-opacity": 1,
                    "data-fill-opacity": function () {
                        return d3.select(this).attr("fill-opacity");
                    },
                    "stroke": border.color(),
                    "stroke-width": border.width(),
                    "stroke-dasharray": border.style(),
                    "data-id": function (d,i) {
                        return d.name;
                    }
                })
                .on({
                    "mouseover": function (d,i) {
                        if(that.mode === "default") {
                            d.tooltip=d.tooltip||"<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+d.name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(d.weight)+"<td class='tooltip-right-content'>("+d.percentValue.toFixed(1)+"%)</tr></table>"
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlight(that.selector+" "+".per-rect",this);
                            }
                            that.mouseEvent.tooltipPosition(d);
                            that.mouseEvent.tooltipTextShow(d.tooltip);
                        }
                    },
                    "mouseout": function (d) {
                        if(that.mode === "default") {
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlightHide(that.selector+" "+".per-rect");
                            }
                            that.mouseEvent.tooltipHide(d);
                        }
                    },
                    "mousemove": function (d,i) {
                        if(that.mode === "default") {
                            that.mouseEvent.tooltipPosition(d);
                        }
                    },
                    "click" : function (d,i) {
                        if(PykCharts['boolean'](that.click_enable)){
                           that.addEvents(d.name, d3.select(this).attr("data-id"));
                        }
                    }
                })
                .transition()
                .duration(that.transitions.duration())
                .attr('width', function (d) {
                    return d.percentValue * that.chart_width / 100;
                });

                that.chart_data.exit()
                    .remove();

                return this;
            },
            svgContainer :function (container_id) {
                that.svgContainer = d3.select(that.selector)
                    .append('svg')
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer PykCharts-oneD"
                    });

                    that.group = that.svgContainer.append("g")
                        .attr("id","percentageBar");

                return this;
            },
            label : function () {
                    that.chart_text = that.group.selectAll(".per-text")
                        .data(that.new_data);
                    var sum = 0;
                    that.chart_text.enter()
                        .append("text")
                        .attr("class","per-text");

                    that.chart_text.attr({
                        "class": "per-text",
                        "y": (that.percent_row_rect_height/2) + 5,
                        "x": function (d,i) {
                            sum = sum + d.percentValue;
                            if (i===0) {
                                return (0 + (sum * that.chart_width / 100))/2;
                            } else {
                                return (((sum - d.percentValue) * that.chart_width/100)+(sum * that.chart_width / 100))/2;
                            }
                        }
                    });
                    sum = 0;

                    that.chart_text.text("")
                        .attr({
                            "fill": function(d) {
                                if(that.color_mode === "shade" && !options.label_color) {
                                    var color_value = that.k.__proto__._colourBrightness(d.color);
                                    if(color_value === "light") {
                                        return "black";
                                    } else {
                                        return "white";
                                    }
                                }
                                return that.label_color;
                            },
                            "text-anchor": "middle",
                            "pointer-events": "none"
                        })
                        .style({
                            "font-size": that.label_size + "px",
                            "font-weight": that.label_weight,
                            "font-family": that.label_family
                        });

                        function chart_text_timeout(){
                            that.chart_text.text(function (d) { return d.percentValue.toFixed(1)+"%"; })
                                .text(function (d) {
                                    if(this.getBBox().width < 0.92*(d.percentValue * that.chart_width / 100) && this.getBBox().height < that.percent_row_rect_height) {
                                        return d.percentValue.toFixed(1)+"%"
                                    }else {
                                        return "";
                                    }
                                });
                        }
                        setTimeout(chart_text_timeout, that.transitions.duration());


                    that.chart_text.exit()
                        .remove();
                return this;
            },
            ticks : function () {
                if(PykCharts['boolean'](that.pointer_overflow_enable)) {
                    that.svgContainer.style("overflow","visible");
                }
                    var sum = 0, sum1 = 0;

                    var x, y, w = [];
                    that.ticks_text_height;
                    sum = 0;

                    var tick_line = that.group.selectAll(".per-ticks")
                        .data(that.new_data);

                    tick_line.enter()
                        .append("line")
                        .attr("class", "per-ticks");

                    var tick_label = that.group.selectAll(".ticks_label")
                                        .data(that.new_data);

                    tick_label.enter()
                        .append("text")
                        .attr("class", "ticks_label")

                    tick_label.attr("class", "ticks_label")
                        .attr("transform",function (d) {
                            sum = sum + d.percentValue
                            y = ((that.percent_row_rect_height) + that.pointer_size) + 10;
                            x = (((sum - d.percentValue) * that.chart_width/100)+(sum * that.chart_width / 100))/2;

                            return "translate(" + x + "," + y + ")";
                        });

                    tick_label.text(function (d) {
                            return "";
                        })
                        .attr({
                            "font-size": that.pointer_size,
                            "text-anchor": "middle",
                            "fill": that.pointer_color,
                            "font-family": that.pointer_family,
                            "font-weight": that.pointer_weight,
                            "pointer-events": "none"
                        });

                        function tick_label_timeout() {
                            tick_label.text(function (d) {
                                return d.name;
                            })
                            .text(function (d,i) {
                                w[i] = this.getBBox().width;
                                that.ticks_text_height = this.getBBox().height;
                                if (this.getBBox().width < (d.percentValue * that.chart_width / 100)) {
                                    return d.name;
                                }
                                else {
                                    return "";
                                }
                            });

                            sum = 0;
                            tick_line.attr({
                                "y1": function (d,i) {
                                    return that.percent_row_rect_height;
                                },
                                "x1": function (d,i) {
                                    sum = sum + d.percentValue;
                                    if (i===0){
                                        return (0 + (sum * that.chart_width / 100))/2;
                                    }else {
                                        return (((sum - d.percentValue) * that.chart_width/100)+(sum * that.chart_width / 100))/2;
                                    }
                                },
                                "y2": function (d, i) {
                                     return (that.percent_row_rect_height);
                                },
                                "x2": function (d,i) {
                                    sum1 = sum1 + d.percentValue;
                                    if (i===0){
                                        return (0 + (sum1 * that.chart_width / 100))/2;
                                    }else {
                                        return (((sum1 - d.percentValue) * that.chart_width/100)+(sum1 * that.chart_width / 100))/2;
                                    }
                                },
                                "stroke-width": that.pointer_thickness + "px",
                                "stroke": that.pointer_color,
                                "y2": function (d, i) {
                                    if((d.percentValue * that.chart_width / 100) > w[i]) {
                                        return (that.percent_row_rect_height) + 10;
                                    } else {
                                        return (that.percent_row_rect_height) ;
                                    }
                                }
                            })
                            .style("margin-top","10px");
                        }
                        setTimeout(tick_label_timeout,that.transitions.duration());

                    tick_label.exit().remove();

                    tick_line.exit().remove();

                return this;
            },
            clubData : function () {
                if(PykCharts['boolean'](that.clubdata_enable)) {
                    var clubdata_content = [];
                    if(that.clubdata_always_include_data_points.length!== 0){
                        var l = that.clubdata_always_include_data_points.length;
                        for(i=0; i < l; i++){
                            clubdata_content[i] = that.clubdata_always_include_data_points[i];
                        }
                    }
                    var new_data1 = [];
                    for(i=0;i<clubdata_content.length;i++){
                        for(j=0;j<that.data.length;j++){
                            if(clubdata_content[i].toUpperCase() === that.data[j].name.toUpperCase()){
                                new_data1.push(that.data[j]);
                            }
                        }
                    }
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    var k = 0;

                    while(new_data1.length<that.clubdata_maximum_nodes-1){
                        for(i=0;i<clubdata_content.length;i++){
                            if(that.data[k].name.toUpperCase() === clubdata_content[i].toUpperCase()){
                                k++;
                            }
                        }
                        new_data1.push(that.data[k]);
                        k++;
                    }
                    var sum_others = 0;
                    for(j=k; j < that.data.length; j++){
                        for(i=0; i<new_data1.length && j<that.data.length; i++){
                            if(that.data[j].name.toUpperCase() === new_data1[i].name.toUpperCase()){
                                sum_others +=0;
                                j++;
                                i = -1;
                            }
                        }
                        if(j < that.data.length){
                            sum_others += that.data[j].weight;
                        }
                    }
                    var sortfunc = function (a,b) { return b.weight - a.weight; };

                    while(new_data1.length > that.clubdata_maximum_nodes){
                        new_data1.sort(sortfunc);
                        var a=new_data1.pop();
                    }
                    var others_Slice = { "name":that.clubdata_text, "weight": sum_others,/* "color": that.clubdata_color,*/ "tooltip": that.clubdata_tooltip };
                    new_data1.sort(function(a,b){
                        return b.weight - a.weight;
                    })
                    if(new_data1.length < that.clubdata_maximum_nodes){
                        new_data1.push(others_Slice);
                    }
                    that.new_data = new_data1;
                }
                else {
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    that.new_data = that.data;
                }
                return this;
            }
        };
        return optional;
    };
};

PykCharts.oneD.pie = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function(pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'oneDimensionalCharts');
        if(options.chart_height) {
            that.chart_height = options.chart_height;
            that.calculation = undefined;
        }
        else {
            that.chart_height = that.chart_width;
            that.calculation = "pie";
        }
        that.pie_radius_percent = options.pie_radius_percent ? options.pie_radius_percent : theme.oneDimensionalCharts.pie_radius_percent;

        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width)
            .validatingDataType(that.pie_radius_percent,"pie_radius_percent",theme.oneDimensionalCharts.pie_radius_percent);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        that.innerRadiusPercent = 0;
        that.height_translate = that.chart_height/2;

        if(that.pie_radius_percent > 100) {
            that.pie_radius_percent = 100;
        }

        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);

            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            var pieFunctions = new PykCharts.oneD.pieFunctions(options,that,"pie");
            that.clubdata_enable = that.data.length > that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            pieFunctions.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }

    };
};
PykCharts.oneD.donut = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function(pykquery_data) {

        that = new PykCharts.validation.processInputs(that, options, 'oneDimensionalCharts');
        if(options.chart_height) {
            that.chart_height = options.chart_height;
            that.calculation = undefined;
        }
        else {
            that.chart_height = that.chart_width;
            that.calculation = "pie";
        }

        that.pie_radius_percent = options.donut_radius_percent  ? options.donut_radius_percent : theme.oneDimensionalCharts.donut_radius_percent;
        that.innerRadiusPercent = options.donut_inner_radius_percent  ? options.donut_inner_radius_percent : theme.oneDimensionalCharts.donut_inner_radius_percent;

        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width)
            .validatingDataType(that.pie_radius_percent,"donut_radius_percent",theme.oneDimensionalCharts.donut_radius_percent)
            .validatingDataType(that.innerRadiusPercent,"donut_inner_radius_percent",theme.oneDimensionalCharts.donut_inner_radius_percent)

        if(that.stop) {
            return;
        }

        that.k.storeInitialDivHeight();
        if(that.pie_radius_percent > 100) {
            that.pie_radius_percent = 100;
        }

        if(that.innerRadiusPercent > 100) {
            that.innerRadiusPercent = 100;
        }

        try {
            if(that.innerRadiusPercent >= that.pie_radius_percent) {
                that.innerRadiusPercent = theme.oneDimensionalCharts.donut_inner_radius_percent;
                throw "donut_inner_radius_percent";
            }
        }
        catch(err) {
            that.k.warningHandling(err,"6");
        }

        if(that.stop) {
            return;
        }
        if(that.mode === "default") {
           that.k.loading();
        }
        that.height_translate = that.chart_height/2;
        that.show_total_at_center = options.donut_show_total_at_center ? options.donut_show_total_at_center.toLowerCase() : theme.oneDimensionalCharts.donut_show_total_at_center;
        that.show_total_at_center_size = "donut_show_total_at_center_size" in options ? options.donut_show_total_at_center_size : theme.oneDimensionalCharts.donut_show_total_at_center_size;
        that.show_total_at_center_color = options.donut_show_total_at_center_color ? options.donut_show_total_at_center_color : theme.oneDimensionalCharts.donut_show_total_at_center_color;
        that.show_total_at_center_weight = options.donut_show_total_at_center_weight ? options.donut_show_total_at_center_weight : theme.oneDimensionalCharts.donut_show_total_at_center_weight;
        that.show_total_at_center_family = options.donut_show_total_at_center_family ? options.donut_show_total_at_center_family : theme.oneDimensionalCharts.donut_show_total_at_center_family;

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            var pieFunctions = new PykCharts.oneD.pieFunctions(options,that,"donut");
            that.clubdata_enable = that.data.length > that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            pieFunctions.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};
PykCharts.oneD.electionPie = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function(pykquery_data) {

        that = new PykCharts.validation.processInputs(that, options, 'oneDimensionalCharts');
        if(options.chart_height || options.chart_height === undefined) {
            try {
                if (options.chart_height === undefined) {
                    options.chart_height = "";
                }
                else if (isNaN(options.chart_height)) {
                    options.chart_height = "";
                    throw "chart_height"
                }
            }
            catch (err) {
                that.k.warningHandling(err);
            }
        }
        if(PykCharts["boolean"](options.chart_height)) {
            that.chart_height = options.chart_height;
            that.calculation = undefined;
            that.height_translate = that.chart_height/2;
        } else {
            that.chart_height = that.chart_width/2;
            that.calculation = "pie";
            that.height_translate = that.chart_height;
        }

        that.pie_radius_percent = options.pie_radius_percent ? options.pie_radius_percent : theme.oneDimensionalCharts.pie_radius_percent;

        try {
            if(isNaN(that.pie_radius_percent)) {
                that.pie_radius_percent = theme.oneDimensionalCharts.pie_radius_percent;
                throw "pie_radius_percent"
            }
        }

        catch (err) {
            that.k.warningHandling(err,"1");
        }

        if(that.stop) {
            return;
        }

        that.k.storeInitialDivHeight();
        if(that.pie_radius_percent > 100) {
            that.pie_radius_percent = 100;
        }
        if(that.mode === "default") {
           that.k.loading();
        }
        that.innerRadiusPercent = 0;

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            var pieFunctions = new PykCharts.oneD.pieFunctions(options,that,"election pie");
            that.clubdata_enable = that.data.length > that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            pieFunctions.render();

        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};
PykCharts.oneD.electionDonut = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function(pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'oneDimensionalCharts');
        if(options.chart_height || options.chart_height === undefined) {
            try {
                if (options.chart_height === undefined) {
                    options.chart_height = "";
                }
                else if (isNaN(options.chart_height)) {
                    options.chart_height = "";
                    throw "chart_height"
                }
            }
            catch (err) {
                that.k.warningHandling(err);
            }
        }
        if(PykCharts["boolean"](options.chart_height)) {
            that.chart_height = options.chart_height;
            that.calculation = undefined;
            that.height_translate = that.chart_height/2;
        } else {
            that.chart_height = that.chart_width/2;
            that.calculation = "pie";
            that.height_translate = that.chart_height;
        }

        that.pie_radius_percent = options.donut_radius_percent ? options.donut_radius_percent : theme.oneDimensionalCharts.donut_radius_percent;
        that.innerRadiusPercent = options.donut_inner_radius_percent  && options.donut_inner_radius_percent ? options.donut_inner_radius_percent : theme.oneDimensionalCharts.donut_inner_radius_percent;

        that.k.validator().validatingDataType(that.pie_radius_percent,"donut_radius_percent",theme.oneDimensionalCharts.donut_radius_percent)
            .validatingDataType(that.innerRadiusPercent,"donut_inner_radius_percent",theme.oneDimensionalCharts.donut_inner_radius_percent);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.pie_radius_percent > 100) {
            that.pie_radius_percent = 100;
        }

        if(that.innerRadiusPercent > 100) {
            that.innerRadiusPercent = 100;
        }

        try {
            if(that.innerRadiusPercent >= that.pie_radius_percent) {
                that.innerRadiusPercent = theme.oneDimensionalCharts.donut_inner_radius_percent;
                throw "donut_inner_radius_percent";
            }
        }
        catch(err) {

            that.k.warningHandling(err,"6");
        }

        if(that.stop) {
            return;
        }
        if(that.mode === "default") {
           that.k.loading();
        }
        that.show_total_at_center = options.donut_show_total_at_center ? options.donut_show_total_at_center.toLowerCase() : theme.oneDimensionalCharts.donut_show_total_at_center;
        that.show_total_at_center_size = "donut_show_total_at_center_size" in options ? options.donut_show_total_at_center_size : theme.oneDimensionalCharts.donut_show_total_at_center_size;
        that.show_total_at_center_color = options.donut_show_total_at_center_color ? options.donut_show_total_at_center_color : theme.oneDimensionalCharts.donut_show_total_at_center_color;
        that.show_total_at_center_weight = options.donut_show_total_at_center_weight ? options.donut_show_total_at_center_weight : theme.oneDimensionalCharts.donut_show_total_at_center_weight;
        that.show_total_at_center_family = options.donut_show_total_at_center_family ? options.donut_show_total_at_center_family : theme.oneDimensionalCharts.donut_show_total_at_center_family;

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            var pieFunctions = new PykCharts.oneD.pieFunctions(options,that,"election donut");
            that.clubdata_enable = that.data.length> that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            pieFunctions.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};
PykCharts.oneD.pieFunctions = function (options,chartObject,type) {
    var that = chartObject;
       that.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("oned",data);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data)
                , shade_array = [];
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.new_data = that.optionalFeatures().clubData();
            that.optionalFeatures()
                    .createChart(shade_array)
                    .label()
                    .ticks()
                    .centerLabel();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function() {
        that.count = 1;
        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg"
            , shade_array = [];
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);

        if(that.mode.toLowerCase() === "default") {

            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,type)
                .emptyDiv(that.selector)
                .subtitle();

            that.optionalFeatures().svgContainer(container_id);
            that.new_data = that.optionalFeatures().clubData();

            that.k.createFooter()
                    .lastUpdatedAt()
                    .credits()
                    .dataSource()
                    .tooltip();


            that.optionalFeatures()
                    .set_start_end_angle()
                    .createChart(shade_array)
                    .label()
                    .ticks()
                    .centerLabel();

            that.k.liveData(that);

        } else if(that.mode.toLowerCase() === "infographics") {
            that.new_data = that.data;
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,type)
                    .emptyDiv(that.selector);
            that.optionalFeatures().svgContainer(container_id)
                    .set_start_end_angle()
                    .createChart(shade_array)
                    .label()
                    .ticks()
                    .centerLabel();

            that.k.tooltip();
        }

        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

        var add_extra_width = 0;
        var add_extra_height = 0;
        setTimeout(function () {
            if(that.ticks_text_width.length) {
                add_extra_width = d3.max(that.ticks_text_width,function(d) {
                    return d;
                });
                add_extra_height = that.ticks_text_height;
            }
            that.k.exportSVG(that,"#"+container_id,type,undefined,undefined,(add_extra_width+20),(add_extra_height+20))
        },that.transitions.duration());

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    that.optionalFeatures = function () {
        var optional = {
            svgContainer :function (container_id) {
                that.svgContainer = d3.select(that.selector)
                    .append('svg')
                    .attr({
                        "width": that.chart_width,
                        "height": function () {
                            return that.chart_height;
                        },
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer PykCharts-oneD"
                    });
                that.group = that.svgContainer.append("g")
                    .attr({
                        "transform": "translate("+(that.chart_width/2)+","+that.height_translate+")",
                        "id": "pieGroup"
                    });

                return this;
            },
            createChart : function () {
                document.querySelector(that.selector +" #pieGroup").innerHTML = null;
                var border = new PykCharts.Configuration.border(that);
                if(that.color_mode === "shade") {
                    shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                    that.new_data.forEach(function (d,i) {
                        d.color = shade_array[i];
                    })
                }
                if(type.toLowerCase() === "pie" || type.toLowerCase() === "donut") {
                    that.new_data.sort(function (a,b) { return a.weight - b.weight;});
                    var temp = that.new_data.pop();
                    that.new_data.unshift(temp);
                    if(PykCharts['boolean'](that.clubdata_enable) && that.mode === "default") {
                        var index,data;
                        for(var i = 0;i<that.new_data.length;i++) {
                            if(that.new_data[i].name === that.clubdata_text) {
                                index = i;
                                data = that.new_data[i];
                                break;
                            }
                        }
                        if(index) {
                            that.new_data.splice(index,1);
                            if(i===0) {
                                var temp = that.new_data.pop();
                                that.new_data.splice(0,0,temp);
                            }
                            that.new_data.splice(1,0,data);
                        }
                    }
                } else if(type.toLowerCase() == "election pie" || type.toLowerCase() == "election donut") {
                    that.new_data.sort(function (a,b) { return b.weight - a.weight;});
                    if(PykCharts['boolean'](that.clubdata_enable) && that.mode === "default") {
                        var index,data;
                        for(var i = 0;i<that.new_data.length;i++) {
                            if(that.new_data[i].name === that.clubdata_text) {
                                index = i;
                                data = that.new_data[i];
                                break;
                            }
                        }
                        if(index) {
                            that.new_data.splice(index,1);
                            that.new_data.push(data);
                        }
                    }
                }

                that.sum = 0;
                for(var i = 0,len=that.new_data.length;i<len;i++) {
                    that.sum+=that.new_data[i].weight;
                }
                that.inner_radius = that.k.__proto__._radiusCalculation(that.innerRadiusPercent,that.calculation);
                that.outer_radius = that.k.__proto__._radiusCalculation(that.pie_radius_percent,that.calculation);

                that.arc = d3.svg.arc()
                    .innerRadius(that.inner_radius)
                    .outerRadius(that.outer_radius);

                that.pie = d3.layout.pie()
                    .value(function (d) { return d.weight; })
                    .sort(null)
                    .startAngle(that.start_angle)
                    .endAngle(that.end_angle);

                that.chart_data = that.group.selectAll("path").
                                        data(that.pie(that.new_data));

                that.chart_data.enter()
                    .append("path");

                that.chart_data
                    .attr("class","pie");

                that.chart_data
                    .attr({
                        "fill": function (d,i) {
                            return that.fillChart.selectColor(d.data);
                        },
                        "fill-opacity": 1,
                        "data-fill-opacity": function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "stroke": border.color(),
                        "stroke-width": border.width(),
                        "stroke-dasharray": border.style(),
                        "data-id" : function (d) {
                            return d.data.name;
                        }
                    })
                    .on({
                        'mouseover': function (d) {
                            if(that.mode === "default") {
                                d.data.tooltip = d.data.tooltip || "<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+d.data.name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(d.data.weight)+"<td class='tooltip-right-content'>("+((d.data.weight*100)/that.sum).toFixed(1)+"%) </tr></table>";
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlight(that.selector +" "+".pie", this);
                                }
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(d.data.tooltip);
                            }
                        },
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightHide(that.selector +" "+".pie");
                                }
                                that.mouseEvent.tooltipHide(d);
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default") {
                                that.mouseEvent.tooltipPosition(d);
                            }
                        },
                        'click' :  function (d) {
                            if(PykCharts['boolean'](that.click_enable)){
                                that.addEvents(d.data.name, d3.select(this).attr("data-id"));
                            }
                        }
                    });

                that.chart_data.transition()
                    .delay(function(d, i) {
                        if(that.transition_duration && that.mode === "default") {
                            return (i * that.transition_duration * 1000)/that.new_data.length;
                        } else return 0;
                    })
                    .duration(that.transitions.duration()/that.new_data.length)
                    .attrTween("d",function(d) {
                        var i = d3.interpolate(d.startAngle, d.endAngle);
                        return function(t) {
                            d.endAngle = i(t);
                            return that.arc(d);
                        }
                    });

                that.chart_data.exit().remove();
                return this;
            },
            label : function () {
                that.chart_text = that.group.selectAll("text")
                                   .data(that.pie(that.new_data));

                that.chart_text.enter()
                    .append("text")
                    .attr({
                        "class": "pie-label",
                        "transform": function (d) { return "translate("+that.arc.centroid(d)+")"; }
                    });

                that.chart_text.attr("transform",function (d) { return "translate("+that.arc.centroid(d)+")"; });

                that.chart_text.text("");

                function chart_text_timeout() {
                    that.chart_text
                        .style({
                            "font-weight": that.label_weight,
                            "font-size": that.label_size + "px",
                            "font-family": that.label_family
                        })
                        .text(function (d) {
                            return ((d.data.weight*100)/that.sum).toFixed(1)+"%";
//                            return that.k.appendUnits(d.data.weight);
                        })
                        .attr({
                            "text-anchor": "middle",
                            "pointer-events": "none",
                            "dy": 5,
                            "fill": function (d) {
                                if(that.color_mode === "shade" && !options.label_color) {
                                    var color_value = that.k.__proto__._colourBrightness(d.data.color);
                                    if(color_value === "light") {
                                        return "black";
                                    } else {
                                        return "white";
                                    }
                                }
                                return that.label_color;
                            }
                        })
                        .text(function (d,i) {
                            if(type.toLowerCase() === "pie" || type.toLowerCase() === "election pie") {
                                if(this.getBBox().width<((d.endAngle-d.startAngle)*((that.outer_radius/2)/**0.9*/))) {
                                    return ((d.data.weight*100)/that.sum).toFixed(1)+"%";
                                }
                                else {
                                    return "";
                                }
                            } else {
                                if((this.getBBox().width < (Math.abs(d.endAngle - d.startAngle)*that.outer_radius*0.9))  && (this.getBBox().height < (((that.outer_radius-that.inner_radius)*0.75)))) {
                                    return ((d.data.weight*100)/that.sum).toFixed(1)+"%";
                                }
                                else {
                                    return "";
                                }
                            }
                        });
                        that.chart_text.exit().remove();
                    }
                    setTimeout(chart_text_timeout,that.transitions.duration());

                return this;
            },
            clubData: function () {
                if(PykCharts['boolean'](that.clubdata_enable)) {
                    var clubdata_content = [];
                    if(that.clubdata_always_include_data_points.length!== 0){
                        var l = that.clubdata_always_include_data_points.length;
                        for(i=0; i < l; i++){
                            clubdata_content[i] = that.clubdata_always_include_data_points[i];
                        }
                    }
                    var new_data1 = [];
                    for(i=0;i<clubdata_content.length;i++){
                        for(j=0;j<that.data.length;j++){
                            if(clubdata_content[i].toUpperCase() === that.data[j].name.toUpperCase()){
                                new_data1.push(that.data[j]);
                            }
                        }
                    }
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    var k = 0;

                    while(new_data1.length<that.clubdata_maximum_nodes-1){
                        for(i=0;i<clubdata_content.length;i++){
                            if(that.data[k].name.toUpperCase() === clubdata_content[i].toUpperCase()){
                                k++;
                            }
                        }
                        new_data1.push(that.data[k]);
                        k++;
                    }
                    var sum_others = 0;
                    for(j=k; j < that.data.length; j++){
                        for(i=0; i<new_data1.length && j<that.data.length; i++){
                            if(that.data[j].name.toUpperCase() === new_data1[i].name.toUpperCase()){
                                sum_others +=0;
                                j++;
                                i = -1;
                            }
                        }
                        if(j < that.data.length){
                            sum_others += that.data[j].weight;
                        }
                    }
                    var sortfunc = function (a,b) { return b.weight - a.weight; };

                    while(new_data1.length > that.clubdata_maximum_nodes){
                        new_data1.sort(sortfunc);
                        var a=new_data1.pop();
                    }
                    var others_Slice = { "name":that.clubdata_text, "weight": sum_others,/* "color": that.clubdata_color,*/ "tooltip": that.clubdata_tooltip };
                    new_data1.sort(function(a,b){
                        return b.weight - a.weight;
                    })
                    if(new_data1.length < that.clubdata_maximum_nodes){
                        new_data1.push(others_Slice);
                    }
                    that.new_data = new_data1;
                }
                else {
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    that.new_data = that.data;
                }
                return that.new_data;
            },
            ticks : function () {
                if(PykCharts['boolean'](that.pointer_overflow_enable)) {
                    that.svgContainer.style("overflow","visible");
                }
                var w = [];
                that.ticks_text_width = [];
                    var tick_label = that.group.selectAll(".ticks_label")
                                    .data(that.pie(that.new_data));

                    tick_label.attr("class","ticks_label");

                    tick_label.enter()
                        .append("text")
                        .attr({
                            "x": 0,
                            "y": 0
                        });

                    var x,y;
                    tick_label.attr("transform",function (d) {
                        if (d.endAngle - d.startAngle < 0.2) {
                             x = (that.outer_radius +30 ) * (1) * Math.cos((d.startAngle + d.endAngle - Math.PI)/2);
                             y = (that.outer_radius/1+20) * (1) * Math.sin((d.startAngle + d.endAngle -  Math.PI)/2);
                        } else {
                             x = (that.outer_radius +22 ) * (1) * Math.cos((d.startAngle + d.endAngle - Math.PI)/2);
                             y = (that.outer_radius/1+24) * (1) * Math.sin((d.startAngle + d.endAngle -  Math.PI)/2);
                        }
                        return "translate(" + x + "," + y + ")";
                    });

                    tick_label.text("")
                    function tick_label_timeout() {
                        tick_label.text(function(d) { return d.data.name; })
                            .text(function(d,i) {
                                that.ticks_text_width[i] = this.getBBox().width;
                                that.ticks_text_height = this.getBBox().height;
                                return d.data.name;
                            })
                            .attr({
                                "text-anchor": function(d) {
                                    var rads = ((d.endAngle - d.startAngle) / 2) + d.startAngle;
                                    if (rads>0 && rads<2) {
                                        return "start";
                                    } else if (rads>=1.5 && rads<3.5) {
                                        return "middle";
                                    } else if (rads>=3.5 && rads<6) {
                                        return "end";
                                    } else if (rads>=6) {
                                        return "middle";
                                    } else if(type ==="election pie" || type === "election donut" && rads < -1) {
                                        return "end";
                                    } else if(rads<0) {
                                        return "middle";
                                    }
                                },
                                "dy": 5,
                                "pointer-events": "none"
                            })
                            .style({
                                "fill": that.pointer_color,
                                "font-size": that.pointer_size + "px",
                                "font-weight": that.pointer_weight,
                                "font-family": that.pointer_family,
                                display: function (d) {
                                    // console.log(d);
                                    console.log(d.data.name, Math.abs(d.startAngle - d.endAngle));
                                    if (Math.abs(d.startAngle - d.endAngle) >= 0.13){
                                        return "block";
                                    } else {
                                        return "none";
                                    }
                                }
                            });

                        tick_label.exit().remove();
                    }
                    setTimeout(tick_label_timeout,that.transitions.duration());


                    var tick_line = that.group.selectAll("line")
                        .data(that.pie(that.new_data));

                    tick_line.enter()
                        .append("line")
                        .attr("class", "ticks");

                    tick_line.attr({
                        "x1": function (d,i) {
                            return (that.outer_radius) * (1)* Math.cos((d.startAngle + d.endAngle)/2);
                        },
                        "y1": function (d,i) {
                            return (that.outer_radius) * (1) *Math.sin((d.endAngle + d.startAngle )/2);
                        },
                        "x2": function (d,i) {
                            return (that.outer_radius) * (1)* Math.cos((d.startAngle + d.endAngle)/2);
                        },
                        "y2": function (d,i) {
                            return (that.outer_radius) * (1) *Math.sin((d.endAngle + d.startAngle )/2);
                        }
                    });

                    tick_line.style("display", function (d) {
                        if (Math.abs(d.startAngle - d.endAngle) >= 0.13){
                            return "block";
                        } else {
                            return "none";
                        }
                    });

                    function tick_line_timeout() {
                        tick_line.attr({
                            "x2": function (d, i) {
                                return (that.outer_radius/1+12)* (1) * Math.cos((d.startAngle + d.endAngle)/2);
                            },
                            "y2": function (d, i) {
                                return (that.outer_radius/1+12)* (1) * Math.sin((d.startAngle + d.endAngle)/2);
                            },
                            "transform": "rotate(-90)",
                            "stroke-width": that.pointer_thickness + "px",
                            "stroke": that.pointer_color
                        });
                        tick_line.exit().remove();
                    }

                    setTimeout(tick_line_timeout,that.transitions.duration());
                return this;
            },
            centerLabel: function () {
                if(PykCharts['boolean'](that.show_total_at_center) && (type === "donut" || type === "election donut")) {

                    var h;
                    var label = that.group.selectAll(that.selector +" "+".centerLabel")
                                    .data([that.sum]);

                    label.enter()
                        .append("text");

                    label.attr("class","centerLabel")
                        .text("");

                    function label_timeout() {
                        label.text( function(d) {
                                return that.k.appendUnits(that.sum);
                            })
                            .text( function(d) {
                                h = this.getBBox().height;
                                return that.k.appendUnits(that.sum);
                            })
                            .attr({
                                "pointer-events": "none",
                                "text-anchor": "middle",
                                "y": function () {
                                    return (type === "donut") ? h/2 : (-0.25*that.inner_radius);
                                },
                                "fill": that.show_total_at_center_color
                            })
                            .style({
                                "font-family": that.show_total_at_center_family,
                                "font-weight": that.show_total_at_center_weight,
                                "font-size": that.show_total_at_center_size + "px"
                            });

                    }
                    setTimeout(label_timeout,that.transitions.duration());

                    label.exit().remove();
                }
                return this;
            },
            set_start_end_angle: function () {
                that.startAngle, that.endAngle;
                if(type === "pie" || type === "donut") {
                    that.start_angle = (0 * (Math.PI/180));
                    that.end_angle = (360 * (Math.PI/180));
                } else if(type === "election pie" || type === "election donut") {
                    that.start_angle = (-90 * (Math.PI/180));
                    that.end_angle = (90 * (Math.PI/180));
                }
                return this;
            }
        };
        return optional;
    };
};

PykCharts.oneD.pyramid = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

	this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options,'oneDimensionalCharts');
        that.chart_height = options.chart_height ? options.chart_height : that.chart_width;
        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

			that.data = that.k.__proto__._groupBy("oned",data);
            that.data_length = that.data.length;
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
			that.clubdata_enable = that.data_length > that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.render();
		};
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
	};

    this.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("oned",data);
            that.data_length = that.data.length;
            that.clubdata_enable = that.data_length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.new_data = that.optionalFeatures().clubData();
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                shade_array.reverse();
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures()
                    .createChart()
                    .label()
                    .ticks();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

	this.render = function () {
        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg";
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);

        if (that.mode === "default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"pyramid")
                .emptyDiv(that.selector)
                .subtitle();
            that.new_data = that.optionalFeatures().clubData();
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                shade_array.reverse();
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures().svgContainer(container_id)
                .createChart()
                .label()
                .ticks();

            that.k.createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource()
                .tooltip()
                .liveData(that);

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

        } else if (that.mode === "infographics") {
            that.new_data = that.data;
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.length);
                shade_array.reverse();
                that.new_data.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"pyramid")
                .emptyDiv(that.selector);
            that.optionalFeatures().svgContainer(container_id)
                .createChart()
                .label()
                .ticks();

            that.k.tooltip();
            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        }

        var add_extra_width = 0;
        setTimeout(function () {
            if(that.ticks_text_width.length) {
                add_extra_width = d3.max(that.ticks_text_width,function(d){
                        return d;
                    });
            }
            that.k.exportSVG(that,"#"+container_id,"pyramid",undefined,undefined,add_extra_width)
        },that.transitions.duration());

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
	};

	this.percentageValues = function (data){
        // var clubdata_length = 0;
        // if (that.clubdata_always_include_data_points.length != 0 && that.clubdata_maximum_nodes <= that.clubdata_always_include_data_points.length) {
        //     clubdata_length = that.clubdata_always_include_data_points.length;
        // }
        // else {
        //     clubdata_length = data.length;
        // }
        // for(var i=0;i<clubdata_length;i++) {
        //     that.sum+=data[i].weight;
        // }
        that.sum = d3.sum(data, function (d){
            return d.weight;
        });
        var percentValues = data.map(function (d){
            return d.weight/that.sum*100;
        });
        percentValues.sort(function(a,b){
            return b-a;
        });
        return percentValues;
    };
	this.pyramidLayout = function () {
        var data,
            size,
            coordinates;

        var pyramid = {
            data: function(d){
                if(!(d.length===0)) {
                     data = d;
                }
                return this;
            },
            size: function(s){
                if(s.length === 2) {
                    size = s;
                }
                // if (s.length!==2){
                // } else {
                //     size = s;
                // }
                return this;
            },
            coordinates: function(c){
                var w = size[0],
                    h = size[1],
                    ratio = (w/2)/h,
                    percentValues = that.percentageValues(data),
                    coordinates = [],
                    area_of_triangle = (w * h) / 2;
                 function d3Sum (i) {
                    return d3.sum(percentValues,function (d, j){
                        if (j>=i) {
                            return d;
                        }
                    });
                }
                for (var i=0,len=data.length;i<len; i++){
                    var selectedPercentValues = d3Sum(i),
                        area_of_element = selectedPercentValues/100 * area_of_triangle,
                        height1 = Math.sqrt(area_of_element/ratio),
                        base = 2 * ratio * height1,
                        xwidth = (w-base)/2;
                    if (i===0){
                        coordinates[i] = {"values":[{"x":w/2,"y":0},{"x":xwidth,"y":height1},{"x":base+xwidth,"y":height1}]};
                    }else{
                        coordinates[i] = {"values":[coordinates[i-1].values[1],{"x":xwidth,"y":height1},{"x":base+xwidth,"y":height1},coordinates[i-1].values[2]]};
                    }
                }
                return coordinates;
            }
        };
        return pyramid;
    };

    this.optionalFeatures = function () {

    	var optional = {
            svgContainer :function (container_id) {

                that.svgContainer = d3.select(that.selector)
                    .append('svg')
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer PykCharts-oneD"
                    });

                that.group = that.svgContainer.append("g")
                    .attr("id","pyrgrp");

                return this;
            },
        	createChart : function () {
                var border = new PykCharts.Configuration.border(that);
        		that.pyramid = that.pyramidLayout()
                    .data(that.new_data)
                    .size([that.chart_width,that.chart_height]);
		        that.coordinates = that.pyramid.coordinates();
                that.coordinates[0].values[1] = that.coordinates[that.coordinates.length-1].values[1];
                that.coordinates[0].values[2] = that.coordinates[that.coordinates.length-1].values[2];
                var k = that.new_data.length-1,p = that.new_data.length-1,tooltipArray = [];
                for(var i=0,len=that.new_data.length;i<len;i++){
                    if(i==0) {
                        tooltipArray[i] = that.new_data[i].tooltip || "<table class='PykCharts'><tr><th colspan='2'  class='tooltip-heading'>"+that.new_data[i].name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(that.new_data[i].weight)+"<td class='tooltip-right-content'>("+((that.new_data[i].weight*100)/that.sum).toFixed(1)+"%) </tr></table>";
                    } else {
                        tooltipArray[i] = that.new_data[k].tooltip || "<table class='PykCharts'><tr><th colspan='2'  class='tooltip-heading'>"+that.new_data[k].name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(that.new_data[k].weight)+"<td class='tooltip-right-content'>("+((that.new_data[k].weight*100)/that.sum).toFixed(1)+"%) </tr></table>";
                        k--;
                    }
                }
		        var line = d3.svg.line()
                    .interpolate('linear-closed')
                    .x(function(d,i) { return d.x; })
                    .y(function(d,i) { return d.y; });

                var a = [{x:0,y:that.chart_height},{x:that.chart_width,y:that.chart_height},{x:0,y:that.chart_height},{x:that.chart_width,y:that.chart_height},{x:0,y:that.chart_height},{x:that.chart_width,y:that.chart_height}]
                var k =that.new_data.length,b;

                that.chart_data =that.group.selectAll('.pyr-path')
                    .data(that.coordinates)
                that.chart_data.enter()
                    .append('path')

                that.chart_data.attr({
                    "class": "pyr-path",
                    'd': function(d) {return line(a);},
                    "stroke": border.color(),
                    "stroke-width": border.width(),
                    "stroke-dasharray": border.style(),
                    "fill": function (d,i) {
                        if(i===0) {
                            b = that.new_data[i];
                            d.color = that.new_data[i].color;
                        }
                        else {
                            k--;
                            b = that.new_data[k];
                            d.color = that.new_data[k].color;
                        }
                        return that.fillChart.selectColor(b);
                    },
                    "fill-opacity": 1,
                    "data-fill-opacity": function () {
                        return d3.select(this).attr("fill-opacity");
                    },
                    "data-id" : function (d,i) {
                        return that.new_data[i].name;
                    }
                })
                .on({
                    "mouseover": function (d,i) {
                        if(that.mode === "default") {
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlight(that.selector +" "+".pyr-path",this);
                            }
                            that.mouseEvent.tooltipPosition(d);
                            that.mouseEvent.tooltipTextShow(tooltipArray[i]);
                        }
                    },
                    "mouseout": function (d) {
                        if(that.mode === "default") {
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlightHide(that.selector +" "+".pyr-path")
                            }
                            that.mouseEvent.tooltipHide(d);
                        }
                    },
                    "mousemove": function (d,i) {
                        if(that.mode === "default") {
                            that.mouseEvent.tooltipPosition(d);
                        }
                    },
                    "click" : function (d,i) {
                        if(PykCharts['boolean'](that.click_enable)){
                           that.addEvents(that.new_data[i].name, d3.select(this).attr("data-id"));
                        }
                    }
                })
                .transition()
                .duration(that.transitions.duration())
                .attr('d',function (d){ return line(d.values); });

                that.chart_data.exit().remove();

		        return this;
        	},
            label: function () {
                    var j = that.new_data.length;
                    var p = that.new_data.length;
                    that.chart_text = that.group.selectAll("text")
                        .data(that.coordinates)

                    that.chart_text.enter()
                        .append("text")

                    that.chart_text.attr({
                        "text-anchor": "middle",
                        "pointer-events": "none",
                        "fill": function(d) {
                            if(that.color_mode === "shade" && !options.label_color) {
                                var color_value = that.k.__proto__._colourBrightness(d.color);
                                if(color_value === "light") {
                                    return "black";
                                } else {
                                    return "white";
                                }
                            }
                            return that.label_color;
                        },
                        "y": function (d,i) {
                            if(d.values.length === 4) {
                                return (((d.values[0].y-d.values[1].y)/2)+d.values[1].y) + 5;
                            } else {
                                return (d.values[0].y + that.coordinates[that.coordinates.length-1].values[1].y)/2 + 10;
                            }
                        },
                        "x": function (d,i) { return that.chart_width/2;}
                    })
                    .text("")
                    .style({
                        "font-weight": that.label_weight,
                        "font-size": that.label_size + "px",
                        "font-family": that.label_family
                    });
                    function chart_text_timeout() {
                        that.chart_text.text(function (d,i) {
                                if(i===0) {
                                    return ((that.new_data[i].weight*100)/that.sum).toFixed(1)+"%";

                                }
                                else {
                                    j--;
                                     return ((that.new_data[j].weight*100)/that.sum).toFixed(1)+"%";
                                }
                             })
                            .text(function (d,i) {
                                if(this.getBBox().width < (d.values[2].x - d.values[1].x) && this.getBBox().height < Math.abs(d.values[1].y - d.values[0].y)) {
                                    if(i===0) {
                                        return ((that.new_data[i].weight*100)/that.sum).toFixed(1)+"%";

                                    }else {
                                        p--;
                                        return ((that.new_data[p].weight*100)/that.sum).toFixed(1)+"%";

                                    }
                                }
                                else {
                                    return "";
                                }
                            });
                    }
                    setTimeout(chart_text_timeout,that.transitions.duration());

                    that.chart_text.exit().remove();

                return this;
            },
            ticks : function () {
                if(PykCharts['boolean'](that.pointer_overflow_enable)) {
                    that.svgContainer.style("overflow","visible");
                }

                var tick_label = that.group.selectAll(".ticks_label")
                        .data(that.coordinates);

                tick_label.enter()
                    .append("text")
                    .attr({
                        "x": 0,
                        "y": 0,
                        "class": "ticks_label"
                    });

                var x,y,w = [];
                that.ticks_text_width = [];
                var j = that.new_data.length;
                var n = that.new_data.length;
                tick_label.attr("transform",function (d) {
                    if (d.values.length === 3) {
                        x = ((d.values[0].x + that.coordinates[that.coordinates.length-1].values[2].x)/2) + 17;
                    } else {
                        x = ((d.values[2].x + d.values[3].x)/2 ) + 17;
                    }
                    if(d.values.length === 4) {
                        y= (((d.values[0].y-d.values[1].y)/2)+d.values[1].y) +2;
                    } else {
                        y =(d.values[0].y + that.coordinates[that.coordinates.length-1].values[1].y)/2;
                    }

                    return "translate(" + x + "," + (y + 5) + ")";
                });

                tick_label.text("");

                function tick_label_timeout() {
                    tick_label.text(function (d,i) {
                            if(i===0) {
                                return that.new_data[i].name;
                            }
                            else {
                                n--;
                                return that.new_data[n].name;
                            }
                        })
                        .text(function (d,i) {
                            if(i===0) {
                                w[i] = this.getBBox().height;
                                that.ticks_text_width[i] = this.getBBox().width;
                                if (this.getBBox().height < (d.values[1].y - d.values[0].y)) {
                                    return that.new_data[i].name;

                                } else {
                                    return "";
                                }
                            }
                            else {
                                w[i] = this.getBBox().height;
                                if (this.getBBox().height < (d.values[0].y - d.values[1].y)) {
                                     j--;
                                    return that.new_data[j].name;
                                }
                                else {
                                    return "";
                                }
                            }
                    })
                    .style({
                        "fill": that.pointer_color,
                        "font-size": that.pointer_size + "px",
                        "font-family": that.pointer_family,
                        "font-weight": that.pointer_weight
                    })
                    .attr("text-anchor","start");

                }
                setTimeout(tick_label_timeout,that.transitions.duration());

                tick_label.exit().remove();
                var tick_line = that.group.selectAll(".pyr-ticks")
                    .data(that.coordinates);

                tick_line.enter()
                    .append("line")
                    .attr("class", "pyr-ticks");

                tick_line
                    .attr({
                        "x1": function (d,i) {
                            if (d.values.length === 3) {
                                return (d.values[0].x + that.coordinates[that.coordinates.length-1].values[2].x)/2 ;
                            } else {
                                return ((d.values[2].x + d.values[3].x)/2 );
                            }
                        },
                        "y1": function (d,i) {
                            if(d.values.length === 4) {
                                return (((d.values[0].y-d.values[1].y)/2)+d.values[1].y) +2;
                            } else {
                                return (d.values[0].y + that.coordinates[that.coordinates.length-1].values[1].y)/2;
                            }
                        },
                        "x2": function (d, i) {
                            if (d.values.length === 3) {
                                return (d.values[0].x + that.coordinates[that.coordinates.length-1].values[2].x)/2  ;
                            } else {
                                return ((d.values[2].x + d.values[3].x)/2 )  ;
                            }
                        },
                        "y2": function (d, i) {
                            if(d.values.length === 4) {
                                return (((d.values[0].y-d.values[1].y)/2)+d.values[1].y) +2;
                            } else {
                                return (d.values[0].y + that.coordinates[that.coordinates.length-1].values[1].y)/2;
                            }
                        },
                        "stroke-width": that.pointer_thickness + "px",
                        "stroke": that.pointer_color
                    });
                    function tick_line_timeout() {
                        tick_line.attr("x2", function (d,i) {
                            if(Math.abs(d.values[0].y - d.values[1].y) > w[i]) {
                                if (d.values.length === 3) {
                                    return (d.values[0].x + that.coordinates[that.coordinates.length-1].values[2].x)/2 + 12;
                                } else {
                                    return ((d.values[2].x + d.values[3].x)/2 ) + 12;
                                }
                            } else {
                                if (d.values.length === 3) {
                                    return (d.values[0].x + that.coordinates[that.coordinates.length-1].values[2].x)/2 ;
                                } else {
                                    return ((d.values[2].x + d.values[3].x)/2 ) ;
                                }
                            }
                        });
                    }
                    setTimeout(tick_line_timeout, that.transitions.duration());

                tick_line.exit().remove();
                return this;
            },
            clubData: function () {
            	if (PykCharts['boolean'](that.clubdata_enable)) {
                    var clubdata_content = [];
                    if(that.clubdata_always_include_data_points.length!== 0){
                        var l = that.clubdata_always_include_data_points.length;
                        for(i=0; i < l; i++){
                            clubdata_content[i] = that.clubdata_always_include_data_points[i];
                        }
                    }
                    var new_data1 = [];
                    for(i=0;i<clubdata_content.length;i++){
                        for(j=0;j<that.data.length;j++){
                            if(clubdata_content[i].toUpperCase() === that.data[j].name.toUpperCase()){
                                new_data1.push(that.data[j]);
                            }
                        }
                    }
                    that.data.sort(function (a,b) { return b.weight - a.weight; });
                    var k = 0;

                    while(new_data1.length<that.clubdata_maximum_nodes-1){
                        for(i=0;i<clubdata_content.length;i++){
                            if(that.data[k].name.toUpperCase() === clubdata_content[i].toUpperCase()){
                                k++;
                            }
                        }
                        new_data1.push(that.data[k]);
                        k++;
                    }
                    var sum_others = 0;
                    for(j=k; j < that.data.length; j++){
                        for(i=0; i<new_data1.length && j<that.data.length; i++){
                            if(that.data[j].name.toUpperCase() === new_data1[i].name.toUpperCase()){
                                sum_others +=0;
                                j++;
                                i = -1;
                            }
                        }
                        if(j < that.data.length){
                            sum_others += that.data[j].weight;
                        }
                    }
                    var sortfunc = function (a,b) { return b.weight - a.weight; };

                    while(new_data1.length > that.clubdata_maximum_nodes){
                        new_data1.sort(sortfunc);
                        var a=new_data1.pop();
                    }
                    var others_Slice = { "name":that.clubdata_text, "weight": sum_others,/* "color": that.clubdata_color,*/ "tooltip": that.clubdata_tooltip };
                    new_data1.sort(function(a,b){
                        return a.weight - b.weight;
                    })
                    if(new_data1.length < that.clubdata_maximum_nodes){
                        new_data1.push(others_Slice);
                    }
                    that.new_data = new_data1;
                }
                else {
                    that.data.sort(function (a,b) { return a.weight - b.weight; });
                    that.new_data = that.data;
                }
                return that.new_data;
            }
        }
    	return optional;
    };
};

PykCharts.oneD.treemap = function (options){
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data){
        that = new PykCharts.validation.processInputs(that, options,'oneDimensionalCharts');
        optional = options.optional;
        that.chart_height = options.chart_height ? options.chart_height : that.chart_width;
        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("oned",data);
            that.compare_data = that.k.__proto__._groupBy("oned",data);
            that.k.remove_loading_bar(id);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };

    this.refresh = function (pykquery_data){
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("oned",data);
            that.clubdata_enable = that.data.length>that.clubdata_maximum_nodes ? that.clubdata_enable : "no";
            that.refresh_data = that.k.__proto__._groupBy("oned",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.optionalFeatures()
                .clubData()
            if(that.color_mode === "shade") {
                shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.children.length);
                that.new_data.children.forEach(function (d,i) {
                    d.color = shade_array[i];
                })
            }
            that.optionalFeatures()
                .createChart()
                .label();

        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function (){
        var id = that.selector.substring(1,that.selector.length);
        var container_id = id + "_svg";
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        that.transitions = new PykCharts.Configuration.transition(that);

        if(that.mode === "default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"treemap")
                .emptyDiv(that.selector)
                .subtitle();
        }

        that.k.tooltip();
        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        if(that.mode === "infographics"){
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"treemap")
                .emptyDiv(that.selector);
            that.new_data = {"children" : that.data};
        }

        if(that.mode === "default") {
            that.optionalFeatures()
                .clubData()
        }
        if(that.color_mode === "shade") {
            shade_array = that.k.shadeColorConversion(that.shade_color,that.new_data.children.length);
            that.new_data.children.forEach(function (d,i) {
                d.color = shade_array[i];
            })
        }
        that.optionalFeatures().svgContainer(container_id)
            .createChart()
            .label();
        if(that.mode === "default") {
            that.k.liveData(that)
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();
        }

        that.k.exportSVG(that,"#"+container_id,"treemap")

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    this.optionalFeatures = function (){
        var optional = {
            svgContainer: function (container_id) {

                that.svgContainer = d3.select(that.selector).append("svg:svg")
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer PykCharts-oneD"
                    });

                that.group = that.svgContainer.append("g")
                    .attr("id","treemap");
                return this;
            },
            createChart: function () {
                that.treemap = d3.layout.treemap()
                    .sort(function (a,b) { return a.weight - b.weight; })
                    .size([that.chart_width,that.chart_height])
                    .value(function (d) { return d.weight; })
                    .sticky(false);
                that.sum = d3.sum(that.new_data.children, function (d){
                        return d.weight;
                    });
                var l;

                that.node = that.treemap.nodes(that.new_data);
                l = that.new_data.children.length;
                that.chart_data = that.group.selectAll(".cell")
                                    .data(that.node);
                that.chart_data.enter()
                    .append("svg:g")
                    .attr("class","cell")
                    .append("svg:rect")
                    .attr("class","treemap-rect");

                that.chart_data.attr("class","cell")
                    .select("rect")
                    .attr({
                        "class": "treemap-rect",
                        "id": function (d,i) { return "rect" + i; },
                        "x": function (d) { return d.x; },
                        "y": function (d) { return d.y; },
                        "width": function (d) { return d.dx-1; },
                        "height": 0,
                        "fill": function (d) {
                            return d.children ? "white" : that.fillChart.selectColor(d);
                        },
                        "fill-opacity": 1,
                        "data-fill-opacity": function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "data-id" : function (d,i) {
                            return d.name;
                        }
                    })
                    .on({
                        'mouseover': function (d) {
                            if(!d.children && that.mode === "default") {
                                d.tooltip = d.tooltip || "<table class='PykCharts'><tr><th colspan='2' class='tooltip-heading'>"+d.name+"</tr><tr><td class='tooltip-left-content'>"+that.k.appendUnits(d.weight)+"<td class='tooltip-right-content'>("+((d.weight*100)/that.sum).toFixed(1)+"%)</tr></table>";
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlight(that.selector +" "+".treemap-rect", this);
                                }
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(d.tooltip);
                            }
                        },
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                that.mouseEvent.tooltipHide(d);
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightHide(that.selector +" "+".treemap-rect");
                                }
                            }
                        },
                        'mousemove': function (d) {
                            if(!d.children && that.mode === "default") {
                                that.mouseEvent.tooltipPosition(d);
                            }
                        },
                        'click' :  function (d,i) {
                            if(PykCharts['boolean'](that.click_enable)){
                               that.addEvents(d.name, d3.select(this).attr("data-id"));
                            }
                        }
                    })
                    .transition()
                    .duration(that.transitions.duration())
                    .attr("height", function (d) { return d.dy-1; });

                that.chart_data.exit()
                    .remove();
                return this;
            },
            label: function () {
                    that.chart_text = that.group.selectAll(".name")
                        .data(that.node);
                    that.chart_text1 = that.group.selectAll(".weight")
                        .data(that.node);
                    that.chart_text.enter()
                        .append("svg:text")
                        .attr("class","name");

                    that.chart_text1.enter()
                        .append("svg:text")
                        .attr("class","weight");

                    that.chart_text.attr({
                        "class": "name",
                        "x": function (d) { return d.x + d.dx / 2; },
                        "y": function (d) { return d.y + d.dy / 2; }
                    });

                    that.chart_text1.attr({
                        "class": "weight",
                        "x": function (d) { return d.x + d.dx / 2; },
                        "y": function (d) { return d.y + d.dy / 2 + that.label_size; }
                    });

                    that.chart_text
                        .attr({
                            "text-anchor": "middle",
                            "fill": function(d) {
                                if(that.color_mode === "shade" && !d.children && !options.label_color) {
                                    var color_value = that.k.__proto__._colourBrightness(d.color);
                                    if(color_value === "light") {
                                        return "black";
                                    } else {
                                        return "white";
                                    }
                                }
                                return that.label_color;
                            }
                        })
                        .style({
                            "font-weight": that.label_weight,
                            "font-size": that.label_size + "px",
                            "font-family": that.label_family
                        })
                        .text("");
                    function chart_text1_timeout() {
                        that.chart_text.text(function (d) { return d.children ? " " :  d.name; })
                            .attr("pointer-events","none")
                            .text(function (d) {

                                if(this.getBBox().width<d.dx && this.getBBox().height<d.dy-15) {
                                    return d.children ? " " :  d.name;
                                }
                                else {
                                    return "";
                                }
                            });
                    }
                    setTimeout(chart_text1_timeout,that.transitions.duration());

                    that.chart_text1
                        .attr({
                            "text-anchor": "middle",
                            "fill": function(d) {
                                if(that.color_mode === "shade" && !d.children && !options.label_color) {
                                    var color_value = that.k.__proto__._colourBrightness(d.color);
                                    if(color_value === "light") {
                                        return "black";
                                    } else {
                                        return "white";
                                    }
                                }
                                return that.label_color;
                            },
                            "pointer-events": "none"
                        })
                        .style({
                            "font-weight": that.label_weight,
                            "font-size": that.label_size + "px",
                            "font-family": that.label_family
                        })
                        .text("");

                    function timeout() {
                        that.chart_text1.text(function (d) { return d.children ? " " :  that.k.appendUnits(d.weight); })
                            .text(function (d) {
                                if(this.getBBox().width < d.dx && this.getBBox().height < d.dy-15) {
                                    return d.children ? " " :  ((d.weight*100)/that.sum).toFixed(1)+"%"; /*that.k.appendUnits(d.weight);*/

                                }
                                else {
                                    return "";
                                }
                            });
                    }

                    setTimeout(timeout,that.transitions.duration());

                    that.chart_text.exit()
                        .remove();
                    that.chart_text1.exit()
                        .remove();
                return this;
            },
            clubData : function () {
                if(PykCharts['boolean'](that.clubdata_enable)){
                    var clubdata_content = [],sum_others = 0,k=0;
                    if(that.data.length <= that.clubdata_maximum_nodes) {
                        that.new_data = { "children" : that.data };
                        return this;
                    }
                    if(that.clubdata_always_include_data_points.length!== 0){
                        var l = that.clubdata_always_include_data_points.length;
                        for(i=0; i < l; i++){
                            clubdata_content[i] = that.clubdata_always_include_data_points[i];
                        }
                    }
                    var new_data1 = [];
                    for(i=0;i<clubdata_content.length;i++){
                        for(j=0;j<that.data.length;j++){
                            if(clubdata_content[i].toUpperCase() === that.data[j].name.toUpperCase()){
                                new_data1.push(that.data[j]);
                            }
                        }
                    }
                    that.data.sort(function (a,b) { return b.weight - a.weight; });

                    while(new_data1.length<that.clubdata_maximum_nodes-1){
                        for(i=0;i<clubdata_content.length;i++){
                            if(that.data[k].name.toUpperCase() === clubdata_content[i].toUpperCase()){
                                k++;
                            }
                        }
                        new_data1.push(that.data[k]);
                        k++;
                    }
                    for(j=k; j < that.data.length; j++){
                        for(i=0; i<new_data1.length && j<that.data.length; i++){
                            if(that.data[j].name.toUpperCase() === new_data1[i].name.toUpperCase()){
                                sum_others +=0;
                                j++;
                                i = -1;
                            }
                        }
                        if(j < that.data.length){
                            sum_others += that.data[j].weight;
                        }
                    }
                    var sortfunc = function (a,b) { return b.weight - a.weight; };
                    while(new_data1.length > that.clubdata_maximum_nodes){
                        new_data1.sort(sortfunc);
                        var a=new_data1.pop();
                    }
                    var others_Slice = { "name":that.clubdata_text, "weight": sum_others, "color": that.clubData_color, "tooltip": that.clubData_tooltip };

                    if(new_data1.length < that.clubdata_maximum_nodes){
                        new_data1.push(others_Slice);

                    }
                    that.new_data = {"children" : new_data1};
                }
                else {
                    that.new_data = {"children" : that.data};
                }
                return this;
            },
        };
        return optional;
    };
};

PykCharts.other.pictograph = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function () {
        that = new PykCharts.validation.processInputs(that, options, "other");
        var optional = options.optional,
            otherCharts = theme.otherCharts;
        that.pictograph_show_all_images = options.pictograph_show_all_images ? options.pictograph_show_all_images.toLowerCase() : otherCharts.pictograph_show_all_images;
        that.pictograph_total_count_enable = options.pictograph_total_count_enable ? options.pictograph_total_count_enable.toLowerCase() : otherCharts.pictograph_total_count_enable;
        that.pictograph_current_count_enable = options.pictograph_current_count_enable ? options.pictograph_current_count_enable.toLowerCase() : otherCharts.pictograph_current_count_enable;
        that.pictograph_image_per_line = options.pictograph_image_per_line ?  options.pictograph_image_per_line : otherCharts.pictograph_image_per_line;
        that.pictograph_current_count_size = options.pictograph_current_count_size ? options.pictograph_current_count_size : otherCharts.pictograph_current_count_size;
        that.pictograph_current_count_color = options.pictograph_current_count_color ? options.pictograph_current_count_color : otherCharts.pictograph_current_count_color;
        that.pictograph_current_count_weight = options.pictograph_current_count_weight ? options.pictograph_current_count_weight.toLowerCase() : otherCharts.pictograph_current_count_weight;
        that.pictograph_current_count_family = options.pictograph_current_count_family ? options.pictograph_current_count_family.toLowerCase() : otherCharts.pictograph_current_count_family;
        that.pictograph_total_count_size = options.pictograph_total_count_size ? options.pictograph_total_count_size : otherCharts.pictograph_total_count_size;
        that.pictograph_total_count_color = options.pictograph_total_count_color ? options.pictograph_total_count_color : otherCharts.pictograph_total_count_color;
        that.pictograph_total_count_weight = options.pictograph_total_count_weight ? options.pictograph_total_count_weight.toLowerCase() : otherCharts.pictograph_total_count_weight;
        that.pictograph_total_count_family = options.pictograph_total_count_family ? options.pictograph_total_count_family.toLowerCase() : otherCharts.pictograph_total_count_family;
        that.pictograph_image_width =  options.pictograph_image_width ? options.pictograph_image_width : otherCharts.pictograph_image_width;
        that.pictograph_image_height = options.pictograph_image_height ? options.pictograph_image_height : otherCharts.pictograph_image_height;
        that.pictograph_units_per_image = options.pictograph_units_per_image ? options.pictograph_units_per_image : "";
        that.pictograph_units_per_image_text_family = options.pictograph_units_per_image_text_family ? options.pictograph_units_per_image_text_family.toLowerCase(): otherCharts.pictograph_units_per_image_text_family;
        that.pictograph_units_per_image_text_size = options.pictograph_units_per_image_text_size ? options.pictograph_units_per_image_text_size : otherCharts.pictograph_units_per_image_text_size;
        that.pictograph_units_per_image_text_color = options.pictograph_units_per_image_text_color ? options.pictograph_units_per_image_text_color : otherCharts.pictograph_units_per_image_text_color;
        that.pictograph_units_per_image_text_weight = options.pictograph_units_per_image_text_weight ? options.pictograph_units_per_image_text_weight.toLowerCase() : otherCharts.pictograph_units_per_image_text_weight;
        that.chart_height = options.chart_height ? options.chart_height : that.chart_width;
        that.k.validator()
            .validatingDataType(that.chart_height,"chart_height",that.chart_width)
            .validatingDataType(that.pictograph_units_per_image_text_size,"pictograph_units_per_image_text_size",otherCharts.pictograph_units_per_image_text_size)
            .validatingDataType(that.pictograph_current_count_size,"pictograph_current_count_size",otherCharts.pictograph_current_count_size)
            .validatingDataType(that.pictograph_total_count_size,"pictograph_total_count_size",otherCharts.pictograph_total_count_size)
            .validatingDataType(that.pictograph_image_width,"pictograph_image_width",otherCharts.pictograph_image_width)
            .validatingDataType(that.pictograph_image_height,"pictograph_image_height",otherCharts.pictograph_image_height)
            .validatingDataType(that.pictograph_image_per_line,"pictograph_image_per_line",otherCharts.pictograph_image_per_line)
            .validatingFontWeight(that.pictograph_current_count_weight,"pictograph_current_count_weight",otherCharts.pictograph_current_count_weight)
            .validatingFontWeight(that.pictograph_total_count_weight,"pictograph_total_count_weight",otherCharts.pictograph_total_count_weight)
            .validatingFontWeight(that.pictograph_units_per_image_text_weight,"pictograph_units_per_image_text_weight",otherCharts.pictograph_units_per_image_text_weight)
            .validatingColor(that.pictograph_current_count_color,"pictograph_current_count_color",otherCharts.pictograph_current_count_color)
            .validatingColor(that.pictograph_total_count_color,"pictograph_total_count_color",otherCharts.pictograph_total_count_color)
            .validatingColor(that.pictograph_units_per_image_text_color,"pictograph_units_per_image_text_color",otherCharts.pictograph_units_per_image_text_color);
        if(that.stop) {
            return;
        }

        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
           that.k.loading();
        }

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = data.sort(function(a,b) {
                return b.weight - a.weight;
            });
            that.old_weight = 0;

            that.compare_data = that.data;
            that.k.remove_loading_bar(id);
            that.render();
        };
        that.k.dataSourceFormatIdentification(options.data,that,"executeData");
    };
    this.refresh = function () {
        that.executeRefresh = function (data) {
            that.old_data = that.data;
            that.old_weight = that.weight;
            var validate = that.k.validator().validatingJSON(data);
            if(that.stop || validate === false) {
                return;
            }

            that.data = data.sort(function(a,b) {
                return b.weight - a.weight;
            });
            that.refresh_data = that.data;
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.optionalFeatures()
                .labelText()
                .enableLabel()
                .createChart();
        }
        that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
    }
    this.render = function () {
        var id = that.selector.substring(1,that.selector.length),
            container_id = id + "_svg";
        that.transitions = new PykCharts.Configuration.transition(that);

        if(that.mode==="default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"pictograph")
                .emptyDiv()
                .subtitle()
                .liveData(that);
        } else {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"pictograph")
                .emptyDiv();
        }

        that.optionalFeatures()
                .svgContainer(container_id)
                .labelText()
                .enableLabel()
        if(PykCharts['boolean'](that.pictograph_units_per_image)) {
            that.optionalFeatures().appendUnits()
        }
        that.optionalFeatures().createChart();
        if(that.mode==="default") {
            that.k.createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();
        }
        that.k.exportSVG(that,"#"+container_id,"pictograph");
        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    this.optionalFeatures = function () {

        var optional = {
            svgContainer: function (container_id) {
                that.svgContainer = d3.select(that.selector).append('svg')
                    .attr({
                        "width": that.chart_width,
                        "id": container_id,
                        "class": "svgcontainer",
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
                    });

                that.group = that.svgContainer.append("g")
                    .attr("id", "pictograph_image_group")

                that.group1 = that.svgContainer.append("g")
                    .attr("transform","translate(0,0)");

                if(PykCharts['boolean'](that.pictograph_units_per_image)) {
                    that.group2 = that.svgContainer.append("g")
                        .attr("id","units-per-image");
                }

                return this;
            },
            createChart: function () {
                var a = 0,b=0;

                that.optionalFeatures().showTotal();
                var counter = 0;

                if(!that.textWidth) {
                    that.textWidth = 0;
                }

                if(!that.totalTxtWeight) {
                    that.totalTxtWeight = 0;
                }

                var width = that.textWidth + that.totalTxtWeight + 25;

                if(that.total_unit_width > width) {
                    width = that.total_unit_width + 10
                }

                that.group.attr("transform", "translate(" + (width) + ",0)")
                for(var j=1; j<=that.weight; j++) {
                    if(j <= that.data[1].weight) {
                        if (!that.old_data || (that.old_data && j > that.old_data[1].weight)) {
                            that.group.append("image")
                                .attr({
                                    "xlink:href": that.data[1]["image"],
                                    "id": "current_image"+j,
                                    "x": b *(that.pictograph_image_width + 1),
                                    "y": a *(that.pictograph_image_height + 10),
                                    "width": 0,
                                    "height": that.pictograph_image_height + "px"
                                })
                                .transition()
                                .duration(that.transitions.duration())
                                .attr("width", that.pictograph_image_width + "px");

                            setTimeout(function () {
                                var total_image_element = d3.selectAll("#total_image"+j);
                                if (total_image_element) {
                                    total_image_element.remove();
                                }
                            },that.transitions.duration());
                        }
                    } else if ((j > that.old_weight && that.weight > that.old_weight) || (that.old_data && j <= that.old_data[1].weight)) {
                            that.group.append("image")
                                .attr({
                                    "xlink:href": that.data[0]["image"],
                                    "id": "total_image"+j,
                                    "x": b *(that.pictograph_image_width + 1),
                                    "y": a *(that.pictograph_image_height+ 10),
                                    "width": 0,
                                    "height": that.pictograph_image_height + "px"
                                })
                                .transition()
                                .duration(that.transitions.duration())
                                .attr("width", that.pictograph_image_width + "px");
                    }
                    counter++;
                    b++;

                    if (counter >= that.pictograph_image_per_line) {
                        a++;
                        b=0;
                        counter=0;
                    }

                    var group_bbox_height = that.group.node().getBBox().height;
                    if (j===+that.weight && group_bbox_height != 0) {
                        that.chart_height = group_bbox_height;

                        that.svgContainer
                            .attr({
                                "height": group_bbox_height,
                                "viewBox": "0 0 " + that.chart_width + " " + group_bbox_height
                            });
                    }
                    else {
                        that.svgContainer
                            .attr({
                                "height": group_bbox_height,
                                "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
                            });
                    }
                }

                setTimeout(function () {
                    if (that.old_data && that.old_data[1].weight > that.data[1].weight) {
                        for (var i = that.old_data[1].weight; i > that.data[1].weight; i--) {
                            var current_image_elements = d3.selectAll("#current_image"+i);
                            if (current_image_elements) {
                                current_image_elements.remove();
                            }
                        }
                    }
                    if (that.old_data && that.old_data[0].weight > that.data[0].weight) {
                        for (var i = that.old_data[0].weight; i > that.data[0].weight; i--) {
                            var total_image_element = d3.selectAll("#total_image"+i);
                                if (total_image_element) {
                                    total_image_element.remove();
                                }
                        }
                    }
                },that.transitions.duration());

                if(((that.pictograph_image_width * that.pictograph_image_per_line) + width) > that.chart_width) {
                    console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px',"Your Lable text size and image width exceeds the chart conatiner width")
                }
                return this;
            },
            showTotal: function () {
                 if (PykCharts['boolean'](that.pictograph_show_all_images)) {
                    that.weight = that.data[0].weight;
                }
                else {
                    that.weight = that.data[1].weight;
                }
                return this ;
            },
            enableLabel: function () {
                if (PykCharts['boolean'](that.pictograph_total_count_enable)) {
                    var current_text = d3.selectAll(that.selector+" .PykCharts-current-text");
                    if (current_text.length > 0) {
                        current_text.remove();
                    };

                    if(!that.textWidth) {
                        that.textWidth = 0;
                    }

                    var y_pos =  ((that.data[0].weight)/(that.pictograph_image_per_line));
                    var textHeight;

                    that.group1.append("text")
                        .attr({
                            "class": "PykCharts-current-text",
                            "font-family": that.pictograph_total_count_family,
                            "font-size": that.pictograph_total_count_size,
                            "font-weight": that.pictograph_total_count_weight,
                            "fill": that.pictograph_total_count_color
                        })
                        .text("/"+that.data[0].weight)
                        .text(function () {
                            that.textHeight =this.getBBox().height;
                            that.totalTxtWeight = this.getBBox().width;
                            return "/"+that.data[0].weight;
                        })
                        .attr({
                            "x": (that.textWidth+5),
                            "y": function () { return ((that.textHeight)-10); }
                        });
                }
                return this;
            },
            labelText: function () {
                if (PykCharts['boolean'](that.pictograph_current_count_enable)) {
                    var total_text = d3.selectAll(that.selector+" .PykCharts-total-text");
                    if (total_text.length > 0) {
                        total_text.remove();
                    };
                    var y_pos =  ((that.data[0].weight)/(that.pictograph_image_per_line));
                    var textHeight;
                    that.group1.append("text")
                        .attr({
                            "x": 0,
                            "class": "PykCharts-total-text",
                            "font-family": that.pictograph_current_count_family,
                            "font-size": that.pictograph_current_count_size,
                            "font-weight": that.pictograph_current_count_weight,
                            "fill": that.pictograph_current_count_color
                        })
                        .text(that.data[1].weight)
                        .text(function () {
                            that.textHeight = this.getBBox().height;
                            that.textWidth = this.getBBox().width;
                            return that.data[1].weight;
                        })
                        .attr("y", function () { return ((that.textHeight)-10); });
                }
                return this;
            },
            appendUnits: function () {
                if(!that.textHeight) {
                    that.textHeight = 0;
                }

                var unit_text_width, image_width,unit_text_width1,unit_text_height;
                that.group2.attr("transform","translate(0," + (that.textHeight + 15)+")");

                that.group2.append("text")
                        .attr({
                            "x": 0,
                            "class": "PykCharts-unit-text",
                            "font-family": that.pictograph_units_per_image_text_family,
                            "font-size": that.pictograph_units_per_image_text_size,
                            "font-weight": that.pictograph_units_per_image_text_weight,
                            "fill": that.pictograph_units_per_image_text_color
                        })
                        .text(function () {
                            return "1 ";
                        })
                        .text(function () {
                            unit_text_height = this.getBBox().height;
                            unit_text_width = this.getBBox().width;
                            return "1 ";
                        })
                        .attr({
                            "dy": 0,
                            "y": unit_text_height - 5
                        });

                that.group2.append("image")
                        .attr({
                            "xlink:href": that.data[1]["image"],
                            "id": "unit-image",
                            "x": unit_text_width + 2 + "px",
                            "y": 0,
                            "height": unit_text_height + "px",
                            "width": unit_text_height + "px"
                        });
                image_width = d3.select(that.selector +" #unit-image").attr("width");

                that.group2.append("text")
                        .attr({
                            "x": function () {
                                return parseFloat(image_width) + unit_text_width + 4;
                            },
                            "class": "PykCharts-unit-text",
                            "font-family": that.pictograph_units_per_image_text_family,
                            "font-size": that.pictograph_units_per_image_text_size,
                            "font-weight": that.pictograph_units_per_image_text_weight,
                            "fill": that.pictograph_units_per_image_text_color
                        })
                        .text(function () {
                            return "= " + that.pictograph_units_per_image;
                        })
                        .text(function () {
                            unit_text_width1 = this.getBBox().width;
                            return "= " + that.pictograph_units_per_image;
                        })
                        .attr("y", function () { return (unit_text_height - 5); });
                that.total_unit_width = unit_text_width + parseFloat(image_width) + unit_text_width1+4;
                return this;
            }
        }
        return optional;
    }
};

PykCharts.multiD = {};
var theme = new PykCharts.Configuration.Theme({});

PykCharts.multiD.configuration = function (options){
    var that = this;
    var fillColor = new PykCharts.Configuration.fillChart(options);
    var multiDConfig = {
        opacity : function (d,weight,data) {
            if(!(PykCharts['boolean'](options.variable_circle_size_enable))) {
                var z = d3.scale.linear()
                    .domain(d3.extent(data,function (d) {
                        return d.weight;
                    }))
                    .range([0.3,1]);
                return d ? z(d) : z(Math.min.apply(null, weight));
            }
            else {
                return 0.8;
            }
        },
        legendsPosition : function (options,type,params,color,index) {
            var j=0,legend,translate_x = 0;
             if(options.legends_display === "vertical" ) {
                options.legendsGroup.attr("height", (params.length * 30)+20);
                options.legendsGroup_height = 0;
                text_parameter1 = "x";
                text_parameter2 = "y";
                rect_parameter1 = "width";
                rect_parameter2 = "height";
                rect_parameter3 = "x";
                rect_parameter4 = "y";
                rect_parameter1value = 13;
                rect_parameter2value = 13;
                text_parameter1value = function (d,i) { return 36; };
                rect_parameter3value = function (d,i) { return 20; };
                var rect_parameter4value = function (d,i) { return i * 24 + 12;};
                var text_parameter2value = function (d,i) { return i * 24 + 23;};
            } else if(options.legends_display === "horizontal") {
                options.legendsGroup_height = 50;
                temp_i = j;
                final_rect_x = 0;
                final_text_x = 0;
                legend_text_widths = [];
                sum_text_widths = 0;
                temp_text = temp_rect = 0;
                text_parameter1 = "x";
                text_parameter2 = "y";
                rect_parameter1 = "width";
                rect_parameter2 = "height";
                rect_parameter3 = "x";
                rect_parameter4 = "y";
                var text_parameter1value = function (d,i) {
                    legend_text_widths[i] = this.getBBox().width;
                    legend_start_x = 16;
                    final_text_x = (i === 0) ? legend_start_x : (legend_start_x + temp_text);
                    temp_text = temp_text + legend_text_widths[i] + 30;
                    return final_text_x;
                };
                text_parameter2value = 30;
                rect_parameter1value = 13;
                rect_parameter2value = 13;
                var rect_parameter3value = function (d,i) {
                    final_rect_x = (i === 0) ? 0 : temp_rect;
                    temp_rect = temp_rect + legend_text_widths[i] + 30;
                    return final_rect_x;
                };
                rect_parameter4value = 18;
            }
            if (type === "scatter") {
                if(options.panels_enable === "yes"){
                    var legend_data =[];
                    legend_data.push(options.map_group_data[0][index]);
                    legend = options.legendsGroup.selectAll("rect")
                        .data(legend_data);
                    options.legends_text = options.legendsGroup.selectAll(".legends_text")
                        .data(legend_data);
                } else {
                    legend = options.legendsGroup.selectAll("rect")
                        .data(options.map_group_data[0]);
                    options.legends_text = options.legendsGroup.selectAll(".legends_text")
                        .data(options.map_group_data[0]);
                }
            } else {
                legend = options.legendsGroup.selectAll(".legends-rect")
                    .data(params);
                options.legends_text = options.legendsGroup.selectAll(".legends_text")
                    .data(params);
            }

            options.legends_text.enter()
                .append('text');
            options.legends_text.attr("class","legends_text")
                .attr("pointer-events","none")
                .text(function (d) {
                    switch (type) {
                        case "groupColumn" :
                        case "groupBar" :
                            return d;
                        case "spiderWeb" :
                        case "scatter" :
                            return d.group;
                        case "stackedArea" :
                            return d.name;
                    }
                })
                .attr("fill", options.legends_text_color)
                .attr("font-family", options.legends_text_family)
                .style("font-size",options.legends_text_size+"px")
                .attr("font-weight", options.legends_text_weight)
                .attr(text_parameter1, text_parameter1value)
                .attr(text_parameter2, text_parameter2value);

            legend.enter()
                .append("rect");

            legend.attr("class","legends-rect")
                .attr(rect_parameter1, rect_parameter1value)
                .attr(rect_parameter2, rect_parameter2value)
                .attr(rect_parameter3, rect_parameter3value)
                .attr(rect_parameter4, rect_parameter4value)
                .attr("fill", function (d,i) {
                    switch(type) {
                        case "groupColumn" :
                        case "groupBar" :
                            if(options.color_mode === "color")
                                return color[i];
                            else return options.saturation_color;
                        case "spiderWeb" :
                        case "scatter" :
                            return options.fillChart.colorPieW(d);
                        case "stackedArea" :
                            return options.fillColor.colorPieMS(d,options.type);
                    }
                })
                .attr("fill-opacity", function (d,i) {
                    switch(type) {
                        case "groupColumn" :
                        case "groupBar" :
                            if (options.color_mode === "saturation") {
                                return (i+1)/options.no_of_groups;
                            }
                            break;
                        case "spiderWeb" :
                            return 0.6;
                        case "scatter" :
                            return 1;
                        case "stackedArea" :
                            if(options.color_mode === "saturation") {
                             return (i+1)/options.new_data.length;
                            }
                    }
                });

            var legend_container_width = options.legendsGroup.node().getBBox().width,translate_x;
            options.legendsGroup_width = (options.legends_display === "vertical") ? legend_container_width + 20 : 0;
            if (type === "scatter") {
                translate_x = (options.legends_display === "vertical") ? (options.w - options.legendsGroup_width) : ((!PykCharts['boolean'](options.panels_enable)) ? (options.chart_width - legend_container_width - 20) : options.chart_margin_left);
            } else {
                translate_x = (options.legends_display === "vertical") ? (options.chart_width - options.legendsGroup_width) : (options.chart_width - legend_container_width - 20);
            }
            if (legend_container_width < options.chart_width) {
                options.legendsGroup.attr("transform","translate("+translate_x+",10)");
            }
            options.legendsGroup.style("visibility","visible");
            options.legends_text.exit().remove();
            legend.exit().remove();
        },
        mapGroup : function (data,type) {
            var newarr = [],
                unique = {},
                group_arr = [],
                uniq_group_arr = [],
                uniq_group_obj = {},
                new_arr = [],
                k = 0,
                checkGroup = true,
                checkColor = true;
            for (var i=0 ; i<data.length ; i++) {
                group_arr[i] = data[i]['group'];
            }
            uniq_group_arr = options.k.__proto__._unique(group_arr);
            for (var i=0 ; i<uniq_group_arr.length ; i++) {
                uniq_group_obj[uniq_group_arr[i]] = [];
            }
            for (var key in uniq_group_obj) {
                for (var j=0 ; j<data.length ; j++) {
                    if (key === data[j]['group']) {
                        uniq_group_obj[key].push(data[j]);
                    }
                }
            }
            for (var key in uniq_group_obj) {
                for (var i=0 ; i<uniq_group_obj[key].length ; i++) {
                    new_arr.push(uniq_group_obj[key][i]);
                }
            }
            data = new_arr;
            data.forEach(function (item) {
                if(item.group) {
                    checkGroup = true;
                } else {
                    checkGroup = false;
                    if(options.chart_color) {
                        checkGroup = false;
                        item.color = options.chart_color[0];
                    } else if(item.color) {
                        checkColor = false;
                        item.color = item.color;
                    } else{
                        checkColor = false;
                        item.color = options.default_color[0];
                    }
                }
            });
            i = 0
            if(checkGroup) {
                data.forEach(function(item) {
                    if (!unique[item.group] && item.color) {
                        unique[item.group] = item;
                        if(options.chart_color.length !== 0 && PykCharts['boolean'](options.chart_color[k])) {
                            item.color = options.chart_color[k];
                        } else if(item.color) {
                            item.color = item.color;
                        } else {
                            item.color = options.default_color;
                        }
                        if(i<data.length-2 && item.group !== data[i+1].group) {
                            k++;
                        }
                        newarr.push(item);
                    } else {
                        if(i < data.length-2 && item.group !== data[i+1].group) {
                            k++;
                        }
                    }
                    i++;
                });
                k=0;i=0;
                data.forEach(function(item) {
                    if(!unique[item.group]) {
                        unique[item.group] = item;
                        if(options.chart_color.length !== 0 && PykCharts['boolean'](options.chart_color[k])) {
                            item.color = options.chart_color[k];
                        } else {
                            item.color = options.default_color;
                        }
                        if(i<data.length-2 &&item.group !== data[i+1].group) {
                            k++;
                        }
                        newarr.push(item);
                    } else {
                        if(i<data.length-2 && item.group !== data[i+1].group) {
                            k++;
                        }
                    }
                    i++;
                })

                var arr = [];
                var uniqueColor = {};
                k = 0;
                newarr.forEach(function(item) {
                    arr.push(item);
                });
                var arr_length = arr.length,
                data_length = data.length;
                for(var i = 0;i < arr_length; i++) {
                    for(var j = 0;j<data_length;j++) {
                        if(data[j].group === arr[i].group) {
                            data[j].color = arr[i].color;
                        }
                    }
                }
                return [arr,checkGroup];
            } else {
                return [data,checkGroup];
            }
        }

    };
    return multiDConfig;
};

PykCharts.multiD.bubbleSizeCalculation = function (options,data,rad_range) {
    var size = function (d) {
        if(d && PykCharts['boolean'](options.variable_circle_size_enable)) {
            var z = d3.scale.linear()
                        .domain(d3.extent(data,function (d) {
                            return d.weight;
                        }))
                        .range(rad_range);
            return z(d);
        } else {
            return options.bubbleRadius;
        }
    };
    return size;
};

PykCharts.multiD.sortDataByGroup = function (data) {
    data.sort(function(a,b) {
        if (a.group < b.group) {
            return -1;
        }
        else if (a.group > b.group) {
            return 1;
        }
    });
    return data;
}


PykCharts.annotation = function (options) {
    options.k.annotation = function (svg,data,xScale,yScale) {
        var legendsGroup_height = (options.legendsGroup_height) ? options.legendsGroup_height: 0;

        if(options.annotation_view_mode === "onclick") {
            var annotation_circle = d3.select(svg).selectAll(".PykCharts-annotation-circle")
                .data(data);
            var annotation_text = d3.select(svg).selectAll(".PykCharts-annotation-text")
                .data(data);

            annotation_circle.enter()
                .append("circle")
                .attr("class","PykCharts-annotation-circle");

            annotation_circle
                .attr("r",0);
            setTimeout(function () {
                annotation_circle
                    .attr("cx",function (d,i) {
                        return (parseInt(xScale(d.x))+options.extra_left_margin+options.chart_margin_left);
                    })
                    .attr("cy", function (d,i) {
                        return (parseInt(yScale(d.y))-15+options.chart_margin_top+legendsGroup_height);
                    })
                    .attr("r", "7")
                    .style("cursor","pointer")
                    .on("click",function (d,i) {
                        d3.selectAll(".pyk-tooltip")
                            .style("display","none");
                        options.mouseEvent.tooltipPosition(d);
                        options.mouseEvent.tooltipTextShow(d.annotation);
                    })
                    .on("mouseover", function (d) {
                        options.mouseEvent.tooltipHide(d,options.panels_enable,"multilineChart")
                    })
                    .attr("fill",options.annotation_background_color)
            },options.transitions.duration());

            annotation_circle.exit().remove();
        } else if(options.annotation_view_mode === "onload") {
            var w = [],h=[];
            var annotation_rect = d3.select(svg).selectAll(".annotation-rect")
                .data(data)

            annotation_rect.enter()
                .append("rect")
                .attr("class","annotation-rect");

            var annotation_text = d3.select(svg).selectAll(".annotation-text")
                .data(data)

            annotation_text.enter()
                .append("text")
                .attr("class","annotation-text");
            annotation_text
                .text(function (d) {
                    return "";
                });
            annotation_rect
                .attr("width",0)
                .attr("height",0);
            setTimeout(function () {
                annotation_text.attr("x",function (d) {
                        return parseInt(xScale(d.x)-(5))+options.extra_left_margin+options.chart_margin_left;
                    })
                    .attr("y", function (d) {
                        return parseInt(yScale(d.y)-18+options.chart_margin_top+legendsGroup_height);
                    })
                    .attr("text-anchor","middle")
                    .style("font-size","12px")
                    .text(function (d) {
                        return d.annotation;
                    })
                    .text(function (d,i) {
                        w[i] = this.getBBox().width + 20;
                        h[i] = this.getBBox().height + 10;
                        return d.annotation;
                    })
                    .attr("fill",options.annotation_font_color)
                    .style("pointer-events","none");

                annotation_rect.attr("x",function (d,i) {
                        return (parseInt(xScale(d.x)-(5))+options.extra_left_margin+options.chart_margin_left) - (w[i]/2);
                    })
                    .attr("y", function (d,i) {
                        return (parseInt(yScale(d.y)-10+options.chart_margin_top)+legendsGroup_height) - h[i];
                    })
                    .attr("width",function (d,i) { return w[i]; })
                    .attr("height",function (d,i) { return h[i]; })
                    .attr("fill",options.annotation_background_color)
                    .style("pointer-events","none");
            },options.transitions.duration());
            annotation_text.exit()
                .remove();
            annotation_rect.exit()
                .remove();
        }

        return this;
    }
}
PykCharts.crossHair = function (options) {
    options.k.crossHair= function (svg,len,data,fill,type) {
        if(PykCharts['boolean'](options.crosshair_enable) && options.mode === "default") {

            PykCharts.Configuration.cross_hair_v = svg.append("line")
                .attr({
                    "class" : "line-cursor",
                    "id" : "cross-hair-v"
                });

            PykCharts.Configuration.cross_hair_h = svg.append("line")
                .attr({
                    "class" : "line-cursor",
                    "id" : "cross-hair-h"
                })
                .style("display","none");

            for (j=0; j<len; j++) {
                PykCharts.Configuration.focus_circle = svg.append("g")
                    .attr({
                        "class" : "focus",
                        "id" : "f_circle"+j
                    })
                    .attr("name", function () {
                        return data[j].name
                    })
                    .style("display","none");

                PykCharts.Configuration.focus_circle.append("circle")
                    .attr({
                        "fill" : function (d) {
                            return fill.colorPieMS(data[j],type);
                        },
                        "id" : "focus-circle"+j,
                        "r" : "6",
                        "actual_color": function () {
                            return fill.colorPieMS(data[j],type);
                        }
                    });
            }
        }
        return this;
    }

}
//     };
//     return configuration1;
// };
PykCharts.grid = function (options) {
    options.k.yGrid =  function (svg, gsvg, yScale,legendsGroup_width) {
        var width = options.chart_width,
            height = options.chart_height;
        if(PykCharts['boolean'](options.chart_grid_y_enable)) {
            var ygrid = PykCharts.Configuration.makeYGrid(options,yScale,legendsGroup_width);
            gsvg.selectAll(options.selector + " g.y.grid-line")
                .style("stroke",function () { return options.chart_grid_color; })
                .call(ygrid);
        }
        return this;
    },
    options.k.xGrid = function (svg, gsvg, xScale,legendsGroup_height) {
        var width = options.chart_width,
            height = options.chart_height;

        if(PykCharts['boolean'](options.chart_grid_x_enable)) {
            var xgrid = PykCharts.Configuration.makeXGrid(options,xScale,legendsGroup_height);
            gsvg.selectAll(options.selector + " g.x.grid-line")
                .style("stroke",function () { return options.chart_grid_color; })
                .call(xgrid);
        }
        return this;
    }
}
PykCharts.Configuration.makeXGrid = function(options,xScale,legendsGroup_height) {
    var that = this;
    if(!legendsGroup_height) {
        legendsGroup_height = 0;
    }
    var xgrid = d3.svg.axis()
                    .scale(xScale)
                    .orient("bottom")
                    .ticks(options.axis_x_no_of_axis_value)
                    .tickFormat("")
                    .tickSize(options.chart_height - options.chart_margin_top - options.chart_margin_bottom - legendsGroup_height)
                    .outerTickSize(0);

    d3.selectAll(options.selector + " .x.axis .tick text")
                    .attr("font-size",options.axis_x_pointer_size + "px")
                    .style({
                        "font-weight" : options.axis_x_pointer_weight,
                        "font-family" : options.axis_x_pointer_family
                    });

    return xgrid;
};

configuration.makeYGrid = function(options,yScale,legendsGroup_width) {
    var that = this, size;
    if(!legendsGroup_width) {
        legendsGroup_width = 0;
    }

    if(PykCharts['boolean'](options.panels_enable)) {
        size = options.w - options.chart_margin_left - options.chart_margin_right - legendsGroup_width;
    } else {
        size = options.chart_width - options.chart_margin_left - options.chart_margin_right - legendsGroup_width;
    }
    var ygrid = d3.svg.axis()
                    .scale(yScale)
                    .orient("left")
                    .ticks(options.axis_y_no_of_axis_value)
                    .tickSize(-size)
                    .tickFormat("")
                    .outerTickSize(0);

    d3.selectAll(options.selector + " .y.axis .tick text")
                    .attr("font-size",options.axis_y_pointer_size + "px")
                    .style({
                        "font-weight" : options.axis_y_pointer_weight,
                        "font-family" : options.axis_y_pointer_family
                    });


    return ygrid;
};
PykCharts.scaleFunction = function (options) {
    var isNumber = options.k.__proto__._isNumber;
    options.k.scaleIdentification = function (type,data,range,x) {
        var scale;
        switch (type) {
            case "ordinal" :
                scale = d3.scale.ordinal()
                    .domain(data)
                    .rangeRoundBands(range, x);
                return scale;

            case "linear" :
                scale = d3.scale.linear()
                    .domain(data)
                    .range(range);
                return scale;

            case "time" :
                scale = d3.time.scale()
                    .domain(data)
                    .range(range);
                return scale;
        }
    }
    options.k.ordinalXAxisTickFormat = function (domain,extra) {
        var a = d3.selectAll(options.selector + " g.x.axis .tick text")[0],
            len = a.length, comp, flag, largest = 0, rangeband = (extra*2);
        for(var i = 0; i < len; i++) {
            largest = (a[i].getBBox().width > largest) ? a[i].getBBox().width: largest;
        }
        if (rangeband >= (largest+10)) { flag = 1; }
        else if (rangeband >= (largest*0.75) && rangeband < largest) { flag = 2; }
        else if (rangeband >= (largest*0.65) && rangeband < (largest*0.75)) { flag = 3; }
        else if (rangeband >= (largest*0.55) && rangeband < (largest*0.65)) { flag = 4; }
        else if (rangeband >= (largest*0.35) && rangeband < (largest*0.55)) { flag = 5; }
        else if (rangeband <= 20 || rangeband < (largest*0.35)) { flag = 0; }

        for(var i=0; i<len; i++) {
            comp = a[i].__data__;
            if (flag === 0) {
                comp = "";
                d3.selectAll(options.selector + " .x.axis .tick").remove();
            }
            else if (rangeband >= (a[i].getBBox().width+10) && flag === 1) {}
            else if (rangeband >= (a[i].getBBox().width*0.75) && rangeband < a[i].getBBox().width && flag === 2){
                comp = comp.substr(0,5) + "..";
            }
            else if (rangeband >= (a[i].getBBox().width*0.65) && rangeband < (a[i].getBBox().width*0.75) && flag === 3){
                comp = comp.substr(0,4) + "..";
            }
            else if (flag === 4){
                comp = comp.substr(0,3);
            }
            else if (flag === 5){
                comp = comp.substr(0,2);
            }
            d3.select(a[i]).text(comp);
        }

        xaxistooltip = d3.selectAll(options.selector + " g.x.axis .tick text")
            .data(domain);

        if(options.mode === "default") {
            xaxistooltip.on('mouseover',function (d) {
                options.mouseEvent.tooltipPosition(d);
                options.mouseEvent.tooltipTextShow(d);
            })
            .on('mousemove', function (d) {
                options.mouseEvent.tooltipPosition(d);
                options.mouseEvent.tooltipTextShow(d);
            })
            .on('mouseout', function (d) {
                options.mouseEvent.tooltipHide(d);
            });
        }

        return this;
    }
    options.k.ordinalYAxisTickFormat = function (domain) {
        var a = d3.selectAll(options.selector + " g.y.axis .tick text")[0];
        var len = a.length,comp;
        for(i=0; i<len; i++) {
            comp = a[i].textContent;
            if(a[i].getBBox().width > (options.chart_margin_left * 0.9)) {
                comp = comp.substr(0,3) + "..";
            }

            d3.select(a[i]).text(comp);
        }
        yaxistooltip = d3.selectAll(options.selector + " g.y.axis .tick text")
            .data(domain);
        if (options.mode === "default") {
            yaxistooltip.on('mouseover',function (d) {
                options.mouseEvent.tooltipPosition(d);
                options.mouseEvent.tooltipTextShow(d);
            })
            .on('mousemove', function (d) {
                options.mouseEvent.tooltipPosition(d);
                options.mouseEvent.tooltipTextShow(d);
            })
            .on('mouseout', function (d) {
                options.mouseEvent.tooltipHide(d);
            });
       }
        return this;
    }
    options.k.xAxis =  function (svg, gsvg, xScale,extra,domain,tick_values,legendsGroup_height,type,that) {
        if(PykCharts['boolean'](options.axis_x_enable)) {
            var width = options.chart_width,
                height = options.chart_height,
                e = extra;

            if(legendsGroup_height === undefined) {
                legendsGroup_height = 0;
            }
            d3.selectAll(options.selector + " .x.axis").attr("fill",function () {
                if (that && that.axis_x_pointer_color != undefined && that.axis_x_pointer_color != "") {
                    return that.axis_x_pointer_color;
                }
                else {
                    return options.axis_x_pointer_color;
                }
            });
            if(options.axis_x_position === "bottom") {
                gsvg.attr("transform", "translate(0," + (options.chart_height - options.chart_margin_top - options.chart_margin_bottom - legendsGroup_height) + ")");
            }

            var xaxis = PykCharts.Configuration.makeXAxis(options,xScale);

            if(tick_values && tick_values.length) {
                xaxis.tickValues(tick_values);
            }

            gsvg.style("stroke",function () { return options.axis_x_line_color; })
                .call(xaxis)
            if((options.axis_x_data_format === "string") && options.panels_enable === "no") {
                options.k.ordinalXAxisTickFormat(domain,extra);
            }

            d3.selectAll(options.selector + " .x.axis .tick text")
                .attr("font-size",options.axis_x_pointer_size)
                .style({
                    "font-weight" : options.axis_x_pointer_weight,
                    "font-family" : options.axis_x_pointer_family
                });

            if(type && options.axis_x_data_format !== "string") {
                d3.selectAll(options.selector + " .x.axis .domain").remove();
            }
        }

        return this;
    }
    options.k.yAxis = function (svg, gsvg, yScale,domain,tick_values,legendsGroup_width, type,  tick_format_function, that) {
        if(PykCharts['boolean'](options.axis_y_enable)){
            if(!legendsGroup_width) {
                legendsGroup_width = 0;
            }
            var width = options.chart_width,
                height = options.chart_height,
                w = PykCharts['boolean'](options.panels_enable) ? options.w : options.chart_width;

            if(options.axis_y_position === "right") {
                gsvg.attr("transform", "translate(" + (w - options.chart_margin_left - options.chart_margin_right - legendsGroup_width) + ",0)");
            }
            d3.selectAll(options.selector + " .y.axis").attr("fill",function () {
                if (that && that.axis_y_pointer_color != undefined && that.axis_y_pointer_color != "") {
                    return that.axis_y_pointer_color;
                }
                else {
                    return options.axis_y_pointer_color;
                }
            });
            var yaxis = PykCharts.Configuration.makeYAxis(options,yScale,tick_format_function);

            if(tick_values && tick_values.length) {
                yaxis.tickValues(tick_values);
            }

            var mouseEvent = new PykCharts.Configuration.mouseEvent(options);
            gsvg.style("stroke",function () { return options.axis_y_line_color; })
                .call(yaxis);

            if((options.axis_y_data_format === "string") && options.panels_enable === "no") {
                options.k.ordinalYAxisTickFormat(domain);
            }

            d3.selectAll(options.selector + " .y.axis .tick text")
                    .attr("font-size",options.axis_y_pointer_size)
                    .style({
                        "font-weight" : options.axis_y_pointer_weight,
                        "font-family" : options.axis_y_pointer_family
                    });

            if(type && options.axis_y_data_format !== "string") {
                d3.selectAll(options.selector + " .y.axis .domain").remove();
            }
        }
        return this;
    }
    options.k.xAxisTitle = function (gsvg,legendsGroup_height,legendsGroup_width) {
        if(options.axis_x_title) {
            var w = PykCharts['boolean'](options.panels_enable) ? options.w : options.chart_width,
            position;
            if(!legendsGroup_height) {
                legendsGroup_height = 0;
            }
            if(!legendsGroup_width) {
                legendsGroup_width = 0;
            }

            if(!PykCharts['boolean'](options.axis_x_enable)) {
                gsvg.attr("transform", "translate(0," + (options.chart_height - options.chart_margin_top - options.chart_margin_bottom - legendsGroup_height) + ")");
            }

            if(options.axis_x_position === "bottom") {
                position = options.chart_margin_bottom;
            } else if (options.axis_x_position === "top") {
                position = - options.chart_margin_top + options.axis_x_title_size;
            }
             gsvg.append("text")
                .attr({
                    "class" : "x-axis-title",
                    "x" : (w - options.chart_margin_left - options.chart_margin_right -legendsGroup_width)/2,
                    "y" : position
                })
                .style({
                    'text-anchor':'middle',"fill":options.axis_x_title_color,
                    'font-weight':options.axis_x_title_weight,
                    'font-size':options.axis_x_title_size
                })
                .text(options.axis_x_title);
        }
        return this;
    }
    options.k.yAxisTitle = function (gsvg) {
        if(options.axis_y_title) {
            var w = PykCharts['boolean'](options.panels_enable) ? options.w : options.chart_width,
            position,dy;
            if(options.axis_y_position === "left") {
                position = -(options.chart_margin_left - options.axis_y_title_size);
                dy = 0;
            } else if (options.axis_y_position === "right") {
                position = (options.chart_margin_right - options.axis_y_title_size);
                dy = "0.71em";
            }
            gsvg.append("text")
                .attr({
                    "class" : "y-axis-title",
                    "x" : -((options.chart_height - options.chart_margin_bottom - options.chart_margin_top)/2),
                    "transform" : "rotate(-90)",
                    "y" : position,
                    "dy" : dy
                })
                .style({
                    "fill":options.axis_y_title_color,
                    "font-weight":options.axis_y_title_weight,
                    "font-family":options.axis_y_title_family,
                    "font-size":options.axis_y_title_size,
                    "text-anchor":"middle"
                })
                .text(options.axis_y_title);
        }
        return this;
    }
    options.k.isOrdinal = function(svg,container,scale,domain,extra) {
        if(container === ".x.axis" && PykCharts['boolean'](options.axis_x_enable)) {
            svg.select(container).call(PykCharts.Configuration.makeXAxis(options,scale));
            if((options.axis_x_data_format === "string") && options.panels_enable === "no") {
                options.k.ordinalXAxisTickFormat(domain,extra);
            }
        }
        else if (container === ".x.grid") {
            svg.select(container).call(PykCharts.Configuration.makeXGrid(options,scale));
        }
        else if (container === ".y.axis" && PykCharts['boolean'](options.axis_y_enable)) {
            svg.select(container).call(PykCharts.Configuration.makeYAxis(options,scale));
            if((options.axis_y_data_format === "string") && options.panels_enable === "no") {
                options.k.ordinalyAxisTickFormat(domain);
            }
        }
        else if (container === ".y.grid") {
            svg.select(container).call(PykCharts.Configuration.makeYGrid(options,scale));
        }
        return this;
    }
    options.k.xAxisDataFormatIdentification = function (data){
        if(isNumber(data[0].x) || !(isNaN(data[0].x))){
            return "number";
        } else if(!(isNaN(new Date(data[0].x).getTime()))) {
            return "time";
        } else {
            return "string";
        }
    }
    options.k.yAxisDataFormatIdentification = function (data) {
        if(isNumber(data[0].y) || !(isNaN(data[0].y))){
            return "number";
        } else if(!(isNaN(new Date(data[0].y).getTime()))) {
            return "time";
        } else {
            return "string";
        }
    }
    options.k.processXAxisTickValues = function () {
        var values = [], newVal = [];
        var length = options.axis_x_pointer_values.length;
        if(length) {
            for(var i = 0 ; i < length ; i++) {
                if(options.axis_x_data_format === "number") {
                    if((isNumber(options.axis_x_pointer_values[i]) || !(isNaN(options.axis_x_pointer_values[i]))) && options.axis_x_pointer_values[i]!=""){

                        values.push(parseFloat(options.axis_x_pointer_values[i]))
                    }
                } else if(options.axis_x_data_format === "time") {
                    if(!(isNaN(new Date(options.axis_x_pointer_values[i]).getTime()))) {
                        values.push(options.axis_x_pointer_values[i])
                    }
                }
            }
        }
        if(values.length) {
            var len = values.length
            if(options.axis_x_data_format === "time") {
                for(var i=0 ; i<len; i++) {
                    newVal.push(options.k.dateConversion(values[i]));
                }
            } else {
                newVal = values;
            }
        }

        return newVal;
    }
    options.k.processYAxisTickValues = function () {
        var length = options.axis_y_pointer_values.length;
        var values = [];
        if(length) {
            for(var i = 0 ; i < length ; i++) {
                if(options.axis_y_data_format === "number") {
                    if((isNumber(options.axis_y_pointer_values[i]) || !(isNaN(options.axis_y_pointer_values[i]))) && options.axis_y_pointer_values[i]!=""){
                        values.push(options.axis_y_pointer_values[i])
                    }
                }
            }
        }
        return values;
    }
}
var configuration = PykCharts.Configuration;
configuration.makeXAxis = function(options,xScale) {
    var that = this;
    var k = PykCharts.Configuration(options);
    var xaxis = d3.svg.axis()
                    .scale(xScale)
                    .tickSize(options.axis_x_pointer_length)
                    .outerTickSize(options.axis_x_outer_pointer_length)
                    .tickFormat(function (d,i) {
                        if(options.panels_enable === "yes" && options.axis_x_data_format === "string") {
                            return d.substr(0,2);
                        }
                        else {
                            return d;
                        }
                    })
                    .tickPadding(options.axis_x_pointer_padding)
                    .orient(options.axis_x_pointer_position);

    d3.selectAll(options.selector + " .x.axis .tick text")
            .attr("font-size",options.axis_x_pointer_size +"px")
            .style({
                "font-weight" : options.axis_x_pointer_weight,
                "font-family" : options.axis_x_pointer_family
            });

    if(options.axis_x_data_format=== "time" && PykCharts['boolean'](options.axis_x_time_value_datatype)) {
        switch (options.axis_x_time_value_datatype) {
            case "month" :
                a = d3.time.month;
                b = "%b";
                break;

            case "date" :
                a = d3.time.day;
                b = "%d";
                break;

            case "year" :
                a = d3.time.year;
                b = "%Y";
                break;

            case "hours" :
                a = d3.time.hour;
                b = "%H";
                break;

            case "minutes" :
                a = d3.time.minute;
                b = "%M";
                break;
        }
        xaxis.ticks(a,options.axis_x_time_value_interval)
            .tickFormat(d3.time.format(b));

    } else if(options.axis_x_data_format === "number") {
        xaxis.ticks(options.axis_x_no_of_axis_value);
    }

    return xaxis;
};

configuration.makeYAxis = function(options,yScale,tick_format_function) {
    var that = this;
    var k = PykCharts.Configuration(options);
    var yaxis = d3.svg.axis()
                    .scale(yScale)
                    .orient(options.axis_y_pointer_position)
                    .tickSize(options.axis_y_pointer_length)
                    .outerTickSize(options.axis_y_outer_pointer_length)
                    .tickPadding(options.axis_y_pointer_padding)
                    .tickFormat(function (d,i) {
                        if(tick_format_function) {
                            return tick_format_function(d);
                        } else {
                            return d;
                        }
                    });

    d3.selectAll(options.selector + " .y.axis .tick text")
                .attr("font-size",options.axis_y_pointer_size +"px")
                .style({
                    "font-weight" : options.axis_y_pointer_weight,
                    "font-family" : options.axis_y_pointer_family
                });

    /*if(options.axis_y_data_format=== "time" && PykCharts['boolean'](options.axis_y_time_value_type)) {
        switch (options.axis_y_time_value_datatype) {
            case "month" :
                a = d3.time.month;
                b = "%b";
                break;

            case "date" :
                a = d3.time.day;
                b = "%d";
                break;

            case "year" :
                a = d3.time.year;
                b = "%Y";
                break;

            case "hours" :
                a = d3.time.hour;
                b = "%H";
                break;

            case "minutes" :
                a = d3.time.minute;
                b = "%M";
                break;
        }
        xaxis.ticks(a,options.axis_y_time_value_unit)
            .tickFormat(d3.time.format(b));

    }else */if(options.axis_y_data_format === "number"){
        yaxis.ticks(options.axis_y_no_of_axis_value);
    }
    return yaxis;
};

PykCharts.crossHairMovement = function (options) {
    var that = this;
    var mouseEvent = PykCharts.Configuration.mouseEvent(options);
    that.tooltip = configuration.tooltipp;
    that.cross_hair_v = configuration.cross_hair_v;
    that.cross_hair_h = configuration.cross_hair_h;
    that.focus_circle = configuration.focus_circle;
    that.pt_circle = configuration.pt_circle;
    that.start_pt_circle = configuration.start_pt_circle;
    mouseEvent.crossHairPosition = function(new_data,xScale,yScale,dataLineGroup,lineMargin,domain,type,tooltipMode,panels_enable,container_id,no_of_panel_in_row){
        if((PykCharts['boolean'](options.crosshair_enable) || PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.axis_onhover_highlight_enable))  && options.mode === "default") {
            var offset =  options.k.__proto__._offset;
            var selectSVG = document.querySelector(options.selector + " #"+dataLineGroup[0][0][0].parentNode.parentNode.id),
                width_percentage = 0,
                height_percentage = 0;
            if (!PykCharts['boolean'](panels_enable)) {
                width_percentage = parseFloat(d3.select(selectSVG).style("width")) / options.chart_width;
                height_percentage = parseFloat(d3.select(selectSVG).style("height")) / options.chart_height;
            } else {
                width_percentage = 1;
                height_percentge = 1;
            }
            var legendsGroup_height = options.legendsGroup_height ? options.legendsGroup_height: 0,
                offsetLeft =  ((options.chart_margin_left + lineMargin) * width_percentage) + offset(selectSVG).left,
                offsetTop = offset(selectSVG).top,
                number_of_lines = new_data.length,
                left = options.chart_margin_left,
                right = options.chart_margin_right,
                top = options.chart_margin_top,
                bottom = options.chart_margin_bottom,
                w = options.chart_width,
                h = options.chart_height,
                group_index = parseInt(PykCharts.getEvent().target.id.substr((PykCharts.getEvent().target.id.length-1),1)),
                c = b - a,
                x = PykCharts.getEvent().pageX  - offsetLeft,
                y = PykCharts.getEvent().pageY - offsetTop - top,
                x_range = [];
            if(options.axis_x_data_format==="string") {
                x_range = xScale.range();
            } else {
                temp = xScale.range();
                pad = (temp[1]-temp[0])/(new_data[0].data.length-1);
                len = new_data[0].data.length;
                strt = 0;
                for(i = 0;i<len;i++){
                    x_range[i] = strt;
                    strt = strt + pad;
                }
            }
            var y_range = yScale.range(),
                y_range_length = y_range.length;
            var j,tooltpText,active_x_tick,active_y_tick = [],left_diff,right_diff,
                pos_line_cursor_x,pos_line_cursor_y = [],right_tick,left_tick,
                range_length = x_range.length,colspan,top_tick;
            for(j = 0;j < range_length;j++) {
                if((j+1) >= range_length) {
                    return false;
                }
                else {
                    if((right_tick === x_range[j] && left_tick === x_range[j+1]) && (top_tick === y_range[0])) {
                        return false;
                    }
                    else if((x >= (width_percentage*x_range[j]) && x <= width_percentage*x_range[j+1]) && (y < (y_range[0] + legendsGroup_height))) {
                        left_tick = width_percentage*x_range[j], right_tick = width_percentage*x_range[j+1];
                        top_tick = y_range[0];
                        left_diff = (left_tick - x), right_diff = (x - right_tick);
                        if(left_diff >= right_diff) {
                            active_x_tick = new_data[0].data[j].x;
                            active_y_tick.push(new_data[0].data[j].y);
                            tooltipText = new_data[0].data[j].tooltip || new_data[0].data[j].y;
                        }
                        else {
                            active_x_tick = new_data[0].data[j+1].x;
                            active_y_tick.push(new_data[0].data[j+1].y);
                            tooltipText = new_data[0].data[j+1].tooltip || new_data[0].data[j+1].y; // Line Chart ONLY!
                        }
                        pos_line_cursor_x = (xScale(active_x_tick) + lineMargin + left);
                        pos_line_cursor_y = (yScale(tooltipText) + top);
                        switch(type) {
                            case "multi_series_line" :
                                var test = [];
                                d3.selectAll(options.selector+" #pyk-tooltip").classed({"pyk-tooltip":false,"pyk-multiline-tooltip":true,"pyk-tooltip-table":true});
                                var len_data = new_data[0].data.length,tt_row=""; // Assumption -- number of Data points in different groups will always be equal
                                active_y_tick = [];
                                for(var a=0;a < number_of_lines;a++) {
                                    for(var b=0;b < len_data;b++) {
                                        if(options.axis_x_data_format === "time") {
                                            cond = Date.parse(active_x_tick) === Date.parse(new_data[a].data[b].x);
                                        } else {
                                            cond = new_data[a].data[b].x === active_x_tick;
                                        }
                                        if(cond) {
                                            active_y_tick.push(new_data[a].data[b].y);
                                            test.push(yScale(new_data[a].data[b].y) + top);
                                            tt_row += "<tr><td>"+new_data[a].name+"</td><td><b>"+ (new_data[a].data[b].tooltip || (typeof new_data[a].data[b].y === "string" ? new_data[a].data[b].y : PykCharts.numberFormat(new_data[a].data[b].y))) +"</b></td></tr>";
                                        }
                                    }
                                }

                                pos_line_cursor_x += 6;
                                tooltipText = "<table><thead><th colspan='2'>"+active_x_tick+"</th></thead><tbody>"+tt_row+"</tbody></table>";
                                if(PykCharts['boolean'](options.tooltip_enable)) {
                                    this.tooltipPosition(tooltipText,pos_line_cursor_x,(y),60,-15,group_index,width_percentage,height_percentage,type);
                                    this.tooltipTextShow(tooltipText);
                                }
                                (options.crosshair_enable) ? this.crossHairShowMultipleline(pos_line_cursor_x,top,pos_line_cursor_x,(h - bottom),pos_line_cursor_x,test,new_data): null;
                            break;
                            case "panels_of_line":
                                pos_line_cursor_x += 5;
                                var len_data = new_data[0].data.length,
                                    multiply_value = h,
                                    multiply_by = 0,
                                    final_displacement = 0;
                                for(var a=0;a < number_of_lines;a++) {
                                    var div_offset = offset(document.querySelector(options.selector)),
                                        svg_offset = offset(document.querySelector(options.selector + " #"+container_id+"-"+a));

                                    var left_offset = svg_offset.left - div_offset.left;
                                    var top_offset = svg_offset.top - div_offset.top;
                                    for(var b=0;b < len_data;b++) {
                                        if(options.axis_x_data_format === "time") {
                                            cond = Date.parse(active_x_tick)===Date.parse(new_data[a].data[b].x);
                                        } else {
                                            cond = new_data[a].data[b].x === active_x_tick;
                                        }
                                        if(cond) {
                                            active_y_tick.push(new_data[a].data[b].y);
                                            tooltipText = (new_data[a].data[b].tooltip || new_data[a].data[b].y);
                                            if (a%no_of_panel_in_row == 0 && a != 0) {
                                            ++multiply_by;
                                            final_displacement = multiply_value * multiply_by;
                                            }
                                            pos_line_cursor_y = (yScale(new_data[a].data[b].y) + top);
                                            this.tooltipPosition(tooltipText,(pos_line_cursor_x+left_offset-15-30),(pos_line_cursor_y + final_displacement),-15,-15,a,width_percentage,height_percentage,type);
                                            this.tooltipTextShow(tooltipText,type,a);
                                            (options.crosshair_enable) ? this.crossHairShowPanelOfLine(pos_line_cursor_x,top,pos_line_cursor_x,(h - bottom),pos_line_cursor_x,pos_line_cursor_y,a,container_id): null;
                                        }
                                    }
                                }
                            break;
                            case "lineChart":
                            case "areaChart":
                                if(PykCharts['boolean'](options.tooltip_enable)) {
                                    if((options.tooltip_mode).toLowerCase() === "fixed") {
                                        this.tooltipPosition(tooltipText,-options.chart_margin_left,(pos_line_cursor_y),-14,23,group_index,width_percentage,height_percentage,type);
                                    } else if((options.tooltip_mode).toLowerCase() === "moving") {
                                        this.tooltipPosition(tooltipText,(pos_line_cursor_x-options.chart_margin_left + 10),(pos_line_cursor_y-5),0,-45,group_index,width_percentage,height_percentage,type);
                                    }
                                    this.tooltipTextShow(tooltipText);
                                }
                                (options.crosshair_enable) ? this.crossHairShowLineArea(pos_line_cursor_x,top,pos_line_cursor_x,(h - bottom),pos_line_cursor_x,pos_line_cursor_y): null;
                            break;
                            case "stackedAreaChart":
                                var test = [];
                                d3.selectAll(options.selector+" #pyk-tooltip").classed({"pyk-tooltip":false,"pyk-multiline-tooltip":true,"pyk-tooltip-table":true});
                                var len_data = new_data[0].data.length,tt_row=""; // Assumption -- number of Data points in different groups will always be equal
                                active_y_tick = [];
                                for(var a=0;a < number_of_lines;a++) {
                                    for(var b=0;b < len_data;b++) {
                                        if(options.axis_x_data_format === "time") {
                                            cond = Date.parse(active_x_tick)===Date.parse(new_data[a].data[b].x);
                                        } else {
                                            cond = new_data[a].data[b].x === active_x_tick;
                                        }
                                        if(cond) {
                                            active_y_tick.push(new_data[a].data[b].y);
                                            test.push(yScale(new_data[a].data[b].y+new_data[a].data[b].y0) + top + options.legendsGroup_height);
                                            tt_row += "<tr><td>"+new_data[a].name+"</td><td><b>"+ (new_data[a].data[b].tooltip || new_data[a].data[b].y) +"</b></td></tr>";
                                        }
                                    }
                                }
                                pos_line_cursor_x += 6;
                                tooltipText = "<table><thead><th colspan='2'>"+active_x_tick+"</th></thead><tbody>"+tt_row+"</tbody></table>";
                                if(PykCharts['boolean'](options.tooltip_enable)) {
                                    group_index = 1;
                                    this.tooltipPosition(tooltipText,pos_line_cursor_x,(y),60,70,group_index,width_percentage,height_percentage);
                                    this.tooltipTextShow(tooltipText);
                                }
                                (options.crosshair_enable) ? this.crossHairShowStackedArea(pos_line_cursor_x,top+legendsGroup_height,pos_line_cursor_x,(h - bottom),pos_line_cursor_x,test,new_data): null;
                            break;
                        }
                        if(!PykCharts['boolean'](panels_enable)) {
                            this.axisHighlightShow(active_y_tick,options.selector+" .y.axis",domain);
                            this.axisHighlightShow(active_x_tick,options.selector+" .x.axis",domain);
                        }
                    }
                }
            }
        }
    }
    mouseEvent.crossHairShowLineArea = function (x1,y1,x2,y2,cx,cy) {
        if(PykCharts['boolean'](options.crosshair_enable)) {
            d3.selectAll(options.selector+ " .line-cursor").style("display","block");
            d3.select(options.selector + " #cross-hair-v")
                .attr({
                    "x1" : x1,
                    "y1" : y1,
                    "x2" : x2,
                    "y2" : y2
                });
            d3.select(options.selector + " #cross-hair-h")
                .attr({
                    "x1" : options.chart_margin_left,
                    "y1" : cy,
                    "x2" : (options.chart_width - options.chart_margin_right),
                    "y2" : cy
                });
            that.focus_circle.style("display","block")
                .attr("transform", "translate(" + cx + "," + cy + ")");
        }
        return this;
    }
    mouseEvent.crossHairShowMultipleline = function (x1,y1,x2,y2,cx,cy,new_data) {
        var all_lines = d3.selectAll("#clipPath path")[0];
        if(PykCharts['boolean'](options.crosshair_enable)) {
            that.cross_hair_v.style("display","block");
            d3.select(options.selector + " #cross-hair-v")
                .attr({
                    "x1" : (x1 - 5),
                    "y1" : y1,
                    "x2" : (x2 - 5),
                    "y2" : y2
                });
            for(var j=0; j<new_data.length; j++) {
                if (cy[j]) {
                    if (all_lines[j].getAttribute("click_status") === "no") {
                        d3.select(options.selector+" #f_circle"+j).style("display","block")
                            .attr("transform", "translate(" + (cx-3) + "," + cy[j] + ")");

                        d3.select(options.selector+" #f_circle" + j + " circle")
                            .attr("fill", "#ddd");
                    } else {
                        d3.select(options.selector+" #f_circle"+j).style("display","block")
                            .attr("transform", "translate(" + (cx-3) + "," + cy[j] + ")");

                        d3.select(options.selector+" #f_circle" + j + " circle")
                            .attr("fill",  d3.select(options.selector+" #f_circle" + j + " circle").attr("actual_color"));
                    }
                } else {
                    d3.select(options.selector+" #f_circle"+j).style("display","none")
                }
            }
        }
        return this;
    }
    mouseEvent.crossHairShowPanelOfLine = function (x1,y1,x2,y2,cx,cy,group_index,container_id) {
        if(PykCharts['boolean'](options.crosshair_enable)) {
            d3.selectAll(options.selector+" .line-cursor").style("display","block");
            d3.selectAll(options.selector+" #cross-hair-v")
                .attr({
                    "x1" : (x1 - 5),
                    "y1" : y1,
                    "x2" : (x2 - 5),
                    "y2" : y2
                });
            d3.select(options.selector+" #"+container_id+"-"+group_index+" #cross-hair-h")
                .attr({
                    "x1" : options.chart_margin_left,
                    "y1" : cy,
                    "x2" : (options.w - options.chart_margin_right),
                    "y2" : cy
                });
            d3.select(options.selector+" #"+container_id+"-"+group_index+" .focus").style("display","block")
                .attr("transform", "translate(" + (cx - 5) + "," + cy + ")");
        }
        return this;
    }
    mouseEvent.crossHairShowStackedArea = function (x1,y1,x2,y2,cx,cy,new_data) {
        if(PykCharts['boolean'](options.crosshair_enable)) {
            d3.selectAll(options.selector+" .line-cursor").style("display","block");
            d3.selectAll(options.selector+" #cross-hair-v")
                .attr({
                    "x1" : (x1 - 5),
                    "y1" : y1,
                    "x2" : (x2 - 5),
                    "y2" : y2
                });
            for(var j=0; j<new_data.length; j++) {
                d3.select(options.selector+" #f_circle"+j).style("display","block")
                    .attr("transform", "translate(" + (cx-3) + "," + cy[j] + ")");
            }
        }
        return this;
    }
    mouseEvent.crossHairHide = function (type) {
        if(PykCharts['boolean'](options.crosshair_enable)) {
            that.cross_hair_v.style("display","none");
            if(type === "lineChart" || type === "areaChart") {
                that.cross_hair_h.style("display","none");
                that.focus_circle.style("display","none");
            } else if(type === "multilineChart" || type === "stackedAreaChart") {
                d3.selectAll(options.selector+" .line-cursor").style("display","none");
                d3.selectAll(options.selector+" .focus").style("display","none");
            }
        }
        return this;
    }
    mouseEvent.tooltipPosition = function (d,xPos,yPos,xDiff,yDiff,group_index,width_percentage,height_percentage,type) {
        if(PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.annotation_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string") {
            if(xPos !== undefined){
                var offset = options.k.__proto__._offset,
                    selector = options.selector.substr(1,options.selector.length),
                    selector_element = document.getElementById(selector),
                    width_tooltip = document.querySelector("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector) ? parseFloat(d3.select("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector).style("width")) : 0,
                    height_tooltip = document.querySelector("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector) ? parseFloat(d3.select("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector).style("height")) : 0,
                    tooltip = d3.select("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector),
                    offset_left = offset(selector_element).left,
                    offset_top = offset(selector_element).top;

                if (type === "lineChart" || type === "areaChart") {
                    var place_tooltip_from_top = yPos * height_percentage;
                } else {
                    var place_tooltip_from_top = yPos - ((height_tooltip)/2) * height_percentage;
                }
                tooltip
                    .style({
                        "display": "block",
                        "top": place_tooltip_from_top + offset_top + "px",
                        "left": ((xPos + options.chart_margin_left) * width_percentage) + offset_left + "px"
                });
            } else {
                that.tooltip
                    .style({
                        "display" : "block",
                        "top" : (PykCharts.getEvent().pageY - 20) + "px",
                        "left" : (PykCharts.getEvent().pageX + 30) + "px"
                    });
            }
        return that.tooltip;
        }
    }
    mouseEvent.tooltipTextShow = function (d,type,group_index) {
        var selector = options.selector.substr(1,options.selector.length)
        if(PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.annotation_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string") {
            if(type === "panels_of_line") {
                d3.selectAll("#tooltip-svg-container-"+group_index +"-pyk-tooltip"+selector).html(d);
            } else {
                that.tooltip.html(d);
            }
            return this;
        }
    }
    mouseEvent.tooltipHide = function (d,panels_enable,type) {
        if(PykCharts['boolean'](options.tooltip_enable) || PykCharts['boolean'](options.annotation_enable) || options.axis_x_data_format === "string" || options.axis_y_data_format === "string") {
            if(panels_enable === "yes" && type === "multilineChart") {
                return d3.selectAll(".pyk-tooltip").style("display","none");
            }
            else {
                return that.tooltip.style("display", "none");
            }
        }
    }
    return mouseEvent;
}
PykCharts.multiD.line = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
        PykCharts.crossHair(that);
        PykCharts.annotation(that);
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);
        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();

        if(that.mode === "default") {
            that.k.loading();
        }

        var multiDimensionalCharts = theme.multiDimensionalCharts,
            stylesheet = theme.stylesheet,
            optional = options.optional;

        that.pointer_overflow_enable = options.pointer_overflow_enable ? options.pointer_overflow_enable.toLowerCase() : stylesheet.pointer_overflow_enable;
        that.crosshair_enable = options.crosshair_enable ? options.crosshair_enable.toLowerCase() : multiDimensionalCharts.crosshair_enable;
        that.curvy_lines_enable = options.curvy_lines_enable ? options.curvy_lines_enable.toLowerCase() : multiDimensionalCharts.curvy_lines_enable;
        that.interpolate = PykCharts['boolean'](that.curvy_lines_enable) ? "cardinal" : "linear";
        that.panels_enable = "no";

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                // that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("line",data);

            that.axis_y_data_format = "number";
            that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
            if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
                console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_"+"15");
            }

            if (that.axis_x_data_format === "string") {
                that.data_sort_enable = "no";
            }
            else {
                that.data_sort_enable = "yes";
                that.data_sort_type = (that.axis_x_data_format === "time") ? "date" : "numerically";
                that.data_sort_order = "ascending";
            }
            PykCharts.multiD.lineFunctions(options,that,"line");
        }
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};
PykCharts.multiD.multiSeriesLine = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function (pykquery_data){
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
        PykCharts.crossHair(that);
        PykCharts.annotation(that);
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);
        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();

        if(that.mode === "default") {
            that.k.loading();
        }

        var multiDimensionalCharts = theme.multiDimensionalCharts,
            stylesheet = theme.stylesheet,
            optional = options.optional;

        that.pointer_overflow_enable = options.pointer_overflow_enable ? options.pointer_overflow_enable.toLowerCase() : stylesheet.pointer_overflow_enable;
        that.crosshair_enable = options.crosshair_enable ? options.crosshair_enable.toLowerCase() : multiDimensionalCharts.crosshair_enable;
        that.curvy_lines_enable = options.curvy_lines_enable ? options.curvy_lines_enable.toLowerCase() : multiDimensionalCharts.curvy_lines_enable;
        that.interpolate = PykCharts['boolean'](that.curvy_lines_enable) ? "cardinal" : "linear";
        that.panels_enable = "no";

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("line",data);
            that.axis_y_data_format = "number";
            that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
            if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
                console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
            }

            if (that.axis_x_data_format === "string") {
                that.data_sort_enable = "no";
            }
            else {
                that.data_sort_enable = "yes";
                that.data_sort_type = (that.axis_x_data_format === "time") ? "date" : "numerically";
                that.data_sort_order = "ascending";
            }
            PykCharts.multiD.lineFunctions(options,that,"multi_series_line");
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};
PykCharts.multiD.panelsOfLine = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function (pykquery_data){

        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');

        PykCharts.crossHair(that);
        PykCharts.annotation(that);
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
            that.k.loading();
        }

        var multiDimensionalCharts = theme.multiDimensionalCharts,
            stylesheet = theme.stylesheet,
            optional = options.optional;

        that.pointer_overflow_enable = options.pointer_overflow_enable ? options.pointer_overflow_enable.toLowerCase() : stylesheet.pointer_overflow_enable;
        that.crosshair_enable = options.crosshair_enable ? options.crosshair_enable.toLowerCase() : multiDimensionalCharts.crosshair_enable;
        that.curvy_lines_enable = options.curvy_lines_enable ? options.curvy_lines_enable.toLowerCase() : multiDimensionalCharts.curvy_lines_enable;
        that.interpolate = PykCharts['boolean'](that.curvy_lines_enable) ? "cardinal" : "linear";
        that.panels_enable = "yes";

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("line",data);
            that.axis_y_data_format = "number";
            that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
            if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
                console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
            }

            if (that.axis_x_data_format === "string") {
                that.data_sort_enable = "no";
            }
            else {
                that.data_sort_enable = "yes";
                that.data_sort_type = (that.axis_x_data_format === "time") ? "date" : "numerically";
                that.data_sort_order = "ascending";
            }
            PykCharts.multiD.lineFunctions(options,that,"panels_of_line");

        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};
PykCharts.multiD.lineFunctions = function (options,chartObject,type) {
    var that = chartObject,
        id = that.selector.substring(1,that.selector.length);

    that.compare_data = that.data;
    that.data_length = that.data.length;
    that.k.remove_loading_bar(id);

    that.dataTransformation = function () {
        that.group_arr = [], that.new_data = [];
        that.ticks = [], that.x_arr = [];


        for(j = 0;j < that.data_length;j++) {
            that.group_arr[j] = that.data[j].name;
        }
        that.uniq_group_arr = that.k.__proto__._unique(that.group_arr);
        that.uniq_color_arr = [];
        var uniq_group_arr_length = that.uniq_group_arr.length;

        for(var k = 0;k < that.data_length;k++) {
            that.x_arr[k] = that.data[k].x;
        }
        var uniq_x_arr = that.k.__proto__._unique(that.x_arr);

        for (k = 0;k < uniq_group_arr_length;k++) {
            if(that.chart_color[k]) {
                that.uniq_color_arr[k] = that.chart_color[k];
            } else {
                for (l = 0;l < that.data_length;l++) {
                    if (that.uniq_group_arr[k] === that.data[l].name && that.data[l].color) {
                        that.uniq_color_arr[k] = that.data[l].color;
                        break;
                    }
                } if(!PykCharts['boolean'](that.uniq_color_arr[k])) {
                    that.uniq_color_arr[k] = that.default_color[0];
                }
            }
        }

        that.flag = 0;
        for (k = 0;k < uniq_group_arr_length;k++) {
            that.new_data[k] = {
                    name: that.uniq_group_arr[k],
                    data: [],
                    color: that.uniq_color_arr[k]
            };
            for (l = 0;l < that.data_length;l++) {
                if (that.uniq_group_arr[k] === that.data[l].name) {
                    that.new_data[k].data.push({
                        x: that.data[l].x,
                        y: that.data[l].y,
                        tooltip: that.data[l].tooltip,
                        annotation: that.data[l].annotation || ""
                    });
                }
            }
        }

        that.new_data_length = that.new_data.length;
        var uniq_x_arr_length = uniq_x_arr.length;

        for (var a = 0;a < that.new_data_length;a++) {
            var uniq_x_arr_copy = that.k.__proto__._unique(that.x_arr)
            ,   every_data_length = that.new_data[a].data.length
            for(var b = 0;b < every_data_length;b++) {
                for(var k = 0;k < uniq_x_arr_length;k++) {
                    if(that.new_data[a].data[b].x == uniq_x_arr_copy[k]) {
                        uniq_x_arr_copy[k] = undefined;
                        break;
                    }
                }
            }
            for (var i = 0; i < uniq_x_arr_length ; i++) {
                if (uniq_x_arr_copy[i] != undefined) {
                    var temp_obj_to_insert_in_new_data = {
                        x: uniq_x_arr_copy[i],
                        y: "NA",
                        tooltip: 0,
                        annotation: ""
                    };
                    that.new_data[a].data.splice(i, 0, temp_obj_to_insert_in_new_data);
                }
            }
        }
        //Removed sorting functionality for multi dimensional line chart.
        //for (var k = 0;k < that.new_data_length;k++) {
           // that.new_data[k].data = that.k.__proto__._sortData(that.new_data[k].data, "x", "name", that);
        //}
    };

    that.calculatePanelInRow = function () {
        var width= parseInt(that.k._getHighestParentsAttribute(that.selector,"width")),total_width;
        if(width) {
            total_width = width;
        } else {
            total_width = d3.select("body").style("width");
        }

        that.no_of_containers_in_row = Math.floor(parseInt(total_width)/that.chart_width);

        if(that.no_of_containers_in_row > that.new_data.length) {
            that.no_of_containers_in_row = that.new_data.length;
        }

        if(total_width < that.chart_width) {
            that.no_of_containers_in_row = 1;
        }
    }

    that.render = function () {
        var id = that.selector.substring(1,that.selector.length);
        that.container_id = id + "_svg";
        that.dataLineGroup = [],that.clicked;
        that.multid = new PykCharts.multiD.configuration(that);
        that.fillColor = new PykCharts.Configuration.fillChart(that,null,options);
        that.transitions = new PykCharts.Configuration.transition(that);

        if(PykCharts["boolean"](that.panels_enable)) {
            that.calculatePanelInRow();
            that.new_width = that.no_of_containers_in_row * that.chart_width;
        }
        if(that.mode === "default") {

            that.k.title(that.new_width);

            if(PykCharts['boolean'](that.panels_enable)) {
                that.w = that.chart_width;
                that.chart_height = that.chart_height;
                that.chart_margin_left = that.chart_margin_left;
                that.chart_margin_right = that.chart_margin_right;

                that.k.backgroundColor(that)
                    .export(that,that.container_id+"-","lineChart",that.panels_enable,that.new_data,that.new_width)
                    .emptyDiv(that.selector)
                    .subtitle(that.new_width);

                d3.select(that.selector).append("div")
                        .attr("id","panels_of_line_main_div")

                that.k.liveData(that);
                that.optionalFeature().chartType();
                that.reducedWidth = that.w - that.chart_margin_left - that.chart_margin_right;
                that.reducedHeight = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
                that.fill_data = [];
                if(that.axis_x_data_format === "time") {
                    for(i = 0;i<that.new_data_length;i++) {

                        that.new_data[i].data.forEach(function (d) {
                            d.x = that.k.dateConversion(d.x);
                        });

                    }
                    that.data.forEach(function (d) {
                        d.x =that.k.dateConversion(d.x);
                    });
                }

                that.renderPanelOfLines();
            } else {
                that.k.backgroundColor(that)
                    .export(that,"#"+that.container_id+"-1","lineChart")
                    .emptyDiv(that.selector)
                    .subtitle();

                that.w = that.chart_width;
                that.reducedWidth = that.w - that.chart_margin_left - that.chart_margin_right;
                that.reducedHeight = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
                var selector = that.selector.substr(1,that.selector.length);
                d3.selectAll("#tooltip-svg-container-" + 1 + "-pyk-tooltip"+selector)
                    .remove();
                that.k.liveData(that)
                        .makeMainDiv(that.selector,1)
                        .tooltip(true,that.selector,1,that.flag);

                that.optionalFeature()
                        .chartType();
                if(that.axis_x_data_format === "time") {
                    for(i = 0;i<that.new_data_length;i++) {

                        that.new_data[i].data.forEach(function (d) {
                            d.x = that.k.dateConversion(d.x);
                        });

                    }
                    that.data.forEach(function (d) {
                        d.x =that.k.dateConversion(d.x);
                    });
                }
                try {
                    if(that.type === "multilineChart" && type === "line" ) {
                        throw "Invalid data in the JSON";
                    }
                }
                catch (err) {
                    console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+that.selector+".\""+err+"\"  Visit www.pykcharts.com/errors#error_6");
                    return;
                }

                that.renderLineChart();
            }
            that.k.createFooter(that.new_width)
                .lastUpdatedAt()
                .credits()
                .dataSource();
            if(PykCharts['boolean'](that.annotation_enable)) {
                that.annotation();
            }
        }
        else if(that.mode === "infographics") {
            if(PykCharts['boolean'](that.panels_enable)) {

                that.k.backgroundColor(that)
                    .export(that,"#"+that.container_id+"-","lineChart",that.panels_enable,that.new_data,that.new_width)
                    .emptyDiv(that.selector);
                d3.select(that.selector).append("div")
                        .attr("id","panels_of_line_main_div")
                that.optionalFeature().chartType();
                that.w = that.chart_width;
                that.chart_height = that.chart_height;
                if(that.axis_x_data_format === "time") {
                    for(i = 0;i<that.new_data_length;i++) {

                        that.new_data[i].data.forEach(function (d) {
                            d.x = that.k.dateConversion(d.x);
                        });

                    }
                    that.data.forEach(function (d) {
                        d.x =that.k.dateConversion(d.x);
                    });
                }
                that.reducedWidth = that.w - that.chart_margin_left - that.chart_margin_right;
                that.reducedHeight = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
                that.fill_data = [];

                that.renderPanelOfLines();
            } else {

                that.k.backgroundColor(that)
                    .export(that,"#"+that.container_id+"-0","lineChart")
                    .emptyDiv(that.selector);

                that.w = that.chart_width;
                that.reducedWidth = that.w - that.chart_margin_left - that.chart_margin_right;
                that.reducedHeight = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;

                that.k.makeMainDiv(that.selector,1)

                that.optionalFeature()
                        .chartType();
                if(that.axis_x_data_format === "time") {
                    for(i = 0;i<that.new_data_length;i++) {
                        that.new_data[i].data.forEach(function (d) {
                            d.x = that.k.dateConversion(d.x);
                        });

                    }
                    that.data.forEach(function (d) {
                        d.x =that.k.dateConversion(d.x);
                    });
                }

                try {
                    if(that.type === "multilineChart" && type === "line" ) {
                        throw "Invalid data in the JSON";
                    }
                }
                catch (err) {
                    console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+that.selector+".\""+err+"\"  Visit www.pykcharts.com/errors#error_6");
                    return;
                }

                that.renderLineChart();
            }
        }

        if(!PykCharts['boolean'](that.panels_enable)) {
            var resize = that.k.resize(that.svgContainer);
            that.k.__proto__._ready(resize);
            window.addEventListener('resize', function(event){
                return that.k.resize(that.svgContainer);
            });
        } else {
            var resize = that.k.resize(null,that.new_width);
            that.k.__proto__._ready(resize);
            window.addEventListener('resize', function(event){
                that.calculatePanelInRow();
                return that.k.resize(null,that.new_width);
            });
        }
    };

    that.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("line",data);
            that.data_length = that.data.length;
            var compare = that.k.checkChangeInData(that.data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            that.dataTransformation();

            if(data_changed || (PykCharts['boolean'](that.zoom_enable) && that.count > 1 && that.count <= that.zoom_level) || that.transition_duration) {
                that.k.lastUpdatedAt("liveData");
                that.mouseEvent.tooltipHide(null,that.panels_enable,that.type);
                that.mouseEvent.crossHairHide(that.type);
                that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
                that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
            }
            that.optionalFeature().hightLightOnload();
            if(that.axis_x_data_format === "time") {
                for(var i = 0;i<that.new_data_length;i++) {

                    that.new_data[i].data.forEach(function (d) {
                        d.x = that.k.dateConversion(d.x);
                    });

                }
                that.data.forEach(function (d) {
                    d.x =that.k.dateConversion(d.x);
                });
            }
            if(PykCharts['boolean'](that.panels_enable)) {
                for (var i = 0;i < that.previous_length;i++) {
                    var element = document.querySelector(that.selector + " #panels_of_line_main_div #chart-container-"+i);
                    element.parentNode.removeChild(element);
                }
                that.renderPanelOfLines();
            }

            if(that.type === "multilineChart" && !PykCharts['boolean'](that.panels_enable)) {
                document.querySelector(that.selector +" #chart-container-1").innerHTML = null;
                that.renderLineChart();
            }

            if(that.type === "lineChart") {

                that.optionalFeature()
                    .createChart("liveData")
                    .ticks();

                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values)
                        .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values)
                        .yGrid(that.svgContainer,that.group,that.yScale)
                        .xGrid(that.svgContainer,that.group,that.xScale)

                if(PykCharts['boolean'](that.annotation_enable)) {
                    that.annotation();
                }
            }

        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    that.optionalFeature = function (){
        var id = that.selector.substring(1,that.selector.length);
        var optional = {
            chartType: function () {
                for(var j = 0;j < that.data_length;j++) {
                    for(var k = (j+1);k < that.data_length;k++) {
                        if(that.data[j].x === that.data[k].x) {
                            that.type = "multilineChart";
                            break;
                        }
                    }
                }
                that.type = that.type || "lineChart";
                return this;
            },
            hightLightOnload: function () {
                if(that.type === "multilineChart") {
                    if(that.new_data_length > 0 && that.highlight) {
                        for(var i = 0;i< that.uniq_group_arr.length;i++) {

                            if(that.highlight.toLowerCase() === that.uniq_group_arr[i].toLowerCase()) {
                                that.new_data[i].highlight = true;
                            } else
                            {
                                that.new_data[i].highlight = false;
                            }
                        }
                    }
                }
                return this;
            },
            svgContainer: function (i){
                var element = document.getElementById(id);
                if(that.type === "multilineChart" && !element.classList.contains('PykCharts-line-chart')) {
                    element.className += " PykCharts-twoD PykCharts-line-chart PykCharts-multi-series2D";
                } else if(that.type === "lineChart" && !element.classList.contains('PykCharts-line-chart')) {
                    element.className += " PykCharts-twoD PykCharts-line-chart";
                }
                that.svgContainer = d3.select(that.selector+" #chart-container-"+i)
                    .append("svg:svg")
                    .attr({
                        "id": that.container_id+"-" + i,
                        "width": that.w,
                        "height": that.chart_height,
                        "class": "svgcontainer",
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.w + " " + that.chart_height
                    });

                if(PykCharts['boolean'](that.pointer_overflow_enable) && !PykCharts['boolean'](that.panels_enable)) {
                    that.svgContainer.style("overflow","visible");
                }

                return this;
            },
            createGroups : function (i) {
                that.group = that.svgContainer.append("g")
                    .attr({
                        "id": that.type+"-svg",
                        "transform": "translate("+ that.chart_margin_left +","+ that.chart_margin_top +")"
                    });

                if(PykCharts['boolean'](that.chart_grid_y_enable)){
                    that.group.append("g")
                        .attr({
                            "id": "ygrid",
                            "class": "y grid-line"
                        });
                }
                if(PykCharts['boolean'](that.chart_grid_x_enable)){
                    that.group.append("g")
                        .attr({
                            "id": "xgrid",
                            "class": "x grid-line"
                        });
                }

                that.clip = that.svgContainer.append("svg:clipPath")
                    .attr("id","clip" + i + that.selector)
                    .append("svg:rect")
                    .attr({
                        "width": that.reducedWidth,
                        "height": that.reducedHeight
                    });

                that.chartBody = that.svgContainer.append("g")
                    .attr({
                        "id": "clipPath",
                        "clip-path": "url(#clip" + i + that.selector + ")",
                        "transform": "translate("+ that.chart_margin_left +","+ that.chart_margin_top +")"
                    });

                return this;
            },
            axisContainer : function () {

                if(PykCharts['boolean'](that.axis_x_enable) || that.axis_x_title){
                    that.xGroup = that.group.append("g")
                        .attr({
                            "id": "xaxis",
                            "class": "x axis"
                        });
                }
                if(PykCharts['boolean'](that.axis_y_enable) || that.axis_y_title) {
                    that.yGroup = that.group.append("g")
                        .attr({
                            "id": "yaxis",
                            "class": "y axis"
                        });
                }
                return this;
            },
            createChart : function (evt,index) {
                that.previous_length = that.new_data.length;

                that.x_tick_values = that.k.processXAxisTickValues();
                that.y_tick_values = that.k.processYAxisTickValues();

                var x_domain,x_data = [],y_data,y_range,x_range,y_domain,min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;

                if(that.axis_y_data_format === "number") {
                    max = d3.max(that.new_data, function(d) { return d3.max(d.data, function(k) { return k.y; }); });
                    min = d3.min(that.new_data, function(d) { return d3.min(d.data, function(k) { return k.y; }); });
                    y_domain = [min,max];

                    y_data = that.k.__proto__._domainBandwidth(y_domain,2);
                    min_y_tick_value = d3.min(that.y_tick_values);
                    max_y_tick_value = d3.max(that.y_tick_values);

                    if(y_data[0] > min_y_tick_value) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(y_data[1] < max_y_tick_value) {
                        y_data[1] = max_y_tick_value;
                    }

                    y_range = [that.reducedHeight, 0];
                    that.yScale = that.k.scaleIdentification("linear",y_data,y_range);

                } else if(that.axis_y_data_format === "string") {
                    that.new_data[0].data.forEach(function(d) { y_data.push(d.y); });
                    y_range = [0,that.reducedHeight];
                    that.yScale = that.k.scaleIdentification("ordinal",y_data,y_range,0);

                } else if (that.axis_y_data_format === "time") {
                    y_data = d3.extent(that.data, function (d) {
                        return new Date(d.x);
                    });

                    min_y_tick_value = d3.min(that.y_tick_values, function (d) {
                        return new Date(d);
                    });

                    max_y_tick_value = d3.max(that.y_tick_values, function (d) {
                        return new Date(d);
                    });

                    if(new Date(y_data[0]) > new Date(min_y_tick_value)) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(new Date(y_data[1]) < new Date(max_y_tick_value)) {
                        y_data[1] = max__tick_value;
                    }

                    y_range = [that.reducedHeight, 0];
                    that.yScale = that.k.scaleIdentification("time",y_data,y_range);
                }
                that.xdomain = [];
                if(that.axis_x_data_format === "number") {
                    max = d3.max(that.new_data, function(d) { return d3.max(d.data, function(k) { return +k.x; }); });
                    min = d3.min(that.new_data, function(d) { return d3.min(d.data, function(k) { return +k.x; }); });
                    x_domain = [min,max];
                    x_data = that.k.__proto__._domainBandwidth(x_domain,2);

                    min_x_tick_value = d3.min(that.x_tick_values);
                    max_x_tick_value = d3.max(that.x_tick_values);

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }

                    x_range = [0 ,that.reducedWidth];
                    that.xScale = that.k.scaleIdentification("linear",x_data,x_range);
                    that.extra_left_margin = 0;
                    that.new_data[0].data.forEach(function (d) {
                        that.xdomain.push(+d.x);
                    })

                } else if(that.axis_x_data_format === "string") {
                    that.new_data[0].data.forEach(function(d) { x_data.push(d.x); });
                    x_range = [0 ,that.reducedWidth];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data,x_range,0);
                    that.extra_left_margin = (that.xScale.rangeBand() / 2);
                    that.xdomain = that.xScale.domain();

                } else if (that.axis_x_data_format === "time") {
                    max = d3.max(that.new_data, function(d) { return d3.max(d.data, function(k) { return k.x; }); });
                    min = d3.min(that.new_data, function(d) { return d3.min(d.data, function(k) { return k.x; }); });
                    x_data = [min,max];
                    x_range = [0 ,that.reducedWidth];

                    min_x_tick_value = d3.min(that.x_tick_values, function (d) {
                        d = that.k.dateConversion(d);
                        return d;
                    });

                    max_x_tick_value = d3.max(that.x_tick_values, function (d) {
                        d = that.k.dateConversion(d);
                        return d;
                    });

                    if((x_data[0]) > (min_x_tick_value)) {
                        x_data[0] = min_x_tick_value;
                    }
                    if((x_data[1]) < (max_x_tick_value)) {
                        x_data[1] = max_x_tick_value;
                    }
                    that.xScale = that.k.scaleIdentification("time",x_data,x_range);
                    that.extra_left_margin = 0;
                    that.new_data[0].data.forEach(function (d) {
                        that.xdomain.push(d.x);
                    })
                }
                that.count = 1;
                that.zoom_event = d3.behavior.zoom();
                if(!(that.axis_y_data_format==="string" || that.axis_x_data_format==="string")) {
                    that.zoom_event.x(that.xScale)
                        .y(that.yScale)
                        .scale(that.count)
                        .on("zoom",that.zoomed);
                } else {
                    that.zoom_event.y(that.yScale)
                        .scale(that.count)
                        .on("zoom",that.zoomed);
                }

                if(PykCharts['boolean'](that.zoom_enable) && (that.mode === "default")) {
                    if(PykCharts['boolean'](that.panels_enable)){
                        n = that.new_data_length;
                        j = 0;
                    } else {
                        n = 2;
                        j = 1;
                    }
                    for(var i=j;i<n;i++) {
                        d3.selectAll(that.selector + " #"+that.container_id+"-" +i).call(that.zoom_event);
                        d3.selectAll(that.selector + " #"+that.container_id+"-" + i).on("wheel.zoom", null)
                            .on("mousewheel.zoom", null);
                    }
                }

                that.chart_path = d3.svg.line()
                    .defined(function(d) { return !isNaN(d.y); })
                    .x(function(d) { return that.xScale(d.x); })
                    .y(function(d) { return that.yScale(d.y); })
                    .interpolate(that.interpolate);
                var chartType = (that.type === "lineChart") ? "lineChart" : (that.panels_enable === "yes") ? "panels_of_line" : "multi_series_line";
                that.chartPathClass = (that.type === "lineChart") ? "line" : "multi-line";
                if(evt === "liveData" && that.type === "lineChart") {

                        for (var i = 0;i < that.new_data_length;i++) {
                            var data = that.new_data[i].data;
                            var type = that.type + "-svg-" +i;

                            that.svgContainer.select(that.selector + " #"+type)
                                .datum(that.new_data[i].data)
                                .attr("transform", "translate("+ that.extra_left_margin +",0)")
                                .style("stroke", function() {
                                    if(that.new_data[i].highlight && that.type === "multilineChart" && !that.clicked) {
                                        that.highlightLine(this,null);
                                    } else if(that.clicked) {
                                        that.highlightLine(that.selected,null,that.previous_color);
                                    }
                                    else {
                                        d3.select(this).classed({'multi-line-selected':false,'multi-line':true,'multi-line-hover':false});
                                    }
                                    return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                })
                                .attr("data-id",function (d,i) {
                                    return that.new_data[i];
                                });

                            function transition1 (i) {
                                that.dataLineGroup[i].transition()
                                    .duration(that.transitions.duration())
                                    .attrTween("d", function (d) {
                                        var interpolate = d3.scale.quantile()
                                            .domain([0,1])
                                            .range(d3.range(1, data.length + 1));
                                        return function(t) {
                                            return that.chart_path(that.new_data[i].data.slice(0, interpolate(t)));
                                        };
                                    });
                            }
                            transition1(i);

                            d3.selectAll(that.selector+" text#"+ (that.type + "-svg-" + i))
                                .style("fill",function() {
                                    return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                });
                        }
                    if(that.mode === "default") {
                        that.svgContainer
                            .on('mouseout',function (d) {
                                that.mouseEvent.tooltipHide();
                                that.mouseEvent.crossHairHide(that.type);
                                that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
                                that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
                            })
                            .on("mousemove", function(){
                                that.mouseEvent.crossHairPosition(that.new_data,that.xScale,that.yScale,that.dataLineGroup,that.extra_left_margin,that.xdomain,chartType,that.tooltipMode,null,that.container_id);
                            });
                    }
                }
                else { // Static Viz
                    that.clk = true;
                    if(!PykCharts['boolean'](that.panels_enable)) {
                        var i;
                        for (var i = 0;i < that.new_data_length;i++) {
                            var type = that.type + "-svg-" + i;
                            that.dataLineGroup[i] = that.chartBody.append("path");
                            var data = that.new_data[i].data;
                            that.dataLineGroup[i]
                                    .datum(that.new_data[i].data)
                                    .attr({
                                        "class": "lines-hover " + that.chartPathClass,
                                        "id": type,
                                        "transform": "translate("+ that.extra_left_margin +",0)",
                                        "stroke-opacity": function () {
                                            if(that.color_mode === "saturation") {
                                                return (i+1)/that.new_data.length;
                                            } else {
                                                return 1;
                                            }
                                        },
                                        "path-stroke-opacity": function () {
                                            return d3.select(this).attr("stroke-opacity");
                                        }
                                    })
                                    .attr("name", function (d) {
                                        return that.new_data[i].name;
                                    })
                                    .attr("actual_color", function () {
                                        return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                    })
                                    .attr("click_status", function () {
                                        var currentYear = (new Date()).getFullYear();
                                        if (that.new_data[i].name === currentYear.toString() || that.new_data[i].name === (currentYear - 1).toString()){
                                            return "yes";
                                        } else {
                                            return "no";
                                        }

                                    })
                                    .style("stroke", function() {
                                        if(that.new_data[i].highlight) {
                                            that.highlightLine(this,null);
                                        }
                                        var currentYear = (new Date()).getFullYear();
                                        if (that.new_data[i].name === currentYear.toString() || that.new_data[i].name === (currentYear - 1).toString()){
                                            return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                        } else {
                                            return "#ddd";
                                        }
                                    })
                                    .on('mouseover', function () {
                                        if  (this.getAttribute("click_status") === "no") {

                                            var actual_color = d3.select(this).attr("actual_color"),
                                                name = this.getAttribute('name');

                                            d3.select(this).style("stroke", actual_color);
                                            that.svgContainer.select(".legend-heading[name = '" + name + "']").style("stroke", actual_color);
                                            that.svgContainer.select("g.focus[name = '"+name+"'] circle").style("fill", actual_color);
                                        }

                                        // r.svgContainer.selectAll("g#clipPath path").style("stroke", "#ddd");
                                        // r.svgContainer.selectAll("g.focus circle").style("fill", "#ddd");
                                        // r.svgContainer.selectAll(".legend-heading").style("stroke", "#ddd");

                                        // r.svgContainer.select(".legend-heading[name = '"+this.getAttribute('name')+"']").style("stroke", this.getAttribute("highlight-color"));
                                        // d3.select(this).style("stroke",  d3.select(this).attr("highlight-color"));
                                    }).on('mouseout', function() {
                                        if (this.getAttribute("click_status") === "no") {
                                            var name = this.getAttribute('name');

                                            d3.select(this).style("stroke", "#ddd");
                                            that.svgContainer.select(".legend-heading[name = '" + name + "']").style("stroke", "#ddd");
                                            that.svgContainer.select("g.focus[name = '"+name+"'] circle").style("fill", "#ddd");

                                        }
                                        // r.svgContainer.selectAll("g#clipPath path")[0].map(function (d) {
                                        //     d.style.stroke = d.getAttribute("highlight-color");
                                        //     r.svgContainer.select("g.focus[name = '"+d.getAttribute('name')+"'] circle").style("fill",d.getAttribute("highlight-color"));
                                        //     r.svgContainer.select(".legend-heading[name = '"+d.getAttribute('name')+"']").style("stroke", d.getAttribute("highlight-color"));
                                    })
                                    .on("click", function () {
                                        if (this.getAttribute("click_status") === "no") {
                                            this.setAttribute("click_status", "yes");
                                        } else {
                                            this.setAttribute("click_status", "no");
                                            d3.select(this).style("stroke", "#ddd");
                                            that.svgContainer.select(".legend-heading[name = '" + name + "']").style("stroke", "#ddd");
                                        }
                                    });

                                function transition (i) {
                                    that.dataLineGroup[i].transition()
                                        .duration(that.transitions.duration())
                                        .attrTween("d", function (d) {
                                            var interpolate = d3.scale.quantile()
                                                .domain([0,1])
                                                .range(d3.range(1, data.length + 1));
                                            return function(t) {
                                                return that.chart_path(that.new_data[i].data.slice(0, interpolate(t)));
                                            };
                                        })
                                }
                                transition(i);
                        }
                    } else {                // Multiple Containers -- "Yes"
                        data = that.new_data[index].data;
                        type = that.type + that.svgContainer.attr("id");
                        that.dataLineGroup[0] = that.chartBody.append("path");

                        that.dataLineGroup[0]
                                .datum(that.new_data1.data)
                                .attr({
                                    "class": "lines-hover "+that.chartPathClass,
                                    "id": type,
                                    "transform": "translate("+ that.extra_left_margin +",0)",
                                    "stroke-opacity": function () {
                                        if(that.color_mode === "saturation") {
                                            return (index+1)/that.new_data.length;
                                        } else {
                                            return 1;
                                        }
                                    },
                                    "path-stroke-opacity": function () {
                                        return d3.select(this).attr("stroke-opacity");
                                    },
                                    "data-id":function (d,i) {
                                        return that.new_data[i];
                                    }
                                })
                                .style("stroke", function() {
                                    if(that.new_data[index].highlight) {
                                        that.highlightLine(this,null);
                                    }
                                    return that.fillColor.colorPieMS(that.new_data[index],that.type);
                                })
                                .on({
                                    "click": function (d) {
                                        if(that.mode === "default") {
                                            that.clicked = true;
                                            that.highlightLine(PykCharts.getEvent().target,that.clicked,that.previous_color);
                                        }
                                    },
                                    "mouseover": function (d) {
                                        if(this !== that.selected && (that.color_mode === "saturation" || that.hover) && that.mode === "default") {
                                            that.previous_color = d3.select(this).attr("stroke-opacity");
                                            that.click_color = d3.select(this).style("stroke");
                                            d3.select(this)
                                                .classed({'multi-line-hover':true,'multi-line':false})
                                                .style("stroke", "orange");
                                        }
                                    },
                                    "mouseout": function (d,i) {
                                        if(this !== that.selected && (that.color_mode === "saturation" || that.hover) && that.mode === "default") {
                                            d3.select(this)
                                                .classed({'multi-line-hover':false,'multi-line':true})
                                                .style("stroke", function() {
                                                    if(that.new_data[index].highlight) {
                                                        that.highlightLine(this,null,that.previous_color/*that.new_data[i].highlight*/);
                                                    }
                                                    return that.click_color;
                                                })
                                                .attr("stroke-opacity", function () {
                                                    if(that.color_mode === "saturation") {
                                                        return that.previous_color;
                                                    } else {
                                                        return 1;
                                                    }
                                                });
                                        }
                                    }
                                });

                        function animation(i) {
                            that.dataLineGroup[0].transition()
                                    .duration(that.transitions.duration())
                                    .attrTween("d", function (d) {
                                        var interpolate = d3.scale.quantile()
                                            .domain([0,1])
                                            .range(d3.range(1, data.length + 1));
                                        return function(t) {
                                            return that.chart_path(data.slice(0, interpolate(t)));
                                        };
                                    });
                        }
                        animation(index);
                    }

                    if(that.type === "lineChart" && that.mode === "default") {

                        that.svgContainer
                            .on('mouseout',function (d) {
                                that.mouseEvent.tooltipHide();
                                that.mouseEvent.crossHairHide(that.type);
                                that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
                                that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
                            })
                            .on("mousemove", function(){
                                that.mouseEvent.crossHairPosition(that.new_data,that.xScale,that.yScale,that.dataLineGroup,that.extra_left_margin,that.xdomain,chartType,that.tooltipMode,null,that.container_id);
                            });
                    }
                    else if (that.type === "multilineChart" && that.mode === "default") {
                        that.svgContainer
                            .on('mouseout', function (d) {
                                that.mouseEvent.tooltipHide(null,that.panels_enable,that.type);
                                that.mouseEvent.crossHairHide(that.type);
                                that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
                                that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
                            })
                            .on("mousemove", function(){
                                var line = [];
                                line[0] = d3.select(that.selector+" #"+this.id+" .lines-hover");
                                that.mouseEvent.crossHairPosition(that.new_data,that.xScale,that.yScale,line,that.extra_left_margin,that.xdomain,chartType,that.tooltipMode,that.panels_enable,that.container_id,that.no_of_containers_in_row);
                            });
                    }
                }
                return this;
            },
            ticks: function (index) {
                if(PykCharts['boolean'](that.pointer_size)) {
                    if(PykCharts['boolean'](that.panels_enable)) {
                        var type = that.type + that.svgContainer.attr("id");
                        if (that.axis_x_position  === "bottom" && (that.axis_y_position === "left" || that.axis_y_position === "right")) {
                            that.ticks[0] = that.svgContainer.append("text")
                                .attr({
                                    "id": type,
                                    "x": that.chart_margin_left,
                                    "y": that.chart_margin_top,
                                    "dy": -5
                                })
                                .style({
                                    "font-size": that.pointer_size + "px",
                                    "font-weight": that.pointer_weight,
                                    "font-family": that.pointer_family,
                                    "fill": function() {
                                        return that.fillColor.colorPieMS(that.new_data1,that.type);
                                    }
                                })
                                .html(that.new_data1.name);
                        } else if (that.axis_x_position  === "top"  && (that.axis_y_position === "left" || that.axis_y_position === "right")) {
                            that.ticks[0] = that.svgContainer.append("text")
                                .attr({
                                    "id": type,
                                    "x": that.w - that.chart_margin_left,
                                    "y": that.chart_height-that.chart_margin_bottom,
                                    "dy": 10,
                                    "text-anchor": "end"
                                })
                                .style({
                                    "font-size": that.pointer_size + "px",
                                    "font-weight": that.pointer_weight,
                                    "font-family": that.pointer_family,
                                    "fill": function() {
                                        return that.fillColor.colorPieMS(that.new_data1,that.type);
                                    }
                                })
                                .html(that.new_data1.name);
                        }

                    } else {
                        that.ticks_text_width = [];
                        tickPosition = function (d,i) {
                            var end_x_circle, end_y_circle, length = that.new_data[i].data.length, k;
                            if(that.axis_y_position === "left") {
                                if (that.new_data[i].data[(that.new_data[i].data.length - 1)].y !== "NA") {
                                    end_x_circle = (that.xScale(that.new_data[i].data[(that.new_data[i].data.length - 1)].x) + that.extra_left_margin + that.chart_margin_left);
                                    end_y_circle = (that.yScale(that.new_data[i].data[(that.new_data[i].data.length - 1)].y) + that.chart_margin_top);
                                } else {
                                    end_x_circle = (that.xScale(that.new_data[i].data[(that.new_data[i].data.length - 1)].x) + that.extra_left_margin + that.chart_margin_left);

                                    for (k = 0; length > k && "NA" !== that.new_data[i].data[k].y; k++);
                                    end_y_circle = (that.yScale(that.new_data[i].data[k - 1].y) + that.chart_margin_top);

                                }
                            } else if(that.axis_y_position === "right") {
                                end_x_circle = (that.xScale(that.new_data[i].data[0].x) + that.extra_left_margin + that.chart_margin_left) - 10;
                                end_y_circle = (that.yScale(that.new_data[i].data[0].y) + that.chart_margin_top);
                            }
                            text_x = end_x_circle,
                            text_y = end_y_circle,
                            text_rotate = 0;
                            return "translate("+text_x+","+text_y+") rotate("+text_rotate+")";
                        }
                        orient = function () {
                            if(that.axis_y_position === "left") {
                                return "start";
                            } else if(that.axis_y_position === "right") {
                                return "end";
                            }
                        }
                        that.ticks = that.svgContainer.selectAll(".legend-heading")
                                .data(that.new_data);

                        that.ticks.enter()
                                .append(
                                    "text")

                        that.ticks.attr({
                            "id": function (d,i) { return that.type + "-svg-" + i; },
                            "class": "legend-heading",
                            "transform": tickPosition,
                            "text-anchor": orient
                        });

                        that.ticks.text(function (d,i) {
                                return "";
                            })
                        function setTimeoutTicks() {
                            that.ticks.text(function (d,i) {
                                    return d.name;
                                })
                                .text(function (d,i) {
                                    that.ticks_text_width[i] = this.getBBox().width;
                                    return d.name;
                                })
                                .attr({
                                    "dx": 5,
                                    "dy": 5,
                                    "name": function (d,i) {
                                        return d.name;
                                    }
                                })
                                .style({
                                    "font-size": that.pointer_size + "px",
                                    "font-weight": function(d){
                                        if(d.highlight) {
                                            return "bold";
                                        } else {
                                            return that.pointer_weight;
                                        }
                                    },
                                    "font-family": that.pointer_family,
                                    "visibility": "visible",
                                    "fill": function(d,i) {

                                        var currentYear = (new Date()).getFullYear();
                                        if (d.name === currentYear.toString() || that.new_data[i].name === (currentYear - 1).toString()){
                                            return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                            // return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                        } else {
                                            return "#ddd";
                                        }

                                        // return that.fillColor.colorPieMS(that.new_data[i],that.type);
                                    },
                                    "pointer-events" : "none"
                                });
                        }
                        setTimeout(setTimeoutTicks, that.transitions.duration());
                        that.ticks.exit()
                            .remove();
                    }
                }
                return this;
            }
        };
        return optional;
    };
    that.zoomed = function() {
        if(!PykCharts['boolean'](that.panels_enable)) {
            if(PykCharts['boolean'](that.pointer_overflow_enable)) {
                that.svgContainer.style("overflow","hidden");
            }

            that.k.isOrdinal(that.svgContainer,".x.axis",that.xScale,that.xdomain,that.extra_left_margin);
            that.k.isOrdinal(that.svgContainer,".x.grid",that.xScale);
            that.k.isOrdinal(that.svgContainer,".y.axis",that.yScale,that.ydomain);
            that.k.isOrdinal(that.svgContainer,".y.grid",that.yScale);
            for (var i = 0;i < that.new_data_length;i++) {
                var type = that.type+"-svg-"+i;
                that.svgContainer.select(that.selector+" #"+type)
                    .attr({
                        "class": "lines-hover " + that.chartPathClass,
                        "d": that.chart_path
                    });

            }
        } else {
            for (var i = 0;i < that.new_data_length;i++) {
                var type = that.type;
                currentContainer = d3.selectAll("#"+that.container_id + "-" + i);
                that.k.isOrdinal(currentContainer,".x.axis",that.xScale,that.xdomain,that.extra_left_margin);
                that.k.isOrdinal(currentContainer,".x.grid",that.xScale);
                that.k.isOrdinal(currentContainer,".y.axis",that.yScale,that.ydomain);
                that.k.isOrdinal(currentContainer,".y.grid",that.yScale);
                currentContainer.select("#"+type+that.container_id+"-"+i)
                    .attr({
                        "class": "lines-hover " + that.chartPathClass,
                        "d": that.chart_path
                    });

            }
        }
        if(PykCharts.getEvent().sourceEvent.type === "dblclick") {
            that.count++;
        }
        that.mouseEvent.tooltipHide();
        that.mouseEvent.crossHairHide(that.type);
        that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
        that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");

        if(that.count === that.zoom_level+1) {
            that.zoomOut();
        }
        if(PykCharts['boolean'](that.annotation_enable)) {
            that.annotation();
        }
        that.optionalFeature().ticks();
    };
    that.zoomOut = function () {
        if(PykCharts['boolean'](that.pointer_overflow_enable) && !PykCharts['boolean'](that.panels_enable)) {
            that.svgContainer.style("overflow","visible");
        }
        if(PykCharts['boolean'](that.panels_enable)) {
            for (var i = 0;i < that.previous_length;i++) {
                var element = document.querySelector(that.selector + " #panels_of_line_main_div #chart-container-"+i);
                element.parentNode.removeChild(element);
            }
            that.renderPanelOfLines();
        }
        if(that.type === "lineChart") {
            that.optionalFeature().createChart("liveData");
        } else if(that.type === "multilineChart" && !PykCharts['boolean'](that.panels_enable)) {
            document.querySelector(that.selector +" #chart-container-1").innerHTML = null;
            that.renderLineChart();
        }
        that.k.isOrdinal(that.svgContainer,".x.axis",that.xScale,that.xdomain,that.extra_left_margin);
        that.k.isOrdinal(that.svgContainer,".x.grid",that.xScale);
        that.k.isOrdinal(that.svgContainer,".y.axis",that.yScale,that.ydomain);
        that.k.isOrdinal(that.svgContainer,".y.grid",that.yScale);
    };

    that.onBrush = function (min,max) {
        that.addEvents(min,max);
    };

    that.highlightLine = function(linePath,clicked,prev_opacity) {

            that.selected_line = linePath;
            that.selected_line_data = that.selected_line.__data__;
            that.selected_line_data_len = that.selected_line_data.length;
            that.deselected = that.selected;

            that.selected = linePath;

            if(that.type === "multilineChart" && (that.color_mode === "saturation" || that.hover))
                d3.select(that.selected)
                    .style("stroke", function (d,i) {
                        return that.click_color;
                    });

            if(clicked) {
                 if (d3.select(that.selected).classed("multi-line")) {
                        d3.selectAll(that.selector+" path.multi-line").attr("stroke-opacity",0.3);
                        if (that.color_mode === "color") {
                            d3.selectAll(that.selector+ " .legend-heading").style("opacity",0.3);
                        }
                        d3.select(that.selector+" text#"+that.selected.id).style("opacity",1).style
                        ("font-weight","bold");
                        d3.selectAll(".lines-hover")
                            .attr("stroke-opacity",0.3)
                            .classed({
                                "multi-line-selected": false,
                                "multi-line": true
                            });
                        d3.select(that.selected)
                            .attr("stroke-opacity",1)
                            .classed({
                                "multi-line-selected": true,
                                "multi-line": false
                            });
                 } else {
                    if (that.color_mode === "color") {
                        d3.selectAll(that.selector+" path.multi-line").attr("stroke-opacity",prev_opacity);
                    } else {
                        d3.selectAll(that.selector+" path.multi-line").attr("stroke-opacity",function () {
                            return d3.select(this).attr("path-stroke-opacity");
                        });
                    }
                    d3.selectAll(that.selector+ " .legend-heading").style("opacity",1);
                    d3.select(that.selector+" text#"+that.selected.id).style({
                        "opacity": 1,
                        "font-weight": "normal"
                    });
                    d3.select(that.selected)
                        .attr("stroke-opacity",prev_opacity)
                        .classed({
                            "multi-line-selected": false,
                            "multi-line": true
                        });
                }
            }

    };

    that.annotation = function () {
        that.line = d3.svg.line()
                .interpolate('linear-closed')
                .x(function(d,i) { return d.x; })
                .y(function(d,i) { return d.y; });

        if(!PykCharts['boolean'](that.panels_enable)) {
            var arrow_size = 12/*line_size = 15*/,annotation = [];

            for(var i=0;i<that.new_data_length;i++){
                that.new_data[i].data.map(function (d) {
                    if(d.annotation) {
                        annotation.push({
                            annotation : d.annotation,
                            x : d.x,
                            y : d.y
                        })
                    }
                });
            }

            annotationComman(annotation,1);
            that.k.annotation(that.selector + " #svg-1",annotation, that.xScale,that.yScale);
        } else if(PykCharts['boolean'](that.panels_enable)) {
            for(var i=0;i<that.new_data_length;i++){
                var annotation = [], arrow_size = 12;
                that.new_data[i].data.map(function (d) {
                    if(d.annotation) {
                        annotation.push({
                            annotation : d.annotation,
                            x : d.x,
                            y : d.y
                        })
                    }
                });
                annotationComman(annotation,i);
                that.k.annotation(that.selector + " #"+that.container_id+"-" + i,annotation, that.xScale,that.yScale)
            }
        }
        function annotationComman (annotation,i) {
            var anno = d3.select(that.selector + " #"+that.container_id+"-" + i).selectAll(that.selector+ " .PykCharts-annotation-line")
                .data(annotation);
            anno.enter()
                .append("path");
            anno.attr("d", function (d,i) {
                    var a = [
                        {
                            x:parseInt(that.xScale(d.x))+that.extra_left_margin+that.chart_margin_left,
                            y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top)
                        },
                        {
                            x:parseInt(that.xScale(d.x))+that.extra_left_margin+that.chart_margin_left,
                            y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top)
                        }
                    ];
                    return that.line(a);
                })
            function setTimeoutAnnotationPanelOfLine() {
                anno.attr("class", "PykCharts-annotation-line")
                    .attr("d", function (d,i) {
                        var a = [
                            {
                                x:parseInt(that.xScale(d.x)-(arrow_size*0.5))+that.extra_left_margin+that.chart_margin_left,
                                y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top)
                            },
                            {
                                x:parseInt(that.xScale(d.x)+(arrow_size*0.5))+that.extra_left_margin+that.chart_margin_left,
                                y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top)
                            },
                            {
                                x:parseInt(that.xScale(d.x))+that.extra_left_margin+that.chart_margin_left,
                                y:parseInt(that.yScale(d.y)+that.chart_margin_top),
                            }
                        ];
                        return that.line(a);
                    })
                    .attr("fill",that.annotation_background_color);
            }
            setTimeout(setTimeoutAnnotationPanelOfLine,that.transitions.duration());
            anno.exit().remove();
        }
    };

    that.renderPanelOfLines = function () {
        for(var i=0;i<that.new_data_length;i++) {
            var selector = that.selector.substr(1,that.selector.length);
            d3.selectAll("#tooltip-svg-container-" + i + "-pyk-tooltip"+selector)
                .remove()
            that.k.makeMainDiv((that.selector + " #panels_of_line_main_div"),i)
                .tooltip(true,that.selector,i);
            that.new_data1 = that.new_data[i];
            that.fill_data[0] = that.new_data1;
            that.optionalFeature()
                    .svgContainer(i)
                    .createGroups(i);

            that.k.crossHair(that.svgContainer,1,that.fill_data,that.fillColor,that.type);
            that.mouseEvent = new PykCharts.crossHairMovement(that);

            that.optionalFeature()
                    .createChart(null,i)
                    .ticks(i)
                    .axisContainer();

            that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values)
                    .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values)
                    .xAxisTitle(that.xGroup)
                    .yAxisTitle(that.yGroup);

            if(that.mode === "default") {
                that.k.yGrid(that.svgContainer,that.group,that.yScale)
                    .xGrid(that.svgContainer,that.group,that.xScale)
            }
        }
        that.k.exportSVG(that,that.container_id+"-","lineChart",that.panels_enable,that.new_data);
        that.k.emptyDiv(that.selector);
    };

    that.renderLineChart = function () {

        that.optionalFeature().svgContainer(1)
            .createGroups(1)
            .hightLightOnload();

        that.k.crossHair(that.svgContainer,that.new_data_length,that.new_data,that.fillColor,that.type);
        that.mouseEvent = new PykCharts.crossHairMovement(that);

        that.optionalFeature()
                .createChart()
                .ticks()
                .axisContainer();

        that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values)
                .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values)
                .xAxisTitle(that.xGroup)
                .yAxisTitle(that.yGroup);

        if (PykCharts.boolean(that.interactive_enable)) {
            that.brush = new PykCharts.Configuration.renderBrush(that,that.xScale,that.group,that.reducedHeight);
        }

        if(that.mode === "default") {
            that.k.yGrid(that.svgContainer,that.group,that.yScale)
                .xGrid(that.svgContainer,that.group,that.xScale)
        }

        var add_extra_width = 0;
        function setTimeoutExport() {
            if(PykCharts['boolean'](that.pointer_size)) {
                add_extra_width = d3.max(that.ticks_text_width,function(d){
                        return d;
                    });
            }
            that.k.exportSVG(that,"#"+that.container_id+"-1","lineChart",undefined,undefined,add_extra_width);
        }
        setTimeout(setTimeoutExport,that.transitions.duration());
    };

    that.dataTransformation();
    that.render();
};

PykCharts.multiD.area = function (options){
	var that = this;
	that.interval = "";
	var theme = new PykCharts.Configuration.Theme({});

	this.execute = function (pykquery_data){
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
		PykCharts.crossHair(that);
        PykCharts.annotation(that);
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);
        that.k.storeInitialDivHeight();
		if(that.stop) {
			return;
		}

		if(that.mode === "default") {
			that.k.loading();
		}

		var multiDimensionalCharts = theme.multiDimensionalCharts,
			stylesheet = theme.stylesheet,
			optional = options.optional;

	    that.crosshair_enable = options.crosshair_enable ? options.crosshair_enable.toLowerCase() : multiDimensionalCharts.crosshair_enable;
		that.curvy_lines_enable = options.curvy_lines_enable ? options.curvy_lines_enable.toLowerCase() : multiDimensionalCharts.curvy_lines_enable;
	  	that.panels_enable = "no";
	  	that.interpolate = PykCharts['boolean'](that.curvy_lines_enable) ? "cardinal" : "linear";
		that.w = that.chart_width - that.chart_margin_left - that.chart_margin_right;
		that.h = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;

		that.executeData = function (data) {
			var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

			that.data = that.k.__proto__._groupBy("area",data);
			that.axis_y_data_format = "number";
    		that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
    		if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
    			console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
    		}
			that.compare_data = that.data;
			that.data_length = that.data.length;
            that.k.remove_loading_bar(id);

			if (that.axis_x_data_format === "string") {
                that.data_sort_enable = "no";
            }
            else {
                that.data_sort_enable = "yes";
                that.data_sort_type = (that.axis_x_data_format === "time") ? "date" : "numerically";
                that.data_sort_order = "ascending";
            }
			PykCharts.multiD.areaFunctions(options,that,"area");
			that.dataTransformation();
			that.render();

		}
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }

	};
};
PykCharts.multiD.stackedArea = function (options){
	var that = this;
	that.interval = "";
	var theme = new PykCharts.Configuration.Theme({});

	this.execute = function (pykquery_data){
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
		PykCharts.crossHair(that);
        PykCharts.annotation(that);
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);

		if(that.stop) {
			return;
		}
        that.k.storeInitialDivHeight();
		if(that.mode === "default") {
			that.k.loading();
		}

		var multiDimensionalCharts = theme.multiDimensionalCharts,
			stylesheet = theme.stylesheet,
			optional = options.optional;

	    that.crosshair_enable = options.crosshair_enable ? options.crosshair_enable.toLowerCase() : multiDimensionalCharts.crosshair_enable;
		that.curvy_lines_enable = options.curvy_lines_enable ? options.curvy_lines_enable.toLowerCase() : multiDimensionalCharts.curvy_lines_enable;
	  	that.panels_enable = "no";
	  	that.interpolate = PykCharts['boolean'](that.curvy_lines_enable) ? "cardinal" : "linear";
		that.w = that.chart_width - that.chart_margin_left - that.chart_margin_right;
		that.h = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;

		that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);

            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

			that.data = that.k.__proto__._groupBy("area",data);
			that.axis_y_data_format = "number";
    		that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
    		if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
    			console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
    		}
			that.compare_data = that.data;
			that.data_length = that.data.length;
            that.k.remove_loading_bar(id);
			if (that.axis_x_data_format === "string") {
                that.data_sort_enable = "no";
            }
            else {
                that.data_sort_enable = "yes";
                that.data_sort_type = (that.axis_x_data_format === "time") ? "date" : "numerically";
                that.data_sort_order = "ascending";
            }
			PykCharts.multiD.areaFunctions(options,that,"stacked_area");
			that.dataTransformation();
			that.render();
		};
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
	};
};
PykCharts.multiD.areaFunctions = function (options,chartObject,type) {
	var that = chartObject;

	that.dataTransformation = function () {
        that.group_arr = [], that.new_data = [];
        that.ticks = [], that.x_arr = [];

        for(var j = 0;j < that.data_length;j++) {
            that.group_arr[j] = that.data[j].name;
        }
        that.uniq_group_arr = that.k.__proto__._unique(that.group_arr);
        that.uniq_color_arr = [];
        var uniq_group_arr_length = that.uniq_group_arr.length;

        for(var k = 0;k < that.data_length;k++) {
            that.x_arr[k] = that.data[k].x;
        }
        that.uniq_x_arr = that.k.__proto__._unique(that.x_arr);

        for (var k = 0;k < uniq_group_arr_length;k++) {
            if(that.chart_color[k]) {
                that.uniq_color_arr[k] = that.chart_color[k];
            } else {
                for (var l = 0;l < that.data_length;l++) {
                    if (that.uniq_group_arr[k] === that.data[l].name && that.data[l].color) {
                        that.uniq_color_arr[k] = that.data[l].color;
                        break;
                    }
                } if(!PykCharts['boolean'](that.uniq_color_arr[k])) {
                    that.uniq_color_arr[k] = that.default_color[0];
                }
            }
        }

        that.flag = 0;
        for (var k = 0;k < uniq_group_arr_length;k++) {
            that.new_data[k] = {
                    name: that.uniq_group_arr[k],
                    data: [],
                    color: that.uniq_color_arr[k]
            };
            for (var l = 0;l < that.data_length;l++) {
                if (that.uniq_group_arr[k] === that.data[l].name) {
                    that.new_data[k].data.push({
                        x: that.data[l].x,
                        y: that.data[l].y,
                        tooltip: that.data[l].tooltip,
                        annotation: that.data[l].annotation || ""
                    });
                }
            }
        }

        that.new_data_length = that.new_data.length;
        var uniq_x_arr_length = that.uniq_x_arr.length;

        for (var a = 0;a < that.new_data_length;a++) {
            var uniq_x_arr_copy = that.k.__proto__._unique(that.x_arr)
            ,	every_data_length = that.new_data[a].data.length
            for(var b = 0;b < every_data_length;b++) {
                for(var k = 0;k < uniq_x_arr_length;k++) {
                    if(that.new_data[a].data[b].x === uniq_x_arr_copy[k]) {
                        uniq_x_arr_copy[k] = undefined;
                        break;
                    }
                }
            }
            for (var i = 0; i < uniq_x_arr_length ; i++) {
                if (uniq_x_arr_copy[i] != undefined) {
                    var temp_obj_to_insert_in_new_data = {
                        x: uniq_x_arr_copy[i],
                        y: 0,
                        tooltip: 0,
                        annotation: ""
                    };
                    that.new_data[a].data.splice(i, 0, temp_obj_to_insert_in_new_data);
                }
            }
        }
        for (var k = 0;k < that.new_data_length;k++) {
            that.new_data[k].data = that.k.__proto__._sortData(that.new_data[k].data, "x", "name", that);
        }

    };

	that.render = function () {
        var id = that.selector.substring(1,that.selector.length);
		that.container_id = id + "_svg";

		that.dataLineGroup = [], that.dataLineGroupBorder = [];
		that.multid = new PykCharts.multiD.configuration(that);
		that.fillColor = new PykCharts.Configuration.fillChart(that,null,options);
		that.transitions = new PykCharts.Configuration.transition(that);
		that.border = new PykCharts.Configuration.border(that);
		that.xdomain = [];
		that.optional_feature()
		    .chartType();

		try {
			if(that.type === "stackedAreaChart" && type === "area" ) {
				throw "Invalid data in the JSON";
			}

		}
		catch (err) {
            console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+that.selector+".\""+err+"\"  Visit www.pykcharts.com/errors#error_7");
         	return;
		}
		if(that.axis_x_data_format === "time") {
			for(var i = 0;i<that.new_data_length;i++) {
	          	that.new_data[i].data.forEach(function (d) {
		          	d.x = that.k.dateConversion(d.x);
		          	that.xdomain.push(d.x);
	          	});
	          	that.data.forEach(function (d) {
		          	d.x =that.k.dateConversion(d.x);
          		});
	        }
	    }

		if(that.mode === "default") {
			var selector = that.selector.substr(1,that.selector.length);
			d3.selectAll("#tooltip-svg-container-" + 1 + "-pyk-tooltip"+selector)
                .remove();
			that.k.title()
					.backgroundColor(that)
					.export(that,"#"+that.container_id+"-1","areaChart")
					.liveData(that)
					.emptyDiv(that.selector)
					.subtitle()
					.makeMainDiv(that.selector,1)
					.tooltip(true,that.selector,1);

			that.renderChart();

			that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
					.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
					.yGrid(that.svgContainer,that.group,that.yScale,that.legendsGroup_width)
					.xGrid(that.svgContainer,that.group,that.xScale,that.legendsGroup_height)
					.xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
					.yAxisTitle(that.yGroup)
					.createFooter()
	                .lastUpdatedAt()
	                .credits()
	                .dataSource();

	        if(PykCharts['boolean'](that.annotation_enable)) {
	        	that.annotation();
	        }
		}
		else if(that.mode === "infographics") {
			  that.k/*.liveData(that)*/
			  			.backgroundColor(that)
			  			.export(that,"#"+that.container_id+"-1","areaChart")
			  			.emptyDiv(that.selector)
						.makeMainDiv(that.selector,1);

			  that.optional_feature()
						.svgContainer(1)
						.legendsContainer()
						.createGroups(1)
						.createChart()
			    		.axisContainer();

		    that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
					.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
					.xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
					.yAxisTitle(that.yGroup);
  		}


  		if (PykCharts.boolean(that.interactive_enable)) {
			that.brush = new PykCharts.Configuration.renderBrush(that,that.xScale,that.group,that.h);
		}

		that.k.exportSVG(that,"#"+that.container_id+"-1","areaChart")
  		that.mouseEvent = new PykCharts.crossHairMovement(that);

  		var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
			return that.k.resize(that.svgContainer);
        });
	};

	that.refresh = function (pykquery_data) {
		that.xdomain = [];
		that.executeRefresh = function (data) {
			that.data = that.k.__proto__._groupBy("area",data);
			that.data_length = that.data.length;
			that.dataTransformation();
			var compare = that.k.checkChangeInData(that.data,that.compare_data);
			that.compare_data = compare[0];
			var data_changed = compare[1];

			if(data_changed || (PykCharts['boolean'](that.zoom_enable) && that.count > 1 && that.count <= that.zoom_level) || that.transition_duration) {
				that.k.lastUpdatedAt("liveData");
				that.mouseEvent.tooltipHide();
				that.mouseEvent.crossHairHide(that.type);
				that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
				that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
			}
			if(that.axis_x_data_format === "time") {
				for(var i = 0;i<that.new_data_length;i++) {
		          	that.new_data[i].data.forEach(function (d) {
			          	d.x = that.k.dateConversion(d.x);
			          	that.xdomain.push(d.x);
		          	});
		          	that.data.forEach(function (d) {
			          	d.x =that.k.dateConversion(d.x);
	          		});
		        }
		    }
			if(that.type === "stackedAreaChart") {
				document.querySelector(that.selector +" #chart-container-1").innerHTML = null;
				that.renderChart();
			}
			else {
				that.optional_feature().createChart("liveData");
			}

			that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
					.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
					.yGrid(that.svgContainer,that.group,that.yScale,that.legendsGroup_width)
					.xGrid(that.svgContainer,that.group,that.xScale,that.legendsGroup_height);

			if(PykCharts['boolean'](that.annotation_enable)) {
	        	that.annotation();
	        }
		};
		if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
	};

	that.optional_feature = function (){
		var id = that.selector.substring(1,that.selector.length);
		var optional = {
			chartType: function () {
				for(var j = 1;j < that.data_length;j++) {
					if(that.data[0].x === that.data[j].x) {
						that.type = "stackedAreaChart";
						break;
					}
				}
				that.type = that.type || "areaChart";
				return this;
			},
			svgContainer: function (i){
				var element = document.getElementById(id);
				if(!element.classList.contains('PykCharts-line-chart')) {
                    element.className += " PykCharts-twoD PykCharts-line-chart PykCharts-multi-series2D";
                }
				that.svgContainer = d3.select(that.selector+" "+"#chart-container-"+i).append("svg:svg")
					.attr({
						"id": that.container_id+"-"+i,
						"width": that.chart_width,
						"height": that.chart_height,
						"class": "svgcontainer",
						"preserveAspectRatio": "xMinYMin",
	                    "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
					});
    			return this;
			},
			createGroups : function (i) {
				that.group = that.svgContainer.append("g")
					.attr({
						"id": that.type+"-group",
						"transform": "translate("+ that.chart_margin_left +","+ (that.chart_margin_top + that.legendsGroup_height)+")"
					});

				if(PykCharts['boolean'](that.chart_grid_y_enable)){
					that.group.append("g")
						.attr({
							"id": "ygrid",
							"class": "y grid-line"
						});
				}
				if(PykCharts['boolean'](that.chart_grid_x_enable)){
					that.group.append("g")
						.attr({
							"id": "xgrid",
							"class": "x grid-line"
						});
				}

				that.clip = that.svgContainer.append("svg:clipPath")
				    .attr("id","clip" + i + that.selector)
				    .append("svg:rect")
				    .attr({
				    	"width": that.w - that.legendsGroup_width,
				    	"height": that.h - that.legendsGroup_height
				    });

				that.chartBody = that.svgContainer.append("g")
					.attr({
						"id": "clipPath",
						"clip-path": "url(#clip" + i + that.selector + " )",
						"transform": "translate("+ that.chart_margin_left +","+ (that.chart_margin_top+that.legendsGroup_height) +")"
					});

				that.stack_layout = d3.layout.stack()
					.values(function(d) { return d.data; });

    			return this;
			},
			legendsContainer : function (i) {
                if (PykCharts['boolean'](that.legends_enable) && that.type === "stackedAreaChart" && that.mode === "default") {
                    that.legendsGroup = that.svgContainer.append("g")
                                .attr('id',"stackedArea-legends")
                                .style("visibility","visible")
                                .attr("transform","translate(0,10)");
                } else {
                    that.legendsGroup_height = 0;
                    that.legendsGroup_width = 0;
                }
                return this;
            },
			axisContainer : function () {
	        	if(PykCharts['boolean'](that.axis_x_enable) || that.axis_x_title){
					that.xGroup = that.group.append("g")
							.attr({
								"id": "xaxis",
								"class": "x axis"
							});
				}
				if(PykCharts['boolean'](that.axis_y_enable) || that.axis_y_title){
					that.yGroup = that.group.append("g")
						.attr({
							"id": "yaxis",
							"class": "y axis"
						});
				}
	        	return this;
      		},
			createChart : function (evt) {

				that.legend_text = [];
				that.layers = that.stack_layout(that.new_data);

        		var x_domain,x_data = [],y_data,y_range,x_range,y_domain, min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;
        		that.count = 1;

        		that.x_tick_values = that.k.processXAxisTickValues();
                that.y_tick_values = that.k.processYAxisTickValues();

				if(that.axis_y_data_format === "number") {
					max = d3.max(that.layers, function(d) { return d3.max(d.data, function(k) { return k.y0 + k.y; }); });
					min = 0;
         			y_domain = [min,max];
		          	y_data = that.k.__proto__._domainBandwidth(y_domain,1);
					y_range = [that.h - that.legendsGroup_height, 0];

					min_y_tick_value = d3.min(that.y_tick_values);
                    max_y_tick_value = d3.max(that.y_tick_values);

                    if(y_data[0] > min_y_tick_value) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(y_data[1] < max_y_tick_value) {
                        y_data[1] = max_y_tick_value;
                    }

		          	that.yScale = that.k.scaleIdentification("linear",y_data,y_range);
		        }
		        else if(that.axis_y_data_format === "string") {
		          	that.new_data[0].data.forEach(function(d) { y_data.push(d.y); });
		          	y_range = [0,that.h];
		          	that.yScale = that.k.scaleIdentification("ordinal",y_data,y_range,0);
		        }
		        else if (that.axis_y_data_format === "time") {
		          	that.layers.data.forEach(function (k) {
		          		k.y0 = new Date(k.y0);
		          		k.y = new Date(k.y);
		          	});
		          	max = d3.max(that.layers, function(d) { return d3.max(d.data, function(k) { return k.y0 + k.y; }); });
					min = 0;
		         	y_data = [min,max];
		          	y_range = [that.h, 0];

	          	    min_y_tick_value = d3.min(that.y_tick_values, function (d) {
                        return new Date(d);
                    });

                    max_y_tick_value = d3.max(that.y_tick_values, function (d) {
                        return new Date(d);
                    });

                    if(new Date(y_data[0]) > new Date(min_y_tick_value)) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(new Date(y_data[1]) < new Date(max_y_tick_value)) {
                        y_data[1] = max_y_tick_value;
                    }

		          	that.yScale = that.k.scaleIdentification("time",y_data,y_range);

		        }
		        if(that.axis_x_data_format === "number") {
        			max = d3.max(that.new_data, function(d) { return d3.max(d.data, function(k) { return +k.x; }); });
					min = d3.min(that.new_data, function(d) { return d3.min(d.data, function(k) { return +k.x; }); });
         			x_domain = [min,max];
			        x_data = that.k.__proto__._domainBandwidth(x_domain,2);
			        x_range = [0 ,that.w - that.legendsGroup_width];

		            min_x_tick_value = d3.min(that.x_tick_values);
                    max_x_tick_value = d3.max(that.x_tick_values);

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }

			        that.xScale = that.k.scaleIdentification("linear",x_data,x_range);
			        that.extra_left_margin = 0;
			        that.new_data[0].data.forEach(function (d) {
                        that.xdomain.push(+d.x);
                    })
		        }
		        else if(that.axis_x_data_format === "string") {
		          	that.new_data[0].data.forEach(function(d) { x_data.push(d.x); });
		          	x_range = [0 ,that.w - that.legendsGroup_width];
		          	that.xScale = that.k.scaleIdentification("ordinal",x_data,x_range,0);
		          	that.extra_left_margin = (that.xScale.rangeBand() / 2);
		          	that.xdomain = that.xScale.domain()
		        }
		        else if (that.axis_x_data_format === "time") {
		        	max = d3.max(that.new_data, function(d) { return d3.max(d.data, function(k) { return k.x; }); });
					min = d3.min(that.new_data, function(d) { return d3.min(d.data, function(k) { return k.x; }); });
		         	x_data = [min,max];
		          	x_range = [0 ,that.w - that.legendsGroup_width];

	          	    min_x_tick_value = d3.min(that.x_tick_values, function (d) {
                        return that.k.dateConversion(d);
                    });

                    max_x_tick_value = d3.max(that.x_tick_values, function (d) {
                        return that.k.dateConversion(d);
                    });

                    if(new Date(x_data[0]) > new Date(min_x_tick_value)) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(new Date(x_data[1]) < new Date(max_x_tick_value)) {
                        x_data[1] = max_x_tick_value;
                    }

		          	that.xScale = that.k.scaleIdentification("time",x_data,x_range);

		          	that.extra_left_margin = 0;
		          	that.new_data[0].data.forEach(function (d) {
                        that.xdomain.push(d.x);
                    })
		        }
		        that.ydomain = that.yScale.domain();
				that.zoom_event = d3.behavior.zoom();

		      	if(!(that.axis_y_data_format==="string" || that.axis_x_data_format==="string")) {
		      		that.zoom_event.x(that.xScale)
					    .y(that.yScale)
					    .scale(that.count)
					    .on("zoom",that.zoomed);
				} else {
					that.zoom_event.y(that.yScale)
					    .scale(that.count)
					    .on("zoom",that.zoomed);
				}

				if(PykCharts['boolean'](that.zoom_enable) && (that.mode === "default")) {
					that.svgContainer.call(that.zoom_event);
					that.svgContainer.on({
						"wheel.zoom": null,
                    	"mousewheel.zoom": null
					});
				}

				that.chart_path = d3.svg.area()
				    .x(function(d) { return that.xScale(d.x); })
				    .y0(function(d) { return that.yScale(d.y0); })
    				.y1(function(d) { return that.yScale(d.y0 + d.y); })
				    .interpolate(that.interpolate);

				that.chart_path_border = d3.svg.line()
				    .x(function(d) { return that.xScale(d.x); })
				    .y(function(d) { return that.yScale(d.y0 + d.y); })
				    .interpolate(that.interpolate);

				that.chartPathClass = (that.type === "areaChart") ? "area" : "stacked-area";

	        	if(evt === "liveData") {
	        		for (var i = 0;i < that.new_data_length;i++) {
	        			var data = that.new_data[i].data;
	        			type = that.chartPathClass + i;

	        			that.svgContainer.select("#"+type)
							.datum(that.layers[i].data)
							.attr("transform", "translate("+ that.extra_left_margin +",0)")
							.style({
								"stroke": that.border.color(),
			                    "stroke-width": that.border.width(),
			                    "stroke-dasharray": that.border.style()
							});

						function transition1 (i) {
						    that.dataLineGroup[i].transition()
							    .duration(that.transitions.duration())
							    .attrTween("d", function (d) {
							    	var interpolate = d3.scale.quantile()
						                .domain([0,1])
						                .range(d3.range(1, data.length + 1));
							        return function(t) {
							            return that.chart_path(that.new_data[i].data.slice(0, interpolate(t)));
							        };
							    });
						}

						transition1(i);

						that.svgContainer.select("#border-stacked-area"+i)
							.datum(that.layers[i].data)
							.attr("transform", "translate("+ that.extra_left_margin +",0)");

					    function borderTransition1 (i) {
						    that.dataLineGroupBorder[i].transition()
							    .duration(that.transitions.duration())
							    .attrTween("d", function (d) {
							    	var interpolate = d3.scale.quantile()
						                .domain([0,1])
						                .range(d3.range(1, that.layers[i].data.length + 1));
							        return function(t) {
							            return that.chart_path_border(that.layers[i].data.slice(0, interpolate(t)));
							        };
				 			    })
						}
						borderTransition1(i);
					}
					if(that.type === "areaChart") {
						that.svgContainer
							.on('mouseout',function (d) {
			          			that.mouseEvent.tooltipHide();
			          			that.mouseEvent.crossHairHide(that.type);
								that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
								that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
		          			})
							.on("mousemove", function(){
								that.mouseEvent.crossHairPosition(that.new_data,that.xScale,that.yScale,that.dataLineGroup,that.extra_left_margin,that.xdomain,that.type,that.tooltip_mode);
					  		});
					}
				}
				else {
					for (var i = 0;i < that.new_data_length;i++) {
						var data = that.new_data[i].data;
						type = that.chartPathClass + i;
						that.dataLineGroup[i] = that.chartBody.append("path");
						that.dataLineGroup[i]
							.datum(that.layers[i].data)
							.attr({
								"class": that.chartPathClass,
								"id": type,
								"fill-opacity": function() {
									if(that.type === "stackedAreaChart" && that.color_mode === "saturation") {
										return (i+1)/that.new_data.length;
									}
								},
								"data-fill-opacity": function () {
			                        return d3.select(this).attr("fill-opacity");
			                    },
								"transform": "translate("+ that.extra_left_margin +",0)",
								"data-id":function (d,i) {
	                                return that.new_data[i];
	                            }
							})
							.style("fill", function(d) {
								return that.fillColor.colorPieMS(that.new_data[i],that.type);
							});

						function transition (i) {
						    that.dataLineGroup[i].transition()
							    .duration(that.transitions.duration())
							    .attrTween("d", function (d) {
							    	var interpolate = d3.scale.quantile()
						                .domain([0,1])
						                .range(d3.range(1, data.length + 1));
							        return function(t) {
							            return that.chart_path(that.new_data[i].data.slice(0, interpolate(t)));
							        };
							    });
						}
						transition(i);

						that.dataLineGroupBorder[i] = that.chartBody.append("path");
						that.dataLineGroupBorder[i]
							.datum(that.layers[i].data)
							.attr({
								"class": "area-border",
								"id": "border-stacked-area"+i,
								"transform": "translate("+ that.extra_left_margin +",0)"
							})
							.style({
								"stroke": that.border.color(),
			                    "stroke-width": that.border.width(),
			                    "stroke-dasharray": that.border.style(),
			                    "pointer-events": "none"
							});

						function borderTransition (i) {
						    that.dataLineGroupBorder[i].transition()
							    .duration(that.transitions.duration())
							    .attrTween("d", function (d) {
							    	var interpolate = d3.scale.quantile()
						                .domain([0,1])
						                .range(d3.range(1, that.layers[i].data.length + 1));
							        return function(t) {
							            return that.chart_path_border(that.layers[i].data.slice(0, interpolate(t)));
							        };
							    });
						}
						borderTransition(i);

					}

					that.svgContainer
						.on('mouseout', function (d) {
							that.mouseEvent.tooltipHide();
							that.mouseEvent.crossHairHide(that.type);
							that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
							that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
						})
						.on("mousemove", function() {
							if(that.type === "areaChart") {
								that.mouseEvent.crossHairPosition(that.new_data,that.xScale,that.yScale,that.dataLineGroup,that.extra_left_margin,that.xdomain,that.type,that.tooltip_mode);
							} else if(that.type === "stackedAreaChart") {
								var line = [];
								line[0] = d3.select(that.selector+" #"+this.id+" .stacked-area");
								that.mouseEvent.crossHairPosition(that.new_data,that.xScale,that.yScale,line,that.extra_left_margin,that.xdomain,that.type,that.tooltipMode,that.color_from_data,"no");
							}
						});

				}
				d3.selectAll(that.selector + " ." +that.chartPathClass)
					.on({
						"mouseover": function () {
							if(that.mode === "default") {
								that.mouseEvent.highlight(that.selector + " ."+that.chartPathClass,this);
							}
						},
						"mouseout": function () {
							if(that.mode === "default") {
								that.mouseEvent.highlightHide(that.selector + " ."+that.chartPathClass);
							}
						}
					});
				return this;
			},
			legends: function () {
                if (PykCharts['boolean'](that.legends_enable) && that.type === "stackedAreaChart" && that.mode==="default") {
        			that.multid.legendsPosition(that,"stackedArea",that.new_data);
                }
                return this;
            }
		};
		return optional;
	};

	that.zoomed = function() {
		that.k.isOrdinal(that.svgContainer,".x.axis",that.xScale,that.xdomain,that.extra_left_margin);
	    that.k.isOrdinal(that.svgContainer,".x.grid",that.xScale);
	    that.k.isOrdinal(that.svgContainer,".y.axis",that.yScale,that.ydomain);
	    that.k.isOrdinal(that.svgContainer,".y.grid",that.yScale);

	    for (i = 0;i < that.new_data_length;i++) {
	    	type = that.chartPathClass + i;
	  	 	that.svgContainer.select(that.selector+" #"+type)
	  	 		.attr({
	  	 			"class": that.chartPathClass,
		        	"d": that.chart_path
	  	 		});
		    that.svgContainer.select(that.selector+" #border-stacked-area"+i)
		    	.attr({
		    		"class": "area-border",
					"d": that.chart_path_border
		    	});
	    }
	    if(PykCharts.getEvent().sourceEvent.type === "dblclick") {
	    	that.count++;
	    }
	    that.mouseEvent.tooltipHide();
		that.mouseEvent.crossHairHide(that.type);
		that.mouseEvent.axisHighlightHide(that.selector + " .x.axis");
		that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
	    if(that.count === that.zoom_level+1) {
	    	that.zoomOut();
	    }
	    if(PykCharts['boolean'](that.annotation_enable)) {
        	that.annotation();
        }
	};

	that.zoomOut =  function () {
		that.optional_feature().createChart("liveData");
    	that.k.isOrdinal(that.svgContainer,".x.axis",that.xScale,that.xdomain,that.extra_left_margin);
	    that.k.isOrdinal(that.svgContainer,".x.grid",that.xScale);
	    that.k.isOrdinal(that.svgContainer,".y.axis",that.yScale,that.ydomain);
	    that.k.isOrdinal(that.svgContainer,".y.grid",that.yScale);
	};

	that.onBrush = function (min,max) {
        that.addEvents(min,max);

    };

	that.annotation = function () {
		that.line = d3.svg.line()
				.interpolate('linear-closed')
                .x(function(d,i) { return d.x; })
                .y(function(d,i) { return d.y; });
        var arrow_size = 12,annotation = [];
		if(that.type === "areaChart") {
			that.new_data[0].data.map(function (d) {
				if(d.annotation) {
					annotation.push({
						annotation : d.annotation,
						x : d.x,
						y : d.y
					})
				}
			});
		} else if(that.type === "stackedAreaChart" && that.mode === "default") {

			for(i=0;i<that.new_data_length;i++) {
				that.new_data[i].data.map(function (d) {
					if(d.annotation) {
						annotation.push({
							annotation : d.annotation,
							x : d.x,
							y : d.y + d.y0
						});
					}
				});
			}
		}
		var anno = that.svgContainer.selectAll(" .PykCharts-annotation-line")
            .data(annotation);
        anno.enter()
            .append("path");

        anno.attr("d", function (d,i) {
            	var a = [
            		{
            			x:parseInt(that.xScale(d.x))+that.extra_left_margin+that.chart_margin_left,
            			y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top+that.legendsGroup_height)
            		},
            		{
            			x:parseInt(that.xScale(d.x))+that.extra_left_margin+that.chart_margin_left,
            			y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top+that.legendsGroup_height)
            		}
            	];
            	return that.line(a);
            })
        function setTimeoutAnnotation () {
        	anno.attr("class", "PykCharts-annotation-line")
	            .attr("d", function (d,i) {
	            	var a = [
                		{
                			x:parseInt(that.xScale(d.x)-(arrow_size*0.5))+that.extra_left_margin+that.chart_margin_left,
                			y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top+that.legendsGroup_height)
                		},
                		{
                			x:parseInt(that.xScale(d.x)+(arrow_size*0.5))+that.extra_left_margin+that.chart_margin_left,
                			y:parseInt(that.yScale(d.y)-(arrow_size)+that.chart_margin_top+that.legendsGroup_height)
                		},
                		{
                			x:parseInt(that.xScale(d.x))+that.extra_left_margin+that.chart_margin_left,
                			y:parseInt(that.yScale(d.y)+that.chart_margin_top+that.legendsGroup_height),
                		}
            		];
	            	return that.line(a);
	            })
				.attr("fill",that.annotation_background_color);
        }
        setTimeout(setTimeoutAnnotation, that.transitions.duration());

        anno.exit().remove();
        that.k.annotation(that.selector + " #"+that.container_id+"-1",annotation,that.xScale,that.yScale)
	};

	that.renderChart =  function () {
		that.optional_feature()
				.svgContainer(1)
				.legendsContainer()
				.legends()
				.createGroups(1)
				.createChart()
	    		.axisContainer();

	    that.k.crossHair(that.svgContainer,that.new_data_length,that.new_data,that.fillColor,that.type);
	};
};
PykCharts.multiD.bar = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    var multiDimensionalCharts = theme.multiDimensionalCharts;
    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
        PykCharts.scaleFunction(that);
        that.data_sort_enable = options.data_sort_enable ? options.data_sort_enable.toLowerCase() : multiDimensionalCharts.data_sort_enable;
        that.data_sort_type = PykCharts['boolean'](that.data_sort_enable) && options.data_sort_type ? options.data_sort_type.toLowerCase() : multiDimensionalCharts.data_sort_type;
        that.data_sort_order = PykCharts['boolean'](that.data_sort_enable) && options.data_sort_order ? options.data_sort_order.toLowerCase() : multiDimensionalCharts.data_sort_order;
        try{
            if(that.data_sort_order === "ascending" || that.data_sort_order === "descending") {
            } else {
                that.data_sort_order = multiDimensionalCharts.data_sort_order;
                throw "data_sort_order";
            }
        }
        catch(err) {
            that.k.warningHandling(err,"9");
        }

        if(that.stop){
            return;
        }
        that.k.storeInitialDivHeight();
        that.panels_enable = "no";
        if(that.mode === "default") {
           that.k.loading();
        }

        that.multiD = new PykCharts.multiD.configuration(that);
            that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("bar",data);
            that.compare_data = that.k.__proto__._groupBy("bar",data);
            that.axis_x_data_format = "number";
            that.axis_y_data_format = that.k.yAxisDataFormatIdentification(that.data);
            if(that.axis_y_data_format === "time") {
                that.axis_y_data_format = "string";
            }
            that.k.remove_loading_bar(id);
            that.render();
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };

    this.transformData = function () {
        var group_arr = [], uniq_group_arr = [];

        that.optionalFeatures().sort();
        if (options.chart_color != undefined && options.chart_color.length != 0) {
            that.chart_color[0] = options.chart_color[0];
        }
        else {
            for (var i=0,len=that.data.length ; i<len ; i++) {
                if (that.data[i].color != undefined && that.data[i].color != "") {
                    that.chart_color[0] = that.data[i].color;
                    if (options.axis_y_pointer_color == undefined || options.axis_y_pointer_color == "") {
                        that.axis_y_pointer_color = that.chart_color[0];
                    }
                    break;
                }
            }

        }
        that.data.forEach(function(d) {
            d.x = (that.axis_x_data_format === "number") ? parseFloat(d.x) : d.x;
            d.name = d.y;
            d.color = that.chart_color[0];
        });

        for(var j=0, len=that.data.length ; j<len ; j++) {
            group_arr[j] = that.data[j].group;
        }
        uniq_group_arr = that.k.__proto__._unique(group_arr);
        that.no_of_groups = uniq_group_arr.length;
    }

    this.render = function () {
        var id = that.selector.substring(1,that.selector.length),
            container_id = id + "_svg";

        that.border = new PykCharts.Configuration.border(that);
        that.transitions = new PykCharts.Configuration.transition(that);
        // that.mouseEvent1 = new PykCharts.multiD.mouseEvent(options);
        that.mouseEvent1 = new PykCharts.Configuration.mouseEvent(options);
        that.fillColor = new PykCharts.Configuration.fillChart(that,null,options);
        that.transformData();

        try {
            if(that.no_of_groups > 1) {
                throw "Invalid data in the JSON";
            }
        }
        catch (err) {
            console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+that.selector+". \""+err+"\"  Visit www.pykcharts.com/errors#error_9");
            return;
        }

        that.map_group_data = that.multiD.mapGroup(that.data);

        if(that.mode === "default") {

            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"barChart")
                .emptyDiv(that.selector)
                .subtitle()
                .makeMainDiv(that.selector,1);

            that.optionalFeatures()
                .svgContainer(container_id,1)
                .createGroups();

            that.k.liveData(that)
                .tooltip()
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .createColumn()
                .axisContainer()
                .ticks();

            that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values)
                .xAxisTitle(that.xgroup)
                .yAxisTitle(that.ygroup);
            if(that.axis_y_data_format !== "string") {
                that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values,null,"bar",null,that);
                that.optionalFeatures().newYAxis();
            } else {
                that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values,null,null,null,that);
            }
        } else if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"barChart")
                .emptyDiv(that.selector)
                .makeMainDiv(that.selector,1);

            that.optionalFeatures()
                .svgContainer(container_id,1)
                .createGroups();

            that.k.liveData(that)
                .tooltip();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .createColumn()
                .axisContainer()
                .ticks();

            that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values)
                .xAxisTitle(that.xgroup)
                .yAxisTitle(that.ygroup);
            if(that.axis_y_data_format !== "string") {
                that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values,null,"bar",null,that);
                that.optionalFeatures().newYAxis();
            } else {
                that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values,null,null,null,that);
            }
        }
        that.k.exportSVG(that,"#"+container_id,"barChart")

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer,"");
        });
    };

    this.refresh = function (pykquery_data) {
       that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("bar",data);
            that.refresh_data = that.k.__proto__._groupBy("bar",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            that.transformData();

            if(that.axis_x_data_format === "time") {
                that.data.forEach(function (d) {
                    d.x =that.k.dateConversion(d.x);
                });
            }

            that.map_group_data = that.multiD.mapGroup(that.data);

            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }

            that.optionalFeatures()
                .createColumn()
                .ticks();

            that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values);
            if(that.axis_y_data_format !== "string") {
                that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values,null,"bar");
                that.optionalFeatures().newYAxis();
            } else {
                that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values);
            }
        };

        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.optionalFeatures = function () {
        var id = that.selector.substring(1,that.selector.length);
        var status;
        var optional = {
            svgContainer: function (container_id,i) {
                document.getElementById(id).className += " PykCharts-twoD";
                that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
                    .append("svg:svg")
                    .attr({
                        "width" : that.chart_width,
                        "height" : that.chart_height,
                        "id" : container_id,
                        "class" : "svgcontainer",
                        "preserveAspectRatio" : "xMinYMin",
                        "viewBox" : "0 0 " + that.chart_width + " " + that.chart_height
                    });
                return this;
            },
            createGroups: function (i) {
                that.group = that.svgContainer.append("g")
                    .attr({
                       "id" : "bar-group",
                       "transform" : "translate(" + that.chart_margin_left + "," + (that.chart_margin_top) +")"
                    });

                if(PykCharts.boolean(that.chart_grid_y_enable)) {
                    that.group.append("g")
                        .attr({
                            "id" : "ygrid",
                            "class" : "y grid-line"
                        });
                }
                return this;
            },
            newYAxis : function () {
                if(PykCharts["boolean"](that.axis_y_enable)) {
                    if(that.axis_y_position === "right") {
                        gsvg.attr("transform", "translate(" + (that.chart_width - that.chart_margin_left - that.chart_margin_right) + ",0)");
                    }
                    var yaxis = d3.svg.axis()
                        .scale(that.yScale)
                        .orient(that.axis_y_pointer_position)
                        .tickSize(0)
                        .outerTickSize(that.axis_y_outer_pointer_length);

                    that.new_yAxisgroup.style("stroke",function () { return that.axis_y_line_color; })
                        .call(yaxis);

                    d3.selectAll(that.selector + " .y.new-axis text")
                        .style({
                            "display" : function () { return "none"; },
                            "stroke" : "none"
                        });
                }
                return this;
            },
            axisContainer : function () {
                if(PykCharts.boolean(that.axis_x_enable)  || that.axis_x_title) {
                    that.xgroup = that.group.append("g")
                        .attr({
                            "id" : "xaxis",
                            "class" : "x axis"
                        })
                        .style("stroke","none");
                }

                if(PykCharts.boolean(that.axis_y_enable)  || that.axis_y_title) {
                    that.ygroup = that.group.append("g")
                        .attr({
                            "id" : "yaxis",
                            "class" : "y axis"
                        });

                    that.new_yAxisgroup = that.group.append("g")
                        .attr({
                            "id" : "new-yaxis",
                            "class" : "y new-axis"
                        })
                        .style("stroke","blue");
                }
                return this;
            },
            createColumn: function () {
                that.x_tick_values = that.k.processXAxisTickValues();
                that.y_tick_values = that.k.processYAxisTickValues();
                that.reducedWidth = that.chart_width - that.chart_margin_left - that.chart_margin_right;
                that.reducedHeight = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
                var height = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
                var x_domain,x_data = [],y_data = [],y_range,x_range,y_domain, min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;

                if(that.axis_y_data_format === "number") {
                    y_domain = [0,d3.max(that.data,function (d) { return d.y; })];
                    y_data = that.k._domainBandwidth(y_domain,1);
                    y_range = [that.chart_height - that.chart_margin_top - that.chart_margin_bottom, 0];
                    min_y_tick_value = d3.min(that.y_tick_values);
                    max_y_tick_value = d3.max(that.y_tick_values);

                    if(y_data[0] > min_y_tick_value) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(y_data[1] < max_y_tick_value) {
                        y_data[1] = max_y_tick_value;
                    }
                    that.data.sort(function (a,b) {
                        return a.y - b.y;
                    })
                    that.yScale1 = that.k.scaleIdentification("linear",y_data,y_range);
                    y_data1 = that.data.map(function (d) { return d.y; });
                    y_range1 = [0,that.chart_height - that.chart_margin_top - that.chart_margin_bottom];
                    that.yScale = that.k.scaleIdentification("ordinal",y_data1,y_range1,0.3);
                    that.extra_top_margin = (that.yScale.rangeBand() / 2);

                } else if(that.axis_y_data_format === "string") {
                    y_data = that.data.map(function (d) { return d.y; });
                    y_range = [0,that.chart_height - that.chart_margin_top - that.chart_margin_bottom];
                    that.yScale = that.k.scaleIdentification("ordinal",y_data,y_range,0.3);
                    that.extra_top_margin = (that.yScale.rangeBand() / 2);

                }

                if(that.axis_x_data_format === "number") {
                    x_domain = [0,d3.max(that.data,function (d) {  return +d.x; })];
                    x_data = that.k._domainBandwidth(x_domain,1);
                    x_range = [0 ,that.reducedWidth];
                    min_x_tick_value = d3.min(that.x_tick_values);
                    max_x_tick_value = d3.max(that.x_tick_values);

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }

                    that.xScale = that.k.scaleIdentification("linear",x_data,x_range);
                    that.extra_left_margin = 0;
                }

                that.x_domain = that.xScale.domain();
                that.y_domain = that.yScale.domain();

                that.bar = that.group.selectAll(".bar-rect")
                    .data(that.data);

                that.bar.enter()
                    .append("g")
                    .attr("class","bar-rect")
                    .append("svg:rect");

                that.bar.attr("class","bar-rect")
                    .select("rect")
                    .attr({
                        "class" : "hbar",
                        "y" :  function (d) { return that.yScale(d.y); },
                        "x" : 0,
                        "height" : function (d) {return that.yScale.rangeBand(d.y);},
                        "width" : 0,
                        "fill" : function (d) { return that.fillColor.colorPieMS(d); },
                        "stroke" : that.border.color(),
                        "stroke-width" : that.border.width(),
                        "stroke-dasharray": that.border.style(),
                        "data-id":function (d,i) {
                            return d.name;
                        }
                    })
                    .on({
                        'mouseover': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent1.highlight(that.selector+" "+".hbar", this);
                                }
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    that.mouseEvent.tooltipPosition(d);
                                    that.mouseEvent.tooltipTextShow(d.tooltip ? d.tooltip : d.x);
                                }
                            }
                        },
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent1.highlightHide(that.selector+" "+".hbar");
                                }
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    that.mouseEvent.tooltipHide(d);
                                }
                                that.mouseEvent.axisHighlightHide(that.selector+" "+".y.axis")
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default") {
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    that.mouseEvent.tooltipPosition(d);
                                }
                                that.mouseEvent.axisHighlightShow([d.y],that.selector+" "+".y.axis",that.y_domain);
                            }
                        },
                        'click': function (d,i) {
                            if(PykCharts['boolean'](that.click_enable)){
                               that.addEvents(d.name, d3.select(this).attr("data-id"));
                            }
                        }
                    })
                    .transition()
                    .duration(that.transitions.duration())
                    .attr("width", function (d) { return that.xScale(d.x); });

                that.bar.exit()
                    .remove();

                var t = d3.transform(d3.select(d3.selectAll(that.selector + ' .bar-rect')[0][(that.data.length-1)]).attr("transform")),
                    x = t.translate[0],
                    y = t.translate[1];
                y_range = [(that.reducedHeight - y - (that.yScale.rangeBand()/2)),(y + (that.yScale.rangeBand()/2))];
                that.yScale1 = that.k.scaleIdentification("linear",y_data,y_range);
                return this;
            },
            ticks: function() {
                if(that.pointer_size) {
                    var tick_label = that.group.selectAll(".ticks_label")
                        .data(that.data);

                    tick_label.enter()
                        .append("text")

                    tick_label.attr("class","ticks_label")
                        .attr("fill", that.pointer_color)
                        .style({
                            "font-weight": that.pointer_weight,
                            "font-size": that.pointer_size + "px",
                            "font-family": that.pointer_family
                        })
                        .text("");

                    function setTimeoutTicks () {
                        tick_label
                            .attr({
                                "x" : function (d) { return that.xScale(d.x); },
                                "y" : function (d) { return that.yScale(d.name) + that.yScale.rangeBand(d.y)/2; },
                                "dx" : 4,
                                "dy" : 4,
                            })
                            .text(function (d) {
                                return d.x;
                            });
                    }
                    setTimeout(setTimeoutTicks ,that.transitions.duration());

                }
                return this;
            },
            sort : function () {
                if(that.axis_y_data_format === "string") {
                    try {
                        if(that.data_sort_type === "alphabetically" || that.data_sort_type === "numerically") {
                        } else {
                            that.data_sort_type = multiDimensionalCharts.data_sort_type;
                            throw "data_sort_type";
                        }
                    }
                    catch(err) {
                        that.k.warningHandling(err,"8");
                    }
                    var column_to_be_sorted = "";
                    switch (that.data_sort_type) {
                        case "alphabetically":
                        case "date":
                            column_to_be_sorted = "y";
                            break;
                        case "numerically":
                            column_to_be_sorted = "x";
                            break;
                    }
                    that.data = that.k.__proto__._sortData(that.data, column_to_be_sorted, "group", that,"notApplicable");
                }
            }
        };
        return optional;
    };
};
PykCharts.multiD.groupedBar = function(options){
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    var multiDimensionalCharts = theme.multiDimensionalCharts;
    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
        PykCharts.scaleFunction(that);
        that.data_sort_enable = options.data_sort_enable ? options.data_sort_enable.toLowerCase() : multiDimensionalCharts.data_sort_enable;
        that.data_sort_type = PykCharts['boolean'](that.data_sort_enable) && options.data_sort_type ? options.data_sort_type.toLowerCase() : multiDimensionalCharts.data_sort_type;
        that.data_sort_order = PykCharts['boolean'](that.data_sort_enable) && options.data_sort_order ? options.data_sort_order.toLowerCase() : multiDimensionalCharts.data_sort_order;

        try {
            if(that.data_sort_order === "ascending" || that.data_sort_order === "descending") {
            } else {
                that.data_sort_order = multiDimensionalCharts.data_sort_order;
                throw "data_sort_order";
            }
        }
        catch(err) {
            that.k.warningHandling(err,"9");
        }

        if(that.stop){
            return;
        }
        that.k.storeInitialDivHeight();
        that.panels_enable = "no";

        if(that.mode === "default") {
           that.k.loading();
        }
        that.multiD = new PykCharts.multiD.configuration(that);

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("bar",data);
            that.compare_data = that.k.__proto__._groupBy("bar",data);
            that.axis_x_data_format = "number";
            that.axis_y_data_format = that.k.yAxisDataFormatIdentification(that.data);
            if(that.axis_y_data_format === "time") {
                that.axis_y_data_format = "string";
            }
            that.k.remove_loading_bar(id);
            // PykCharts.multiD.columnFunctions(options,that,"group_bar");
            that.render();
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }

    };

    that.dataTransformation = function () {
        if(PykCharts['boolean'](that.data_sort_enable)) {
            that.data = that.optionalFeatures().sort(that.data,"group");
        }
        that.group_arr = [], that.new_data = [];
        that.data_length = that.data.length;
        for(var j = 0;j < that.data_length;j++) {
            that.group_arr[j] = that.data[j].y;
        }
        that.uniq_group_arr = that.k.__proto__._unique(that.group_arr);
        var len = that.uniq_group_arr.length;

        for (var k = 0;k < len;k++) {
            that.new_data[k] = {
                name: that.uniq_group_arr[k],
                data: []
            };
            for (var l = 0;l < that.data_length;l++) {
                if (that.uniq_group_arr[k] === that.data[l].y) {
                    that.new_data[k].data.push({
                        x: that.data[l].x,
                        name: that.data[l].group,
                        tooltip: that.data[l].tooltip,
                        color: that.data[l].color
                    });
                }
            }
        }

        that.new_data_length = that.new_data.length;
        if(!PykCharts['boolean'](that.data_sort_enable)) {
            for(var i = 0;i<that.new_data_length;i++) {
                that.new_data[i].data = that.optionalFeatures().sort(that.new_data[i].data,"name");
            }
        }
    };

    that.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("bar",data);
            that.refresh_data = that.k.__proto__._groupBy("bar",data);
            that.dataTransformation();
            that.optionalFeatures().mapColors();

            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }

            that.optionalFeatures()
                .createChart()
                .legends()
                .ticks()
                .highlightRect();

            that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height);
            if(that.axis_y_data_format !== "string") {
                that.k.yAxis(that.svgContainer,that.yGroup,that.yScale1,that.ydomain,that.y_tick_values,that.legendsGroup_width,"groupbar");
                that.optionalFeatures().newYAxis();
            } else {
                that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width);
            }
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    that.render = function() {
        var that = this,
            id = that.selector.substring(1,that.selector.length),
            container_id = id + "_svg";

        that.dataTransformation();
        that.optionalFeatures().mapColors();
        that.border = new PykCharts.Configuration.border(that);
        that.transitions = new PykCharts.Configuration.transition(that);
        // that.mouseEvent1 = new PykCharts.multiD.mouseEvent(that);
        that.mouseEvent1 = new PykCharts.Configuration.mouseEvent(that);
        that.fillColor = new PykCharts.Configuration.fillChart(that,null,options);

        if(that.mode === "default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"groupbarChart")
                .emptyDiv(that.selector)
                .subtitle()
                .makeMainDiv(that.selector,1);

            that.optionalFeatures()
                .svgContainer(container_id,1)
                .legendsContainer(1);

            that.k.liveData(that)
                .tooltip()
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .legends()
                .createGroups(1)
                .createChart()
                .axisContainer()
                .highlightRect()
                .ticks();

            that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
                .xAxisTitle(that.xGroup)
                .yAxisTitle(that.yGroup);
            if(that.axis_y_data_format !== "string") {
                that.k.yAxis(that.svgContainer,that.yGroup,that.yScale1,that.ydomain,that.y_tick_values,that.legendsGroup_width,"groupbar");
                that.optionalFeatures().newYAxis();
            } else {
                that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width);
            }
        } else if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"groupbarChart")
                .emptyDiv(that.selector)
                .makeMainDiv(that.selector,1);

            that.optionalFeatures().svgContainer(container_id,1)
                .legendsContainer(1)
                .createGroups(1)
                .createChart()
                .axisContainer()
                .highlightRect();

            that.k.tooltip();
            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
            that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
                .xAxisTitle(that.xGroup)
                .yAxisTitle(that.yGroup);
            if(that.axis_y_data_format !== "string") {
                that.k.yAxis(that.svgContainer,that.yGroup,that.yScale1,that.ydomain,that.y_tick_values,that.legendsGroup_width,"groupbar");
                that.optionalFeatures().newYAxis();
            } else {
                that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width);
            }
        }

        that.k.exportSVG(that,"#"+container_id,"groupbarChart")

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    that.optionalFeatures = function() {
        var that = this;
        var id = that.selector.substring(1,that.selector.length);
        var optional = {
            svgContainer: function (container_id,i) {
                document.getElementById(id).className += " PykCharts-twoD";
                that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
                    .append("svg:svg")
                    .attr({
                        "width" : that.chart_width,
                        "height" : that.chart_height,
                        "id" : container_id,
                        "class" : "svgcontainer",
                        "preserveAspectRatio" : "xMinYMin",
                        "viewBox" : "0 0 " + that.chart_width + " " + that.chart_height
                    });
                return this;
            },
            createGroups: function (i) {
                that.group = that.svgContainer.append("g")
                    .attr({
                        "id" : "groupedBar-group",
                        "transform" : "translate(" + that.chart_margin_left + "," + (that.chart_margin_top + that.legendsGroup_height) +")"
                    });

                return this;
            },
            legendsContainer: function (i) {
                if(PykCharts.boolean(that.legends_enable) && that.mode === "default") {
                    that.legendsGroup = that.svgContainer.append("g")
                        .attr({
                            "id" : "groupedBar-legends",
                            "class" : "legends",
                            "transform" : "translate(0,10)"
                        })
                        .style("visibility","hidden");
                } else {
                    that.legendsGroup_height = 0;
                    that.legendsGroup_width = 0;
                }
                return this;
            },
            axisContainer : function () {
                if(PykCharts.boolean(that.axis_x_enable) || that.axis_x_title) {
                    that.xGroup = that.group.append("g")
                        .attr({
                            "class" : "x axis",
                            "id" : "xaxis"
                        })
                        .style("stroke","black");
                }

                if(PykCharts.boolean(that.axis_y_enable) || that.axis_y_title) {
                    that.yGroup = that.group.append("g")
                        .attr({
                            "class" : "y axis",
                            "id" : "yaxis"
                        })
                        .style("stroke","blue");
                    that.new_yAxisgroup = that.group.append("g")
                        .attr({
                            "class" : "y new-axis",
                            "id" : "new-yaxis"
                        })
                        .style("stroke","blue");

                }
                return this;
            },
            createChart: function() {
                that.reduced_width = that.chart_width - that.chart_margin_left - that.chart_margin_right - that.legendsGroup_width;

                that.reduced_height = that.chart_height - that.chart_margin_top - that.chart_margin_bottom - that.legendsGroup_height;

                that.getuniqueGroups = that.data.map(function (d) {
                    return d.group;
                })


                that.getuniqueGroups = that.k.__proto__._unique(that.getuniqueGroups)

                that.getuniqueGroups.sort(function(a,b){
                    if(a > b) {
                        return 1;
                    } else {
                        return -1
                    }
                })

                that.x_tick_values = that.k.processXAxisTickValues();
                that.y_tick_values = that.k.processYAxisTickValues();

                var x_domain,x_data = [],y_data,y_range,x_range,y_domain,min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;

                if(that.axis_y_data_format === "number") {
                    max = d3.max(that.new_data, function(d) { return d.name });
                    min = d3.min(that.new_data, function(d) { return d.name });
                    y_domain = [min,max];
                    // y_data = that.k.__proto__._domainBandwidth(y_domain,2);
                    y_data = y_domain;

                    min_y_tick_value = d3.min(that.y_tick_values);
                    max_y_tick_value = d3.max(that.y_tick_values);

                    if(y_data[0] > min_y_tick_value) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(y_data[1] < max_y_tick_value) {
                        y_data[1] = max_y_tick_value;
                    }

                    that.new_data.sort(function (a,b) {
                        return a.name - b.name;
                    })
                    y_data1 = that.new_data.map(function (d) { return d.name; });
                    y_range1 = [that.reduced_height,0];
                    that.yScale = that.k.scaleIdentification("ordinal",y_data1,y_range1,0.3);
                    that.extra_top_margin = (that.yScale.rangeBand() / 2);
                    that.y1 = d3.scale.ordinal()
                        .domain(that.getuniqueGroups)
                        .rangeRoundBands([that.yScale.rangeBand(),0]) ;
                    that.extra_top_margin = 0;
                } else if(that.axis_y_data_format === "string") {
                    y_data = that.new_data.map(function (d) { return d.name; });
                    y_range = [0,that.reduced_height];
                    that.yScale = that.k.scaleIdentification("ordinal",y_data,y_range,0.3);
                    that.extra_top_margin = (that.yScale.rangeBand() / 2);
                    that.y1 = d3.scale.ordinal()
                        .domain(that.getuniqueGroups)
                        .rangeRoundBands([0, that.yScale.rangeBand()]) ;
                }

                if(that.axis_x_data_format === "number") {
                    that.max_x_value = d3.max(that.new_data, function(d) { return d3.max(d.data, function(d) { return d.x; }); });

                    x_domain = [0,that.max_x_value];
                    x_data = that.k._domainBandwidth(x_domain,1);
                    x_range = [0 ,that.reduced_width];
                    min_x_tick_value = d3.min(that.x_tick_values);
                    max_x_tick_value = d3.max(that.x_tick_values);

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }

                    that.xScale = that.k.scaleIdentification("linear",x_data,x_range);
                    that.extra_left_margin = 0;
                }

                that.xdomain = that.xScale.domain();
                that.ydomain = that.yScale.domain();
                that.highlight_x_positions =  [];
                var chart = that.group.selectAll(".groupedBar-rect")
                    .data(that.new_data);

                chart.enter()
                    .append("g")
                    .attr("class", "groupedBar-rect");

                that.highlight_y_positions = "";

                chart
                    .attr("transform", function (d) {
                        that.optionalFeatures().checkIfHighLightDataExists(d.name);
                        if(that.highlight_group_exits) {
                            that.flag = true;
                            that.highlight_y_positions = that.yScale(d.name);
                        }
                        return "translate(" + 0 + "," + that.yScale(d.name) + ")";
                    })
                    .on({
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightGroupHide(that.selector+" .groupedBar-rect","rect");
                                }
                                that.mouseEvent.axisHighlightHide(that.selector+" .y.axis")
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightGroup(that.selector+" .groupedBar-rect", this, "rect");
                                }
                                that.mouseEvent.axisHighlightShow(d.name,(that.selector+" .y.axis"),that.ydomain,"bar");
                            }
                        }
                    });

                var bar = chart.selectAll("rect")
                    .data(function (d) { return d.data; });

                bar.enter()
                    .append("rect")

                bar.attr({
                    "height" : 0,
                    "y" : function (d) {return that.y1(d.name); },
                    "x" : 0,
                    "width" : 0,
                    "height" : function (d){ return 0.98*that.y1.rangeBand(); },
                    "fill" : function (d,i) {
                        return that.fillColor.colorGroup(d);
                    },
                    "fill-opacity" : function (d,i) {
                        if (that.color_mode === "saturation") {
                            return (i+1)/that.no_of_groups;
                        } else {
                            return 1;
                        }
                    },
                    "stroke" : that.border.color(),
                    "stroke-width" : that.border.width(),
                    "stroke-dasharray": that.border.style(),
                    "data-fill-opacity" : function () {
                        return d3.select(this).attr("fill-opacity");
                    },
                    "data-id":function (d,i) {
                            return d.name;
                    }
                })
                .on({
                    'mouseover': function (d) {
                        if(that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
                            var tooltip = d.tooltip ? d.tooltip : d.x;
                            that.mouseEvent.tooltipPosition(d);
                            that.mouseEvent.tooltipTextShow(tooltip);
                        }
                    },
                    'mouseout': function (d) {
                        if(that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
                            that.mouseEvent.tooltipHide(d);
                        }
                    },
                    'mousemove': function (d) {
                        if(that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
                            that.mouseEvent.tooltipPosition(d);
                        }
                    },
                    'click': function (d,i) {
                        if(PykCharts['boolean'](that.click_enable)){
                           that.addEvents(d.name, d3.select(this).attr("data-id"));
                        }
                    }
                })
                .transition()
                .duration(that.transitions.duration())
                .attr("width", function (d) { return that.xScale(d.x); })

                bar.exit().remove();
                chart.exit().remove();

                var t = d3.transform(d3.select(d3.selectAll('.groupedBar-rect')[0][(that.new_data.length-1)]).attr("transform")),
                    x = t.translate[0],
                    y = t.translate[1];
                y_range = [(that.reduced_height-y - (that.y1.rangeBand()*2)),(y + (that.y1.rangeBand()*2))];
                that.yScale1 = that.k.scaleIdentification("linear",y_data,y_range);

                return this;
            },
            ticks : function(){
                if(that.pointer_size) {
                    var ticks = that.group.selectAll(".groupedBar-ticks")
                        .data(that.new_data);

                        ticks.enter()
                        .append("g")
                        .attr("class","groupedBar-ticks");

                    ticks.attr("transform", function (d) {
                        return "translate(" + 0 + "," + that.yScale(d.name) + ")";
                    })

                    var tick_label = ticks.selectAll(".ticks_label")
                        .data(function (d) { return d.data; });

                    tick_label.enter()
                        .append("text")

                    tick_label.attr("class","ticks_label")
                        .style("font-weight", that.pointer_weight)
                        .style("font-size", that.pointer_size + "px")
                        .attr("fill", that.pointer_color)
                        .style("font-family", that.pointer_family)
                        .text("");

                    function setTimeoutTicks() {
                        tick_label.attr({
                            "x" : function (d) { return that.xScale(d.x); },
                            "y" : function(d) { return (that.y1(d.name))+(that.y1.rangeBand()/2); },
                            "dx" : 4,
                            "dy" : 2
                        })
                        .transition()
                        .text(function (d) {
                            if(d.x) {
                                return (d.x).toFixed();
                            }
                        })
                        .attr({
                            "pointer-events" : "none",
                        })
                        .text(function (d) {
                            if(d.x) {
                                that.txt_width = this.getBBox().width;
                                that.txt_height = this.getBBox().height;
                                if(d.x && (that.txt_width< that.xScale(d.x)) && (that.txt_height < (that.y1.rangeBand() ))) {
                                    return d.x;
                                }
                            }
                        });
                    }
                    setTimeout(setTimeoutTicks,that.transitions.duration());

                    tick_label.exit().remove();
                    ticks.exit().remove();
                }
                return this;
            },
            mapColors : function () {
                that.no_of_groups = d3.max(that.new_data,function (d){
                    return d.data.length;
                });

                for(var i = 0;i<that.new_data_length;i++) {
                    if(that.new_data[i].data.length === that.no_of_groups) {
                        that.group_data = that.new_data[i].data;
                        that.group_data_length = that.group_data.length;
                        break;
                    }
                }

                for(var i = 0;i<that.group_data_length;i++) {
                    if(that.color_mode === "color" && that.chart_color[i]) {
                        that.group_data[i].color = that.chart_color[i];
                    } else {
                        that.group_data[i].color = that.default_color[0];
                    }
                }

                that.new_data.forEach(function(d){
                    d.data.forEach(function(data){
                        for (var i=0 ; i<that.group_data_length ; i++) {
                            if (that.group_data[i].name === data.name) {
                                data.color = that.group_data[i].color;
                                break;
                            }
                        }
                    })
                });
            },
            legends: function () {
                if(PykCharts.boolean(that.legends_enable)) {
                    var params = that.group_data,color;
                    color = params.map(function (d) {
                        return d.color;
                    });
                    params = params.map(function (d) {
                        return d.name;
                    });
                    params = that.k.__proto__._unique(params);
                    that.multiD.legendsPosition(that,"groupBar",params,color);
                }
                return this;
            },
            checkIfHighLightDataExists : function (name) {
                if(that.highlight) {
                    if(that.axis_y_data_format === "number") {
                        that.highlight_group_exits = (that.highlight === name);
                    } else if (that.axis_y_data_format === "string") {
                        that.highlight_group_exits = (that.highlight.toLowerCase() === name.toLowerCase());
                    }
                }
                return this;
            },
            highlightRect : function () {
                if(that.flag) {
                    function setTimeoutHighlight() {
                        y = that.highlight_y_positions - 5;

                        var highlight_rect = that.group.selectAll(".highlight-groupedBar-rect")
                            .data([that.highlight])

                        highlight_rect.enter()
                            .append("rect")

                        highlight_rect.attr("class","highlight-groupedBar-rect")
                            .attr({
                                "x" : 0,
                                "y" : y,
                                "height" : (that.y1.rangeBand()* that.group_data_length)+10,
                                "width" : that.reduced_width + 5,
                                "fill" : "none",
                                "stroke" : that.highlight_color,
                                "stroke-width" : "1.5px",
                                "stroke-dasharray" : "5,5",
                                "stroke-opacity" : 1
                            });
                        highlight_rect.exit()
                            .remove();
                        if(PykCharts["boolean"](that.highlight_y_positions)) {
                            highlight_array = that.highlight;
                        } else {
                            highlight_rect
                                .remove()
                        }
                    }
                    setTimeout(setTimeoutHighlight, that.transitions.duration());
                }
                return this;
            },
            newYAxis : function () {
                if(PykCharts["boolean"](that.axis_y_enable)) {
                    if(that.axis_y_position === "right") {
                        that.new_yAxisgroup.attr("transform", "translate(" + (that.chart_width - that.chart_margin_left - that.chart_margin_right - that.legendsGroup_width) + ",0)");
                    }
                    var yaxis = d3.svg.axis()
                        .scale(that.yScale)
                        .orient(that.axis_y_pointer_position)
                        .tickSize(0)
                        .outerTickSize(that.axis_y_outer_pointer_length);
                    that.new_yAxisgroup.style("stroke",function () { return that.axis_y_line_color; })
                        .call(yaxis);
                    d3.selectAll(that.selector + " .y.new-axis text")
                        .style({
                            "display": function () { return "none"; },
                            "stroke": "none"
                        });
                }
                return this;
            },
            sort : function(data,dimension) {
                if(that.axis_y_data_format === "string") {
                    try {
                        if(that.data_sort_type === "alphabetically") {
                        } else {
                            that.data_sort_type = multiDimensionalCharts.data_sort_type;
                            throw "data_sort_type";
                        }
                    }
                    catch(err) {
                        that.k.warningHandling(err,"8");
                    }
                    data = that.k.__proto__._sortData(data, "y", dimension, that);
                    return data;
                }
                return data;
            }
        }
        return optional;
    };
};
PykCharts.multiD.column = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);
        if(that.stop){
            return;
        }
        that.panels_enable = "no";
        that.k.storeInitialDivHeight();

        if(that.mode === "default") {
           that.k.loading();
        }

        that.multiD = new PykCharts.multiD.configuration(that);
        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("column",data);
            that.compare_data = that.k.__proto__._groupBy("column",data);
            that.axis_y_data_format = "number";
            that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
            if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
                console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
            }
            that.k.remove_loading_bar(id);
            that.render();
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };

    this.transformData = function () {
        var group_arr = [], uniq_group_arr = [];
        if (options.chart_color != 0 && options.chart_color != undefined) {
            that.chart_color[0] = options.chart_color[0];
        }
        else {
            for (var i=0,len=that.data.length ; i<len ; i++) {
                if (that.data[i].color != "" && that.data[i].color != undefined) {
                    that.chart_color[0] = that.data[i].color;
                    if (options.axis_x_pointer_color == undefined || options.axis_x_pointer_color == "") {
                        that.axis_x_pointer_color = that.chart_color[0];
                    }
                    break;
                }
            }
        }
        that.data.forEach(function(d){
            d.name = d.x;
            d.color = that.chart_color[0];
        });

        for(var j=0, len=that.data.length ; j<len ; j++) {
            group_arr[j] = that.data[j].group;
        }
        uniq_group_arr = that.k.__proto__._unique(group_arr);
        that.no_of_groups = uniq_group_arr.length;
    }

    this.render = function () {
        var id = that.selector.substring(1,that.selector.length),
            container_id = id + "_svg";

        that.border = new PykCharts.Configuration.border(that);
        that.transitions = new PykCharts.Configuration.transition(that);
        // that.mouseEvent1 = new PykCharts.multiD.mouseEvent(options);
        that.mouseEvent1 = new PykCharts.Configuration.mouseEvent(options);
        that.fillColor = new PykCharts.Configuration.fillChart(that,null,options);
        that.transformData();

        try {
            if(that.no_of_groups > 1) {
                throw "Invalid data in the JSON";
            }
        }
        catch (err) {
            console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+that.selector+". \""+err+"\"  Visit www.pykcharts.com/errors#error_8");
            return;
        }

        if(that.axis_x_data_format === "time") {
            that.data.forEach(function (d) {
                d.x =that.k.dateConversion(d.x);
            });
        }

      //  that.map_group_data = that.multiD.mapGroup(that.data);
        if(that.mode === "default") {

            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"columnChart")
                .emptyDiv(that.selector)
                .subtitle()
                .makeMainDiv(that.selector,1);

            that.optionalFeatures()
                .svgContainer(container_id,1)
                .createGroups();

            that.k.liveData(that)
                .tooltip()
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .createColumn()
                .axisContainer();

            that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values)
                .yGrid(that.svgContainer,that.group,that.yScale)
                .xAxisTitle(that.xgroup)
                .yAxisTitle(that.ygroup);
            if(that.axis_x_data_format !== "string") {
                console.log(that.xScale1.domain())
                that.k.xAxis(that.svgContainer,that.xgroup,that.xScale1,that.extra_left_margin,that.x_domain,that.x_tick_values,null,"bar",that);
                that.optionalFeatures().newXAxis();
            } else {
                that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values,null,null,that);
            }

        } else if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"columnChart")
                .emptyDiv(that.selector)
                .makeMainDiv(that.selector,1);

            that.optionalFeatures()
                .svgContainer(container_id,1)
                .createGroups();

            that.k.liveData(that)
                .tooltip();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .createColumn()
                .axisContainer();

            that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values)
                .xAxisTitle(that.xgroup)
                .yAxisTitle(that.ygroup);
            if(that.axis_x_data_format !== "string") {
                that.k.xAxis(that.svgContainer,that.xgroup,that.xScale1,that.extra_left_margin,that.x_domain,that.x_tick_values,null,"bar")
                that.optionalFeatures().newXAxis();
            } else {
                that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values)
            }
        }
        that.k.exportSVG(that,"#"+container_id,"columnChart")

        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    this.refresh = function (pykquery_data) {
       that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("column",data);
            that.refresh_data = that.k.__proto__._groupBy("column",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            that.transformData();
            if(that.axis_x_data_format === "time") {
                that.data.forEach(function (d) {
                    d.x =that.k.dateConversion(d.x);
                    d.color = that.chart_color[0];
                });
            }

            try {
                if(that.no_of_groups > 1) {
                    throw "Invalid data in the JSON";
                }
            }
            catch (err) {
                console.error('%c[Error - Pykih Charts] ', 'color: red;font-weight:bold;font-size:14px', " at "+that.selector+". \""+err+"\"  Visit www.pykcharts.com/errors#error_8");
                return;
            }

            // that.map_group_data = that.multiD.mapGroup(that.data);

            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }

            that.optionalFeatures()
                .createColumn();

            that.k.yAxis(that.svgContainer,that.ygroup,that.yScale,that.y_domain,that.y_tick_values)
                .yGrid(that.svgContainer,that.group,that.yScale);
            if(that.axis_x_data_format !== "string") {
                that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values,null,"bar")
                that.optionalFeatures().newXAxis();
            } else {
                that.k.xAxis(that.svgContainer,that.xgroup,that.xScale,that.extra_left_margin,that.x_domain,that.x_tick_values)
            }
        };

        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.optionalFeatures = function () {
        var id = that.selector.substring(1,that.selector.length);
        var status;
        var optional = {
            svgContainer: function (container_id,i) {
                document.getElementById(id).className += " PykCharts-twoD";
                that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
                    .append("svg:svg")
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer",
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
                    });
                return this;
            },
            createGroups: function (i) {
                that.group = that.svgContainer.append("g")
                    .attr({
                        "id": "column-group",
                        "transform": "translate(" + that.chart_margin_left + "," + (that.chart_margin_top/* + that.legendsGroup_height*/) +")"
                    });

                if(PykCharts.boolean(that.chart_grid_y_enable)) {
                    that.group.append("g")
                        .attr({
                            "id": "ygrid",
                            "class": "y grid-line"
                        });
                }
                return this;
            },
            axisContainer : function () {
                if(PykCharts.boolean(that.axis_x_enable)  || that.axis_x_title) {
                    that.xgroup = that.group.append("g")
                        .attr({
                            "id": "xaxis",
                            "class": "x axis"
                        })
                        .style("stroke","none");
                }

                if(PykCharts.boolean(that.axis_y_enable)  || that.axis_y_title) {
                    that.ygroup = that.group.append("g")
                        .attr({
                            "id": "yaxis",
                            "class": "y axis"
                        });
                    that.new_xAxisgroup = that.group.append("g")
                        .attr({
                            "class": "x new-axis",
                            "id": "new-xaxis"
                        })
                        .style("stroke","blue");
                }
                return this;
            },
            createColumn: function () {
                that.x_tick_values = that.k.processXAxisTickValues();
                that.y_tick_values = that.k.processYAxisTickValues();
                that.reducedWidth = that.chart_width - that.chart_margin_left - that.chart_margin_right;

                var height = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
                var x_domain,x_data = [],y_data = [],y_range,x_range,y_domain, min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;

                if(that.axis_y_data_format === "number") {
                    y_domain = [0,d3.max(that.data,function (d) { return d.y; })];
                    y_data = that.k._domainBandwidth(y_domain,1);
                    y_range = [that.chart_height - that.chart_margin_top - that.chart_margin_bottom, 0];
                    min_y_tick_value = d3.min(that.y_tick_values);
                    max_y_tick_value = d3.max(that.y_tick_values);

                    if(y_data[0] > min_y_tick_value) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(y_data[1] < max_y_tick_value) {
                        y_data[1] = max_y_tick_value;
                    }

                    that.yScale = that.k.scaleIdentification("linear",y_data,y_range);
                    that.extra_top_margin = 0;


                } else if(that.axis_y_data_format === "string") {
                    y_data = that.data.map(function (d) { return d.y; });
                    y_range = [0,that.chart_height - that.chart_margin_top - that.chart_margin_bottom];
                    that.yScale = that.k.scaleIdentification("ordinal",y_data,y_range,0.3);
                    that.extra_top_margin = (that.yScale.rangeBand() / 2);

                } else if (that.axis_y_data_format === "time") {
                    y_data = d3.extent(that.data, function (d) {
                        return parseDate(d.y);
                    });

                    min_y_tick_value = d3.min(that.y_tick_values, function (d) {
                        return new Date(d);
                    });

                    max_y_tick_value = d3.max(that.y_tick_values, function (d) {
                        return new Date(d);
                    });

                    if(new Date(y_data[0]) > new Date(min_y_tick_value)) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(new Date(y_data[1]) < new Date(max_y_tick_value)) {
                        y_data[1] = max__tick_value;
                    }

                    y_range = [that.chart_height - that.chart_margin_top - that.chart_margin_bottom, 0];
                    that.yScale = that.k.scaleIdentification("time",y_data,y_range);
                    that.extra_top_margin = 0;
                }
                if(that.axis_x_data_format === "number") {
                    x_domain = [d3.min(that.data,function (d) { return +d.x; }),d3.max(that.data,function (d) { return +d.x; })];
                    console.log(x_domain)
                    x_data = that.k._domainBandwidth(x_domain);
                    x_range = [0 ,that.reducedWidth];
                    min_x_tick_value = d3.min(that.x_tick_values);
                    max_x_tick_value = d3.max(that.x_tick_values);

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }
                    that.data.sort(function (a,b) {
                        return a.x - b.x;
                    })
                    console.log(x_data)
                    that.xScale1 = that.k.scaleIdentification("linear",x_data,x_range);
                    x_data1 = that.data.map(function (d) { return d.x; });
                    x_range1 = [0 ,that.reducedWidth];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data1,x_range1,0.3);
                    that.extra_left_margin = (that.xScale.rangeBand()/2);

                } else if(that.axis_x_data_format === "string") {
                    x_data = that.data.map(function (d) { return d.x; });
                    x_range = [0 ,that.reducedWidth];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data,x_range,0.3);
                    that.extra_left_margin = (that.xScale.rangeBand()/2);
                } else if (that.axis_x_data_format === "time") {
                    max = d3.max(that.data, function(k) { return (k.x); });
                    min = d3.min(that.data, function(k) { return (k.x); });
                    x_domain = [min.getTime(),max.getTime()];

                    min_x_tick_value = d3.min(that.x_tick_values, function (d) {
                        return that.k.dateConversion(d);
                    });

                    max_x_tick_value = d3.max(that.x_tick_values, function (d) {
                        return that.k.dateConversion(d);
                    });

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }

                    x_range = [0 ,that.reducedWidth];
                    that.xScale = that.k.scaleIdentification("time",x_domain,x_range);
                    that.data.sort(function (a,b) {
                        if ((a.x) < (b.x)) {
                            return -1 ;
                        }
                        else if ((a.x) > (b.x)) {
                            return 1;
                        }
                    })
                    console.log(data)
                    that.xScale1 = that.k.scaleIdentification("linear",x_data,x_range);
                    x_data1 = that.data.map(function (d) { return d.x; });
                    x_range1 = [0 ,that.reducedWidth];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data1,x_range1,0.3);
                    that.extra_left_margin = (that.xScale.rangeBand()/2);

                }

                that.x_domain = that.xScale.domain();
                that.y_domain = that.yScale.domain();

                that.bar = that.group.selectAll(".column-rect")
                    .data(that.data)

                that.bar.enter()
                    .append("g")
                    .attr("class","column-rect")
                    .append("svg:rect");

                that.bar.attr("class","column-rect")
                    .select("rect")
                    .attr({
                        "class": "vcolumn",
                        "x": function (d) { return that.xScale(d.x); },
                        "y": height,
                        "height": 0,
                        "width": function (d) { return that.xScale.rangeBand(d.x); },
                        "fill": function (d) { return that.fillColor.colorPieMS(d); },
                        "stroke": that.border.color(),
                        "stroke-width": that.border.width(),
                        "stroke-dasharray": that.border.style(),
                        "data-id":function (d,i) {
                            return d.name;
                        }
                    })
                    .on({
                        'mouseover': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent1.highlight(that.selector+" "+".vcolumn", this);
                                }
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    that.mouseEvent.tooltipPosition(d);
                                    that.mouseEvent.tooltipTextShow(d.tooltip ? d.tooltip : d.y);
                                }
                            }
                        },
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent1.highlightHide(that.selector+" "+".vcolumn");
                                }
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    that.mouseEvent.tooltipHide(d);
                                }
                                that.mouseEvent.axisHighlightHide(that.selector+" "+".x.axis")
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default") {
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    that.mouseEvent.tooltipPosition(d);
                                }
                                that.mouseEvent.axisHighlightShow(d.x,that.selector+" "+".x.axis",that.x_domain);
                            }
                        },
                        'click': function (d,i) {
                            if(PykCharts['boolean'](that.click_enable)){
                               that.addEvents(d.name, d3.select(this).attr("data-id"));
                            }
                        }
                    })
                    .transition()
                    .duration(that.transitions.duration())
                    .attr({
                        "y": function (d) { return that.yScale(d.y); },
                        "height": function (d) { return height - that.yScale(d.y); }
                    });

                that.bar.exit()
                    .remove();
                var t = d3.transform(d3.select(d3.selectAll(that.selector + ' .column-rect')[0][(that.data.length-1)]).attr("transform")),
                    x = t.translate[0],
                    y = t.translate[1];
                x_range = [(x + (that.xScale.rangeBand())),(that.reducedWidth - x - (that.xScale.rangeBand()))];
                that.xScale1 = that.k.scaleIdentification("linear",x_data,x_range);
                return this;
            },
            newXAxis : function () {
                if(PykCharts["boolean"](that.axis_x_enable)) {
                    if(that.axis_x_position === "bottom") {
                        that.new_xAxisgroup.attr("transform", "translate(0," + (that.chart_height - that.chart_margin_top - that.chart_margin_bottom) + ")");
                    }
                    var xaxis = d3.svg.axis()
                        .scale(that.xScale)
                        .orient(that.axis_x_pointer_position)
                        .tickSize(0)
                        .ticks(that.axis_x_no_of_axis_value)
                        .outerTickSize(that.axis_x_outer_pointer_length);
                    that.new_xAxisgroup.style("stroke",function () { return that.axis_x_line_color; })
                        .call(xaxis);
                    d3.selectAll(that.selector + " .x.new-axis text").style({
                        "display": function () { return "none"; },
                        "stroke": "none"
                    });
                }
                return this;
            },
        };
        return optional;
    };
};
PykCharts.multiD.groupedColumn = function(options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
        PykCharts.scaleFunction(that);
        PykCharts.grid(that);
        if(that.stop){
            return;
        }
        that.panels_enable = "no";
        that.k.storeInitialDivHeight();
        if(that.mode === "default") {
           that.k.loading();
        }
        that.multiD = new PykCharts.multiD.configuration(that);

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("column",data);
            that.compare_data = that.k.__proto__._groupBy("column",data);
            that.axis_y_data_format = "number";
            that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
            if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
                console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
            }

            that.k.remove_loading_bar(id);
            // PykCharts.multiD.columnFunctions(options,that,"group_column");
            that.render();
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };

    that.dataTransformation = function () {
        that.group_arr = [], that.new_data = [];
        that.data_length = that.data.length;
        for(var j = 0;j < that.data_length;j++) {
            that.group_arr[j] = that.data[j].x;
        }
        that.uniq_group_arr = that.k.__proto__._unique(that.group_arr);
        var len = that.uniq_group_arr.length;

        for (var k = 0;k < len;k++) {
            that.new_data[k] = {
                    name: that.uniq_group_arr[k],
                    data: []
            };
            for (var l = 0;l < that.data_length;l++) {
                if (that.uniq_group_arr[k] === that.data[l].x) {
                    that.new_data[k].data.push({
                        y: that.data[l].y,
                        name: that.data[l].group,
                        tooltip: that.data[l].tooltip,
                        color: that.data[l].color
                    });
                }
            }
        }
        that.new_data_length = that.new_data.length;
    };

    that.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("column",data);
            that.refresh_data = that.k.__proto__._groupBy("column",data);
            that.map_group_data = that.multiD.mapGroup(that.data);
            that.dataTransformation();
            that.optionalFeatures().mapColors();

            if(that.axis_x_data_format === "time") {
                    that.new_data.forEach(function (d) {
                        d.name = that.k.dateConversion(d.name);
                        // that.xdomain.push(d.x);
                    });
                    that.data.forEach(function (d) {
                        d.x =that.k.dateConversion(d.x);
                    });
            }
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }

            that.optionalFeatures()
                    .createChart()
                    .legends()
                    .highlightRect();

            that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
            .yGrid(that.svgContainer,that.group,that.yScale,that.legendsGroup_width);
            if(that.axis_y_data_format !== "string") {
                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height,"groupcolumn")
                that.optionalFeatures().newXAxis();
            } else {
                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
            }
        };
        if (PykCharts.boolean(that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    that.render = function() {
        var that = this,
            id = that.selector.substring(1,that.selector.length),
            container_id = id + "_svg";

        that.map_group_data = that.multiD.mapGroup(that.data);
        that.dataTransformation();
        that.optionalFeatures().mapColors();

        if(that.axis_x_data_format === "time") {
                that.new_data.forEach(function (d) {
                    d.name = that.k.dateConversion(d.name);
                    // that.xdomain.push(d.x);
                });
                that.data.forEach(function (d) {
                    d.x =that.k.dateConversion(d.x);
                });
        }


        that.border = new PykCharts.Configuration.border(that);
        that.transitions = new PykCharts.Configuration.transition(that);
        // that.mouseEvent1 = new PykCharts.multiD.mouseEvent(that);
        that.mouseEvent1 = new PykCharts.Configuration.mouseEvent(that);
        that.fillColor = new PykCharts.Configuration.fillChart(that,null,options);

        if(that.mode === "default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"groupColumnChart")
                .emptyDiv(that.selector)
                .subtitle()
                .makeMainDiv(that.selector,1);

            that.optionalFeatures()
                .svgContainer(container_id,1)
                .legendsContainer(1);

            that.k.liveData(that)
                .tooltip()
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .legends()
                .createGroups(1)
                .createChart()
                .axisContainer()
               .highlightRect();

            that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
            .yGrid(that.svgContainer,that.group,that.yScale,that.legendsGroup_width)
            .xAxisTitle(that.xGroup)
            .yAxisTitle(that.yGroup);
            if(that.axis_y_data_format !== "string") {
                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height,"groupcolumn")
                that.optionalFeatures().newXAxis();
            } else {
                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
            }

        } else if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"groupColumnChart")
                .emptyDiv(that.selector)
                .makeMainDiv(that.selector,1);

            that.optionalFeatures().svgContainer(container_id,1)
                .legendsContainer(1)
                .createGroups(1)
                .createChart()
                .axisContainer()
                .highlightRect();

            that.k.tooltip();
            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
            that.k
            .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
            .xAxisTitle(that.xGroup)
            .yAxisTitle(that.yGroup);
            if(that.axis_y_data_format !== "string") {
                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height,"groupcolumn")
                that.optionalFeatures().newXAxis();
            } else {
                that.k.xAxis(that.svgContainer,that.xGroup,that.xScale,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
            }
        }

        that.k.exportSVG(that,"#"+container_id,"groupColumnChart");
            var resize = that.k.resize(that.svgContainer);
            that.k.__proto__._ready(resize);
            window.addEventListener('resize', function(event){
                return that.k.resize(that.svgContainer);
            });
    };

    that.optionalFeatures = function() {
        var that = this;
        var id = that.selector.substring(1,that.selector.length);
        var optional = {
            svgContainer: function (container_id,i) {
                document.getElementById(id).className += " PykCharts-twoD";
                that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
                    .append("svg:svg")
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "id": container_id,
                        "class": "svgcontainer",
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
                    });
                return this;
            },
            createGroups: function (i) {
                that.group = that.svgContainer.append("g")
                    .attr({
                        "id": "groupedColumn-group",
                        "transform": "translate(" + that.chart_margin_left + "," + (that.chart_margin_top + that.legendsGroup_height) +")"
                    });
                if(PykCharts.boolean(that.chart_grid_y_enable)) {
                    that.group.append("g")
                        .attr({
                            "id": "ygrid",
                            "class": "y grid-line"
                        });
                }
                return this;
            },
            legendsContainer: function (i) {
                if(PykCharts.boolean(that.legends_enable) && that.mode === "default") {

                    that.legendsGroup = that.svgContainer.append("g")
                        .attr({
                            "id": "groupedColumn-legends",
                            "class": "legends",
                            "transform": "translate(0,10)"
                        })
                        .style("visibility","hidden");

                } else {
                    that.legendsGroup_height = 0;
                    that.legendsGroup_width = 0;
                }
                return this;
            },
            axisContainer : function () {
                if(PykCharts.boolean(that.axis_x_enable) || that.axis_x_title) {
                    that.xGroup = that.group.append("g")
                        .attr({
                            "class": "x axis",
                            "id": "xaxis"
                        })
                        .style("stroke","black");
                    that.new_xAxisgroup = that.group.append("g")
                        .attr({
                            "class": "x new-axis",
                            "id": "new-xaxis"
                        })
                        .style("stroke","blue");
                }

                if(PykCharts.boolean(that.axis_y_enable) || that.axis_y_title) {
                    that.yGroup = that.group.append("g")
                        .attr({
                            "class": "y axis",
                            "id": "yaxis"
                        })
                        .style("stroke","blue");
                }
                return this;
            },
            createChart: function() {

                that.reduced_width = that.chart_width - that.chart_margin_left - that.chart_margin_right - that.legendsGroup_width;

                that.reduced_height = that.chart_height - that.chart_margin_top - that.chart_margin_bottom - that.legendsGroup_height;

                that.getuniqueGroups = that.data.map(function (d) {
                    return d.group;
                })

                that.getuniqueGroups = that.k.__proto__._unique(that.getuniqueGroups)

                that.x_tick_values = that.k.processXAxisTickValues();
                that.y_tick_values = that.k.processYAxisTickValues();

                var x_domain,x_data = [],y_data,y_range,x_range,y_domain,min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;

                if(that.axis_y_data_format === "number") {
                    that.max_y_value = d3.max(that.new_data, function(d) { return d3.max(d.data, function(d) { return d.y; }); });

                    y_domain = [0,that.max_y_value];
                    y_data = that.k.__proto__._domainBandwidth(y_domain,1);
                    min_y_tick_value = d3.min(that.y_tick_values);
                    max_y_tick_value = d3.max(that.y_tick_values);

                    if(y_data[0] > min_y_tick_value) {
                        y_data[0] = min_y_tick_value;
                    }
                    if(y_data[1] < max_y_tick_value) {
                        y_data[1] = max_y_tick_value;
                    }
                    y_range = [that.reduced_height, 0];
                    that.yScale = that.k.scaleIdentification("linear",y_data,y_range);

                }

                if(that.axis_x_data_format === "number") {
                    max = d3.max(that.new_data, function(d) { return d.name });
                    min = d3.min(that.new_data, function(d) { return d.name });
                    x_domain = [min,max];
                    x_data = [min,max];

                    min_x_tick_value = d3.min(that.x_tick_values);
                    max_x_tick_value = d3.max(that.x_tick_values);

                    if(x_data[0] > min_x_tick_value) {
                        x_data[0] = min_x_tick_value;
                    }
                    if(x_data[1] < max_x_tick_value) {
                        x_data[1] = max_x_tick_value;
                    }
                    that.new_data.sort(function (a,b) {
                        return a.name - b.name;
                    })
                    x_range = [0 ,that.reduced_width];
                    that.xScale1 = that.k.scaleIdentification("linear",x_data,x_range);
                    x_data1 = that.new_data.map(function (d) { return d.name; });
                    x_range1 = [0 ,that.reduced_width];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data1,x_range1,0.2);
                    that.extra_left_margin = (that.xScale.rangeBand() / 2);
                    that.xdomain = that.xScale.domain();
                    that.x1 = d3.scale.ordinal()
                        .domain(that.getuniqueGroups)
                        .rangeRoundBands([0, that.xScale.rangeBand()]) ;


                } else if(that.axis_x_data_format === "string") {
                    x_data = that.new_data.map(function (d) { return d.name; });

                    x_range = [0 ,that.reduced_width];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data,x_range,0.2);
                    that.extra_left_margin = (that.xScale.rangeBand() / 2);
                    that.xdomain = that.xScale.domain();
                    that.x1 = d3.scale.ordinal()
                        .domain(that.getuniqueGroups)
                        .rangeRoundBands([0, that.xScale.rangeBand()]) ;


                } else if (that.axis_x_data_format === "time") {
                    max = d3.max(that.new_data,function(d) {
                        return d.name;
                    })

                    min = d3.min(that.new_data,function(d) {
                        return d.name;
                    })

                    x_domain = [min.getTime(),max.getTime()];
                    x_data = [min,max];
                    x_range = [0 ,that.reduced_width];


                    min_x_tick_value = d3.min(that.x_tick_values, function (d) {
                        d = that.k.dateConversion(d);
                        return d;
                    });

                    max_x_tick_value = d3.max(that.x_tick_values, function (d) {
                        d = that.k.dateConversion(d);
                        return d;
                    });

                    if((x_data[0]) > (min_x_tick_value)) {
                        x_data[0] = min_x_tick_value;
                    }
                    if((x_data[1]) < (max_x_tick_value)) {
                        x_data[1] = max_x_tick_value;
                    }

                    that.xScale = that.k.scaleIdentification("time",x_data,x_range);
                    that.new_data.sort(function (a,b) {
                        if (new Date(a.name) < new Date(b.name)) {
                            return -1 ;
                        }
                        else if (new Date(a.name) > new Date(b.name)) {
                            return 1;
                        }
                    });
                    x_data1 = that.new_data.map(function (d) { return d.name; });

                    x_range1 = [0 ,that.reduced_width];
                    that.xScale1 = that.k.scaleIdentification("ordinal",x_data1,x_range1,0.2);
                    x_data1 = that.new_data.map(function (d) { return d.name; });
                    x_range1 = [0 ,that.reduced_width];
                    that.xScale = that.k.scaleIdentification("ordinal",x_data1,x_range1,0.2);
                    that.extra_left_margin = (that.xScale.rangeBand() / 2);
                    that.xdomain = that.xScale.domain();
                    that.x1 = d3.scale.ordinal()
                        .domain(that.getuniqueGroups)
                        .rangeRoundBands([0, that.xScale.rangeBand()]) ;
                }
                that.xdomain = that.xScale.domain();
                that.ydomain = that.yScale.domain();
                that.highlight_y_positions =  [];

                var chart = that.group.selectAll(".groupedColumn-rect")
                    .data(that.new_data);

                chart.enter()
                    .append("g")
                    .attr("class", "groupedColumn-rect");

                chart.attr("transform", function (d) {
                        that.optionalFeatures().checkIfHighLightDataExists(d.name);
                        if(that.highlight_group_exits) {
                            that.flag = true;
                            that.highlight_x_positions = that.xScale(d.name);
                        }
                        return "translate(" + that.xScale(d.name) + ",0)";
                    })
                    .on({
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightGroupHide(that.selector+" "+".groupedColumn-rect","rect");
                                }
                                that.mouseEvent.axisHighlightHide(that.selector+" "+".x.axis")
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default") {
                                if(PykCharts.boolean(that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightGroup(that.selector+" "+".groupedColumn-rect", this, "rect");
                                }
                                that.mouseEvent.axisHighlightShow(d.name,that.selector+" "+".x.axis",that.xdomain);
                            }
                        }
                    });

                var bar = chart.selectAll("rect")
                            .data(function (d) { return d.data; });

                bar.enter()
                    .append("rect")

                bar.attr("height", 0)
                    .attr({
                        "x": function (d) {return that.x1(d.name); },
                        "y": that.reduced_height,
                        "width": function (d){ return 0.98*that.x1.rangeBand(); },
                        "fill": function (d,i) {
                            return that.fillColor.colorGroup(d);
                        },
                        "fill-opacity": function (d,i) {
                            if (that.color_mode === "saturation") {
                                return (i+1)/that.no_of_groups;
                            } else {
                                return 1;
                            }
                        },
                        "stroke": that.border.color(),
                        "srtoke-width": that.border.width(),
                        "stroke-dasharray": that.border.style(),
                        "data-fill-opacity": function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "data-id":function (d,i) {
                            return d.name;
                        }
                    })
                    .on({
                        'mouseover': function (d) {
                            if(that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
                                var tooltip = d.tooltip ? d.tooltip : d.y
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(tooltip);
                            }
                        },
                        'mouseout': function (d) {
                            if(that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
                                that.mouseEvent.tooltipHide(d);
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
                                that.mouseEvent.tooltipPosition(d);
                            }
                        },
                        'click': function (d,i) {
                            if(PykCharts['boolean'](that.click_enable)){
                               that.addEvents(d.name, d3.select(this).attr("data-id"));
                            }
                        }
                    })
                    .transition()
                    .duration(that.transitions.duration())
                    .attr({
                        "height": function (d) { return that.reduced_height - that.yScale(d.y); },
                        "y": function (d) {
                            if(that.flag) {
                                that.highlight_y_positions.push(that.yScale(d.y));
                            }
                            return that.yScale(d.y);
                        }
                    });

                chart.exit().remove();
                bar.exit().remove();
                var t = d3.transform(d3.select(d3.selectAll('.groupedColumn-rect')[0][(that.new_data.length-1)]).attr("transform")),
                    x = t.translate[0],
                    y = t.translate[1];
                x_range = [(that.reduced_height-x - (that.x1.rangeBand()*2)),(x + (that.x1.rangeBand()*2))];
                that.xScale1 = that.k.scaleIdentification("linear",x_data,x_range);

                return this;
            },
            mapColors : function () {
                that.no_of_groups = d3.max(that.new_data,function (d){
                    return d.data.length;
                });

                for(var i = 0;i<that.new_data_length;i++) {
                    if(that.new_data[i].data.length === that.no_of_groups) {
                        that.group_data = that.new_data[i].data;
                        that.group_data_length = that.group_data.length;
                        break;
                    }
                }

                that.new_data.forEach(function(d){
                    d.data.forEach(function(data){
                        for (var i=0 ; i<that.group_data_length ; i++) {
                            if (that.group_data[i].name === data.name) {
                                data.color = that.group_data[i].color;
                                break;
                            }
                        }
                    })
                });
            },
            legends: function () {
                if(PykCharts.boolean(that.legends_enable)) {
                    var params = that.group_data,color;
                    color = params.map(function (d) {
                        return d.color;
                    });
                    params = params.map(function (d) {
                        return d.name;
                    });
                    params = that.k.__proto__._unique(params);
                    that.multiD.legendsPosition(that,"groupColumn",params,color);
                }
                return this;
            },
            checkIfHighLightDataExists : function (name) {
                if(that.highlight) {
                    if(that.axis_x_data_format === "number") {
                        that.highlight_group_exits = (that.highlight === name);
                    } else if (that.axis_x_data_format === "string") {
                        that.highlight_group_exits = (that.highlight.toLowerCase() === name.toLowerCase());
                    }
                }
                return this;
            },
            newXAxis : function () {
                if(PykCharts["boolean"](that.axis_x_enable)) {
                    if(that.axis_x_position === "bottom") {
                        that.new_xAxisgroup.attr("transform", "translate(0," + (that.chart_height - that.chart_margin_top - that.chart_margin_bottom - that.legendsGroup_height) + ")");
                    }
                    var xaxis = d3.svg.axis()
                        .scale(that.xScale)
                        .orient(that.axis_x_pointer_position)
                        .tickSize(0)
                        .outerTickSize(that.axis_x_outer_pointer_length);
                    that.new_xAxisgroup.style("stroke",function () { return that.axis_x_line_color; })
                        .call(xaxis);
                    d3.selectAll(that.selector + " .x.new-axis text").style({
                        "display": function () { return "none"; },
                        "stroke": "none"
                    });
                }

                return this;
            },
            highlightRect : function () {
                if(that.flag) {

                    function setTimeoutHighlight() {
                        x = that.highlight_x_positions - 5;

                        var highlight_rect = that.group.selectAll(".highlight-groupedColumn-rect")
                            .data([that.highlight])

                        highlight_rect.enter()
                            .append("rect")

                        highlight_rect.attr({
                            "class": "highlight-groupedColumn-rect",
                            "x": x,
                            "y": 0,
                            "width": (that.x1.rangeBand()* that.group_data.length)+10,
                            "height": that.reduced_height+ 5,
                            "fill": "none",
                            "stroke": that.highlight_color,
                            "stroke-width": "1.5px",
                            "stroke-dasharray": "5,5",
                            "stroke-opacity": 1
                        });
                        highlight_rect.exit()
                            .remove();
                        if(PykCharts["boolean"](that.highlight_x_positions)) {
                            highlight_array = that.highlight;
                        } else {
                            highlight_rect.remove()
                        }
                    }
                    setTimeout(setTimeoutHighlight, that.transitions.duration());
                }
                return this;
            },
        }
        return optional;
    };
};

PykCharts.multiD.scatter = function (options) {
  var that = this;
  that.interval = "";
  var theme = new PykCharts.Configuration.Theme({});

  this.execute = function(pykquery_data) {
    that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
    that.bubbleRadius = options.scatterplot_radius ? options.scatterplot_radius : theme.multiDimensionalCharts.scatterplot_radius;
    that.panels_enable = "no";
    PykCharts.scaleFunction(that);

    try {
      if(!that.k.__proto__._isNumber(that.bubbleRadius)) {
        that.bubbleRadius = theme.multiDimensionalCharts.scatterplot_radius;
        throw "bubbleRadius";
      }
    }

    catch (err) {
      that.k.warningHandling(err,"1");
    }

    if(that.stop){
      return;
    }
    that.k.storeInitialDivHeight();
    if(that.mode === "default") {
      that.k.loading();
    }

    var multiDimensionalCharts = theme.multiDimensionalCharts,
    stylesheet = theme.stylesheet;

    that.multiD = new PykCharts.multiD.configuration(that);
    that.scatterplot_pointer_enable =  options.scatterplot_pointer_enable ? options.scatterplot_pointer_enable.toLowerCase() : multiDimensionalCharts.scatterplot_pointer_enable;
    that.zoomed_out = true;

    if(PykCharts['boolean'](that.panels_enable)) {
      that.radius_range = [that.k.__proto__._radiusCalculation(1.1)*2,that.k.__proto__._radiusCalculation(2.6)*2];
    } else {
      that.radius_range = [that.k.__proto__._radiusCalculation(4.5)*2,that.k.__proto__._radiusCalculation(11)*2];
    }

    that.executeData = function (data) {
      var validate = that.k.validator().validatingJSON(data),
      id = that.selector.substring(1,that.selector.length);
      if(that.stop || validate === false) {
        that.k.remove_loading_bar(id);
        return;
      }

      that.data = that.k.__proto__._groupBy("scatterplot",data);
      that.axis_y_data_format = that.k.yAxisDataFormatIdentification(that.data);
      that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
      if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
        console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
      }
      if(that.axis_y_data_format === "time" && that.axis_y_time_value_datatype === "") {
        console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
      }
      that.compare_data = that.k.__proto__._groupBy("scatterplot",data);
      that.k.remove_loading_bar(id);
      var a = new PykCharts.multiD.scatterplotFunctions(options,that,"scatterplot");
      a.render();
    };
    if (PykCharts['boolean'](that.interactive_enable)) {
        that.k.dataFromPykQuery(pykquery_data);
        that.k.dataSourceFormatIdentification(that.data,that,"executeData");
    } else {
        that.k.dataSourceFormatIdentification(options.data,that,"executeData");
    }

  };
};
PykCharts.multiD.panelsOfScatter = function (options) {
  var that = this;
  that.interval = "";
  var theme = new PykCharts.Configuration.Theme({});

  this.execute = function(pykquery_data) {
    that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
    PykCharts.scaleFunction(that);
    that.bubbleRadius = options.scatterplot_radius ? options.scatterplot_radius : theme.multiDimensionalCharts.scatterplot_radius;
    that.panels_enable = "yes";
    that.legends_display = "horizontal";
    try {
      if(!that.k.__proto__._isNumber(that.bubbleRadius)) {
        that.bubbleRadius = theme.multiDimensionalCharts.scatterplot_radius;
        throw "bubbleRadius"
      }
    }

    catch (err) {
      that.k.warningHandling(err,"1");
    }

    if(that.stop){
      return;
    }
    that.k.storeInitialDivHeight();
    if(that.mode === "default") {
      that.k.loading();
    }

    var multiDimensionalCharts = theme.multiDimensionalCharts,
    stylesheet = theme.stylesheet;

    that.multiD = new PykCharts.multiD.configuration(that);
    that.scatterplot_pointer_enable =  options.scatterplot_pointer_enable ? options.scatterplot_pointer_enable.toLowerCase() : multiDimensionalCharts.scatterplot_pointer_enable;
    that.zoomed_out = true;

    if(PykCharts['boolean'](that.panels_enable)) {
      that.radius_range = [that.k.__proto__._radiusCalculation(3.5)*2,that.k.__proto__._radiusCalculation(8)*2];
    } else {
      that.radius_range = [that.k.__proto__._radiusCalculation(4.5)*2,that.k.__proto__._radiusCalculation(11)*2];
    }

    that.executeData = function (data) {
      var validate = that.k.validator().validatingJSON(data),
      id = that.selector.substring(1,that.selector.length);
      if(that.stop || validate === false) {
        that.k.remove_loading_bar(id);
        return;
      }

      that.data = that.k.__proto__._groupBy("scatterplot",data);
      that.axis_y_data_format = that.k.yAxisDataFormatIdentification(that.data);
      that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
      if(that.axis_x_data_format === "time" && that.axis_x_time_value_datatype === "") {
        console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
      }
      if(that.axis_y_data_format === "time" && that.axis_y_time_value_datatype === "") {
        console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed Date data so please pass the value for axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
      }
      that.compare_data = that.k.__proto__._groupBy("scatterplot",data);
      that.k.remove_loading_bar(id);
      var a = new PykCharts.multiD.scatterplotFunctions(options,that,"scatterplot");
      a.render();
    };
    if (PykCharts['boolean'](that.interactive_enable)) {
        that.k.dataFromPykQuery(pykquery_data);
        that.k.dataSourceFormatIdentification(that.data,that,"executeData");
    } else {
        that.k.dataSourceFormatIdentification(options.data,that,"executeData");
    }
  };
};
PykCharts.multiD.pulse = function (options) {
  var that = this;
  that.interval = "";
  var theme = new PykCharts.Configuration.Theme({});

  this.execute = function(pykquery_data) {
    that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');
    PykCharts.scaleFunction(that);
    var multiDimensionalCharts = theme.multiDimensionalCharts,
    stylesheet = theme.stylesheet;

    that.multiD = new PykCharts.multiD.configuration(that);
    that.bubbleRadius = options.scatterplot_radius ? options.scatterplot_radius : (0.6 * multiDimensionalCharts.scatterplot_radius);
    that.panels_enable = "no";

    try {
      if(!that.k.__proto__._isNumber(that.bubbleRadius)) {
        that.bubbleRadius = (0.6 * multiDimensionalCharts.scatterplot_radius);
        throw "bubbleRadius"
      }
    }

    catch (err) {
      that.k.warningHandling(err,"1");
    }

    if(that.stop) {
      return;
    }
    that.k.storeInitialDivHeight();
    that.zoomed_out = true;
    that.radius_range = [that.k.__proto__._radiusCalculation(1.1)*2,that.k.__proto__._radiusCalculation(3.5)*2];

    if(that.mode === "default") {
      that.k.loading();
    }

    that.executeData = function (data) {
      var validate = that.k.validator().validatingJSON(data),
      id = that.selector.substring(1,that.selector.length);
      if(that.stop || validate === false) {
        that.k.remove_loading_bar(id);
        return;
      }
      that.data = that.k.__proto__._groupBy("pulse",data);
      that.axis_y_data_format = that.k.yAxisDataFormatIdentification(that.data);
      that.axis_x_data_format = that.k.xAxisDataFormatIdentification(that.data);
      if(that.axis_x_data_format === "date" && that.axis_x_time_value_datatype === "") {
        console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to pass Date data so please pass axis_x_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
      }
      if(that.axis_y_data_format === "date" && that.axis_y_time_value_datatype === "") {
        console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to pass Date data so please pass axis_y_time_value_datatype"+"\")  Visit www.pykcharts.com/errors#warning_15");
      }
      that.compare_data = that.k.__proto__._groupBy("pulse",data);
      that.k.remove_loading_bar(id);
      var a = new PykCharts.multiD.scatterplotFunctions(options,that,"pulse");
      a.render();
    };
    if (PykCharts['boolean'](that.interactive_enable)) {
        that.k.dataFromPykQuery(pykquery_data);
        that.k.dataSourceFormatIdentification(that.data,that,"executeData");
    } else {
        that.k.dataSourceFormatIdentification(options.data,that,"executeData");
    }
  };
};
PykCharts.multiD.scatterplotFunctions = function (options,chartObject,type) {
  var that = chartObject;
  that.refresh = function (pykquery_data) {
    that.executeRefresh = function (data) {
      that.data = that.k.__proto__._groupBy("scatterplot",data);
      that.refresh_data = that.k.__proto__._groupBy("scatterplot",data);
      var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
      that.compare_data = compare[0];
      var data_changed = compare[1];

      that.uniq_group_arr = that.k.__proto__._unique(that.data.map(function (d) {
        return d.group;
      }));

      if(compare[1]) {
        that.k.lastUpdatedAt("liveData");
      }
      that.map_group_data = that.multiD.mapGroup(that.data);
      if(that.axis_x_data_format === "time") {
        that.data.forEach(function (d) {
          d.x = that.k.dateConversion(d.x);
        });
      }
      if(!PykCharts['boolean'](that.panels_enable)) {
        that.new_data = that.data;
        that.optionalFeatures()
        .createChart()
        .legends()
        .plotCircle()
        .ticks();
        if(type === "scatterplot") {
          that.optionalFeatures().label(0)
            .labelPosition();
        }
      } else if(PykCharts['boolean'](that.panels_enable) && type === "scatterplot") {
        document.querySelector(that.selector + " #panels_of_scatter_main_div").innerHTML = null;
        that.renderChart();
      }
      that.k.xAxis(that.svgContainer,that.xGroup,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
      .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
    };
    if (PykCharts['boolean'](that.interactive_enable)) {
        that.k.dataFromPykQuery(pykquery_data);
        that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
    } else {
        that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
    }
  };

  that.calculatePanelInRow = function () {
      var width= parseInt(that.k._getHighestParentsAttribute(that.selector,"width")),total_width;
      if(width) {
          total_width = width;
      } else {
          total_width = d3.select("body").style("width");
      }

      that.no_of_containers_in_row = Math.floor(parseInt(total_width)/that.chart_width);

      if(that.no_of_containers_in_row > that.uniq_group_arr.length) {
          that.no_of_containers_in_row = that.uniq_group_arr.length;
      }

      if(total_width < that.chart_width) {
          that.no_of_containers_in_row = 1;
      }
  }

  this.render = function () {
    var id = that.selector.substring(1,that.selector.length);
    that.container_id = id + "_svg";
    that.map_group_data = that.multiD.mapGroup(that.data);
    that.fillChart = new PykCharts.Configuration.fillChart(that);
    that.transitions = new PykCharts.Configuration.transition(that);

    that.border = new PykCharts.Configuration.border(that);
    that.uniq_group_arr = that.k.__proto__._unique(that.data.map(function (d) {
      return d.group;
    }));


    that.no_of_groups = 1;

    if(PykCharts["boolean"](that.panels_enable)) {
      that.calculatePanelInRow();
    }

    if(that.axis_x_data_format === "time") {
      that.data.forEach(function (d) {
        d.x = that.k.dateConversion(d.x);
      });
    }
    if(that.mode === "default") {
      if(PykCharts['boolean'](that.panels_enable) && type === "scatterplot") {
        that.w = that.chart_width;
        that.chart_height = that.chart_height;
        that.chart_margin_left = that.chart_margin_left;
        that.chart_margin_right = that.chart_margin_right;

        that.k.title(that.new_width)
        .backgroundColor(that)
        .export(that,that.container_id,type,that.panels_enable,that.uniq_group_arr,that.new_width)
        .emptyDiv(that.selector)
        .subtitle(that.new_width);

        d3.select(that.selector).append("div")
        .attr("id","panels_of_scatter_main_div");
        that.renderChart();
        that.k.xAxis(that.svgContainer,that.xGroup,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
        .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
        .xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
        .yAxisTitle(that.yGroup);

      } else {
        that.k.title()
        .backgroundColor(that)
        .export(that,"#"+that.container_id+"0",type)
        .emptyDiv(that.selector)
        .subtitle();

        that.w = that.chart_width;
        that.chart_height = that.chart_height;
        that.new_data = that.data;
        that.k.makeMainDiv(that.selector,0);

        that.optionalFeatures()
        .svgContainer(0)
        .legendsContainer(0);

        that.k.liveData(that)
        .tooltip();

        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        that.sizes = new PykCharts.multiD.bubbleSizeCalculation(that,that.data,that.radius_range);

        that.optionalFeatures()
        .legends()
        .createGroups(0)
        .createChart()
        .ticks();

        if(type === "scatterplot") {
          that.optionalFeatures().label(0)
            .labelPosition();
        }
        that.k.xAxis(that.svgContainer,that.xGroup,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
        .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
        .xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
        .yAxisTitle(that.yGroup);
        that.k.exportSVG(that,"#"+that.container_id+"0",type)
      }

      that.k.createFooter(that.new_width)
      .lastUpdatedAt()
      .credits()
      .dataSource();

    } else if (that.mode === "infographics") {
      if(PykCharts['boolean'](that.panels_enable) && type === "scatterplot") {
        that.k.backgroundColor(that)
          .export(that,that.container_id,type,that.panels_enable,that.uniq_group_arr,that.new_width)
          .emptyDiv(that.selector);

        that.no_of_groups = that.uniq_group_arr.length;
        that.data_length = that.data.length;
        that.w = that.chart_width;
        that.chart_height = that.chart_height;
        that.chart_margin_left = that.chart_margin_left;
        that.chart_margin_right = that.chart_margin_right;

        for(var i=0;i<that.no_of_groups;i++){
          that.new_data = [];
          for(var j=0;j<that.data_length;j++) {
            if(that.data[j].group === that.uniq_group_arr[i]) {
              that.new_data.push(that.data[j]);
            }
          }
          that.k.makeMainDiv(that.selector,i);

          that.optionalFeatures()
          .svgContainer(i)
          .legendsContainer(i);

          that.k.tooltip();

          that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
          that.sizes = new PykCharts.multiD.bubbleSizeCalculation(that,that.data,that.radius_range);
          that.optionalFeatures()
          .legends(i)
          .createGroups(i)
          .createChart()
          .label(i)
          .ticks();

          that.k.xAxis(that.svgContainer,that.xGroup,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
          .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
          .xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
          .yAxisTitle(that.yGroup);

          // if((i+1)%4 === 0 && i !== 0) {
          //   that.k.emptyDiv(that.selector);
          // }
        }
        that.optionalFeatures().labelPosition();
        that.k.exportSVG(that,that.container_id,type,that.panels_enable,that.uniq_group_arr)
        that.k.emptyDiv(that.selector);
      } else {

        that.k.backgroundColor(that)
        .export(that,"#"+that.container_id+"0",type)
        .emptyDiv(that.selector);

        that.w = that.chart_width;
        that.new_data = that.data;
        that.k.makeMainDiv(that.selector,0);

        that.optionalFeatures()
        .svgContainer(0)
        .legendsContainer(0);

        that.k.liveData(that)
        .tooltip();

        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        that.sizes = new PykCharts.multiD.bubbleSizeCalculation(that,that.data,that.radius_range);

        that.optionalFeatures()
        .legends()
        .createGroups(0)
        .createChart()
        .ticks();

        if(type === "scatterplot") {
          that.optionalFeatures().label(0)
            .labelPosition()
        }

        that.k.xAxis(that.svgContainer,that.xGroup,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
        .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
        .xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
        .yAxisTitle(that.yGroup);

        that.k.exportSVG(that,"#"+that.container_id+"0",type);
      }
    }

    if(!PykCharts['boolean'](that.panels_enable)) {
      var resize = that.k.resize(that.svgContainer);
      that.k.__proto__._ready(resize);
      window.addEventListener('resize', function(event){
        return that.k.resize(that.svgContainer);
      });
    } else {
      var resize = that.k.resize(undefined,that.new_width);
      that.k.__proto__._ready(resize);
      window.addEventListener('resize', function(event){
        that.calculatePanelInRow();
        return that.k.resize(undefined,that.new_width);
      });
    }
  };

  that.optionalFeatures = function () {
    var id = that.selector.substring(1,that.selector.length);
    var optional = {
      svgContainer :function (i) {
        document.querySelector(that.selector + " #chart-container-" + i).style.width = that.w;
        var element = document.getElementById(id);
        if(!element.classList.contains('PykCharts-weighted')) {
          element.className += " PykCharts-weighted";
        }
        that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
        .append('svg')
        .attr({
          "width": that.w,
          "height": that.chart_height,
          "preserveAspectRatio": "xMinYMin",
          "viewBox": "0 0 " + that.w + " " + that.chart_height,
          "id": that.container_id+ "" + i,
          "class": "svgcontainer"
        });

        return this;
      },
      createGroups : function (i) {
        that.group = that.svgContainer.append("g")
        .attr({
          "transform": "translate("+(that.chart_margin_left)+","+(that.chart_margin_top+that.legendsGroup_height)+")",
          "id": "main"
        });

        that.ticksElement = that.svgContainer.append("g")
        .attr({
          "transform": "translate("+(that.chart_margin_left)+","+(that.chart_margin_top + that.legendsGroup_height)+")",
          "id": "main2"
        });

        if(PykCharts['boolean'](that.axis_x_enable) || that.axis_x_title) {
          that.xGroup = that.group.append("g")
          .attr({
            "class": "x axis",
            "id": "xaxis"
          })
          .style("stroke","black");
        }

        if(PykCharts['boolean'](that.axis_y_enable) || that.axis_y_title){
          that.yGroup = that.group.append("g")
          .attr({
            "class": "y axis",
            "id": "yaxis"
          })
          .style("stroke","blue");
        }

        that.clip = that.group.append("svg:clipPath")
        .attr("id", "clip" + i + that.selector)
        .append("svg:rect")
        .attr({
          "width": (that.w-that.chart_margin_left-that.chart_margin_right-that.legendsGroup_width),
          "height": that.chart_height-that.chart_margin_top-that.chart_margin_bottom - that.legendsGroup_height
        });

        that.chartBody = that.group.append("g")
        .attr({
          "id": "clip"+i,
          "clip-path": "url(#clip" + i + that.selector +")"
        });

        return this;
      },
      legendsContainer : function (i) {

        if (PykCharts['boolean'](that.legends_enable) && that.map_group_data[1] && that.mode === "default") {
          that.legendsGroup = that.svgContainer.append("g")
          .attr('id',"scatterplot-legends")
          .style("visibility","visible");
        } else {
          that.legendsGroup_width = 0;
          that.legendsGroup_height = 0;
        }

        return this;
      },
      createChart : function (index) {
        if (type == "scatterplot") {
          that.new_data.sort(function (a,b) {
            return (b.weight - a.weight);
          });
          that.weight = that.new_data.map(function (d) {
            return d.weight;
          });
          var weight_length = that.weight.length,
          rejected_result = [];
          for(var i=0 ; i<weight_length ; i++) {
            if(that.weight[i] !== 0) {
              rejected_result.push(that.weight[i]);
            }
          }
          that.weight = rejected_result;
          that.sorted_weight = that.weight.slice(0).reverse();

        } else {
          that.weight = that.new_data.map(function (d) {
            return d.weight;
          });
          var weight_length = that.weight.length,
          rejected_result = [];
          for(var i=0 ; i<weight_length ; i++) {
            if(that.weight[i] !== 0) {
              rejected_result.push(that.weight[i]);
            }
          }
          that.weight = rejected_result;
          that.sorted_weight = that.weight.slice(0);

        }
        that.sorted_weight.sort(function(a,b) { return a-b; });

        that.x_tick_values = that.k.processXAxisTickValues();
        that.y_tick_values = that.k.processYAxisTickValues();

        that.group.append("text")
        .attr({
          "fill": "black",
          "text-anchor": "end",
          "x": that.w - 70,
          "y": that.chart_height + 40
        });

        if(that.zoomed_out === true) {

          var x_domain,x_data = [],y_data = [],y_range,x_range,y_domain, min_x_tick_value,max_x_tick_value, min_y_tick_value,max_y_tick_value;

          if(that.axis_y_data_format === "number") {
            y_domain = d3.extent(that.data, function(d) { return parseFloat(d.y) });
            y_data = that.k.__proto__._domainBandwidth(y_domain,2,"number");
            y_range = [that.chart_height - that.chart_margin_top - that.chart_margin_bottom - that.legendsGroup_height, 0];

            min_y_tick_value = d3.min(that.y_tick_values);
            max_y_tick_value = d3.max(that.y_tick_values);

            if(y_data[0] > min_y_tick_value) {
              y_data[0] = min_y_tick_value;
            }
            if(y_data[1] < max_y_tick_value) {
              y_data[1] = max_y_tick_value;
            }

            that.yScale = that.k.scaleIdentification("linear",y_data,y_range);
            that.extra_top_margin = 0;

          } else if(that.axis_y_data_format === "string") {
            that.data.forEach(function(d) { y_data.push(d.y); });
            y_range = [0,that.chart_height - that.chart_margin_top - that.chart_margin_bottom - that.legendsGroup_height];
            that.yScale = that.k.scaleIdentification("ordinal",y_data,y_range,0);
            that.extra_top_margin = (that.yScale.rangeBand() / 2);
          } else if (that.axis_y_data_format === "time") {
            y_data = d3.extent(that.data, function (d) { return new Date(d.x); });

            min_y_tick_value = d3.min(that.y_tick_values, function (d) {
              return new Date(d);
            });

            max_y_tick_value = d3.max(that.y_tick_values, function (d) {
              return new Date(d);
            });

            if(new Date(y_data[0]) > new Date(min_y_tick_value)) {
              y_data[0] = min_y_tick_value;
            }
            if(new Date(y_data[1]) < new Date(max_y_tick_value)) {
              y_data[1] = max__tick_value;
            }

            y_range = [that.chart_height - that.chart_margin_top - that.chart_margin_bottom - that.legendsGroup_height, 0];
            that.yScale = that.k.scaleIdentification("time",y_data,y_range);
            that.extra_top_margin = 0;
          }
          if(that.axis_x_data_format === "number") {
            x_domain = d3.extent(that.data, function(d) { return parseFloat(d.x); });
            x_data = that.k.__proto__._domainBandwidth(x_domain,2);

            min_x_tick_value = d3.min(that.x_tick_values);
            max_x_tick_value = d3.max(that.x_tick_values);

            if(x_data[0] > min_x_tick_value) {
              x_data[0] = min_x_tick_value;
            }
            if(x_data[1] < max_x_tick_value) {
              x_data[1] = max_x_tick_value;
            }

            x_range = [0 ,that.w - that.chart_margin_left - that.chart_margin_right - that.legendsGroup_width];
            that.x = that.k.scaleIdentification("linear",x_data,x_range);
            that.extra_left_margin = 0;

          } else if(that.axis_x_data_format === "string") {
            that.data.forEach(function(d) { x_data.push(d.x); });
            x_range = [0 ,that.w - that.chart_margin_left - that.chart_margin_right - that.legendsGroup_width];
            that.x = that.k.scaleIdentification("ordinal",x_data,x_range,0);
            that.extra_left_margin = (that.x.rangeBand()/2);

          } else if (that.axis_x_data_format === "time") {

            max = d3.max(that.data, function(k) { return k.x; });
            min = d3.min(that.data, function(k) { return k.x; });
            x_domain = [min.getTime(),max.getTime()];
            x_data = that.k.__proto__._domainBandwidth(x_domain,2,"time");

            min_x_tick_value = d3.min(that.x_tick_values, function (d) {
              return that.k.dateConversion(d);
            });

            max_x_tick_value = d3.max(that.x_tick_values, function (d) {
              return that.k.dateConversion(d);
            });

            if(x_data[0] > min_x_tick_value) {
              x_data[0] = min_x_tick_value;
            }
            if(x_data[1] < max_x_tick_value) {
              x_data[1] = max_x_tick_value;
            }

            x_range = [0 ,that.w - that.chart_margin_left - that.chart_margin_right];
            that.x = that.k.scaleIdentification("time",x_data,x_range);

            that.extra_left_margin = 0;
          }

          that.xdomain = that.x.domain();
          that.ydomain = that.yScale.domain();
          that.x1 = 1;
          that.y1 = 12;
          that.count = 1;
          if(type!== "pulse") {
            var zoom = d3.behavior.zoom()
            .scale(that.count)
            .x(that.x)
            .y(that.yScale)
            .on("zoom",zoomed);
          }


          if(PykCharts['boolean'](that.zoom_enable) && !(that.axis_y_data_format==="string" || that.axis_x_data_format==="string") && (that.mode === "default") ) {
            var n;
            if(PykCharts['boolean'](that.panels_enable)) {
              n = that.no_of_groups;
            } else {
              n = 1;
            }

            for(var i = 0; i < that.no_of_groups; i++) {
              d3.select(that.selector+ " #"+that.container_id+""+i)
              .call(zoom)

              d3.select(that.selector+ " #"+that.container_id+""+i)
              .on({
                "wheel.zoom": null,
                "mousewheel.zoom": null
              });
            }
          }
          that.optionalFeatures().plotCircle(index);
        }
        return this ;
      },
      legends : function (index) {
        if (PykCharts['boolean'](that.legends_enable) && that.map_group_data[1] && that.mode==="default") {
          that.multiD.legendsPosition(that,"scatter",that.map_group_data[0],undefined,index);
        }
        return this;
      },
      ticks : function () {
        if(PykCharts['boolean'](that.scatterplot_pointer_enable)) {
          var tick_label = that.ticksElement.selectAll(".ticks_label")
          .data(that.new_data);

          tick_label.enter()
          .append("text")

          tick_label.attr({
            "class": "ticks_label",
            "x": function (d) {
              return that.x(d.x);
            },
            "y": function (d) {
              return that.yScale(d.y) ;
            },
            "pointer-events": "none",
            "dx": -1,
            "dy": function (d) { return -that.sizes(d.weight)-4; }
          })
          .style({
            "text-anchor": "middle",
            "font-family": that.label_family,
            "font-size": that.label_size + "px"
          })
          .text("");
          function setTimeoutTicks() {
            tick_label.text(function (d) {return d.name; });
          }
          setTimeout(setTimeoutTicks,that.transitions.duration());

          tick_label.exit().remove();
        }
        return this;
      },
      plotCircle : function () {
        that.circlePlot = that.chartBody.selectAll(".scatterplot-dot")
        .data(that.new_data)

        that.circlePlot.enter()
        .append("circle")
        .attr("class", "scatterplot-dot");

        that.circlePlot
        .attr({
          "r": 0,
          "cx": function (d) { return (that.x(d.x)+that.extra_left_margin); },
          "cy": function (d) { return (that.yScale(d.y)+that.extra_top_margin); },
          "fill": function (d) { return that.fillChart.colorPieW(d); },
          "fill-opacity": function (d) { return ((type == "pulse" && PykCharts['boolean'](that.variable_circle_size_enable)) ? 1 : that.multiD.opacity(d.weight,that.weight,that.data)); },
          "data-fill-opacity": function (d) {
            return d3.select(this).attr("fill-opacity");
          },
          "data-id":function(d){
            return d.x;
          },
          "stroke": that.border.color(),
          "stroke-width": that.border.width(),
          "stroke-dasharray": that.border.style(),
          "stroke-opacity": 1
        })
        .on({
          'mouseover': function (d,i) {
            if(that.mode === "default") {
              if (PykCharts['boolean'](that.tooltip_enable)) {
                tooltipText = d.tooltip ? d.tooltip : "<table><thead><th colspan='2'><b>"+d.name+"</b></th></thead><tr><td>X</td><td><b>"+d.x+"</b></td></tr><tr><td>Y</td><td><b>"+d.y+"<b></td></tr><tr><td>Weight</td><td><b>"+d.weight+"</b></td></tr></table>";
                that.mouseEvent.tooltipPosition(d);
                that.mouseEvent.tooltipTextShow(tooltipText);
              }
              if (PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                if (PykCharts['boolean'](that.panels_enable)) {
                  that.mouseEvent.highlight(that.selector + " #" + this.parentElement.parentElement.parentElement.parentElement.id + " .scatterplot-dot", this);
                }
                else {
                  that.mouseEvent.highlight(that.selector + " .scatterplot-dot", this);
                }
              }
            }
          },
          'mouseout': function (d,i) {
            if (that.mode === "default") {
              if (PykCharts['boolean'](that.tooltip_enable)) {
                that.mouseEvent.tooltipHide(d);
              }
              if (PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                if (PykCharts['boolean'](that.panels_enable)) {
                  that.mouseEvent.highlightHide(that.selector + " #" + this.parentElement.parentElement.parentElement.parentElement.id + " .scatterplot-dot");
                }
                else {
                  that.mouseEvent.highlightHide(that.selector + " .scatterplot-dot");
                }
              }
            }
          },
          'mousemove': function (d) {
            if (that.mode === "default" && PykCharts['boolean'](that.tooltip_enable)) {
              that.mouseEvent.tooltipPosition(d);
            }
          },
          "dblclick": function() {
            PykCharts.getEvent().stopPropagation();
          },
          "mousedown": function() {
            PykCharts.getEvent().stopPropagation();
          },
          'click': function (d,i) {
              if(PykCharts['boolean'](that.click_enable)){
                 that.addEvents(d.x, d3.select(this).attr("data-id"));
              }
          }
        })
        .transition()
        .duration(that.transitions.duration())
        .attr("r", function (d) { return that.sizes(d.weight); });

        that.circlePlot.exit().remove();
        return this;
      },
      label : function (i) {
        if(PykCharts['boolean'](that.label_size)) {
          var id = that.selector.substring(1,that.selector.length);
          that.circleLabel = that.chartBody.selectAll(".scatterplot-label")
          .data(that.new_data);

          that.circleLabel.enter()
          .append("text")

          that.circleLabel.attr("class","scatterplot-label")
            .attr("id", id + "-bubble-label-" + i)
            .text("");

          that.circleLabel.exit()
          .remove();
        }
        return this;
      },
      labelPosition : function () {
        function setTimeOut() {
          for(var i=0; i<that.no_of_groups;i++) {
            d3.selectAll(that.selector + "-bubble-label-"+i).attr({
              "x": function (d) { return (that.x(d.x)+that.extra_left_margin); },
              "y": function (d) { return (that.yScale(d.y)+that.extra_top_margin + 5); },
              "text-anchor": "middle",
              "pointer-events": "none",
              "fill": that.label_color
            })
            .style({
              "font-weight": that.label_weight,
              "font-size": that.label_size + "px",
              "font-family": that.label_family
            })
            .text(function (d) {
              return d.weight;
            })
            .text(function (d) {
              if((this.getBBox().width < (that.sizes(d.weight) * 2)) && (this.getBBox().height < (that.sizes(d.weight) * 2))) {
                return d.weight;
              } else {
                return "";
              }
            });
          }
        }
        setTimeout(setTimeOut,that.transitions.duration());
        return this;
      }
    };
    return optional;
  };

  function zoomed () {
    that.zoomed_out = false;

    var radius;

    var n = (PykCharts['boolean'](that.panels_enable)) ? that.no_of_groups : 1;
    for(var i = 0; i < n; i++) {
      var current_container = d3.select(that.selector+" #"+that.container_id+""+ i);
      that.k.isOrdinal(current_container,".x.axis",that.x);
      that.k.isOrdinal(current_container,".y.axis",that.yScale);

      that.optionalFeatures().plotCircle()
      .label()
      .ticks();
      d3.select(that.selector+" #"+that.container_id+""+ i)
      .selectAll(".scatterplot-dot")
      .attr({
        "r": function (d) {
          radius = that.sizes(d.weight)*PykCharts.getEvent().scale;
          return radius;
        },
        "cx": function (d) { return (that.x(d.x)+that.extra_left_margin); },
        "cy": function (d) { return (that.yScale(d.y)+that.extra_top_margin); }
      });

      d3.select(that.selector+" #"+that.container_id+""+ i)
      .selectAll(".scatterplot-label")
      .attr({
        "x": function (d) { return (that.x(d.x)+that.extra_left_margin); },
        "y": function (d) { return (that.yScale(d.y)+that.extra_top_margin + 5); }
      })
      .style("font-size", that.label_size +"px");
      d3.select(that.selector+" #"+that.container_id+""+ i)
      .selectAll(".tick_label")
      .attr({
        "x": function (d) {
          return that.x(d.x);
        },
        "y": function (d) {
          return that.yScale(d.y) - radius;
        }
      });
    }
    if(PykCharts.getEvent().sourceEvent.type === "dblclick") {
      that.count++;
    }
    if(that.count === that.zoom_level+1) {
      for(var i = 0; i < n; i++) {
        if(that.panels_enable==="yes"){
          that.new_data = [];
          for(var j=0;j<that.data_length;j++) {
            if(that.data[j].group === that.uniq_group_arr[i]) {
              that.new_data.push(that.data[j]);
            }
          }
        } else {
          that.new_data = that.data;
        }
        d3.select(that.selector+" #"+that.container_id+""+ i)
        .call(function () {
          return that.zoomOut(i);
        });
        that.count = 1;
      }
    }
  };

  that.zoomOut=function (i) {
    that.zoomed_out = true;
    that.x1 = 1;
    that.y1 = 12;

    that.optionalFeatures().createChart(i)
    .label()
    .ticks();
    var currentSvg = d3.select(that.selector + " #"+that.container_id+""+ i),
    current_x_axis = currentSvg.select("#xaxis"),
    current_y_axis = currentSvg.select("#yaxis");
    that.k.xAxis(currentSvg,current_x_axis,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
    .yAxis(currentSvg,current_y_axis,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width);

    d3.select(that.selector+" #"+that.container_id+""+i)
    .selectAll(".scatterplot-dot")
    .attr({
      "r": function (d) {
        return that.sizes(d.weight);
      },
      "cx": function (d) { return (that.x(d.x)+that.extra_left_margin); },
      "cy": function (d) { return (that.yScale(d.y)+that.extra_top_margin); }
    });

    d3.select(that.selector+" #"+that.container_id+""+ i)
    .selectAll(".scatterplot-label")
    .style("font-size", that.label_size + "px")
    .attr({
      "x": function (d) { return (that.x(d.x)+that.extra_left_margin); },
      "y": function (d) { return (that.yScale(d.y)+that.extra_top_margin + 5); }
    });
  }

  that.renderChart =  function () {
    that.no_of_groups = that.uniq_group_arr.length;
    that.data_length = that.data.length;
    for(var i=0;i<that.no_of_groups;i++){
      that.new_data = [];
      for(var j=0;j<that.data_length;j++) {
        if(that.data[j].group === that.uniq_group_arr[i]) {
          that.new_data.push(that.data[j]);
        }
      }
      that.k.makeMainDiv((that.selector + " #panels_of_scatter_main_div"),i);
      that.optionalFeatures()
      .svgContainer(i)
      .legendsContainer(i);
      // console.log(d3.selectAll("#tooltip-svg-container-" + i + "-pyk-tooltip"+that.selector),);
      var selector = that.selector.substr(1,that.selector.length);
      d3.selectAll("#tooltip-svg-container-" + i + "-pyk-tooltip"+selector)
        .remove();
      that.k.liveData(that)
      .tooltip(true,that.selector,i);

      that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
      that.sizes = new PykCharts.multiD.bubbleSizeCalculation(that,that.data,that.radius_range);
      that.optionalFeatures()
      .legends(i)
      .createGroups(i)
      .createChart()
      .label(i)
      .ticks();

      // if((i+1)%4 === 0 && i !== 0) {
      //   that.k.emptyDiv("#panels_of_scatter_main_div");
      // }
      that.k.xAxis(that.svgContainer,that.xGroup,that.x,that.extra_left_margin,that.xdomain,that.x_tick_values,that.legendsGroup_height)
      .yAxis(that.svgContainer,that.yGroup,that.yScale,that.ydomain,that.y_tick_values,that.legendsGroup_width)
      .xAxisTitle(that.xGroup,that.legendsGroup_height,that.legendsGroup_width)
      .yAxisTitle(that.yGroup);

    }
    that.optionalFeatures().labelPosition();
    that.k.exportSVG(that,that.container_id,type,that.panels_enable,that.uniq_group_arr);
    that.k.emptyDiv(that.selector);
  };
};

PykCharts.multiD.spiderWeb = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});

    this.execute = function (pykquery_data) {
        var multiDimensionalCharts = theme.multiDimensionalCharts;
        that = new PykCharts.validation.processInputs(that, options, 'multiDimensionalCharts');

        that.bubbleRadius = options.spiderweb_radius ? options.spiderweb_radius : (0.6 * multiDimensionalCharts.scatterplot_radius);
        that.spiderweb_outer_radius_percent = options.spiderweb_outer_radius_percent ? options.spiderweb_outer_radius_percent : multiDimensionalCharts.spiderweb_outer_radius_percent;
        that.panels_enable = "no";
        that.data_sort_enable = "yes";
        that.data_sort_type = "alphabetically";
        that.data_sort_order = "ascending";
        try {
            if(!that.k.__proto__._isNumber(that.bubbleRadius)) {
                that.bubbleRadius = (0.6 * multiDimensionalCharts.scatterplot_radius);
                throw "spiderweb_radius";
            }
        }
        catch (err) {
            that.k.warningHandling(err,"1");
        }

        try {
            if(!that.k.__proto__._isNumber(that.spiderweb_outer_radius_percent)) {
                that.bubbleRadius = multiDimensionalCharts.spiderweb_outer_radius_percent;
                throw "spiderweb_outer_radius_percent";
            }
        }

        catch (err) {
            that.k.warningHandling(err,"1");
        }

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();

        if(that.mode === "default") {
            that.k.loading();
        }

        if(that.spiderweb_outer_radius_percent > 100) {
            that.spiderweb_outer_radius_percent = 100;
        }

        that.multiD = new PykCharts.multiD.configuration(that);

        that.inner_radius = 0;

        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.data = that.k.__proto__._groupBy("spiderweb",data);
            that.compare_data = that.k.__proto__._groupBy("spiderweb",data);
            that.k.remove_loading_bar(id);
            that.render();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };

    that.dataTransformation = function () {
        that.group_arr = [];
        that.uniq_group_arr = [];
        that.x_arr = [];
        that.uniq_x_arr = [];
        that.data = that.k.__proto__._sortData(that.data, "x", "group", that);
        that.data_length = that.data.length;
        for(var j=0; j<that.data_length; j++) {
            that.group_arr[j] = that.data[j].group;
        }
        that.uniq_group_arr = that.k.__proto__._unique(that.group_arr);
        var len = that.uniq_group_arr.length;

        for(var k=0; k<that.data_length; k++) {
            that.x_arr[k] = that.data[k].x;
        }
        var uniq_x_arr = that.k.__proto__._unique(that.x_arr);

        that.new_data = [];
        for (var k=0; k<len; k++) {
            that.new_data[k] = {
                name: that.uniq_group_arr[k],
                data: []
            };
            for (var l=0; l<that.data_length; l++) {
                if (that.uniq_group_arr[k] === that.data[l].group) {
                    that.new_data[k].data.push({
                        x: that.data[l].x,
                        y: that.data[l].y,
                        weight: that.data[l].weight,
                        color: that.data[l].color,
                        tooltip: that.data[l].tooltip
                    });
                }
            }
        }
        that.new_data_length = that.new_data.length;
    }

    that.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("spiderweb",data);
            that.refresh_data = that.k.__proto__._groupBy("spiderweb",data);
            that.map_group_data = that.multiD.mapGroup(that.data);
            that.dataTransformation();
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.optionalFeatures()
                .createChart()
                .legends()
                .xAxis()
                .yAxis();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    this.render = function () {
        that.fillChart = new PykCharts.Configuration.fillChart(that);
        var id = that.selector.substring(1,that.selector.length),
            container_id = id + "_svg";
        that.border = new PykCharts.Configuration.border(that);
        that.map_group_data = that.multiD.mapGroup(that.data);
        that.dataTransformation();

        if(that.mode === "default") {
            that.k.title()
                .backgroundColor(that)
                .export(that,"#"+container_id,"spiderweb")
                .emptyDiv(that.selector)
                .subtitle()
                .makeMainDiv(that.selector,1);
            that.h = that.chart_height;
            that.optionalFeatures()
                .svgContainer(container_id,1)
                .legendsContainer(1);

            that.k
                .liveData(that)
                .tooltip();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

            that.optionalFeatures()
                .legends()
                .createGroups();
            that.spiderweb_outer_radius_percent = that.k.__proto__._radiusCalculation(that.spiderweb_outer_radius_percent,"spiderweb");
            that.radius_range = [(3*that.spiderweb_outer_radius_percent)/100,(0.09*that.spiderweb_outer_radius_percent)];
            that.sizes = new PykCharts.multiD.bubbleSizeCalculation(that,that.data,that.radius_range);

            that.optionalFeatures()
                .createChart()
                .xAxis()
                .yAxis();
            that.k.createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();

        } else if (that.mode==="infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+container_id,"spiderweb")
                .emptyDiv(that.selector);
            that.k.makeMainDiv(that.selector,1);
            that.h = that.chart_height;
            that.optionalFeatures().svgContainer(container_id,1)
                .legendsContainer()
                .createGroups();
            that.spiderweb_outer_radius_percent = that.k.__proto__._radiusCalculation(that.spiderweb_outer_radius_percent,"spiderweb");
            that.radius_range = [(3*that.spiderweb_outer_radius_percent)/100,(0.09*that.spiderweb_outer_radius_percent)];
            that.sizes = new PykCharts.multiD.bubbleSizeCalculation(that,that.data,that.radius_range);
            that.optionalFeatures()
                .createChart()
                .xAxis()
                .yAxis();

            that.k.tooltip();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        }
        that.k.exportSVG(that,"#"+container_id,"spiderweb")
        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    this.degrees = function (radians) {
      return (radians / Math.PI * 180 - 90);
    };

    this.optionalFeatures = function () {
        var that =this,
            id = that.selector.substring(1,that.selector.length),
            status;
        var optional = {
            svgContainer: function (container_id,i) {
                document.getElementById(id).className += " PykCharts-spider-web";
                that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
                    .append("svg")
                    .attr({
                        "class": "svgcontainer",
                        "id": container_id,
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
                    });
                return this;
            },
            createGroups: function () {
                that.group = that.svgContainer.append("g")
                    .attr({
                        "id": "spider-group",
                        "transform": "translate(" + (that.chart_width - that.legendsGroup_width) / 2 + "," + ((that.h+that.legendsGroup_height+20)/2) + ")"
                    });

                that.ticksElement = that.svgContainer.append("g")
                    .attr("transform", "translate(" + (that.chart_width - that.legendsGroup_width)/ 2 + "," + ((that.h+that.legendsGroup_height+20)/2) + ")");
                return this;
            },
            legendsContainer : function (i) {
                if (PykCharts['boolean'](that.legends_enable) && that.map_group_data[1] && that.mode === "default") {
                    that.legendsGroup = that.svgContainer.append("g")
                        .attr({
                            "class": "spiderweb-legends",
                            "id": "legends"
                        });
                } else {
                    that.legendsGroup_width = 0;
                    that.legendsGroup_height = 0;
                }
                return this;
            },
            createChart: function () {
                var i, min, max,
                    uniq = that.new_data[0].data,
                    uniq_length = uniq.length;
                max = d3.max(that.new_data, function (d,i) { return d3.max(d.data, function (k) { return k.y; })});
                min = d3.min(that.new_data, function (d,i) { return d3.min(d.data, function (k) { return k.y; })});

                that.yScale = d3.scale.linear()
                    .domain([min,max])
                    .range([that.inner_radius, that.spiderweb_outer_radius_percent]);
                that.y_domain = [], that.nodes = [];
                var t = [];
                for (var i=0;i<that.new_data_length;i++){
                    var new_y_values = [];
                    for (var j=0;j<that.new_data[i].data.length;j++) {
                        t.push(that.yScale(that.new_data[i].data[j].y));
                        new_y_values[j] = that.yScale(that.new_data[i].data[j].y)
                    }
                    that.y_domain[i] = new_y_values;
                }
                that.y = d3.scale.linear()
                        .domain(d3.extent(t, function(d) { return parseFloat(d); }))
                        .range([0.1,0.9]);
                for (var i=0;i<that.new_data_length;i++){
                    var xyz = [];
                    for (var j=0;j<uniq_length;j++) {
                        xyz[j] = {
                            x: j,
                            y: that.y(that.y_domain[i][j]),
                            tooltip: that.new_data[i].data[j].tooltip || that.new_data[i].data[j].weight
                        }
                    }
                    that.nodes[i] = xyz;
                }
                that.radius = d3.scale.linear().range([that.inner_radius, that.spiderweb_outer_radius_percent]);
                for (var m =0; m<that.new_data_length; m++) {
                    // console.log(that.new_data,"new_data")
                    var toolTip = [];
                    for (j=0; j<that.new_data[m].data.length;j++) {
                        toolTip[j] = that.new_data[m].data[j].tooltip;
                    }

                    that.angle = d3.scale.ordinal().domain(d3.range(that.new_data[m].data.length+1)).rangePoints([0, 2 * Math.PI]);


                    that.yAxis = [];
                    for (var i=0;i<that.new_data[m].data.length;i++){
                        that.yAxis.push(
                            {x: i, y: 0.25},
                            {x: i, y: 0.5},
                            {x: i, y: 0.75},
                            {x: i, y: 1}
                        );
                    }
                    // console.log(that.yAxis)
                    var target;
                    var grids = [];
                        that.yAxis_length =  that.yAxis.length;
                    for (var i=0;i<that.yAxis_length;i++) {
                        if (i<(that.yAxis_length-4)) {
                            target = that.yAxis[i+4];
                        } else {
                            target = that.yAxis[i - that.yAxis_length + 4];
                        }
                        grids.push({source: that.yAxis[i], target: target});
                    }

                    var links = [], color;
                    for (var i=0;i<that.nodes[m].length;i++) {
                        if (i<(that.nodes[m].length-1)) {
                            target = that.nodes[m][i+1];
                            color = that.fillChart.colorPieW(that.new_data[m].data[i]);
                        } else {
                            target = that.nodes[m][0];
                            color = that.fillChart.colorPieW(that.new_data[m].data[i]);
                        }
                        links.push({source: that.nodes[m][i], target: target, color : color});
                    }

                    var spider =  that.group.selectAll("#link"+m)
                        .data(links);

                    spider.enter().append("path")
                        .attr("class", "link")

                    spider.attr({
                        "class": "link",
                        "stroke": function (d) {
                            return d.color;
                        },
                        "stroke-opacity": 1,
                        "id": "link"+m,
                        "d": d3.customHive.link()
                                .angle(function(d) { return that.angle(d.x); })
                                .radius(function(d) { return that.radius(d.y); })
                    });
                    spider.exit().remove();

                    that.weight = that.new_data[m].data.map(function (d) {
                        return d.weight;
                    });

                    var weight_length = that.weight.length,
                        rejected_result = [];
                    for(var i=0 ; i<weight_length ; i++) {
                        if(that.weight[i] !== 0) {
                            rejected_result.push(that.weight[i]);
                        }
                    }
                    that.weight = rejected_result;

                    that.sorted_weight = that.weight.slice(0);
                    that.sorted_weight.sort(function(a,b) { return a-b; });
                    var spiderNode = that.group.selectAll(".node"+m)
                        .data(that.nodes[m])

                    spiderNode.enter().append("circle")
                        .attr({
                            "class": "dot node"+m,
                            "transform": function(d) { return "rotate(" + that.degrees(that.angle(d.x)) + ")"; }
                        });

                    spiderNode.attr({
                        "class": "dot node"+m,
                        "cx": function (d) { return that.radius(d.y); },
                        "r": function (d,i) { return that.sizes(that.new_data[m].data[i].weight); },
                        "fill-opacity": function (d,i) {
                            return that.multiD.opacity(that.new_data[m].data[i].weight,that.weight,that.data);
                        },
                        "data-fill-opacity": function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "stroke": that.border.color(),
                        "stroke-width": that.border.width(),
                        "stroke-dasharray": that.border.style(),
                        "data-id":function (d,i) {
                            return that.new_data[0].data[i].x;
                        }
                    })
                    .style("fill", function (d,i) {
                        return that.fillChart.colorPieW(that.new_data[m].data[i]);
                    })
                    .on({
                        'mouseover': function (d,i) {
                            if(that.mode === "default") {
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(d.tooltip);
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlight(that.selector + " .dot", this);
                                }
                            }
                        },
                        'mouseout': function (d) {
                            if(that.mode === "default") {
                                that.mouseEvent.tooltipHide(d);
                                if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                    that.mouseEvent.highlightHide(that.selector + " .dot");
                                }
                            }
                        },
                        'mousemove': function (d) {
                            if(that.mode === "default") {
                                that.mouseEvent.tooltipPosition(d);
                            }
                        },
                        'click': function (d,i) {
                            if(PykCharts['boolean'](that.click_enable)) {
                               that.addEvents(that.new_data[0].data[i].x, d3.select(this).attr("data-id"));
                            }
                        }
                    });
                    spiderNode.exit().remove();
                }

                that.group.selectAll(".axis")
                    .data(d3.range(that.new_data[0].data.length))
                    .enter().append("line")
                    .attr({
                        "class": "axis",
                        "transform": function(d) { return "rotate(" + that.degrees(that.angle(d)) + ")"; },
                        "x1": that.radius.range()[0],
                        "x2": that.radius.range()[1]
                    });

                that.group.selectAll(".grid")
                    .data(grids)
                    .enter().append("path")
                    .attr({
                        "class": "grid",
                        "d": d3.customHive.link()
                                .angle(function(d) { return that.angle(d.x); })
                                .radius(function(d) { return that.radius(d.y); })
                    });

                return this;
            },
            legends : function () {
                if (PykCharts['boolean'](that.legends_enable) && that.map_group_data[1] && that.mode==="default") {
                    that.multiD.legendsPosition(that,"spiderWeb",that.map_group_data[0]);
                }
                return this;
            },
            xAxis : function () {
                that.length = that.new_data[0].data.length;

                var spiderAxisTitle = that.group.selectAll("text.x-axis-title")
                    .data(that.nodes[0]);

                spiderAxisTitle.enter()
                    .append("text")
                    .attr("class","x-axis-title");

                spiderAxisTitle.attr({
                    "transform": function(d, i){
                        return "translate(" + (-that.spiderweb_outer_radius_percent) + "," + (-that.spiderweb_outer_radius_percent) + ")";
                    },
                    "x": function (d, i){ return that.spiderweb_outer_radius_percent*(1-0.2*Math.sin(i*2*Math.PI/that.length))+(that.spiderweb_outer_radius_percent * 1.25)*Math.sin(i*2*Math.PI/that.length); },
                    "y": function (d, i){
                        return that.spiderweb_outer_radius_percent*(1-0.60*Math.cos(i*2*Math.PI/that.length))-(that.spiderweb_outer_radius_percent * 0.47)*Math.cos(i*2*Math.PI/that.length);
                    }
                })
                .style({
                    "text-anchor": "middle",
                    "font-size": that.axis_x_pointer_size + "px",
                    "font-family": that.axis_x_pointer_family,
                    "font-weight": that.axis_x_pointer_weight,
                    "fill": that.axis_x_pointer_color
                });

                spiderAxisTitle
                    .text(function (d,i) { return that.new_data[0].data[i].x; });

                spiderAxisTitle.exit().remove();
                return this;
            },
            yAxis: function () {
                var a = that.yScale.domain(),
                    t = a[1]/4,
                    b = [];
                for(var i=4,j=0; i>=0 ;i--,j++){
                    b[j]=i*t;
                }
                var tick_label = that.ticksElement.selectAll("text.y-axis-ticks")
                    .data(b);

                tick_label.enter()
                    .append("text")
                    .attr("class","y-axis-ticks");
                tick_label
                    .style("text-anchor","start")
                    .attr({
                        "transform": "translate(5,"+(-that.spiderweb_outer_radius_percent)+")",
                        "x": 0,
                        "y": function (d,i) { return (i*(that.spiderweb_outer_radius_percent/4)); },
                        "dy": -2
                    });

                tick_label
                    .text(function (d,i) { return d; })
                    .style({
                        "font-size": that.axis_y_pointer_size + "px",
                        "font-family": that.axis_y_pointer_family,
                        "font-weight": that.axis_y_pointer_weight,
                        "fill": that.axis_y_pointer_color
                    });

                tick_label.exit().remove();
                return this;
            },
            sort : function() {
                if(that.axis_y_data_format === "string") {
                    try {
                        if(that.data_sort_type === "alphabetically") {
                            that.data = that.k.__proto__._sortData(that.data, "y", "group", that);
                        } else {
                            that.data_sort_type = multiDimensionalCharts.data_sort_type;
                            throw "data_sort_type";
                        }
                    }
                    catch(err) {
                        that.k.warningHandling(err,"8");
                    }
                }
                return this;
            }
        }
        return optional;
    };
};
PykCharts.multiD.waterfall = function(options){
	var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    var multiDimensionalCharts = theme.multiDimensionalCharts;

	this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, "multiDimensionalCharts");
        that.calculate_total = options.calculate_total ? options.calculate_total : multiDimensionalCharts.calculate_total;
        that.calculate_total_of = options.calculate_total_of ? options.calculate_total_of : [];
        that.axis_y_background_color = options.axis_y_background_color ? options.axis_y_background_color : theme.multiDimensionalCharts.axis_y_background_color;

        PykCharts.scaleFunction(that);
		that.color_mode = "color";
		that.grid_y_enable = "no";
        that.grid_color = "#fff";
        that.panels_enable = "no";
        that.longest_tick_width = 0;
        that.ticks_formatter = d3.format("s");
        try {
        	if (that.chart_color.length == 0) {
	        	that.chart_color = ["rgb(255, 60, 131)", "rgb(0, 185, 250)", "grey"];
	        	throw "chart_color";
	        }
	        else if (that.chart_color.length == 1) {
	        	that.chart_color.push("rgb(0, 185, 250)", "grey");
	        	throw "chart_color";
	        }
	        else if (that.chart_color.length == 2) {
	        	that.chart_color.push("grey");
	        	throw "chart_color";
	        }
        }
        catch(err) {
        	console.warn('%c[Warning - Pykih Charts] ', 'color: #F8C325;font-weight:bold;font-size:14px', " at "+that.selector+".(\""+"You seem to have passed less than three colors for '"+err+"', in a waterfall chart."+"\")  Visit www.pykcharts.com/errors#warning_18");
        }

        if(that.stop) {
            return;
        }
        that.k.storeInitialDivHeight();

        if(that.mode === "default") {
           that.k.loading();
        }
        that.multiD = new PykCharts.multiD.configuration(that);

        that.executeData = function (data) {
			var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);

            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }

            that.data = that.k.__proto__._groupBy("waterfall",data);
            that.compare_data = that.k.__proto__._groupBy("waterfall",data);

            that.axis_y_data_format = that.k.yAxisDataFormatIdentification(that.data);
            that.axis_x_data_format = "number";

            that.k.remove_loading_bar(id);
            PykCharts.multiD.waterfallFunctions(options,that,"waterfall");
            that.render();
		};
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
	};
};

PykCharts.multiD.waterfallFunctions = function (options,chartObject,type) {
    var that = chartObject;

    that.refresh = function (pykquery_data) {
        var element = document.querySelectorAll(".custom-axis");
        for(var i = 0;i<element.length;i++) {
            element[i].parentNode.removeChild(element[i]);
        }

        that.executeRefresh = function (data) {
            that.data = that.k.__proto__._groupBy("waterfall",data);
            that.refresh_data = that.k.__proto__._groupBy("waterfall",data);
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }

            that.groupData();
            that.sortData();
            that.calculateRiverData();

            that.optionalFeatures()
                .createScales()
                .ticks()
                .createChart();

            that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.yDomain,that.y_tick_values,undefined,undefined,that.tick_format_function)
            that.xaxis();
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
        }
    };

    that.render = function() {
    	var that = this;
        var id = that.selector.substring(1,that.selector.length);
        that.container_id = id + "_svg";
        that.groupData();
        that.sortData();
        that.calculateRiverData();
        that.transitions = new PykCharts.Configuration.transition(that);
        that.mouseEvent1 = new PykCharts.Configuration.mouseEvent(that);
        that.border = new PykCharts.Configuration.border(that);

        that.reducedWidth = that.chart_width - that.chart_margin_left - that.chart_margin_right;
		that.reducedHeight = that.chart_height - that.chart_margin_top - that.chart_margin_bottom;
        // console.log(that.data,that.new_data)
        if (that.mode === "default") {

    		that.k.title()
    			.backgroundColor(that)
    			.export(that, "#"+that.container_id,"waterfallChart")
    			.subtitle()
    			.makeMainDiv(that.selector,1);

    		that.optionalFeatures(id)
                .svgContainer(1,that.container_id)
                .createGroups();

            that.k.liveData(that)
                .tooltip()
                .createFooter()
                .lastUpdatedAt()
                .credits()
                .dataSource();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);

           	that.optionalFeatures(id)
                .axisContainer()
                .createScales()
               	.ticks()
                .createChart();

        } else if(that.mode === "infographics") {
            that.k.backgroundColor(that)
                .export(that,"#"+that.container_id,"waterfallChart")
                .emptyDiv()
                .makeMainDiv(that.selector,1);

            that.optionalFeatures(id)
                .svgContainer(1,that.container_id)
                .createGroups()
            	.axisContainer()
                .createScales()
                .ticks()
                .createChart();

            that.k.tooltip();

            that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        }

        that.k.yAxis(that.svgContainer,that.yGroup,that.yScale,that.yDomain,that.y_tick_values,undefined,undefined,that.tick_format_function)
                  .yAxisTitle(that.yGroup,undefined);

        that.xaxis();
        that.optionalFeatures().axis_background(that.container_id);
        that.k.exportSVG(that,"#"+that.container_id,"waterfallChart");
        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    that.optionalFeatures = function (id) {
    	var that = this;
    	var optional = {
    		svgContainer: function (i,container_id) {
                document.getElementById(id).className += " PykCharts-twoD";
                that.svgContainer = d3.select(that.selector + " #chart-container-" + i)
                    .append("svg:svg")
                    .attr("width",that.chart_width)
                    .attr("height",that.chart_height)
                    .attr("id",container_id)
                    .attr("class","svgcontainer")
                    .attr("preserveAspectRatio", "xMinYMin")
                    .attr("viewBox", "0 0 " + that.chart_width + " " + that.chart_height);

                    that.background_rect =  that.svgContainer.selectAll(".background-rect")
                        .data(["rect"])

                    that.background_rect.enter()
                        .append("rect")
                        .attr("class","background-rect")

                    that.background_rect
                        .attr("y",that.chart_margin_top)
                        .attr("width",that.longest_tick_width)
                        .attr("height",that.reducedHeight)
                        .attr("fill",that.axis_y_background_color);

                return this;
            },
            createGroups: function () {
            	that.group = that.svgContainer.append("g")
                    .attr("id","chartsvg")
                    .attr("transform","translate("+ that.chart_margin_left +","+ that.chart_margin_top +")");

                return this;
            },
            createScales: function () {
                that.y_values = [];
                that.x_values = [];
                var river_data_length = that.river_data.length;
                var domain = [];
                for(var i = 0;i<river_data_length;i++) {
                        domain.push(that.river_data[i].y);
                        that.y_values.push(that.river_data[i].unique_name);
                        that.x_values.push(that.river_data[i].end);
                }

                that.y_values.reverse();
                domain.reverse();
                that.tick_format_function = function (d) {
                    var index = d.lastIndexOf('-');
                    if(index!=-1) {
                        return d.substring(0,index);
                    } else {
                        return d;
                    }
                }

            	that.yScale = d3.scale.ordinal()
		        	.domain(that.y_values)
		        	.rangeRoundBands([that.reducedHeight, 0],0.1);

		        that.yDomain = domain;
		        that.data_length = that.data.length;

		        that.bars = that.group.selectAll(".bar")
		        		.data(that.river_data);

		        that.bars.attr("transform", function(d) { return "translate(5, " + that.yScale(d.unique_name) + ")"; });

		        that.bars.enter()
		        	.append("g")
	        		.attr("class", function(d) { return "bar "+d.group; })
	        		.attr("transform", function(d) { return "translate(5, " + that.yScale(d.unique_name) + ")"; });

            	return this;
            },
            axisContainer : function () {
                if(PykCharts.boolean(that.axis_y_enable) || that.axis_y_title) {
                	that.yGroup = that.group.append("g")
                        .attr("id","yaxis")
                        .attr("class","y axis");
                }
                return this;
            },
            createChart: function () {
            	that.y_tick_values = that.k.processYAxisTickValues();
            	that.xScale = d3.scale.linear()
		        	.domain([0, d3.max(that.x_values, function(d) { return d; })])
		        	.range([0, (that.reducedWidth - that.longest_tick_width - 15)]);

		    	var rect = that.bars.selectAll(".rect")
	    				.data(function(d){
	    					return [d];
	    				});

	    		rect.enter().append("rect")
    				.attr("class","rect")
		       		.attr("stroke",that.border.color())
                    .attr("stroke-width",that.border.width())
                    .attr("stroke-dasharray", that.border.style())
                    .attr("stroke-opacity",1);

                var count_rect = 0;

		        rect.attr("x", function(d) { return that.xScale(d.start) + that.longest_tick_width + 15; })
		       		.attr("height", that.yScale.rangeBand())
		       		.attr("width", 0)
		       		.attr("fill", function(d,i) {
                        return d.color;
		       		})
                    .attr("fill-opacity",1)
                    .attr("data-id",function (d,i) {
                        return d.unique_name;
                    })
		       		.on('mouseover',function (d) {
                        if(that.mode === "default") {
                            if(PykCharts["boolean"](that.tooltip_enable)) {
                            	var tooltipText = d.tooltip ? d.tooltip : "<table><thead><th colspan='2'><b>"+d.y+"</b></th></thead><tr><td>Start</td><td><b>"+that.ticks_formatter(d.start)+"</b></td></tr><tr><td>Weight</td><td><b>"+that.ticks_formatter(d.x)+"</b></td></tr></table>";
                                that.mouseEvent.tooltipPosition(d);
                                that.mouseEvent.tooltipTextShow(tooltipText);
                            }
                            that.mouseEvent.axisHighlightShow(d.unique_name,that.selector + " .y.axis",that.y_values,"waterfall");
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlight(that.selector + " .rect", this);
                            }
                        }
                    })
                    .on('mouseout',function (d) {
                        if(that.mode === "default") {
                            if(PykCharts["boolean"](that.tooltip_enable)) {
                                that.mouseEvent.tooltipHide(d);
                            }
                            that.mouseEvent.axisHighlightHide(that.selector + " .y.axis");
                            if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                that.mouseEvent.highlightHide(that.selector + " .rect")
                            }
                        }
                    })
                    .on('mousemove', function (d) {
                        if(that.mode === "default" && PykCharts["boolean"](that.tooltip_enable)) {
                            that.mouseEvent.tooltipPosition(d);
                        }
                    })
                    .on('click', function (d,i) {
                        if(PykCharts['boolean'](that.click_enable)){
                           that.addEvents(d.unique_name, d3.select(this).attr("data-id"));
                        }
                    })
                    .transition()
               		.duration(that.transitions.duration())
               		.delay(function(d) { count_rect++; return (count_rect / that.data_length) * that.transitions.duration(); })
               		.attr("x", function(d) { return (that.xScale((d.group == "negative") ? d.end : d.start)) + that.longest_tick_width + 15; })
		       		.attr("width", function(d) {
                            return Math.abs(that.xScale(d.x));
                        });

                rect.exit()
                	.remove();

                that.bars.exit()
                	.remove();

		       	return this;
            },
            ticks: function() {
            	if(that.pointer_size) {
                    // that.background_rect.remove()
                    //     .exit();

            		var ticks = that.bars.selectAll(".ticks-text")
		    				.data(function(d){
		    					return [d];
		    				});

		    		ticks.enter().append("text")
	    				.attr("class","ticks-text")
	                    .style("font-weight", that.pointer_weight)
	                    .style("font-size", that.pointer_size + "px")
	                    .style("font-family", that.pointer_family)
	                    .text("");

	            	ticks.text(function(d) {
			       			return that.ticks_formatter(d.x);
			       		})
			       		.style("visibility","hidden")
			       		.attr("y", function(d) { return (that.yScale.rangeBand()/2 + this.getBBox().height/3); })
			       		.attr("dx", ".25em")
			       		.attr("fill", function(d) {
	                    	that.longest_tick_width = (that.longest_tick_width < this.getBBox().width) ? this.getBBox().width : that.longest_tick_width;

	                    	if (d.group == "negative") {
			       				return that.chart_color[0];
			       			}
			       			else if (d.group == "positive") {
			       				return that.chart_color[1];
			       			}
	                    })
			       		.style("visibility","visible");

			       	ticks.exit()
			       		.remove();

			    }

            	return this;
            },
            axis_background: function (container_id) {
                if(PykCharts.boolean(that.axis_y_enable) && that.axis_y_pointer_size) {
                    var y_axis_text = document.querySelectorAll("#"+container_id+" #yaxis .tick text");
                    var y_axis_text_length = y_axis_text.length,text = [];
                    for(var i=0;i<y_axis_text_length;i++) {
                        text.push(y_axis_text[i].getBBox().width)
                    }
                    var max_width = d3.max(text,function(d){
                        return d;
                    })

                    that.background_rect
                        .attr("x",that.chart_margin_left - max_width - 10)
                        .attr("width",max_width+10);


                    that.background_rect.exit()
                        .remove();
                }
                return this;
            }
    	};
    	return optional;
    };
    that.groupData = function() {
        that.group_arr = [], that.new_data = [];
        that.ticks = [], that.x_arr = [];

        for(j = 0;j < that.data.length;j++) {

            that.group_arr[j] = that.data[j].group;
        }
        that.uniq_group_arr = that.k.__proto__._unique(that.group_arr);
        var uniq_group_arr_length = that.uniq_group_arr.length;

        for(var k = 0;k < that.data.length;k++) {
            that.x_arr[k] = +that.data[k].x;
        }
        var uniq_x_arr = that.k.__proto__._unique(that.x_arr);

        that.flag = 0;

        for (var k = 0;k < uniq_group_arr_length;k++) {
            that.new_data[k] = {
                    name: that.uniq_group_arr[k],
                    data: []
            };
            for (var l = 0;l < that.data.length;l++) {
                if (that.uniq_group_arr[k] === that.data[l].group) {
                    that.new_data[k].data.push({
                        x: +that.data[l].x,
                        y: that.data[l].y,
                        tooltip: that.data[l].tooltip,
                        name: that.data[l].group,
                        unique_name: that.data[l].group ? (that.data[l].y + "-" + that.data[l].group) : that.data[l].y
                    });
                }
            }
        }
        that.new_data_length = that.new_data.length;
    }

    that.dataTransformation = function (new_data) {
    	var cumulative = 0,
    		temp_cumulative = 0,
    		total_start = 0,
    		total_end = 0,
    		total_weight = 0,
    		totol_group = 'positive',
            data = new_data.data,
            name = 'Total';

    	var data_length = data.length
    	   ,rect_data = [];

    	for(var i = 0; i<that.data.length;i++) {
            temp_cumulative += that.data[i].x;
            if (temp_cumulative < cumulative) {
                cumulative = temp_cumulative;
            }
        }

        if(new_data.name) {
            name =  name + " " + new_data.name;
        }

    	if (cumulative<0) { cumulative = Math.abs(cumulative); }
    	else { cumulative = 0; }
        data = that.rivergroup(cumulative,data,name,cumulative,new_data.name);

        return data;
    };

    that.check_total_is_present = function (data) {
        var present = false;
        for(var l = 0;l<that.calculate_total_of.length;l++) {
            if(data === that.calculate_total_of[l]) {
                present = true;
                break;
            }
        }
        return present;
    }

    that.rivergroup = function (start,data,name,cumulative,group_name) {
        var store_cumulative = cumulative;
        for (var i=0 ; i<data.length ; i++) {
            data[i].start = cumulative;
            cumulative += data[i].x;
            data[i].end = cumulative;
            data[i].group = (data[i].x > 0) ? "positive" : "negative"
            data[i].color = (data[i].x > 0) ? that.chart_color[1] : that.chart_color[0];
            data[i].name = data[i].name;
            that.river_data.push(data[i]);
        }
        total_start = start;
        total_end = data[data.length-1].end;
        total_weight = total_end - total_start;
        totol_group = (total_weight < 0) ? 'negative' : 'positive';

        that.river_data.push({
            y: name,
            x: total_weight,
            end: total_end,
            start: total_start,
            group: totol_group,
            color: that.chart_color[2],
            name: data[data.length-1].name,
            unique_name: group_name ? (name+"-"+group_name) : name
        });
        return data;
    }
    that.calculateRiverData = function () {
        that.river_data = [];
        var prev_total;
        for(var i = 0;i<that.new_data_length;i++) {
            if(i===0) {
                that.dataTransformation(that.new_data[i]);
            } else {
                var previous_data_length = that.river_data.length;
                prev_total = that.river_data[previous_data_length-1];
                var present = that.check_total_is_present(prev_total.name);
                if(!PykCharts["boolean"](that.calculate_total)) {
                    that.river_data.pop();
                } else if (!present && that.calculate_total_of.length) {
                    that.river_data.pop();
                }
                name =  'Total' + " " + that.new_data[i].name;
                that.rivergroup(that.river_data[0].start,that.new_data[i].data,name,prev_total.end,that.new_data[i].name);
            }
        }
        present = that.check_total_is_present(that.river_data[that.river_data.length-1].name);
        if(!PykCharts["boolean"](that.calculate_total)) {
            that.river_data.pop();
        } else if (!present && that.calculate_total_of.length) {
            that.river_data.pop();
        }
    }
    that.xaxis = function () {
        var xScale_domain = that.xScale.domain();
        var start_point = that.xScale(xScale_domain[0]) + that.longest_tick_width + 15;
        var end_point = that.xScale(xScale_domain[1]) + that.longest_tick_width + 15,
            extrapadding = 5;
        var middle_point = that.xScale(that.new_data[0].data[0].start) + that.longest_tick_width + 15;
        if(PykCharts['boolean'](that.axis_x_enable)) {
            drawline(start_point+extrapadding,end_point+extrapadding+1,that.reducedHeight,that.reducedHeight);
            drawline(start_point+extrapadding,start_point+extrapadding,that.reducedHeight,that.reducedHeight+that.axis_x_outer_pointer_length)
            drawline(end_point+extrapadding,end_point+extrapadding,that.reducedHeight,that.reducedHeight+that.axis_x_pointer_length)
            drawline(middle_point+extrapadding,middle_point+extrapadding,that.reducedHeight,that.reducedHeight+that.axis_x_pointer_length);

            var text = that.group.selectAll(".custom-axis-text")
                .data([0]);

            text.enter()
                .append("text");

            text.attr("class","custom-axis-text")
                .attr("x",middle_point+extrapadding)
                .attr("y",that.reducedHeight+that.axis_x_pointer_length)
                .attr("dy",12)
                .attr("text-anchor","middle")
                .attr("fill",that.axis_x_pointer_color)
                .style("font-family",that.axis_x_pointer_family)
                .style("font-size",that.axis_x_pointer_size)
                .style("font-weight",that.axis_x_pointer_weight)
                .text("0");

            text.exit().remove();
        }

        function drawline(x1,x2,y1,y2) {
            that.group.append("line")
                .attr("x1",x1)
                .attr("y1",y1)
                .attr("x2",x2)
                .attr("y2",y2)
                .attr("class","custom-axis")
                .attr("stroke",that.axis_x_line_color)
                .attr("stroke-width",1)
                .style("shape-rendering","crispEdges");
        }
    }

    that.sortData = function () {
        if(that.axis_y_data_format === "number" || that.axis_y_data_format === "time") {
            for(var i=0;i<that.new_data_length;i++) {
                that.new_data[i].data = that.k.__proto__._sortData(that.new_data[i].data, undefined, "y", that)
            }
        }
    }
};
PykCharts.maps = {};

PykCharts.maps.processInputs = function (chartObject, options) {
    var theme = new PykCharts.Configuration.Theme({})
        , stylesheet = theme.stylesheet
        , functionality = theme.functionality
        , mapsTheme = theme.mapsTheme
        , optional = options.optional;

    chartObject.timeline_duration = "timeline_duration" in options ? options.timeline_duration : mapsTheme.timeline_duration;

    chartObject.margin_left = options.timeline_margin_left ? options.timeline_margin_left : mapsTheme.timeline_margin_left;
    chartObject.margin_right = options.timeline_margin_right ? options.timeline_margin_right : mapsTheme.timeline_margin_right;
    chartObject.margin_top = options.timeline_margin_top ? options.timeline_margin_top : mapsTheme.timeline_margin_top;
    chartObject.margin_bottom = options.timeline_margin_bottom ? options.timeline_margin_bottom : mapsTheme.timeline_margin_bottom;

    chartObject.tooltip_position_top = options.tooltip_position_top ? options.tooltip_position_top : mapsTheme.tooltip_position_top;
    chartObject.tooltip_position_left = options.tooltip_position_left ? options.tooltip_position_left : mapsTheme.tooltip_position_left;
    chartObject.tooltipTopCorrection = d3.select(chartObject.selector).style("top");
    chartObject.tooltipLeftCorrection = d3.select(chartObject.selector).style("left");

    chartObject.chart_color = options.chart_color ? options.chart_color : [];
    chartObject.saturation_color = options.saturation_color ? options.saturation_color : "";
    chartObject.palette_color = options.palette_color ? options.palette_color : mapsTheme.palette_color;

    chartObject.label_enable = options.label_enable ? options.label_enable.toLowerCase() : mapsTheme.label_enable;
    chartObject.chart_onhover_effect = options.chart_onhover_effect ? options.chart_onhover_effect.toLowerCase() : mapsTheme.chart_onhover_effect;
    chartObject.default_zoom_level = options.default_zoom_level ? options.default_zoom_level : 80;
    chartObject.k = new PykCharts.Configuration(chartObject);
    chartObject.total_no_of_colors = options.total_no_of_colors && chartObject.k.__proto__._isNumber(parseInt(options.total_no_of_colors,10))? parseInt(options.total_no_of_colors,10) : mapsTheme.total_no_of_colors;
    chartObject.default_color = options.default_color ? options.default_color : stylesheet.chart_color;

    chartObject.k.validator().validatingSelector(chartObject.selector.substring(1,chartObject.selector.length))
        .isArray(chartObject.chart_color,"chart_color")
        .validatingDataType(chartObject.margin_left,"timeline_margin_left",mapsTheme.timeline_margin_left,"margin_left")
        .validatingDataType(chartObject.margin_right,"timeline_margin_right",mapsTheme.timeline_margin_right,"margin_right")
        .validatingDataType(chartObject.margin_top,"timeline_margin_top",mapsTheme.timeline_margin_top,"margin_top")
        .validatingDataType(chartObject.margin_bottom,"timeline_margin_bottom",mapsTheme.timeline_margin_bottom,"margin_bottom")
        .validatingDataType(chartObject.tooltip_position_top,"tooltip_position_top",mapsTheme.tooltip_position_top)
        .validatingDataType(chartObject.tooltip_position_left,"tooltip_position_left",mapsTheme.tooltip_position_left)
        .validatingColor(chartObject.highlight_color,"highlight_color",stylesheet.highlight_color)
        .validatingColor(chartObject.saturation_color,"saturation_color",stylesheet.saturation_color);

        if(chartObject.chart_color.constructor === Array) {
            if(chartObject.chart_color[0]) {
                chartObject.k.validator()
                    .validatingColor(chartObject.chart_color[0],"chart_color",stylesheet.chart_color);
            }
        }

    if (chartObject.color_mode === "saturation") {
        try {
            if(chartObject.total_no_of_colors < 3 || chartObject.total_no_of_colors > 9) {
                chartObject.total_no_of_colors = mapsTheme.total_no_of_colors;
                throw "total_no_of_colors";
            }
        }
        catch (err) {
            chartObject.k.warningHandling(err,"10");
        }
    }

    try {
        if(chartObject.chart_onhover_effect.toLowerCase() === "shadow" || chartObject.chart_onhover_effect.toLowerCase() === "none" || chartObject.chart_onhover_effect.toLowerCase() === "highlight_border" || chartObject.chart_onhover_effect.toLowerCase() === "color_saturation") {
        } else {
            chartObject.chart_onhover_effect = mapsTheme.chart_onhover_effect;
            throw "chart_onhover_effect";
        }
    }
    catch (err) {
        chartObject.k.warningHandling(err,"12");
    }

    try {
        if(!chartObject.k.__proto__._isNumber(chartObject.default_zoom_level)) {
            chartObject.default_zoom_level = 80;
            throw "default_zoom_level"
        }
    }

    catch (err) {
        chartObject.k.warningHandling(err,"1");
    }

    chartObject.timeline_duration = (chartObject.timeline_duration * 1000);

    return chartObject;
};
PykCharts.maps.oneLayer = function (options) {
    var that = this;
    that.interval = "";
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'maps');
        that = PykCharts.maps.processInputs(that, options);
        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);
            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.k.storeInitialDivHeight();
            that.data = data;
            that.data_length = that.data.length;
            that.compare_data = data;
            that.k
                .totalColors(that.total_no_of_colors)
                .colorType(that.color_mode)
                .loading(that.loading)
                .tooltip();

                d3.json(PykCharts.assets+"ref/" + that.map_code + "-topo.json", function (e,data) {
                        if(e && e.status === 404) {
                            that.k.errorHandling("map_code","3");
                            that.k.remove_loading_bar(id);
                            return;
                        }

                    that.map_data = data;
                    var map_data_objects_geometries_length = that.map_data.objects.geometries.length;
                    for (var i=0 ; i<map_data_objects_geometries_length ; i++) {
                        var a = that.map_data.objects.geometries[i].properties.NAME_1.replace("'","&#39;");
                        that.map_data.objects.geometries[i].properties.NAME_1 = a;
                    }

                    d3.json(PykCharts.assets+"ref/colorPalette.json", function (data) {
                        that.color_palette_data = data;
                        var validate = that.k.__proto__._where(that.color_palette_data,{name:that.palette_color});

                        try {
                            if (!validate.length) {
                                that.palette_color = theme.mapsTheme.palette_color;
                                throw "palette_color";
                            }
                        }
                        catch (e) {
                            that.k.warningHandling(e,"11");
                        }

                        d3.select(that.selector).html("");
                        d3.select(that.selector).style("height","auto");
                        var oneLayer = new PykCharts.maps.mapFunctions(options,that,"oneLayer");
                        oneLayer.render();
                    });
                });
            that.extent_size = d3.extent(that.data, function (d) { return parseInt(d.size, 10); });
            that.difference = that.extent_size[1] - that.extent_size[0];
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};

PykCharts.maps.timelineMap = function (options) {
    var that = this;
    var theme = new PykCharts.Configuration.Theme({});
    this.execute = function (pykquery_data) {
        that = new PykCharts.validation.processInputs(that, options, 'maps');
        that = PykCharts.maps.processInputs(that, options);

        PykCharts.scaleFunction(that);
        that.executeData = function (data) {
            var validate = that.k.validator().validatingJSON(data),
                id = that.selector.substring(1,that.selector.length);

            if(that.stop || validate === false) {
                that.k.remove_loading_bar(id);
                return;
            }
            that.k.storeInitialDivHeight();
            that.timeline_data = data;
            that.compare_data = data;
            var x_extent = d3.extent(data, function (d) { return d.timestamp; }),
                data_length = data.length;

            that.data = that.k.__proto__._where(data, {timestamp: x_extent[0]});
            that.data_length = that.data.length;

            that.redeced_width = that.chart_width - (that.margin_left * 2) - that.margin_left;

            that.k
                .totalColors(that.total_no_of_colors)
                .colorType(that.color_mode)
                .loading(that.loading)
                .tooltip(that.tooltip_enable);

            d3.json(PykCharts.assets+"ref/" + that.map_code + "-topo.json", function (data) {
                that.map_data = data;
                var map_data_objects_geometries_length = that.map_data.objects.geometries.length;
                for (var i=0 ; i<map_data_objects_geometries_length ; i++) {
                    var a = that.map_data.objects.geometries[i].properties.NAME_1.replace("'","&#39;");
                    that.map_data.objects.geometries[i].properties.NAME_1 = a;
                }
                d3.json(PykCharts.assets+"ref/colorPalette.json", function (data) {
                    that.color_palette_data = data;
                    var validate = that.k.__proto__._where(that.color_palette_data, {name:that.palette_color});

                    try {
                        if (!validate.length) {
                            that.palette_color = theme.mapsTheme.palette_color;
                            throw "palette_color";
                        }
                    }
                    catch (err) {
                        that.k.warningHandling(err,"11");
                    }

                    var x_extent = d3.extent(that.timeline_data, function (d) { return d.timestamp; })
                    that.data = that.k.__proto__._where(that.timeline_data, {timestamp: x_extent[0]});
                    that.data_length = that.data.length;

                    that.data.sort(function (a,b) {
                        return a.timestamp - b.timestamp;
                    });
                    d3.select(that.selector).html("");
                    var timeline = new PykCharts.maps.mapFunctions(options,that,"timeline");
                    timeline.render();
                });
            });

            that.extent_size = d3.extent(that.data, function (d) { return parseInt(d.size, 10); });
            that.difference = that.extent_size[1] - that.extent_size[0];
        };
        if (PykCharts['boolean'](that.interactive_enable)) {
            that.k.dataFromPykQuery(pykquery_data);
            that.k.dataSourceFormatIdentification(that.data,that,"executeData");
        } else {
            that.k.dataSourceFormatIdentification(options.data,that,"executeData");
        }
    };
};

PykCharts.maps.mapFunctions = function (options,chartObject,type) {
    var that = chartObject,
        id = that.selector.substring(1,that.selector.length),
        container_id = id + "_svg";

    this.render = function () {
        that.border = new PykCharts.Configuration.border(that);
        that.mouseEvent = new PykCharts.Configuration.mouseEvent(that);
        that.k.title()
            .backgroundColor(that)

        if(type === "oneLayer") {
            that.k
            .export(that,"#"+container_id,type)
            .emptyDiv()
            .subtitle()
            .exportSVG(that,"#"+container_id,type)
        }
        that.current_palette = that.k.__proto__._where(that.color_palette_data, {name:that.palette_color, number:that.total_no_of_colors})[0];
        if (type === "timeline"){
             that.k.subtitle();
        }

        that.optionalFeatures()
            .svgContainer(container_id)
            .legendsContainer(that.legends_enable)
            .legends(that.legends_enable)
            .createMap()
            .label(that.label_enable)
            .enableClick(that.click_enable);

        that.redeced_height = that.chart_height - that.margin_top - that.margin_bottom;

        that.k
            .createFooter()
            .lastUpdatedAt()
            .credits()
            .dataSource();

        if(type === "timeline") {
            that.optionalFeatures()
                .axisContainer(true);
            that.renderDataForTimescale();
            that.backgroundColor();
            that.renderButtons();
            that.renderTimeline();
        }
        var resize = that.k.resize(that.svgContainer);
        that.k.__proto__._ready(resize);
        window.addEventListener('resize', function(event){
            return that.k.resize(that.svgContainer);
        });
    };

    that.refresh = function (pykquery_data) {
        that.executeRefresh = function (data) {
            that.data = data;
            that.data_length = that.data.length;
            that.refresh_data = data;
            var compare = that.k.checkChangeInData(that.refresh_data,that.compare_data);
            that.compare_data = compare[0];
            var data_changed = compare[1];
            if(data_changed) {
                that.k.lastUpdatedAt("liveData");
            }
            that.extent_size = d3.extent(that.data, function (d) { return parseInt(d.size, 10); });
            that.difference = that.extent_size[1] - that.extent_size[0];
            that.optionalFeatures()
                .legends(that.legends_enable)
                .createMap();
        }
        if(type === "oneLayer") {
            if (PykCharts['boolean'](that.interactive_enable)) {
                that.k.dataFromPykQuery(pykquery_data);
                that.k.dataSourceFormatIdentification(that.data,that,"executeRefresh");
            } else {
                that.k.dataSourceFormatIdentification(options.data,that,"executeRefresh");
            }
        }
    };

    that.optionalFeatures = function () {
        var id = that.selector.substring(1,that.selector.length);
        var config = {
            legends: function (el) {
                if (PykCharts['boolean'](el)) {
                    that.renderLegend();
                };
                return this;
            },
            legendsContainer : function (el) {
                if (PykCharts['boolean'](el) && that.color_mode === "saturation") {
                    that.legendsContainer = that.svgContainer
                        .append("g")
                        .attr("id", "legend-container");
                } else {
                    that.legendsGroup_height = 0;
                    that.legendsGroup_width = 0;
                }
                return this;
            },
            label: function (el) {
                if (PykCharts['boolean'](el)) {
                    that.renderLabel();
                };
                return this;
            },
            svgContainer : function (container_id) {
                document.getElementById(id).style.width = "100%";

                that.svgContainer = d3.select(that.selector)
                    .append("svg")
                    .attr({
                        "width": that.chart_width,
                        "height": that.chart_height,
                        "id": container_id,
                        "class": 'PykCharts-map',
                        "preserveAspectRatio": "xMinYMin",
                        "viewBox": "0 0 " + that.chart_width + " " + that.chart_height
                    });

                that.map_cont = that.svgContainer.append("g")
                    .attr("id", "map_group")

                var defs = that.map_cont.append('defs');
                var filter = defs.append('filter')
                    .attr('id', 'dropshadow');

                filter.append('feGaussianBlur')
                    .attr({
                        'in': 'SourceAlpha',
                        'stdDeviation': 1,
                        'result': 'blur'
                    });

                filter.append('feOffset')
                    .attr({
                        'in': 'blur',
                        'dx': 1,
                        'dy': 1,
                        'result': 'offsetBlur'
                    });

                var feMerge = filter.append('feMerge');

                feMerge.append('feMergeNode')
                    .attr('in", "offsetBlur');

                feMerge.append('feMergeNode')
                    .attr('in', 'SourceGraphic');
                return this;
            },
            createMap : function () {

                var new_width =  that.chart_width - that.legendsGroup_width;
                var new_height = that.chart_height - that.legendsGroup_height - that.margin_bottom -that.margin_top - 10;
                var scale = 150
                , offset = [new_width / 2, new_height / 2]
                , i;

                document.getElementById(id).style.backgroundColor = that.background_color;

                that.group = that.map_cont.selectAll(".map_group")
                    .data(topojson.feature(that.map_data, that.map_data.objects).features)

                that.group.enter()
                    .append("g")
                    .attr("class","map_group")
                    .append("path");

                if (that.map_code==="world" || that.map_code==="world_with_antarctica") {
                    var center = [0,0];
                } else {
                    var center = d3.geo.centroid(topojson.feature(that.map_data, that.map_data.objects));
                }
                var projection = d3.geo.mercator().center(center).scale(scale).translate(offset);

                that.path = d3.geo.path().projection(projection);

                var bounds = that.path.bounds(topojson.feature(that.map_data, that.map_data.objects)),
                    hscale = scale * (new_width) / (bounds[1][0] - bounds[0][0]),
                    vscale = scale * (new_height) / (bounds[1][1] - bounds[0][1]),
                    scale = (hscale < vscale) ? hscale : vscale,
                    offset = [new_width - (bounds[0][0] + bounds[1][0]) / 2, new_height - (bounds[0][1] + bounds[1][1]) / 2];
                projection = d3.geo.mercator().center(center)
                   .scale((that.default_zoom_level / 100) * scale).translate(offset);

                that.path = that.path.projection(projection);
                var ttp = d3.select("#pyk-tooltip");

                that.chart_data = that.group.select("path")
                    .attr({
                        "d": that.path,
                        "class": "area",
                        "iso2": function (d) {
                            return d.properties.iso_a2;
                        },
                        "area_name": function (d) {
                            return d.properties.NAME_1;
                        },
                        "fill": that.renderColor,
                        "prev_fill": function (d) {
                            return d3.select(this).attr("fill");
                        },
                        "fill-opacity": that.renderOpacity,
                        "data-fill-opacity": function () {
                            return d3.select(this).attr("fill-opacity");
                        },
                        "data-id" : function (d,i) {
                            return d.properties.iso_a2;
                        }
                    })
                    .style({
                        "stroke": that.border.color(),
                        "stroke-width": that.border.width(),
                        "stroke-dasharray": that.border.style()
                    })
                    .on({
                        "mouseover": function (d) {
                            var tooltip_data_found = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0];
                            if (tooltip_data_found) {
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    var tooltip_text = ((that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0]).tooltip) ? ((that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0]).tooltip) : ("<table><thead><th colspan='2'><b>"+d.properties.NAME_1+"</b></th></thead><tr><td>"+((that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0]).tooltip_column_name || "Size")+"</td><td><b>"+(PykCharts.numberFormat((that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0]).size))+"</b></td></tr></table>");

                                    ttp.style("display", "block");
                                    ttp.html(tooltip_text);
                                    if (that.tooltip_mode === "moving") {
                                        ttp.style("top", function () {
                                                return (PykCharts.getEvent().pageY - 20 ) + "px";
                                            })
                                            .style("left", function () {
                                                return (PykCharts.getEvent().pageX + 20 ) + "px";
                                            });
                                    } else if (that.tooltip_mode === "fixed") {
                                        ttp.style("top", (that.tooltip_position_top) + "px")
                                            .style("left", (that.tooltip_position_left) + "px");
                                    }
                                }

                                if (that.enable_custom_hover) {
                                    d3.select(this).style("fill", (that.active_color || "red"));

                                } else {
                                    // debugger;
                                    if(that.onhover1 === "color_saturation" && PykCharts['boolean'](that.chart_onhover_highlight_enable)) {
                                        that.mouseEvent.highlight(that.selector + " .area", this);
                                    }else {
                                        that.bodColor(d);
                                    }

                                }
                            }
                        },
                        "mouseout": function (d) {
                            if (that.enable_custom_hover) {
                                d3.select(this).style("fill", d3.select(this).attr("prev_fill"));
                                ttp.style("display", "none");
                            }else {
                                if (PykCharts['boolean'](that.tooltip_enable)) {
                                    ttp.style("display", "none");
                                }
                                that.bodUncolor(d);
                                that.mouseEvent.highlightHide(that.selector + " .area");
                            }

                        },
                        "click" : function (d, i) {
                            if (PykCharts['boolean'](that.click_enable)) {
                                var data = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0];
                                window.location.href = location.origin + data.url;
                                // that.addEvents(d.properties.iso_a2,d3.select(this).attr("data-id"));
                            }
                        }
                    });
                that.group.exit()
                    .remove();
                return this;

            },
            enableClick: function (ec) {
                if (PykCharts['boolean'](ec)) {
                    // that.chart_data.on("click", that.clicked);
                    that.onhover1 = that.chart_onhover_effect;
                } else {
                    that.onhover1 = that.chart_onhover_effect;
                }
                return this;
            },
            axisContainer : function (ae) {
                if(PykCharts['boolean'](ae)){
                    that.gxaxis = that.svgContainer.append("g")
                        .attr({
                            "id": "xaxis",
                            "class": "x axis",
                            "transform": "translate("+(that.margin_left*2)+"," + that.redeced_height + ")"
                        });
                }
                return this;
            }
        }
        return config;
    };


    that.renderColor = function (d, i) {
        if (!PykCharts['boolean'](d)) {
            return false;
        }
        // if(that.enable_custom_hover){
        //     return that.inactive_color;
        // }
        var col_shade,
            obj = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2});
        if (obj.length > 0) {
            if (that.color_mode === "color") {
                if(that.chart_color[0]) {
                    return that.chart_color[0];
                } else if (obj.length > 0 && PykCharts['boolean'](obj[0].color)) {
                    return obj[0].color;
                }
                return that.default_color[0];
            }
            if (that.color_mode === "saturation") {
                if (that.highlight === that.map_data.objects.geometries[i].properties.iso_a2/*obj[0].highlight === true*/) {
                    return that.highlight_color;
                } else {
                    if(that.saturation_color !== "") {
                        return that.saturation_color;
                    } else if (that.palette_color !== "") {
                        col_shade = obj[0].size;
                        for (i = 0; i < that.current_palette.colors.length; i++) {
                            if (col_shade >= that.extent_size[0] + i * (that.difference / that.current_palette.colors.length) && col_shade <= that.extent_size[0] + (i + 1) * (that.difference / that.current_palette.colors.length)) {
                                if (that.data.length===1) {
                                    return that.current_palette.colors[that.current_palette.colors.length-1];
                                }
                                else{
                                    if(that.enable_custom_hover && that.inactive_color){
                                        return that.inactive_color;
                                    }
                                    return that.current_palette.colors[i];
                                }
                            }
                        }

                    }
                }
            }
            return that.default_color[0];
        }
        if(that.enable_custom_hover){
            return (that.no_data_color || that.default_color[0]);
        }
        return that.default_color[0];
    };

    that.renderOpacity = function (d) {

        var data_row = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0];

        if (typeof data_row !== 'undefined' && that.saturation_color !=="" && that.color_mode === "saturation") {
            that.oneninth = +(d3.format(".2f")(that.difference / that.total_no_of_colors));
            that.opacity = (parseInt(that.extent_size[0]) + parseInt((that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0]).size) + parseInt(that.oneninth)) / that.difference;
            return that.opacity;
        }
        return 1;
    };

    that.renderLegend = function () {
            var k,
            onetenth;
        if (that.color_mode === "saturation") {
            if(that.legends_display === "vertical" ) {
                var m = 0, n = 0;
                if(that.palette_color === "") {
                    that.legendsContainer.attr("height", (9 * 30)+20);
                    that.legendsGroup_height = 0;
                }
                else {
                    that.legendsContainer.attr("height", (that.current_palette.number * 30)+20);
                    that.legendsGroup_height = 0;
                }
                text_parameter1 = "x";
                text_parameter2 = "y";
                rect_parameter1 = "width";
                rect_parameter2 = "height";
                rect_parameter3 = "x";
                rect_parameter4 = "y";
                rect_parameter1value = 13;
                rect_parameter2value = 13;
                text_parameter1value = function (d,k) { return 38; };
                rect_parameter3value = function (d,k) { return 20; };
                var rect_parameter4value = function (d) {n++; return n * 24 + 12;};
                var text_parameter2value = function (d) {m++; return m * 24 + 23;};

            } else if(that.legends_display === "horizontal") {
                var j = 0, i = 0;
                if(that.palette_color === "") {
                    j = 9, i = 9;
                }
                else {
                    j = that.current_palette.number, i = that.current_palette.number;
                    that.legendsContainer.attr("height", (that.current_palette.number * 30)+20);
                    that.legendsGroup_height = (that.current_palette.number * 30)+20;
                }
                that.legendsContainer.attr("height", 50);
                that.legendsGroup_height = 50;
                final_rect_x = 0;
                final_text_x = 0;
                legend_text_widths = [];
                temp_text = temp_rect = 0;
                text_parameter1 = "x";
                text_parameter2 = "y";
                rect_parameter1 = "width";
                rect_parameter2 = "height";
                rect_parameter3 = "x";
                rect_parameter4 = "y";
                var text_parameter1value = function (d,i) {
                    legend_text_widths[i] = this.getBBox().width;
                    legend_start_x = 16;
                    final_text_x = (i === 0) ? legend_start_x : (legend_start_x + temp_text);
                    temp_text = temp_text + legend_text_widths[i] + 30;
                    return final_text_x;
                };
                text_parameter2value = 30;
                rect_parameter1value = 13;
                rect_parameter2value = 13;
                var rect_parameter3value = function (d,i) {
                    final_rect_x = (i === 0) ? 0 : temp_rect;
                    temp_rect = temp_rect + legend_text_widths[i] + 30;
                    return final_rect_x;
                };
                rect_parameter4value = 18;

            }
            if (that.saturation_color !== "") {
                var leg_data = [], onetenth;
                for(var i=1 ; i<=that.total_no_of_colors ; i++) { leg_data.push(i); }
                onetenth = d3.format(".1f")(that.extent_size[1] / that.total_no_of_colors);
                that.leg = function (d,i) { return "<" + d3.format(".2s")(d3.round(onetenth * (i+1))); };

                var legend = that.legendsContainer.selectAll(".rect")
                    .data(leg_data);

                that.legends_text = that.legendsContainer.selectAll(".text")
                    .data(leg_data);

                that.legends_text.enter()
                    .append("text");
                that.legends_text.attr("class","text")
                    .attr("pointer-events","none")
                    .text(that.leg)
                    .attr({
                        "fill": that.legends_text_color,
                        "font-family": that.legends_text_family,
                        "font-size": that.legends_text_size,
                        "font-weight": that.legends_text_weight,
                        "x": text_parameter1value,
                        "y": text_parameter2value
                    });

                legend.enter()
                    .append("rect")

                legend.attr("class","rect")
                    .attr({
                        "x": rect_parameter3value,
                        "y": rect_parameter4value,
                        "width": rect_parameter1value,
                        "height": rect_parameter2value,
                        "fill": that.saturation_color,
                        "fill-opacity": function(d,i) { return (i+1)/that.total_no_of_colors; }
                    });

                var legend_container_width = that.legendsContainer.node().getBBox().width, translate_x;

                    if(that.legends_display === "vertical") {
                        that.legendsGroup_width = legend_container_width + 20;
                    } else  {
                        that.legendsGroup_width = 0;
                    }
                    translate_x = (that.legends_display === "vertical") ? (that.chart_width - that.legendsGroup_width) : (that.chart_width - legend_container_width - 20);
                if (legend_container_width < that.chart_width) {
                    that.legendsContainer.attr("transform","translate("+(translate_x-20)+",10)");
                }
                that.legendsContainer.style("visibility","visible");

                that.legends_text.exit()
                    .remove();
                legend.exit()
                    .remove();

            } else {
                that.leg = function (d,i) { return  "<" + d3.round(that.extent_size[0] + (i+1) * (that.difference / that.current_palette.number)); };
                var legend = that.legendsContainer.selectAll(".rect")
                    .data(that.current_palette.colors);

                that.legends_text = that.legendsContainer.selectAll(".text")
                    .data(that.current_palette.colors);

                that.legends_text.enter()
                    .append("text");
                that.legends_text.attr("class","text")
                    .attr("pointer-events","none")
                    .text(that.leg)
                    .attr({
                        "fill": that.legends_text_color,
                        "font-family": that.legends_text_family,
                        "font-size": that.legends_text_size,
                        "font-weight": that.legends_text_weight,
                        "x": text_parameter1value,
                        "y":text_parameter2value
                    });

                legend.enter()
                    .append("rect");
                legend.attr({
                    "class": "rect",
                    "width": rect_parameter1value,
                    "height": rect_parameter2value,
                    "fill": function (d) { return d; },
                    "x": rect_parameter3value,
                    "y": rect_parameter4value
                });

                var legend_container_width = that.legendsContainer.node().getBBox().width,translate_x;

                    if(that.legends_display === "vertical") {
                        that.legendsGroup_width = legend_container_width + 20;
                    } else  {
                        that.legendsGroup_width = 0;
                    }
                    translate_x = (that.legends_display === "vertical") ? (that.chart_width - that.legendsGroup_width) : (that.chart_width - legend_container_width - 20);
                if (legend_container_width < that.chart_width) { that.legendsContainer.attr("transform","translate("+translate_x+",10)"); }
                that.legendsContainer.style("visibility","visible");

                that.legends_text.exit()
                    .remove();
                legend.exit()
                    .remove();
            }
        } else {
            var c = document.getElementById("legend-container");
            if(c) {
                c.parentNode.removeChild(c);
            }
        }
    };

    that.renderLabel = function () {
        that.group.append("text")
            .attr({
                "x": function (d) { return that.path.centroid(d)[0]; },
                "y": function (d) { return that.path.centroid(d)[1]; },
                "text-anchor": "middle",
                "font-size": "10px",
                "fill": that.label_color,
                "pointer-events": "none"
            })
            .text(function (d) { return d.properties.NAME_1.replace("&#39;","'"); });
    };

    that.bodColor = function (d) {
        var obj = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2});
        if(PykCharts['boolean'](that.chart_onhover_highlight_enable)) {

            if (that.onhover1 === "highlight_border") {
                d3.select("path[area_name='" + d.properties.NAME_1 + "']")
                    .style({
                        "stroke": that.border.color(),
                        "stroke-width": parseFloat(that.border.width()) + 1.5 + "px",
                        "stroke-dasharray": that.border.style()
                    });
            } else if (that.onhover1 === "shadow") {
                d3.select("path[area_name='" + d.properties.NAME_1 + "']")
                    .attr({
                        'filter': 'url(#dropshadow)',
                        "fill-opacity": function () {
                            if (that.palette_color === "" && that.color_mode === "saturation") {
                                that.oneninth_dim = +(d3.format(".2f")(that.difference / that.total_no_of_colors));
                                that.opacity_dim = (that.extent_size[0] + (obj[0]).size + that.oneninth_dim) / that.difference;
                                return that.opacity_dim/2;
                            }
                            return 0.5;
                        }
                    });
            }
        } else {
            that.bodUncolor(d);
        }
    };
    that.bodUncolor = function (d) {
        d3.select("path[area_name='" + d.properties.NAME_1 + "']")
            .style({
                "stroke": that.border.color(),
                "stroke-width": that.border.width(),
                "stroke-dasharray": that.border.style()
            })
            .attr({
                'filter': null,
                "fill-opacity": function () {
                    var data_row = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0];
                    if (typeof data_row !== 'undefined' && that.saturation_color !== "" && that.color_mode === "saturation") {
                        that.oneninth_high = +(d3.format(".2f")(that.difference / that.total_no_of_colors));
                        that.opacity_high = (parseInt(that.extent_size[0]) + parseInt(data_row.size) + parseInt(that.oneninth_high)) / that.difference;
                        return that.opacity_high;
                    }
                    return 1;
                }
            });
    };

    this.clicked = function (d) {
        var obj = {};
        obj.container = PykCharts.getEvent().target.ownerSVGElement.parentNode.id;
        obj.area = d.properties;
        obj.data = that.k.__proto__._where(that.data, {iso2: d.properties.iso_a2})[0];
        try {
            customFunction(obj);
        } catch (ignore) {
            /**/
        }
    };

    that.backgroundColor =function () {
        var bg,child1;
        bgColor(that.selector);

        function bgColor(child) {
            child1 = child;
            bg  = d3.select(child).style("background-color");
            if (bg === "transparent" || bg === "rgba(0, 0, 0, 0)") {
                if(d3.select(child)[0][0].parentNode.tagName === undefined || d3.select(child)[0][0].parentNode.tagName.toLowerCase() === "body") {
                    that.k.__proto__._colourBrightness("rgb(255,255,255)",d3.select(child)[0]);
                } else {
                    return bgColor(d3.select(child)[0][0].parentNode);
                }
            } else {
                return that.k.__proto__._colourBrightness(bg,d3.selectAll(child)[0]);
            }
        }

        if (d3.select(child1)[0][0].classList.contains("light") || window.location.pathname === "/overview") {
            that.play_image_url = PykCharts.assets+"img/play.png";
            that.pause_image_url = PykCharts.assets+"img/pause.png";
            that.marker_image_url = PykCharts.assets+"img/marker.png";
        } else {
            that.play_image_url = PykCharts.assets+"img/play-light.png";
            that.pause_image_url = PykCharts.assets+"img/pause-light.png";
            that.marker_image_url = PykCharts.assets+"img/marker-light.png";
        }

    }

    that.renderDataForTimescale = function () {
        that.unique = [];
        x_extent = d3.extent(that.timeline_data, function(d) {return d.timestamp; });
        x_range = [0 ,that.redeced_width];
        that.xScale = that.k.scaleIdentification("linear",x_extent,x_range);
        var timeline_data_length = that.timeline_data.length;
        for (var i=0 ; i<timeline_data_length ; i++) {
            if (that.unique.indexOf(that.timeline_data[i].timestamp) === -1) {
                that.unique.push(that.timeline_data[i].timestamp);
            }
        }
        that.unique.sort(function (a,b) {
          return a - b;
        });
        that.k.xAxis(that.svgContainer,that.gxaxis,that.xScale);
        if(that.gxaxis) {
            that.gxaxis.attr("transform", "translate("+(that.margin_left*2)+"," + that.redeced_height + ")");
        }

    }
    that.renderTimeline = function () {
        var x_extent
        , x_range
        , duration
        , interval = interval1 = that.interval_index = 1;

        that.play.on("click", function () {
            startTimeline();
        });

        that.timeline_status = "";

        var startTimeline = function () {
            if (that.timeline_status==="playing") {
                that.play.attr("xlink:href",that.play_image_url);
                that.timeline_status = "paused";
                that.interval_index = interval;
                clearInterval(that.play_interval);
            } else {
                that.timeline_status = "playing";
                that.play.attr("xlink:href",that.pause_image_url);
                interval = that.interval_index;
                var startInterval = function () {
                    if (interval===that.unique.length) {
                        interval = 0;
                    }

                    that.marker
                        .attr("x",  (that.margin_left*2) + that.xScale(that.unique[interval]) - 7);

                    that.data = that.k.__proto__._where(that.timeline_data, {timestamp:that.unique[interval]});
                    that.data_length = that.data.length;
                    that.data.sort(function (a,b) {
                        return a.timestamp - b.timestamp;
                    });
                    that.extent_size = d3.extent(that.data, function (d) { return parseInt(d.size, 10); });
                    that.difference = that.extent_size[1] - that.extent_size[0];
                    for (var i=0 ; i<that.data_length ; i++) {
                        d3.select(that.selector+" path[iso2='"+that.data[i].iso2+"']")
                            .attr({
                                "fill": that.renderColor,
                                "fill-opacity": that.renderOpacity,
                                "data-fill-opacity": function () {
                                    return d3.select(this).attr("fill-opacity");
                                }
                            });
                    }
                    interval++;
                }
                that.play_interval = setInterval(function () {
                    startInterval();
                    if (interval===1) {
                        that.play.attr("xlink:href",that.play_image_url);
                        that.interval_index = 1;
                        that.timeline_status = "";
                        clearInterval(that.play_interval);
                    };
                }, that.timeline_duration);
                startInterval();
            }
        }
    };

    that.renderButtons = function () {
        var bbox = d3.select(that.selector+" .axis").node().getBBox();
            drag = d3.behavior.drag()
                    .origin(Object)
                    .on("drag",dragmove)
                    .on("dragend", function () {
                        document.getElementsByTagName('body')[0].style.cursor = "default";
                    });
        function dragmove (d) {
            document.getElementsByTagName('body')[0].style.cursor = "pointer";
            if (that.timeline_status !== "playing") {
                var x = PykCharts.getEvent().sourceEvent.pageX - (that.margin_left),
                    x_range = [],
                    temp = that.xScale.range(),
                    len = that.unique.length,
                    pad = (temp[1]-temp[0])/len,
                    strt = 0, left_tick, right_tick, left_diff, right_diff;

                for(var j=0 ; j<len ; j++){
                    strt = strt + pad;
                    x_range[j] = parseInt(strt);
                }

                for(var i=0 ; i<len ; i++) {
                    if (x >= x_range[i] && x <= x_range[i+1]) {
                        left_tick = x_range[i], right_tick = x_range[i+1],
                        left_diff = (x - left_tick), right_diff = (right_tick - x);

                        if ((left_diff >= right_diff) && (i <= (len-2))) {
                            that.marker.attr("x", (that.margin_left*2) + that.xScale(that.unique[i]) - 7);
                            that.data = that.k.__proto__._where(that.timeline_data, {timestamp:that.unique[i]});
                            that.data_length = that.data.length;
                            that.data.sort(function (a,b) {
                                return a.timestamp - b.timestamp;
                            });
                            that.extent_size = d3.extent(that.data, function (d) { return parseInt(d.size, 10); });
                            that.difference = that.extent_size[1] - that.extent_size[0];
                            for (var k=0 ; k<that.data_length ; k++) {
                                d3.select(that.selector+" path[iso2='"+that.data[k].iso2+"']")
                                    .attr({
                                        "fill": that.renderColor,
                                        "fill-opacity": that.renderOpacity,
                                        "data-fill-opacity": function () {
                                            return d3.select(this).attr("fill-opacity");
                                        }
                                    });
                            }
                            that.interval_index = i;
                        }
                    }
                    else if ((x > x_range[i]) && (i > (len-2))) {
                            that.marker.attr("x", (that.margin_left*2) + that.xScale(that.unique[i]) - 7);
                            that.data = that.k.__proto__._where(that.timeline_data, {timestamp:that.unique[i]});
                            that.data_length = that.data.length;
                            that.data.sort(function (a,b) {
                                return a.timestamp - b.timestamp;
                            });
                            that.extent_size = d3.extent(that.data, function (d) { return parseInt(d.size, 10); });
                            that.difference = that.extent_size[1] - that.extent_size[0];
                            for (var k=0 ; k<that.data_length ; k++) {
                                d3.select(that.selector+" path[iso2='"+that.data[k].iso2+"']")
                                    .attr({
                                        "fill": that.renderColor,
                                        "fill-opacity": that.renderOpacity,
                                        "data-fill-opacity": function () {
                                            return d3.select(this).attr("fill-opacity");
                                        }
                                    });
                            }
                            that.interval_index = i;
                    }
                }
            }
        }

        that.play = that.svgContainer.append("image")
            .attr({
                "xlink:href": that.play_image_url,
                "x": that.margin_left / 2,
                "y": that.redeced_height - that.margin_top - (bbox.height/2),
                "width": "24px",
                "height": "21px"
            })
            .style("cursor","pointer");

        that.marker = that.svgContainer.append("image")
            .attr({
                "xlink:href": that.marker_image_url,
                "x": (that.margin_left*2) + that.xScale(that.unique[0]) - 7,
                "y": that.redeced_height,
                "width": "14px",
                "height": "12px"
            })
            .style("cursor","pointer")
            .call(drag);
    }
};

var anonymousFunc = function () {

    var urls = [
      PykCharts.assets+'lib/d3.min.js'
    , PykCharts.assets+'lib/topojson.min.js'
    , PykCharts.assets+'lib/custom-hive.min.js'
    , PykCharts.assets+'lib/colors.min.js'
    ];

    function importFiles (url) {
        var include = document.createElement('script');
        include.type = 'text/javascript';
        include.async = false;
        include.onload = function () {
            try {
                PykCharts.numberFormat = d3.format(",");
                if (d3 && d3.customHive && topojson && $c && paper) {
                    window.PykChartsInit();
                    document.querySelector("body").onclick = function () {
                        if (PykCharts.export_menu_status === 0) {
                            d3.selectAll(".dropdown-multipleConatiner-export").style("visibility","hidden");
                        }
                        PykCharts.export_menu_status = 0;
                    };
                };
            }
            catch (e) {

            }
        }
        include.src = url;
        var s = document.getElementsByTagName('link')[0];
        s.parentNode.insertBefore(include, s);
    };

    try {
        if(!d3) {
            importFiles(urls[0]);
        }
    } catch (e) {
        importFiles(urls[0])
    }
    try {
        if(!d3.customHive) {
            importFiles(urls[1]);
        }
    } catch (e) {
        importFiles(urls[1]);
    }
    try {
        if(!topojson) {
            importFiles(urls[2]);
        }
    } catch (e) {
        importFiles(urls[2]);
    }
    try {
        if(!$c) {
            importFiles(urls[3]);
        }
    } catch (e) {
        importFiles(urls[3]);
    }
};

window.onload = anonymousFunc();
// This is a manifest file that'll be compiled into application.js, which will include all the files
// listed below.
//
// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,
// or vendor/assets/javascripts of plugins, if any, can be referenced here using a relative path.
//
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// compiled file.
//
// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details
// about supported directives.
//






  $(function () {
    $('[data-toggle="popover"]').popover()
  })

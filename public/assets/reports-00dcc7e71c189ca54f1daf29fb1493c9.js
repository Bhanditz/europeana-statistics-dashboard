Rumali.categorizeColumns=function(){var e,t=[],n=[],o="#A2DED0",r="#C5EFF7",i=[];traverse_of_alias={};var s=function(e){var t={};t.token=gon.token,$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"column/dimensions_and_metrics",type:"GET",data:t,dataType:"json",success:function(n){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"column/all_columns?data_types=true&original_names=true&token="+gon.token,type:"GET",data:t,dataType:"json",success:function(t){self.datatype_column=t.columns.column_types,Rumali.original_column_names=t.columns.original_column_names,e(n,t)}})}})},a=function(){$(".categorize_columns-draggable").draggable({addClasses:!1,appendTo:"body",revert:"invalid",helper:"clone",zIndex:100,start:function(e,t){var n=$(e.target);t.helper.width(n.width()),t.helper.addClass("drag-helper"),$(".ui-droppable").addClass("drop-here")},stop:function(){$(".ui-droppable").removeClass("drop-here")}})},l=function(e){var o=!1,r="";"metrics"===e?(t.length>0&&(o=!0),r=".metrics-reset"):"dimensions"===e&&(n.length>0&&(o=!0),r=".dimensions-reset"),o?$(r).show():$(r).hide()};jQuery.fn.highlight=function(){$(this).each(function(){var e=$(this);e.before("<div/>"),e.prev().width(e.width()).height(e.height()).css({position:"absolute","background-color":"#ffff99",opacity:".9"}).fadeOut(1e3)})};var c=function(){n.length>0||t.length>0?($("#reset_all").show(),$("#first_time_load").hide(),showHintForChartEligibility()):($("#reset_all").hide(),$("#dimension_metrics_container").highlight(),$("#first_time_load").show())},u=function(e){"block"===$("#chart_show").css("display")&&($(".is_selected_chart").removeClass("is_selected_chart"),$("#chart_show").hide());var s,u,d,h,f=$(this.parentNode.parentNode),m=$(f[0]).data("coltype"),g=$(f[0]).data("colname"),v=$(f[0]).data("datatype"),w=$(f[0]).data("aggregation"),y=n.indexOf(g),C={},b=Rumali.original_column_names[g];if(y>-1?(n.splice(y,1),table_show.removeDimensions([g]),l("dimensions")):void 0!==table_show.metrics[g]&&(t.splice(t.indexOf(g),1),table_show.removeMetrics([g]),l("metrics")),"dimensions"===m)s="#ref_dimensions_list",u=o;else if("metrics"===m){if("string"==typeof w)index_to_remove=i.indexOf(b+"_"+w),index_to_remove>=0&&i.splice(index_to_remove,1);else for(col_aggregations_length=w.length,h=0;h<=col_aggregations_length;h++)index_to_remove=i.indexOf(b+"_"+w[h]),index_to_remove>=0&&i.splice(index_to_remove,1);s="#ref_metrics_list",u=r}p(e,g),table_show.executeOnFilter=function(){C=table_show.flushToGet().data,d=d3.csv.parse(C),refreshTableData(d),appendAliasToColumnHeader(user_entered_column_names),enableCharts(C,n,i),$(s).append("<li class='categorize_columns-draggable' data-datatype='"+v+"' data-colname='"+g+"' data-coltype='"+m+"' style='background:"+u+"'>"+b+"</li>"),f.remove(),a(),c()},table_show.dimensions.length>0||!$.isEmptyObject(table_show.metrics)?($("#table_show").show(),table_show.call()):($("#table_show").hide(),d=[{"":""}],refreshTableData(d),appendAliasToColumnHeader(user_entered_column_names),enableCharts(C,n,i),$(s).append("<li class='categorize_columns-draggable' data-datatype='"+v+"' data-colname='"+g+"' data-coltype='"+m+"' style='background:"+u+"'>"+b+"</li>"),f.remove(),a(),c())},d=function(t){var n=$(this.parentNode.parentNode),o=n.data("aggregation");e=n.data("colname"),$("#select_metrics").select2("val",o),$("#aggregation_selection_list").show().css({top:t.clientY-$("#aggregation_selection_list")[0].getBoundingClientRect().height-15,left:t.clientX})},h=function(t,o){var r,s={},a=t.val(),l=Rumali.original_column_names[e];$("#Metrics .query-list[data-colname='"+e+"']").attr("data-aggregation",a).data("aggregation",a),$("#Metrics .query-list[data-colname='"+e+"'] .list-of-metrics").html(a.join(", ")+" - ");for(var c=a.length,u=0;c>u;u++)s[a[u]]=l+"_"+a[u],traverse_of_alias[l+"_"+a[u]]=[a[u],e];table_show.metrics[e]=a,table_show.alias[e]=s,column_name_alias=JSON.parse(JSON.stringify(table_show.alias)),o.added?(l+="_"+o.added.id,Rumali.original_column_names[l]=l,i.push(l),f(l,l,e,"metrics")):o.removed&&(l+="_"+o.removed.id,r=i.indexOf(l),r>=0&&i.splice(r,1),p(event,l)),table_show.executeOnFilter=function(){var e=table_show.flushToGet().data;refreshTableData(d3.csv.parse(e)),appendAliasToColumnHeader(user_entered_column_names),enableCharts(e,n,i),$("#show_grid_and_hide_the_chart").trigger("click"),$("#select_metrics").select2("close")},table_show.call()},f=function(e,t,n,o){var r=document.getElementById("sort_by_column"),i=r.options[r.options.length]=new Option(e,t);i.setAttribute("data-col_name",n),i.setAttribute("data-col_type",o)};Rumali.refreshChartAfterFilter=function(){var e=table_show.flushToGet().data;refreshTableData(d3.csv.parse(e)),appendAliasToColumnHeader(user_entered_column_names),enableCharts(e,n,i),$(".is_selected_chart").trigger("click")};var p=function(e,t,o){var r=$("#sort_by_column").val();o?$("#sort_by_column option[data-col_type='"+o+"']").remove():($("#sort_by_column option[data-col_name='"+t+"']").remove(),$("#sort_by_column option[value='"+t+"']").remove()),-1===n.indexOf(r)&&-1===i.indexOf(r)&&($("#sort_by_column").val(""),table_show.sort.shift()),e.stopPropagation()},m=function(e){var t=$("#sort_by_column").val();if(t){$(e).data("sort")&&($("#Sort .btn").removeClass("active"),$(e).addClass("active"));var o,r={};r[$("#sort_by_column").val()]=$("#Sort .active").data("sort"),table_show.sort[0]=r}else table_show.sort[0]={};table_show.executeOnFilter=function(){o=table_show.flushToGet().data,refreshTableData(d3.csv.parse(o)),appendAliasToColumnHeader(user_entered_column_names),enableCharts(o,n,i),$("#show_grid_and_hide_the_chart").trigger("click")},table_show.call()},g=function(e){table_show.executeOnFilter=function(){t=table_show.flushToGet().data,refreshTableData(d3.csv.parse(t)),enableCharts(t,n,i),$(".is_selected_chart").length>0?$(".is_selected_chart.enabled").trigger("click"):$("#show_grid_and_hide_the_chart").trigger("click")};var t,o=$(e).val();table_show.limit=o&&o>0?o:200,table_show.call()},v=function(){$(".categorize_columns-droppable").droppable({activeClass:"ui-state-hover",hoverClass:"ui-state-active",accept:":not(.ui-sortable-helper)",drop:function(e,s){"data_container"===this.id&&("none"===$("#table_show").css("display")&&$("#table_show").show(),"block"===$("#chart_show").css("display")&&($(".is_selected_chart").removeClass("is_selected_chart"),$("#chart_show").hide())),s.draggable.appendTo(this);var a,u=s.draggable[0].parentNode.id,d=$(s.draggable[0]).data("colname"),h=$(s.draggable[0]).data("datatype"),p="",m=Rumali.original_column_names[d],g="";if("ref_dimensions_list"===u)p="dimensions",g=o;else if("ref_metrics_list"===u)p="metrics",g=r;else{var v;if(s.draggable.remove(),u=$(s.draggable[0]).data("coltype"),"metrics"===u){var w,y,C={},b={},T={};"integer"===h||"double"===h?(w="sum",y="<span class='glyphicon glyphicon-chevron-down show-aggregation-list'></span>"):(w="count",y=""),C[d]=[w],m+="_"+w,a=m,Rumali.original_column_names[m]=m,T[w]=m,b[d]=T,table_show.metrics=C,user_entered_column_names[d]=d+"_"+w,table_show.alias=b,column_name_alias=JSON.parse(JSON.stringify(table_show.alias)),traverse_of_alias[m]=[w,d],t.push(d),i.push(m),$("<li class='query-list' data-colname='"+d+"' data-datatype='"+h+"' data-aggregation="+[w]+" data-coltype='metrics' style='background:"+r+"'><div class='dropdown'><span class='alias'></span><span class='list-of-metrics'>"+w+" - </span>"+s.draggable.text()+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+y+"<span class='glyphicon glyphicon-remove-circle remove-from-query'></span></div></li>").appendTo($(this).find("#Metrics")),l("metrics"),v=document.getElementById("Metrics")}else"dimensions"===u&&(table_show.dimensions=[d],n.push(d),$("<li class='query-list' data-colname='"+d+"' data-datatype='"+h+"' data-coltype='dimensions' style='background:"+o+"'><div class='dropdown'><span class='alias'></span>"+s.draggable.text()+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='glyphicon glyphicon-remove-circle remove-from-query'></span></div></li>").appendTo($(this).find("#Dimensions")),l("dimensions"),v=document.getElementById("Dimensions"),a=d);v.scrollLeft=v.scrollWidth,c(),f(m,a,d,u),table_show.executeOnFilter=function(){var e=table_show.flushToGet().data;refreshTableData(d3.csv.parse(e)),appendAliasToColumnHeader(user_entered_column_names),enableCharts(e,n,i)},table_show.call()}s.draggable.attr("data-coltype",p).css("background",g),("ref_dimensions_list"==this.id||"ref_metrics_list"==this.id)&&R(e)}}).sortable({item:"li",sort:function(){$(this).removeClass("ui-state-default")}}),$(".query-droppable").sortable({disabled:!0})},w=function(e){"block"===$("#chart_show").css("display")&&($(".is_selected_chart").removeClass("is_selected_chart"),$("#chart_show").hide());for(var t=$("#Dimensions .query-list"),r=t.length,s="",u={},d=0;r>d;d++){var h=$($(t[d])[0]).data("colname"),f=Rumali.original_column_names[h],m=$($(t[d])[0]).data("datatype");s+="<li class='categorize_columns-draggable' data-datatype='"+m+"' data-colname='"+h+"' data-coltype='dimensions' style='background:"+o+"'>"+f+"</li>"}for($("#ref_dimensions_list").append(s),$("#Dimensions .query-list").remove(),table_show.resetDimensions();n.length>0;)n.pop();p(e,"","dimensions"),table_show.executeOnFilter=function(){u=table_show.flushToGet().data,json_table_data=d3.csv.parse(u),refreshTableData(json_table_data),appendAliasToColumnHeader(user_entered_column_names),enableCharts(u,n,i),a(),l("dimensions"),c()},$.isEmptyObject(table_show.metrics)?($("#table_show").hide(),json_table_data=[{"":""}],refreshTableData(json_table_data),appendAliasToColumnHeader(user_entered_column_names),enableCharts(u,n,i),a(),l("dimensions"),c()):($("#table_show").show(),table_show.call())},y=function(e){"block"===$("#chart_show").css("display")&&($(".is_selected_chart").removeClass("is_selected_chart"),$("#chart_show").hide());for(var o=$("#Metrics .query-list").length,s=$("#Metrics .query-list"),u="",d={},h=0;o>h;h++){var f=$($(s[h])[0]).data("colname"),m=Rumali.original_column_names[f],g=$($(s[h])[0]).data("datatype");u+="<li class='categorize_columns-draggable' data-datatype='"+g+"' data-colname='"+f+"' data-coltype='metrics' style='background:"+r+"'>"+m+"</li>"}for($("#ref_metrics_list").append(u),$("#Metrics .query-list").remove(),table_show.resetMetrics();t.length>0;)t.pop();for(;i.length>0;)i.pop();p(e,"","metrics"),table_show.executeOnFilter=function(){d=table_show.flushToGet().data,json_table_data=d3.csv.parse(d),refreshTableData(json_table_data),appendAliasToColumnHeader(user_entered_column_names),enableCharts(d,n,t),a(),l("metrics"),c()},table_show.dimensions.length>0?($("#table_show").show(),table_show.call()):($("#table_show").hide(),json_table_data=[{"":""}],refreshTableData(json_table_data),appendAliasToColumnHeader(user_entered_column_names),enableCharts(d,n,t),a(),l("metrics"),c())},C=function(){a(),v(),$("body").is("#scopejs_vizs_new")&&($(".query-ul").unbind("click"),$(".query-ul").on("click",".remove-from-query",u),$(".dimensions-reset").unbind("click"),$(".dimensions-reset").on("click",w),$(".metrics-reset").unbind("click"),$(".metrics-reset").on("click",y),$("#select_metrics").unbind("change"),$(".query-ul").on("click",".show-aggregation-list",d),$(".close-aggregation-list").click(function(){$("#aggregation_selection_list").hide()}),$("body").click(function(e){$(e.target).hasClass("show-aggregation-list")||$(e.target).is("#select2-drop")||$("#aggregation_selection_list").hide()}),$("#select_metrics").select2({width:200,closeOnSelect:!1,dropdownCss:{"z-index":10001}}),$("#select_metrics").on("change",function(e){h($(this),e)}).on("select2-removing",function(e){1===$(this).val().length&&(console.warn("Cannot remove all the aggregation functions from a metric"),e.preventDefault())}),$("#Sort .btn").click(function(){m(this)}),$("#sort_by_column").change(function(){m(this)}),$("#limit_rows").blur(function(){g(this)}))},b=function(e,t){for(var n=e.dimensions,i=e.metrics,s="",a=n.length,l=i.length,c=0;a>c;c++)s+="<li class='categorize_columns-draggable' data-datatype='"+t.columns.column_types[n[c]]+"' data-colname='"+n[c]+"' data-coltype='dimensions' style='background:"+o+"'>"+t.columns.original_column_names[n[c]]+"</li>";s+="</ul>",$("#ref_dimensions_list").html(s),s="";for(var c=0;l>c;c++)s+="<li class='categorize_columns-draggable' data-datatype='"+t.columns.column_types[i[c]]+"' data-colname='"+i[c]+"' data-coltype='metrics' style='background:"+r+"'>"+t.columns.original_column_names[i[c]]+"</li>";s+="</ul>",$("#ref_metrics_list").html(s),C();var u=$("#table_header").handsontable("getInstance");void 0!=u&&u.updateSettings({data:Rumali.original_column_names})},R=function(e){var t=$(e.originalEvent.target).data("colname"),n=$(e.originalEvent.target).data("coltype").slice(0,-1),o={};value=e.target.id.split("_")[1].slice(0,-1),n!==value&&(o={column_name:t,value:value},o.token=gon.token,$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"column/set_column_dimension_and_metrics",type:"POST",data:o,contentType:"application/x-www-form-urlencoded",success:function(){$("#flash_categorize_columns-save").html("<p style='width: 70px; background: yellow;  padding: 5px;'>Saved</p>"),setTimeout(function(){$("#flash_categorize_columns-save").html("")},1e3)},error:function(){}}))};this.init=function(){{var e=function(e,t){b(e,t)};s(e)}}},Rumali.gridApiCall=function(){this.originalColumnName=function(e,t){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"column/all_columns",data:e,dataType:"json",type:"GET",success:function(e){t(e)},error:function(){console.error("Error in fetch data from server")}})},this.getDemensionsAndMetricsApiCall=function(e,t){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"column/dimensions_and_metrics",type:"GET",data:e,dataType:"json",success:function(e){t(e)},error:function(){console.log("no mertics found: server error")}})},this.postAjaxcall=function(e,t){e.token=gon.token;var n=$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+t,data:e,dataType:"json",type:"POST",async:!1,success:function(){Rumali.pykgrid.getShowPage()},error:function(e){generate_notify({text:e.responseText,notify:"error",timeout:3e3,position:"topCenter"})}});return n},this.dataformatterapi=function(e,t){$.ajax({url:e,data:t,dataType:"json",type:"POST",success:function(){Rumali.pykgrid.getShowPage()},error:function(){console.log("Save error. ")}})},this.datatypesApiCall=function(e,t){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"column/datatype_distribution",data:e,dataType:"json",type:"Get",async:!1,success:function(e){t(e.dtd)},error:function(){generate_notify({text:"[rumm-api] datatype distribution failed.",notify:"error",timeout:3e3,position:"topCenter"})}})},this.rowAddApiCall=function(e,t,n){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"row/add",data:e,dataType:"json",type:"POST",success:function(e){console.log(e,"----"),t(e),console.log("--ROW ADDED--")},error:function(){console.log("--Row add failed--"),console.error("Server error."),n()}})},this.columnAndCellChangeApiCall=function(e,t,n,o){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+t,data:e,dataType:"json",type:"POST",success:function(e){console.log(e),console.log("Cell updated"),n(e)},error:function(){console.error("Cell update failed"),o()}})},this.rowDeleteApiCall=function(e){$.ajax({url:rumi_api_endpoint+Rumali.gridoperation.restEndPoint()+"row/delete",data:e,dataType:"json",type:"POST",success:function(e){console.log(e)},error:function(){console.log("Save error"),alert("Unable to delete rows.")}})}},Rumali.gridOperation=function(){var e=this;this.getAllEditorTypes=function(){return{"boolean":"checkbox",date:"date",integer:"numeric","double":"numeric",string:"text"}},this.deleteColumnData=function(){var e=$("#grid_show").handsontable("getSelected")[1],t=self.columns_header[e+1],n={};n.column_name=t,pyk_statistics.resetMetrics(),pyk_statistics.resetDimensions(),grid_unique_values.resetDimensions(),grid_unique_values.resetMetrics(),divg1.destroyColumn(t),new_column_name=self.columns_header[e],Rumali.api.postAjaxcall(n,"/column/delete"),Rumali.gridoperation.showFilterCount();var o=new Rumali.categorizeColumns;o.init()},this.addColumnData=function(e){var t,n=$("#grid_show").handsontable("getSelected")[1],o={};"left"==e?(n+=1,t=self.columns_header[n-1]):(n+=2,t=self.columns_header[n-1]),o.column_name=Rumali.datatype_utils.random_name(),o.after=t,Rumali.api.postAjaxcall(o,"/column/add")},this.getOriginalColumnName=function(){var t={};t.original_names=!0,t.data_types=!0,t.token=gon.token,t.sub_types=!0,Rumali.api.originalColumnName(t,function(t){self.column_datatype=t,self.column_datatype=e.changeToColumnsType(self.column_datatype)})},this.changeToColumnsType=function(e){self.original_column_names=[],self.sub_datatype=[],self.columns_header=[];for(var t=[],n=e.columns.column_types,o=self.json_data[0],r=o.length,i=0;r>i;i++)self.sub_datatype.push(null==e.columns.sub_types[o[i]]?"nil":e.columns.sub_types[o[i]]),self.original_column_names.push(null==e.columns.original_column_names[o[i]]?"null":e.columns.original_column_names[o[i]]),t.push(n[o[i]]);return self.columns_header=self.json_data[0],self.json_data[0]=self.original_column_names,t},this.getAzaxcall=function(){var t,n,o,r=e.getSelectedColumnIndex(),i={};if(r!==!1){t=self.columns_header[r+1],n=self.column_datatype[r+1],i[t]=["count"],grid_unique_values.resetDimensions(),grid_unique_values.resetMetrics(),grid_unique_values.dimensions=[new_column_name],grid_unique_values.metrics=i,grid_unique_values.executeOnFilter=function(){o=JSON.parse(grid_unique_values.flushToGet().data),data_distribution=e.changeToJsonData(o,t),"integer"==n||"double"==n?Rumali.histogram(t,n,data_distribution):($("#histogram-chart").hide(),$("#histogram_min_max").hide(),Rumali.countUniqueValues(data_distribution)),e.resetFilterElements(),e.toggleReplaceButton(),console.log()};try{grid_unique_values.dataformat="json",grid_unique_values.call()}catch(s){console.log(s,"error in data distribution")}}},this.changeToJsonData=function(e,t){for(var n={},o=e.length,r=0;o>r;r++){var i=e[r];n[i[t]]=i.count}return n},this.restEndPoint=function(){var e=window.document.URL.split("/"),t=e.indexOf("data"),n=e[t+1],o=e[--t],r=e[--t];return n.indexOf("?")>-1&&(n=$("#data_store_name").val()),r+"/"+o+"/"+n+"/"},this.getColumnsWithType=function(e){function t(e,t){t(0==e?!1:!0)}var n,o=[];column_data_length=e.length,n="id"==self.json_data[0][0]?1:0;for(var r=n;r<column_data_length;r++){var i=e[r],s="";"double"==i?(s="0.0[0000]",o.push({type:editor_types[i],data:r,format:s,validator:t,allowInvalid:!0})):o.push({type:editor_types[i],data:r,checkedTemplate:"t",uncheckedTemplate:"f"})}return o},this.returnContentColumnNames=function(e){var t=[];return $.each(e,function(n){t.push(e[n].column_name)}),t},this.showrules=function(){var t=e.rules_array.length;$("#rules-div").empty();for(var n=0;t>n;n++)$("#rules-div").append(e.rules_array[n]+"<td><span class='update-rule' id ='"+n+"'>Edit</span></td><td><span class='glyphicon glyphicon-remove delete-rule' id ='"+n+"'></span></td></tr>");$("#rules-div").append("</table>")},this.columnHeaderSelected=function(t){Rumali.pykgrid.column_selected_flag=!0,$("#histogram_min_max").hide(),$("#input-col-cancel").hide(),$("#col-info-panel").hide(),$("#grid-count").show(),e.editColumn(t),$("#column").addClass("active"),$("#column2").removeClass("active"),$("#table").removeClass("active"),$("#table1").removeClass("active"),$("#show_when_column_is_selected_3").addClass("active"),$("#mapConfigure").removeClass("active"),$("#map_options").removeClass("active"),$("#col-info-panel").show(),$("#grid_datatypes").show(),$("#pyk_statistics").show(),$("#filter_toggle").hide(),$("#hide_when_column_is_selected_2").removeClass("active"),$("#show_when_column_is_selected_1").show(),$("#show_when_column_is_selected_3").show(),$("#sorting-value").show(),$("#convert-value").show()},this.columnHeaderDeselected=function(){e.showHideListForm(!0),Rumali.pykgrid.column_selected_flag=!1,$("#table").addClass("active"),$("#column").removeClass("active"),$("#show_when_column_is_selected_3").removeClass("active"),$("#hide_when_column_is_selected_2").removeClass("active"),$("#mapConfigure").removeClass("active"),$("#map_options").removeClass("active"),$("#table1").addClass("active"),$("#show_when_column_is_selected_1").hide(),$("#show_when_column_is_selected_3").hide(),$("#input-col-name").hide(),$("#grid_datatypes").hide(),$("#pyk_statistics").hide(),$("#sorting-value").hide(),$("#merge").hide(),$("#histogram_min_max").hide()},this.showPagination=function(t){var n=grid_show.limit,o=Math.ceil(t/n);$("#page-count").empty(),t>n&&$("#page-count").pagination({pages:o,displayedPages:2,onPageClick:function(t,o){t-=1;grid_show.offset=n*t,grid_show.dataformat="array",grid_show.executeOnFilter=function(){var t=grid_show.flushToGet();void 0!=t&&(self.json_data=t.data),e.reloadGrid()};try{grid_show.call()}catch(r){console.log(r)}o.preventDefault()},cssStyle:"light-theme",edges:1})},this.toggleReplaceButton=function(){var e=[];$(".check-value:checked").each(function(){e.push($(this).val())}),e.length<1?$("#replace-values").hide():$("#replace-values").show()},this.getSelectedColumnIndex=function(){var e=$("#grid_show").handsontable("getSelected");if(void 0==e)return!1;var t=e[1];return t},this.reloadGrid=function(){var e=self.json_data.length-1;self.columns_header=self.json_data[0],self.json_data[0]=self.original_column_names,$("#grid_show").handsontable("loadData",self.json_data),$container.handsontable("selectCell",e,new_column_value_index,0,new_column_value_index),Rumali.gridoperation.showFilterCount()},this.removeAllFilterColumn=function(e){for(var t=divg1.filters.slice(0),n=t.length,o=0;n>o;o++)for(var r=t[o],i=r.length,s=0,a=0;i>a;a++)if(r[a].column_name===e){divg1.filters.splice(o-s),s++;break}Rumali.gridoperation.showFilterCount()},this.showFilterCount=function(){var e=divg1.filters.length,t="";$("#applied_filters_tab_count").text(e),0===e&&(t="No filters applied yet. To apply a filter, select a column and apply from the available list."),$("#hide_when_column_is_selected_1 .hint").html(t)},this.resetFilterElements=function(){var e=divg1.filters,t=e.length;$(".check-value:checkbox").removeClass("pykquery-selected").prop("checked",!1),$(".side-bar-data-type:checkbox").removeClass("pykquery-selected").prop("checked",!1),d3.select("rect.extent").attr("x",0).attr("width",0),d3.selectAll("g.resize").style("display","none");for(var n=0;t>n;n++)for(var o=e[n],r=o.length,i=0;r>i;i++){var s=o[i];if(new_column_name==s.column_name)switch(s.condition_type){case"values":for(var a=s["in"],l=a.length,i=0;l>i;i++){var c=a[i];$("input:checkbox[value='"+c+"']").addClass("pykquery-selected"),$("input:checkbox[value='"+c+"']").prop("checked",!0)}break;case"datatype":for(var a=s["in"],l=a.length,i=0;l>i;i++){var c=a[i];$("input:checkbox[data-type='"+c+"']").addClass("pykquery-selected"),$("input:checkbox[data-type='"+c+"']").prop("checked",!0)}break;case"range":var u=(s.column_name,s.condition.min),d=s.condition.max;0==s.condition.not?($("input[type='radio'][value='in']").parent().addClass("active"),$("input[type='radio'][value='notin']").parent().removeClass("active")):($("input[type='radio'][value='in']").parent().removeClass("active"),$("input[type='radio'][value='notin']").parent().addClass("active")),global_brush.extent([u,d]),brush.call(global_brush)}}},this.sortColumnData=function(t){var n=($("#grid_show").handsontable("getSelected")[1],{});n[new_column_name]=t,grid_show.sort=[n],grid_show.executeOnFilter=function(){var t=grid_show.flushToGet().data;""!=t&&void 0!=t&&(self.json_data=t,e.reloadGrid(),$container.handsontable("selectCell",0,0,0,0))};try{grid_show.call()}catch(o){console.error("error in  data for sorting")}},this.findDataType=function(e){var t=Rumali.datatype_utils.isBoolean(e)||Rumali.datatype_utils.isNumber(e)||Rumali.datatype_utils.isDate(e)||Rumali.datatype_utils.isBlank(e)||"string";return t},this.editColumn=function(t){$("#input-data-type").val(self.column_datatype[t+1]),$("#sub-data-type").val(self.sub_datatype[t+1]),e.showHideListForm(!1),$("#grid_datatypes").show(),$("#input-col-name").show(),$("#merge").show()},this.showHideListForm=function(e){e?($("#column-list").show(),$("#grid-column-form").hide()):($("#column-list").hide(),$("#grid-column-form").show())},this.update_grid_with_new_data=function(e){if(void 0==e)return!1;if(e.length>0)return self.json_data=e,!0;if(0==e.length){var t=self.json_data[0];return self.json_data=[],self.json_data[0]=t,!0}},$(document).ready(function(){$(document).on("click",".filter_remove",function(e){Rumali.executeAfterDeleteFilter(),e.preventDefault()})})};var Handsontable=function(e,t){t=t||{};var n=new Handsontable.Core(e,t);return n.init(),n};Handsontable.plugins={},function(e,t){"use strict";function n(){this.refCounter=0,this.init()}function o(){function e(){var e=this;e._registerTimeout(setTimeout(function(){e.updateSettings({observeChanges:!0})},0))}function n(e){return function(t,n){return"string"==typeof t[1]&&(t[1]=t[1].toLowerCase()),"string"==typeof n[1]&&(n[1]=n[1].toLowerCase()),t[1]===n[1]?0:null===t[1]||""===t[1]?1:null===n[1]||""===n[1]?-1:t[1]<n[1]?e?-1:1:t[1]>n[1]?e?1:-1:0}}function o(e){return function(t,n){if(t[1]===n[1])return 0;if(null===t[1])return 1;if(null===n[1])return-1;var o=new Date(t[1]),r=new Date(n[1]);return r>o?e?-1:1:o>r?e?1:-1:0}}function r(e){return"undefined"!=typeof e.sortColumn}var i=this;this.init=function(t){var n,o,r=this,s=r.getSettings().columnSorting;if(r.sortingEnabled=!!s,r.sortingEnabled){r.sortIndex=[];var c=a.call(r);"undefined"!=typeof c?(n=c.sortColumn,o=c.sortOrder):(n=s.column,o=s.sortOrder),i.sortByColumn.call(r,n,o),r.sort=function(){var e=Array.prototype.slice.call(arguments);return i.sortByColumn.apply(r,e)},"undefined"==typeof r.getSettings().observeChanges&&e.call(r),"afterInit"==t&&(l.call(r),r.addHook("afterCreateRow",i.afterCreateRow),r.addHook("afterRemoveRow",i.afterRemoveRow),r.addHook("afterLoadData",i.init))}else delete r.sort,r.removeHook("afterCreateRow",i.afterCreateRow),r.removeHook("afterRemoveRow",i.afterRemoveRow),r.removeHook("afterLoadData",i.init)},this.setSortingColumn=function(e,t){var n=this;return"undefined"==typeof e?(delete n.sortColumn,void delete n.sortOrder):(n.sortOrder=n.sortColumn===e&&"undefined"==typeof t?!n.sortOrder:"undefined"!=typeof t?t:!0,void(n.sortColumn=e))},this.sortByColumn=function(e,n){var o=this;i.setSortingColumn.call(o,e,n),"undefined"!=typeof o.sortColumn&&(t.hooks.run(o,"beforeColumnSort",o.sortColumn,o.sortOrder),i.sort.call(o),o.render(),s.call(o),t.hooks.run(o,"afterColumnSort",o.sortColumn,o.sortOrder))};var s=function(){var e=this,n={};"undefined"!=typeof e.sortColumn&&(n.sortColumn=e.sortColumn),"undefined"!=typeof e.sortOrder&&(n.sortOrder=e.sortOrder),(n.hasOwnProperty("sortColumn")||n.hasOwnProperty("sortOrder"))&&t.hooks.run(e,"persistentStateSave","columnSorting",n)},a=function(){var e=this,n={};return t.hooks.run(e,"persistentStateLoad","columnSorting",n),n.value},l=function(){function e(){var e=o.view.TBODY.querySelector("tr").querySelectorAll("th");return e.length}function n(n){var o=t.Dom.closest(n,"TH");return t.Dom.index(o)-e()}var o=this,r=t.eventManager(o);r.addEventListener(o.rootElement,"click",function(e){if(t.Dom.hasClass(e.target,"columnSorting")){var r=n(e.target);i.sortByColumn.call(o,r)}})};this.sort=function(){var e=this;if("undefined"!=typeof e.sortOrder){e.sortingEnabled=!1,e.sortIndex.length=0;for(var t=this.colOffset(),r=0,i=this.countRows()-e.getSettings().minSpareRows;i>r;r++)this.sortIndex.push([r,e.getDataAtCell(r,this.sortColumn+t)]);var s,a=e.getCellMeta(0,e.sortColumn);switch(a.type){case"date":s=o;break;default:s=n}this.sortIndex.sort(s(e.sortOrder));for(var r=this.sortIndex.length;r<e.countRows();r++)this.sortIndex.push([r,e.getDataAtCell(r,this.sortColumn+t)]);e.sortingEnabled=!0}},this.translateRow=function(e){var t=this;return t.sortingEnabled&&t.sortIndex&&t.sortIndex.length&&t.sortIndex[e]?t.sortIndex[e][0]:e},this.untranslateRow=function(e){var t=this;if(t.sortingEnabled&&t.sortIndex&&t.sortIndex.length)for(var n=0;n<t.sortIndex.length;n++)if(t.sortIndex[n][0]==e)return n},this.getColHeader=function(e,n){this.getSettings().columnSorting&&e>=0&&t.Dom.addClass(n.querySelector(".colHeader"),"columnSorting")},this.afterCreateRow=function(e,t){var n=this;if(r(n)){for(var o=0;o<n.sortIndex.length;o++)n.sortIndex[o][0]>=e&&(n.sortIndex[o][0]+=t);for(var o=0;t>o;o++)n.sortIndex.splice(e+o,0,[e+o,n.getData()[e+o][n.sortColumn+n.colOffset()]]);s.call(n)}},this.afterRemoveRow=function(e,t){var n=this;if(r(n)){var o=i.translateRow.call(n,e);n.sortIndex.splice(e,t);for(var a=0;a<n.sortIndex.length;a++)n.sortIndex[a][0]>o&&(n.sortIndex[a][0]-=t);s.call(n)}},this.afterChangeSort=function(e){var t=this,n=!1,o={};if(e){for(var r=0;r<e.length;r++)if(e[r][1]==t.sortColumn){n=!0,o.row=i.translateRow.call(t,e[r][0]),o.col=e[r][1];break}n&&t._registerTimeout(setTimeout(function(){i.sort.call(t),t.render(),t.selectCell(i.untranslateRow.call(t,o.row),o.col)},0))}}}function r(e){var n=t.eventManager(e),o=function(e,t,n,o){o.setCellMeta(e,t,"comment",n),o.render()},r=function(e,t,n){o(e.from.row,e.from.col,t,n)},i=function(){var e=c();e.style.display="none",e.value=""},s=function(o){function s(t){if(n.removeEventListener(document,"mouseover"),"htCommentTextArea"!=t.target.className&&-1==t.target.innerHTML.indexOf("Comment")){var s=document.querySelector(".htCommentTextArea").value;s.trim().length>1&&r(o,s,e),a(),i()}}n.addEventListener(document,"mousedown",t.helper.proxy(s))},a=function(){n.removeEventListener(document,"mousedown"),n.addEventListener(document,"mousedown",t.helper.proxy(u))},l=function(n,o){var r=e.view.wt.wtTable.getCell(n.from),i=t.Dom.offset(r),a=e.getColWidth(n.from.col);o.style.position="absolute",o.style.left=i.left+a+"px",o.style.top=i.top+"px",o.style.zIndex=2,s(n,o)},c=function(e){var n=document.querySelector(".htComments");if(!n){n=document.createElement("DIV");var o=document.createElement("TEXTAREA");t.Dom.addClass(o,"htCommentTextArea"),n.appendChild(o),t.Dom.addClass(n,"htComments"),document.getElementsByTagName("body")[0].appendChild(n)}return e=e||"",document.querySelector(".htCommentTextArea").value=e,n},u=function(n){if(-1!=n.target.className.indexOf("htCommentCell")){a();var o=e.view.wt.wtTable.getCoords(n.target),r={from:new d(o.row,o.col)};t.Comments.showComment(r)}else"htCommentTextArea"!=n.target.className&&i()};return{init:function(){n.addEventListener(document,"mouseover",t.helper.proxy(u))},showComment:function(t){var n=e.getCellMeta(t.from.row,t.from.col),o="";n.comment&&(o=n.comment);var r=c(o);r.style.display="block",l(t,r)},removeComment:function(t,n){e.removeCellMeta(t,n,"comment"),e.render()},checkSelectionCommentsConsistency:function(){var t=!1,n=e.getSelectedRange().from;return e.getCellMeta(n.row,n.col).comment&&(t=!0),t}}}function i(t){var n,o=function(){e.localStorage[t+"__persistentStateKeys"]=JSON.stringify(n)},r=function(){var o=e.localStorage[t+"__persistentStateKeys"],r="string"==typeof o?JSON.parse(o):void 0;n=r?r:[]},i=function(){n=[],o()};r(),this.saveValue=function(r,i){e.localStorage[t+"_"+r]=JSON.stringify(i),-1==n.indexOf(r)&&(n.push(r),o())},this.loadValue=function(n,o){n="undefined"!=typeof n?n:o;var r=e.localStorage[t+"_"+n];return"undefined"==typeof r?void 0:JSON.parse(r)},this.reset=function(n){e.localStorage.removeItem(t+"_"+n)},this.resetAll=function(){for(var o=0;o<n.length;o++)e.localStorage.removeItem(t+"_"+n[o]);i()}}function s(){this.boundaries=null,this.callback=null}function a(){var e=[];return e.getInfo=function(e,t){for(var n=0,o=this.length;o>n;n++)if(this[n].row<=e&&this[n].row+this[n].rowspan-1>=e&&this[n].col<=t&&this[n].col+this[n].colspan-1>=t)return this[n]},e.setInfo=function(e){for(var t=0,n=this.length;n>t;t++)if(this[t].row===e.row&&this[t].col===e.col)return void(this[t]=e);this.push(e)},e.removeInfo=function(e,t){for(var n=0,o=this.length;o>n;n++)if(this[n].row===e&&this[n].col===t){this.splice(n,1);break}},e}function l(e){if(this.mergedCellInfoCollection=new a,Array.isArray(e))for(var t=0,n=e.length;n>t;t++)this.mergedCellInfoCollection.setInfo(e[t])}function c(){}function u(e,n){var o,r=function(){this.selectionHandles={topLeft:document.createElement("DIV"),topLeftHitArea:document.createElement("DIV"),bottomRight:document.createElement("DIV"),bottomRightHitArea:document.createElement("DIV")};var e=10,t=40;this.selectionHandles.topLeft.className="topLeftSelectionHandle",this.selectionHandles.topLeftHitArea.className="topLeftSelectionHandle-HitArea",this.selectionHandles.bottomRight.className="bottomRightSelectionHandle",this.selectionHandles.bottomRightHitArea.className="bottomRightSelectionHandle-HitArea",this.selectionHandles.styles={topLeft:this.selectionHandles.topLeft.style,topLeftHitArea:this.selectionHandles.topLeftHitArea.style,bottomRight:this.selectionHandles.bottomRight.style,bottomRightHitArea:this.selectionHandles.bottomRightHitArea.style};
var n={position:"absolute",height:t+"px",width:t+"px","border-radius":parseInt(t/1.5,10)+"px"};for(var o in n)n.hasOwnProperty(o)&&(this.selectionHandles.styles.bottomRightHitArea[o]=n[o],this.selectionHandles.styles.topLeftHitArea[o]=n[o]);var r={position:"absolute",height:e+"px",width:e+"px","border-radius":parseInt(e/1.5,10)+"px",background:"#F5F5FF",border:"1px solid #4285c8"};for(var o in r)r.hasOwnProperty(o)&&(this.selectionHandles.styles.bottomRight[o]=r[o],this.selectionHandles.styles.topLeft[o]=r[o]);this.main.appendChild(this.selectionHandles.topLeft),this.main.appendChild(this.selectionHandles.bottomRight),this.main.appendChild(this.selectionHandles.topLeftHitArea),this.main.appendChild(this.selectionHandles.bottomRightHitArea)};if(n){var i=t.eventManager(e);this.instance=e,this.settings=n,this.main=document.createElement("div"),o=this.main.style,o.position="absolute",o.top=0,o.left=0;for(var s=["top","left","bottom","right","corner"],a=0;5>a;a++){var l=s[a],c=document.createElement("DIV");c.className="wtBorder "+(this.settings.className||""),this.settings[l]&&this.settings[l].hide&&(c.className+=" hidden"),o=c.style,o.backgroundColor=this.settings[l]&&this.settings[l].color?this.settings[l].color:n.border.color,o.height=this.settings[l]&&this.settings[l].width?this.settings[l].width+"px":n.border.width+"px",o.width=this.settings[l]&&this.settings[l].width?this.settings[l].width+"px":n.border.width+"px",this.main.appendChild(c)}this.top=this.main.childNodes[0],this.left=this.main.childNodes[1],this.bottom=this.main.childNodes[2],this.right=this.main.childNodes[3],this.topStyle=this.top.style,this.leftStyle=this.left.style,this.bottomStyle=this.bottom.style,this.rightStyle=this.right.style,this.cornerDefaultStyle={width:"5px",height:"5px",borderWidth:"2px",borderStyle:"solid",borderColor:"#FFF"},this.corner=this.main.childNodes[4],this.corner.className+=" corner",this.cornerStyle=this.corner.style,this.cornerStyle.width=this.cornerDefaultStyle.width,this.cornerStyle.height=this.cornerDefaultStyle.height,this.cornerStyle.border=[this.cornerDefaultStyle.borderWidth,this.cornerDefaultStyle.borderStyle,this.cornerDefaultStyle.borderColor].join(" "),t.mobileBrowser&&r.call(this),this.disappear(),e.wtTable.bordersHolder||(e.wtTable.bordersHolder=document.createElement("div"),e.wtTable.bordersHolder.className="htBorders",e.wtTable.hider.appendChild(e.wtTable.bordersHolder)),e.wtTable.bordersHolder.insertBefore(this.main,e.wtTable.bordersHolder.firstChild);var u=!1;i.addEventListener(document.body,"mousedown",function(){u=!0}),i.addEventListener(document.body,"mouseup",function(){u=!1});for(var d=0,h=this.main.childNodes.length;h>d;d++)i.addEventListener(this.main.childNodes[d],"mouseenter",function(t){if(u&&e.getSetting("hideBorderOnMouseDownOver")){t.preventDefault(),t.stopImmediatePropagation();var n=this.getBoundingClientRect();this.style.display="none";var o=function(e){return e.clientY<Math.floor(n.top)?!0:e.clientY>Math.ceil(n.top+n.height)?!0:e.clientX<Math.floor(n.left)?!0:e.clientX>Math.ceil(n.left+n.width)?!0:void 0},r=function(e){o(e)&&(i.removeEventListener(document.body,"mousemove",r),this.style.display="block")};i.addEventListener(document.body,"mousemove",r)}})}}function d(e,t){"undefined"!=typeof e&&"undefined"!=typeof t?(this.row=e,this.col=t):(this.row=null,this.col=null)}function h(e,t,n){this.highlight=e,this.from=t,this.to=n}function f(e,t,n){this.offset=e,this.total=t,this.countTH=n}function p(e,t,n,o){var r,i=0;for(this.instance=e,this.containerSizeFn=t,this.cellSizesSum=0,this.cellSizes=[],this.cellStretch=[],this.cellCount=0,this.visibleCellCount=0,this.remainingSize=0,this.strategy=o;;){if(r=n(i),void 0===r)break;this.cellSizesSum<this.getContainerSize()&&this.visibleCellCount++,this.cellSizes.push(r),this.cellSizesSum+=r,this.cellCount++,i++}var s=this.getContainerSize();this.remainingSize=this.cellSizesSum-s}function m(e){var n=[];if(this.guid="wt_"+w(),e.cloneSource?(this.cloneSource=e.cloneSource,this.cloneOverlay=e.cloneOverlay,this.wtSettings=e.cloneSource.wtSettings,this.wtTable=new k(this,e.table),this.wtScroll=new C(this),this.wtViewport=e.cloneSource.wtViewport,this.wtEvent=new v(this),this.selections=this.cloneSource.selections):(this.wtSettings=new _(this,e),this.wtTable=new k(this,e.table),this.wtScroll=new C(this),this.wtViewport=new D(this),this.wtEvent=new v(this),this.selections=this.getSetting("selections"),this.wtScrollbars=new S(this)),this.wtTable.THEAD.childNodes.length&&this.wtTable.THEAD.childNodes[0].childNodes.length){for(var o=0,r=this.wtTable.THEAD.childNodes[0].childNodes.length;r>o;o++)n.push(this.wtTable.THEAD.childNodes[0].childNodes[o].innerHTML);this.getSetting("columnHeaders").length||this.update("columnHeaders",[function(e,o){t.Dom.fastInnerText(o,n[e])}])}this.drawn=!1,this.drawInterrupted=!1}function g(e){this.instance=e,this.init(),this.clone=this.makeClone("debug"),this.clone.wtTable.holder.style.opacity=.4,this.clone.wtTable.holder.style.textShadow="0 0 2px #ff0000",this.lastTimeout=null,t.Dom.addClass(this.clone.wtTable.holder.parentNode,"wtDebugVisible")}function v(n){var o=this,r=t.eventManager(n);this.instance=n;var i=[null,null];this.dblClickTimeout=[null,null];var s,a,l=function(e){var n=o.parentCell(e.target);t.Dom.hasClass(e.target,"corner")?o.instance.getSetting("onCellCornerMouseDown",e,e.target):n.TD&&o.instance.hasSetting("onCellMouseDown")&&o.instance.getSetting("onCellMouseDown",e,n.coords,n.TD,o.instance),2!==e.button&&n.TD&&(i[0]=n.TD,clearTimeout(o.dblClickTimeout[0]),o.dblClickTimeout[0]=setTimeout(function(){i[0]=null},1e3))},c=function(){o.instance.touchMoving=!0},u=function(e){r.addEventListener(this,"touchmove",c),o.checkIfTouchMove=setTimeout(function(){return o.instance.touchMoving===!0?(o.instance.touchMoving=void 0,void r.removeEventListener("touchmove",c,!1)):void l(e)},30)},d=function(e){if(o.instance.hasSetting("onCellMouseOver")){var n=o.instance.wtTable.TABLE,r=t.Dom.closest(e.target,["TD","TH"],n);r&&r!==a&&t.Dom.isChildOf(r,n)&&(a=r,o.instance.getSetting("onCellMouseOver",e,o.instance.wtTable.getCoords(r),r,o.instance))}},h=function(e){if(2!==e.button){var n=o.parentCell(e.target);n.TD===i[0]&&n.TD===i[1]?(t.Dom.hasClass(e.target,"corner")?o.instance.getSetting("onCellCornerDblClick",e,n.coords,n.TD,o.instance):o.instance.getSetting("onCellDblClick",e,n.coords,n.TD,o.instance),i[0]=null,i[1]=null):n.TD===i[0]&&(i[1]=n.TD,clearTimeout(o.dblClickTimeout[1]),o.dblClickTimeout[1]=setTimeout(function(){i[1]=null},500))}},f=function(e){clearTimeout(s),e.preventDefault(),h(e)};if(r.addEventListener(this.instance.wtTable.holder,"mousedown",l),r.addEventListener(this.instance.wtTable.TABLE,"mouseover",d),r.addEventListener(this.instance.wtTable.holder,"mouseup",h),this.instance.wtTable.holder.parentNode.parentNode&&t.mobileBrowser){var p="."+this.instance.wtTable.holder.parentNode.className.split(" ").join(".");r.addEventListener(this.instance.wtTable.holder.parentNode.parentNode,"touchstart",function(e){o.instance.touchApplied=!0,t.Dom.isChildOf(e.target,p)&&u.call(e.target,e)}),r.addEventListener(this.instance.wtTable.holder.parentNode.parentNode,"touchend",function(e){o.instance.touchApplied=!1,t.Dom.isChildOf(e.target,p)&&f.call(e.target,e)}),o.instance.momentumScrolling||(o.instance.momentumScrolling={}),r.addEventListener(this.instance.wtTable.holder.parentNode.parentNode,"scroll",function(){clearTimeout(o.instance.momentumScrolling._timeout),o.instance.momentumScrolling.ongoing||o.instance.getSetting("onBeforeTouchScroll"),o.instance.momentumScrolling.ongoing=!0,o.instance.momentumScrolling._timeout=setTimeout(function(){o.instance.touchApplied||(o.instance.momentumScrolling.ongoing=!1,o.instance.getSetting("onAfterMomentumScroll"))},200)})}r.addEventListener(e,"resize",function(){o.instance.draw()}),this.destroy=function(){clearTimeout(this.dblClickTimeout[0]),clearTimeout(this.dblClickTimeout[1]),r.clear()}}function w(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()}function y(e,t,n){this.offset=e,this.total=t,this.countTH=n}function C(e){this.instance=e}function b(e){this.instance=e,this.type="corner",this.init(),this.clone=this.makeClone("corner")}function R(e){this.instance=e,this.type="horizontal",this.offset=0,this.init(),this.clone=this.makeClone("left")}function T(e){this.instance=e,this.type="vertical",this.init(),this.clone=this.makeClone("top")}function S(e){this.instance=e,e.update("scrollbarWidth",t.Dom.getScrollbarWidth()),e.update("scrollbarHeight",t.Dom.getScrollbarWidth()),this.vertical=new T(e),this.horizontal=new R(e),this.corner=new b(e),e.getSetting("debug")&&(this.debug=new g(e)),this.registerListeners()}function E(e,t){this.settings=e,this.cellRange=t||null,this.instanceBorders={}}function _(e,n){var o=this;this.instance=e,this.defaults={table:void 0,debug:!1,stretchH:"none",currentRowClassName:null,currentColumnClassName:null,data:void 0,fixedColumnsLeft:0,fixedRowsTop:0,rowHeaders:function(){return[]},columnHeaders:function(){return[]},totalRows:void 0,totalColumns:void 0,cellRenderer:function(e,n,r){var i=o.getSetting("data",e,n);t.Dom.fastInnerText(r,void 0===i||null===i?"":i)},columnWidth:function(){},rowHeight:function(){},defaultRowHeight:23,defaultColumnWidth:50,selections:null,hideBorderOnMouseDownOver:!1,viewportRowCalculatorOverride:null,viewportColumnCalculatorOverride:null,onCellMouseDown:null,onCellMouseOver:null,onCellDblClick:null,onCellCornerMouseDown:null,onCellCornerDblClick:null,beforeDraw:null,onDraw:null,onBeforeDrawBorders:null,onScrollVertically:null,onScrollHorizontally:null,onBeforeTouchScroll:null,onAfterMomentumScroll:null,scrollbarWidth:10,scrollbarHeight:10,renderAllRows:!1,groups:!1},this.settings={};for(var r in this.defaults)if(this.defaults.hasOwnProperty(r))if(void 0!==n[r])this.settings[r]=n[r];else{if(void 0===this.defaults[r])throw new Error('A required setting "'+r+'" was not provided');this.settings[r]=this.defaults[r]}}function k(e,n){this.instance=e,this.TABLE=n,t.Dom.removeTextNodes(this.TABLE);var o=this.TABLE.parentNode;if(!o||1!==o.nodeType||!t.Dom.hasClass(o,"wtHolder")){var r=document.createElement("DIV");r.className="wtSpreader",o&&o.insertBefore(r,this.TABLE),r.appendChild(this.TABLE)}if(this.spreader=this.TABLE.parentNode,o=this.spreader.parentNode,!o||1!==o.nodeType||!t.Dom.hasClass(o,"wtHolder")){var i=document.createElement("DIV");i.className="wtHider",o&&o.insertBefore(i,this.spreader),i.appendChild(this.spreader)}if(this.hider=this.spreader.parentNode,this.hiderStyle=this.hider.style,this.hiderStyle.position="relative",o=this.hider.parentNode,!o||1!==o.nodeType||!t.Dom.hasClass(o,"wtHolder")){var s=document.createElement("DIV");s.style.position="relative",s.className="wtHolder",e.cloneSource||(s.className+=" ht_master"),o&&o.insertBefore(s,this.hider),s.appendChild(this.hider)}if(this.holder=this.hider.parentNode,this.isWorkingOnClone()||(this.holder.parentNode.style.position="relative"),this.TBODY=this.TABLE.getElementsByTagName("TBODY")[0],this.TBODY||(this.TBODY=document.createElement("TBODY"),this.TABLE.appendChild(this.TBODY)),this.THEAD=this.TABLE.getElementsByTagName("THEAD")[0],this.THEAD||(this.THEAD=document.createElement("THEAD"),this.TABLE.insertBefore(this.THEAD,this.TBODY)),this.COLGROUP=this.TABLE.getElementsByTagName("COLGROUP")[0],this.COLGROUP||(this.COLGROUP=document.createElement("COLGROUP"),this.TABLE.insertBefore(this.COLGROUP,this.THEAD)),this.instance.getSetting("columnHeaders").length&&!this.THEAD.childNodes.length){var a=document.createElement("TR");this.THEAD.appendChild(a)}this.colgroupChildrenLength=this.COLGROUP.childNodes.length,this.theadChildrenLength=this.THEAD.firstChild?this.THEAD.firstChild.childNodes.length:0,this.tbodyChildrenLength=this.TBODY.childNodes.length,this.rowFilter=null,this.columnFilter=null}function x(e){this.wtTable=e,this.instance=e.instance,this.rowFilter=e.rowFilter,this.columnFilter=e.columnFilter,this.TABLE=e.TABLE,this.THEAD=e.THEAD,this.TBODY=e.TBODY,this.COLGROUP=e.COLGROUP,this.utils=x.utils}function D(n){this.instance=n,this.oversizedRows=[],this.oversizedCols=[],this.oversizedColumnHeaders=[];var o=this,r=t.eventManager(n);r.addEventListener(e,"resize",function(){o.clientHeight=o.getWorkspaceHeight()})}function A(e,t,n,o,r,i,s){function a(e,t){var o=0;if(h.stretchAllColumnsWidth[e]||(h.stretchAllColumnsWidth[e]=Math.round(t*h.stretchAllRatio)),h.stretchAllColumnsWidth.length===n&&h.needVerifyLastColumnWidth){h.needVerifyLastColumnWidth=!1;for(var r=0;r<h.stretchAllColumnsWidth.length;r++)o+=h.stretchAllColumnsWidth[r];o!=h.totalTargetWidth&&(h.stretchAllColumnsWidth[h.stretchAllColumnsWidth.length-1]+=h.totalTargetWidth-o)}return h.stretchAllColumnsWidth[e]}function l(e){return e===n-1?h.stretchLastWidth:null}var c,u,d,h=this,f=1,p=0,m=!0,g=50,v=[];for(this.scrollOffset=t,this.startColumn=null,this.endColumn=null,this.startPosition=null,this.count=0,this.stretchAllRatio=0,this.stretchLastWidth=0,this.stretch=s,this.totalTargetWidth=0,this.needVerifyLastColumnWidth=!0,this.stretchAllColumnsWidth=[],c=function(e){var t=o(e);return f=f||1,void 0===t&&(t=g),t},this.refreshStretching=function(e){for(var t,o,r=0,i=0;n>i;i++)t=c(i),r+=t;this.totalTargetWidth=e,o=r-e,"all"===this.stretch&&0>o?(this.stretchAllRatio=e/r,this.stretchAllColumnsWidth=[],this.needVerifyLastColumnWidth=!0):"last"===this.stretch&&1/0!==e&&(this.stretchLastWidth=-o+c(n-1))},this.getStretchedColumnWidth=function(e,t){var n=null;return"all"===this.stretch&&0!==this.stretchAllRatio?n=a(e,t):"last"===this.stretch&&0!==this.stretchLastWidth&&(n=l(e,t)),n},d=0;n>d;d++)if(u=c(d),t>=p&&!i&&(this.startColumn=d),p>=t&&t+e>=p+u&&(null==this.startColumn&&(this.startColumn=d),this.endColumn=d),v.push(p),p+=u,i||(this.endColumn=d),p>=t+e){m=!1;break}if(this.endColumn==n-1&&m)for(this.startColumn=this.endColumn;this.startColumn>0;){var w=v[this.endColumn]+u-v[this.startColumn-1];if((e>=w||!i)&&this.startColumn--,w>e)break}null!==this.startColumn&&r&&r(this),this.startPosition=v[this.startColumn],void 0==this.startPosition&&(this.startPosition=null),null!=this.startColumn&&(this.count=this.endColumn-this.startColumn+1)}function H(e,t,n,o,r,i){this.scrollOffset=t,this.startRow=null,this.startPosition=null,this.endRow=null,this.count=0;for(var s,a=0,l=!0,c=23,u=[],d=0;n>d;d++)if(s=o(d),void 0===s&&(s=c),t>=a&&!i&&(this.startRow=d),a>=t&&t+e>=a+s&&(null==this.startRow&&(this.startRow=d),this.endRow=d),u.push(a),a+=s,i||(this.endRow=d),a>=t+e){l=!1;break}if(this.endRow==n-1&&l)for(this.startRow=this.endRow;this.startRow>0;){var h=u[this.endRow]+s-u[this.startRow-1];if((e>=h||!i)&&this.startRow--,h>=e)break}null!==this.startRow&&r&&r(this),this.startPosition=u[this.startRow],void 0==this.startPosition&&(this.startPosition=null),null!=this.startRow&&(this.count=this.endRow-this.startRow+1)}Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.filter||(Array.prototype.filter=function(e,t){function n(e){return/NodeList/i.test(e.item)}function o(e){for(var t=[],n=0,o=e.length;o>n;n++)t[n]=e[n];return t}if("undefined"==typeof this||null===this)throw new TypeError;if("function"!=typeof e)throw new TypeError;t=t||this,n(t)&&(t=o(t));var r,i,s=t.length,a=[];for(r=0;s>r;r+=1)t.hasOwnProperty(r)&&(i=t[r],e.call(t,i,r,t)&&a.push(i));return a}),Array.isArray||(Array.isArray=function(e){return"[object Array]"==toString.call(e)}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=n.length;return function(r){if("object"!=typeof r&&("function"!=typeof r||null===r))throw new TypeError("Object.keys called on non-object");var i,s,a=[];for(i in r)e.call(r,i)&&a.push(i);if(t)for(s=0;o>s;s++)e.call(r,n[s])&&a.push(n[s]);return a}}()),"undefined"==typeof WeakMap&&!function(){var t=Object.defineProperty;try{var n=!0;t(function(){},"foo",{})}catch(o){n=!1}var r=+new Date%1e9,i=function(){this.name="__st"+(1e9*Math.random()>>>0)+(r++ +"__"),n||(this._wmCache=[])};i.prototype=n?{set:function(e,n){var o=e[this.name];o&&o[0]===e?o[1]=n:t(e,this.name,{value:[e,n],writable:!0})},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},"delete":function(e){this.set(e,void 0)}}:{set:function(e,t){if("undefined"!=typeof e&&"undefined"!=typeof t){for(var n=0,o=this._wmCache.length;o>n;n++)if(this._wmCache[n].key==e)return void(this._wmCache[n].value=t);this._wmCache.push({key:e,value:t})}},get:function(e){if("undefined"!=typeof e)for(var t=0,n=this._wmCache.length;n>t;t++)if(this._wmCache[t].key==e)return this._wmCache[t].value},"delete":function(e){if("undefined"!=typeof e)for(var t=0,n=this._wmCache.length;n>t;t++)this._wmCache[t].key==e&&Array.prototype.slice.call(this._wmCache,t,1)}},e.WeakMap=i}(),t.activeGuid=null,t.Core=function(e,n){function o(){var e=!1;return{validatorsInQueue:0,addValidatorToQueue:function(){this.validatorsInQueue++,e=!1},removeValidatorFormQueue:function(){this.validatorsInQueue=this.validatorsInQueue-1<0?0:this.validatorsInQueue-1,this.checkIfQueueIsEmpty()},onQueueEmpty:function(){},checkIfQueueIsEmpty:function(){0==this.validatorsInQueue&&0==e&&(e=!0,this.onQueueEmpty())}}}function r(e,n,r){function i(){var o;e.length&&(o=t.hooks.run(w,"beforeChange",e,n),"function"==typeof o?console.warn("Your beforeChange callback returns a function. It's not supported since Handsontable 0.12.1 (and the returned function will not be executed)."):o===!1&&e.splice(0,e.length)),r()}var s=new o;s.onQueueEmpty=i;for(var a=e.length-1;a>=0;a--)if(null===e[a])e.splice(a,1);else{var l=e[a][0],c=p.propToCol(e[a][1]),u=w.runHooks("modifyCol",c),d=w.getCellMeta(l,u);if("numeric"===d.type&&"string"==typeof e[a][3]&&e[a][3].length>0&&(/^-?[\d\s]*(\.|\,)?\d*$/.test(e[a][3])||d.format)){var h=e[a][3].length;numeral.language("undefined"==typeof d.language?"en":e[a][3].indexOf(".")===h-3&&-1===e[a][3].indexOf(",")?"en":d.language),numeral.validate(e[a][3])&&(e[a][3]=numeral().unformat(e[a][3]))}w.getCellValidator(d)&&(s.addValidatorToQueue(),w.validateCell(e[a][3],d,function(t,n){return function(o){if("boolean"!=typeof o)throw new Error("Validation error: result is not boolean");o===!1&&n.allowInvalid===!1&&(e.splice(t,1),n.valid=!0,--t),s.removeValidatorFormQueue()}}(a,d),n))}s.checkIfQueueIsEmpty()}function i(e,n){var o=e.length-1;if(!(0>o)){for(;o>=0;o--)if(null!==e[o]){if(null!=e[o][2]||null!=e[o][3]){if(f.settings.allowInsertRow)for(;e[o][0]>w.countRows()-1;)p.createRow();if("array"===w.dataType&&f.settings.allowInsertColumn)for(;p.propToCol(e[o][1])>w.countCols()-1;)p.createCol();p.set(e[o][0],e[o][1],e[o][3])}}else e.splice(o,1);w.forceFullRender=!0,m.adjustRowsAndCols(),t.hooks.run(w,"beforeChangeRender",e,n),g.refreshBorders(null,!0),t.hooks.run(w,"afterChange",e,n||"edit")}}function s(e,t,n){return"object"==typeof e?e:[[e,t,n]]}function a(e){if(e.hasOwnProperty("type")){var n,o={};if("object"==typeof e.type)n=e.type;else if("string"==typeof e.type&&(n=t.cellTypes[e.type],void 0===n))throw new Error('You declared cell type "'+e.type+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes');for(var r in n)n.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(o[r]=n[r]);return o}}function l(e){return t.hooks.run(w,"modifyRow",e)}function c(e){return t.hooks.run(w,"modifyCol",e)}function u(){throw new Error("This method cannot be called because this Handsontable instance has been destroyed")}var f,p,m,g,v,w=this,y=function(){},C=t.eventManager(w);t.helper.extend(y.prototype,O.prototype),t.helper.extend(y.prototype,n),t.helper.extend(y.prototype,a(n)),this.rootElement=e,this.container=document.createElement("DIV"),this.container.className="htContainer",e.insertBefore(this.container,e.firstChild),this.guid="ht_"+t.helper.randomString(),this.rootElement.id&&"ht_"!==this.rootElement.id.substring(0,3)||(this.rootElement.id=this.guid),f={cellSettings:[],columnSettings:[],columnsSettingConflicts:["data","width"],settings:new y,selRange:null,isPopulated:null,scrollable:null,firstRun:!0},m={alter:function(e,t,n,o,r){var i;switch(n=n||1,e){case"insert_row":i=p.createRow(t,n),i&&(g.isSelected()&&f.selRange.from.row>=t?(f.selRange.from.row=f.selRange.from.row+i,g.transformEnd(i,0)):g.refreshBorders());break;case"insert_col":if(i=p.createCol(t,n)){if(Array.isArray(w.getSettings().colHeaders)){var s=[t,0];s.length+=i,Array.prototype.splice.apply(w.getSettings().colHeaders,s)}g.isSelected()&&f.selRange.from.col>=t?(f.selRange.from.col=f.selRange.from.col+i,g.transformEnd(0,i)):g.refreshBorders()}break;case"remove_row":t=w.runHooks("modifyCol",t),p.removeRow(t,n),f.cellSettings.splice(t,n),m.adjustRowsAndCols(),g.refreshBorders();break;case"remove_col":p.removeCol(t,n);for(var a=0,l=p.getAll().length;l>a;a++)a in f.cellSettings&&f.cellSettings[a].splice(t,n);Array.isArray(w.getSettings().colHeaders)&&("undefined"==typeof t&&(t=-1),w.getSettings().colHeaders.splice(t,n)),m.adjustRowsAndCols(),g.refreshBorders();break;default:throw new Error('There is no such action "'+e+'"')}r||m.adjustRowsAndCols()},adjustRowsAndCols:function(){var e,t,n,o;if(t=w.countRows(),t<f.settings.minRows)for(e=0;e<f.settings.minRows-t;e++)p.createRow(w.countRows(),1,!0);if(n=w.countEmptyRows(!0),n<f.settings.minSpareRows)for(;n<f.settings.minSpareRows&&w.countRows()<f.settings.maxRows;n++)p.createRow(w.countRows(),1,!0);if(o=w.countEmptyCols(!0),!f.settings.columns&&w.countCols()<f.settings.minCols)for(;w.countCols()<f.settings.minCols;o++)p.createCol(w.countCols(),1,!0);if(!f.settings.columns&&"array"===w.dataType&&o<f.settings.minSpareCols)for(;o<f.settings.minSpareCols&&w.countCols()<f.settings.maxCols;o++)p.createCol(w.countCols(),1,!0);var r=w.countRows(),i=w.countCols();if((0===r||0===i)&&g.deselect(),g.isSelected()){var s,a=f.selRange.from.row,l=f.selRange.from.col,c=f.selRange.to.row,u=f.selRange.to.col;a>r-1?(a=r-1,s=!0,c>a&&(c=a)):c>r-1&&(c=r-1,s=!0,a>c&&(a=c)),l>i-1?(l=i-1,s=!0,u>l&&(u=l)):u>i-1&&(u=i-1,s=!0,l>u&&(l=u)),s&&w.selectCell(a,l,c,u)}},populateFromArray:function(e,n,o,r,i,s,a){var l,c,u,d,h=[],p={};if(c=n.length,0===c)return!1;var m,g,v,y;switch(i){case"shift_down":for(m=o?o.col-e.col+1:0,g=o?o.row-e.row+1:0,n=t.helper.translateRowsToColumns(n),u=0,d=n.length,v=Math.max(d,m);v>u;u++)if(d>u){for(l=0,c=n[u].length;g-c>l;l++)n[u].push(n[u][l%c]);n[u].unshift(e.col+u,e.row,0),w.spliceCol.apply(w,n[u])}else n[u%d][0]=e.col+u,w.spliceCol.apply(w,n[u%d]);break;case"shift_right":for(m=o?o.col-e.col+1:0,g=o?o.row-e.row+1:0,l=0,c=n.length,y=Math.max(c,g);y>l;l++)if(c>l){for(u=0,d=n[l].length;m-d>u;u++)n[l].push(n[l][u%d]);n[l].unshift(e.row+l,e.col,0),w.spliceRow.apply(w,n[l])}else n[l%c][0]=e.row+l,w.spliceRow.apply(w,n[l%c]);break;case"overwrite":default:p.row=e.row,p.col=e.col;var C={row:0,col:0},b={row:o&&e?o.row-e.row+1:1,col:o&&e?o.col-e.col+1:1};for(-1!==["up","left"].indexOf(s)?C={row:Math.ceil(b.row/c)||1,col:Math.ceil(b.col/n[0].length)||1}:-1!==["down","right"].indexOf(s)&&(C={row:1,col:1}),l=0;c>l&&!(o&&p.row>o.row||!f.settings.allowInsertRow&&p.row>w.countRows()-1||p.row>=f.settings.maxRows);l++){for(p.col=e.col,d=n[l]?n[l].length:0,u=0;d>u&&!(o&&p.col>o.col||!f.settings.allowInsertColumn&&p.col>w.countCols()-1||p.col>=f.settings.maxCols);u++){if(!w.getCellMeta(p.row,p.col).readOnly){var R,T=n[l][u],S={row:l,col:u};"autofill"===r&&(R=w.runHooks("beforeAutofillInsidePopulate",S,s,n,a,C,b),R&&(C="undefined"!=typeof R.iterators?R.iterators:C,T="undefined"!=typeof R.value?R.value:T)),h.push([p.row,p.col,T])}p.col++,o&&u===d-1&&(u=-1,-1!==["down","right"].indexOf(s)?C.col++:-1!==["up","left"].indexOf(s)&&C.col>1&&C.col--)}p.row++,C.col=1,o&&l===c-1&&(l=-1,-1!==["down","right"].indexOf(s)?C.row++:-1!==["up","left"].indexOf(s)&&C.row>1&&C.row--)}w.setDataAtCell(h,null,null,r||"populateFromArray")}}},this.selection=g={inProgress:!1,selectedHeader:{cols:!1,rows:!1},setSelectedHeaders:function(e,t){w.selection.selectedHeader.rows=e,w.selection.selectedHeader.cols=t},begin:function(){w.selection.inProgress=!0},finish:function(){var e=w.getSelected();t.hooks.run(w,"afterSelectionEnd",e[0],e[1],e[2],e[3]),t.hooks.run(w,"afterSelectionEndByProp",e[0],w.colToProp(e[1]),e[2],w.colToProp(e[3])),w.selection.inProgress=!1},isInProgress:function(){return w.selection.inProgress},setRangeStart:function(e,n){t.hooks.run(w,"beforeSetRangeStart",e),f.selRange=new h(e,e,e),g.setRangeEnd(e,null,n)},setRangeEnd:function(e,n,o){t.hooks.run(w,"beforeSetRangeEnd",e),w.selection.begin(),f.selRange.to=new d(e.row,e.col),f.settings.multiSelect||(f.selRange.from=e),w.view.wt.selections.current.clear(),w.view.wt.selections.current.add(f.selRange.highlight),w.view.wt.selections.area.clear(),g.isMultiple()&&(w.view.wt.selections.area.add(f.selRange.from),w.view.wt.selections.area.add(f.selRange.to)),(f.settings.currentRowClassName||f.settings.currentColClassName)&&(w.view.wt.selections.highlight.clear(),w.view.wt.selections.highlight.add(f.selRange.from),w.view.wt.selections.highlight.add(f.selRange.to)),t.hooks.run(w,"afterSelection",f.selRange.from.row,f.selRange.from.col,f.selRange.to.row,f.selRange.to.col),t.hooks.run(w,"afterSelectionByProp",f.selRange.from.row,p.colToProp(f.selRange.from.col),f.selRange.to.row,p.colToProp(f.selRange.to.col)),n!==!1&&w.view.mainViewIsActive()&&w.view.scrollViewport(f.selRange.from?f.selRange.from:e),g.refreshBorders(null,o)},refreshBorders:function(e,t){t||v.destroyEditor(e),w.view.render(),g.isSelected()&&!t&&v.prepareEditor()},isMultiple:function(){var e=!(f.selRange.to.col===f.selRange.from.col&&f.selRange.to.row===f.selRange.from.row),n=t.hooks.run(w,"afterIsMultipleSelection",e);return e?n:void 0},transformStart:function(e,t,n,o){var r=new d(e,t);w.runHooks("modifyTransformStart",r),f.selRange.highlight.row+e>w.countRows()-1?n&&f.settings.minSpareRows>0?w.alter("insert_row",w.countRows()):f.settings.autoWrapCol&&(r.row=1-w.countRows(),r.col=f.selRange.highlight.col+r.col==w.countCols()-1?1-w.countCols():1):f.settings.autoWrapCol&&f.selRange.highlight.row+r.row<0&&f.selRange.highlight.col+r.col>=0&&(r.row=w.countRows()-1,r.col=f.selRange.highlight.col+r.col==0?w.countCols()-1:-1),f.selRange.highlight.col+r.col>w.countCols()-1?n&&f.settings.minSpareCols>0?w.alter("insert_col",w.countCols()):f.settings.autoWrapRow&&(r.row=f.selRange.highlight.row+r.row==w.countRows()-1?1-w.countRows():1,r.col=1-w.countCols()):f.settings.autoWrapRow&&f.selRange.highlight.col+r.col<0&&f.selRange.highlight.row+r.row>=0&&(r.row=f.selRange.highlight.row+r.row==0?w.countRows()-1:-1,r.col=w.countCols()-1);var i=w.countRows(),s=w.countCols(),a=new d(f.selRange.highlight.row+r.row,f.selRange.highlight.col+r.col);a.row<0?a.row=0:a.row>0&&a.row>=i&&(a.row=i-1),a.col<0?a.col=0:a.col>0&&a.col>=s&&(a.col=s-1),g.setRangeStart(a,o)},transformEnd:function(e,t){var n=new d(e,t);w.runHooks("modifyTransformEnd",n);var o=w.countRows(),r=w.countCols(),i=new d(f.selRange.to.row+n.row,f.selRange.to.col+n.col);i.row<0?i.row=0:i.row>0&&i.row>=o&&(i.row=o-1),i.col<0?i.col=0:i.col>0&&i.col>=r&&(i.col=r-1),g.setRangeEnd(i)},isSelected:function(){return null!==f.selRange},inInSelection:function(e){return g.isSelected()?f.selRange.includes(e):!1},deselect:function(){g.isSelected()&&(w.selection.inProgress=!1,f.selRange=null,w.view.wt.selections.current.clear(),w.view.wt.selections.area.clear(),(f.settings.currentRowClassName||f.settings.currentColClassName)&&w.view.wt.selections.highlight.clear(),v.destroyEditor(),g.refreshBorders(),t.hooks.run(w,"afterDeselect"))},selectAll:function(){f.settings.multiSelect&&(g.setRangeStart(new d(0,0)),g.setRangeEnd(new d(w.countRows()-1,w.countCols()-1),!1))},empty:function(){if(g.isSelected()){var e,t,n=f.selRange.getTopLeftCorner(),o=f.selRange.getBottomRightCorner(),r=[];for(e=n.row;e<=o.row;e++)for(t=n.col;t<=o.col;t++)w.getCellMeta(e,t).readOnly||r.push([e,t,""]);w.setDataAtCell(r)}}},this.init=function(){t.hooks.run(w,"beforeInit"),t.mobileBrowser&&t.Dom.addClass(w.rootElement,"mobile"),this.updateSettings(f.settings,!0),this.view=new t.TableView(this),v=new t.EditorManager(w,f,g,p),this.forceFullRender=!0,this.view.render(),"object"==typeof f.firstRun&&(t.hooks.run(w,"afterChange",f.firstRun[0],f.firstRun[1]),f.firstRun=!1),t.hooks.run(w,"afterInit")},this.validateCell=function(e,n,o,r){var i=w.getCellValidator(n);"[object RegExp]"===Object.prototype.toString.call(i)&&(i=function(e){return function(t,n){n(e.test(t))}}(i)),"function"==typeof i?(e=t.hooks.run(w,"beforeValidate",e,n.row,n.prop,r),w._registerTimeout(setTimeout(function(){i.call(n,e,function(i){i=t.hooks.run(w,"afterValidate",i,e,n.row,n.prop,r),n.valid=i,o(i),t.hooks.run(w,"postAfterValidate",i,e,n.row,n.prop,r)})},0))):(n.valid=!0,o(!0))},this.setDataAtCell=function(e,t,n,o){var a,l,c,u=s(e,t,n),d=[];for(a=0,l=u.length;l>a;a++){if("object"!=typeof u[a])throw new Error("Method `setDataAtCell` accepts row number or changes array of arrays as its first parameter");if("number"!=typeof u[a][1])throw new Error("Method `setDataAtCell` accepts row and column number as its parameters. If you want to use object property name, use method `setDataAtRowProp`");c=p.colToProp(u[a][1]),d.push([u[a][0],c,p.get(u[a][0],c),u[a][2]])}o||"object"!=typeof e||(o=t),r(d,o,function(){i(d,o)})},this.setDataAtRowProp=function(e,t,n,o){var a,l,c=s(e,t,n),u=[];for(a=0,l=c.length;l>a;a++)u.push([c[a][0],c[a][1],p.get(c[a][0],c[a][1]),c[a][2]]);o||"object"!=typeof e||(o=t),r(u,o,function(){i(u,o)})},this.listen=function(){t.activeGuid=w.guid,document.activeElement&&document.activeElement!==document.body?document.activeElement.blur():document.activeElement||document.body.focus()},this.unlisten=function(){t.activeGuid=null},this.isListening=function(){return t.activeGuid===w.guid},this.destroyEditor=function(e){g.refreshBorders(e)},this.populateFromArray=function(e,t,n,o,r,i,s,a,l){var c;if("object"!=typeof n||"object"!=typeof n[0])throw new Error("populateFromArray parameter `input` must be an array of arrays");return c="number"==typeof o?new d(o,r):null,m.populateFromArray(new d(e,t),n,c,i,s,a,l)},this.spliceCol=function(){return p.spliceCol.apply(p,arguments)},this.spliceRow=function(){return p.spliceRow.apply(p,arguments)},this.getSelected=function(){return g.isSelected()?[f.selRange.from.row,f.selRange.from.col,f.selRange.to.row,f.selRange.to.col]:void 0},this.getSelectedRange=function(){return g.isSelected()?f.selRange:void 0},this.render=function(){w.view&&(w.forceFullRender=!0,g.refreshBorders(null,!0))},this.loadData=function(e){function n(){f.cellSettings.length=0}if("object"==typeof e&&null!==e)e.push&&e.splice||(e=[e]);else{if(null!==e)throw new Error("loadData only accepts array of objects or array of arrays ("+typeof e+" given)");e=[];for(var o,r=0,i=f.settings.startRows;i>r;r++){o=[];for(var s=0,a=f.settings.startCols;a>s;s++)o.push(null);e.push(o)}}f.isPopulated=!1,y.prototype.data=e,w.dataType=Array.isArray(f.settings.dataSchema)||Array.isArray(e[0])?"array":"function"==typeof f.settings.dataSchema?"function":"object",p=new t.DataMap(w,f,y),n(),m.adjustRowsAndCols(),t.hooks.run(w,"afterLoadData"),f.firstRun?f.firstRun=[null,"loadData"]:(t.hooks.run(w,"afterChange",null,"loadData"),w.render()),f.isPopulated=!0},this.getData=function(e,t,n,o){return"undefined"==typeof e?p.getAll():p.getRange(new d(e,t),new d(n,o),p.DESTINATION_RENDERER)},this.getCopyableData=function(e,t,n,o){return p.getCopyableText(new d(e,t),new d(n,o))},this.updateSettings=function(e,n){var o,r;if("undefined"!=typeof e.rows)throw new Error("'rows' setting is no longer supported. do you mean startRows, minRows or maxRows?");if("undefined"!=typeof e.cols)throw new Error("'cols' setting is no longer supported. do you mean startCols, minCols or maxCols?");for(o in e)"data"!==o&&(void 0!==t.hooks.hooks[o]||void 0!==t.hooks.legacy[o]?("function"==typeof e[o]||Array.isArray(e[o]))&&w.addHook(o,e[o]):!n&&e.hasOwnProperty(o)&&(y.prototype[o]=e[o]));if(void 0===e.data&&void 0===f.settings.data?w.loadData(null):void 0!==e.data?w.loadData(e.data):void 0!==e.columns&&p.createMap(),r=w.countCols(),f.cellSettings.length=0,r>0){var i,s;for(o=0;r>o;o++)f.columnSettings[o]=t.helper.columnFactory(y,f.columnsSettingConflicts),i=f.columnSettings[o].prototype,y.prototype.columns&&(s=y.prototype.columns[o],t.helper.extend(i,s),t.helper.extend(i,a(s)))}if("undefined"!=typeof e.cell)for(o in e.cell){var l=e.cell[o];
w.setCellMetaObject(l.row,l.col,l)}if(t.hooks.run(w,"afterCellMetaReset"),"undefined"!=typeof e.className&&(y.prototype.className&&t.Dom.removeClass(w.rootElement,y.prototype.className),e.className&&t.Dom.addClass(w.rootElement,e.className)),"undefined"!=typeof e.height){var c=e.height;"function"==typeof c&&(c=c()),w.rootElement.style.height=c+"px"}if("undefined"!=typeof e.width){var u=e.width;"function"==typeof u&&(u=u()),w.rootElement.style.width=u+"px"}c&&(w.rootElement.style.overflow="auto"),n||t.hooks.run(w,"afterUpdateSettings"),m.adjustRowsAndCols(),w.view&&!f.firstRun&&(w.forceFullRender=!0,g.refreshBorders(null,!0))},this.getValue=function(){var e=w.getSelected();if(y.prototype.getValue){if("function"==typeof y.prototype.getValue)return y.prototype.getValue.call(w);if(e)return w.getData()[e[0]][y.prototype.getValue]}else if(e)return w.getDataAtCell(e[0],e[1])},this.getSettings=function(){return f.settings},this.clear=function(){g.selectAll(),g.empty()},this.alter=function(e,t,n,o,r){m.alter(e,t,n,o,r)},this.getCell=function(e,t,n){return w.view.getCellAtCoords(new d(e,t),n)},this.getCoords=function(e){return this.view.wt.wtTable.getCoords.call(this.view.wt.wtTable,e)},this.colToProp=function(e){return p.colToProp(e)},this.propToCol=function(e){return p.propToCol(e)},this.getDataAtCell=function(e,t){return p.get(e,p.colToProp(t))},this.getDataAtRowProp=function(e,t){return p.get(e,t)},this.getDataAtCol=function(e){var t=[];return t.concat.apply(t,p.getRange(new d(0,e),new d(f.settings.data.length-1,e),p.DESTINATION_RENDERER))},this.getDataAtProp=function(e){var t,n=[];return t=p.getRange(new d(0,p.propToCol(e)),new d(f.settings.data.length-1,p.propToCol(e)),p.DESTINATION_RENDERER),n.concat.apply(n,t)},this.getSourceDataAtCol=function(e){for(var t=[],n=f.settings.data,o=0;o<n.length;o++)t.push(n[o][e]);return t},this.getSourceDataAtRow=function(e){return f.settings.data[e]},this.getDataAtRow=function(e){var t=p.getRange(new d(e,0),new d(e,this.countCols()-1),p.DESTINATION_RENDERER);return t[0]},this.removeCellMeta=function(e,t,n){var o=w.getCellMeta(e,t);void 0!=o[n]&&delete f.cellSettings[e][t][n]},this.setCellMetaObject=function(e,t,n){if("object"==typeof n)for(var o in n){var r=n[o];this.setCellMeta(e,t,o,r)}},this.setCellMeta=function(e,n,o,r){f.cellSettings[e]||(f.cellSettings[e]=[]),f.cellSettings[e][n]||(f.cellSettings[e][n]=new f.columnSettings[n]),f.cellSettings[e][n][o]=r,t.hooks.run(w,"afterSetCellMeta",e,n,o,r)},this.getCellMeta=function(e,n){var o,r=p.colToProp(n);if(e=l(e),n=c(n),f.columnSettings[n]||(f.columnSettings[n]=t.helper.columnFactory(y,f.columnsSettingConflicts)),f.cellSettings[e]||(f.cellSettings[e]=[]),f.cellSettings[e][n]||(f.cellSettings[e][n]=new f.columnSettings[n]),o=f.cellSettings[e][n],o.row=e,o.col=n,o.prop=r,o.instance=w,t.hooks.run(w,"beforeGetCellMeta",e,n,o),t.helper.extend(o,a(o)),o.cells){var i=o.cells.call(o,e,n,r);i&&(t.helper.extend(o,i),t.helper.extend(o,a(i)))}return t.hooks.run(w,"afterGetCellMeta",e,n,o),o};var b=t.helper.cellMethodLookupFactory("renderer");this.getCellRenderer=function(e,n){var o=b.call(this,e,n);return t.renderers.getRenderer(o)},this.getCellEditor=t.helper.cellMethodLookupFactory("editor"),this.getCellValidator=t.helper.cellMethodLookupFactory("validator"),this.validateCells=function(e){var t=new o;t.onQueueEmpty=e;for(var n=w.countRows()-1;n>=0;){for(var r=w.countCols()-1;r>=0;)t.addValidatorToQueue(),w.validateCell(w.getDataAtCell(n,r),w.getCellMeta(n,r),function(){t.removeValidatorFormQueue()},"validateCells"),r--;n--}t.checkIfQueueIsEmpty()},this.getRowHeader=function(e){if(void 0===e){for(var t=[],n=0,o=w.countRows();o>n;n++)t.push(w.getRowHeader(n));return t}return Array.isArray(f.settings.rowHeaders)&&void 0!==f.settings.rowHeaders[e]?f.settings.rowHeaders[e]:"function"==typeof f.settings.rowHeaders?f.settings.rowHeaders(e):f.settings.rowHeaders&&"string"!=typeof f.settings.rowHeaders&&"number"!=typeof f.settings.rowHeaders?e+1:f.settings.rowHeaders},this.hasRowHeaders=function(){return!!f.settings.rowHeaders},this.hasColHeaders=function(){if(void 0!==f.settings.colHeaders&&null!==f.settings.colHeaders)return!!f.settings.colHeaders;for(var e=0,t=w.countCols();t>e;e++)if(w.getColHeader(e))return!0;return!1},this.getColHeader=function(e){if(void 0===e){for(var n=[],o=0,r=w.countCols();r>o;o++)n.push(w.getColHeader(o));return n}var i=e;return e=t.hooks.run(w,"modifyCol",e),f.settings.columns&&f.settings.columns[e]&&f.settings.columns[e].title?f.settings.columns[e].title:Array.isArray(f.settings.colHeaders)&&void 0!==f.settings.colHeaders[e]?f.settings.colHeaders[e]:"function"==typeof f.settings.colHeaders?f.settings.colHeaders(e):f.settings.colHeaders&&"string"!=typeof f.settings.colHeaders&&"number"!=typeof f.settings.colHeaders?t.helper.spreadsheetColumnLabel(i):f.settings.colHeaders},this._getColWidthFromSettings=function(e){var t=w.getCellMeta(0,e),n=t.width;if((void 0===n||n===f.settings.width)&&(n=t.colWidths),void 0!==n&&null!==n){switch(typeof n){case"object":n=n[e];break;case"function":n=n(e)}"string"==typeof n&&(n=parseInt(n,10))}return n},this.getColWidth=function(e){var n=w._getColWidthFromSettings(e);return n||(n=50),n=t.hooks.run(w,"modifyColWidth",n,e)},this._getRowHeightFromSettings=function(e){var t=f.settings.rowHeights;if(void 0!==t&&null!==t){switch(typeof t){case"object":t=t[e];break;case"function":t=t(e)}"string"==typeof t&&(t=parseInt(t,10))}return t},this.getRowHeight=function(e){var n=w._getRowHeightFromSettings(e);return n=t.hooks.run(w,"modifyRowHeight",n,e)},this.countRows=function(){return f.settings.data.length},this.countCols=function(){return"object"===w.dataType||"function"===w.dataType?f.settings.columns&&f.settings.columns.length?f.settings.columns.length:p.colToPropCache.length:"array"===w.dataType?f.settings.columns&&f.settings.columns.length?f.settings.columns.length:f.settings.data&&f.settings.data[0]&&f.settings.data[0].length?f.settings.data[0].length:0:void 0},this.rowOffset=function(){return w.view.wt.wtTable.getFirstRenderedRow()},this.colOffset=function(){return w.view.wt.wtTable.getFirstRenderedColumn()},this.countRenderedRows=function(){return w.view.wt.drawn?w.view.wt.wtTable.getRenderedRowsCount():-1},this.countVisibleRows=function(){return w.view.wt.drawn?w.view.wt.wtTable.getVisibleRowsCount():-1},this.countRenderedCols=function(){return w.view.wt.drawn?w.view.wt.wtTable.getRenderedColumnsCount():-1},this.countVisibleCols=function(){return w.view.wt.drawn?w.view.wt.wtTable.getVisibleColumnsCount():-1},this.countEmptyRows=function(e){for(var n,o=w.countRows()-1,r=0;o>=0;){if(n=t.hooks.run(this,"modifyRow",o),w.isEmptyRow(n))r++;else if(e)break;o--}return r},this.countEmptyCols=function(e){if(w.countRows()<1)return 0;for(var t=w.countCols()-1,n=0;t>=0;){if(w.isEmptyCol(t))n++;else if(e)break;t--}return n},this.isEmptyRow=function(e){return f.settings.isEmptyRow.call(w,e)},this.isEmptyCol=function(e){return f.settings.isEmptyCol.call(w,e)},this.selectCell=function(e,t,n,o,r){if("number"!=typeof e||0>e||e>=w.countRows())return!1;if("number"!=typeof t||0>t||t>=w.countCols())return!1;if("undefined"!=typeof n){if("number"!=typeof n||0>n||n>=w.countRows())return!1;if("number"!=typeof o||0>o||o>=w.countCols())return!1}var i=new d(e,t);return f.selRange=new h(i,i,i),document.activeElement&&document.activeElement!==document.documentElement&&document.activeElement!==document.body&&document.activeElement.blur(),w.listen(),"undefined"==typeof n?g.setRangeEnd(f.selRange.from,r):g.setRangeEnd(new d(n,o),r),w.selection.finish(),!0},this.selectCellByProp=function(){return arguments[1]=p.propToCol(arguments[1]),"undefined"!=typeof arguments[3]&&(arguments[3]=p.propToCol(arguments[3])),w.selectCell.apply(w,arguments)},this.deselectCell=function(){g.deselect()},this.destroy=function(){w._clearTimeouts(),w.view&&w.view.destroy(),t.Dom.empty(w.rootElement),C.clear(),t.hooks.run(w,"afterDestroy"),t.hooks.destroy(w);for(var e in w)w.hasOwnProperty(e)&&("function"==typeof w[e]?"runHooks"!==e&&(w[e]=u):"guid"!==e&&(w[e]=null));f=null,p=null,m=null,g=null,v=null,w=null,y=null},this.getActiveEditor=function(){return v.getActiveEditor()},this.getInstance=function(){return w},this.addHook=function(e,n){t.hooks.add(e,n,w)},this.addHookOnce=function(e,n){t.hooks.once(e,n,w)},this.removeHook=function(e,n){t.hooks.remove(e,n,w)},this.runHooks=function(e,n,o,r,i,s,a){return t.hooks.run(w,e,n,o,r,i,s,a)},this.timeouts=[],this._registerTimeout=function(e){this.timeouts.push(e)},this._clearTimeouts=function(){for(var e=0,t=this.timeouts.length;t>e;e++)clearTimeout(this.timeouts[e])},this.version="0.12.4"};var O=function(){};if(O.prototype={data:void 0,dataSchema:void 0,width:void 0,height:void 0,startRows:5,startCols:5,rowHeaders:null,colHeaders:null,colWidths:void 0,columns:void 0,cells:void 0,cell:[],minRows:0,minCols:0,maxRows:1/0,maxCols:1/0,minSpareRows:0,minSpareCols:0,allowInsertRow:!0,allowInsertColumn:!0,allowRemoveRow:!0,allowRemoveColumn:!0,multiSelect:!0,fillHandle:!0,fixedRowsTop:0,fixedColumnsLeft:0,outsideClickDeselects:!0,enterBeginsEditing:!0,enterMoves:{row:1,col:0},tabMoves:{row:0,col:1},autoWrapRow:!1,autoWrapCol:!1,copyRowsLimit:1e3,copyColsLimit:1e3,pasteMode:"overwrite",currentRowClassName:void 0,currentColClassName:void 0,stretchH:"none",isEmptyRow:function(e){for(var t,n=0,o=this.countCols();o>n;n++)if(t=this.getDataAtCell(e,n),""!==t&&null!==t&&"undefined"!=typeof t)return!1;return!0},isEmptyCol:function(e){for(var t,n=0,o=this.countRows();o>n;n++)if(t=this.getDataAtCell(n,e),""!==t&&null!==t&&"undefined"!=typeof t)return!1;return!0},observeDOMVisibility:!0,allowInvalid:!0,invalidCellClassName:"htInvalid",placeholder:!1,placeholderCellClassName:"htPlaceholder",readOnlyCellClassName:"htDimmed",commentedCellClassName:"htCommentCell",fragmentSelection:!1,readOnly:!1,type:"text",copyable:!0,debug:!1,wordWrap:!0,noWordWrapClassName:"htNoWrap",contextMenu:void 0,undo:void 0,columnSorting:void 0,manualColumnMove:void 0,manualColumnResize:void 0,manualRowMove:void 0,manualRowResize:void 0,manualColumnFreeze:void 0,viewportRowRenderingOffset:10,viewportColumnRenderingOffset:10,groups:void 0},t.DefaultSettings=O,function(e){function t(){function e(e){return null!==e&&!n(e)&&("string"==typeof e||"number"==typeof e)}function t(e){return null!==e&&("object"==typeof e||"function"==typeof e)}function n(e){return e!==e}var o={arrayMap:[],weakMap:new WeakMap};return{get:function(n){return e(n)?o.arrayMap[n]:t(n)?o.weakMap.get(n):void 0},set:function(n,r){if(e(n))o.arrayMap[n]=r;else{if(!t(n))throw new Error("Invalid key type");o.weakMap.set(n,r)}},"delete":function(n){e(n)?delete o.arrayMap[n]:t(n)&&o.weakMap["delete"](n)}}}e.MultiMap||(e.MultiMap=t)}(e),!e.Handsontable)var t={};if(t.Dom={},t.Dom.enableImmediatePropagation=function(e){null!=e&&null==e.isImmediatePropagationEnabled&&(e.stopImmediatePropagation=function(){this.isImmediatePropagationEnabled=!1,this.cancelBubble=!0},e.isImmediatePropagationEnabled=!0,e.isImmediatePropagationStopped=function(){return!this.isImmediatePropagationEnabled})},t.Dom.closest=function(e,t,n){for(;null!=e&&e!==n;){if(1===e.nodeType&&t.indexOf(e.nodeName)>-1)return e;e=e.parentNode}return null},t.Dom.isChildOf=function(e,t){var n=e.parentNode,o=[];for("string"==typeof t?o=Array.prototype.slice.call(document.querySelectorAll(t),0):o.push(t);null!=n;){if(o.indexOf(n)>-1)return!0;n=n.parentNode}return!1},t.Dom.index=function(e){var t=0;if(e.previousSibling)for(;e=e.previousSibling;)++t;return t},document.documentElement.classList?(t.Dom.hasClass=function(e,t){return e.classList.contains(t)},t.Dom.addClass=function(e,t){t&&e.classList.add(t)},t.Dom.removeClass=function(e,t){e.classList.remove(t)}):(t.Dom.hasClass=function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},t.Dom.addClass=function(e,t){""===e.className?e.className=t:this.hasClass(e,t)||(e.className+=" "+t)},t.Dom.removeClass=function(e,t){if(this.hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ").trim()}}),t.Dom.removeTextNodes=function(e,t){if(3===e.nodeType)t.removeChild(e);else if(["TABLE","THEAD","TBODY","TFOOT","TR"].indexOf(e.nodeName)>-1)for(var n=e.childNodes,o=n.length-1;o>=0;o--)this.removeTextNodes(n[o],e)},t.Dom.empty=function(e){for(var t;t=e.lastChild;)e.removeChild(t)},t.Dom.HTML_CHARACTERS=/(<(.*)>|&(.*);)/,t.Dom.fastInnerHTML=function(e,t){this.HTML_CHARACTERS.test(t)?e.innerHTML=t:this.fastInnerText(e,t)},t.Dom.fastInnerText=document.createTextNode("test").textContent?function(e,t){var n=e.firstChild;n&&3===n.nodeType&&null===n.nextSibling?n.textContent=t:(this.empty(e),e.appendChild(document.createTextNode(t)))}:function(e,t){var n=e.firstChild;n&&3===n.nodeType&&null===n.nextSibling?n.data=t:(this.empty(e),e.appendChild(document.createTextNode(t)))},t.Dom.isVisible=function(e){for(var n=e;n!==document.documentElement;){if(null===n)return!1;if(11===n.nodeType){if(n.host){if(n.host.impl)return t.Dom.isVisible(n.host.impl);if(n.host)return t.Dom.isVisible(n.host);throw new Error("Lost in Web Components world")}return!1}if("none"===n.style.display)return!1;n=n.parentNode}return!0},t.Dom.offset=function(t){var n,o,r,i,s;if(i=document.documentElement,this.hasCaptionProblem()&&t.firstChild&&"CAPTION"===t.firstChild.nodeName)return s=t.getBoundingClientRect(),{top:s.top+(e.pageYOffset||i.scrollTop)-(i.clientTop||0),left:s.left+(e.pageXOffset||i.scrollLeft)-(i.clientLeft||0)};for(n=t.offsetLeft,o=t.offsetTop,r=t;(t=t.offsetParent)&&t!==document.body;)n+=t.offsetLeft,o+=t.offsetTop,r=t;return r&&"fixed"===r.style.position&&(n+=e.pageXOffset||i.scrollLeft,o+=e.pageYOffset||i.scrollTop),{left:n,top:o}},t.Dom.getWindowScrollTop=function(){var t=e.scrollY;return void 0==t&&(t=document.documentElement.scrollTop),t},t.Dom.getWindowScrollLeft=function(){var t=e.scrollX;return void 0==t&&(t=document.documentElement.scrollLeft),t},t.Dom.getScrollTop=function(n){return n===e?t.Dom.getWindowScrollTop(n):n.scrollTop},t.Dom.getScrollLeft=function(n){return n===e?t.Dom.getWindowScrollLeft(n):n.scrollLeft},t.Dom.getScrollableElement=function(t){for(var n,o,r,i=t.parentNode,s=["auto","scroll"];i&&i.style;){if(n=i.style.overflow,o=i.style.overflowX,r=i.style.overflowY,"scroll"==n||"scroll"==o||"scroll"==r)return i;if(i.clientHeight<i.scrollHeight&&(-1!==s.indexOf(r)||-1!==s.indexOf(n)))return i;if(i.clientWidth<i.scrollWidth&&(-1!==s.indexOf(o)||-1!==s.indexOf(n)))return i;i=i.parentNode}return e},t.Dom.getComputedStyle=function(e){return e.currentStyle||document.defaultView.getComputedStyle(e)},t.Dom.outerWidth=function(e){return e.offsetWidth},t.Dom.outerHeight=function(e){return this.hasCaptionProblem()&&e.firstChild&&"CAPTION"===e.firstChild.nodeName?e.offsetHeight+e.firstChild.offsetHeight:e.offsetHeight},t.Dom.innerHeight=function(e){return e.clientHeight||e.innerHeight},t.Dom.innerWidth=function(e){return e.clientWidth||e.innerWidth},t.Dom.addEvent=function(t,n,o){e.addEventListener?t.addEventListener(n,o,!1):t.attachEvent("on"+n,o)},t.Dom.removeEvent=function(t,n,o){e.removeEventListener?t.removeEventListener(n,o,!1):t.detachEvent("on"+n,o)},function(){function e(){var e=document.createElement("TABLE");e.style.borderSpacing=0,e.style.borderWidth=0,e.style.padding=0;var t=document.createElement("TBODY");e.appendChild(t),t.appendChild(document.createElement("TR")),t.firstChild.appendChild(document.createElement("TD")),t.firstChild.firstChild.innerHTML="<tr><td>t<br>t</td></tr>";var n=document.createElement("CAPTION");n.innerHTML="c<br>c<br>c<br>c",n.style.padding=0,n.style.margin=0,e.insertBefore(n,t),document.body.appendChild(e),o=e.offsetHeight<2*e.lastChild.offsetHeight,document.body.removeChild(e)}function n(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),(document.body||document.documentElement).appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var o=e.offsetWidth;return n==o&&(o=t.clientWidth),(document.body||document.documentElement).removeChild(t),n-o}var o;t.Dom.hasCaptionProblem=function(){return void 0===o&&e(),o},t.Dom.getCaretPosition=function(e){if(e.selectionStart)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange(),o=n.duplicate();return n.moveToBookmark(t.getBookmark()),o.setEndPoint("EndToStart",n),o.text.length}return 0},t.Dom.getSelectionEndPosition=function(e){if(e.selectionEnd)return e.selectionEnd;if(document.selection){var t=document.selection.createRange();if(null==t)return 0;var n=e.createTextRange();return n.text.indexOf(t.text)+t.text.length}},t.Dom.setCaretPosition=function(e,t,n){if(void 0===n&&(n=t),e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",n),o.moveStart("character",t),o.select()}};var r;t.Dom.getScrollbarWidth=function(){return void 0===r&&(r=n()),r};var i=!document.createTextNode("test").textContent;t.Dom.isIE8=function(){return i};var s=!!document.documentMode;t.Dom.isIE9=function(){return s};var a=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor);t.Dom.isSafari=function(){return a},t.Dom.setOverlayPosition=function(e,t,n){i||s?(e.style.top=n,e.style.left=t):a?e.style["-webkit-transform"]="translate3d("+t+","+n+",0)":e.style.transform="translate3d("+t+","+n+",0)"},t.Dom.getCssTransform=function(e){var t;return e.style.transform&&""!=(t=e.style.transform)?["transform",t]:e.style["-webkit-transform"]&&""!=(t=e.style["-webkit-transform"])?["-webkit-transform",t]:-1},t.Dom.resetCssTransform=function(e){e.transform&&""!=e.transform?e.transform="":e["-webkit-transform"]&&""!=e["-webkit-transform"]&&(e["-webkit-transform"]="")}}(),!e.Handsontable)var t={};t.countEventManagerListeners=0,t.eventManager=function(n){var o,r,i,s;if(!n)throw new Error("instance not defined");return n.eventListeners||(n.eventListeners=[]),o=function(o,i,s){var a;return a=function(e){void 0==e.target&&void 0!=e.srcElement&&(e.definePoperty?e.definePoperty("target",{value:e.srcElement}):e.target=e.srcElement),void 0==e.preventDefault&&(e.definePoperty?e.definePoperty("preventDefault",{value:function(){this.returnValue=!1}}):e.preventDefault=function(){this.returnValue=!1}),s.call(this,e)},n.eventListeners.push({element:o,event:i,callback:s,callbackProxy:a}),e.addEventListener?o.addEventListener(i,a,!1):o.attachEvent("on"+i,a),t.countEventManagerListeners++,function(){r(o,i,s)}},r=function(e,o,r){for(var i,s=n.eventListeners.length;s--;)if(i=n.eventListeners[s],i.event==o&&i.element==e){if(r&&r!=i.callback)continue;n.eventListeners.splice(s,1),i.element.removeEventListener?i.element.removeEventListener(i.event,i.callbackProxy,!1):i.element.detachEvent("on"+i.event,i.callbackProxy),t.countEventManagerListeners--}},i=function(){for(var e,t=n.eventListeners.length;t--;)e=n.eventListeners[t],e&&r(e.element,e.event,e.callback)},s=function(t,n){var o,r;o={bubbles:!0,cancelable:"mousemove"!==n,view:e,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0},document.createEvent?(r=document.createEvent("MouseEvents"),r.initMouseEvent(n,o.bubbles,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget||document.body.parentNode)):r=document.createEventObject(),t.dispatchEvent?t.dispatchEvent(r):t.fireEvent("on"+n,r)},{addEventListener:o,removeEventListener:r,clear:i,fireEvent:s}},t.TableView=function(n){var o=this;this.eventManager=t.eventManager(n),this.instance=n,this.settings=n.getSettings();var r=n.rootElement.getAttribute("style");r&&n.rootElement.setAttribute("data-originalstyle",r),t.Dom.addClass(n.rootElement,"handsontable");var i=document.createElement("TABLE");i.className="htCore",this.THEAD=document.createElement("THEAD"),i.appendChild(this.THEAD),this.TBODY=document.createElement("TBODY"),i.appendChild(this.TBODY),n.table=i,n.container.insertBefore(i,n.container.firstChild),this.eventManager.addEventListener(n.rootElement,"mousedown",function(t){o.isTextSelectionAllowed(t.target)||(a(),t.preventDefault(),e.focus())}),this.eventManager.addEventListener(document.documentElement,"keyup",function(e){n.selection.isInProgress()&&!e.shiftKey&&n.selection.finish()});var s;this.isMouseDown=function(){return s},this.eventManager.addEventListener(document.documentElement,"mouseup",function(e){n.selection.isInProgress()&&1===e.which&&n.selection.finish(),s=!1,t.helper.isOutsideInput(document.activeElement)&&n.unlisten()}),this.eventManager.addEventListener(document.documentElement,"mousedown",function(e){var t=e.target;if(!s){if(t!==o.wt.wtTable.spreader)for(;t!==document.documentElement;){if(null===t)return;if(t===n.rootElement)return;t=t.parentNode}o.settings.outsideClickDeselects?n.deselectCell():n.destroyEditor()}}),this.eventManager.addEventListener(i,"selectstart",function(e){o.settings.fragmentSelection||e.preventDefault()});var a=function(){e.getSelection?e.getSelection().empty?e.getSelection().empty():e.getSelection().removeAllRanges&&e.getSelection().removeAllRanges():document.selection&&document.selection.empty()},l=[new E({className:"current",border:{width:2,color:"#5292F7",cornerVisible:function(){return o.settings.fillHandle&&!o.isCellEdited()&&!n.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return!o.isCellEdited()&&!n.selection.isMultiple()}}}),new E({className:"area",border:{width:1,color:"#89AFF9",cornerVisible:function(){return o.settings.fillHandle&&!o.isCellEdited()&&n.selection.isMultiple()},multipleSelectionHandlesVisible:function(){return!o.isCellEdited()&&n.selection.isMultiple()}}}),new E({className:"highlight",highlightRowClassName:o.settings.currentRowClassName,highlightColumnClassName:o.settings.currentColClassName}),new E({className:"fill",border:{width:1,color:"red"}})];l.current=l[0],l.area=l[1],l.highlight=l[2],l.fill=l[3];var c={debug:function(){return o.settings.debug},table:i,stretchH:this.settings.stretchH,data:n.getDataAtCell,totalRows:n.countRows,totalColumns:n.countCols,fixedColumnsLeft:function(){return o.settings.fixedColumnsLeft},fixedRowsTop:function(){return o.settings.fixedRowsTop},renderAllRows:o.settings.renderAllRows,rowHeaders:function(){var e=[];return n.hasRowHeaders()&&e.push(function(e,t){o.appendRowHeader(e,t)}),t.hooks.run(n,"afterGetRowHeaderRenderers",e),e},columnHeaders:function(){var e=[];return n.hasColHeaders()&&e.push(function(e,t){o.appendColHeader(e,t)}),t.hooks.run(n,"afterGetColumnHeaderRenderers",e),e},columnWidth:n.getColWidth,rowHeight:n.getRowHeight,cellRenderer:function(e,n,r){var i=o.instance.colToProp(n),s=o.instance.getCellMeta(e,n),a=o.instance.getCellRenderer(s),l=o.instance.getDataAtRowProp(e,i);a(o.instance,r,e,n,i,l,s),t.hooks.run(o.instance,"afterRenderer",r,e,n,i,l,s)},selections:l,hideBorderOnMouseDownOver:function(){return o.settings.fragmentSelection},onCellMouseDown:function(e,r,i,a){n.listen(),o.activeWt=a,s=!0,t.hooks.run(n,"beforeOnCellMouseDown",e,r,i),t.Dom.enableImmediatePropagation(e),e.isImmediatePropagationStopped()||(2===e.button&&n.selection.inInSelection(r)||(e.shiftKey?r.row>=0&&r.col>=0&&n.selection.setRangeEnd(r):r.row<0||r.col<0?(r.row<0&&(n.selectCell(0,r.col,n.countRows()-1,r.col),n.selection.setSelectedHeaders(!1,!0)),r.col<0&&(n.selectCell(r.row,0,r.row,n.countCols()-1),n.selection.setSelectedHeaders(!0,!1))):n.selection.setRangeStart(r)),t.hooks.run(n,"afterOnCellMouseDown",e,r,i),o.activeWt=o.wt)},onCellMouseOver:function(e,r,i,a){o.activeWt=a,r.row>=0&&r.col>=0?s&&n.selection.setRangeEnd(r):s&&(r.row<0&&(n.selection.setRangeEnd(new d(n.countRows()-1,r.col)),n.selection.setSelectedHeaders(!1,!0)),r.col<0&&(n.selection.setRangeEnd(new d(r.row,n.countCols()-1)),n.selection.setSelectedHeaders(!0,!1))),t.hooks.run(n,"afterOnCellMouseOver",e,r,i),o.activeWt=o.wt},onCellCornerMouseDown:function(e){e.preventDefault(),t.hooks.run(n,"afterOnCellCornerMouseDown",e)},beforeDraw:function(e){o.beforeRender(e)},onDraw:function(e){o.onDraw(e)},onScrollVertically:function(){n.runHooks("afterScrollVertically")},onScrollHorizontally:function(){n.runHooks("afterScrollHorizontally")},onBeforeDrawBorders:function(e,t){n.runHooks("beforeDrawBorders",e,t)},onBeforeTouchScroll:function(){n.runHooks("beforeTouchScroll")},onAfterMomentumScroll:function(){n.runHooks("afterMomentumScroll")},viewportRowCalculatorOverride:function(e){o.settings.viewportRowRenderingOffset&&(e.startRow=Math.max(e.startRow-o.settings.viewportRowRenderingOffset,0),e.endRow=Math.min(e.endRow+o.settings.viewportRowRenderingOffset,n.countRows()-1)),n.runHooks("afterViewportRowCalculatorOverride",e)},viewportColumnCalculatorOverride:function(e){o.settings.viewportColumnRenderingOffset&&(e.startColumn=Math.max(e.startColumn-o.settings.viewportColumnRenderingOffset,0),e.endColumn=Math.min(e.endColumn+o.settings.viewportColumnRenderingOffset,n.countCols()-1)),n.runHooks("afterViewportColumnCalculatorOverride",e)}};t.hooks.run(n,"beforeInitWalkontable",c),this.wt=new m(c),this.activeWt=this.wt,this.eventManager.addEventListener(o.wt.wtTable.spreader,"mousedown",function(e){e.target===o.wt.wtTable.spreader&&3===e.which&&t.helper.stopPropagation(e)}),this.eventManager.addEventListener(o.wt.wtTable.spreader,"contextmenu",function(e){e.target===o.wt.wtTable.spreader&&3===e.which&&t.helper.stopPropagation(e)}),this.eventManager.addEventListener(document.documentElement,"click",function(){o.settings.observeDOMVisibility&&o.wt.drawInterrupted&&(o.instance.forceFullRender=!0,o.render())})},t.TableView.prototype.isTextSelectionAllowed=function(e){return t.helper.isInput(e)?!0:this.settings.fragmentSelection&&t.Dom.isChildOf(e,this.TBODY)?!0:!1},t.TableView.prototype.isCellEdited=function(){var e=this.instance.getActiveEditor();return e&&e.isOpened()},t.TableView.prototype.beforeRender=function(e){e&&t.hooks.run(this.instance,"beforeRender",this.instance.forceFullRender)},t.TableView.prototype.onDraw=function(e){e&&t.hooks.run(this.instance,"afterRender",this.instance.forceFullRender)},t.TableView.prototype.render=function(){this.wt.draw(!this.instance.forceFullRender),this.instance.forceFullRender=!1},t.TableView.prototype.getCellAtCoords=function(e,t){var n=this.wt.getCell(e,t);return 0>n?null:n},t.TableView.prototype.scrollViewport=function(e){this.wt.scrollViewport(e)},t.TableView.prototype.appendRowHeader=function(e,n){var o=document.createElement("DIV"),r=document.createElement("SPAN");o.className="relative",r.className="rowHeader",e>-1?t.Dom.fastInnerHTML(r,this.instance.getRowHeader(e)):t.Dom.fastInnerText(r,String.fromCharCode(160)),o.appendChild(r),t.Dom.empty(n),n.appendChild(o),t.hooks.run(this.instance,"afterGetRowHeader",e,n)},t.TableView.prototype.appendColHeader=function(e,n){var o=document.createElement("DIV"),r=document.createElement("SPAN");o.className="relative",r.className="colHeader",e>-1?t.Dom.fastInnerHTML(r,this.instance.getColHeader(e)):t.Dom.fastInnerText(r,String.fromCharCode(160)),o.appendChild(r),t.Dom.empty(n),n.appendChild(o),t.hooks.run(this.instance,"afterGetColHeader",e,n)},t.TableView.prototype.maximumVisibleElementWidth=function(e){var t=this.wt.wtViewport.getWorkspaceWidth(),n=t-e;return n>0?n:0},t.TableView.prototype.maximumVisibleElementHeight=function(e){var t=this.wt.wtViewport.getWorkspaceHeight(),n=t-e;return n>0?n:0},t.TableView.prototype.mainViewIsActive=function(){return this.wt===this.activeWt},t.TableView.prototype.destroy=function(){this.wt.destroy(),this.eventManager.clear()},function(e){function t(e){var t,n;n={},t=e,this.getInstance=function(e){return e.guid in n||(n[e.guid]=new t(e)),n[e.guid]}}var n={},o=new WeakMap;e.editors={registerEditor:function(e,r){var i=new t(r);"string"==typeof e&&(n[e]=i),o.set(r,i)},getEditor:function(e,t){var r;if("function"==typeof e)o.get(e)||this.registerEditor(null,e),r=o.get(e);else{if("string"!=typeof e)throw Error('Only strings and functions can be passed as "editor" parameter ');r=n[e]}if(!r)throw Error('No editor registered under name "'+e+'"');return r.getInstance(t)}}}(t),function(e){e.EditorManager=function(t,n,o){var r,i=this,s=e.helper.keyCode,a=!1,l=e.eventManager(t),c=function(){function c(l){if(t.isListening()&&(e.hooks.run(t,"beforeKeyDown",l),!a&&(e.Dom.enableImmediatePropagation(l),!l.isImmediatePropagationStopped()&&(n.lastKeyCode=l.keyCode,o.isSelected())))){var c=(l.ctrlKey||l.metaKey)&&!l.altKey;if(!(r.isWaiting()||e.helper.isMetaKey(l.keyCode)||c||i.isEditorOpened()))return void i.openEditor("");var u=l.shiftKey?o.setRangeEnd:o.setRangeStart;switch(l.keyCode){case s.A:c&&(o.selectAll(),l.preventDefault(),e.helper.stopPropagation(l));break;case s.ARROW_UP:i.isEditorOpened()&&!r.isWaiting()&&i.closeEditorAndSaveChanges(c),f(l.shiftKey),l.preventDefault(),e.helper.stopPropagation(l);break;case s.ARROW_DOWN:i.isEditorOpened()&&!r.isWaiting()&&i.closeEditorAndSaveChanges(c),p(l.shiftKey),l.preventDefault(),e.helper.stopPropagation(l);break;case s.ARROW_RIGHT:i.isEditorOpened()&&!r.isWaiting()&&i.closeEditorAndSaveChanges(c),m(l.shiftKey),l.preventDefault(),e.helper.stopPropagation(l);break;case s.ARROW_LEFT:i.isEditorOpened()&&!r.isWaiting()&&i.closeEditorAndSaveChanges(c),g(l.shiftKey),l.preventDefault(),e.helper.stopPropagation(l);break;case s.TAB:var v="function"==typeof n.settings.tabMoves?n.settings.tabMoves(l):n.settings.tabMoves;l.shiftKey?o.transformStart(-v.row,-v.col):o.transformStart(v.row,v.col,!0),l.preventDefault(),e.helper.stopPropagation(l);break;case s.BACKSPACE:case s.DELETE:o.empty(l),i.prepareEditor(),l.preventDefault();break;case s.F2:i.openEditor(),l.preventDefault();break;case s.ENTER:i.isEditorOpened()?(r.state!==e.EditorState.WAITING&&i.closeEditorAndSaveChanges(c),h(l.shiftKey)):t.getSettings().enterBeginsEditing?i.openEditor():h(l.shiftKey),l.preventDefault(),l.stopImmediatePropagation();break;case s.ESCAPE:i.isEditorOpened()&&i.closeEditorAndRestoreOriginalValue(c),l.preventDefault();break;case s.HOME:u(l.ctrlKey||l.metaKey?new d(0,n.selRange.from.col):new d(n.selRange.from.row,0)),l.preventDefault(),e.helper.stopPropagation(l);break;case s.END:u(l.ctrlKey||l.metaKey?new d(t.countRows()-1,n.selRange.from.col):new d(n.selRange.from.row,t.countCols()-1)),l.preventDefault(),e.helper.stopPropagation(l);break;case s.PAGE_UP:o.transformStart(-t.countVisibleRows(),0),l.preventDefault(),e.helper.stopPropagation(l);break;case s.PAGE_DOWN:o.transformStart(t.countVisibleRows(),0),l.preventDefault(),e.helper.stopPropagation(l)}}}function u(e,t,n){"TD"==n.nodeName&&i.openEditor()}function h(e){var t="function"==typeof n.settings.enterMoves?n.settings.enterMoves(event):n.settings.enterMoves;e?o.transformStart(-t.row,-t.col):o.transformStart(t.row,t.col,!0)}function f(e){e?o.transformEnd(-1,0):o.transformStart(-1,0)}function p(e){e?o.transformEnd(1,0):o.transformStart(1,0)}function m(e){e?o.transformEnd(0,1):o.transformStart(0,1)}function g(e){e?o.transformEnd(0,-1):o.transformStart(0,-1)}t.addHook("afterDocumentKeyDown",function(e){c(e)}),l.addEventListener(document,"keydown",function(e){t.runHooks("afterDocumentKeyDown",e)}),t.view.wt.update("onCellDblClick",u),t.addHook("afterDestroy",function(){a=!0})};this.destroyEditor=function(e){this.closeEditor(e)},this.getActiveEditor=function(){return r},this.prepareEditor=function(){if(r&&r.isWaiting())return void this.closeEditor(!1,!1,function(e){e&&i.prepareEditor()});var o=n.selRange.highlight.row,s=n.selRange.highlight.col,a=t.colToProp(s),l=t.getCell(o,s),c=t.getDataAtCell(o,s),u=t.getCellMeta(o,s),d=t.getCellEditor(u);r=e.editors.getEditor(d,t),r.prepare(o,s,a,l,c,u)},this.isEditorOpened=function(){return r.isOpened()},this.openEditor=function(e){r.cellProperties.readOnly||r.beginEditing(e)},this.closeEditor=function(e,t,n){r?r.finishEditing(e,t,n):n&&n(!1)},this.closeEditorAndSaveChanges=function(e){return this.closeEditor(!1,e)},this.closeEditorAndRestoreOriginalValue=function(e){return this.closeEditor(!0,e)},c()}}(t),function(e){var t={};e.renderers={registerRenderer:function(e,n){t[e]=n},getRenderer:function(e){if("function"==typeof e)return e;if("string"!=typeof e)throw Error('Only strings and functions can be passed as "renderer" parameter ');if(!(e in t))throw Error('No editor registered under name "'+e+'"');return t[e]}}}(t),t.helper={},t.helper.isPrintableChar=function(e){return 32==e||e>=48&&57>=e||e>=96&&111>=e||e>=186&&192>=e||e>=219&&222>=e||e>=226||e>=65&&90>=e
},t.helper.isMetaKey=function(e){var n=t.helper.keyCode,o=[n.ARROW_DOWN,n.ARROW_UP,n.ARROW_LEFT,n.ARROW_RIGHT,n.HOME,n.END,n.DELETE,n.BACKSPACE,n.F1,n.F2,n.F3,n.F4,n.F5,n.F6,n.F7,n.F8,n.F9,n.F10,n.F11,n.F12,n.TAB,n.PAGE_DOWN,n.PAGE_UP,n.ENTER,n.ESCAPE,n.SHIFT,n.CAPS_LOCK,n.ALT];return-1!=o.indexOf(e)},t.helper.isCtrlKey=function(e){var n=t.helper.keyCode;return-1!=[n.CONTROL_LEFT,224,n.COMMAND_LEFT,n.COMMAND_RIGHT].indexOf(e)},t.helper.stringify=function(e){switch(typeof e){case"string":case"number":return e+"";case"object":return null===e?"":e.toString();case"undefined":return"";default:return e.toString()}},t.helper.spreadsheetColumnLabel=function(e){for(var t,n=e+1,o="";n>0;)t=(n-1)%26,o=String.fromCharCode(65+t)+o,n=parseInt((n-t)/26,10);return o},t.helper.createSpreadsheetData=function(e,n){e="number"==typeof e?e:100,n="number"==typeof n?n:4;var o,r,i=[];for(o=0;e>o;o++){var s=[];for(r=0;n>r;r++)s.push(t.helper.spreadsheetColumnLabel(r)+(o+1));i.push(s)}return i},t.helper.createSpreadsheetObjectData=function(e,n){e="number"==typeof e?e:100,n="number"==typeof n?n:4;var o,r,i=[];for(o=0;e>o;o++){var s={};for(r=0;n>r;r++)s["prop"+r]=t.helper.spreadsheetColumnLabel(r)+(o+1);i.push(s)}return i},t.helper.isNumeric=function(e){var t=typeof e;return"number"==t?!isNaN(e)&&isFinite(e):"string"==t?e.length?1==e.length?/\d/.test(e):/^\s*[+-]?\s*(?:(?:\d+(?:\.\d+)?(?:e[+-]?\d+)?)|(?:0x[a-f\d]+))\s*$/i.test(e):!1:"object"==t?!(!e||"number"!=typeof e.valueOf()||e instanceof Date):!1},t.helper.randomString=function(){return w()},t.helper.inherit=function(e,t){return t.prototype.constructor=t,e.prototype=new t,e.prototype.constructor=e,e},t.helper.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},t.helper.deepExtend=function(e,n){for(var o in n)n.hasOwnProperty(o)&&(n[o]&&"object"==typeof n[o]?(e[o]||(e[o]=Array.isArray(n[o])?[]:{}),t.helper.deepExtend(e[o],n[o])):e[o]=n[o])},t.helper.deepClone=function(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e},t.helper.getPrototypeOf=function(e){var t;if("object"==typeof e.__proto__)t=e.__proto__;else{var n,o=e.constructor;"function"==typeof e.constructor&&(n=o,delete e.constructor&&(o=e.constructor,e.constructor=n)),t=o?o.prototype:null}return t},t.helper.columnFactory=function(e,n){function o(){}t.helper.inherit(o,e);for(var r=0,i=n.length;i>r;r++)o.prototype[n[r]]=void 0;return o},t.helper.translateRowsToColumns=function(e){var t,n,o,r,i=[],s=0;for(t=0,n=e.length;n>t;t++)for(o=0,r=e[t].length;r>o;o++)o==s&&(i.push([]),s++),i[o].push(e[t][o]);return i},t.helper.to2dArray=function(e){for(var t=0,n=e.length;n>t;)e[t]=[e[t]],t++},t.helper.extendArray=function(e,t){for(var n=0,o=t.length;o>n;)e.push(t[n]),n++},t.helper.isInput=function(e){var t=["INPUT","SELECT","TEXTAREA"];return t.indexOf(e.nodeName)>-1},t.helper.isOutsideInput=function(e){return t.helper.isInput(e)&&-1==e.className.indexOf("handsontableInput")},t.helper.keyCode={MOUSE_LEFT:1,MOUSE_RIGHT:3,MOUSE_MIDDLE:2,BACKSPACE:8,COMMA:188,INSERT:45,DELETE:46,END:35,ENTER:13,ESCAPE:27,CONTROL_LEFT:91,COMMAND_LEFT:17,COMMAND_RIGHT:93,ALT:18,HOME:36,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,SPACE:32,SHIFT:16,CAPS_LOCK:20,TAB:9,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_UP:38,ARROW_DOWN:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,A:65,X:88,C:67,V:86},t.helper.isObject=function(e){return"[object Object]"==Object.prototype.toString.call(e)},t.helper.pivot=function(e){var t=[];if(!e||0===e.length||!e[0]||0===e[0].length)return t;for(var n=e.length,o=e[0].length,r=0;n>r;r++)for(var i=0;o>i;i++)t[i]||(t[i]=[]),t[i][r]=e[r][i];return t},t.helper.proxy=function(e,t){return function(){return e.apply(t,arguments)}},t.helper.cellMethodLookupFactory=function(e,n){function o(e){var n=t.cellTypes[e];if("undefined"==typeof n)throw new Error('You declared cell type "'+e+'" as a string that is not mapped to a known object. Cell type must be an object or a string mapped to an object in Handsontable.cellTypes');return n}return n="undefined"==typeof n?!0:n,function(r,i){return function s(r){if(r){if(r.hasOwnProperty(e)&&void 0!==r[e])return r[e];if(r.hasOwnProperty("type")&&r.type){var i;if("string"!=typeof r.type)throw new Error("Cell type must be a string ");if(i=o(r.type),i.hasOwnProperty(e))return i[e];if(n)return}return s(t.helper.getPrototypeOf(r))}}("number"==typeof r?this.getCellMeta(r,i):r)}},t.helper.isMobileBrowser=function(e){return e||(e=navigator.userAgent),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)},t.helper.isTouchSupported=function(){return"ontouchstart"in e},t.helper.stopPropagation=function(e){"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},t.helper.pageX=function(e){if(e.pageX)return e.pageX;var n=t.Dom.getWindowScrollLeft(),o=e.clientX+n;return o},t.helper.pageY=function(e){if(e.pageY)return e.pageY;var n=t.Dom.getWindowScrollTop(),o=e.clientY+n;return o},function(e){e.DataMap=function(e,t,n){this.instance=e,this.priv=t,this.GridSettings=n,this.dataSource=this.instance.getSettings().data,this.duckSchema=this.dataSource[0]?this.recursiveDuckSchema(this.dataSource[0]):{},this.createMap()},e.DataMap.prototype.DESTINATION_RENDERER=1,e.DataMap.prototype.DESTINATION_CLIPBOARD_GENERATOR=2,e.DataMap.prototype.recursiveDuckSchema=function(e){var t;if(Array.isArray(e))t=[];else{t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]="object"!=typeof e[n]||Array.isArray(e[n])?null:this.recursiveDuckSchema(e[n]))}return t},e.DataMap.prototype.recursiveDuckColumns=function(e,t,n){var o,r;if("undefined"==typeof t&&(t=0,n=""),"object"==typeof e&&!Array.isArray(e))for(r in e)e.hasOwnProperty(r)&&(null===e[r]?(o=n+r,this.colToPropCache.push(o),this.propToColCache.set(o,t),t++):t=this.recursiveDuckColumns(e[r],t,r+"."));return t},e.DataMap.prototype.createMap=function(){var e,t,n=this.getSchema();if("undefined"==typeof n)throw new Error("trying to create `columns` definition but you didnt' provide `schema` nor `data`");this.colToPropCache=[],this.propToColCache=new MultiMap;var o=this.instance.getSettings().columns;if(o)for(e=0,t=o.length;t>e;e++)"undefined"!=typeof o[e].data&&(this.colToPropCache[e]=o[e].data,this.propToColCache.set(o[e].data,e));else this.recursiveDuckColumns(n)},e.DataMap.prototype.colToProp=function(t){return t=e.hooks.run(this.instance,"modifyCol",t),this.colToPropCache&&"undefined"!=typeof this.colToPropCache[t]?this.colToPropCache[t]:t},e.DataMap.prototype.propToCol=function(t){var n;return n="undefined"!=typeof this.propToColCache.get(t)?this.propToColCache.get(t):t,n=e.hooks.run(this.instance,"modifyCol",n)},e.DataMap.prototype.getSchema=function(){var e=this.instance.getSettings().dataSchema;return e?"function"==typeof e?e():e:this.duckSchema},e.DataMap.prototype.createRow=function(t,n,o){var r,i,s=this.instance.countCols(),a=0;n||(n=1),("number"!=typeof t||t>=this.instance.countRows())&&(t=this.instance.countRows()),i=t;for(var l=this.instance.getSettings().maxRows;n>a&&this.instance.countRows()<l;){if("array"===this.instance.dataType){r=[];for(var c=0;s>c;c++)r.push(null)}else"function"===this.instance.dataType?r=this.instance.getSettings().dataSchema(t):(r={},e.helper.deepExtend(r,this.getSchema()));t===this.instance.countRows()?this.dataSource.push(r):this.dataSource.splice(t,0,r),a++,i++}return e.hooks.run(this.instance,"afterCreateRow",t,a,o),this.instance.forceFullRender=!0,a},e.DataMap.prototype.createCol=function(t,n,o){if("object"===this.instance.dataType||this.instance.getSettings().columns)throw new Error("Cannot create new column. When data source in an object, you can only have as much columns as defined in first data row, data schema or in the 'columns' setting.If you want to be able to add new columns, you have to use array datasource.");var r,i,s=this.instance.countRows(),a=this.dataSource,l=0;n||(n=1),i=t;for(var c=this.instance.getSettings().maxCols;n>l&&this.instance.countCols()<c;){if(r=e.helper.columnFactory(this.GridSettings,this.priv.columnsSettingConflicts),"number"!=typeof t||t>=this.instance.countCols()){for(var u=0;s>u;u++)"undefined"==typeof a[u]&&(a[u]=[]),a[u].push(null);this.priv.columnSettings.push(r)}else{for(var u=0;s>u;u++)a[u].splice(i,0,null);this.priv.columnSettings.splice(i,0,r)}l++,i++}return e.hooks.run(this.instance,"afterCreateCol",t,l,o),this.instance.forceFullRender=!0,l},e.DataMap.prototype.removeRow=function(t,n){n||(n=1),"number"!=typeof t&&(t=-n),t=(this.instance.countRows()+t)%this.instance.countRows();var o=this.physicalRowsToLogical(t,n),r=e.hooks.run(this.instance,"beforeRemoveRow",t,n);if(r!==!1){var i=this.dataSource,s=i.filter(function(e,t){return-1==o.indexOf(t)});i.length=0,Array.prototype.push.apply(i,s),e.hooks.run(this.instance,"afterRemoveRow",t,n),this.instance.forceFullRender=!0}},e.DataMap.prototype.removeCol=function(t,n){if("object"===this.instance.dataType||this.instance.getSettings().columns)throw new Error("cannot remove column with object data source or columns option specified");n||(n=1),"number"!=typeof t&&(t=-n),t=(this.instance.countCols()+t)%this.instance.countCols();var o=e.hooks.run(this.instance,"beforeRemoveCol",t,n);if(o!==!1){for(var r=this.dataSource,i=0,s=this.instance.countRows();s>i;i++)r[i].splice(t,n);this.priv.columnSettings.splice(t,n),e.hooks.run(this.instance,"afterRemoveCol",t,n),this.instance.forceFullRender=!0}},e.DataMap.prototype.spliceCol=function(t,n,o){var r=4<=arguments.length?[].slice.call(arguments,3):[],i=this.instance.getDataAtCol(t),s=i.slice(n,n+o),a=i.slice(n+o);e.helper.extendArray(r,a);for(var l=0;o>l;)r.push(null),l++;return e.helper.to2dArray(r),this.instance.populateFromArray(n,t,r,null,null,"spliceCol"),s},e.DataMap.prototype.spliceRow=function(t,n,o){var r=4<=arguments.length?[].slice.call(arguments,3):[],i=this.instance.getSourceDataAtRow(t),s=i.slice(n,n+o),a=i.slice(n+o);e.helper.extendArray(r,a);for(var l=0;o>l;)r.push(null),l++;return this.instance.populateFromArray(t,n,[r],null,null,"spliceRow"),s},e.DataMap.prototype.get=function(t,n){if(t=e.hooks.run(this.instance,"modifyRow",t),"string"==typeof n&&n.indexOf(".")>-1){var o=n.split("."),r=this.dataSource[t];if(!r)return null;for(var i=0,s=o.length;s>i;i++)if(r=r[o[i]],"undefined"==typeof r)return null;return r}return"function"==typeof n?n(this.dataSource.slice(t,t+1)[0]):this.dataSource[t]?this.dataSource[t][n]:null};var t=e.helper.cellMethodLookupFactory("copyable",!1);e.DataMap.prototype.getCopyable=function(e,n){return t.call(this.instance,e,this.propToCol(n))?this.get(e,n):""},e.DataMap.prototype.set=function(t,n,o,r){if(t=e.hooks.run(this.instance,"modifyRow",t,r||"datamapGet"),"string"==typeof n&&n.indexOf(".")>-1){for(var i=n.split("."),s=this.dataSource[t],a=0,l=i.length-1;l>a;a++)"undefined"==typeof s[i[a]]&&(s[i[a]]={}),s=s[i[a]];s[i[a]]=o}else"function"==typeof n?n(this.dataSource.slice(t,t+1)[0],o):this.dataSource[t][n]=o},e.DataMap.prototype.physicalRowsToLogical=function(t,n){for(var o,r=this.instance.countRows(),i=(r+t)%r,s=[],a=n;r>i&&a;)o=e.hooks.run(this.instance,"modifyRow",i),s.push(o),a--,i++;return s},e.DataMap.prototype.clear=function(){for(var e=0;e<this.instance.countRows();e++)for(var t=0;t<this.instance.countCols();t++)this.set(e,this.colToProp(t),"")},e.DataMap.prototype.getAll=function(){return this.dataSource},e.DataMap.prototype.getRange=function(e,t,n){var o,r,i,s,a,l=[],c=n===this.DESTINATION_CLIPBOARD_GENERATOR?this.getCopyable:this.get;for(r=Math.max(e.row,t.row),s=Math.max(e.col,t.col),o=Math.min(e.row,t.row);r>=o;o++){for(a=[],i=Math.min(e.col,t.col);s>=i;i++)a.push(c.call(this,o,this.colToProp(i)));l.push(a)}return l},e.DataMap.prototype.getText=function(e,t){return SheetClip.stringify(this.getRange(e,t,this.DESTINATION_RENDERER))},e.DataMap.prototype.getCopyableText=function(e,t){return SheetClip.stringify(this.getRange(e,t,this.DESTINATION_CLIPBOARD_GENERATOR))}}(t),function(e){e.renderers.cellDecorator=function(t,n,o,r,i,s,a){a.className&&(n.className=n.className?n.className+" "+a.className:a.className),a.readOnly&&e.Dom.addClass(n,a.readOnlyCellClassName),a.valid===!1&&a.invalidCellClassName&&e.Dom.addClass(n,a.invalidCellClassName),a.wordWrap===!1&&a.noWordWrapClassName&&e.Dom.addClass(n,a.noWordWrapClassName),!s&&a.placeholder&&e.Dom.addClass(n,a.placeholderCellClassName)}}(t),function(e){var t=function(t,n,o,r,i,s,a){e.renderers.cellDecorator.apply(this,arguments),!s&&a.placeholder&&(s=a.placeholder);var l=e.helper.stringify(s);if(a.rendererTemplate){e.Dom.empty(n);var c=document.createElement("TEMPLATE");c.setAttribute("bind","{{}}"),c.innerHTML=a.rendererTemplate,HTMLTemplateElement.decorate(c),c.model=t.getSourceDataAtRow(o),n.appendChild(c)}else e.Dom.fastInnerText(n,l)};e.renderers.TextRenderer=t,e.renderers.registerRenderer("text",t)}(t),function(e){var t=document.createElement("DIV");t.className="htAutocompleteWrapper";var n=document.createElement("DIV");n.className="htAutocompleteArrow",n.appendChild(document.createTextNode(String.fromCharCode(9660)));var o=function(o,r,i,s,a,l,c){var u=(t.cloneNode(!0),n.cloneNode(!0));if(e.renderers.TextRenderer(o,r,i,s,a,l,c),r.appendChild(u),e.Dom.addClass(r,"htAutocomplete"),r.firstChild||r.appendChild(document.createTextNode(String.fromCharCode(160))),!o.acArrowListener){var h=e.eventManager(o);o.acArrowListener=function(t){e.Dom.hasClass(t.target,"htAutocompleteArrow")&&o.view.wt.getSetting("onCellDblClick",null,new d(i,s),r)},h.addEventListener(o.rootElement,"mousedown",o.acArrowListener),o.addHookOnce("afterDestroy",function(){h.clear()})}};e.AutocompleteRenderer=o,e.renderers.AutocompleteRenderer=o,e.renderers.registerRenderer("autocomplete",o)}(t),function(e){var t=document.createElement("INPUT");t.className="htCheckboxRendererInput",t.type="checkbox",t.setAttribute("autocomplete","off");var n=function(n,o,r,i,s,a,l){var c=e.eventManager(n);"undefined"==typeof l.checkedTemplate&&(l.checkedTemplate=!0),"undefined"==typeof l.uncheckedTemplate&&(l.uncheckedTemplate=!1),e.Dom.empty(o);var u=t.cloneNode(!1);a===l.checkedTemplate||a===e.helper.stringify(l.checkedTemplate)?(u.checked=!0,o.appendChild(u)):a===l.uncheckedTemplate||a===e.helper.stringify(l.uncheckedTemplate)?o.appendChild(u):null===a?(u.className+=" noValue",o.appendChild(u)):e.Dom.fastInnerText(o,"#bad value#"),l.readOnly?c.addEventListener(u,"click",function(e){e.preventDefault()}):(c.addEventListener(u,"mousedown",function(t){e.helper.stopPropagation(t)}),c.addEventListener(u,"mouseup",function(t){e.helper.stopPropagation(t)}),c.addEventListener(u,"change",function(){this.checked?n.setDataAtRowProp(r,s,l.checkedTemplate):n.setDataAtRowProp(r,s,l.uncheckedTemplate)})),n.CheckboxRenderer&&n.CheckboxRenderer.beforeKeyDownHookBound||(n.CheckboxRenderer={beforeKeyDownHookBound:!0},n.addHook("beforeKeyDown",function(t){if(e.Dom.enableImmediatePropagation(t),t.keyCode==e.helper.keyCode.SPACE||t.keyCode==e.helper.keyCode.ENTER)for(var o,r,i,s=n.getSelectedRange(),a=s.getTopLeftCorner(),l=s.getBottomRightCorner(),u=a.row;u<=l.row;u++)for(var d=a.col;d<=l.col;d++)if(o=n.getCell(u,d),i=n.getCellMeta(u,d),r=o.querySelectorAll("input[type=checkbox]"),r.length>0&&!i.readOnly){t.isImmediatePropagationStopped()||(t.stopImmediatePropagation(),t.preventDefault());for(var h=0,f=r.length;f>h;h++)r[h].checked=!r[h].checked,c.fireEvent(r[h],"change")}}))};e.CheckboxRenderer=n,e.renderers.CheckboxRenderer=n,e.renderers.registerRenderer("checkbox",n)}(t),function(e){var t=function(t,n,o,r,i,s,a){e.helper.isNumeric(s)&&("undefined"!=typeof a.language&&numeral.language(a.language),s=numeral(s).format(a.format||"0"),e.Dom.addClass(n,"htNumeric")),e.renderers.TextRenderer(t,n,o,r,i,s,a)};e.NumericRenderer=t,e.renderers.NumericRenderer=t,e.renderers.registerRenderer("numeric",t)}(t),function(e){var t=function(t,n,o,r,i,s,a){e.renderers.TextRenderer.apply(this,arguments),s=n.innerHTML;var l,c=a.hashLength||s.length,u=a.hashSymbol||"*";for(l="";l.split(u).length-1<c;l+=u);e.Dom.fastInnerHTML(n,l)};e.PasswordRenderer=t,e.renderers.PasswordRenderer=t,e.renderers.registerRenderer("password",t)}(t),function(e){function t(t,n,o,r,i,s){e.renderers.cellDecorator.apply(this,arguments),e.Dom.fastInnerHTML(n,s)}e.renderers.registerRenderer("html",t),e.renderers.HtmlRenderer=t}(t),function(e){function t(t){this.instance=t,this.state=e.EditorState.VIRGIN,this._opened=!1,this._closeCallback=null,this.init()}e.EditorState={VIRGIN:"STATE_VIRGIN",EDITING:"STATE_EDITING",WAITING:"STATE_WAITING",FINISHED:"STATE_FINISHED"},t.prototype._fireCallbacks=function(e){this._closeCallback&&(this._closeCallback(e),this._closeCallback=null)},t.prototype.init=function(){},t.prototype.getValue=function(){throw Error("Editor getValue() method unimplemented")},t.prototype.setValue=function(){throw Error("Editor setValue() method unimplemented")},t.prototype.open=function(){throw Error("Editor open() method unimplemented")},t.prototype.close=function(){throw Error("Editor close() method unimplemented")},t.prototype.prepare=function(t,n,o,r,i,s){this.TD=r,this.row=t,this.col=n,this.prop=o,this.originalValue=i,this.cellProperties=s,this.state=e.EditorState.VIRGIN},t.prototype.extend=function(){function e(){n.apply(this,arguments)}function t(e,t){function n(){}return n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e}var n=this.constructor;return t(e,n)},t.prototype.saveValue=function(e,t){if(t){var n,o=this.instance.getSelected();o[0]>o[2]&&(n=o[0],o[0]=o[2],o[2]=n),o[1]>o[3]&&(n=o[1],o[1]=o[3],o[3]=n),this.instance.populateFromArray(o[0],o[1],e,o[2],o[3],"edit")}else this.instance.populateFromArray(this.row,this.col,e,null,null,"edit")},t.prototype.beginEditing=function(t){this.state==e.EditorState.VIRGIN&&(this.instance.view.scrollViewport(new d(this.row,this.col)),this.instance.view.render(),this.state=e.EditorState.EDITING,t="string"==typeof t?t:this.originalValue,this.setValue(e.helper.stringify(t)),this.open(),this._opened=!0,this.focus(),this.instance.view.render())},t.prototype.finishEditing=function(t,n,o){var r=this;if(o){var i=this._closeCallback;this._closeCallback=function(e){i&&i(e),o(e)}}if(!this.isWaiting()){if(this.state==e.EditorState.VIRGIN)return void this.instance._registerTimeout(setTimeout(function(){r._fireCallbacks(!0)},0));if(this.state==e.EditorState.EDITING){if(t)return this.cancelChanges(),void this.instance.view.render();var s=[[String.prototype.trim.call(this.getValue())]];this.state=e.EditorState.WAITING,this.saveValue(s,n),this.instance.getCellValidator(this.cellProperties)?this.instance.addHookOnce("postAfterValidate",function(t){r.state=e.EditorState.FINISHED,r.discardEditor(t)}):(this.state=e.EditorState.FINISHED,this.discardEditor(!0))}}},t.prototype.cancelChanges=function(){this.state=e.EditorState.FINISHED,this.discardEditor()},t.prototype.discardEditor=function(t){this.state===e.EditorState.FINISHED&&(t===!1&&this.cellProperties.allowInvalid!==!0?(this.instance.selectCell(this.row,this.col),this.focus(),this.state=e.EditorState.EDITING,this._fireCallbacks(!1)):(this.close(),this._opened=!1,this.state=e.EditorState.VIRGIN,this._fireCallbacks(!0)))},t.prototype.isOpened=function(){return this._opened},t.prototype.isWaiting=function(){return this.state===e.EditorState.WAITING},e.editors.BaseEditor=t}(t),function(e){var t=e.editors.BaseEditor.prototype.extend();t.prototype.init=function(){var t=this;this.createElements(),this.eventManager=new e.eventManager(this),this.bindEvents(),this.autoResize=N(),this.instance.addHook("afterDestroy",function(){t.destroy()})},t.prototype.getValue=function(){return this.TEXTAREA.value},t.prototype.setValue=function(e){this.TEXTAREA.value=e};var n=function(t){var n=this,o=n.getActiveEditor(),r=e.helper.keyCode,i=(t.ctrlKey||t.metaKey)&&!t.altKey;if(e.Dom.enableImmediatePropagation(t),t.target===o.TEXTAREA&&!t.isImmediatePropagationStopped()){if(17===t.keyCode||224===t.keyCode||91===t.keyCode||93===t.keyCode)return void t.stopImmediatePropagation();switch(t.keyCode){case r.ARROW_RIGHT:e.Dom.getCaretPosition(o.TEXTAREA)!==o.TEXTAREA.value.length&&t.stopImmediatePropagation();break;case r.ARROW_LEFT:0!==e.Dom.getCaretPosition(o.TEXTAREA)&&t.stopImmediatePropagation();break;case r.ENTER:var s=o.instance.getSelected(),a=!(s[0]===s[2]&&s[1]===s[3]);(i&&!a||t.altKey)&&(o.isOpened()?(o.setValue(o.getValue()+"\n"),o.focus()):o.beginEditing(o.originalValue+"\n"),t.stopImmediatePropagation()),t.preventDefault();break;case r.A:case r.X:case r.C:case r.V:i&&t.stopImmediatePropagation();break;case r.BACKSPACE:case r.DELETE:case r.HOME:case r.END:t.stopImmediatePropagation()}o.autoResize.resize(String.fromCharCode(t.keyCode))}};t.prototype.open=function(){this.refreshDimensions(),this.instance.addHook("beforeKeyDown",n)},t.prototype.close=function(){this.textareaParentStyle.display="none",this.autoResize.unObserve(),document.activeElement===this.TEXTAREA&&this.instance.listen(),this.instance.removeHook("beforeKeyDown",n)},t.prototype.focus=function(){this.TEXTAREA.focus(),e.Dom.setCaretPosition(this.TEXTAREA,this.TEXTAREA.value.length)},t.prototype.createElements=function(){this.TEXTAREA=document.createElement("TEXTAREA"),e.Dom.addClass(this.TEXTAREA,"handsontableInput"),this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,this.TEXTAREA_PARENT=document.createElement("DIV"),e.Dom.addClass(this.TEXTAREA_PARENT,"handsontableInputHolder"),this.textareaParentStyle=this.TEXTAREA_PARENT.style,this.textareaParentStyle.top=0,this.textareaParentStyle.left=0,this.textareaParentStyle.display="none",this.TEXTAREA_PARENT.appendChild(this.TEXTAREA),this.instance.rootElement.appendChild(this.TEXTAREA_PARENT);var t=this;this.instance._registerTimeout(setTimeout(function(){t.refreshDimensions()},0))},t.prototype.checkEditorSection=function(){return this.row<this.instance.getSettings().fixedRowsTop?this.col<this.instance.getSettings().fixedColumnsLeft?"corner":"top":this.col<this.instance.getSettings().fixedColumnsLeft?"left":void 0},t.prototype.getEditedCell=function(){var e,t=this.checkEditorSection();switch(t){case"top":e=this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=101;break;case"corner":e=this.instance.view.wt.wtScrollbars.corner.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=103;break;case"left":e=this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.getCell({row:this.row,col:this.col}),this.textareaParentStyle.zIndex=102;break;default:e=this.instance.getCell(this.row,this.col),this.textareaParentStyle.zIndex=""}return-1!=e&&-2!=e?e:void 0},t.prototype.refreshDimensions=function(){if(this.state===e.EditorState.EDITING&&(this.TD=this.getEditedCell(),this.TD)){var t,n=e.Dom.offset(this.TD),o=e.Dom.offset(this.instance.rootElement),r=n.top-o.top-1,i=n.left-o.left-1,s=this.instance.getSettings(),a=s.rowHeaders===!1?0:1,l=s.colHeaders===!1?0:1,c=this.checkEditorSection();switch(c){case"top":t=e.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.holder.parentNode);break;case"left":t=e.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.holder.parentNode);break;case"corner":t=e.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.corner.clone.wtTable.holder.parentNode)}0>r&&(r=0),0>i&&(i=0),a>0&&parseInt(this.TD.style.borderTopWidth,10)>0&&(r+=1),l>0&&parseInt(this.TD.style.borderLeftWidth,10)>0&&(i+=1),t&&-1!=t?this.textareaParentStyle[t[0]]=t[1]:e.Dom.resetCssTransform(this.textareaParentStyle),this.textareaParentStyle.top=r+"px",this.textareaParentStyle.left=i+"px";var u=this.TD.offsetTop-this.instance.view.wt.wtScrollbars.vertical.getScrollPosition(),d=this.TD.offsetLeft-this.instance.view.wt.wtScrollbars.horizontal.getScrollPosition(),h=e.Dom.innerWidth(this.TD)-8,f=this.instance.view.maximumVisibleElementWidth(d)-10,p=e.Dom.outerHeight(this.TD)-4,m=this.instance.view.maximumVisibleElementHeight(u)-2;parseInt(this.TD.style.borderTopWidth,10)>0&&(p-=1),parseInt(this.TD.style.borderLeftWidth,10)>0&&a>0&&(h-=1),this.TEXTAREA.style.fontSize=e.Dom.getComputedStyle(this.TD).fontSize,this.TEXTAREA.style.fontFamily=e.Dom.getComputedStyle(this.TD).fontFamily,this.autoResize.init(this.TEXTAREA,{minHeight:Math.min(p,m),maxHeight:m,minWidth:Math.min(h,f),maxWidth:f},!0),this.textareaParentStyle.display="block"}},t.prototype.bindEvents=function(){var t=this;this.eventManager.addEventListener(this.TEXTAREA,"cut",function(t){e.helper.stopPropagation(t)}),this.eventManager.addEventListener(this.TEXTAREA,"paste",function(t){e.helper.stopPropagation(t)}),this.instance.addHook("afterScrollVertically",function(){t.refreshDimensions()}),this.instance.addHook("afterColumnResize",function(){t.refreshDimensions(),t.focus()}),this.instance.addHook("afterRowResize",function(){t.refreshDimensions(),t.focus()}),this.instance.addHook("afterDestroy",function(){t.eventManager.clear()})},t.prototype.destroy=function(){this.eventManager.clear()},e.editors.TextEditor=t,e.editors.registerEditor("text",e.editors.TextEditor)}(t),function(t){var n=t.editors.BaseEditor.prototype.extend(),o={},r=function(){this.controls={},this.controls.leftButton=document.createElement("DIV"),this.controls.leftButton.className="leftButton",this.controls.rightButton=document.createElement("DIV"),this.controls.rightButton.className="rightButton",this.controls.upButton=document.createElement("DIV"),this.controls.upButton.className="upButton",this.controls.downButton=document.createElement("DIV"),this.controls.downButton.className="downButton";for(var e in this.controls)this.controls.hasOwnProperty(e)&&this.positionControls.appendChild(this.controls[e])};n.prototype.valueChanged=function(){return this.initValue!=this.getValue()},n.prototype.init=function(){var e=this;this.eventManager=new t.eventManager(this.instance),this.createElements(),this.bindEvents(),this.instance.addHook("afterDestroy",function(){e.destroy()})},n.prototype.getValue=function(){return this.TEXTAREA.value},n.prototype.setValue=function(e){this.initValue=e,this.TEXTAREA.value=e},n.prototype.createElements=function(){this.editorContainer=document.createElement("DIV"),this.editorContainer.className="htMobileEditorContainer",this.cellPointer=document.createElement("DIV"),this.cellPointer.className="cellPointer",this.moveHandle=document.createElement("DIV"),this.moveHandle.className="moveHandle",this.inputPane=document.createElement("DIV"),this.inputPane.className="inputs",this.positionControls=document.createElement("DIV"),this.positionControls.className="positionControls",this.TEXTAREA=document.createElement("TEXTAREA"),t.Dom.addClass(this.TEXTAREA,"handsontableInput"),this.inputPane.appendChild(this.TEXTAREA),this.editorContainer.appendChild(this.cellPointer),this.editorContainer.appendChild(this.moveHandle),this.editorContainer.appendChild(this.inputPane),this.editorContainer.appendChild(this.positionControls),r.call(this),document.body.appendChild(this.editorContainer)},n.prototype.onBeforeKeyDown=function(e){var n=this,o=n.getActiveEditor();if(t.Dom.enableImmediatePropagation(e),e.target===o.TEXTAREA&&!e.isImmediatePropagationStopped()){var r=t.helper.keyCode;switch(e.keyCode){case r.ENTER:o.close(),e.preventDefault();break;case r.BACKSPACE:e.stopImmediatePropagation()}}},n.prototype.open=function(){this.instance.addHook("beforeKeyDown",this.onBeforeKeyDown),t.Dom.addClass(this.editorContainer,"active"),t.Dom.removeClass(this.cellPointer,"hidden"),this.updateEditorPosition()},n.prototype.focus=function(){this.TEXTAREA.focus(),t.Dom.setCaretPosition(this.TEXTAREA,this.TEXTAREA.value.length)},n.prototype.close=function(){this.TEXTAREA.blur(),this.instance.removeHook("beforeKeyDown",this.onBeforeKeyDown),t.Dom.removeClass(this.editorContainer,"active")},n.prototype.scrollToView=function(){var e=this.instance.getSelectedRange().highlight;this.instance.view.scrollViewport(e)},n.prototype.hideCellPointer=function(){t.Dom.hasClass(this.cellPointer,"hidden")||t.Dom.addClass(this.cellPointer,"hidden")},n.prototype.updateEditorPosition=function(n,r){if(n&&r)n=parseInt(n,10),r=parseInt(r,10),this.editorContainer.style.top=r+"px",this.editorContainer.style.left=n+"px";else{var i=this.instance.getSelected(),s=this.instance.getCell(i[0],i[1]);if(o.cellPointer||(o.cellPointer={height:t.Dom.outerHeight(this.cellPointer),width:t.Dom.outerWidth(this.cellPointer)}),o.editorContainer||(o.editorContainer={width:t.Dom.outerWidth(this.editorContainer)}),void 0!==s){var a=this.instance.view.wt.wtScrollbars.horizontal.scrollHandler==e?0:t.Dom.getScrollLeft(this.instance.view.wt.wtScrollbars.horizontal.scrollHandler),l=this.instance.view.wt.wtScrollbars.vertical.scrollHandler==e?0:t.Dom.getScrollTop(this.instance.view.wt.wtScrollbars.vertical.scrollHandler),c=t.Dom.offset(s),u=t.Dom.outerWidth(s),d={x:a,y:l};this.editorContainer.style.top=parseInt(c.top+t.Dom.outerHeight(s)-d.y+o.cellPointer.height,10)+"px",this.editorContainer.style.left=parseInt(e.innerWidth/2-o.editorContainer.width/2,10)+"px",c.left+u/2>parseInt(this.editorContainer.style.left,10)+o.editorContainer.width?this.editorContainer.style.left=e.innerWidth-o.editorContainer.width+"px":c.left+u/2<parseInt(this.editorContainer.style.left,10)+20&&(this.editorContainer.style.left="0px"),this.cellPointer.style.left=parseInt(c.left-o.cellPointer.width/2-t.Dom.offset(this.editorContainer).left+u/2-d.x,10)+"px"}}},n.prototype.updateEditorData=function(){var e=this.instance.getSelected(),t=this.instance.getDataAtCell(e[0],e[1]);this.row=e[0],this.col=e[1],this.setValue(t),this.updateEditorPosition()},n.prototype.prepareAndSave=function(){if(!this.valueChanged())return!0;var e=[[String.prototype.trim.call(this.getValue())]];this.saveValue(e)},n.prototype.bindEvents=function(){var n=this;this.eventManager.addEventListener(this.controls.leftButton,"touchend",function(e){n.prepareAndSave(),n.instance.selection.transformStart(0,-1,null,!0),n.updateEditorData(),e.preventDefault()}),this.eventManager.addEventListener(this.controls.rightButton,"touchend",function(e){n.prepareAndSave(),n.instance.selection.transformStart(0,1,null,!0),n.updateEditorData(),e.preventDefault()}),this.eventManager.addEventListener(this.controls.upButton,"touchend",function(e){n.prepareAndSave(),n.instance.selection.transformStart(-1,0,null,!0),n.updateEditorData(),e.preventDefault()}),this.eventManager.addEventListener(this.controls.downButton,"touchend",function(e){n.prepareAndSave(),n.instance.selection.transformStart(1,0,null,!0),n.updateEditorData(),e.preventDefault()}),this.eventManager.addEventListener(this.moveHandle,"touchstart",function(e){if(1==e.touches.length){var t=e.touches[0],o={x:n.editorContainer.offsetLeft,y:n.editorContainer.offsetTop},r={x:t.pageX-o.x,y:t.pageY-o.y};n.eventManager.addEventListener(this,"touchmove",function(e){var t=e.touches[0];n.updateEditorPosition(t.pageX-r.x,t.pageY-r.y),n.hideCellPointer(),e.preventDefault()})}}),this.eventManager.addEventListener(document.body,"touchend",function(e){t.Dom.isChildOf(e.target,n.editorContainer)||t.Dom.isChildOf(e.target,n.instance.rootElement)||n.close()}),this.eventManager.addEventListener(this.instance.view.wt.wtScrollbars.horizontal.scrollHandler,"scroll",function(){n.instance.view.wt.wtScrollbars.horizontal.scrollHandler!=e&&n.hideCellPointer()}),this.eventManager.addEventListener(this.instance.view.wt.wtScrollbars.vertical.scrollHandler,"scroll",function(){n.instance.view.wt.wtScrollbars.vertical.scrollHandler!=e&&n.hideCellPointer()})},n.prototype.destroy=function(){this.eventManager.clear(),this.editorContainer.parentNode.removeChild(this.editorContainer)},t.editors.MobileTextEditor=n,t.editors.registerEditor("mobile",t.editors.MobileTextEditor)}(t),function(e){var t=e.editors.BaseEditor.prototype.extend();t.prototype.beginEditing=function(){var e=this.TD.querySelector('input[type="checkbox"]');e&&e.click()},t.prototype.finishEditing=function(){},t.prototype.init=function(){},t.prototype.open=function(){},t.prototype.close=function(){},t.prototype.getValue=function(){},t.prototype.setValue=function(){},t.prototype.focus=function(){},e.editors.CheckboxEditor=t,e.editors.registerEditor("checkbox",t)}(t),function(t){var n,o=t.editors.TextEditor.prototype.extend();o.prototype.init=function(){if("undefined"==typeof jQuery)throw new Error("You need to include jQuery to your project in order to use the jQuery UI Datepicker.");if(n=jQuery,!n.datepicker)throw new Error("jQuery UI Datepicker dependency not found. Did you forget to include jquery-ui.custom.js or its substitute?");t.editors.TextEditor.prototype.init.apply(this,arguments),this.isCellEdited=!1;var e=this;this.instance.addHook("afterDestroy",function(){e.destroyElements()
})},o.prototype.createElements=function(){t.editors.TextEditor.prototype.createElements.apply(this,arguments),this.datePicker=document.createElement("DIV"),t.Dom.addClass(this.datePicker,"htDatepickerHolder"),this.datePickerStyle=this.datePicker.style,this.datePickerStyle.position="absolute",this.datePickerStyle.top=0,this.datePickerStyle.left=0,this.datePickerStyle.zIndex=99,document.body.appendChild(this.datePicker),this.$datePicker=n(this.datePicker);var e=this,o={dateFormat:"yy-mm-dd",showButtonPanel:!0,changeMonth:!0,changeYear:!0,onSelect:function(t){e.setValue(t),e.finishEditing(!1)}};this.$datePicker.datepicker(o);var r=t.eventManager(this);r.addEventListener(this.datePicker,"mousedown",function(e){t.helper.stopPropagation(e)}),this.hideDatepicker()},o.prototype.destroyElements=function(){this.$datePicker.datepicker("destroy"),this.$datePicker.remove()},o.prototype.open=function(){t.editors.TextEditor.prototype.open.call(this),this.showDatepicker()},o.prototype.finishEditing=function(){this.hideDatepicker(),t.editors.TextEditor.prototype.finishEditing.apply(this,arguments)},o.prototype.showDatepicker=function(){var n,o,r=this.TD.getBoundingClientRect();this.datePickerStyle.top=e.pageYOffset+r.top+t.Dom.outerHeight(this.TD)+"px",this.datePickerStyle.left=e.pageXOffset+r.left+"px",n=function(){},n.prototype=this.cellProperties,o=new n,o.defaultDate=this.originalValue||void 0,this.$datePicker.datepicker("option",o),this.originalValue&&this.$datePicker.datepicker("setDate",this.originalValue),this.datePickerStyle.display="block"},o.prototype.hideDatepicker=function(){this.datePickerStyle.display="none"},t.editors.DateEditor=o,t.editors.registerEditor("date",o)}(t),function(e){var t=e.editors.TextEditor.prototype.extend();t.prototype.createElements=function(){e.editors.TextEditor.prototype.createElements.apply(this,arguments);var t=document.createElement("DIV");t.className="handsontableEditor",this.TEXTAREA_PARENT.appendChild(t),this.htContainer=t,this.htEditor=new e(t),this.assignHooks()},t.prototype.prepare=function(t,n,o,r,i,s){e.editors.TextEditor.prototype.prepare.apply(this,arguments);var a=this,l={startRows:0,startCols:0,minRows:0,minCols:0,className:"listbox",copyPaste:!1,cells:function(){return{readOnly:!0}},fillHandle:!1,afterOnCellMouseDown:function(){var e=this.getValue();void 0!==e&&a.setValue(e),a.instance.destroyEditor()}};this.cellProperties.handsontable&&e.helper.extend(l,s.handsontable),this.htEditor&&this.htEditor.destroy(),this.htEditor=new e(this.htContainer,l)};var n=function(t){if(null!=t&&null==t.isImmediatePropagationEnabled&&(t.stopImmediatePropagation=function(){this.isImmediatePropagationEnabled=!1,this.cancelBubble=!0},t.isImmediatePropagationEnabled=!0,t.isImmediatePropagationStopped=function(){return!this.isImmediatePropagationEnabled}),!t.isImmediatePropagationStopped()){var n,o=this.getActiveEditor(),r=o.htEditor.getInstance();if(t.keyCode==e.helper.keyCode.ARROW_DOWN)if(r.getSelected()){var i=r.getSelected()[0],s=r.countRows()-1;n=Math.min(s,i+1)}else n=0;else if(t.keyCode==e.helper.keyCode.ARROW_UP&&r.getSelected()){var i=r.getSelected()[0];n=i-1}void 0!==n&&(0>n?r.deselectCell():r.selectCell(n,0),t.preventDefault(),t.stopImmediatePropagation(),o.instance.listen(),o.TEXTAREA.focus())}};t.prototype.open=function(){this.instance.addHook("beforeKeyDown",n),e.editors.TextEditor.prototype.open.apply(this,arguments),this.htEditor.render(),this.cellProperties.strict?(this.htEditor.selectCell(0,0),this.TEXTAREA.style.visibility="hidden"):(this.htEditor.deselectCell(),this.TEXTAREA.style.visibility="visible"),e.Dom.setCaretPosition(this.TEXTAREA,0,this.TEXTAREA.value.length)},t.prototype.close=function(){this.instance.removeHook("beforeKeyDown",n),this.instance.listen(),e.editors.TextEditor.prototype.close.apply(this,arguments)},t.prototype.focus=function(){this.instance.listen(),e.editors.TextEditor.prototype.focus.apply(this,arguments)},t.prototype.beginEditing=function(){var t=this.instance.getSettings().onBeginEditing;t&&t()===!1||e.editors.TextEditor.prototype.beginEditing.apply(this,arguments)},t.prototype.finishEditing=function(){if(this.htEditor.isListening()&&this.instance.listen(),this.htEditor.getSelected()){var t=this.htEditor.getInstance().getValue();void 0!==t&&this.setValue(t)}return e.editors.TextEditor.prototype.finishEditing.apply(this,arguments)},t.prototype.assignHooks=function(){var e=this;this.instance.addHook("afterDestroy",function(){e.htEditor&&e.htEditor.destroy()})},e.editors.HandsontableEditor=t,e.editors.registerEditor("handsontable",t)}(t),function(t){var n=t.editors.HandsontableEditor.prototype.extend();n.prototype.init=function(){t.editors.HandsontableEditor.prototype.init.apply(this,arguments);var e=this.htEditor.getInstance();e.updateSettings({height:1}),this.query=null,this.choices=[]},n.prototype.createElements=function(){t.editors.HandsontableEditor.prototype.createElements.apply(this,arguments);var n=function(){return-1!=e.navigator.platform.indexOf("Mac")?"htMacScroll":""};t.Dom.addClass(this.htContainer,"autocompleteEditor"),t.Dom.addClass(this.htContainer,n())};var o=!1,r=function(e){o=!1;var n=this.getActiveEditor(),r=t.helper.keyCode;if(t.helper.isPrintableChar(e.keyCode)||e.keyCode===r.BACKSPACE||e.keyCode===r.DELETE||e.keyCode===r.INSERT){var i=0;if(e.keyCode===r.C&&(e.ctrlKey||e.metaKey))return;n.isOpened()||(i+=10),n.instance._registerTimeout(setTimeout(function(){n.queryChoices(n.TEXTAREA.value),o=!0},i))}};n.prototype.prepare=function(){this.instance.addHook("beforeKeyDown",r),t.editors.HandsontableEditor.prototype.prepare.apply(this,arguments)},n.prototype.open=function(){t.editors.HandsontableEditor.prototype.open.apply(this,arguments),this.TEXTAREA.style.visibility="visible",this.focus(),this.htContainer.style.overflow="hidden";var e=this.htEditor.getInstance(),n=this;e.updateSettings({colWidths:[t.Dom.outerWidth(this.TEXTAREA)-2],afterRenderer:function(e,t,o,r,i){var s=this.getCellMeta(t,o).filteringCaseSensitive===!0;if(i){var a=s?i.indexOf(this.query):i.toLowerCase().indexOf(n.query.toLowerCase());if(-1!=a){var l=i.substr(a,n.query.length);e.innerHTML=i.replace(l,"<strong>"+l+"</strong>")}}}}),o&&(o=!1),n.instance._registerTimeout(setTimeout(function(){n.queryChoices(n.TEXTAREA.value),n.htContainer.style.overflow="auto"},0))},n.prototype.close=function(){t.editors.HandsontableEditor.prototype.close.apply(this,arguments)},n.prototype.queryChoices=function(e){if(this.query=e,"function"==typeof this.cellProperties.source){var t=this;this.cellProperties.source(e,function(e){t.updateChoicesList(e)})}else if(Array.isArray(this.cellProperties.source)){var n;if(e&&this.cellProperties.filter!==!1){var o=this.cellProperties.filteringCaseSensitive===!0,r=e.toLowerCase();n=this.cellProperties.source.filter(function(t){return o?-1!=t.indexOf(e):-1!=t.toLowerCase().indexOf(r)})}else n=this.cellProperties.source;this.updateChoicesList(n)}else this.updateChoicesList([])},n.prototype.updateChoicesList=function(e){var o,r=t.Dom.getCaretPosition(this.TEXTAREA),i=t.Dom.getSelectionEndPosition(this.TEXTAREA),s=n.sortByRelevance(this.getValue(),e,this.cellProperties.filteringCaseSensitive);if(0!=this.cellProperties.filter){for(var a=[],l=0,c=s.length;c>l;l++)a.push(e[s[l]]);o=0,e=a}else o=s[0];this.choices=e,this.htEditor.loadData(t.helper.pivot([e])),this.htEditor.updateSettings({height:this.getDropdownHeight()}),this.cellProperties.strict===!0&&this.highlightBestMatchingChoice(o),this.instance.listen(),this.TEXTAREA.focus(),t.Dom.setCaretPosition(this.TEXTAREA,r,r!=i?i:void 0)},n.prototype.finishEditing=function(e){e||this.instance.removeHook("beforeKeyDown",r),t.editors.HandsontableEditor.prototype.finishEditing.apply(this,arguments)},n.prototype.highlightBestMatchingChoice=function(e){"number"==typeof e?this.htEditor.selectCell(e,0):this.htEditor.deselectCell()},n.sortByRelevance=function(e,t,n){var o,r,i,s,a,l=[],c=e.length,u=[];if(0===c){for(s=0,a=t.length;a>s;s++)u.push(s);return u}for(s=0,a=t.length;a>s;s++)o=t[s],r=n?o.indexOf(e):o.toLowerCase().indexOf(e.toLowerCase()),-1!=r&&(i=o.length-r-c,l.push({baseIndex:s,index:r,charsLeft:i,value:o}));for(l.sort(function(e,t){return-1===t.index?-1:-1===e.index?1:e.index<t.index?-1:t.index<e.index?1:e.index===t.index?e.charsLeft<t.charsLeft?-1:e.charsLeft>t.charsLeft?1:0:void 0}),s=0,a=l.length;a>s;s++)u.push(l[s].baseIndex);return u},n.prototype.getDropdownHeight=function(){var e=this.htEditor.getInstance().getRowHeight(0)||23;return this.choices.length>=10?10*e:this.choices.length*e+8},t.editors.AutocompleteEditor=n,t.editors.registerEditor("autocomplete",n)}(t),function(e){var t=e.editors.TextEditor.prototype.extend();t.prototype.createElements=function(){e.editors.TextEditor.prototype.createElements.apply(this,arguments),this.TEXTAREA=document.createElement("input"),this.TEXTAREA.setAttribute("type","password"),this.TEXTAREA.className="handsontableInput",this.textareaStyle=this.TEXTAREA.style,this.textareaStyle.width=0,this.textareaStyle.height=0,e.Dom.empty(this.TEXTAREA_PARENT),this.TEXTAREA_PARENT.appendChild(this.TEXTAREA)},e.editors.PasswordEditor=t,e.editors.registerEditor("password",t)}(t),function(e){var t=e.editors.BaseEditor.prototype.extend();t.prototype.init=function(){this.select=document.createElement("SELECT"),e.Dom.addClass(this.select,"htSelectEditor"),this.select.style.display="none",this.instance.rootElement.appendChild(this.select)},t.prototype.prepare=function(){e.editors.BaseEditor.prototype.prepare.apply(this,arguments);var t,n=this.cellProperties.selectOptions;t=this.prepareOptions("function"==typeof n?n(this.row,this.col,this.prop):n),e.Dom.empty(this.select);for(var o in t)if(t.hasOwnProperty(o)){var r=document.createElement("OPTION");r.value=o,e.Dom.fastInnerHTML(r,t[o]),this.select.appendChild(r)}},t.prototype.prepareOptions=function(e){var t={};if(Array.isArray(e))for(var n=0,o=e.length;o>n;n++)t[e[n]]=e[n];else"object"==typeof e&&(t=e);return t},t.prototype.getValue=function(){return this.select.value},t.prototype.setValue=function(e){this.select.value=e};var n=function(t){var n=this,o=n.getActiveEditor();switch(t.keyCode){case e.helper.keyCode.ARROW_UP:var r=o.select.find("option:selected").prev();1==r.length&&r.prop("selected",!0),t.stopImmediatePropagation(),t.preventDefault();break;case e.helper.keyCode.ARROW_DOWN:var i=o.select.find("option:selected").next();1==i.length&&i.prop("selected",!0),t.stopImmediatePropagation(),t.preventDefault()}};t.prototype.checkEditorSection=function(){return this.row<this.instance.getSettings().fixedRowsTop?this.col<this.instance.getSettings().fixedColumnsLeft?"corner":"top":this.col<this.instance.getSettings().fixedColumnsLeft?"left":void 0},t.prototype.open=function(){var t,o=e.Dom.outerWidth(this.TD),r=e.Dom.outerHeight(this.TD),i=e.Dom.offset(this.instance.rootElement),s=e.Dom.offset(this.TD),a=this.checkEditorSection();switch(a){case"top":t=e.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.holder.parentNode);break;case"left":t=e.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.holder.parentNode);break;case"corner":t=e.Dom.getCssTransform(this.instance.view.wt.wtScrollbars.corner.clone.wtTable.holder.parentNode)}var l=this.select.style;t&&-1!=t?l[t[0]]=t[1]:e.Dom.resetCssTransform(this.select),l.height=r+"px",l.minWidth=o+"px",l.top=s.top-i.top+"px",l.left=s.left-i.left+"px",l.margin="0px",l.display="",this.instance.addHook("beforeKeyDown",n)},t.prototype.close=function(){this.select.style.display="none",this.instance.removeHook("beforeKeyDown",n)},t.prototype.focus=function(){this.select.focus()},e.editors.SelectEditor=t,e.editors.registerEditor("select",t)}(t),function(e){var t=e.editors.AutocompleteEditor.prototype.extend();t.prototype.prepare=function(){e.editors.AutocompleteEditor.prototype.prepare.apply(this,arguments),this.cellProperties.filter=!1,this.cellProperties.strict=!0},e.editors.DropdownEditor=t,e.editors.registerEditor("dropdown",t)}(t),function(e){var t=e.editors.TextEditor.prototype.extend();t.prototype.beginEditing=function(t){var n=e.editors.TextEditor.prototype;if("undefined"==typeof t&&this.originalValue){var o=""+this.originalValue;"undefined"!=typeof this.cellProperties.language&&numeral.language(this.cellProperties.language);var r=numeral.languageData().delimiters.decimal;o=o.replace(".",r),n.beginEditing.apply(this,[o])}else n.beginEditing.apply(this,arguments)},e.editors.NumericEditor=t,e.editors.registerEditor("numeric",t)}(t),t.NumericValidator=function(e,t){null===e&&(e=""),t(/^-?\d*(\.|\,)?\d*$/.test(e))};var P=function(e,t){var n=e,o="string"==typeof n?n.toLowerCase():null;return function(e){for(var r=!1,i=0,s=e.length;s>i;i++){if(n===e[i]){r=!0;break}if(o===e[i].toLowerCase()){r=!0;break}}t(r)}};t.AutocompleteValidator=function(e,t){this.strict&&this.source?"function"==typeof this.source?this.source(e,P(e,t)):P(e,t)(this.source):t(!0)},t.mobileBrowser=t.helper.isMobileBrowser(),t.AutocompleteCell={editor:t.editors.AutocompleteEditor,renderer:t.renderers.AutocompleteRenderer,validator:t.AutocompleteValidator},t.CheckboxCell={editor:t.editors.CheckboxEditor,renderer:t.renderers.CheckboxRenderer},t.TextCell={editor:t.mobileBrowser?t.editors.MobileTextEditor:t.editors.TextEditor,renderer:t.renderers.TextRenderer},t.NumericCell={editor:t.editors.NumericEditor,renderer:t.renderers.NumericRenderer,validator:t.NumericValidator,dataType:"number"},t.DateCell={editor:t.editors.DateEditor,renderer:t.renderers.AutocompleteRenderer},t.HandsontableCell={editor:t.editors.HandsontableEditor,renderer:t.renderers.AutocompleteRenderer},t.PasswordCell={editor:t.editors.PasswordEditor,renderer:t.renderers.PasswordRenderer,copyable:!1},t.DropdownCell={editor:t.editors.DropdownEditor,renderer:t.renderers.AutocompleteRenderer,validator:t.AutocompleteValidator},t.cellTypes={text:t.TextCell,date:t.DateCell,numeric:t.NumericCell,checkbox:t.CheckboxCell,autocomplete:t.AutocompleteCell,handsontable:t.HandsontableCell,password:t.PasswordCell,dropdown:t.DropdownCell},t.cellLookup={validator:{numeric:t.NumericValidator,autocomplete:t.AutocompleteValidator}};var N=function(){var n,o={minHeight:200,maxHeight:300,minWidth:100,maxWidth:300},r=document.body,i=document.createTextNode(""),s=document.createElement("SPAN"),a=function(t,n,o){e.attachEvent?t.attachEvent("on"+n,o):t.addEventListener(n,o,!1)},l=function(t,n,o){e.removeEventListener?t.removeEventListener(n,o,!1):t.detachEvent("on"+n,o)},c=function(e){var a,l;e?/^[a-zA-Z \.,\\\/\|0-9]$/.test(e)||(e="."):e="",void 0!==i.textContent?i.textContent=n.value+e:i.data=n.value+e,s.style.fontSize=t.Dom.getComputedStyle(n).fontSize,s.style.fontFamily=t.Dom.getComputedStyle(n).fontFamily,s.style.whiteSpace="pre",r.appendChild(s),a=s.clientWidth+2,r.removeChild(s),n.style.height=o.minHeight+"px",n.style.width=o.minWidth>a?o.minWidth+"px":a>o.maxWidth?o.maxWidth+"px":a+"px",l=n.scrollHeight?n.scrollHeight-1:0,o.minHeight>l?n.style.height=o.minHeight+"px":o.maxHeight<l?(n.style.height=o.maxHeight+"px",n.style.overflowY="visible"):n.style.height=l+"px"},u=function(){e.setTimeout(c,0)},d=function(e){if(e&&e.minHeight)if("inherit"==e.minHeight)o.minHeight=n.clientHeight;else{var t=parseInt(e.minHeight);isNaN(t)||(o.minHeight=t)}if(e&&e.maxHeight)if("inherit"==e.maxHeight)o.maxHeight=n.clientHeight;else{var r=parseInt(e.maxHeight);isNaN(r)||(o.maxHeight=r)}if(e&&e.minWidth)if("inherit"==e.minWidth)o.minWidth=n.clientWidth;else{var a=parseInt(e.minWidth);isNaN(a)||(o.minWidth=a)}if(e&&e.maxWidth)if("inherit"==e.maxWidth)o.maxWidth=n.clientWidth;else{var l=parseInt(e.maxWidth);isNaN(l)||(o.maxWidth=l)}s.firstChild||(s.className="autoResize",s.style.display="inline-block",s.appendChild(i))},h=function(e,t,r){n=e,d(t),"TEXTAREA"==n.nodeName&&(n.style.resize="none",n.style.overflowY="",n.style.height=o.minHeight+"px",n.style.minWidth=o.minWidth+"px",n.style.maxWidth=o.maxWidth+"px",n.style.overflowY="hidden"),r&&(a(n,"change",c),a(n,"cut",u),a(n,"paste",u),a(n,"drop",u),a(n,"keydown",u)),c()};return{init:function(e,t,n){h(e,t,n)},unObserve:function(){l(n,"change",c),l(n,"cut",u),l(n,"paste",u),l(n,"drop",u),l(n,"keydown",u)},resize:c}};!function(e){function t(e){return e.split('"').length-1}e.SheetClip={parse:function(e){var n,o,r,i,s,a,l,c=[],u=0;for(r=e.split("\n"),r.length>1&&""===r[r.length-1]&&r.pop(),n=0,o=r.length;o>n;n+=1){for(r[n]=r[n].split("	"),i=0,s=r[n].length;s>i;i+=1)c[u]||(c[u]=[]),a&&0===i?(l=c[u].length-1,c[u][l]=c[u][l]+"\n"+r[n][0],a&&1&t(r[n][0])&&(a=!1,c[u][l]=c[u][l].substring(0,c[u][l].length-1).replace(/""/g,'"'))):i===s-1&&0===r[n][i].indexOf('"')?(c[u].push(r[n][i].substring(1).replace(/""/g,'"')),a=!0):(c[u].push(r[n][i].replace(/""/g,'"')),a=!1);a||(u+=1)}return c},stringify:function(e){var t,n,o,r,i,s="";for(t=0,n=e.length;n>t;t+=1){for(r=e[t].length,o=0;r>o;o+=1)o>0&&(s+="	"),i=e[t][o],s+="string"==typeof i?i.indexOf("\n")>-1?'"'+i.replace(/"/g,'""')+'"':i:null===i||void 0===i?"":i;s+="\n"}return s}}}(e);var L=function(){var e;return{getInstance:function(){return e?e.hasBeenDestroyed()&&e.init():e=new n,e.refCounter++,e}}}();n.prototype.init=function(){var e,n;this.copyCallbacks=[],this.cutCallbacks=[],this.pasteCallbacks=[],this._eventManager=t.eventManager(this),n=document.body,document.getElementById("CopyPasteDiv")?(this.elDiv=document.getElementById("CopyPasteDiv"),this.elTextarea=this.elDiv.firstChild):(this.elDiv=document.createElement("DIV"),this.elDiv.id="CopyPasteDiv",e=this.elDiv.style,e.position="fixed",e.top="-10000px",e.left="-10000px",n.appendChild(this.elDiv),this.elTextarea=document.createElement("TEXTAREA"),this.elTextarea.className="copyPaste",this.elTextarea.onpaste=function(e){return"WebkitAppearance"in document.documentElement.style?(this.value=e.clipboardData.getData("Text"),!1):void 0},e=this.elTextarea.style,e.width="10000px",e.height="10000px",e.overflow="hidden",this.elDiv.appendChild(this.elTextarea),"undefined"!=typeof e.opacity&&(e.opacity=0)),this.keyDownRemoveEvent=this._eventManager.addEventListener(document.documentElement,"keydown",this.onKeyDown.bind(this),!1)},n.prototype.onKeyDown=function(e){var t=this,n=!1;if(e.metaKey?n=!0:e.ctrlKey&&-1===navigator.userAgent.indexOf("Mac")&&(n=!0),n){if(document.activeElement!==this.elTextarea&&(""!==this.getSelectionText()||-1!==["INPUT","SELECT","TEXTAREA"].indexOf(document.activeElement.nodeName)))return;this.selectNodeText(this.elTextarea),setTimeout(function(){t.selectNodeText(t.elTextarea)},0)}!n||67!==e.keyCode&&86!==e.keyCode&&88!==e.keyCode||(88===e.keyCode?setTimeout(function(){t.triggerCut(e)},0):86===e.keyCode&&setTimeout(function(){t.triggerPaste(e)},0))},n.prototype.selectNodeText=function(e){e&&e.select()},n.prototype.getSelectionText=function(){var t="";return e.getSelection?t=e.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(t=document.selection.createRange().text),t},n.prototype.copyable=function(e){if("string"!=typeof e&&void 0===e.toString)throw new Error("copyable requires string parameter");this.elTextarea.value=e},n.prototype.onCut=function(e){this.cutCallbacks.push(e)},n.prototype.onPaste=function(e){this.pasteCallbacks.push(e)},n.prototype.removeCallback=function(e){var t,n;for(t=0,n=this.copyCallbacks.length;n>t;t++)if(this.copyCallbacks[t]===e)return this.copyCallbacks.splice(t,1),!0;for(t=0,n=this.cutCallbacks.length;n>t;t++)if(this.cutCallbacks[t]===e)return this.cutCallbacks.splice(t,1),!0;for(t=0,n=this.pasteCallbacks.length;n>t;t++)if(this.pasteCallbacks[t]===e)return this.pasteCallbacks.splice(t,1),!0;return!1},n.prototype.triggerCut=function(e){var t=this;t.cutCallbacks&&setTimeout(function(){for(var n=0,o=t.cutCallbacks.length;o>n;n++)t.cutCallbacks[n](e)},50)},n.prototype.triggerPaste=function(e,t){var n=this;n.pasteCallbacks&&setTimeout(function(){for(var o=t||n.elTextarea.value,r=0,i=n.pasteCallbacks.length;i>r;r++)n.pasteCallbacks[r](o,e)},50)},n.prototype.destroy=function(){this.hasBeenDestroyed()||0!==--this.refCounter||(this.elDiv&&this.elDiv.parentNode&&(this.elDiv.parentNode.removeChild(this.elDiv),this.elDiv=null,this.elTextarea=null),this.keyDownRemoveEvent())},n.prototype.hasBeenDestroyed=function(){return!this.refCounter};var I;!function(t){function n(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function o(e,t){var r;for(var i in e)if(e.hasOwnProperty(i)){if(e[i]===t)return n(i)+"/";if("object"==typeof e[i]&&(r=o(e[i],t),""!=r))return n(i)+"/"+r}return""}function r(e,t){if(e===t)return"/";var n=o(e,t);if(""===n)throw new Error("Object not found in root");return"/"+n}function i(e){for(var t=0,n=w.length;n>t;t++)if(w[t].obj===e)return w[t]}function s(e,t){for(var n=0,o=e.observers.length;o>n;n++)if(e.observers[n].callback===t)return e.observers[n].observer}function a(e,t){for(var n=0,o=e.observers.length;o>n;n++)if(e.observers[n].observer===t)return void e.observers.splice(n,1)}function l(e,t){h(t),Object.observe?d(t,e):clearTimeout(t.next);var n=i(e);a(n,t)}function c(t,n){var o,a=[],l=t,c=i(t);if(c?o=s(c,n):(c=new y(t),w.push(c)),o)return o;if(Object.observe)o=function(e){d(o,t),u(o,t);for(var i=0,s=e.length;s>i;){if(("length"!==e[i].name||!R(e[i].object))&&"__Jasmine_been_here_before__"!==e[i].name){var c=e[i].type;switch(c){case"new":c="add";break;case"deleted":c="delete";break;case"updated":c="update"}v[c].call(e[i],a,r(l,e[i].object))}i++}a&&n&&n(a),o.patches=a,a=[]};else if(o={},c.value=JSON.parse(JSON.stringify(t)),n){o.callback=n,o.next=null;var f=this.intervals||[100,1e3,1e4,6e4],p=0,m=function(){h(o)},g=function(){clearTimeout(o.next),o.next=setTimeout(function(){m(),p=0,o.next=setTimeout(b,f[p++])},0)},b=function(){m(),p==f.length&&(p=f.length-1),o.next=setTimeout(b,f[p++])};"undefined"!=typeof e&&(e.addEventListener?(e.addEventListener("mousedown",g),e.addEventListener("mouseup",g),e.addEventListener("keydown",g)):(e.attachEvent("onmousedown",g),e.attachEvent("onmouseup",g),e.attachEvent("onkeydown",g))),o.next=setTimeout(b,f[p++])}return o.patches=a,o.object=t,c.observers.push(new C(n,o)),u(o,t)}function u(e,t){if(Object.observe){Object.observe(t,e);for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];o&&"object"==typeof o&&u(e,o)}}return e}function d(e,t){if(Object.observe){Object.unobserve(t,e);for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];o&&"object"==typeof o&&d(e,o)}}return e}function h(e){if(Object.observe)Object.deliverChangeRecords(e);else{for(var t,n=0,o=w.length;o>n;n++)if(w[n].obj===e.object){t=w[n];break}f(t.value,e.object,e.patches,"")}var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function f(e,t,o,r){for(var i=b(t),s=b(e),a=!1,l=!1,c=s.length-1;c>=0;c--){var u=s[c],d=e[u];if(t.hasOwnProperty(u)){var h=t[u];d instanceof Object?f(d,h,o,r+"/"+n(u)):d!=h&&(a=!0,o.push({op:"replace",path:r+"/"+n(u),value:h}),e[u]=h)}else o.push({op:"remove",path:r+"/"+n(u)}),delete e[u],l=!0}if(l||i.length!=s.length)for(var c=0;c<i.length;c++){var u=i[c];e.hasOwnProperty(u)||(o.push({op:"add",path:r+"/"+n(u),value:t[u]}),e[u]=JSON.parse(JSON.stringify(t[u])))}}function p(e,t){for(var n,o=!1,r=0,i=t.length;i>r;){n=t[r];for(var s=n.path.split("/"),a=e,l=1,c=s.length;;)if(R(a)){var u=parseInt(s[l],10);if(l++,l>=c){o=g[n.op].call(n,a,u,e);break}a=a[u]}else{var d=s[l];if(-1!=d.indexOf("~")&&(d=d.replace(/~1/g,"/").replace(/~0/g,"~")),l++,l>=c){o=m[n.op].call(n,a,d,e);break}a=a[d]}r++}return o}var m={add:function(e,t){return e[t]=this.value,!0},remove:function(e,t){return delete e[t],!0},replace:function(e,t){return e[t]=this.value,!0},move:function(e,t,n){var o={op:"_get",path:this.from};return p(n,[o]),p(n,[{op:"remove",path:this.from}]),p(n,[{op:"add",path:this.path,value:o.value}]),!0},copy:function(e,t,n){var o={op:"_get",path:this.from};return p(n,[o]),p(n,[{op:"add",path:this.path,value:o.value}]),!0},test:function(e,t){return JSON.stringify(e[t])===JSON.stringify(this.value)},_get:function(e,t){this.value=e[t]}},g={add:function(e,t){return e.splice(t,0,this.value),!0},remove:function(e,t){return e.splice(t,1),!0},replace:function(e,t){return e[t]=this.value,!0},move:m.move,copy:m.copy,test:m.test,_get:m._get},v={add:function(e,t){var o={op:"add",path:t+n(this.name),value:this.object[this.name]};e.push(o)},"delete":function(e,t){var o={op:"remove",path:t+n(this.name)};e.push(o)},update:function(e,t){var o={op:"replace",path:t+n(this.name),value:this.object[this.name]};e.push(o)}},w=[];t.intervals;var y=function(){function e(e){this.observers=[],this.obj=e}return e}(),C=function(){function e(e,t){this.callback=e,this.observer=t}return e}();t.unobserve=l,t.observe=c,t.generate=h;var b;b=Object.keys?Object.keys:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};var R;R=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},t.apply=p}(I||(I={})),"undefined"!=typeof exports&&(exports.apply=I.apply,exports.observe=I.observe,exports.unobserve=I.unobserve,exports.generate=I.generate),t.PluginHookClass=function(){function e(){this.hooks=t(),this.globalBucket={},this.legacy=n}var t=function(){return{beforeInitWalkontable:[],beforeInit:[],beforeRender:[],beforeSetRangeEnd:[],beforeDrawBorders:[],beforeChange:[],beforeChangeRender:[],beforeRemoveCol:[],beforeRemoveRow:[],beforeValidate:[],beforeGetCellMeta:[],beforeAutofill:[],beforeKeyDown:[],beforeOnCellMouseDown:[],beforeTouchScroll:[],afterInit:[],afterLoadData:[],afterUpdateSettings:[],afterRender:[],afterRenderer:[],afterChange:[],afterValidate:[],afterGetCellMeta:[],afterSetCellMeta:[],afterGetColHeader:[],afterGetRowHeader:[],afterDestroy:[],afterRemoveRow:[],afterCreateRow:[],afterRemoveCol:[],afterCreateCol:[],afterDeselect:[],afterSelection:[],afterSelectionByProp:[],afterSelectionEnd:[],afterSelectionEndByProp:[],afterOnCellMouseDown:[],afterOnCellMouseOver:[],afterOnCellCornerMouseDown:[],afterScrollVertically:[],afterScrollHorizontally:[],afterCellMetaReset:[],afterIsMultipleSelectionCheck:[],afterDocumentKeyDown:[],afterMomentumScroll:[],modifyColWidth:[],modifyRowHeight:[],modifyRow:[],modifyCol:[]}},n={onBeforeChange:"beforeChange",onChange:"afterChange",onCreateRow:"afterCreateRow",onCreateCol:"afterCreateCol",onSelection:"afterSelection",onCopyLimit:"afterCopyLimit",onSelectionEnd:"afterSelectionEnd",onSelectionByProp:"afterSelectionByProp",onSelectionEndByProp:"afterSelectionEndByProp"};return e.prototype.getBucket=function(e){return e?(e.pluginHookBucket||(e.pluginHookBucket={}),e.pluginHookBucket):this.globalBucket},e.prototype.add=function(e,t,o){if(Array.isArray(t))for(var r=0,i=t.length;i>r;r++)this.add(e,t[r]);else{e in n&&(e=n[e]);var s=this.getBucket(o);"undefined"==typeof s[e]&&(s[e]=[]),t.skip=!1,-1==s[e].indexOf(t)&&s[e].push(t)}return this},e.prototype.once=function(e,t,n){if(Array.isArray(t))for(var o=0,r=t.length;r>o;o++)t[o].runOnce=!0,this.add(e,t[o],n);else t.runOnce=!0,this.add(e,t,n)},e.prototype.remove=function(e,t,o){var r=!1;e in n&&(e=n[e]);var i=this.getBucket(o);if("undefined"!=typeof i[e])for(var s=0,a=i[e].length;a>s;s++)if(i[e][s]==t){i[e][s].skip=!0,r=!0;break}return r},e.prototype.destroy=function(e){var t=this.getBucket(e);for(var n in t)if(t.hasOwnProperty(n))for(var o=0,r=t[n].length;r>o;o++)this.remove(n,t[n],e)},e.prototype.run=function(e,t,o,r,i,s,a,l){return t in n&&(t=n[t]),o=this._runBucket(this.globalBucket,e,t,o,r,i,s,a,l),o=this._runBucket(this.getBucket(e),e,t,o,r,i,s,a,l)},e.prototype._runBucket=function(e,t,n,o,r,i,s,a,l){var c,u,d,h=e[n];if(h)for(u=0,d=h.length;d>u;u++)h[u].skip||(c=h[u].call(t,o,r,i,s,a,l),void 0!==c&&(o=c),h[u].runOnce&&this.remove(n,h[u],e===this.globalBucket?null:t));return o},e.prototype.register=function(e){this.isRegistered(e)||(this.hooks[e]=[])},e.prototype.deregister=function(e){delete this.hooks[e]},e.prototype.isRegistered=function(e){return"undefined"!=typeof this.hooks[e]},e.prototype.getRegistered=function(){return Object.keys(this.hooks)},e}(),t.hooks=new t.PluginHookClass,t.PluginHooks=t.hooks,function(e){function t(){function t(e){var t=document,n=this;n.table=t.createElement("table"),n.theadTh=t.createElement("th"),n.table.appendChild(t.createElement("thead")).appendChild(t.createElement("tr")).appendChild(n.theadTh),n.tableStyle=n.table.style,n.tableStyle.tableLayout="auto",n.tableStyle.width="auto",n.tbody=t.createElement("tbody"),n.table.appendChild(n.tbody),n.container=t.createElement("div"),n.container.className=e.rootElement.className+" hidden",n.containerStyle=n.container.style,n.container.appendChild(n.table)}var o=this,r=5;this.beforeInit=function(){var e=this;e.autoColumnWidths=[],e.getSettings().autoColumnSize!==!1?e.autoColumnSizeTmp||(e.autoColumnSizeTmp={table:null,tableStyle:null,theadTh:null,tbody:null,container:null,containerStyle:null,determineBeforeNextRender:!0},e.addHook("beforeRender",n.determineIfChanged),e.addHook("modifyColWidth",n.modifyColWidth),e.addHook("afterDestroy",n.afterDestroy),e.determineColumnWidth=o.determineColumnWidth):e.autoColumnSizeTmp&&(e.removeHook("beforeRender",n.determineIfChanged),e.removeHook("modifyColWidth",n.modifyColWidth),e.removeHook("afterDestroy",n.afterDestroy),delete e.determineColumnWidth,o.afterDestroy.call(e))},this.determineIfChanged=function(e){e&&n.determineColumnsWidth.apply(this,arguments)},this.determineColumnWidth=function(n){var o=this,i=o.autoColumnSizeTmp;i.container||t.call(i,o),i.container.className=o.rootElement.className+" htAutoColumnSize",i.table.className=o.table.className;for(var s=o.countRows(),a={},l=0,c=0;s>c;c++){var u=e.helper.stringify(o.getDataAtCell(c,n)),d=u.length;d>l&&(l=d),a[d]||(a[d]={needed:r,strings:[]}),a[d].needed&&(a[d].strings.push({value:u,row:c}),a[d].needed--)}var h=o.getSettings();h.colHeaders&&o.view.appendColHeader(n,i.theadTh),e.Dom.empty(i.tbody);for(var f in a)if(a.hasOwnProperty(f))for(var p=0,m=a[f].strings.length;m>p;p++){var g=a[f].strings[p].row,v=o.getCellMeta(g,n);v.col=n,v.row=g;var w=o.getCellRenderer(v),y=document.createElement("tr"),C=document.createElement("td");w(o,C,g,n,o.colToProp(n),a[f].strings[p].value,v),c++,y.appendChild(C),i.tbody.appendChild(y)}var b=o.rootElement.parentNode;b.appendChild(i.container);var R=e.Dom.outerWidth(i.table);return b.removeChild(i.container),R},this.determineColumnsWidth=function(){var e=this,t=this.getSettings();if(t.autoColumnSize||!t.colWidths)for(var n=this.countCols(),r=0;n>r;r++)e._getColWidthFromSettings(r)||(this.autoColumnWidths[r]=o.determineColumnWidth.call(e,r))},this.modifyColWidth=function(e,t){return this.autoColumnWidths[t]&&this.autoColumnWidths[t]>e?this.autoColumnWidths[t]:e},this.afterDestroy=function(){var e=this;e.autoColumnSizeTmp&&e.autoColumnSizeTmp.container&&e.autoColumnSizeTmp.container.parentNode&&e.autoColumnSizeTmp.container.parentNode.removeChild(e.autoColumnSizeTmp.container),e.autoColumnSizeTmp=null}}var n=new t;e.hooks.add("beforeInit",n.beforeInit),e.hooks.add("afterUpdateSettings",n.beforeInit)}(t);var M=new o;t.hooks.add("afterInit",function(){M.init.call(this,"afterInit")}),t.hooks.add("afterUpdateSettings",function(){M.init.call(this,"afterUpdateSettings")}),t.hooks.add("modifyRow",M.translateRow),t.hooks.add("afterGetColHeader",M.getColHeader),t.hooks.register("beforeColumnSort"),t.hooks.register("afterColumnSort"),function(e){function t(e,t){return-1!=e.indexOf(t)?e:(e=e.replace("htTop","").replace("htMiddle","").replace("htBottom","").replace("  ",""),e+=" "+t)}function n(e,t){return-1!=e.indexOf(t)?e:(e=e.replace("htLeft","").replace("htCenter","").replace("htRight","").replace("htJustify","").replace("  ",""),e+=" "+t)}function o(e,o,r,i){var s=this.getCellMeta(e,o),a=i;s.className&&(a="vertical"===r?t(s.className,i):n(s.className,i)),this.setCellMeta(e,o,"className",a)}function r(e,t,n){if(e.from.row==e.to.row&&e.from.col==e.to.col)o.call(this,e.from.row,e.from.col,t,n);else for(var r=e.from.row;r<=e.to.row;r++)for(var i=e.from.col;i<=e.to.col;i++)o.call(this,r,i,t,n);this.render()}function i(t){this.instance=t;var n=this;if(n.menus=[],n.htMenus={},n.triggerRows=[],n.eventManager=e.eventManager(n),this.enabled=!0,this.instance.addHook("afterDestroy",function(){n.destroy()}),this.defaultOptions={items:[{key:"row_above",name:"Insert row above",callback:function(e,t){this.alter("insert_row",t.start.row)},disabled:function(){var e=this.getSelected(),t=[0,e[1],this.countRows()-1,e[1]],n=t.join(",")==e.join(",");return e[0]<0||this.countRows()>=this.getSettings().maxRows||n}},{key:"row_below",name:"Insert row below",callback:function(e,t){this.alter("insert_row",t.end.row+1)},disabled:function(){var e=this.getSelected(),t=[0,e[1],this.countRows()-1,e[1]],n=t.join(",")==e.join(",");return this.getSelected()[0]<0||this.countRows()>=this.getSettings().maxRows||n
}},i.SEPARATOR,{key:"col_left",name:"Insert column on the left",callback:function(e,t){this.alter("insert_col",t.start.col)},disabled:function(){var e=this.getSelected(),t=[e[0],0,e[0],this.countCols()-1],n=t.join(",")==e.join(",");return this.getSelected()[1]<0||this.countCols()>=this.getSettings().maxCols||n}},{key:"col_right",name:"Insert column on the right",callback:function(e,t){this.alter("insert_col",t.end.col+1)},disabled:function(){var e=this.getSelected(),t=[e[0],0,e[0],this.countCols()-1],n=t.join(",")==e.join(",");return e[1]<0||this.countCols()>=this.getSettings().maxCols||n}},i.SEPARATOR,{key:"remove_row",name:"Remove row",callback:function(e,t){var n=t.end.row-t.start.row+1;this.alter("remove_row",t.start.row,n)},disabled:function(){var e=this.getSelected(),t=[0,e[1],this.countRows()-1,e[1]],n=t.join(",")==e.join(",");return e[0]<0||n}},{key:"remove_col",name:"Remove column",callback:function(e,t){var n=t.end.col-t.start.col+1;this.alter("remove_col",t.start.col,n)},disabled:function(){var e=this.getSelected(),t=[e[0],0,e[0],this.countCols()-1],n=t.join(",")==e.join(",");return e[1]<0||n}},i.SEPARATOR,{key:"undo",name:"Undo",callback:function(){this.undo()},disabled:function(){return this.undoRedo&&!this.undoRedo.isUndoAvailable()}},{key:"redo",name:"Redo",callback:function(){this.redo()},disabled:function(){return this.undoRedo&&!this.undoRedo.isRedoAvailable()}},i.SEPARATOR,{key:"make_read_only",name:function(){var e="Read only",t=n.checkSelectionReadOnlyConsistency(this);return t&&(e=n.markSelected(e)),e},callback:function(){var e=n.checkSelectionReadOnlyConsistency(this),t=this;this.getSelectedRange().forAll(function(n,o){t.getCellMeta(n,o).readOnly=e?!1:!0}),this.render()}},i.SEPARATOR,{key:"alignment",name:"Alignment",submenu:{items:[{name:function(){var e="Left",t=n.checkSelectionAlignment(this,"htLeft");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"horizontal","htLeft")},disabled:!1},{name:function(){var e="Center",t=n.checkSelectionAlignment(this,"htCenter");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"horizontal","htCenter")},disabled:!1},{name:function(){var e="Right",t=n.checkSelectionAlignment(this,"htRight");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"horizontal","htRight")},disabled:!1},{name:function(){var e="Justify",t=n.checkSelectionAlignment(this,"htJustify");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"horizontal","htJustify")},disabled:!1},i.SEPARATOR,{name:function(){var e="Top",t=n.checkSelectionAlignment(this,"htTop");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"vertical","htTop")},disabled:!1},{name:function(){var e="Middle",t=n.checkSelectionAlignment(this,"htMiddle");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"vertical","htMiddle")},disabled:!1},{name:function(){var e="Bottom",t=n.checkSelectionAlignment(this,"htBottom");return t&&(e=n.markSelected(e)),e},callback:function(){r.call(this,this.getSelectedRange(),"vertical","htBottom")},disabled:!1}]}}]},n.options={},e.helper.extend(n.options,this.options),this.bindMouseEvents(),this.markSelected=function(e){return"<span class='selected'>"+String.fromCharCode(10003)+"</span>"+e},this.checkSelectionAlignment=function(e,t){var n=!1;return e.getSelectedRange().forAll(function(o,r){var i=e.getCellMeta(o,r).className;return i&&-1!=i.indexOf(t)?(n=!0,!1):void 0}),n},!this.instance.getSettings().allowInsertRow){var o=a(this.defaultOptions.items,"row_above");this.defaultOptions.items.splice(o,1);var s=a(this.defaultOptions.items,"row_above");this.defaultOptions.items.splice(s,1),this.defaultOptions.items.splice(s,1)}if(!this.instance.getSettings().allowInsertColumn){var l=a(this.defaultOptions.items,"col_left");this.defaultOptions.items.splice(l,1);var c=a(this.defaultOptions.items,"col_right");this.defaultOptions.items.splice(c,1),this.defaultOptions.items.splice(c,1)}var u,d,h=!1,f=!1;this.instance.getSettings().allowRemoveRow||(u=a(this.defaultOptions.items,"remove_row"),this.defaultOptions.items.splice(u,1),h=!0),this.instance.getSettings().allowRemoveColumn||(d=a(this.defaultOptions.items,"remove_col"),this.defaultOptions.items.splice(d,1),f=!0),h&&f&&this.defaultOptions.items.splice(d,1),this.checkSelectionReadOnlyConsistency=function(e){var t=!1;return e.getSelectedRange().forAll(function(n,o){return e.getCellMeta(n,o).readOnly?(t=!0,!1):void 0}),t},e.hooks.run(t,"afterContextMenuDefaultOptions",this.defaultOptions)}function s(e,t){for(var n=0,o=e.length;o>n;n++)if(e[n].key===t)return e[n]}function a(e,t){for(var n=0,o=e.length;o>n;n++)if(e[n].key===t)return n}function l(){if(!this.rootElement.className.indexOf("htContextMenu")){for(var e=0,t=0,n=this.getSettings().data.length,o=0;n>o;o++)this.getSettings().data[o].name==i.SEPARATOR.name?e+=2:t+=26;this.view.wt.wtScrollbars.vertical.fixedContainer.style.height=t+e+"px"}}function c(){var t=this,n=t.getSettings().contextMenu,o=e.helper.isObject(n)?n:{};n?(t.contextMenu||(t.contextMenu=new i(t,o)),t.contextMenu.enable()):t.contextMenu&&(t.contextMenu.destroy(),delete t.contextMenu)}i.prototype.createMenu=function(t,n){t&&(t=t.replace(/ /g,"_"),t="htContextSubMenu_"+t);var o;return o=document.querySelector(t?".htContextMenu."+t:".htContextMenu"),o||(o=document.createElement("DIV"),e.Dom.addClass(o,"htContextMenu"),t&&e.Dom.addClass(o,t),document.getElementsByTagName("body")[0].appendChild(o)),this.menus.indexOf(o)<0&&(this.menus.push(o),n=n||0,this.triggerRows.push(n)),o},i.prototype.bindMouseEvents=function(){function t(t){var n=this.instance.getSettings();this.closeAll(),t.preventDefault(),e.helper.stopPropagation(t);var o=this.instance.getSettings().rowHeaders,r=this.instance.getSettings().colHeaders;if(o||r||"TD"==t.target.nodeName||e.Dom.hasClass(t.target,"current")&&e.Dom.hasClass(t.target,"wtBorder")){var s=this.createMenu(),a=this.getItems(n.contextMenu);this.show(s,a),this.setMenuPosition(t,s),this.eventManager.addEventListener(document.documentElement,"mousedown",e.helper.proxy(i.prototype.closeAll,this))}}var n=e.eventManager(this.instance);n.addEventListener(this.instance.rootElement,"contextmenu",e.helper.proxy(t,this))},i.prototype.bindTableEvents=function(){this._afterScrollCallback=function(){},this.instance.addHook("afterScrollVertically",this._afterScrollCallback),this.instance.addHook("afterScrollHorizontally",this._afterScrollCallback)},i.prototype.unbindTableEvents=function(){this._afterScrollCallback&&(this.instance.removeHook("afterScrollVertically",this._afterScrollCallback),this.instance.removeHook("afterScrollHorizontally",this._afterScrollCallback),this._afterScrollCallback=null)},i.prototype.performAction=function(e,t){var n=this,o=t.getSelected()[0],r=t.getData()[o];if(r.disabled!==!0&&("function"!=typeof r.disabled||r.disabled.call(this.instance)!==!0)&&!r.hasOwnProperty("submenu")){if("function"!=typeof r.callback)return;var s=this.instance.getSelectedRange(),a=i.utils.normalizeSelection(s);r.callback.call(this.instance,r.key,a,e),n.closeAll()}},i.prototype.unbindMouseEvents=function(){this.eventManager.clear();var t=e.eventManager(this.instance);t.removeEventListener(this.instance.rootElement,"contextmenu")},i.prototype.show=function(t,n){var o=this;t.removeAttribute("style"),t.style.display="block";var r={data:n,colHeaders:!1,colWidths:[200],readOnly:!0,copyPaste:!1,columns:[{data:"name",renderer:e.helper.proxy(this.renderer,this)}],renderAllRows:!0,beforeKeyDown:function(e){o.onBeforeKeyDown(e,i)},afterOnCellMouseOver:function(e,t,n){o.onCellMouseOver(e,t,n,i)}},i=new e(t,r);this.eventManager.removeEventListener(t,"mousedown"),this.eventManager.addEventListener(t,"mousedown",function(e){o.performAction(e,i)}),this.bindTableEvents(),i.listen(),this.htMenus[i.guid]=i},i.prototype.close=function(e){this.hide(e),this.eventManager.clear(),this.unbindTableEvents(),this.instance.listen()},i.prototype.closeAll=function(){for(;this.menus.length>0;){var e=this.menus.pop();e&&this.close(e)}this.triggerRows=[]},i.prototype.closeLastOpenedSubMenu=function(){var e=this.menus.pop();e&&this.hide(e)},i.prototype.hide=function(e){e.style.display="none";var t=this.htMenus[e.id];t.destroy(),delete this.htMenus[e.id]},i.prototype.renderer=function(t,n,o,r,s,a){function l(e){return e.hasOwnProperty("submenu")}function c(e){return new RegExp(i.SEPARATOR.name,"i").test(e.name)}function u(e){return e.disabled===!0||"function"==typeof e.disabled&&e.disabled.call(d.instance)===!0}var d=this,h=t.getData()[o],f=document.createElement("DIV");"function"==typeof a&&(a=a.call(this.instance)),e.Dom.empty(n),n.appendChild(f),c(h)?e.Dom.addClass(n,"htSeparator"):e.Dom.fastInnerHTML(f,a),u(h)?(e.Dom.addClass(n,"htDisabled"),this.eventManager.addEventListener(f,"mouseenter",function(){t.deselectCell()})):l(h)?(e.Dom.addClass(n,"htSubmenu"),this.eventManager.addEventListener(f,"mouseenter",function(){t.selectCell(o,r)})):(e.Dom.removeClass(n,"htSubmenu"),e.Dom.removeClass(n,"htDisabled"),this.eventManager.addEventListener(f,"mouseenter",function(){t.selectCell(o,r)}))},i.prototype.onCellMouseOver=function(e,t,n,o){var r=this.menus.length;if(r>0){var i=this.menus[r-1];i.id!=o.guid&&this.closeLastOpenedSubMenu()}else this.closeLastOpenedSubMenu();if(-1!=n.className.indexOf("htSubmenu")){var s=o.getData()[t.row],a=this.getItems(s.submenu),l=this.createMenu(s.name,t.row),c=n.getBoundingClientRect();this.show(l,a),this.setSubMenuPosition(c,l)}},i.prototype.onBeforeKeyDown=function(t,n){function o(e){var t=e.getCell(0,0);i.utils.isSeparator(t)||i.utils.isDisabled(t)?s(0,0,e):e.selectCell(0,0)}function r(e){var t=e.countRows()-1,n=e.getCell(t,0);i.utils.isSeparator(n)||i.utils.isDisabled(n)?a(t,0,e):e.selectCell(t,0)}function s(e,t,n){var o=e+1,r=o<n.countRows()?n.getCell(o,t):null;r&&(i.utils.isSeparator(r)||i.utils.isDisabled(r)?s(o,t,n):n.selectCell(o,t))}function a(e,t,n){var o=e-1,r=o>=0?n.getCell(o,t):null;r&&(i.utils.isSeparator(r)||i.utils.isDisabled(r)?a(o,t,n):n.selectCell(o,t))}function l(e,t,n,o){var r=e.getData()[o],i=t.getItems(r.submenu),s=t.createMenu(r.name,o),a=n.getBoundingClientRect(),l=t.show(s,i);t.setSubMenuPosition(a,s),l.selectCell(0,0)}e.Dom.enableImmediatePropagation(t);var c=this,u=n.getSelected();switch(t.keyCode){case e.helper.keyCode.ESCAPE:c.closeAll(),t.preventDefault(),t.stopImmediatePropagation();break;case e.helper.keyCode.ENTER:u&&c.performAction(t,n);break;case e.helper.keyCode.ARROW_DOWN:u?s(u[0],u[1],n,c):o(n,c),t.preventDefault(),t.stopImmediatePropagation();break;case e.helper.keyCode.ARROW_UP:u?a(u[0],u[1],n,c):r(n,c),t.preventDefault(),t.stopImmediatePropagation();break;case e.helper.keyCode.ARROW_RIGHT:if(u){var d=u[0],h=n.getCell(u[0],0);i.utils.hasSubMenu(h)&&l(n,c,h,d)}t.preventDefault(),t.stopImmediatePropagation();break;case e.helper.keyCode.ARROW_LEFT:if(u){if(-1!=n.rootElement.className.indexOf("htContextSubMenu_")){c.closeLastOpenedSubMenu();var f=c.menus.length;if(f>0){var p=c.menus[f-1],m=c.triggerRows.pop();n=this.htMenus[p.id],n.selectCell(m,0)}}t.preventDefault(),t.stopImmediatePropagation()}}},i.prototype.getItems=function(t){function n(t){"string"==typeof t?this.name=t:e.helper.extend(this,t)}var o,r;n.prototype=t,t&&t.items&&(t=t.items),t===!0&&(t=this.defaultOptions.items),o=[];for(var i in t)t.hasOwnProperty(i)&&(r="string"==typeof t[i]?s(this.defaultOptions.items,t[i]):s(this.defaultOptions.items,i),r||(r=t[i]),r=new n(r),"object"==typeof t[i]&&e.helper.extend(r,t[i]),r.key||(r.key=i),o.push(r));return o},i.prototype.setSubMenuPosition=function(t,n){var o=e.Dom.getWindowScrollTop(),r=e.Dom.getWindowScrollLeft(),i={top:o+t.top,topRelative:t.top,left:t.left,leftRelative:t.left-r,scrollTop:o,scrollLeft:r,cellHeight:t.height,cellWidth:t.width};this.menuFitsBelowCursor(i,n,document.body.clientWidth)?this.positionMenuBelowCursor(i,n,!0):this.menuFitsAboveCursor(i,n)?this.positionMenuAboveCursor(i,n,!0):this.positionMenuBelowCursor(i,n,!0),this.menuFitsOnRightOfCursor(i,n,document.body.clientWidth)?this.positionMenuOnRightOfCursor(i,n,!0):this.positionMenuOnLeftOfCursor(i,n,!0)},i.prototype.setMenuPosition=function(t,n){var o=e.Dom.getWindowScrollTop(),r=e.Dom.getWindowScrollLeft(),i=t.pageY||t.clientY+o,s=t.pageX||t.clientX+r,a={top:i,topRelative:i-o,left:s,leftRelative:s-r,scrollTop:o,scrollLeft:r,cellHeight:t.target.clientHeight,cellWidth:t.target.clientWidth};this.menuFitsBelowCursor(a,n,document.body.clientHeight)?this.positionMenuBelowCursor(a,n):this.menuFitsAboveCursor(a,n)?this.positionMenuAboveCursor(a,n):this.positionMenuBelowCursor(a,n),this.menuFitsOnRightOfCursor(a,n,document.body.clientWidth)?this.positionMenuOnRightOfCursor(a,n):this.positionMenuOnLeftOfCursor(a,n)},i.prototype.menuFitsAboveCursor=function(e,t){return e.topRelative>=t.offsetHeight},i.prototype.menuFitsBelowCursor=function(e,t,n){return e.topRelative+t.offsetHeight<=n},i.prototype.menuFitsOnRightOfCursor=function(e,t,n){return e.leftRelative+t.offsetWidth<=n},i.prototype.positionMenuBelowCursor=function(e,t){t.style.top=e.top+"px"},i.prototype.positionMenuAboveCursor=function(e,t,n){t.style.top=n?e.top+e.cellHeight-t.offsetHeight+"px":e.top-t.offsetHeight+"px"},i.prototype.positionMenuOnRightOfCursor=function(e,t,n){t.style.left=n?1+e.left+e.cellWidth+"px":1+e.left+"px"},i.prototype.positionMenuOnLeftOfCursor=function(e,t,n){t.style.left=n?e.left-t.offsetWidth+"px":e.left-t.offsetWidth+"px"},i.utils={},i.utils.normalizeSelection=function(e){return{start:e.getTopLeftCorner(),end:e.getBottomRightCorner()}},i.utils.isSeparator=function(t){return e.Dom.hasClass(t,"htSeparator")},i.utils.hasSubMenu=function(t){return e.Dom.hasClass(t,"htSubmenu")},i.utils.isDisabled=function(t){return e.Dom.hasClass(t,"htDisabled")},i.prototype.enable=function(){this.enabled||(this.enabled=!0,this.bindMouseEvents())},i.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.closeAll(),this.unbindMouseEvents(),this.unbindTableEvents())},i.prototype.destroy=function(){for(this.closeAll();this.menus.length>0;){var e=this.menus.pop();this.triggerRows.pop(),e&&(this.close(e),this.isMenuEnabledByOtherHotInstance()||this.removeMenu(e))}this.unbindMouseEvents(),this.unbindTableEvents()},i.prototype.isMenuEnabledByOtherHotInstance=function(){for(var e=document.querySelectorAll(".handsontable"),t=!1,n=0,o=e.length;o>n;n++){var r=this.htMenus[e[n].id];if(r&&r.getSettings().contextMenu){t=!0;break}}return t},i.prototype.removeMenu=function(e){e.parentNode&&this.menu.parentNode.removeChild(e)},i.SEPARATOR={name:"---------"},e.hooks.add("afterInit",c),e.hooks.add("afterUpdateSettings",c),e.hooks.add("afterInit",l),e.PluginHooks.register("afterContextMenuDefaultOptions"),e.ContextMenu=i}(t);var $=function(){var e=this,n=e.getSettings().comments;n&&(t.Comments=new r(e),t.Comments.init())},B=function(e,n,o,r,i,s){s.comment&&t.Dom.addClass(e,s.commentedCellClassName)},W=function(e){var n=this;n.getSettings().comments&&(e.items.push(t.ContextMenu.SEPARATOR),e.items.push({key:"commentsAddEdit",name:function(){var e=t.Comments.checkSelectionCommentsConsistency();return e?"Edit Comment":"Add Comment"},callback:function(){t.Comments.showComment(this.getSelectedRange())},disabled:function(){return!1}}),e.items.push({key:"commentsRemove",name:function(){return"Delete Comment"},callback:function(e,n){t.Comments.removeComment(n.start.row,n.start.col)},disabled:function(){var e=t.Comments.checkSelectionCommentsConsistency();return!e}}))};t.hooks.add("beforeInit",$),t.hooks.add("afterContextMenuDefaultOptions",W),t.hooks.add("afterRenderer",B),function(t){function n(){function n(e){h=this,f=e;var t=this.view.wt.wtTable.getCoords(e).col;if(t>=0){d=t;var n=f.getBoundingClientRect();u=n.left,p.style.top=n.top+"px",p.style.left=u+"px",h.rootElement.appendChild(p)}}function o(e,t){var n=e.getBoundingClientRect(),o=6;p.style.left=t>0?n.left+n.width-o+"px":n.left+"px"}function r(){var e=this;t.Dom.addClass(p,"active"),t.Dom.addClass(m,"active");var n=f.getBoundingClientRect();m.style.width=n.width+"px",m.style.height=e.view.maximumVisibleElementHeight(0)+"px",m.style.top=p.style.top,m.style.left=u+"px",e.rootElement.appendChild(m)}function i(e){m.style.left=u+e+"px"}function s(){t.Dom.removeClass(p,"active"),t.Dom.removeClass(m,"active")}var a,l,c,u,d,h,f,p=document.createElement("DIV"),m=document.createElement("DIV"),g=t.eventManager(this);p.className="manualColumnMover",m.className="manualColumnMoverGuide";var v=function(){var e=this;t.hooks.run(e,"persistentStateSave","manualColumnPositions",e.manualColumnPositions)},w=function(){var e=this,n={};return t.hooks.run(e,"persistentStateLoad","manualColumnPositions",n),n.value},y=function(e){return"BODY"!=e.tagName?"THEAD"==e.parentNode.tagName?!0:(e=e.parentNode,y(e)):!1},C=function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:C(e.parentNode):null},b=function(){var u,h=this;g.addEventListener(h.rootElement,"mouseover",function(e){if(y(e.target)){var t=C(e.target);if(t)if(u){var r=h.view.wt.wtTable.getCoords(t).col;r>=0&&(l=r,o(e.target,l-a))}else n.call(h,t)}}),g.addEventListener(h.rootElement,"mousedown",function(e){t.Dom.hasClass(e.target,"manualColumnMover")&&(c=t.helper.pageX(e),r.call(h),u=h,a=d,l=d)}),g.addEventListener(e,"mousemove",function(e){u&&i(t.helper.pageX(e)-c)}),g.addEventListener(e,"mouseup",function(){u&&(s(),u=!1,T(h.manualColumnPositions,h.countCols()),h.manualColumnPositions.splice(l,0,h.manualColumnPositions.splice(a,1)[0]),h.forceFullRender=!0,h.view.render(),v.call(h),t.hooks.run(h,"afterColumnMove",a,l),n.call(h,f))}),h.addHook("afterDestroy",R)},R=function(){g.clear()},T=function(e,t){if(e.length<t)for(var n=e.length;t>n;n++)e[n]=n};this.beforeInit=function(){this.manualColumnPositions=[]},this.init=function(e){var t=this,n=!!this.getSettings().manualColumnMove;if(n){var o=this.getSettings().manualColumnMove,r=w.call(t);this.manualColumnPositions="undefined"!=typeof r?r:Array.isArray(o)?o:[],"afterInit"==e&&("undefined"!=typeof t.manualColumnPositionsPluginUsages?t.manualColumnPositionsPluginUsages.push("manualColumnMove"):t.manualColumnPositionsPluginUsages=["manualColumnMove"],b.call(this),this.manualColumnPositions.length>0&&(this.forceFullRender=!0,this.render()))}else{var i=t.manualColumnPositionsPluginUsages?t.manualColumnPositionsPluginUsages.indexOf("manualColumnMove"):-1;i>-1&&(R.call(this),this.manualColumnPositions=[],t.manualColumnPositionsPluginUsages[i]=void 0)}},this.modifyCol=function(e){return this.getSettings().manualColumnMove?("undefined"==typeof this.manualColumnPositions[e]&&T(this.manualColumnPositions,e+1),this.manualColumnPositions[e]):e},this.afterRemoveCol=function(e,t){if(this.getSettings().manualColumnMove){var n,o=this.manualColumnPositions;n=o.splice(e,t),o=o.map(function(e){var t,o=e;for(t=0;t<n.length;t++)e>n[t]&&o--;return o}),this.manualColumnPositions=o}},this.afterCreateCol=function(e,t){if(this.getSettings().manualColumnMove){var n=this.manualColumnPositions;if(n.length){for(var o=[],r=0;t>r;r++)o.push(e+r);e>=n.length?n.concat(o):(n=n.map(function(n){return n>=e?n+t:n}),n.splice.apply(n,[e,0].concat(o))),this.manualColumnPositions=n}}}}var o=new n;t.hooks.add("beforeInit",o.beforeInit),t.hooks.add("afterInit",function(){o.init.call(this,"afterInit")}),t.hooks.add("afterUpdateSettings",function(){o.init.call(this,"afterUpdateSettings")}),t.hooks.add("modifyCol",o.modifyCol),t.hooks.add("afterRemoveCol",o.afterRemoveCol),t.hooks.add("afterCreateCol",o.afterCreateCol),t.hooks.register("afterColumnMove")}(t),function(t){function n(){function n(e){u=this,a=e;var t=this.view.wt.wtTable.getCoords(e).col;if(t>=0){l=t;var n=a.getBoundingClientRect();p=n.left-6,f=parseInt(n.width,10),m.style.top=n.top+"px",m.style.left=p+f+"px",u.rootElement.appendChild(m)}}function o(){m.style.left=p+c+"px"}function r(){var e=this;t.Dom.addClass(m,"active"),t.Dom.addClass(g,"active"),g.style.top=m.style.top,g.style.left=m.style.left,g.style.height=e.view.maximumVisibleElementHeight(0)+"px",e.rootElement.appendChild(g)}function i(){g.style.left=m.style.left}function s(){t.Dom.removeClass(m,"active"),t.Dom.removeClass(g,"active")}var a,l,c,u,d,h,f,p,m=document.createElement("DIV"),g=document.createElement("DIV"),v=t.eventManager(this);m.className="manualColumnResizer",g.className="manualColumnResizerGuide";var w=function(){var e=this;t.hooks.run(e,"persistentStateSave","manualColumnWidths",e.manualColumnWidths)},y=function(){var e=this,n={};return t.hooks.run(e,"persistentStateLoad","manualColumnWidths",n),n.value},C=function(e){return"BODY"!=e.tagName?"THEAD"==e.parentNode.tagName?!0:(e=e.parentNode,C(e)):!1},b=function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:b(e.parentNode):null},R=function(){var u,p=this,m=0,g=null;v.addEventListener(p.rootElement,"mouseover",function(e){if(C(e.target)){var t=b(e.target);t&&(u||n.call(p,t))}}),v.addEventListener(p.rootElement,"mousedown",function(e){t.Dom.hasClass(e.target,"manualColumnResizer")&&(r.call(p),u=p,null==g&&(g=setTimeout(function(){m>=2&&(d=p.determineColumnWidth.call(p,l),S(l,d),p.forceFullRender=!0,p.view.render(),t.hooks.run(p,"afterColumnResize",l,d)),m=0,g=null},500),p._registerTimeout(g)),m++,h=t.helper.pageX(e),d=f)}),v.addEventListener(e,"mousemove",function(e){u&&(c=f+(t.helper.pageX(e)-h),d=S(l,c),o(),i())}),v.addEventListener(e,"mouseup",function(){u&&(s(),u=!1,d!=f&&(p.forceFullRender=!0,p.view.render(),w.call(p),t.hooks.run(p,"afterColumnResize",l,d)),n.call(p,a))}),p.addHook("afterDestroy",T)},T=function(){v.clear()};this.beforeInit=function(){this.manualColumnWidths=[]},this.init=function(e){var t=this,n=!!this.getSettings().manualColumnResize;if(n){var o=this.getSettings().manualColumnResize,r=y.call(t);"undefined"!=typeof t.manualColumnWidthsPluginUsages?t.manualColumnWidthsPluginUsages.push("manualColumnResize"):t.manualColumnWidthsPluginUsages=["manualColumnResize"],this.manualColumnWidths="undefined"!=typeof r?r:Array.isArray(o)?o:[],"afterInit"==e&&(R.call(this),this.manualColumnWidths.length>0&&(this.forceFullRender=!0,this.render()))}else{var i=t.manualColumnWidthsPluginUsages?t.manualColumnWidthsPluginUsages.indexOf("manualColumnResize"):-1;i>-1&&(T.call(this),this.manualColumnWidths=[])}};var S=function(e,n){return n=Math.max(n,20),e=t.hooks.run(u,"modifyCol",e),u.manualColumnWidths[e]=n,n};this.modifyColWidth=function(e,t){return t=this.runHooks("modifyCol",t),this.getSettings().manualColumnResize&&this.manualColumnWidths[t]?this.manualColumnWidths[t]:e}}var o=new n;t.hooks.add("beforeInit",o.beforeInit),t.hooks.add("afterInit",function(){o.init.call(this,"afterInit")}),t.hooks.add("afterUpdateSettings",function(){o.init.call(this,"afterUpdateSettings")}),t.hooks.add("modifyColWidth",o.modifyColWidth),t.hooks.register("afterColumnResize")}(t),function(t){function n(){function n(e){u=this,a=e;var t=this.view.wt.wtTable.getCoords(e).row;if(t>=0){l=t;var n=a.getBoundingClientRect();p=n.top-6,f=parseInt(n.height,10),m.style.left=n.left+"px",m.style.top=p+f+"px",u.rootElement.appendChild(m)}}function o(){m.style.top=p+c+"px"}function r(){var e=this;t.Dom.addClass(m,"active"),t.Dom.addClass(g,"active"),g.style.top=m.style.top,g.style.left=m.style.left,g.style.width=e.view.maximumVisibleElementWidth(0)+"px",e.rootElement.appendChild(g)}function i(){g.style.top=m.style.top}function s(){t.Dom.removeClass(m,"active"),t.Dom.removeClass(g,"active")}var a,l,c,u,d,h,f,p,m=document.createElement("DIV"),g=document.createElement("DIV"),v=t.eventManager(this);m.className="manualRowResizer",g.className="manualRowResizerGuide";var w=function(){var e=this;t.hooks.run(e,"persistentStateSave","manualRowHeights",e.manualRowHeights)},y=function(){var e=this,n={};return t.hooks.run(e,"persistentStateLoad","manualRowHeights",n),n.value},C=function(e){return"BODY"!=e.tagName?"TBODY"==e.parentNode.tagName?!0:(e=e.parentNode,C(e)):!1},b=function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:b(e.parentNode):null},R=function(){var u,p=this,m=0,g=null;v.addEventListener(p.rootElement,"mouseover",function(e){if(C(e.target)){var t=b(e.target);t&&(u||n.call(p,t))}}),v.addEventListener(p.rootElement,"mousedown",function(e){t.Dom.hasClass(e.target,"manualRowResizer")&&(r.call(p),u=p,null==g&&(g=setTimeout(function(){m>=2&&(S(l,null),p.forceFullRender=!0,p.view.render(),t.hooks.run(p,"afterRowResize",l,d)),m=0,g=null},500),p._registerTimeout(g)),m++,h=t.helper.pageY(e),d=f)}),v.addEventListener(e,"mousemove",function(e){u&&(c=f+(t.helper.pageY(e)-h),d=S(l,c),o(),i())}),v.addEventListener(e,"mouseup",function(){u&&(s(),u=!1,d!=f&&(p.forceFullRender=!0,p.view.render(),w.call(p),t.hooks.run(p,"afterRowResize",l,d)),n.call(p,a))}),p.addHook("afterDestroy",T)},T=function(){v.clear()};this.beforeInit=function(){this.manualRowHeights=[]},this.init=function(e){var t=this,n=!!this.getSettings().manualRowResize;if(n){var o=this.getSettings().manualRowResize,r=y.call(t);"undefined"!=typeof t.manualRowHeightsPluginUsages?t.manualRowHeightsPluginUsages.push("manualRowResize"):t.manualRowHeightsPluginUsages=["manualRowResize"],this.manualRowHeights="undefined"!=typeof r?r:Array.isArray(o)?o:[],"afterInit"===e?(R.call(this),this.manualRowHeights.length>0&&(this.forceFullRender=!0,this.render())):(this.forceFullRender=!0,this.render())}else{var i=t.manualRowHeightsPluginUsages?t.manualRowHeightsPluginUsages.indexOf("manualRowResize"):-1;i>-1&&(T.call(this),this.manualRowHeights=[],t.manualRowHeightsPluginUsages[i]=void 0)}};var S=function(e,n){return e=t.hooks.run(u,"modifyRow",e),u.manualRowHeights[e]=n,n};this.modifyRowHeight=function(e,t){return this.getSettings().manualRowResize&&(t=this.runHooks("modifyRow",t),void 0!==this.manualRowHeights[t])?this.manualRowHeights[t]:e}}var o=new n;t.hooks.add("beforeInit",o.beforeInit),t.hooks.add("afterInit",function(){o.init.call(this,"afterInit")}),t.hooks.add("afterUpdateSettings",function(){o.init.call(this,"afterUpdateSettings")}),t.hooks.add("modifyRowHeight",o.modifyRowHeight),t.hooks.register("afterRowResize")}(t),function(){function e(){var e=this,t=e.getSettings().observeChanges;t?(e.observer&&r.call(e),n.call(e),s.call(e)):t||r.call(e)}function n(){var e=this;e.observeChangesActive=!0,e.pauseObservingChanges=function(){e.observeChangesActive=!1},e.resumeObservingChanges=function(){e.observeChangesActive=!0},e.observedData=e.getData(),e.observer=I.observe(e.observedData,function(t){e.observeChangesActive&&(o.call(e,t),e.render()),e.runHooks("afterChangesObserved")})}function o(e){function t(e){var t;return t=o(e),t=n(t)}function n(e){var t=[];return e.filter(function(e){var n=r(e.path);if(-1!=["add","remove"].indexOf(e.op)&&!isNaN(n.col)){if(-1!=t.indexOf(n.col))return!1;t.push(n.col)}return!0})}function o(e){return e.filter(function(e){return!/[/]length/gi.test(e.path)})}function r(e){var t=e.match(/^\/(\d+)\/?(.*)?$/);return{row:parseInt(t[1],10),col:/^\d*$/.test(t[2])?parseInt(t[2],10):t[2]}}for(var i=this,s=t(e),a=0,l=s.length;l>a;a++){var c=s[a],u=r(c.path);switch(c.op){case"add":isNaN(u.col)?i.runHooks("afterCreateRow",u.row):i.runHooks("afterCreateCol",u.col);break;case"remove":isNaN(u.col)?i.runHooks("afterRemoveRow",u.row,1):i.runHooks("afterRemoveCol",u.col,1);break;case"replace":i.runHooks("afterChange",[u.row,u.col,null,c.value],"external")}}}function r(){var e=this;e.observer&&(i.call(e),a.call(e))}function i(){var e=this;I.unobserve(e.observedData,e.observer),delete e.observeChangesActive,delete e.pauseObservingChanges,delete e.resumeObservingChanges}function s(){var e=this;e.addHook("afterDestroy",r),e.addHook("afterCreateRow",l),e.addHook("afterRemoveRow",l),e.addHook("afterCreateCol",l),e.addHook("afterRemoveCol",l),e.addHook("afterChange",function(e,t){"loadData"!=t&&l.call(this)})}function a(){var e=this;e.removeHook("afterDestroy",r),e.removeHook("afterCreateRow",l),e.removeHook("afterRemoveRow",l),e.removeHook("afterCreateCol",l),e.removeHook("afterRemoveCol",l),e.removeHook("afterChange",l)}function l(){var e=this;e.pauseObservingChanges(),e.addHookOnce("afterChangesObserved",function(){e.resumeObservingChanges()})}t.hooks.add("afterLoadData",e),t.hooks.add("afterUpdateSettings",e),t.hooks.register("afterChangesObserved")}(),function(e){function n(){function n(){var e=this;for(var t in i)i.hasOwnProperty(t)&&e.addHook(t,i[t])}function o(){var e=this;for(var t in i)i.hasOwnProperty(t)&&e.removeHook(t,i[t])}var r=this;this.init=function(){var t=this,i=t.getSettings().persistentState;return r.enabled=!!i,r.enabled?(t.storage||(t.storage=new e(t.rootElement.id)),t.resetState=r.resetValue,void n.call(t)):void o.call(t)},this.saveValue=function(e,t){var n=this;n.storage.saveValue(e,t)},this.loadValue=function(e,t){var n=this;t.value=n.storage.loadValue(e)},this.resetValue=function(e){var t=this;"undefined"!=typeof e?t.storage.reset(e):t.storage.resetAll()};var i={persistentStateSave:r.saveValue,persistentStateLoad:r.loadValue,persistentStateReset:r.resetValue};for(var s in i)i.hasOwnProperty(s)&&t.hooks.register(s)}var o=new n;t.hooks.add("beforeInit",o.init),t.hooks.add("afterUpdateSettings",o.init)}(i),function(e){e.UndoRedo=function(t){var n=this;this.instance=t,this.doneActions=[],this.undoneActions=[],this.ignoreNewActions=!1,t.addHook("afterChange",function(t){if(t){var o=new e.UndoRedo.ChangeAction(t);n.done(o)}}),t.addHook("afterCreateRow",function(t,o,r){if(!r){var i=new e.UndoRedo.CreateRowAction(t,o);n.done(i)}}),t.addHook("beforeRemoveRow",function(t,o){var r=n.instance.getData();t=(r.length+t)%r.length;var i=r.slice(t,t+o),s=new e.UndoRedo.RemoveRowAction(t,i);n.done(s)}),t.addHook("afterCreateCol",function(t,o,r){if(!r){var i=new e.UndoRedo.CreateColumnAction(t,o);n.done(i)}}),t.addHook("beforeRemoveCol",function(o,r){var i=n.instance.getData();o=(n.instance.countCols()+o)%n.instance.countCols();for(var s=[],a=0,l=i.length;l>a;a++)s[a]=i[a].slice(o,o+r);var c;Array.isArray(t.getSettings().colHeaders)&&(c=t.getSettings().colHeaders.slice(o,o+s.length));var u=new e.UndoRedo.RemoveColumnAction(o,s,c);n.done(u)})},e.UndoRedo.prototype.done=function(e){this.ignoreNewActions||(this.doneActions.push(e),this.undoneActions.length=0)},e.UndoRedo.prototype.undo=function(){if(this.isUndoAvailable()){var e=this.doneActions.pop();this.ignoreNewActions=!0;var t=this;e.undo(this.instance,function(){t.ignoreNewActions=!1,t.undoneActions.push(e)})}},e.UndoRedo.prototype.redo=function(){if(this.isRedoAvailable()){var e=this.undoneActions.pop();this.ignoreNewActions=!0;var t=this;e.redo(this.instance,function(){t.ignoreNewActions=!1,t.doneActions.push(e)})}},e.UndoRedo.prototype.isUndoAvailable=function(){return this.doneActions.length>0},e.UndoRedo.prototype.isRedoAvailable=function(){return this.undoneActions.length>0},e.UndoRedo.prototype.clear=function(){this.doneActions.length=0,this.undoneActions.length=0},e.UndoRedo.Action=function(){},e.UndoRedo.Action.prototype.undo=function(){},e.UndoRedo.Action.prototype.redo=function(){},e.UndoRedo.ChangeAction=function(e){this.changes=e},e.helper.inherit(e.UndoRedo.ChangeAction,e.UndoRedo.Action),e.UndoRedo.ChangeAction.prototype.undo=function(t,n){for(var o=e.helper.deepClone(this.changes),r=t.countEmptyRows(!0),i=t.countEmptyCols(!0),s=0,a=o.length;a>s;s++)o[s].splice(3,1);t.addHookOnce("afterChange",n),t.setDataAtRowProp(o,null,null,"undo");for(var s=0,a=o.length;a>s;s++)t.getSettings().minSpareRows&&o[s][0]+1+t.getSettings().minSpareRows===t.countRows()&&r==t.getSettings().minSpareRows&&(t.alter("remove_row",parseInt(o[s][0]+1,10),t.getSettings().minSpareRows),t.undoRedo.doneActions.pop()),t.getSettings().minSpareCols&&o[s][1]+1+t.getSettings().minSpareCols===t.countCols()&&i==t.getSettings().minSpareCols&&(t.alter("remove_col",parseInt(o[s][1]+1,10),t.getSettings().minSpareCols),t.undoRedo.doneActions.pop())},e.UndoRedo.ChangeAction.prototype.redo=function(t,n){for(var o=e.helper.deepClone(this.changes),r=0,i=o.length;i>r;r++)o[r].splice(2,1);t.addHookOnce("afterChange",n),t.setDataAtRowProp(o,null,null,"redo")},e.UndoRedo.CreateRowAction=function(e,t){this.index=e,this.amount=t},e.helper.inherit(e.UndoRedo.CreateRowAction,e.UndoRedo.Action),e.UndoRedo.CreateRowAction.prototype.undo=function(e,t){e.addHookOnce("afterRemoveRow",t),e.alter("remove_row",this.index,this.amount)},e.UndoRedo.CreateRowAction.prototype.redo=function(e,t){e.addHookOnce("afterCreateRow",t),e.alter("insert_row",this.index+1,this.amount)},e.UndoRedo.RemoveRowAction=function(e,t){this.index=e,this.data=t},e.helper.inherit(e.UndoRedo.RemoveRowAction,e.UndoRedo.Action),e.UndoRedo.RemoveRowAction.prototype.undo=function(e,t){var n=[this.index,0];Array.prototype.push.apply(n,this.data),Array.prototype.splice.apply(e.getData(),n),e.addHookOnce("afterRender",t),e.render()
},e.UndoRedo.RemoveRowAction.prototype.redo=function(e,t){e.addHookOnce("afterRemoveRow",t),e.alter("remove_row",this.index,this.data.length)},e.UndoRedo.CreateColumnAction=function(e,t){this.index=e,this.amount=t},e.helper.inherit(e.UndoRedo.CreateColumnAction,e.UndoRedo.Action),e.UndoRedo.CreateColumnAction.prototype.undo=function(e,t){e.addHookOnce("afterRemoveCol",t),e.alter("remove_col",this.index,this.amount)},e.UndoRedo.CreateColumnAction.prototype.redo=function(e,t){e.addHookOnce("afterCreateCol",t),e.alter("insert_col",this.index+1,this.amount)},e.UndoRedo.RemoveColumnAction=function(e,t,n){this.index=e,this.data=t,this.amount=this.data[0].length,this.headers=n},e.helper.inherit(e.UndoRedo.RemoveColumnAction,e.UndoRedo.Action),e.UndoRedo.RemoveColumnAction.prototype.undo=function(e,t){for(var n,o,r=0,i=e.getData().length;i>r;r++)n=e.getSourceDataAtRow(r),o=[this.index,0],Array.prototype.push.apply(o,this.data[r]),Array.prototype.splice.apply(n,o);"undefined"!=typeof this.headers&&(o=[this.index,0],Array.prototype.push.apply(o,this.headers),Array.prototype.splice.apply(e.getSettings().colHeaders,o)),e.addHookOnce("afterRender",t),e.render()},e.UndoRedo.RemoveColumnAction.prototype.redo=function(e,t){e.addHookOnce("afterRemoveCol",t),e.alter("remove_col",this.index,this.amount)}}(t),function(e){function t(){var t=this,s="undefined"==typeof t.getSettings().undo||t.getSettings().undo;s?t.undoRedo||(t.undoRedo=new e.UndoRedo(t),r(t),t.addHook("beforeKeyDown",n),t.addHook("afterChange",o)):t.undoRedo&&(delete t.undoRedo,i(t),t.removeHook("beforeKeyDown",n),t.removeHook("afterChange",o))}function n(e){var t=this,n=(e.ctrlKey||e.metaKey)&&!e.altKey;n&&(89===e.keyCode||e.shiftKey&&90===e.keyCode?(t.undoRedo.redo(),e.stopImmediatePropagation()):90===e.keyCode&&(t.undoRedo.undo(),e.stopImmediatePropagation()))}function o(e,t){var n=this;return"loadData"==t?n.undoRedo.clear():void 0}function r(e){e.undo=function(){return e.undoRedo.undo()},e.redo=function(){return e.undoRedo.redo()},e.isUndoAvailable=function(){return e.undoRedo.isUndoAvailable()},e.isRedoAvailable=function(){return e.undoRedo.isRedoAvailable()},e.clearUndo=function(){return e.undoRedo.clear()}}function i(e){delete e.undo,delete e.redo,delete e.isUndoAvailable,delete e.isRedoAvailable,delete e.clearUndo}e.hooks.add("afterInit",t),e.hooks.add("afterUpdateSettings",t)}(t),s.prototype.setBoundaries=function(e){this.boundaries=e},s.prototype.setCallback=function(e){this.callback=e},s.prototype.check=function(e,t){var n=0,o=0;t<this.boundaries.top?o=t-this.boundaries.top:t>this.boundaries.bottom&&(o=t-this.boundaries.bottom),e<this.boundaries.left?n=e-this.boundaries.left:e>this.boundaries.right&&(n=e-this.boundaries.right),this.callback(n,o)};var F,V;if("undefined"!=typeof t){var j=function(t){t.dragToScrollListening=!1;var n=t.view.wt.wtScrollbars.vertical.scrollHandler;F=new s,n!==e&&(F.setBoundaries(n.getBoundingClientRect()),F.setCallback(function(e,t){0>e?n.scrollLeft-=50:e>0&&(n.scrollLeft+=50),0>t?n.scrollTop-=20:t>0&&(n.scrollTop+=20)}),t.dragToScrollListening=!0)};t.hooks.add("afterInit",function(){var e=this,n=t.eventManager(this);n.addEventListener(document,"mouseup",function(){e.dragToScrollListening=!1}),n.addEventListener(document,"mousemove",function(t){e.dragToScrollListening&&F.check(t.clientX,t.clientY)})}),t.hooks.add("afterDestroy",function(){var e=t.eventManager(this);e.clear()}),t.hooks.add("afterOnCellMouseDown",function(){j(this)}),t.hooks.add("afterOnCellCornerMouseDown",function(){j(this)}),t.plugins.DragToScroll=s}if(function(e,t,n){function o(o){function r(){o.isListening()&&o.selection.empty()}function i(e){var t,r,i,s,a,l,c,u,f,p;o.isListening()&&o.selection.isSelected()&&(t=e,r=n.parse(t),i=o.getSelected(),s=new d(i[0],i[1]),a=new d(i[2],i[3]),l=new h(s,s,a),c=l.getTopLeftCorner(),u=l.getBottomRightCorner(),f=c,p=new d(Math.max(u.row,r.length-1+c.row),Math.max(u.col,r[0].length-1+c.col)),o.addHookOnce("afterChange",function(e){e&&e.length&&this.selectCell(f.row,f.col,p.row,p.col)}),o.populateFromArray(f.row,f.col,r,p.row,p.col,"paste",o.getSettings().pasteMode))}function s(t){var n;if(o.getSelected()){if(e.helper.isCtrlKey(t.keyCode))return a.setCopyableText(),void t.stopImmediatePropagation();n=(t.ctrlKey||t.metaKey)&&!t.altKey,t.keyCode==e.helper.keyCode.A&&n&&o._registerTimeout(setTimeout(e.helper.proxy(a.setCopyableText,a),0))}}var a=this;this.copyPasteInstance=t.getInstance(),this.copyPasteInstance.onCut(r),this.copyPasteInstance.onPaste(i),o.addHook("beforeKeyDown",s),this.destroy=function(){this.copyPasteInstance.removeCallback(r),this.copyPasteInstance.removeCallback(i),this.copyPasteInstance.destroy(),o.removeHook("beforeKeyDown",s)},o.addHook("afterDestroy",e.helper.proxy(this.destroy,this)),this.triggerPaste=e.helper.proxy(this.copyPasteInstance.triggerPaste,this.copyPasteInstance),this.triggerCut=e.helper.proxy(this.copyPasteInstance.triggerCut,this.copyPasteInstance),this.setCopyableText=function(){var t=o.getSettings(),n=t.copyRowsLimit,r=t.copyColsLimit,i=o.getSelectedRange(),s=i.getTopLeftCorner(),a=i.getBottomRightCorner(),l=s.row,c=s.col,u=a.row,d=a.col,h=Math.min(u,l+n-1),f=Math.min(d,c+r-1);o.copyPaste.copyPasteInstance.copyable(o.getCopyableData(l,c,h,f)),(u!==h||d!==f)&&e.hooks.run(o,"afterCopyLimit",u-l+1,d-c+1,n,r)}}function r(){var e=this,t=e.getSettings().copyPaste!==!1;t&&!e.copyPaste?e.copyPaste=new o(e):!t&&e.copyPaste&&(e.copyPaste.destroy(),delete e.copyPaste)}e.hooks.add("afterInit",r),e.hooks.add("afterUpdateSettings",r),e.hooks.register("afterCopyLimit")}(t,L,SheetClip),function(e){function t(){var t=this,n=!!t.getSettings().search;n?t.search=new e.Search(t):delete t.search}e.Search=function(t){this.query=function(n,o,r){var i=t.countRows(),s=t.countCols(),a=[];o||(o=e.Search.global.getDefaultCallback()),r||(r=e.Search.global.getDefaultQueryMethod());for(var l=0;i>l;l++)for(var c=0;s>c;c++){var u=t.getDataAtCell(l,c),d=t.getCellMeta(l,c),h=d.search.callback||o,f=d.search.queryMethod||r,p=f(n,u);if(p){var m={row:l,col:c,data:u};a.push(m)}h&&h(t,l,c,u,p)}return a}},e.Search.DEFAULT_CALLBACK=function(e,t,n,o,r){e.getCellMeta(t,n).isSearchResult=r},e.Search.DEFAULT_QUERY_METHOD=function(e,t){return"undefined"!=typeof e&&null!=e&&e.toLowerCase&&0!==e.length?"undefined"==typeof t||null==t?!1:-1!=t.toString().toLowerCase().indexOf(e.toLowerCase()):!1},e.Search.DEFAULT_SEARCH_RESULT_CLASS="htSearchResult",e.Search.global=function(){var t=e.Search.DEFAULT_CALLBACK,n=e.Search.DEFAULT_QUERY_METHOD,o=e.Search.DEFAULT_SEARCH_RESULT_CLASS;return{getDefaultCallback:function(){return t},setDefaultCallback:function(e){t=e},getDefaultQueryMethod:function(){return n},setDefaultQueryMethod:function(e){n=e},getDefaultSearchResultClass:function(){return o},setDefaultSearchResultClass:function(e){o=e}}}(),e.SearchCellDecorator=function(t,n,o,r,i,s,a){var l="object"==typeof a.search&&a.search.searchResultClass||e.Search.global.getDefaultSearchResultClass();a.isSearchResult?e.Dom.addClass(n,l):e.Dom.removeClass(n,l)};var n=e.renderers.cellDecorator;e.renderers.cellDecorator=function(){n.apply(this,arguments),e.SearchCellDecorator.apply(this,arguments)},e.hooks.add("afterInit",t),e.hooks.add("afterUpdateSettings",t)}(t),l.prototype.canMergeRange=function(e){return!e.isSingle()},l.prototype.mergeRange=function(e){if(this.canMergeRange(e)){var t=e.getTopLeftCorner(),n=e.getBottomRightCorner(),o={};o.row=t.row,o.col=t.col,o.rowspan=n.row-t.row+1,o.colspan=n.col-t.col+1,this.mergedCellInfoCollection.setInfo(o)}},l.prototype.mergeOrUnmergeSelection=function(e){var t=this.mergedCellInfoCollection.getInfo(e.from.row,e.from.col);t?this.unmergeSelection(e.from):this.mergeSelection(e)},l.prototype.mergeSelection=function(e){this.mergeRange(e)},l.prototype.unmergeSelection=function(e){var t=this.mergedCellInfoCollection.getInfo(e.row,e.col);this.mergedCellInfoCollection.removeInfo(t.row,t.col)},l.prototype.applySpanProperties=function(e,t,n){var o=this.mergedCellInfoCollection.getInfo(t,n);o?o.row===t&&o.col===n?(e.setAttribute("rowspan",o.rowspan),e.setAttribute("colspan",o.colspan)):(e.removeAttribute("rowspan"),e.removeAttribute("colspan"),e.style.display="none"):(e.removeAttribute("rowspan"),e.removeAttribute("colspan"))},l.prototype.modifyTransform=function(e,t,n){var o=function(e,t){return t.row>=e.row&&t.row<=e.row+e.rowspan-1?!0:!1},r=function(e,t){return t.col>=e.col&&t.col<=e.col+e.colspan-1?!0:!1},i=function(e){return new d(t.to.row+e.row,t.to.col+e.col)},s={row:n.row,col:n.col};if("modifyTransformStart"==e){this.lastDesiredCoords||(this.lastDesiredCoords=new d(null,null));for(var a,l=new d(t.highlight.row,t.highlight.col),c=this.mergedCellInfoCollection.getInfo(l.row,l.col),u=0,f=this.mergedCellInfoCollection.length;f>u;u++){var p=this.mergedCellInfoCollection[u];if(p=new d(p.row+p.rowspan-1,p.col+p.colspan-1),t.includes(p)){a=!0;break}}if(c){var m=new d(c.row,c.col),g=new d(c.row+c.rowspan-1,c.col+c.colspan-1),v=new h(m,m,g);v.includes(this.lastDesiredCoords)||(this.lastDesiredCoords=new d(null,null)),s.row=this.lastDesiredCoords.row?this.lastDesiredCoords.row-l.row:s.row,s.col=this.lastDesiredCoords.col?this.lastDesiredCoords.col-l.col:s.col,n.row>0?s.row=c.row+c.rowspan-1-l.row+n.row:n.row<0&&(s.row=l.row-c.row+n.row),n.col>0?s.col=c.col+c.colspan-1-l.col+n.col:n.col<0&&(s.col=l.col-c.col+n.col)}var w=new d(t.highlight.row+s.row,t.highlight.col+s.col),y=this.mergedCellInfoCollection.getInfo(w.row,w.col);y&&(this.lastDesiredCoords=w,s={row:y.row-l.row,col:y.col-l.col})}else if("modifyTransformEnd"==e)for(var u=0,f=this.mergedCellInfoCollection.length;f>u;u++){var C=this.mergedCellInfoCollection[u],m=new d(C.row,C.col),g=new d(C.row+C.rowspan-1,C.col+C.colspan-1),b=new h(m,m,g),R=t.getBordersSharedWith(b);if(b.isEqual(t))t.setDirection("NW-SE");else if(R.length>0){var T=t.highlight.isEqual(b.from);R.indexOf("top")>-1?t.to.isSouthEastOf(b.from)&&T?t.setDirection("NW-SE"):t.to.isSouthWestOf(b.from)&&T&&t.setDirection("NE-SW"):R.indexOf("bottom")>-1&&(t.to.isNorthEastOf(b.from)&&T?t.setDirection("SW-NE"):t.to.isNorthWestOf(b.from)&&T&&t.setDirection("SE-NW"))}var w=i(s),S=o(C,w),E=r(C,w);t.includesRange(b)&&(b.includes(w)||S||E)&&(S&&(s.row<0?s.row-=C.rowspan-1:s.row>0&&(s.row+=C.rowspan-1)),E&&(s.col<0?s.col-=C.colspan-1:s.col>0&&(s.col+=C.colspan-1)))}0!==s.row&&(n.row=s.row),0!==s.col&&(n.col=s.col)},"undefined"==typeof t)throw new Error("Handsontable is not defined");var z=function(){var e=this,t=e.getSettings().mergeCells;t&&(e.mergeCells||(e.mergeCells=new l(t)))},G=function(){var e=this;e.mergeCells&&(e.view.wt.wtTable.getCell=function(t){if(e.getSettings().mergeCells){var n=e.mergeCells.mergedCellInfoCollection.getInfo(t.row,t.col);n&&(t=n)}return k.prototype.getCell.call(this,t)})},q=function(e){if(this.mergeCells){var t=(e.ctrlKey||e.metaKey)&&!e.altKey;t&&77===e.keyCode&&(this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange()),this.render(),e.stopImmediatePropagation())}},U=function(e){this.getSettings().mergeCells&&(e.items.push(t.ContextMenu.SEPARATOR),e.items.push({key:"mergeCells",name:function(){var e=this.getSelected(),t=this.mergeCells.mergedCellInfoCollection.getInfo(e[0],e[1]);return t?"Unmerge cells":"Merge cells"},callback:function(){this.mergeCells.mergeOrUnmergeSelection(this.getSelectedRange()),this.render()},disabled:function(){return!1}}))},B=function(e,t,n){this.mergeCells&&this.mergeCells.applySpanProperties(e,t,n)},K=function(e){return function(t){var n=this.getSettings().mergeCells;if(n){var o=this.getSelectedRange();if(this.mergeCells.modifyTransform(e,o,t),"modifyTransformEnd"===e){var r=this.countRows(),i=this.countCols();o.from.row<0?o.from.row=0:o.from.row>0&&o.from.row>=r&&(o.from.row=o.from-1),o.from.col<0?o.from.col=0:o.from.col>0&&o.from.col>=i&&(o.from.col=i-1)}}}},X=function(e){this.lastDesiredCoords=null;var t=this.getSettings().mergeCells;if(t){var n=this.getSelectedRange();n.highlight=new d(n.highlight.row,n.highlight.col),n.to=e;var o=!1;do{o=!1;for(var r=0,i=this.mergeCells.mergedCellInfoCollection.length;i>r;r++){var s=this.mergeCells.mergedCellInfoCollection[r],a=new d(s.row,s.col),l=new d(s.row+s.rowspan-1,s.col+s.colspan-1),c=new h(a,a,l);n.expandByRange(c)&&(e.row=n.to.row,e.col=n.to.col,o=!0)}}while(o)}},Y=function(e,t){if(t&&"area"==t){var n=this.getSettings().mergeCells;if(n)for(var o=this.getSelectedRange(),r=new h(o.from,o.from,o.from),i=new h(o.to,o.to,o.to),s=0,a=this.mergeCells.mergedCellInfoCollection.length;a>s;s++){var l=this.mergeCells.mergedCellInfoCollection[s],c=new d(l.row,l.col),u=new d(l.row+l.rowspan-1,l.col+l.colspan-1),f=new h(c,c,u);r.expandByRange(f)&&(e[0]=r.from.row,e[1]=r.from.col),i.expandByRange(f)&&(e[2]=i.from.row,e[3]=i.from.col)}}},Q=function(e,t,n){var o=this.getSettings().mergeCells;if(o){var r=this.mergeCells.mergedCellInfoCollection.getInfo(e,t);!r||r.row==e&&r.col==t||(n.copyable=!1)}},J=function(e){var t=this.getSettings().mergeCells;if(t)for(var n,o=this.countCols(),r=0;o>r;r++){if(n=this.mergeCells.mergedCellInfoCollection.getInfo(e.startRow,r),n&&n.row<e.startRow)return e.startRow=n.row,J.call(this,e);if(n=this.mergeCells.mergedCellInfoCollection.getInfo(e.endRow,r)){var i=n.row+n.rowspan-1;if(i>e.endRow)return e.endRow=i,J.call(this,e)}}},Z=function(e){var t=this.getSettings().mergeCells;if(t)for(var n,o=this.countRows(),r=0;o>r;r++){if(n=this.mergeCells.mergedCellInfoCollection.getInfo(r,e.startColumn),n&&n.col<e.startColumn)return e.startColumn=n.col,Z.call(this,e);if(n=this.mergeCells.mergedCellInfoCollection.getInfo(r,e.endColumn)){var i=n.col+n.colspan-1;if(i>e.endColumn)return e.endColumn=i,Z.call(this,e)}}},et=function(e){if(e&&this.mergeCells){var t=this.mergeCells.mergedCellInfoCollection,n=this.getSelectedRange();for(var o in t)if(n.highlight.row==t[o].row&&n.highlight.col==t[o].col&&n.to.row==t[o].row+t[o].rowspan-1&&n.to.col==t[o].col+t[o].colspan-1)return!1}return e};t.hooks.add("beforeInit",z),t.hooks.add("afterInit",G),t.hooks.add("beforeKeyDown",q),t.hooks.add("modifyTransformStart",K("modifyTransformStart")),t.hooks.add("modifyTransformEnd",K("modifyTransformEnd")),t.hooks.add("beforeSetRangeEnd",X),t.hooks.add("beforeDrawBorders",Y),t.hooks.add("afterIsMultipleSelection",et),t.hooks.add("afterRenderer",B),t.hooks.add("afterContextMenuDefaultOptions",U),t.hooks.add("afterGetCellMeta",Q),t.hooks.add("afterViewportRowCalculatorOverride",J),t.hooks.add("afterViewportColumnCalculatorOverride",Z),t.MergeCells=l,function(){function e(){}var n,o=function(e){return"boolean"==typeof e&&e===!0?!0:"object"==typeof e&&e.length>0?!0:!1},r=function(){o(this.getSettings().customBorders)&&(this.customBorders||(n=this,this.customBorders=new e))},i=function(e){for(var t=0;t<n.view.wt.selections.length;t++)if(n.view.wt.selections[t].settings.className==e)return t;return-1},s=function(e){var t={row:e.row,col:e.col},o=new E(e,new h(t,t,t)),r=i(e.className);r>=0?n.view.wt.selections[r]=o:n.view.wt.selections.push(o)},a=function(e,t,n){var o=p(e,t);o=m(o,n),this.setCellMeta(e,t,"borders",o),s(o)},l=function(e){for(var t=e.range,n=t.from.row;n<=t.to.row;n++)for(var o=t.from.col;o<=t.to.col;o++){var r=p(n,o),i=0;n==t.from.row&&(i++,e.hasOwnProperty("top")&&(r.top=e.top)),n==t.to.row&&(i++,e.hasOwnProperty("bottom")&&(r.bottom=e.bottom)),o==t.from.col&&(i++,e.hasOwnProperty("left")&&(r.left=e.left)),o==t.to.col&&(i++,e.hasOwnProperty("right")&&(r.right=e.right)),i>0&&(this.setCellMeta(n,o,"borders",r),s(r))}},c=function(e,t){return"border_row"+e+"col"+t},u=function(){return{width:1,color:"#000"}},d=function(){return{hide:!0}},f=function(){return{width:1,color:"#000",cornerVisible:!1}},p=function(e,t){return{className:c(e,t),border:f(),row:e,col:t,top:d(),right:d(),bottom:d(),left:d()}},m=function(e,t){return t.hasOwnProperty("border")&&(e.border=t.border),t.hasOwnProperty("top")&&(e.top=t.top),t.hasOwnProperty("right")&&(e.right=t.right),t.hasOwnProperty("bottom")&&(e.bottom=t.bottom),t.hasOwnProperty("left")&&(e.left=t.left),e},g=function(e){for(var t=document.querySelectorAll("."+e),n=0;n<t.length;n++)if(t[n]&&"TD"!=t[n].nodeName){var o=t[n].parentNode;o.parentNode&&o.parentNode.removeChild(o)}},v=function(e,t){var n=c(e,t);g(n),this.removeCellMeta(e,t,"borders")},w=function(e,t,n,o){var r=this.getCellMeta(e,t).borders;r&&void 0!=r.border||(r=p(e,t)),r[n]=o?d():u(),this.setCellMeta(e,t,"borders",r);var i=c(e,t);g(i),s(r),this.render()},y=function(e,t,n){if(e.from.row==e.to.row&&e.from.col==e.to.col)"noBorders"==t?v.call(this,e.from.row,e.from.col):w.call(this,e.from.row,e.from.col,t,n);else switch(t){case"noBorders":for(var o=e.from.col;o<=e.to.col;o++)for(var r=e.from.row;r<=e.to.row;r++)v.call(this,r,o);break;case"top":for(var i=e.from.col;i<=e.to.col;i++)w.call(this,e.from.row,i,t,n);break;case"right":for(var s=e.from.row;s<=e.to.row;s++)w.call(this,s,e.to.col,t);break;case"bottom":for(var a=e.from.col;a<=e.to.col;a++)w.call(this,e.to.row,a,t);break;case"left":for(var l=e.from.row;l<=e.to.row;l++)w.call(this,l,e.from.col,t)}},C=function(e,t){var n=!1;return e.getSelectedRange().forAll(function(o,r){var i=e.getCellMeta(o,r).borders;if(i){if(!t)return n=!0,!1;if(!i[t].hasOwnProperty("hide"))return n=!0,!1}}),n},b=function(e){return"<span class='selected'>"+String.fromCharCode(10003)+"</span>"+e},R=function(e){this.getSettings().customBorders&&(e.items.push(t.ContextMenu.SEPARATOR),e.items.push({key:"borders",name:"Borders",submenu:{items:{top:{name:function(){var e="Top",t=C(this,"top");return t&&(e=b(e)),e},callback:function(){var e=C(this,"top");y.call(this,this.getSelectedRange(),"top",e)},disabled:!1},right:{name:function(){var e="Right",t=C(this,"right");return t&&(e=b(e)),e},callback:function(){var e=C(this,"right");y.call(this,this.getSelectedRange(),"right",e)},disabled:!1},bottom:{name:function(){var e="Bottom",t=C(this,"bottom");return t&&(e=b(e)),e},callback:function(){var e=C(this,"bottom");y.call(this,this.getSelectedRange(),"bottom",e)},disabled:!1},left:{name:function(){var e="Left",t=C(this,"left");return t&&(e=b(e)),e},callback:function(){var e=C(this,"left");y.call(this,this.getSelectedRange(),"left",e)},disabled:!1},remove:{name:"Remove border(s)",callback:function(){y.call(this,this.getSelectedRange(),"noBorders")},disabled:function(){return!C(this)}}}}}))};t.hooks.add("beforeInit",r),t.hooks.add("afterContextMenuDefaultOptions",R),t.hooks.add("afterInit",function(){var e=this.getSettings().customBorders;if(e){for(var t=0;t<e.length;t++)e[t].range?l.call(this,e[t]):a.call(this,e[t].row,e[t].col,e[t]);this.render(),this.view.wt.draw(!0)}}),t.CustomBorders=e}(),function(t){function n(){function n(e){V=this,h=e;var t=this.view.wt.wtTable.getCoords(e).row;if(t>=0){d=t;var n=h.getBoundingClientRect();u=n.top,f.style.top=u+"px",f.style.left=n.left+"px",V.rootElement.appendChild(f)}}function o(e,t){var n=e.getBoundingClientRect(),o=6;f.style.top=t>0?n.top+n.height-o+"px":n.top+"px"}function r(){var e=this;t.Dom.addClass(f,"active"),t.Dom.addClass(p,"active");var n=h.getBoundingClientRect();p.style.width=e.view.maximumVisibleElementWidth(0)+"px",p.style.height=n.height+"px",p.style.top=u+"px",p.style.left=f.style.left,e.rootElement.appendChild(p)}function i(e){p.style.top=u+e+"px"}function s(){t.Dom.removeClass(f,"active"),t.Dom.removeClass(p,"active")}var a,l,c,u,d,h,f=document.createElement("DIV"),p=document.createElement("DIV"),m=t.eventManager(this);f.className="manualRowMover",p.className="manualRowMoverGuide";var g=function(){var e=this;t.hooks.run(e,"persistentStateSave","manualRowPositions",e.manualRowPositions)},v=function(){var e=this,n={};return t.hooks.run(e,"persistentStateLoad","manualRowPositions",n),n.value},w=function(e){return"BODY"!=e.tagName?"TBODY"==e.parentNode.tagName?!0:(e=e.parentNode,w(e)):!1},y=function(e){return"TABLE"!=e.tagName?"TH"==e.tagName?e:y(e.parentNode):null},C=function(){var u,f=this;m.addEventListener(f.rootElement,"mouseover",function(e){if(w(e.target)){var t=y(e.target);t&&(u?(l=f.view.wt.wtTable.getCoords(t).row,o(t,l-a)):n.call(f,t))}}),m.addEventListener(f.rootElement,"mousedown",function(e){t.Dom.hasClass(e.target,"manualRowMover")&&(c=t.helper.pageY(e),r.call(f),u=f,a=d,l=d)}),m.addEventListener(e,"mousemove",function(e){u&&i(t.helper.pageY(e)-c)}),m.addEventListener(e,"mouseup",function(){u&&(s(),u=!1,R(f.manualRowPositions,f.countRows()),f.manualRowPositions.splice(l,0,f.manualRowPositions.splice(a,1)[0]),f.forceFullRender=!0,f.view.render(),g.call(f),t.hooks.run(f,"afterRowMove",a,l),n.call(f,h))}),f.addHook("afterDestroy",b)},b=function(){m.clear()},R=function(e,t){if(e.length<t)for(var n=e.length;t>n;n++)e[n]=n};this.beforeInit=function(){this.manualRowPositions=[]},this.init=function(e){var t=this,n=!!t.getSettings().manualRowMove;if(n){var o=t.getSettings().manualRowMove,r=v.call(t);"undefined"!=typeof t.manualRowPositionsPluginUsages?t.manualRowPositionsPluginUsages.push("manualColumnMove"):t.manualRowPositionsPluginUsages=["manualColumnMove"],this.manualRowPositions="undefined"!=typeof r?r:Array.isArray(o)?o:[],"afterInit"===e&&(C.call(this),this.manualRowPositions.length>0&&(t.forceFullRender=!0,t.render()))}else{var i=t.manualRowPositionsPluginUsages?t.manualRowPositionsPluginUsages.indexOf("manualColumnMove"):-1;i>-1&&(b.call(this),t.manualRowPositions=[],t.manualRowPositionsPluginUsages[i]=void 0)}},this.modifyRow=function(e){var t=this;return t.getSettings().manualRowMove?("undefined"==typeof t.manualRowPositions[e]&&R(this.manualRowPositions,e+1),t.manualRowPositions[e]):e}}var o=new n;t.hooks.add("beforeInit",o.beforeInit),t.hooks.add("afterInit",function(){o.init.call(this,"afterInit")}),t.hooks.add("afterUpdateSettings",function(){o.init.call(this,"afterUpdateSettings")}),t.hooks.add("modifyRow",o.modifyRow),t.hooks.register("afterRowMove")}(t),function(t){function n(n){this.instance=n,this.addingStarted=!1;var o,r,i=!1,s=this,a=t.eventManager(n),l=function(){return n.autofill?void(n.autofill.handle&&n.autofill.handle.isDragged&&(n.autofill.handle.isDragged>1&&n.autofill.apply(),n.autofill.handle.isDragged=0,i=!1)):!0};a.addEventListener(document,"mouseup",function(e){l(e)}),a.addEventListener(document,"mousemove",function(n){if(!s.instance.autofill)return 0;var o=t.Dom.offset(s.instance.table).top-(e.pageYOffset||document.documentElement.scrollTop)+t.Dom.outerHeight(s.instance.table),r=t.Dom.offset(s.instance.table).left-(e.pageXOffset||document.documentElement.scrollLeft)+t.Dom.outerWidth(s.instance.table);s.addingStarted===!1&&s.instance.autofill.handle.isDragged>0&&n.clientY>o&&n.clientX<=r?(this.mouseDragOutside=!0,s.addingStarted=!0):this.mouseDragOutside=!1,this.mouseDragOutside&&setTimeout(function(){s.addingStarted=!1,s.instance.alter("insert_row")},200)}),o=this.instance.view.wt.wtSettings.settings.onCellCornerMouseDown,this.instance.view.wt.wtSettings.settings.onCellCornerMouseDown=function(e){n.autofill.handle.isDragged=1,i=!0,o(e)},r=this.instance.view.wt.wtSettings.settings.onCellMouseOver,this.instance.view.wt.wtSettings.settings.onCellMouseOver=function(e,t,o,s){n.autofill&&i&&!n.view.isMouseDown()&&n.autofill.handle&&n.autofill.handle.isDragged&&(n.autofill.handle.isDragged++,n.autofill.showBorder(t),n.autofill.checkIfNewRowNeeded()),r(e,t,o,s)},this.instance.view.wt.wtSettings.settings.onCellCornerDblClick=function(){n.autofill.selectAdjacent()}}n.prototype.init=function(){this.handle={}},n.prototype.disable=function(){this.handle.disabled=!0},n.prototype.selectAdjacent=function(){var e,t,n,o,r;e=this.instance.selection.isMultiple()?this.instance.view.wt.selections.area.getCorners():this.instance.view.wt.selections.current.getCorners(),t=this.instance.getData();e:for(n=e[2]+1;n<this.instance.countRows();n++){for(r=e[1];r<=e[3];r++)if(t[n][r])break e;(t[n][e[1]-1]||t[n][e[3]+1])&&(o=n)}o&&(this.instance.view.wt.selections.fill.clear(),this.instance.view.wt.selections.fill.add(new d(e[0],e[1])),this.instance.view.wt.selections.fill.add(new d(o,e[3])),this.apply())},n.prototype.apply=function(){var e,n,o,r,i;if(this.handle.isDragged=0,e=this.instance.view.wt.selections.fill.getCorners()){var s=function(e,t,n,o){var r,i,s,a=n.length,l=n?n[0].length:0,c=[],u=t.row-e.row,d=t.col-e.col,h=[];if(-1!==["down","up"].indexOf(o)){for(var f=0;d>=f;f++)r=parseInt(n[0][f],10),i=parseInt(n[a-1][f],10),s=("down"===o?i-r:r-i)/(a-1)||0,h.push(s);c.push(h)}if(-1!==["right","left"].indexOf(o))for(var p=0;u>=p;p++)r=parseInt(n[p][0],10),i=parseInt(n[p][l-1],10),s=("right"===o?i-r:r-i)/(l-1)||0,h=[],h.push(s),c.push(h);return c};this.instance.view.wt.selections.fill.clear(),n=this.instance.selection.isMultiple()?this.instance.view.wt.selections.area.getCorners():this.instance.view.wt.selections.current.getCorners();var a;if(e[0]===n[0]&&e[1]<n[1]?(a="left",o=new d(e[0],e[1]),r=new d(e[2],n[1]-1)):e[0]===n[0]&&e[3]>n[3]?(a="right",o=new d(e[0],n[3]+1),r=new d(e[2],e[3])):e[0]<n[0]&&e[1]===n[1]?(a="up",o=new d(e[0],e[1]),r=new d(n[0]-1,e[3])):e[2]>n[2]&&e[1]===n[1]&&(a="down",o=new d(n[2]+1,e[1]),r=new d(e[2],e[3])),o&&o.row>-1&&o.col>-1){var l={from:this.instance.getSelectedRange().from,to:this.instance.getSelectedRange().to};i=this.instance.getData(l.from.row,l.from.col,l.to.row,l.to.col);var c=s(o,r,i,a);t.hooks.run(this.instance,"beforeAutofill",o,r,i),this.instance.populateFromArray(o.row,o.col,i,r.row,r.col,"autofill",null,a,c),this.instance.selection.setRangeStart(new d(e[0],e[1])),this.instance.selection.setRangeEnd(new d(e[2],e[3]))}else this.instance.selection.refreshBorders()}},n.prototype.showBorder=function(e){var t=this.instance.getSelectedRange().getTopLeftCorner(),n=this.instance.getSelectedRange().getBottomRightCorner();if("horizontal"!==this.instance.getSettings().fillHandle&&(n.row<e.row||t.row>e.row))e=new d(e.row,n.col);else{if("vertical"===this.instance.getSettings().fillHandle)return;e=new d(n.row,e.col)}this.instance.view.wt.selections.fill.clear(),this.instance.view.wt.selections.fill.add(this.instance.getSelectedRange().from),this.instance.view.wt.selections.fill.add(this.instance.getSelectedRange().to),this.instance.view.wt.selections.fill.add(e),this.instance.view.render()},n.prototype.checkIfNewRowNeeded=function(){var e,t,n=this.instance.countRows(),o=this;this.instance.view.wt.selections.fill.cellRange&&this.addingStarted===!1&&(t=this.instance.getSelected(),e=this.instance.view.wt.selections.fill.getCorners(),t[2]<n-1&&e[2]===n-1&&(this.addingStarted=!0,this.instance._registerTimeout(setTimeout(function(){o.instance.alter("insert_row"),o.addingStarted=!1},200))))},t.hooks.add("afterInit",function(){var e=new n(this);"undefined"!=typeof this.getSettings().fillHandle&&(e.handle&&this.getSettings().fillHandle===!1?e.disable():e.handle||this.getSettings().fillHandle===!1||(this.autofill=e,this.autofill.init()))}),t.Autofill=n}(t);var tt=function(e){var n=[],o={rows:0,cols:0},r={rows:0,cols:0},i=[],s=[],a={groupIndicatorContainer:"htGroupIndicatorContainer",groupIndicator:function(e){return"ht"+e+"Group"},groupStart:"htGroupStart",collapseButton:"htCollapseButton",expandButton:"htExpandButton",collapseGroupId:function(e){return"htCollapse-"+e},collapseFromLevel:function(e,t){return"htCollapse"+e+"FromLevel-"+t},clickable:"clickable",levelTrigger:"htGroupLevelTrigger"},l=function(e,t){return function(n,o){return"undefined"==typeof t||"asc"===t?n[e]-o[e]:o[e]-n[e]}},c=function(e,t){for(var n=[];t>=e;)n.push(e++);return n},u=function(e,t,n){var o=[],r={row:null,col:null};if("cols"==e)for(;n>=t;)r={row:-1,col:t++},o.push(r);else for(;n>=t;)r={row:t++,col:-1},o.push(r);for(var i=h(o),s=0,a=0,l=0;l<i.length;l++)s+=i[l].filter(function(e){return e.rows}).length,a+=i[l].filter(function(e){return e.cols}).length;return{total:{rows:s,cols:a},groups:i}},h=function(e){for(var t=[],n=0;n<e.length;n++)t.push(f(e[n]));return t},f=function(e,t,o){for(var r=e.row,i=e.col,s=-1===r?0:r,a=-1===i?0:i,l=[],c=0;c<n.length;c++){var u=n[c],d=u.id,h=(u.level,u.rows||[]),f=u.cols||[];-1===l.indexOf(d)&&(-1!==h.indexOf(s)||-1!==f.indexOf(a))&&l.push(u)}-1===i?l=l.concat(v()):-1===r&&(l=l.concat(y())),t&&(l=l.filter(function(e){return e.level===t})),o&&("cols"===o?l=l.filter(function(e){return e.cols}):"rows"===o&&(l=l.filter(function(e){return e.rows})));var p=[];return l.filter(function(e){return-1===p.indexOf(e.id)?(p.push(e.id),e):void 0})},p=function(e){for(var t=0,o=n.length;o>t;t++)if(n[t].id==e)return n[t];return!1},m=function(e,t){for(var o=0,r=n.length;r>o;o++)if(n[o].level==t&&n[o].rows&&n[o].rows.indexOf(e)>-1)return n[o];return!1},g=function(e,t){for(var o=0,r=n.length;r>o;o++)if(n[o].level==t&&n[o].cols&&n[o].cols.indexOf(e)>-1)return n[o];return!1},v=function(){for(var e=[],t=0,o=n.length;o>t;t++)Array.isArray(n[t].cols)&&e.push(n[t]);return e},w=function(e){for(var t=[],o=0,r=n.length;r>o;o++)n[o].cols&&n[o].level===e&&t.push(n[o]);return t},y=function(){for(var e=[],t=0,o=n.length;o>t;t++)Array.isArray(n[t].rows)&&e.push(n[t]);return e},C=function(e){for(var t=[],o=0,r=n.length;r>o;o++)n[o].rows&&n[o].level===e&&t.push(n[o]);return t},b=function(e){var t=0;return e.length&&e.forEach(function(e){if(e=e.filter(function(e){return e.cols}),e.length){var n=e.sort(l("level","desc")),o=n[0].level;o>t&&(t=o)}}),t},R=function(e){var t=0;return e.length&&e.forEach(function(e){if(e=e.filter(function(e){return e.rows}),e.length){var n=e.sort(l("level","desc")),o=n[0].level;o>t&&(t=o)}}),t},T=function(e,t){var i=u("cols",e,t),s=b(i.groups);s===r.cols?r.cols++:s>r.cols&&(r.cols=s+1),o.cols||(o.cols=v().length),o.cols++,n.push({id:"c"+o.cols,level:s+1,cols:c(e,t),hidden:0})},S=function(e,t){var i=u("rows",e,t),s=R(i.groups);r.rows=Math.max(r.rows,s+1),o.rows||(o.rows=y().length),o.rows++,n.push({id:"r"+o.rows,level:s+1,rows:c(e,t),hidden:0})},E=function(e,t){for(var n,o=0,r=t.length;r>o;o++)if(t[o].hidden=e,n=t[o].level,i[n]||(i[n]=[]),s[n]||(s[n]=[]),t[o].rows)for(var a=0,l=t[o].rows.length;l>a;a++)i[n][t[o].rows[a]]=e>0?!0:void 0;else if(t[o].cols)for(var a=0,c=t[o].cols.length;c>a;a++)s[n][t[o].cols[a]]=e>0?!0:void 0},_=function(e,n,o,r){var i,s;switch(e){case"rows":i=m(n+1,o).id,s=t.Grouping.getGroupLevelsByRows();break;case"cols":i=g(n+1,o).id,s=t.Grouping.getGroupLevelsByCols()}return!!(s[n+1]&&s[n+1].indexOf(o)>-1&&r==i)},k=function(e,n,o,r){var i,s;switch(e){case"rows":i=m(n-1,o).id,s=t.Grouping.getGroupLevelsByRows();break;case"cols":i=g(n-1,o).id,s=t.Grouping.getGroupLevelsByCols()}return!!(s[n-1]&&s[n-1].indexOf(o)>-1&&r==i)},x=function(n,o,a,l){if(0===o)return!1;var c,u,d=k(n,o,a,l),h=_(n,o,a,l),f=!1;switch(n){case"rows":c=t.Grouping.getGroupLevelsByRows(),u=e.countRows();for(var p=0;p<=r.rows;p++)if(i[p]&&i[p][o+1]){f=!0;break}break;case"cols":c=t.Grouping.getGroupLevelsByCols(),u=e.countCols();for(var p=0;p<=r.cols;p++)if(s[p]&&s[p][o+1]){f=!0;break}}if(d){if(o==u-1)return!0;if(!h||h&&f)return!0;if(!c[o+1])return!0}return!1},D=function(t){var n;switch(t){case"rows":n=r.rows;for(var o=0;n>=o;o++)if(i[o]&&i[o][e.countRows()-1])return!0;break;case"cols":n=r.cols;for(var o=0;n>=o;o++)if(s[o]&&s[o][e.countCols()-1])return!0}return!1},A=function(n,o,a,l){var c,u,d,h=p(l),f=!1,m=function(e){for(var t=!1,n="rows"==e?i:s,a=0;a<=r[e];a++){for(d=o;h[e].indexOf(d)>-1;)t=!(!n[a]||!n[a][d]),d--;if(t)break}return t},g=k(n,o,a,l),v=_(n,o,a,l);switch(n){case"rows":c=t.Grouping.getGroupLevelsByRows(),u=e.countRows(),f=m(n);break;case"cols":c=t.Grouping.getGroupLevelsByCols(),u=e.countCols(),f=m(n)}if(o==u-1)return!1;if(0===o){if(v)return!0}else if(!g||g&&f){if(v)return!0}else if(!c[o-1]&&v)return!0;return!1},H=function(e,n,o,r,i){var s;switch(e){case"rows":s=m(n-1,o).id;break;case"cols":s=g(n-1,o).id}if(!s)return null;if(n>0&&k(e,n-1,o,s)&&s!=r){var l=document.createElement("DIV");return t.Dom.addClass(l,a.expandButton),l.id="htExpand-"+s,l.appendChild(document.createTextNode("+")),l.setAttribute("data-level",o),l.setAttribute("data-type",e),l.setAttribute("data-hidden","1"),i.appendChild(l),l}return null},O=function(e){for(var t=y(),n=v(),o=0,r=t.length;r>o;o++)if(t[o].rows.indexOf(e.row)>-1&&t[o].hidden)return!0;if(null===e.col)return!1;for(var o=0,i=n.length;i>o;o++)if(n[o].cols.indexOf(e.col)>-1&&n[o].hidden)return!0;return!1};return{getGroups:function(){return n},getLevels:function(){return r},instance:e,baseSpareRows:e.getSettings().minSpareRows,baseSpareCols:e.getSettings().minSpareCols,getRowGroups:y,getColGroups:v,init:function(){var n=e.getSettings().groups;n&&Array.isArray(n)&&t.Grouping.initGroups(n)},initGroups:function(e){n=[],e.forEach(function(e){var t=[],n=!1,o=!1;Array.isArray(e.rows)?(t=e.rows,n=!0):Array.isArray(e.cols)&&(t=e.cols,o=!0);var r=t[0],i=t[t.length-1];n?S(r,i):o&&T(r,i)})},resetGroups:function(){n=[],o={rows:0,cols:0},r={rows:0,cols:0};var e;for(var i in a)if("function"!=typeof a[i]){e=document.querySelectorAll("."+a[i]);
for(var s=0,l=e.length;l>s;s++)t.Dom.removeClass(e[s],a[i])}for(var c=["htGroupColClosest","htGroupCol"],i=0,u=c.length;u>i;i++){e=document.querySelectorAll("."+c[i]);for(var s=0,l=e.length;l>s;s++)t.Dom.removeClass(e[s],c[i])}},updateGroups:function(){var e=this.getSettings().groups;t.Grouping.resetGroups(),t.Grouping.initGroups(e)},afterGetRowHeader:function(e,n){for(var o=!1,r=0,s=i.length;s>r;r++)i[r]&&i[r][e]===!0&&(o=!0);o?t.Dom.addClass(n.parentNode,"hidden"):!o&&t.Dom.hasClass(n.parentNode,"hidden")&&t.Dom.removeClass(n.parentNode,"hidden")},afterGetColHeader:function(n){var o=this.view.wt.wtSettings.getSetting("rowHeaders").length,r=e.rootElement.querySelectorAll("colgroup col:nth-child("+parseInt(n+o+1,10)+")");if(0!==r.length){for(var i=!1,a=0,l=s.length;l>a;a++)s[a]&&s[a][n]===!0&&(i=!0);if(i)for(var a=0,c=r.length;c>a;a++)t.Dom.addClass(r[a],"hidden");else if(!i&&t.Dom.hasClass(r[0],"hidden"))for(var a=0,c=r.length;c>a;a++)t.Dom.removeClass(r[a],"hidden")}},groupIndicatorsFactory:function(e,n){var i,s,l,c,u,d,h,f;switch(n){case"horizontal":i=t.Grouping.getGroupLevelsByCols(),s=function(e){return Array.prototype.indexOf.call(e.parentNode.parentNode.childNodes,e.parentNode)+1},l=function(e,t){return g(e,t).id},c="cols",u=function(e,t){return g(e-1,t)},d="columnHeaders",h=function(e){if(1===e.length){var n=e[0];e[0]=function(e,o,r){-1>e?v()(e,o,r):(t.Dom.removeClass(o,a.groupIndicatorContainer),n(e,o,r))}}return function(){return e}},f=!0;break;case"vertical":i=t.Grouping.getGroupLevelsByRows(),s=function(e){return t.Dom.index(e)+1},l=function(e,t){return m(e,t).id},c="rows",u=function(e,t){return m(e-1,t)},d="rowHeaders",h=function(e){return e}}var p=function(e){var n=document.createElement("div");return e.appendChild(n),{button:n,addClass:function(e){t.Dom.addClass(n,e)}}},v=function(){var e=n.charAt(0).toUpperCase()+n.slice(1);return function(n,o,r){r++;for(var s,d;s=o.lastChild;)o.removeChild(s);t.Dom.addClass(o,a.groupIndicatorContainer);var h=l(n,r);if(n>-1&&i[n]&&i[n].indexOf(r)>-1&&(d=p(o),d.addClass(a.groupIndicator(e)),A(c,n,r,h)&&d.addClass(a.groupStart),x(c,n,r,h)&&(d.button.appendChild(document.createTextNode("-")),d.addClass(a.collapseButton),d.button.id=a.collapseGroupId(h),d.button.setAttribute("data-level",r),d.button.setAttribute("data-type",c))),f){var m=t.Dom.index(o.parentNode);if(-1===n||-1>n&&m===t.Grouping.getLevels().cols+1||0===m&&0===t.Grouping.getLevels().cols)if(d=p(o),d.addClass(a.levelTrigger),-1===n)d.button.id=a.collapseFromLevel("Cols",r),d.button.appendChild(document.createTextNode(r));else if(-1>n&&m===t.Grouping.getLevels().cols+1||0===m&&0===t.Grouping.getLevels().cols){var g=t.Dom.index(o)+1;d.button.id=a.collapseFromLevel("Rows",g),d.button.appendChild(document.createTextNode(g))}}var v=H(c,n,r,h,o);if(n>0){var w=u(n-1,r);v&&w.hidden&&t.Dom.addClass(v,a.clickable)}nt()}};if(e=h(e),o[c]>0)for(var w=0;w<r[c]+1;w++)Array.isArray(e)||(e="function"==typeof e?e():new Array(e)),e.unshift(v())},getGroupLevelsByRows:function(){for(var e=y(),t=[],n=0,o=e.length;o>n;n++)if(e[n].rows)for(var r=0,i=e[n].rows.length;i>r;r++)t[e[n].rows[r]]||(t[e[n].rows[r]]=[]),t[e[n].rows[r]].push(e[n].level);return t},getGroupLevelsByCols:function(){for(var e=v(),t=[],n=0,o=e.length;o>n;n++)if(e[n].cols)for(var r=0,i=e[n].cols.length;i>r;r++)t[e[n].cols[r]]||(t[e[n].cols[r]]=[]),t[e[n].cols[r]].push(e[n].level);return t},toggleGroupVisibility:function(n){if(t.Dom.hasClass(n.target,a.expandButton)||t.Dom.hasClass(n.target,a.collapseButton)||t.Dom.hasClass(n.target,a.levelTrigger)){var o,i,s,l,c=n.target,u=c.id.split("-"),d=[],h=function(e){e&&(c=e),u=c.id.split("-"),o=u[1],i=parseInt(c.getAttribute("data-level"),10),s=c.getAttribute("data-type"),l=parseInt(c.getAttribute("data-hidden")),l=isNaN(l)?1:l?0:1,c.setAttribute("data-hidden",l.toString()),d.push(p(o))};if(c.className.indexOf(a.levelTrigger)>-1){for(var f,m=[],g=[],v=c.id.indexOf("Rows")>-1?"rows":"cols",y=1,b=r[v];b>=y;y++)if(f="rows"==v?C(y):w(y),y>=parseInt(u[1],10))for(var R=0,T=f.length;T>R;R++)g.push(f[R]);else for(var R=0,T=f.length;T>R;R++)m.push(f[R]);E(!0,g),E(!1,m)}else h(),E(l,d);s=s||v;var S=D(s),_=s.charAt(0).toUpperCase()+s.slice(1),k=t.Grouping["baseSpare"+_];S?0==k&&(e.alter("insert_"+s.slice(0,-1),e["count"+_]()),t.Grouping["dummy"+s.slice(0,-1)]=!0):0==k&&t.Grouping["dummy"+s.slice(0,-1)]&&(e.alter("remove_"+s.slice(0,-1),e["count"+_]()-1),t.Grouping["dummy"+s.slice(0,-1)]=!1),e.render(),n.stopImmediatePropagation()}},modifySelectionFactory:function(e){var t,n=this.instance,o=new d(0,0),r=function(e,t){var n=0;switch(e){case"down":for(;O(t);)n++,t.row+=1;break;case"up":for(;O(t);)n--,t.row-=1;break;case"right":for(;O(t);)n++,t.col+=1;break;case"left":for(;O(t);)n--,t.col-=1}return n},i=function(e,t){e.row>0?O(t)&&(e.row+=r("down",t)):e.row<0&&O(t)&&(e.row+=r("up",t)),e.col>0?O(t)&&(e.col+=r("right",t)):e.col<0&&O(t)&&(e.col+=r("left",t))};switch(e){case"start":return function(e){t=n.getSelected(),o.row=t[0]+e.row,o.col=t[1]+e.col,i(e,o)};case"end":return function(e){t=n.getSelected(),o.row=t[2]+e.row,o.col=t[3]+e.col,i(e,o)}}},modifyRowHeight:function(t,n){return e.view.wt.wtTable.rowFilter&&O({row:n,col:null})?0:void 0},validateGroups:function(){for(var t=function(e,t){return e[0]<t[0]&&e[1]<t[1]&&t[0]<=e[1]||e[0]>t[0]&&t[1]<e[1]&&e[0]<=t[1]?!0:void 0},n=e.getSettings().groups,o=[],r=[],i=0,s=n.length;s>i;i++)if(n[i].rows){if(1===n[i].rows.length)throw new Error("Grouping error:  Group {"+n[i].rows[0]+"} is invalid. Cannot define single-entry groups.");if(0===n[i].rows.length)throw new Error("Grouping error:  Cannot define empty groups.");r.push(n[i].rows);for(var a=0,l=r.length;l>a;a++)if(t(n[i].rows,r[a]))throw new Error("Grouping error:  ranges {"+n[i].rows[0]+", "+n[i].rows[1]+"} and {"+r[a][0]+", "+r[a][1]+"} are overlapping.")}else if(n[i].cols){if(1===n[i].cols.length)throw new Error("Grouping error:  Group {"+n[i].cols[0]+"} is invalid. Cannot define single-entry groups.");if(0===n[i].cols.length)throw new Error("Grouping error:  Cannot define empty groups.");o.push(n[i].cols);for(var a=0,c=o.length;c>a;a++)if(t(n[i].cols,o[a]))throw new Error("Grouping error:  ranges {"+n[i].cols[0]+", "+n[i].cols[1]+"} and {"+o[a][0]+", "+o[a][1]+"} are overlapping.")}return!0},afterGetRowHeaderRenderers:function(e){t.Grouping.groupIndicatorsFactory(e,"vertical")},afterGetColumnHeaderRenderers:function(e){t.Grouping.groupIndicatorsFactory(e,"horizontal")},hookProxy:function(n,o){return function(){return e.getSettings().groups?o?t.Grouping[n](o).apply(this,arguments):t.Grouping[n].apply(this,arguments):void 0}}}},$=function(){var e=this,n=!!e.getSettings().groups;if(n){var o={};t.Grouping=new tt(e),e.getSettings().rowHeaders||(o.rowHeaders=!0),e.getSettings().colHeaders||(o.colHeaders=!0),(o.colHeaders||o.rowHeaders)&&e.updateSettings(o);var r=t.Grouping.validateGroups();if(!r)return;e.addHook("beforeInit",t.Grouping.hookProxy("init")),e.addHook("afterUpdateSettings",t.Grouping.hookProxy("updateGroups")),e.addHook("afterGetColumnHeaderRenderers",t.Grouping.hookProxy("afterGetColumnHeaderRenderers")),e.addHook("afterGetRowHeaderRenderers",t.Grouping.hookProxy("afterGetRowHeaderRenderers")),e.addHook("afterGetRowHeader",t.Grouping.hookProxy("afterGetRowHeader")),e.addHook("afterGetColHeader",t.Grouping.hookProxy("afterGetColHeader")),e.addHook("beforeOnCellMouseDown",t.Grouping.hookProxy("toggleGroupVisibility")),e.addHook("modifyTransformStart",t.Grouping.hookProxy("modifySelectionFactory","start")),e.addHook("modifyTransformEnd",t.Grouping.hookProxy("modifySelectionFactory","end")),e.addHook("modifyRowHeight",t.Grouping.hookProxy("modifyRowHeight"))}},nt=function(){for(var e=document.querySelectorAll("colgroup"),n=0,o=e.length;o>n;n++){var r=e[n].querySelectorAll("col.rowHeader");if(0===r.length)return;for(var i=0,s=r.length+1;s>i;i++){if(2==s)return;i<t.Grouping.getLevels().rows+1&&(i==t.Grouping.getLevels().rows?t.Dom.addClass(r[i],"htGroupColClosest"):t.Dom.addClass(r[i],"htGroupCol"))}}};t.hooks.add("beforeInit",$),t.hooks.add("afterUpdateSettings",function(){this.getSettings().groups&&!t.Grouping?$.call(this,arguments):!this.getSettings().groups&&t.Grouping&&(t.Grouping.resetGroups(),t.Grouping=void 0)}),t.plugins.Grouping=tt,function(e){function t(){this.zeroClipboardInstance=null,this.instance=null}t.prototype.prepareZeroClipboard=function(){this.swfPath&&ZeroClipboard.config({swfPath:this.swfPath})},t.prototype.copy=function(){return this.instance.copyPaste.setCopyableText(),this.instance.copyPaste.copyPasteInstance.elTextarea.value},t.prototype.addToContextMenu=function(t){this.getSettings().contextMenuCopyPaste&&t.items.unshift({key:"copy",name:"Copy"},{key:"paste",name:"Paste",callback:function(){this.copyPaste.triggerPaste()}},e.ContextMenu.SEPARATOR)},t.prototype.setupZeroClipboard=function(t){var o=this;if(this.cmInstance=t,e.Dom.hasClass(this.cmInstance.rootElement,"htContextMenu"))for(var r=t.getData(),i=0,s=r.length;s>i;i++)if("copy"===r[i].key){this.zeroClipboardInstance=new ZeroClipboard(t.getCell(i,0)),this.zeroClipboardInstance.off(),this.zeroClipboardInstance.on("copy",function(e){var t=e.clipboardData;t.setData("text/plain",o.copy()),o.instance.getSettings().outsideClickDeselects=o.outsideClickDeselectsCache}),n.bindEvents();break}},t.prototype.bindEvents=function(){var t=this;if(t.cmInstance){var n=new e.eventManager(this.instance),o=function(){var n=t.cmInstance.rootElement.querySelector("td.current");n&&e.Dom.removeClass(n,"current"),t.outsideClickDeselectsCache=t.instance.getSettings().outsideClickDeselects,t.instance.getSettings().outsideClickDeselects=!1},r=function(){var n=t.cmInstance.rootElement.querySelector("td.zeroclipboard-is-hover");n&&e.Dom.removeClass(n,"zeroclipboard-is-hover"),t.instance.getSettings().outsideClickDeselects=t.outsideClickDeselectsCache};n.removeEventListener(document,"mouseenter",function(){o()}),n.addEventListener(document,"mouseenter",function(){o()}),n.removeEventListener(document,"mouseleave",function(){r()}),n.addEventListener(document,"mouseleave",function(){r()})}},t.prototype.init=function(){if(this.getSettings().contextMenuCopyPaste){if("object"==typeof this.getSettings().contextMenuCopyPaste&&(n.swfPath=this.getSettings().contextMenuCopyPaste.swfPath),"undefined"==typeof ZeroClipboard)throw new Error("To be able to use the Copy/Paste feature from the context menu, you need to manualy include ZeroClipboard.js file to your website.");try{{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}}catch(e){if("undefined"==typeof navigator.mimeTypes["application/x-shockwave-flash"])throw new Error("To be able to use the Copy/Paste feature from the context menu, your browser needs to have Flash Plugin installed.")}n.instance=this,n.prepareZeroClipboard()}};var n=new t;e.hooks.add("afterRender",function(){n.setupZeroClipboard(this)}),e.hooks.add("afterInit",n.init),e.hooks.add("afterContextMenuDefaultOptions",n.addToContextMenu),e.ContextMenuCopyPaste=t}(t),function(e){function t(t){this.instance=t,this.dragged=[],this.eventManager=e.eventManager(t),this.bindTouchEvents()}t.prototype.getCurrentRangeCoords=function(e,t,n,o,r){var i=e.getTopLeftCorner(),s=e.getBottomRightCorner(),a=e.getBottomLeftCorner(),l=e.getTopRightCorner(),c={start:null,end:null};switch(n){case"NE-SW":switch(o){case"NE-SW":case"NW-SE":c="topLeft"==r?{start:new d(t.row,e.highlight.col),end:new d(a.row,t.col)}:{start:new d(e.highlight.row,t.col),end:new d(t.row,i.col)};break;case"SE-NW":"bottomRight"==r&&(c={start:new d(s.row,t.col),end:new d(t.row,i.col)})}break;case"NW-SE":switch(o){case"NE-SW":"topLeft"==r?c={start:t,end:a}:c.end=t;break;case"NW-SE":"topLeft"==r?c={start:t,end:s}:c.end=t;break;case"SE-NW":"topLeft"==r?c={start:t,end:i}:c.end=t;break;case"SW-NE":"topLeft"==r?c={start:t,end:l}:c.end=t}break;case"SW-NE":switch(o){case"NW-SE":c="bottomRight"==r?{start:new d(t.row,i.col),end:new d(a.row,t.col)}:{start:new d(i.row,t.col),end:new d(t.row,s.col)};break;case"SW-NE":c="topLeft"==r?{start:new d(e.highlight.row,t.col),end:new d(t.row,s.col)}:{start:new d(t.row,i.col),end:new d(i.row,t.col)};break;case"SE-NW":"bottomRight"==r?c={start:new d(t.row,l.col),end:new d(i.row,t.col)}:"topLeft"==r&&(c={start:a,end:t})}break;case"SE-NW":switch(o){case"NW-SE":case"NE-SW":case"SW-NE":"topLeft"==r&&(c.end=t);break;case"SE-NW":"topLeft"==r?c.end=t:c={start:t,end:i}}}return c},t.prototype.bindTouchEvents=function(){var t=this,n=function(e){if(1==this.dragged.length)return this.dragged=[],!0;var t=this.dragged.indexOf(e);return-1==t?!1:void(0===t?this.dragged=this.dragged.slice(0,1):1==t&&(this.dragged=this.dragged.slice(-1)))};this.eventManager.addEventListener(this.instance.rootElement,"touchstart",function(n){if(e.Dom.hasClass(n.target,"topLeftSelectionHandle-HitArea")){t.dragged.push("topLeft");var o=t.instance.getSelectedRange();return t.touchStartRange={width:o.getWidth(),height:o.getHeight(),direction:o.getDirection()},n.preventDefault(),!1}if(e.Dom.hasClass(n.target,"bottomRightSelectionHandle-HitArea")){t.dragged.push("bottomRight");var o=t.instance.getSelectedRange();return t.touchStartRange={width:o.getWidth(),height:o.getHeight(),direction:o.getDirection()},n.preventDefault(),!1}}),this.eventManager.addEventListener(this.instance.rootElement,"touchend",function(o){return e.Dom.hasClass(o.target,"topLeftSelectionHandle-HitArea")?(n.call(t,"topLeft"),t.touchStartRange=void 0,o.preventDefault(),!1):e.Dom.hasClass(o.target,"bottomRightSelectionHandle-HitArea")?(n.call(t,"bottomRight"),t.touchStartRange=void 0,o.preventDefault(),!1):void 0}),this.eventManager.addEventListener(this.instance.rootElement,"touchmove",function(n){var o=e.Dom.getWindowScrollTop(),r=e.Dom.getWindowScrollLeft();if(t.dragged.length>0){var i=document.elementFromPoint(n.touches[0].screenX-r,n.touches[0].screenY-o);if(!i)return;if("TD"==i.nodeName||"TH"==i.nodeName){var s=t.instance.getCoords(i);-1==s.col&&(s.col=0);var a=t.instance.getSelectedRange(),l=a.getWidth(),c=a.getHeight(),u=a.getDirection();1==l&&1==c&&t.instance.selection.setRangeEnd(s);var d=t.getCurrentRangeCoords(a,s,t.touchStartRange.direction,u,t.dragged[0]);null!=d.start&&t.instance.selection.setRangeStart(d.start),t.instance.selection.setRangeEnd(d.end)}n.preventDefault()}})},t.prototype.isDragged=function(){return 0===this.dragged.length?!1:!0};var n=function(){var n=this;e.plugins.multipleSelectionHandles=new t(n)};e.hooks.add("afterInit",n)}(t);var ot=function(){function e(){}return e.prototype.init=function(e){this.instance=e,this.bindEvents(),this.scrollbars=[this.instance.view.wt.wtScrollbars.vertical,this.instance.view.wt.wtScrollbars.horizontal,this.instance.view.wt.wtScrollbars.corner],this.clones=[this.instance.view.wt.wtScrollbars.vertical.clone.wtTable.holder.parentNode,this.instance.view.wt.wtScrollbars.horizontal.clone.wtTable.holder.parentNode,this.instance.view.wt.wtScrollbars.corner.clone.wtTable.holder.parentNode]},e.prototype.bindEvents=function(){var e=this;this.instance.addHook("beforeTouchScroll",function(){t.freezeOverlays=!0;for(var n=0,o=e.clones.length;o>n;n++)t.Dom.addClass(e.clones[n],"hide-tween")}),this.instance.addHook("afterMomentumScroll",function(){t.freezeOverlays=!1;for(var n=0,o=e.clones.length;o>n;n++)t.Dom.removeClass(e.clones[n],"hide-tween");for(var n=0,o=e.clones.length;o>n;n++)t.Dom.addClass(e.clones[n],"show-tween");setTimeout(function(){for(var n=0,o=e.clones.length;o>n;n++)t.Dom.removeClass(e.clones[n],"show-tween")},400);for(var n=0,o=e.scrollbars.length;o>n;n++)e.scrollbars[n].refresh(),e.scrollbars[n].resetFixedPosition()})},e}(),rt=new ot;if(t.hooks.add("afterInit",function(){rt.init.call(rt,this)}),function(e){function t(t){function n(n){n.items.push(e.ContextMenu.SEPARATOR,{key:"freeze_column",name:function(){var e=t.getSelected()[1];return e>p-1?"Freeze this column":"Unfreeze this column"},disabled:function(){var e=t.getSelected();return e[1]!==e[3]},callback:function(){var e=t.getSelected()[1];e>p-1?c(e):u(e)}})}function o(){t.updateSettings({fixedColumnsLeft:p+1}),p++}function r(){t.updateSettings({fixedColumnsLeft:p-1}),p--}function i(e){t.manualColumnPositions&&0!==t.manualColumnPositions.length||t.manualColumnPositions||(t.manualColumnPositions=[]),e?t.manualColumnPositions[e]||s(e+1):s(t.countCols())}function s(e){if(t.manualColumnPositions.length<e)for(var n=t.manualColumnPositions.length;e>n;n++)t.manualColumnPositions[n]=n}function a(e,n,o,r){null==o&&(o=e),"freeze"===r?t.manualColumnPositions.splice(p,0,t.manualColumnPositions.splice(n,1)[0]):"unfreeze"===r&&t.manualColumnPositions.splice(o,0,t.manualColumnPositions.splice(n,1)[0])}function l(e){for(var t=p,n=d(t),o=d(e);o>n;)t++,n=d(t);return t-1}function c(e){if(!(p-1>=e)){var t=d(e)||e;i(t),a(t,e,null,"freeze"),o()}}function u(e){if(!(e>p-1)){var t=l(e),n=d(e)||e;i(n),a(n,e,t,"unfreeze"),r()}}function d(e){return t.manualColumnPositions[e]}function h(e){return this.manualColumnPositionsPluginUsages.length>1?e:d(e)}function f(){t.addHook("modifyCol",h),t.addHook("afterContextMenuDefaultOptions",n)}var p=t.getSettings().fixedColumnsLeft,m=function(){"undefined"!=typeof t.manualColumnPositionsPluginUsages?t.manualColumnPositionsPluginUsages.push("manualColumnFreeze"):t.manualColumnPositionsPluginUsages=["manualColumnFreeze"],f()};return{init:m,freezeColumn:c,unfreezeColumn:u,helpers:{addFixedColumn:o,removeFixedColumn:r,checkPositionData:i,modifyColumnOrder:a,getBestColumnReturnPosition:l}}}var n=function(){if(this.getSettings().manualColumnFreeze){var n;e.plugins.manualColumnFreeze=t,this.manualColumnFreeze=new t(this),n=this.manualColumnFreeze,n.init.call(this)}};e.hooks.add("beforeInit",n)}(t),c.prototype.init=function(){this.TABLE=this.instance.wtTable.TABLE,this.fixed=this.instance.wtTable.hider,this.fixedContainer=this.instance.wtTable.holder,this.scrollHandler=this.getScrollableElement(this.TABLE)},c.prototype.makeClone=function(e){var t=document.createElement("DIV");t.className="ht_clone_"+e+" handsontable",t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.overflow="hidden";var n=document.createElement("TABLE");return n.className=this.instance.wtTable.TABLE.className,t.appendChild(n),this.instance.wtTable.holder.parentNode.appendChild(t),new m({cloneSource:this.instance,cloneOverlay:this,table:n})},c.prototype.getScrollableElement=function(t){for(var n=t.parentNode;n&&n.style;){if("visible"!==n.style.overflow&&""!==n.style.overflow)return n;if(this instanceof R&&"visible"!==n.style.overflowX&&""!==n.style.overflowX)return n;n=n.parentNode}return e},c.prototype.refresh=function(e){this.clone&&this.clone.draw(e)},c.prototype.destroy=function(){var e=t.eventManager(this.clone);e.clear()},u.prototype.appear=function(e){var n,o,r,i,s,a,l,c,u,h,f,p;if(!this.disabled){var m,g,v,w,y,C,R,S=this.instance,E=function(){return!this.instance.selections.area.cellRange||v==this.instance.selections.area.cellRange.to.row&&w==this.instance.selections.area.cellRange.to.col?!1:!0},_=function(e,t,n,o){var r=parseInt(this.selectionHandles.styles.topLeft.width,10),i=parseInt(this.selectionHandles.styles.topLeftHitArea.width,10);this.selectionHandles.styles.topLeft.top=parseInt(e-r,10)+"px",this.selectionHandles.styles.topLeft.left=parseInt(t-r,10)+"px",this.selectionHandles.styles.topLeftHitArea.top=parseInt(e-i/4*3,10)+"px",this.selectionHandles.styles.topLeftHitArea.left=parseInt(t-i/4*3,10)+"px",this.selectionHandles.styles.bottomRight.top=parseInt(e+o,10)+"px",this.selectionHandles.styles.bottomRight.left=parseInt(t+n,10)+"px",this.selectionHandles.styles.bottomRightHitArea.top=parseInt(e+o-i/4,10)+"px",this.selectionHandles.styles.bottomRightHitArea.left=parseInt(t+n-i/4,10)+"px",this.settings.border.multipleSelectionHandlesVisible&&this.settings.border.multipleSelectionHandlesVisible()?(this.selectionHandles.styles.topLeft.display="block",this.selectionHandles.styles.topLeftHitArea.display="block",E.call(this)?(this.selectionHandles.styles.bottomRight.display="none",this.selectionHandles.styles.bottomRightHitArea.display="none"):(this.selectionHandles.styles.bottomRight.display="block",this.selectionHandles.styles.bottomRightHitArea.display="block")):(this.selectionHandles.styles.topLeft.display="none",this.selectionHandles.styles.bottomRight.display="none",this.selectionHandles.styles.topLeftHitArea.display="none",this.selectionHandles.styles.bottomRightHitArea.display="none"),m==this.instance.wtSettings.getSetting("fixedRowsTop")||g==this.instance.wtSettings.getSetting("fixedColumnsLeft")?(this.selectionHandles.styles.topLeft.zIndex="9999",this.selectionHandles.styles.topLeftHitArea.zIndex="9999"):(this.selectionHandles.styles.topLeft.zIndex="",this.selectionHandles.styles.topLeftHitArea.zIndex="")};for(C=S.cloneOverlay instanceof T||S.cloneOverlay instanceof b?S.getSetting("fixedRowsTop"):S.wtTable.getRenderedRowsCount(),y=0;C>y;y++)if(R=S.wtTable.rowFilter.renderedToSource(y),R>=e[0]&&R<=e[2]){m=R;break}for(y=C-1;y>=0;y--)if(R=S.wtTable.rowFilter.renderedToSource(y),R>=e[0]&&R<=e[2]){v=R;break}for(C=S.wtTable.getRenderedColumnsCount(),y=0;C>y;y++)if(R=S.wtTable.columnFilter.renderedToSource(y),R>=e[1]&&R<=e[3]){g=R;break}for(y=C-1;y>=0;y--)if(R=S.wtTable.columnFilter.renderedToSource(y),R>=e[1]&&R<=e[3]){w=R;break}if(void 0===m||void 0===g)return void this.disappear();n=m!==v||g!==w,o=S.wtTable.getCell(new d(m,g)),r=n?S.wtTable.getCell(new d(v,w)):o,i=t.Dom.offset(o),s=n?t.Dom.offset(r):i,a=t.Dom.offset(S.wtTable.TABLE),c=i.top,f=s.top+t.Dom.outerHeight(r)-c,h=i.left,p=s.left+t.Dom.outerWidth(r)-h,l=c-a.top-1,u=h-a.left-1;var k=t.Dom.getComputedStyle(o);parseInt(k.borderTopWidth,10)>0&&(l+=1,f=f>0?f-1:0),parseInt(k.borderLeftWidth,10)>0&&(u+=1,p=p>0?p-1:0),this.topStyle.top=l+"px",this.topStyle.left=u+"px",this.topStyle.width=p+"px",this.topStyle.display="block",this.leftStyle.top=l+"px",this.leftStyle.left=u+"px",this.leftStyle.height=f+"px",this.leftStyle.display="block";var x=Math.floor(this.settings.border.width/2);if(this.bottomStyle.top=l+f-x+"px",this.bottomStyle.left=u+"px",this.bottomStyle.width=p+"px",this.bottomStyle.display="block",this.rightStyle.top=l+"px",this.rightStyle.left=u+p-x+"px",this.rightStyle.height=f+1+"px",this.rightStyle.display="block",t.mobileBrowser||!this.hasSetting(this.settings.border.cornerVisible)||E.call(this))this.cornerStyle.display="none";else if(this.cornerStyle.top=l+f-4+"px",this.cornerStyle.left=u+p-4+"px",this.cornerStyle.borderRightWidth=this.cornerDefaultStyle.borderWidth,this.cornerStyle.width=this.cornerDefaultStyle.width,this.cornerStyle.display="block",!S.cloneOverlay&&w===S.wtTable.getRenderedColumnsCount()-1){var D=t.Dom.getScrollableElement(S.wtTable.TABLE),A=r.offsetLeft+t.Dom.outerWidth(r)>=t.Dom.innerWidth(D);A&&(this.cornerStyle.borderRightWidth="0px",this.cornerStyle.width=Math.ceil(parseInt(this.cornerDefaultStyle.width,10)/2)+"px")}t.mobileBrowser&&_.call(this,l,u,p,f)}},u.prototype.disappear=function(){this.topStyle.display="none",this.leftStyle.display="none",this.bottomStyle.display="none",this.rightStyle.display="none",this.cornerStyle.display="none",t.mobileBrowser&&(this.selectionHandles.styles.topLeft.display="none",this.selectionHandles.styles.bottomRight.display="none")},u.prototype.hasSetting=function(e){return"function"==typeof e?e():!!e},d.prototype.isValid=function(e){return this.row<0||this.col<0?!1:this.row>=e.getSetting("totalRows")||this.col>=e.getSetting("totalColumns")?!1:!0},d.prototype.isEqual=function(e){return e===this?!0:this.row===e.row&&this.col===e.col},d.prototype.isSouthEastOf=function(e){return this.row>=e.row&&this.col>=e.col},d.prototype.isNorthWestOf=function(e){return this.row<=e.row&&this.col<=e.col},d.prototype.isSouthWestOf=function(e){return this.row>=e.row&&this.col<=e.col},d.prototype.isNorthEastOf=function(e){return this.row<=e.row&&this.col>=e.col},e.WalkontableCellCoords=d,h.prototype.isValid=function(e){return this.from.isValid(e)&&this.to.isValid(e)},h.prototype.isSingle=function(){return this.from.row===this.to.row&&this.from.col===this.to.col},h.prototype.getHeight=function(){return Math.max(this.from.row,this.to.row)-Math.min(this.from.row,this.to.row)+1},h.prototype.getWidth=function(){return Math.max(this.from.col,this.to.col)-Math.min(this.from.col,this.to.col)+1},h.prototype.includes=function(e){var t=this.getTopLeftCorner(),n=this.getBottomRightCorner();return e.row<0&&(e.row=0),e.col<0&&(e.col=0),t.row<=e.row&&n.row>=e.row&&t.col<=e.col&&n.col>=e.col},h.prototype.includesRange=function(e){return this.includes(e.getTopLeftCorner())&&this.includes(e.getBottomRightCorner())},h.prototype.isEqual=function(e){return Math.min(this.from.row,this.to.row)==Math.min(e.from.row,e.to.row)&&Math.max(this.from.row,this.to.row)==Math.max(e.from.row,e.to.row)&&Math.min(this.from.col,this.to.col)==Math.min(e.from.col,e.to.col)&&Math.max(this.from.col,this.to.col)==Math.max(e.from.col,e.to.col)},h.prototype.overlaps=function(e){return e.isSouthEastOf(this.getTopLeftCorner())&&e.isNorthWestOf(this.getBottomRightCorner())},h.prototype.isSouthEastOf=function(e){return this.getTopLeftCorner().isSouthEastOf(e)||this.getBottomRightCorner().isSouthEastOf(e)},h.prototype.isNorthWestOf=function(e){return this.getTopLeftCorner().isNorthWestOf(e)||this.getBottomRightCorner().isNorthWestOf(e)},h.prototype.expand=function(e){var t=this.getTopLeftCorner(),n=this.getBottomRightCorner();return e.row<t.row||e.col<t.col||e.row>n.row||e.col>n.col?(this.from=new d(Math.min(t.row,e.row),Math.min(t.col,e.col)),this.to=new d(Math.max(n.row,e.row),Math.max(n.col,e.col)),!0):!1},h.prototype.expandByRange=function(e){if(this.includesRange(e)||!this.overlaps(e))return!1;var t=this.getTopLeftCorner(),n=this.getBottomRightCorner(),o=(this.getTopRightCorner(),this.getBottomLeftCorner(),e.getTopLeftCorner()),r=e.getBottomRightCorner(),i=Math.min(t.row,o.row),s=Math.min(t.col,o.col),a=Math.max(n.row,r.row),l=Math.max(n.col,r.col),c=new d(i,s),u=new d(a,l),f=new h(c,c,u).isCorner(this.from,e),p=e.isEqual(new h(c,c,u));return f&&!p&&(this.from.col>c.col&&(c.col=l,u.col=s),this.from.row>c.row&&(c.row=a,u.row=i)),this.from=c,this.to=u,!0},h.prototype.getDirection=function(){return this.from.isNorthWestOf(this.to)?"NW-SE":this.from.isNorthEastOf(this.to)?"NE-SW":this.from.isSouthEastOf(this.to)?"SE-NW":this.from.isSouthWestOf(this.to)?"SW-NE":void 0},h.prototype.setDirection=function(e){switch(e){case"NW-SE":this.from=this.getTopLeftCorner(),this.to=this.getBottomRightCorner();break;case"NE-SW":this.from=this.getTopRightCorner(),this.to=this.getBottomLeftCorner();break;case"SE-NW":this.from=this.getBottomRightCorner(),this.to=this.getTopLeftCorner();break;case"SW-NE":this.from=this.getBottomLeftCorner(),this.to=this.getTopRightCorner()}},h.prototype.getTopLeftCorner=function(){return new d(Math.min(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))},h.prototype.getBottomRightCorner=function(){return new d(Math.max(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))},h.prototype.getTopRightCorner=function(){return new d(Math.min(this.from.row,this.to.row),Math.max(this.from.col,this.to.col))},h.prototype.getBottomLeftCorner=function(){return new d(Math.max(this.from.row,this.to.row),Math.min(this.from.col,this.to.col))},h.prototype.isCorner=function(e,t){return t&&t.includes(e)&&(this.getTopLeftCorner().isEqual(new d(t.from.row,t.from.col))||this.getTopRightCorner().isEqual(new d(t.from.row,t.to.col))||this.getBottomLeftCorner().isEqual(new d(t.to.row,t.from.col))||this.getBottomRightCorner().isEqual(new d(t.to.row,t.to.col)))?!0:e.isEqual(this.getTopLeftCorner())||e.isEqual(this.getTopRightCorner())||e.isEqual(this.getBottomLeftCorner())||e.isEqual(this.getBottomRightCorner())},h.prototype.getOppositeCorner=function(e,t){if(!(e instanceof d))return!1;if(t&&t.includes(e)){if(this.getTopLeftCorner().isEqual(new d(t.from.row,t.from.col)))return this.getBottomRightCorner();if(this.getTopRightCorner().isEqual(new d(t.from.row,t.to.col)))return this.getBottomLeftCorner();if(this.getBottomLeftCorner().isEqual(new d(t.to.row,t.from.col)))return this.getTopRightCorner();if(this.getBottomRightCorner().isEqual(new d(t.to.row,t.to.col)))return this.getTopLeftCorner()}return e.isEqual(this.getBottomRightCorner())?this.getTopLeftCorner():e.isEqual(this.getTopLeftCorner())?this.getBottomRightCorner():e.isEqual(this.getTopRightCorner())?this.getBottomLeftCorner():e.isEqual(this.getBottomLeftCorner())?this.getTopRightCorner():void 0},h.prototype.getBordersSharedWith=function(e){if(!this.includesRange(e))return[];var t={top:Math.min(this.from.row,this.to.row),bottom:Math.max(this.from.row,this.to.row),left:Math.min(this.from.col,this.to.col),right:Math.max(this.from.col,this.to.col)},n={top:Math.min(e.from.row,e.to.row),bottom:Math.max(e.from.row,e.to.row),left:Math.min(e.from.col,e.to.col),right:Math.max(e.from.col,e.to.col)},o=[];return t.top==n.top&&o.push("top"),t.right==n.right&&o.push("right"),t.bottom==n.bottom&&o.push("bottom"),t.left==n.left&&o.push("left"),o},h.prototype.getInner=function(){for(var e=this.getTopLeftCorner(),t=this.getBottomRightCorner(),n=[],o=e.row;o<=t.row;o++)for(var r=e.col;r<=t.col;r++)this.from.row===o&&this.from.col===r||this.to.row===o&&this.to.col===r||n.push(new d(o,r));return n},h.prototype.getAll=function(){for(var e=this.getTopLeftCorner(),t=this.getBottomRightCorner(),n=[],o=e.row;o<=t.row;o++)for(var r=e.col;r<=t.col;r++)n.push(e.row===o&&e.col===r?e:t.row===o&&t.col===r?t:new d(o,r));return n},h.prototype.forAll=function(e){for(var t=this.getTopLeftCorner(),n=this.getBottomRightCorner(),o=t.row;o<=n.row;o++)for(var r=t.col;r<=n.col;r++){var i=e(o,r);if(i===!1)return}},e.WalkontableCellRange=h,f.prototype.offsetted=function(e){return e+this.offset},f.prototype.unOffsetted=function(e){return e-this.offset},f.prototype.renderedToSource=function(e){return this.offsetted(e)},f.prototype.sourceToRendered=function(e){return this.unOffsetted(e)},f.prototype.offsettedTH=function(e){return e-this.countTH},f.prototype.unOffsettedTH=function(e){return e+this.countTH},f.prototype.visibleRowHeadedColumnToSourceColumn=function(e){return this.renderedToSource(this.offsettedTH(e))},f.prototype.sourceColumnToVisibleRowHeadedColumn=function(e){return this.unOffsettedTH(this.sourceToRendered(e))},p.prototype.getContainerSize=function(){return"function"==typeof this.containerSizeFn?this.containerSizeFn():this.containerSizeFn},p.prototype.getSize=function(e){return this.cellSizes[e]+(this.cellStretch[e]||0)},p.prototype.stretch=function(){var e=this.getContainerSize(),t=0;if(this.remainingSize=this.cellSizesSum-e,this.cellStretch.length=0,"all"===this.strategy){if(this.remainingSize<0){for(var n,o=e/this.cellSizesSum;t<this.cellCount-1;)n=Math.floor(o*this.cellSizes[t]),this.remainingSize+=n-this.cellSizes[t],this.cellStretch[t]=n-this.cellSizes[t],t++;this.cellStretch[this.cellCount-1]=-this.remainingSize,this.remainingSize=0}}else"last"===this.strategy&&this.remainingSize<0&&1/0!==e&&(this.cellStretch[this.cellCount-1]=-this.remainingSize,this.remainingSize=0)},p.prototype.countVisible=function(){return this.visibleCellCount},p.prototype.isLastIncomplete=function(){var e=this.instance.wtTable.getFirstVisibleRow(),n=this.instance.wtTable.getLastVisibleColumn(),o=this.instance.wtTable.getCell(new d(e,n)),r=t.Dom.offset(o),i=t.Dom.outerWidth(o),s=r.left+i,a=this.instance.wtScrollbars.vertical.getScrollPosition(),l=this.instance.wtViewport.getViewportWidth(),c=a+l;return c>=s},m.prototype.draw=function(e){return this.drawInterrupted=!1,e||t.Dom.isVisible(this.wtTable.TABLE)?(this.wtTable.draw(e),this):void(this.drawInterrupted=!0)},m.prototype.getCell=function(e,t){if(t){var n=this.wtSettings.getSetting("fixedRowsTop"),o=this.wtSettings.getSetting("fixedColumnsLeft");return e.row<n&&e.col<o?this.wtScrollbars.corner.clone.wtTable.getCell(e):e.row<n?this.wtScrollbars.vertical.clone.wtTable.getCell(e):e.col<o?this.wtScrollbars.horizontal.clone.wtTable.getCell(e):this.wtTable.getCell(e)}return this.wtTable.getCell(e)},m.prototype.update=function(e,t){return this.wtSettings.update(e,t)},m.prototype.scrollVertical=function(e){return this.wtScrollbars.vertical.scrollTo(e),this.getSetting("onScrollVertically"),this},m.prototype.scrollHorizontal=function(e){return this.wtScrollbars.horizontal.scrollTo(e),this.getSetting("onScrollHorizontally"),this},m.prototype.scrollViewport=function(e){return this.wtScroll.scrollViewport(e),this},m.prototype.getViewport=function(){return[this.wtTable.getFirstVisibleRow(),this.wtTable.getFirstVisibleColumn(),this.wtTable.getLastVisibleRow(),this.wtTable.getLastVisibleColumn()]},m.prototype.getSetting=function(e,t,n,o,r){return this.wtSettings.getSetting(e,t,n,o,r)
},m.prototype.hasSetting=function(e){return this.wtSettings.has(e)},m.prototype.destroy=function(){this.wtScrollbars.destroy(),this.wtEvent&&this.wtEvent.destroy()},g.prototype=new c,g.prototype.destroy=function(){c.prototype.destroy.call(this),clearTimeout(this.lastTimeout)},v.prototype.parentCell=function(e){var n={},o=this.instance.wtTable.TABLE,r=t.Dom.closest(e,["TD","TH"],o);return r&&t.Dom.isChildOf(r,o)?(n.coords=this.instance.wtTable.getCoords(r),n.TD=r):t.Dom.hasClass(e,"wtBorder")&&t.Dom.hasClass(e,"current")?(n.coords=this.instance.selections.current.cellRange.highlight,n.TD=this.instance.wtTable.getCell(n.coords)):t.Dom.hasClass(e,"wtBorder")&&t.Dom.hasClass(e,"area")&&this.instance.selections.area.cellRange&&(n.coords=this.instance.selections.area.cellRange.to,n.TD=this.instance.wtTable.getCell(n.coords)),n},e.requestAnimFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)}}(),e.cancelRequestAnimFrame=function(){return e.cancelAnimationFrame||e.webkitCancelRequestAnimationFrame||e.mozCancelRequestAnimationFrame||e.oCancelRequestAnimationFrame||e.msCancelRequestAnimationFrame||clearTimeout}(),e.getComputedStyle||!function(){var t,n={getPropertyValue:function(e){return"float"==e&&(e="styleFloat"),t.currentStyle[e.toUpperCase()]||null}};e.getComputedStyle=function(e){return t=e,n}}(),!String.prototype.trim){var it=/^\s+|\s+$/g;String.prototype.trim=function(){return this.replace(it,"")}}y.prototype.offsetted=function(e){return e+this.offset},y.prototype.unOffsetted=function(e){return e-this.offset},y.prototype.renderedToSource=function(e){return this.offsetted(e)},y.prototype.sourceToRendered=function(e){return this.unOffsetted(e)},y.prototype.offsettedTH=function(e){return e-this.countTH},y.prototype.visibleColHeadedRowToSourceRow=function(e){return this.renderedToSource(this.offsettedTH(e))},y.prototype.sourceRowToVisibleColHeadedRow=function(e){return this.unOffsettedTH(this.sourceToRendered(e))},C.prototype.scrollViewport=function(e){if(this.instance.drawn){var t=this.instance.getSetting("totalRows"),n=this.instance.getSetting("totalColumns");if(e.row<0||e.row>t-1)throw new Error("row "+e.row+" does not exist");if(e.col<0||e.col>n-1)throw new Error("column "+e.col+" does not exist");e.row>this.instance.wtTable.getLastVisibleRow()?this.instance.wtScrollbars.vertical.scrollTo(e.row,!0):e.row>=this.instance.getSetting("fixedRowsTop")&&e.row<this.instance.wtTable.getFirstVisibleRow()&&this.instance.wtScrollbars.vertical.scrollTo(e.row),e.col>this.instance.wtTable.getLastVisibleColumn()?this.instance.wtScrollbars.horizontal.scrollTo(e.col,!0):e.col>this.instance.getSetting("fixedColumnsLeft")&&e.col<this.instance.wtTable.getFirstVisibleColumn()&&this.instance.wtScrollbars.horizontal.scrollTo(e.col)}},b.prototype=new c,b.prototype.resetFixedPosition=function(){if(this.instance.wtTable.holder.parentNode){var n,o,r=this.clone.wtTable.holder.parentNode;if(this.scrollHandler===e){var i=this.instance.wtTable.holder.getBoundingClientRect(),s=Math.ceil(i.top),a=Math.ceil(i.left),l=Math.ceil(i.bottom),c=Math.ceil(i.right);n=0>a&&c-r.offsetWidth>0?-a+"px":"0",o=0>s&&l-r.offsetHeight>0?-s+"px":"0"}else t.freezeOverlays||(n=this.instance.wtScrollbars.horizontal.getScrollPosition()+"px",o=this.instance.wtScrollbars.vertical.getScrollPosition()+"px");t.Dom.setOverlayPosition(r,n,o),r.style.width=t.Dom.outerWidth(this.clone.wtTable.TABLE)+4+"px",r.style.height=t.Dom.outerHeight(this.clone.wtTable.TABLE)+4+"px"}},R.prototype=new c,R.prototype.resetFixedPosition=function(){var n,o;if(this.instance.wtTable.holder.parentNode){var r=this.clone.wtTable.holder.parentNode;if(this.scrollHandler===e){var i=this.instance.wtTable.holder.getBoundingClientRect(),s=Math.ceil(i.left),a=Math.ceil(i.right);n=0>s&&a-r.offsetWidth>0?-s+"px":"0",o=this.instance.wtTable.hider.style.top}else t.freezeOverlays||(n=this.getScrollPosition()+"px",o=this.instance.wtTable.hider.style.top);t.Dom.setOverlayPosition(r,n,o),r.style.height=t.Dom.outerHeight(this.clone.wtTable.TABLE)+"px",r.style.width=t.Dom.outerWidth(this.clone.wtTable.TABLE)+4+"px"}},R.prototype.refresh=function(e){this.applyToDOM(),c.prototype.refresh.call(this,e)},R.prototype.getScrollPosition=function(){return t.Dom.getScrollLeft(this.scrollHandler)},R.prototype.setScrollPosition=function(n){this.scrollHandler===e?e.scrollTo(n,t.Dom.getWindowScrollTop()):this.scrollHandler.scrollLeft=n},R.prototype.onScroll=function(){this.instance.getSetting("onScrollHorizontally")},R.prototype.sumCellSizes=function(e,t){for(var n=0;t>e;)n+=this.instance.wtTable.getStretchedColumnWidth(e)||this.instance.wtSettings.defaultColumnWidth,e++;return n},R.prototype.applyToDOM=function(){var e=this.instance.getSetting("totalColumns"),t=this.instance.wtViewport.getRowHeaderWidth();if(this.fixedContainer.style.width=t+this.sumCellSizes(0,e)+"px","number"==typeof this.instance.wtViewport.columnsRenderCalculator.startPosition)this.fixed.style.left=this.instance.wtViewport.columnsRenderCalculator.startPosition+"px";else{if(0!==e)throw new Error("Incorrect value of the columnsRenderCalculator");this.fixed.style.left="0"}this.fixed.style.right=""},R.prototype.scrollTo=function(e,t){var n=this.getTableParentOffset();if(t)n+=this.sumCellSizes(0,e+1),n-=this.instance.wtViewport.getViewportWidth();else{var o=this.instance.getSetting("fixedColumnsLeft");n+=this.sumCellSizes(o,e)}this.setScrollPosition(n)},R.prototype.getTableParentOffset=function(){return this.scrollHandler===e?this.instance.wtTable.holderOffset.left:0},T.prototype=new c,T.prototype.resetFixedPosition=function(){var n,o;if(this.instance.wtTable.holder.parentNode){var r=this.clone.wtTable.holder.parentNode;if(this.scrollHandler===e){var i=this.instance.wtTable.holder.getBoundingClientRect(),s=Math.ceil(i.top),a=Math.ceil(i.bottom);n=this.instance.wtTable.hider.style.left,o=0>s&&a-r.offsetHeight>0?-s+"px":"0"}else t.freezeOverlays||(o=this.getScrollPosition()+"px",n=this.instance.wtTable.hider.style.left);t.Dom.setOverlayPosition(r,n,o),r.style.width=this.instance.wtScrollbars.horizontal.scrollHandler===e?this.instance.wtViewport.getWorkspaceActualWidth()+"px":t.Dom.outerWidth(this.clone.wtTable.TABLE)+"px",r.style.height=t.Dom.outerHeight(this.clone.wtTable.TABLE)+4+"px"}},T.prototype.getScrollPosition=function(){return t.Dom.getScrollTop(this.scrollHandler)},T.prototype.setScrollPosition=function(n){this.scrollHandler===e?e.scrollTo(t.Dom.getWindowScrollLeft(),n):this.scrollHandler.scrollTop=n},T.prototype.onScroll=function(){this.instance.getSetting("onScrollVertically")},T.prototype.sumCellSizes=function(e,t){for(var n=0;t>e;)n+=this.instance.wtTable.getRowHeight(e)||this.instance.wtSettings.settings.defaultRowHeight,e++;return n},T.prototype.refresh=function(e){this.applyToDOM(),c.prototype.refresh.call(this,e)},T.prototype.applyToDOM=function(){var e=this.instance.getSetting("totalRows"),t=this.instance.wtViewport.getColumnHeaderHeight();if(this.fixedContainer.style.height=t+this.sumCellSizes(0,e)+"px","number"==typeof this.instance.wtViewport.rowsRenderCalculator.startPosition)this.fixed.style.top=this.instance.wtViewport.rowsRenderCalculator.startPosition+"px";else{if(0!==e)throw new Error("Incorrect value of the rowsRenderCalculator");this.fixed.style.top="0"}this.fixed.style.bottom=""},T.prototype.scrollTo=function(e,t){var n=this.getTableParentOffset();if(t)n+=this.sumCellSizes(0,e+1),n-=this.instance.wtViewport.getViewportHeight(),n+=1;else{var o=this.instance.getSetting("fixedRowsTop");n+=this.sumCellSizes(o,e)}this.setScrollPosition(n)},T.prototype.getTableParentOffset=function(){return this.scrollHandler===e?this.instance.wtTable.holderOffset.top:0},S.prototype.registerListeners=function(){var n=this;this.refreshAll=function(){if(n.instance.drawn){if(!n.instance.wtTable.holder.parentNode)return void n.destroy();n.instance.draw(!0),n.vertical.onScroll(),n.horizontal.onScroll()}};var o=t.eventManager(n.instance);o.addEventListener(this.vertical.scrollHandler,"scroll",this.refreshAll),this.vertical.scrollHandler!==this.horizontal.scrollHandler&&o.addEventListener(this.horizontal.scrollHandler,"scroll",this.refreshAll),this.vertical.scrollHandler!==e&&this.horizontal.scrollHandler!==e&&o.addEventListener(e,"scroll",this.refreshAll)},S.prototype.destroy=function(){var n=t.eventManager(this.instance);this.vertical&&(this.vertical.destroy(),n.removeEventListener(this.vertical.scrollHandler,"scroll",this.refreshAll)),this.horizontal&&(this.horizontal.destroy(),n.removeEventListener(this.horizontal.scrollHandler,"scroll",this.refreshAll)),n.removeEventListener(e,"scroll",this.refreshAll),this.corner&&this.corner.destroy(),this.debug&&this.debug.destroy()},S.prototype.refresh=function(e){this.horizontal&&this.horizontal.refresh(e),this.vertical&&this.vertical.refresh(e),this.corner&&this.corner.refresh(e),this.debug&&this.debug.refresh(e)},S.prototype.applyToDOM=function(){this.horizontal&&this.horizontal.applyToDOM(),this.vertical&&this.vertical.applyToDOM()},E.prototype.getBorder=function(e){return this.instanceBorders[e.guid]?this.instanceBorders[e.guid]:void(this.instanceBorders[e.guid]=new u(e,this.settings))},E.prototype.isEmpty=function(){return null===this.cellRange},E.prototype.add=function(e){this.isEmpty()?this.cellRange=new h(e,e,e):this.cellRange.expand(e)},E.prototype.replace=function(e,t){if(!this.isEmpty()){if(this.cellRange.from.isEqual(e))return this.cellRange.from=t,!0;if(this.cellRange.to.isEqual(e))return this.cellRange.to=t,!0}return!1},E.prototype.clear=function(){this.cellRange=null},E.prototype.getCorners=function(){var e=this.cellRange.getTopLeftCorner(),t=this.cellRange.getBottomRightCorner();return[e.row,e.col,t.row,t.col]},E.prototype.addClassAtCoords=function(e,n,o,r){var i=e.wtTable.getCell(new d(n,o));"object"==typeof i&&t.Dom.addClass(i,r)},E.prototype.draw=function(e){var n,o,r,i,s,a=this,l=e.wtTable.getRenderedRowsCount(),c=e.wtTable.getRenderedColumnsCount();if(this.isEmpty())return void(this.settings.border&&(i=this.getBorder(e),i&&i.disappear()));n=this.getCorners();for(var u=0;c>u;u++)r=e.wtTable.columnFilter.renderedToSource(u),r>=n[1]&&r<=n[3]&&(s=e.wtTable.getColumnHeader(r),s&&a.settings.highlightColumnClassName&&t.Dom.addClass(s,a.settings.highlightColumnClassName));for(var d=0;l>d;d++){o=e.wtTable.rowFilter.renderedToSource(d),o>=n[0]&&o<=n[2]&&(s=e.wtTable.getRowHeader(o),s&&a.settings.highlightRowClassName&&t.Dom.addClass(s,a.settings.highlightRowClassName));for(var u=0;c>u;u++)r=e.wtTable.columnFilter.renderedToSource(u),o>=n[0]&&o<=n[2]&&r>=n[1]&&r<=n[3]?a.settings.className&&a.addClassAtCoords(e,o,r,a.settings.className):o>=n[0]&&o<=n[2]?a.settings.highlightRowClassName&&a.addClassAtCoords(e,o,r,a.settings.highlightRowClassName):r>=n[1]&&r<=n[3]&&a.settings.highlightColumnClassName&&a.addClassAtCoords(e,o,r,a.settings.highlightColumnClassName)}e.getSetting("onBeforeDrawBorders",n,this.settings.className),this.settings.border&&(i=this.getBorder(e),i&&i.appear(n))},_.prototype.update=function(e,t){if(void 0===t)for(var n in e)e.hasOwnProperty(n)&&(this.settings[n]=e[n]);else this.settings[e]=t;return this.instance},_.prototype.getSetting=function(e,t,n,o,r){return"function"==typeof this.settings[e]?this.settings[e](t,n,o,r):void 0!==t&&Array.isArray(this.settings[e])?this.settings[e][t]:this.settings[e]},_.prototype.has=function(e){return!!this.settings[e]},k.prototype.isWorkingOnClone=function(){return!!this.instance.cloneSource},k.prototype.draw=function(e){if(this.isWorkingOnClone()||(this.holderOffset=t.Dom.offset(this.holder),e=this.instance.wtViewport.createRenderCalculators(e)),e)this.isWorkingOnClone()||this.instance.wtViewport.createVisibleCalculators(),this.instance.wtScrollbars&&this.instance.wtScrollbars.refresh(!0);else{this.tableOffset=this.isWorkingOnClone()?this.instance.cloneSource.wtTable.tableOffset:t.Dom.offset(this.TABLE);var n;n=this.instance.cloneOverlay instanceof g||this.instance.cloneOverlay instanceof T||this.instance.cloneOverlay instanceof b?0:this.instance.wtViewport.rowsRenderCalculator.startRow;var o;o=this.instance.cloneOverlay instanceof g||this.instance.cloneOverlay instanceof R||this.instance.cloneOverlay instanceof b?0:this.instance.wtViewport.columnsRenderCalculator.startColumn,this.rowFilter=new y(n,this.instance.getSetting("totalRows"),this.instance.getSetting("columnHeaders").length),this.columnFilter=new f(o,this.instance.getSetting("totalColumns"),this.instance.getSetting("rowHeaders").length),this._doDraw()}return this.refreshSelections(e),this.isWorkingOnClone()||(this.instance.wtScrollbars.vertical.resetFixedPosition(),this.instance.wtScrollbars.horizontal.resetFixedPosition(),this.instance.wtScrollbars.corner.resetFixedPosition()),this.instance.drawn=!0,this},k.prototype._doDraw=function(){var e=new x(this);e.render()},k.prototype.removeClassFromCells=function(e){for(var n=this.TABLE.querySelectorAll("."+e),o=0,r=n.length;r>o;o++)t.Dom.removeClass(n[o],e)},k.prototype.refreshSelections=function(e){var t,n;if(this.instance.selections){if(n=this.instance.selections.length,e)for(t=0;n>t;t++)this.instance.selections[t].settings.className&&this.removeClassFromCells(this.instance.selections[t].settings.className),this.instance.selections[t].settings.highlightRowClassName&&this.removeClassFromCells(this.instance.selections[t].settings.highlightRowClassName),this.instance.selections[t].settings.highlightColumnClassName&&this.removeClassFromCells(this.instance.selections[t].settings.highlightColumnClassName);for(t=0;n>t;t++)this.instance.selections[t].draw(this.instance,e)}},k.prototype.getCell=function(e){if(this.isRowBeforeRenderedRows(e.row))return-1;if(this.isRowAfterRenderedRows(e.row))return-2;var t=this.TBODY.childNodes[this.rowFilter.sourceToRendered(e.row)];return t?t.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e.col)]:void 0},k.prototype.getColumnHeader=function(e,t){t||(t=0);var n=this.THEAD.childNodes[t];return n?n.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(e)]:void 0},k.prototype.getRowHeader=function(e){if(0===this.columnFilter.sourceColumnToVisibleRowHeadedColumn(0))return null;var t=this.TBODY.childNodes[this.rowFilter.sourceToRendered(e)];return t?t.childNodes[0]:void 0},k.prototype.getCoords=function(e){var n=e.parentNode,o=t.Dom.index(n);return o=n.parentNode===this.THEAD?this.rowFilter.visibleColHeadedRowToSourceRow(o):this.rowFilter.renderedToSource(o),new d(o,this.columnFilter.visibleRowHeadedColumnToSourceColumn(e.cellIndex))},k.prototype.getTrForRow=function(e){return this.TBODY.childNodes[this.rowFilter.sourceToRendered(e)]},k.prototype.getFirstRenderedRow=function(){return this.instance.wtViewport.rowsRenderCalculator.startRow},k.prototype.getFirstVisibleRow=function(){return this.instance.wtViewport.rowsVisibleCalculator.startRow},k.prototype.getFirstRenderedColumn=function(){return this.instance.wtViewport.columnsRenderCalculator.startColumn},k.prototype.getFirstVisibleColumn=function(){return this.instance.wtViewport.columnsVisibleCalculator.startColumn},k.prototype.getLastRenderedRow=function(){return this.instance.wtViewport.rowsRenderCalculator.endRow},k.prototype.getLastVisibleRow=function(){return this.instance.wtViewport.rowsVisibleCalculator.endRow},k.prototype.getLastRenderedColumn=function(){return this.instance.wtViewport.columnsRenderCalculator.endColumn},k.prototype.getLastVisibleColumn=function(){return this.instance.wtViewport.columnsVisibleCalculator.endColumn},k.prototype.isRowBeforeRenderedRows=function(e){return this.rowFilter.sourceToRendered(e)<0&&e>=0},k.prototype.isRowAfterViewport=function(e){return e>this.getLastVisibleRow()},k.prototype.isRowAfterRenderedRows=function(e){return e>this.getLastRenderedRow()},k.prototype.isColumnBeforeViewport=function(e){return this.columnFilter.sourceToRendered(e)<0&&e>=0},k.prototype.isColumnAfterViewport=function(e){return e>this.getLastVisibleColumn()},k.prototype.isLastRowFullyVisible=function(){return this.getLastVisibleRow()===this.getLastRenderedRow()},k.prototype.isLastColumnFullyVisible=function(){return this.getLastVisibleColumn()===this.getLastRenderedColumn},k.prototype.getRenderedColumnsCount=function(){return this.instance.cloneOverlay instanceof g?this.instance.getSetting("totalColumns"):this.instance.cloneOverlay instanceof R||this.instance.cloneOverlay instanceof b?this.instance.getSetting("fixedColumnsLeft"):this.instance.wtViewport.columnsRenderCalculator.count},k.prototype.getRenderedRowsCount=function(){return this.instance.cloneOverlay instanceof g?this.instance.getSetting("totalRows"):this.instance.cloneOverlay instanceof T||this.instance.cloneOverlay instanceof b?this.instance.getSetting("fixedRowsTop"):this.instance.wtViewport.rowsRenderCalculator.count},k.prototype.getVisibleRowsCount=function(){return this.instance.wtViewport.rowsVisibleCalculator.count},k.prototype.allRowsInViewport=function(){return this.instance.getSetting("totalRows")==this.getVisibleRowsCount()},k.prototype.getRowHeight=function(e){var t=this.instance.wtSettings.settings.rowHeight(e),n=this.instance.wtViewport.oversizedRows[e];return void 0!==n&&(t=t?Math.max(t,n):n),t},k.prototype.getColumnHeaderHeight=function(e){var t=this.instance.wtSettings.settings.defaultRowHeight,n=this.instance.wtViewport.oversizedColumnHeaders[e];return void 0!==n&&(t=t?Math.max(t,n):n),t},k.prototype.getVisibleColumnsCount=function(){return this.instance.wtViewport.columnsVisibleCalculator.count},k.prototype.allColumnsInViewport=function(){return this.instance.getSetting("totalColumns")==this.getVisibleColumnsCount()},k.prototype.getColumnWidth=function(e){var t=this.instance.wtSettings.settings.columnWidth;"function"==typeof t?t=t(e):"object"==typeof t&&(t=t[e]);var n=this.instance.wtViewport.oversizedCols[e];return void 0!==n&&(t=t?Math.max(t,n):n),t},k.prototype.getStretchedColumnWidth=function(e){var t,n=this.getColumnWidth(e)||this.instance.wtSettings.settings.defaultColumnWidth,o=this.instance.wtViewport.columnsRenderCalculator;return o&&(t=o.getStretchedColumnWidth(e,n),t&&(n=t)),n},x.prototype.render=function(){this.wtTable.isWorkingOnClone()||this.instance.getSetting("beforeDraw",!0),this.rowHeaders=this.instance.getSetting("rowHeaders"),this.rowHeaderCount=this.rowHeaders.length,this.fixedRowsTop=this.instance.getSetting("fixedRowsTop"),this.columnHeaders=this.instance.getSetting("columnHeaders"),this.columnHeaderCount=this.columnHeaders.length;var e,t,n=this.instance.getSetting("totalRows"),o=this.instance.getSetting("totalColumns"),r=!1,i=this.wtTable.getRenderedRowsCount();if(o>0&&(this.adjustAvailableNodes(),r=!0,this.renderColGroups(),this.renderColumnHeaders(),e=this.wtTable.getRenderedColumnsCount(),this.renderRows(n,i,e),this.wtTable.isWorkingOnClone()?this.adjustColumnHeaderHeights():(t=this.instance.wtViewport.getWorkspaceWidth(),this.instance.wtViewport.containerWidth=null),this.adjustColumnWidths(e)),r||this.adjustAvailableNodes(),this.removeRedundantRows(i),!this.wtTable.isWorkingOnClone()){if(this.markOversizedRows(),this.instance.wtViewport.createVisibleCalculators(),this.instance.wtScrollbars.applyToDOM(),t!==this.instance.wtViewport.getWorkspaceWidth()){this.instance.wtViewport.containerWidth=null;for(var s=this.wtTable.getFirstRenderedColumn(),a=this.wtTable.getLastRenderedColumn(),l=s;a>l;l++){var c=this.wtTable.getStretchedColumnWidth(l),u=this.columnFilter.sourceToRendered(l);this.COLGROUP.childNodes[u+this.rowHeaderCount].style.width=c+"px"}}this.instance.wtScrollbars.refresh(!1),this.instance.getSetting("onDraw",!0)}},x.prototype.removeRedundantRows=function(e){for(;this.wtTable.tbodyChildrenLength>e;)this.TBODY.removeChild(this.TBODY.lastChild),this.wtTable.tbodyChildrenLength--},x.prototype.renderRows=function(e,t,n){for(var o,r,i=0,s=this.rowFilter.renderedToSource(i),a=this.wtTable.isWorkingOnClone();e>s&&s>=0;){if(i>1e3)throw new Error("Security brake: Too much TRs. Please define height for your table, which will enforce scrollbars.");if(void 0!==t&&i===t)break;if(r=this.getOrCreateTrForRow(i,r),this.renderRowHeaders(s,r),this.adjustColumns(r,n+this.rowHeaderCount),o=this.renderCells(s,r,n),a||this.resetOversizedRow(s),r.firstChild){var l=this.instance.wtTable.getRowHeight(s);r.firstChild.style.height=l?l+"px":""}i++,s=this.rowFilter.renderedToSource(i)}},x.prototype.resetOversizedRow=function(e){this.instance.wtViewport.oversizedRows&&this.instance.wtViewport.oversizedRows[e]&&(this.instance.wtViewport.oversizedRows[e]=void 0)},x.prototype.markOversizedRows=function(){for(var e,n,o,r,i=this.instance.wtTable.TBODY.childNodes.length;i;)i--,o=this.instance.wtTable.rowFilter.renderedToSource(i),e=this.instance.wtTable.getRowHeight(o),r=this.instance.wtTable.getTrForRow(o),n=t.Dom.innerHeight(r)-1,(!e&&this.instance.wtSettings.settings.defaultRowHeight<n||n>e)&&(this.instance.wtViewport.oversizedRows[o]=n)},x.prototype.adjustColumnHeaderHeights=function(){for(var e=this.instance.getSetting("columnHeaders"),t=0,n=e.length;n>t;t++)if(this.instance.wtViewport.oversizedColumnHeaders[t]){if(0===this.instance.wtTable.THEAD.childNodes[t].childNodes.length)return;this.instance.wtTable.THEAD.childNodes[t].childNodes[0].style.height=this.instance.wtViewport.oversizedColumnHeaders[t]+"px"}},x.prototype.markIfOversizedColumnHeader=function(e){var n,o,r,i,s=(0!==this.instance.wtTable.THEAD.childNodes.length?this.instance.wtTable.THEAD.childNodes[0].childNodes.length:0,this.instance.getSetting("columnHeaders")),a=s.length,l=a;for(n=this.instance.wtTable.columnFilter.renderedToSource(e);l;)l--,o=this.instance.wtTable.getColumnHeaderHeight(l),r=this.instance.wtTable.getColumnHeader(n,l),r&&(i=t.Dom.innerHeight(r)-1,(!o&&this.instance.wtSettings.settings.defaultRowHeight<i||i>o)&&(this.instance.wtViewport.oversizedColumnHeaders[l]=i))},x.prototype.renderCells=function(e,n,o){for(var r,i,s=0;o>s;s++)i=this.columnFilter.renderedToSource(s),r=0===s?n.childNodes[this.columnFilter.sourceColumnToVisibleRowHeadedColumn(i)]:r.nextSibling,"TH"==r.nodeName&&(r=this.utils.replaceThWithTd(r,n)),t.Dom.hasClass(r,"hide")||(r.className=""),r.removeAttribute("style"),this.instance.wtSettings.settings.cellRenderer(e,i,r);return r},x.prototype.adjustColumnWidths=function(e){var t;this.instance.wtViewport.columnsRenderCalculator.refreshStretching(this.instance.wtViewport.getViewportWidth());for(var n=0;e>n;n++)t=this.wtTable.getStretchedColumnWidth(this.columnFilter.renderedToSource(n)),this.COLGROUP.childNodes[n+this.rowHeaderCount].style.width=t+"px"},x.prototype.appendToTbody=function(e){this.TBODY.appendChild(e),this.wtTable.tbodyChildrenLength++},x.prototype.getOrCreateTrForRow=function(e,t){var n;return e>=this.wtTable.tbodyChildrenLength?(n=this.createRow(),this.appendToTbody(n)):n=0===e?this.TBODY.firstChild:t.nextSibling,n},x.prototype.createRow=function(){for(var e=document.createElement("TR"),t=0;t<this.rowHeaderCount;t++)e.appendChild(document.createElement("TH"));return e},x.prototype.renderRowHeader=function(e,t,n){n.className="",n.removeAttribute("style"),this.rowHeaders[t](e,n,t)},x.prototype.renderRowHeaders=function(e,t){for(var n=t.firstChild,o=0;o<this.rowHeaderCount;o++)n?"TD"==n.nodeName&&(n=this.utils.replaceTdWithTh(n,t)):(n=document.createElement("TH"),t.appendChild(n)),this.renderRowHeader(e,o,n),n=n.nextSibling},x.prototype.adjustAvailableNodes=function(){this.adjustColGroups(),this.adjustThead()},x.prototype.renderColumnHeaders=function(){if(this.columnHeaderCount)for(var e,t,n=this.wtTable.getRenderedColumnsCount(),o=0;o<this.columnHeaderCount;o++)for(e=this.getTrForColumnHeaders(o),t=-1*this.rowHeaderCount;n>t;t++){var r=this.columnFilter.renderedToSource(t);this.renderColumnHeader(o,r,e.childNodes[t+this.rowHeaderCount]),this.wtTable.isWorkingOnClone()||this.markIfOversizedColumnHeader(t)}},x.prototype.adjustColGroups=function(){for(var e=this.wtTable.getRenderedColumnsCount();this.wtTable.colgroupChildrenLength<e+this.rowHeaderCount;)this.COLGROUP.appendChild(document.createElement("COL")),this.wtTable.colgroupChildrenLength++;for(;this.wtTable.colgroupChildrenLength>e+this.rowHeaderCount;)this.COLGROUP.removeChild(this.COLGROUP.lastChild),this.wtTable.colgroupChildrenLength--},x.prototype.adjustThead=function(){var e=this.wtTable.getRenderedColumnsCount(),n=this.THEAD.firstChild;if(this.columnHeaders.length){for(var o=0,r=this.columnHeaders.length;r>o;o++){for(n=this.THEAD.childNodes[o],n||(n=document.createElement("TR"),this.THEAD.appendChild(n)),this.theadChildrenLength=n.childNodes.length;this.theadChildrenLength<e+this.rowHeaderCount;)n.appendChild(document.createElement("TH")),this.theadChildrenLength++;for(;this.theadChildrenLength>e+this.rowHeaderCount;)n.removeChild(n.lastChild),this.theadChildrenLength--}var i=this.THEAD.childNodes.length;if(i>this.columnHeaders.length)for(var o=this.columnHeaders.length;i>o;o++)this.THEAD.removeChild(this.THEAD.lastChild)}else n&&t.Dom.empty(n)},x.prototype.getTrForColumnHeaders=function(e){var t=this.THEAD.childNodes[e];return t},x.prototype.renderColumnHeader=function(e,t,n){return n.className="",n.removeAttribute("style"),this.columnHeaders[e](t,n,e)},x.prototype.renderColGroups=function(){for(var e=0;e<this.wtTable.colgroupChildrenLength;e++)e<this.rowHeaderCount?t.Dom.addClass(this.COLGROUP.childNodes[e],"rowHeader"):t.Dom.removeClass(this.COLGROUP.childNodes[e],"rowHeader")},x.prototype.adjustColumns=function(e,t){for(var n=e.childNodes.length;t>n;){var o=document.createElement("TD");e.appendChild(o),n++}for(;n>t;)e.removeChild(e.lastChild),n--},x.prototype.removeRedundantColumns=function(e){for(;this.wtTable.tbodyChildrenLength>e;)this.TBODY.removeChild(this.TBODY.lastChild),this.wtTable.tbodyChildrenLength--},x.utils={},x.utils.replaceTdWithTh=function(e,t){var n;return n=document.createElement("TH"),t.insertBefore(n,e),t.removeChild(e),n},x.utils.replaceThWithTd=function(e,t){var n=document.createElement("TD");return t.insertBefore(n,e),t.removeChild(e),n},D.prototype.getWorkspaceHeight=function(){var n=this.instance.wtScrollbars.vertical.scrollHandler;if(n===e)return document.documentElement.clientHeight;var o=t.Dom.outerHeight(n),r=o>0&&n.clientHeight>0?n.clientHeight:1/0;return r},D.prototype.getWorkspaceWidth=function(){var n,o,r=this.instance.getSetting("totalColumns"),i=this.instance.wtScrollbars.horizontal.scrollHandler,s=this.instance.getSetting("stretchH");return n=t.freezeOverlays?Math.min(document.documentElement.offsetWidth-this.getWorkspaceOffset().left,document.documentElement.offsetWidth):Math.min(this.getContainerFillWidth(),document.documentElement.offsetWidth-this.getWorkspaceOffset().left,document.documentElement.offsetWidth),i===e&&r>0&&this.sumColumnWidths(0,r-1)>n?document.documentElement.clientWidth:i!==e&&(o=this.instance.wtScrollbars.horizontal.scrollHandler.style.overflow,"scroll"==o||"hidden"==o||"auto"==o)?Math.max(n,i.clientWidth):"none"!==s&&s?n:Math.max(n,t.Dom.outerWidth(this.instance.wtTable.TABLE))},D.prototype.sumColumnWidths=function(e,t){for(var n=0;t>e;)n+=this.instance.wtTable.getColumnWidth(e)||this.instance.wtSettings.defaultColumnWidth,e++;return n},D.prototype.getContainerFillWidth=function(){if(this.containerWidth)return this.containerWidth;for(var e,t,n=this.instance.wtTable.holder;n.parentNode!=document.body&&null!=n.parentNode&&-1===n.className.indexOf("handsontable");)n=n.parentNode;return t=document.createElement("DIV"),t.style.width="100%",t.style.height="1px",n.appendChild(t),e=t.offsetWidth,this.containerWidth=e,n.removeChild(t),e},D.prototype.getWorkspaceOffset=function(){return t.Dom.offset(this.instance.wtTable.TABLE)},D.prototype.getWorkspaceActualHeight=function(){return t.Dom.outerHeight(this.instance.wtTable.TABLE)},D.prototype.getWorkspaceActualWidth=function(){return t.Dom.outerWidth(this.instance.wtTable.TABLE)||t.Dom.outerWidth(this.instance.wtTable.TBODY)||t.Dom.outerWidth(this.instance.wtTable.THEAD)},D.prototype.getColumnHeaderHeight=function(){return isNaN(this.columnHeaderHeight)&&(this.columnHeaderHeight=t.Dom.outerHeight(this.instance.wtTable.THEAD)),this.columnHeaderHeight},D.prototype.getViewportHeight=function(){var e=this.getWorkspaceHeight();if(1/0===e)return e;var t=this.getColumnHeaderHeight();return t>0&&(e-=t),e},D.prototype.getRowHeaderWidth=function(){if(this.instance.cloneSource)return this.instance.cloneSource.wtViewport.getRowHeaderWidth();if(isNaN(this.rowHeaderWidth)){var e=this.instance.getSetting("rowHeaders");if(e.length){var n=this.instance.wtTable.TABLE.querySelector("TH");this.rowHeaderWidth=0;for(var o=0,r=e.length;r>o;o++)n?(this.rowHeaderWidth+=t.Dom.outerWidth(n),n=n.nextSibling):this.rowHeaderWidth+=50}else this.rowHeaderWidth=0}return this.rowHeaderWidth},D.prototype.getViewportWidth=function(){var e,t=this.getWorkspaceWidth();return 1/0===t?t:(e=this.getRowHeaderWidth(),e>0?t-e:t)},D.prototype.createRowsCalculator=function(e){this.rowHeaderWidth=0/0;var t;t=this.instance.wtSettings.settings.renderAllRows?1/0:this.getViewportHeight();var n=this.instance.wtScrollbars.vertical.getScrollPosition()-this.instance.wtScrollbars.vertical.getTableParentOffset();0>n&&(n=0);var o=this.instance.getSetting("fixedRowsTop");if(o){var r=this.instance.wtScrollbars.vertical.sumCellSizes(0,o);n+=r,t-=r}var i=this;return new H(t,n,this.instance.getSetting("totalRows"),function(e){return i.instance.wtTable.getRowHeight(e)},e?null:this.instance.wtSettings.settings.viewportRowCalculatorOverride,e?!0:!1)},D.prototype.createColumnsCalculator=function(e){this.columnHeaderHeight=0/0;var t=this.getViewportWidth(),n=this.instance.wtScrollbars.horizontal.getScrollPosition()-this.instance.wtScrollbars.vertical.getTableParentOffset();0>n&&(n=0);var o=this.instance.getSetting("fixedColumnsLeft");if(o){var r=this.instance.wtScrollbars.horizontal.sumCellSizes(0,o);n+=r,t-=r}var i=this;return new A(t,n,this.instance.getSetting("totalColumns"),function(e){return i.instance.wtTable.getColumnWidth(e)},e?null:this.instance.wtSettings.settings.viewportColumnCalculatorOverride,e?!0:!1,this.instance.getSetting("stretchH"))},D.prototype.createRenderCalculators=function(e){if(e){var t=this.createRowsCalculator(!0),n=this.createColumnsCalculator(!0);this.areAllProposedVisibleRowsAlreadyRendered(t)&&this.areAllProposedVisibleColumnsAlreadyRendered(n)||(e=!1)}return e||(this.rowsRenderCalculator=this.createRowsCalculator(),this.columnsRenderCalculator=this.createColumnsCalculator()),this.rowsVisibleCalculator=null,this.columnsVisibleCalculator=null,e},D.prototype.createVisibleCalculators=function(){this.rowsVisibleCalculator=this.createRowsCalculator(!0),this.columnsVisibleCalculator=this.createColumnsCalculator(!0)},D.prototype.areAllProposedVisibleRowsAlreadyRendered=function(e){return this.rowsVisibleCalculator?e.startRow<this.rowsRenderCalculator.startRow||e.startRow===this.rowsRenderCalculator.startRow&&e.startRow>0?!1:e.endRow>this.rowsRenderCalculator.endRow||e.endRow===this.rowsRenderCalculator.endRow&&e.endRow<this.instance.getSetting("totalRows")-1?!1:!0:!1},D.prototype.areAllProposedVisibleColumnsAlreadyRendered=function(e){return this.columnsVisibleCalculator?e.startColumn<this.columnsRenderCalculator.startColumn||e.startColumn===this.columnsRenderCalculator.startColumn&&e.startColumn>0?!1:e.endColumn>this.columnsRenderCalculator.endColumn||e.endColumn===this.columnsRenderCalculator.endColumn&&e.endColumn<this.instance.getSetting("totalColumns")-1?!1:!0:!1},e.jQuery&&!function(e,t,n){t.fn.handsontable=function(e){var t,o,r,i,s,a=this.first(),l=a.data("handsontable");if("string"!=typeof e)return s=e||{},l?l.updateSettings(s):(l=new n.Core(a[0],s),a.data("handsontable",l),l.init()),a;if(r=[],arguments.length>1)for(t=1,o=arguments.length;o>t;t++)r.push(arguments[t]);if(l){if("undefined"==typeof l[e])throw new Error("Handsontable do not provide action: "+e);i=l[e].apply(l,r),"destroy"===e&&a.removeData()}return i}}(e,jQuery,t)}(window,Handsontable),function(){function e(e){this._value=e}function t(e,t,n,o){var r,i,s=Math.pow(10,t);return i=(n(e*s)/s).toFixed(t),o&&(r=new RegExp("0{1,"+o+"}$"),i=i.replace(r,"")),i}function n(e,t,n){var o;return o=t.indexOf("$")>-1?r(e,t,n):t.indexOf("%")>-1?i(e,t,n):t.indexOf(":")>-1?s(e,t):l(e._value,t,n)}function o(e,t){var n,o,r,i,s,l=t,c=["KB","MB","GB","TB","PB","EB","ZB","YB"],u=!1;if(t.indexOf(":")>-1)e._value=a(t);else if(t===g)e._value=0;else{for("."!==p[m].delimiters.decimal&&(t=t.replace(/\./g,"").replace(p[m].delimiters.decimal,".")),n=new RegExp("[^a-zA-Z]"+p[m].abbreviations.thousand+"(?:\\)|(\\"+p[m].currency.symbol+")?(?:\\))?)?$"),o=new RegExp("[^a-zA-Z]"+p[m].abbreviations.million+"(?:\\)|(\\"+p[m].currency.symbol+")?(?:\\))?)?$"),r=new RegExp("[^a-zA-Z]"+p[m].abbreviations.billion+"(?:\\)|(\\"+p[m].currency.symbol+")?(?:\\))?)?$"),i=new RegExp("[^a-zA-Z]"+p[m].abbreviations.trillion+"(?:\\)|(\\"+p[m].currency.symbol+")?(?:\\))?)?$"),s=0;s<=c.length&&!(u=t.indexOf(c[s])>-1?Math.pow(1024,s+1):!1);s++);e._value=(u?u:1)*(l.match(n)?Math.pow(10,3):1)*(l.match(o)?Math.pow(10,6):1)*(l.match(r)?Math.pow(10,9):1)*(l.match(i)?Math.pow(10,12):1)*(t.indexOf("%")>-1?.01:1)*((t.split("-").length+Math.min(t.split("(").length-1,t.split(")").length-1))%2?1:-1)*Number(t.replace(/[^0-9\.]+/g,"")),e._value=u?Math.ceil(e._value):e._value
}return e._value}function r(e,t,n){var o,r,i=t.indexOf("$"),s=t.indexOf("("),a=t.indexOf("-"),c="";return t.indexOf(" $")>-1?(c=" ",t=t.replace(" $","")):t.indexOf("$ ")>-1?(c=" ",t=t.replace("$ ","")):t=t.replace("$",""),r=l(e._value,t,n),1>=i?r.indexOf("(")>-1||r.indexOf("-")>-1?(r=r.split(""),o=1,(s>i||a>i)&&(o=0),r.splice(o,0,p[m].currency.symbol+c),r=r.join("")):r=p[m].currency.symbol+c+r:r.indexOf(")")>-1?(r=r.split(""),r.splice(-1,0,c+p[m].currency.symbol),r=r.join("")):r=r+c+p[m].currency.symbol,r}function i(e,t,n){var o,r="",i=100*e._value;return t.indexOf(" %")>-1?(r=" ",t=t.replace(" %","")):t=t.replace("%",""),o=l(i,t,n),o.indexOf(")")>-1?(o=o.split(""),o.splice(-1,0,r+"%"),o=o.join("")):o=o+r+"%",o}function s(e){var t=Math.floor(e._value/60/60),n=Math.floor((e._value-60*t*60)/60),o=Math.round(e._value-60*t*60-60*n);return t+":"+(10>n?"0"+n:n)+":"+(10>o?"0"+o:o)}function a(e){var t=e.split(":"),n=0;return 3===t.length?(n+=60*Number(t[0])*60,n+=60*Number(t[1]),n+=Number(t[2])):2===t.length&&(n+=60*Number(t[0]),n+=Number(t[1])),Number(n)}function l(e,n,o){var r,i,s,a,l,c,u=!1,d=!1,h=!1,f="",v=!1,w=!1,y=!1,C=!1,b=!1,R="",T="",S=Math.abs(e),E=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],_="",k=!1;if(0===e&&null!==g)return g;if(n.indexOf("(")>-1?(u=!0,n=n.slice(1,-1)):n.indexOf("+")>-1&&(d=!0,n=n.replace(/\+/g,"")),n.indexOf("a")>-1&&(v=n.indexOf("aK")>=0,w=n.indexOf("aM")>=0,y=n.indexOf("aB")>=0,C=n.indexOf("aT")>=0,b=v||w||y||C,n.indexOf(" a")>-1?(f=" ",n=n.replace(" a","")):n=n.replace("a",""),S>=Math.pow(10,12)&&!b||C?(f+=p[m].abbreviations.trillion,e/=Math.pow(10,12)):S<Math.pow(10,12)&&S>=Math.pow(10,9)&&!b||y?(f+=p[m].abbreviations.billion,e/=Math.pow(10,9)):S<Math.pow(10,9)&&S>=Math.pow(10,6)&&!b||w?(f+=p[m].abbreviations.million,e/=Math.pow(10,6)):(S<Math.pow(10,6)&&S>=Math.pow(10,3)&&!b||v)&&(f+=p[m].abbreviations.thousand,e/=Math.pow(10,3))),n.indexOf("b")>-1)for(n.indexOf(" b")>-1?(R=" ",n=n.replace(" b","")):n=n.replace("b",""),s=0;s<=E.length;s++)if(r=Math.pow(1024,s),i=Math.pow(1024,s+1),e>=r&&i>e){R+=E[s],r>0&&(e/=r);break}return n.indexOf("o")>-1&&(n.indexOf(" o")>-1?(T=" ",n=n.replace(" o","")):n=n.replace("o",""),T+=p[m].ordinal(e)),n.indexOf("[.]")>-1&&(h=!0,n=n.replace("[.]",".")),a=e.toString().split(".")[0],l=n.split(".")[1],c=n.indexOf(","),l?(l.indexOf("[")>-1?(l=l.replace("]",""),l=l.split("["),_=t(e,l[0].length+l[1].length,o,l[1].length)):_=t(e,l.length,o),a=_.split(".")[0],_=_.split(".")[1].length?p[m].delimiters.decimal+_.split(".")[1]:"",h&&0===Number(_.slice(1))&&(_="")):a=t(e,null,o),a.indexOf("-")>-1&&(a=a.slice(1),k=!0),c>-1&&(a=a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+p[m].delimiters.thousands)),0===n.indexOf(".")&&(a=""),(u&&k?"(":"")+(!u&&k?"-":"")+(!k&&d?"+":"")+a+_+(T?T:"")+(f?f:"")+(R?R:"")+(u&&k?")":"")}function c(e,t){p[e]=t}function u(e){var t=e.toString().split(".");return t.length<2?1:Math.pow(10,t[1].length)}function d(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,t){var n=u(e),o=u(t);return n>o?n:o},-1/0)}var h,f="1.5.3",p={},m="en",g=null,v="0,0",w="undefined"!=typeof module&&module.exports;h=function(t){return h.isNumeral(t)?t=t.value():0===t||"undefined"==typeof t?t=0:Number(t)||(t=h.fn.unformat(t)),new e(Number(t))},h.version=f,h.isNumeral=function(t){return t instanceof e},h.language=function(e,t){if(!e)return m;if(e=e.toLowerCase(),e&&!t){if(!p[e])throw new Error("Unknown language : "+e);m=e}return(t||!p[e])&&c(e,t),h},h.languageData=function(e){if(!e)return p[m];if(!p[e])throw new Error("Unknown language : "+e);return p[e]},h.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){var t=e%10;return 1===~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th"},currency:{symbol:"$"}}),h.zeroFormat=function(e){g="string"==typeof e?e:null},h.defaultFormat=function(e){v="string"==typeof e?e:"0.0"},h.validate=function(e,t){var n,o,r,i,s,a,l,c;if("string"!=typeof e&&(e+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",e)),e=e.trim(),""===e)return!1;e=e.replace(/^[+-]?/,"");try{l=h.languageData(t)}catch(u){l=h.languageData(h.language())}return r=l.currency.symbol,s=l.abbreviations,n=l.delimiters.decimal,o="."===l.delimiters.thousands?"\\.":l.delimiters.thousands,c=e.match(/^[^\d]+/),null!==c&&(e=e.substr(1),c[0]!==r)?!1:(c=e.match(/[^\d]+$/),null!==c&&(e=e.slice(0,-1),c[0]!==s.thousand&&c[0]!==s.million&&c[0]!==s.billion&&c[0]!==s.trillion)?!1:e.match(/^\d+$/)?!0:(a=new RegExp(o+"{2}"),e.match(/[^\d.,]/g)?!1:(i=e.split(n),i.length>2?!1:i.length<2?!!i[0].match(/^\d+.*\d$/)&&!i[0].match(a):1===i[0].length?!!i[0].match(/^\d+$/)&&!i[0].match(a)&&!!i[1].match(/^\d+$/):!!i[0].match(/^\d+.*\d$/)&&!i[0].match(a)&&!!i[1].match(/^\d+$/))))},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var n,o,r=this.length>>>0,i=!1;for(1<arguments.length&&(o=t,i=!0),n=0;r>n;++n)this.hasOwnProperty(n)&&(i?o=e(o,this[n],n,this):(o=this[n],i=!0));if(!i)throw new TypeError("Reduce of empty array with no initial value");return o}),h.fn=e.prototype={clone:function(){return h(this)},format:function(e,t){return n(this,e?e:v,void 0!==t?t:Math.round)},unformat:function(e){return"[object Number]"===Object.prototype.toString.call(e)?e:o(this,e?e:v)},value:function(){return this._value},valueOf:function(){return this._value},set:function(e){return this._value=Number(e),this},add:function(e){function t(e,t){return e+n*t}var n=d.call(null,this._value,e);return this._value=[this._value,e].reduce(t,0)/n,this},subtract:function(e){function t(e,t){return e-n*t}var n=d.call(null,this._value,e);return this._value=[e].reduce(t,this._value*n)/n,this},multiply:function(e){function t(e,t){var n=d(e,t);return e*n*t*n/(n*n)}return this._value=[this._value,e].reduce(t,1),this},divide:function(e){function t(e,t){var n=d(e,t);return e*n/(t*n)}return this._value=[this._value,e].reduce(t),this},difference:function(e){return Math.abs(h(this._value).subtract(e).value())}},w&&(module.exports=h),"undefined"==typeof ender&&(this.numeral=h),"function"==typeof define&&define.amd&&define([],function(){return h})}.call(this),Rumali.plugins=function(){var e,t=function(){var e=document.createElement("div");e.setAttribute("id","rumali_loading_overlay"),e.style.display="none",document.body.insertBefore(e,document.getElementById("navbar_default"));var t=document.createElement("div");t.className="rumali-loading-text",t.innerHTML="Loading..",document.getElementById("rumali_loading_overlay").appendChild(t),$(document).ajaxStart(function(){e.style.opacity=1,e.style.display="block"}),$(document).ajaxStop(function(){e.style.opacity=0,setTimeout(function(){e.style.display="none"},250)})};t(),this.rumiLocales={getPossibleColumnOperations:function(){var e={string:[{name:"Change to Uppercase",id:"uppercase"},{name:"Change to Lowercase",id:"lowercase"},{name:"Capitalize first letter",id:"titlecase"},{name:"divider",id:"divider"},{name:"Remove spaces before and after data",id:"trim"},{name:"Collapse consecutive white spaces",id:"whitespace"},{name:"divider",id:"divider"},{name:"Remove Character",id:"removechar"},{name:"Replace",id:"mergetoclean"}],"boolean":[],integer:[],"double":[],date:[]};return e}},$(document).on("click","#filter_toggle",function(){var t=$("#filter_toggle :checked").attr("value");if(t==e)return!1;if(e=t,Rumali.gridoperation.getSelectedColumnIndex()!==!1)var n,o=Rumali.gridoperation.getSelectedColumnIndex(),r=self.column_datatype[o+1];else var r=selected_datatype;switch(n="integer"==r||"double"==r?"range":"value"){case"value":break;case"range":var i=parseFloat($("#min_value").val()),s=parseFloat($("#max_value").val()),a=$("#filter_toggle :checked").val();Rumali.executeAfterRangeFilter(),global_brush.extent([i,s]),brush.call(global_brush),"in"==a?pyk_histogram.addFilter([[{column_name:new_column_name,condition_type:"range",condition:{min:i,max:s,not:!1},override_filter:!0,next:"AND"}]],!0,!0):pyk_histogram.addFilter([[{column_name:new_column_name,condition_type:"range",condition:{min:i,max:s,not:!0},override_filter:!0,next:"AND"}]],!0,!0)}}),this.toTitleCase=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}};var that,PYKMODEL,grid,new_column_name,new_column_value_index,data_distribution;Rumali.pykGrid=function(){var e=!1;this.appendGrid=function(t,n){function o(e,t,n,o,r,i,s){if("integer"==self.column_datatype[o+1]||"double"==self.column_datatype[o+1]?Handsontable.NumericCell.renderer.apply(this,arguments):"boolean"==self.column_datatype[o+1]?Handsontable.CheckboxCell.renderer.apply(this,arguments):Handsontable.TextCell.renderer.apply(this,arguments),0>=n){s.format="",Handsontable.TextCell.renderer.apply(this,arguments);{self.original_column_names[o+1]}$(t).removeClass("htInvalid"),$(t).addClass("hover-tootip"),t.style.fontWeight="bold",t.style.color="#1B668B",t.style.background="#f0f0f0"}else n%2!=0&&$("#highlight-row").hasClass("check")&&(t.style.background="#A9F5A9");$("#highlight-cell").hasClass("check")&&(""==i||null==i||void 0==i)&&(t.style.background="#F5A9A9")}Rumali.gridoperation.isChecked=!1,$container=$("#grid_show"),$("#grid_show").height(700),"map"==data_store_action_name&&$("#grid_show").height(150);!gon.mode;$("#grid_show").handsontable({data:self.json_data,rowHeaders:!0,colHeaders:!0,fixedRowsTop:1,readOnly:!0,manualColumnMove:!0,stretchH:"all",outsideClickDeselects:!1,afterValidate:function(){},afterSelectionEnd:function(o,r,i,s){var a=$container.handsontable("getInstance");0==o&&i==self.json_data.length-1?(a.updateSettings({contextMenu:t}),e=!0):0==r&&s==self.column_datatype.length-2?(a.updateSettings({contextMenu:n}),e=!0):1==e&&(a.updateSettings({contextMenu:!1}),e=!1)},afterCreateRow:function(e){self.json_data[e].push(null)},contextMenu:!1,myPlugin:!1,cells:function(){return{renderer:o}}});var r=!1;Rumali.gridoperation.showFilterCount();var i=$container.handsontable("getInstance");i.addHook("afterOnCellMouseDown",function(e,t){if(-1==t.row&&-1!=t.col&&0==e.button){var n=$("#grid_show").handsontable("getSelected")[1],o=self.columns_header[n+1];new_column_name=o,new_column_value_index=n,Rumali.gridoperation.columnHeaderSelected(t.col),Rumali.gridoperation.getAzaxcall(),r=!0}else r&&Rumali.gridoperation.columnHeaderDeselected()}),i.addHook("afterColumnMove",function(e,t){var n=self.columns_header[e+1],o=self.columns_header[t],r={};r.column_name=n,r.after=o,Rumali.api.postAjaxcall(r,"/column/move")}),i.addHook("beforeChange",function(e){return e.length>1?(alert("Multiple cell editing is not allowed"),!1):void 0}),i.addHook("afterChange",function(e,t){if(null==e||"loadData"==t)return!1;var n=e[0][0],o=e[0][1],r=e[0][2],i=e[0][3];if(r!=i)if(null==self.json_data[n][0]){if(""==i)return!1;for(var s={},a=self.json_data[n],l=a.length,c=0;l>c;c++)null==a[c]&&(a[c]="");console.log(a),s.data=a,s.token=gon.token,Rumali.api.rowAddApiCall(s,function(e){self.json_data[n][0]=e.id},function(){self.json_data[n][0]=null,self.json_data[n][o]=null})}else{var u,s={};0==n?(u="column/change_name",s.new_original_column_name=i,s.column_name=self.columns_header[o]):(u="cell/update",s.row_id=self.json_data[n][0],s.value=i,s.column_name=self.columns_header[o]),console.log(i,"new"),console.log(r,"old"),s.token=gon.token,Rumali.api.columnAndCellChangeApiCall(s,u,function(e){if(0==n){divg1.changeColumnName(r,e.column_name),self.json_data[n][o]=e.column_name,$container.handsontable("render");var t=new Rumali.categorizeColumns;t.init()}},function(){self.json_data[n][o]=r,0==n&&($container.handsontable("render"),$container.handsontable("selectCell",n,o-1),alert("column name change failed"))})}}),i.addHook("beforeRemoveRow",function(e,t){for(var n=[],o={};t>0;)n.push(self.json_data[e][0]),t--,e++;o.row_id=n,o.token=gon.token,Rumali.api.rowDeleteApiCall(o)}),i.addHook("afterOnCellMouseDown",function(e,t){-1!=t.row&&Rumali.gridoperation.columnHeaderDeselected()})},this.getShowPage=function(){function e(){self.column_datatype=Rumali.gridoperation.changeToColumnsType(self.column_datatype);var e=$("#grid_show").handsontable("getInstance");columns=Rumali.gridoperation.getColumnsWithType(self.column_datatype),e.updateSettings({data:self.json_data,columns:columns}),Rumali.gridoperation.getAzaxcall()}function t(){o+=1,2==o&&(e(),o=0)}var n={},o=0;grid_show.executeOnFilter=function(){json_data=grid_show.flushToGet(),void 0!=json_data&&(self.json_data=json_data.data,t())};try{grid_show.call()}catch(r){console.log(r)}try{grid_columns.call()}catch(r){console.log(r+"error in pagination count not available")}n.original_names=!0,n.data_types=!0,n.token=gon.token,n.sub_types=!0,Rumali.api.originalColumnName(n,function(e){self.column_datatype=e,t()})}},Rumali.pykgrid=new Rumali.pykGrid,Rumali.histogram=function(e,t,n,o,r){function i(){brush_extent=d3.event.target.extent(),o=brush_extent[0],r=brush_extent[1],r!=o&&a(r,o)}var s=5;o||(o=0,$("#min_value").val("Min")),r||(r=0,$("#max_value").val("Max")),$("#histogram-chart").empty();var a=function(t,n){new_column_name=e,$("#filter_toggle").show(),Rumali.executeAfterHistogramFilter();var o=$("#min_value").attr("data-prev_val"),r=$("#max_value").attr("data-prev_val"),i=parseFloat(n).toFixed(2),s=parseFloat(t).toFixed(2);if($("#min_value").val(i),$("#max_value").val(s),$("#min_value").attr("data-prev_val",i),$("#max_value").attr("data-prev_val",s),o!=i||r!=s){var a=$("#filter_toggle :checked").val(),l=!1;"notin"==a&&(l=!0),pyk_histogram.addFilter([[{column_name:new_column_name,condition_type:"range",condition:{min:n,max:t,not:l},override_filter:!0,next:"AND"}]],!0,!0)}};if("integer"===t||"double"===t){$("#histogram-chart").show(),$("#histogram-chart").html("<span style='float:left'><h5 style='margin-top: 0px; font-size: 14px; padding-top: 0px;'>Filter by value</h5></span><a id='reset'><u>Reset</u></a>");var l=[];for(var c in n)c&&!isNaN(c)&&"undefined"!==c&&l.push({key:parseFloat(c),value:parseInt(n[c],10)});var u=d3.extent(l,function(e){return e.key}),d=u[0],h=u[1]+parseFloat(((u[1]-u[0])/10).toFixed(2)),f=(u[1]-u[0])/s,p=[],m=u[0],g=u[0]+f,v=u[0]-1,w=0;0==o||0==r?($("#min_value").val(parseFloat(d).toFixed(2)),$("#min_value").attr("data-val",parseFloat(d).toFixed(2)),$("#max_value").val(parseFloat(h).toFixed(2)),$("#max_value").attr("data-val",parseFloat(h).toFixed(2)),$("#filter_toggle").hide(),$("#min_value").attr("placeholder",parseFloat(d).toFixed(2)),$("#max_value").attr("placeholder",parseFloat(h).toFixed(2))):($("#min_value").val(parseFloat(o).toFixed(2)),$("#max_value").val(parseFloat(r).toFixed(2)),$("#filter_toggle").show());for(var y=0;s>y;y++)w=l.filter(function(e){return e.key<=g&&e.key>v}),p.push({key:m,value:d3.sum(w,function(e){return e.value})}),v=g,g+=f,m+=f;var C=d3.extent(p,function(e){return e.value}),b=parseFloat(((C[1]-C[0])/10).toFixed(2)),R=0,T=C[1]+b,S=d3.format(",.0f"),E={top:10,right:20,bottom:30,left:10},_=250-E.left-E.right,k=120-E.top-E.bottom,x=d3.scale.linear().domain([d,h]).range([0,_]),D=d3.scale.linear().domain([R,T]).range([k,0]),A=d3.svg.axis().scale(x).ticks(3).orient("bottom");svg=d3.select("#histogram-chart").append("svg").attr("width",_+E.left+E.right).attr("height",k+E.top+E.bottom).append("g").attr("transform","translate("+E.left+","+E.top+")");var H=svg.selectAll(".bar").data(p).enter().append("g").attr("class","bar").attr("transform",function(e){return"translate("+x(e.key)+","+D(e.value)+")"});H.append("rect").attr("x",1).attr("width",_/(s+1)).attr("height",function(e){return k-D(e.value)}),H.append("text").attr("dy",".75em").attr("y",-12).attr("x",_/s/2).attr("text-anchor","middle").text(function(e){return S(e.value)}),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").call(A);var O=d,P=h;o&&o>0?(O=o,P=r):(O=0,P=0),global_brush=d3.svg.brush().x(x).extent([O,P]).on("brushend",i),brush=svg.append("g").attr("class","brush").call(global_brush),brush.selectAll("rect").attr("height",k);var N=function(e){var t=+("e"==e),n=t?1:-1,o=k/3;return"M"+.5*n+","+o+"A6,6 0 0 "+t+" "+6.5*n+","+(o+6)+"V"+(2*o-6)+"A6,6 0 0 "+t+" "+.5*n+","+2*o+"ZM"+2.5*n+","+(o+8)+"V"+(2*o-8)+"M"+4.5*n+","+(o+8)+"V"+(2*o-8)};brush.selectAll(".resize").append("path").attr("d",N),$("#pyk_histogram").show(),$("#histogram_min_max").show(),$("#merge").hide()}else if("date"===t){return!1;var l,c,u,d,h,f,p,m,g,v,w,y,C,b,R,T,S,E,_,k,x,D,A,H,N}else $("#histogram_min_max").hide()};var check_histogram_min_max_values=function(){var e=parseFloat($("#min_value").attr("data-val")),t=parseFloat($("#max_value").attr("data-val")),n=parseFloat($("#min_value").attr("data-prev_val")),o=parseFloat($("#max_value").attr("data-prev_val")),r=parseFloat($("#min_value").val()),i=parseFloat($("#max_value").val());if($("#min_value").attr("data-prev_val",r),$("#max_value").attr("data-prev_val",i),(n!=r||o!=i)&&t>r&&r>=e&&i>e&&t>=i&&i>r){var s=$("#filter_toggle :checked").val(),a=!1;"notin"==s&&(a=!0),Rumali.executeAfterHistogramFilter(r,i),pyk_histogram.addFilter([[{column_name:new_column_name,condition_type:"range",condition:{min:r,max:i,not:a},override_filter:!0,next:"AND"}]],!0,!0)}};Rumali.sidebarHistogram=function(){$(document).on("blur",".histogram-val",function(){$("#filter_toggle").show(),check_histogram_min_max_values()})},$(document).on("click","#reset",function(){d3.select("rect.extent").attr("x",0).attr("width",0),d3.selectAll("g.resize").style("display","none"),divg1.destroyColumn(new_column_name),Rumali.gridoperation.showFilterCount()}),Rumali.sidebarUnique=function(){function e(e,t){var n=$("#"+t);n.find("tr").each(function(t,n){var o=$(n).find("td");if(o.length>0){var r=!1;o.each(function(t,n){var o=new RegExp(e,"i");return o.test($(n).text())?(r=!0,!1):void 0}),n.style.display=1==r?"block":"none"}})}$(document).on("click",".sort-unique",function(e){var t=$(this).attr("id");$("#dropdownsortvalue").html("Sort Value by "+Rumali.plugin.toTitleCase(t)+" <span class='caret'></span>"),Rumali.countUniqueValues(data_distribution,t),Rumali.gridoperation.resetFilterElements(),e.preventDefault()}),$(document).on("click",".sort-unique-modal",function(e){var t=$(this).attr("id");$("#dropdownsortvalue_modal").html("Sort Value by "+Rumali.plugin.toTitleCase(t)+" <span class='caret'></span>"),Rumali.countUniqueValuesOnModal(data_distribution,t),Rumali.gridoperation.resetFilterElements(),e.preventDefault()}),Rumali.countUniqueValues=function(e,t,n,o){if(Rumali.gridoperation.getSelectedColumnIndex()!==!1)var r=Rumali.gridoperation.getSelectedColumnIndex(),s=self.column_datatype[r+1],a=new_column_name;else{var s=o,a=n;new_column_name=n}var l,c=[],u="<table class='table table-condensed' id ='unique_values' >";Rumali.countUniqueValuesOnModal(e,t),c="name"==t?Object.keys(e).sort():Object.keys(e).sort(function(t,n){return e[n]-e[t]}),$("#grid_unique_values").empty(),$("#unique-values").empty();for(i in c)l=c[i],"t"==l?l="true":"f"==l&&(l="false"),u+="<tr>",u+="<td style='border: none; padding-top: 0px; padding-bottom: 0px; width: 10px;'>",u+="<input type='checkbox'  data-id ='"+a+c[i]+"' class='check-value' value='"+c[i]+"' /></td>",u+="<td style='font-size: 12px; border: none; padding-top: 0px; padding-bottom: 0px;'>"+l,u+="</td><td style='font-weight: bold; border: none; padding-top: 0px; padding-bottom: 0px;'>"+e[c[i]]+"</td></tr>";u+="</table>",$("#unique-values").append(Object.keys(e).length+" Unique value"),$("#unique-values").show(),$("#grid_unique_values").append(u),("string"==s||"date"==s)&&$("#merge").show()},Rumali.countUniqueValuesOnModal=function(e,t){var n=[],o=new_column_name,r="<table class='table table-condensed' id='unique-values-modal'>";n="name"==t?Object.keys(e).sort():Object.keys(e).sort(function(t,n){return e[n]-e[t]}),$("#unique_value_formodal").empty();for(i in n)r+="<tr>",r+="<td style='border: none; padding-top: 0px; padding-bottom: 0px; width: 10px;'>",r+="<input type='checkbox'  data-id ='"+o+n[i]+"' class='modal-check-value' value='"+n[i]+"' /></td>",r+="<td style='font-size: 12px; border: none; padding-top: 0px; padding-bottom: 0px;'>"+n[i],r+="</td><td style='font-weight: bold; border: none; padding-top: 0px; padding-bottom: 0px;'>"+e[n[i]]+"</td></tr>";r+="</table>",$("#unique_value_formodal").append(r)},$(document).on("click",".check-value",function(){var e=[],t=[],n=$("#filter_toggle :checked").val();e.push($(this).val()),col_name=new_column_name,$(".check-value:checked").each(function(){t.push($(this).val())}),Rumali.executeAfterUniquevalueFilter(),"in"==n?column_values_filter.addFilter([[{column_name:col_name,condition_type:"values","in":e,next:"AND",selected_dom_id:$(this).attr("data-id")}]],!0,!0):column_values_filter.addFilter([[{column_name:col_name,condition_type:"values",not_in:e,next:"AND",selected_dom_id:$(this).attr("data-id")}]],!0,!0)}),$("#search_box").keyup(function(){e($(this).val(),"unique_values")}),$("#search_box_modal").keyup(function(){e($(this).val(),"unique-values-modal")})},Rumali.object={value_change:{positive:1,negative:2,no_change:0},datacast_url:rumi_api_endpoint+"datacast/"},Rumali.utility=function(){var e=function(e,t,n){$.getJSON(e).done(function(e){n(e,t)})},t=function(e){var t='<span class="col-sm-12">';return t+=e,t+="</span>"},n=function(e,t,n){$.getJSON(e).done(function(e){n(e,gon.selected_year,gon.selected_quarter)})},o=function(e){var t=e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return t},r=function(e){return 1===e?"positive_value_css":2===e?"negative_value_css":""},s=function(e,t){var n=(+t/(+e-+t)*100).toFixed(2);return n+="% change from the previous month."},a=function(e){var t=e;return t+="% change from the previous month."},l=function(e,t,n){$.getJSON(e).done(function(e){n(e,t)})},c=function(e,t,n){var o,r,i;return o=u(e,t),i=o.length,r=i>=5?f(n,o,i):p(n,o,i)},u=function(e,t){var n=[];return n=_.map(e,function(e){return e[t]}),n=_.uniq(n)},d=function(e,t,n){var o=[];return o=_.filter(e,function(e){return e[t]===n})},h=function(e,t){var n="";n+="<h2 class = chart_header>"+e+"</h2>",$(t).html(n)},f=function(e,t,n){var o="<select id="+e+' class="filter">';for(i=0;i<n;i++)o+='<option value="'+t[i]+'">'+t[i];return o+="</select>"},p=function(e,t,n){var o="<select id="+e+' class="filter">';for(i=0;i<n;i++)o+='<option value="'+t[i]+'">'+t[i];return o+="</select>"};return{getJSONForCard:e,renderHTMLforTableTitle:t,getJSON:n,applyConditionalFormatting:o,applyConditionalCssPositiveOrNegative:r,calculateChangeFromPreviousValue:s,getJSONforTable:l,tooltipLayout:a,renderFilter:c,findDistinct:u,filterData:d,setHTMLheaderForChart:h,smallDropDown:f,largeDropDown:p}}(),Rumali.autoCharts=function(){var e={},t={},n={},o={},r=Rumali.utility,i=Rumali.object,s="",a=2012;e.onelayer=[];var l=function(){e.charts=$(".d3-pykcharts"),t.content=$(".top_digital_objects"),n.cards=$(".card_with_value"),o.tables=$(".box_table");var s=e.charts.length,a=0,l=n.cards.length,v=o.tables.length;for(e.year_no=gon.selected_year,e.quarter_no=gon.selected_quarter,m(),g();s>a;a++){var w=e.charts[a].dataset.api;switch(w){case"PykCharts.oneD.pie":c(e.charts[a],e.year_no,e.quarter_no);break;case"PykCharts.multiD.column":u(e.charts[a],e.year_no,e.quarter_no);break;case"PykCharts.multiD.groupedColumn":d(e.charts[a],e.year_no,e.quarter_no);break;case"PykCharts.multiD.multiSeriesLine":h(e.charts[a]);break;case"PykCharts.maps.oneLayer":f(e.charts[a],e.year_no,e.quarter_no)}}for(a=0;l>a;a++){var b=n.cards[a].id;r.getJSONForCard(i.datacast_url+n.cards[a].dataset.datacast_identifier,b,y)}for(a=0;v>a;a++){var b=o.tables[a].id;r.getJSONforTable(i.datacast_url+o.tables[a].dataset.datacast_identifier,b,C)}p(t.content[0],e.year_no,e.quarter_no)},c=function(t,n,o){var s="#"+$(t).attr("id"),a=function(n){e.onedpie||(e.onedpie=n),n.length<=0?v($(t).attr("id")):w($(t).attr("id")),l(n)},l=function(e){var t={selector:s,data:e,chart_width:400,export_enable:"no",tooltip_enable:"yes"},n=new PykCharts.oneD.pie(t);n.execute()};e.onedpie?a(e.onedpie,n,o):r.getJSON(i.datacast_url+t.dataset.datacast_identifier,this,a)},u=function(t,n,o){var s="#"+$(t).attr("id"),a=function(n){e.multidcol||(e.multidcol=n),n.length<=0?v($(t).attr("id")):w($(t).attr("id")),l(n)},l=function(e){var t={selector:s,data:e,export_enable:"no",axis_x_pointer_position:"bottom",tooltip_enable:"yes",chart_width:400},n=new PykCharts.multiD.column(t);n.execute()};e.multidcol?a(e.multidcol,n,o):r.getJSON(i.datacast_url+t.dataset.datacast_identifier,this,a)},d=function(t,n,o){var s,a="#"+$(t).attr("id"),l=function(n,o){e.multidgroupcol||(e.multidgroupcol=n),s=_.filter(e.multidgroupcol,function(e){return e.year==o}),s.length<=0?v($(t).attr("id")):w($(t).attr("id")),c(s)},c=function(e){var t={selector:a,data:e,export_enable:"no",axis_x_pointer_position:"bottom",tooltip_enable:"yes"},n=new PykCharts.multiD.groupedColumn(t);n.execute()};e.multidgroupcol?l(e.multidcol,n,o):r.getJSON(i.datacast_url+t.dataset.datacast_identifier,this,l)},h=function(e){var t,n="#"+$(e).attr("id"),o=function(n){a=gon.selected_year,s||(s=n),t=_.filter(s,function(e){return+e.year===a||+e.year===a-1}),t.length<=0?v($(e).attr("id")):w($(e).attr("id")),i(t)},i=function(e){var t={selector:n,data:e,chart_color:["#B0E2FF","#60AFFE"],data_sort_enable:"no",axis_x_time_value_datatype:"month"},o=new PykCharts.multiD.multiSeriesLine(t);o.execute()};s?o(s):r.getJSON(rumi_api_endpoint+"datacast/"+e.dataset.datacast_identifier,this,o)},f=function(t,n,o){var s,a="#"+$(t).attr("id"),l=function(n,o,r){for(e.maps||(e.maps=n);o>=gon.selected_year&&r>gon.selected_quarter;)r--,0>r&&(o--,r=gon.selected_quarter);e.year_no=o,e.quarter_no=r,s="Q"+r,e.onelayer[o]||(e.onelayer[o]=[]),e.onelayer[o][r]||(e.onelayer[o][r]={},filter_data=_.filter(e.maps,function(e){return e.year==o&&e.quarter==s}),filter_data=_.sortBy(filter_data,function(e){return-1*parseInt(e.size)}),filter_data=_.first(filter_data,25),e.onelayer[o][r]=filter_data),e.onelayer[o][r].length<=0?v($(t).attr("id")):w($(t).attr("id")),c(e.onelayer[o][r])},c=function(e){var t={selector:a,data:e,export_enable:"no",map_code:"world",chart_height:"700",chart_width:"1000",tooltip_enable:"yes",default_color:["#E4E4E4"],saturation_color:"#255AEE",color_mode:"saturation"},n=new PykCharts.maps.oneLayer(t);n.execute()};e.maps?l(e.maps,n,o):r.getJSON(i.datacast_url+t.dataset.datacast_identifier,this,l)},p=function(n,o,s){var a,l,c="#"+$(n).attr("id"),u=function(n,o,r){for(t.top10digital||(t.top10digital=n);o>=gon.selected_year&&r>gon.selected_quarter;)r--,0>r&&(o--,r=gon.selected_quarter);e.year_no=o,e.quarter_no=r,a="Q"+r,l=_.filter(t.top10digital,function(e){return e.year==o&&e.quarter==a}),l=_.sortBy(l,function(e){return-1*parseInt(e.value)}),l=_.first(l,10),d(l)},d=function(e){var t=0,n=0,o="";for(n=e.length>10?10:e.length,t=0;n>t;t++)o+=h(e[t],t);$(c).html(o)},h=function(e,t){var n="";return n+='<span class = "col-sm-6 ten_digital">',n+="<span class= col-sm-3>",n+="<a class=pull-left href="+e.title_url+' target="_blank">',n+="<img src="+e.image_url+' class="ten_digital_image">',n+="</a></span>",n+="<span class=col-sm-9>",n+="<span class=col-sm-12><b>",n+=t+1+".",n+="</b></span>",n+="<span class=col-sm-12>",n+="<a href="+e.title_url+' target="_blank">',n+=e.title,n+="</a>",n+="</span>",n+="<span class=col-sm-12><b>",n+=e.value+" views",n+="</b></span></span></span>"};t.top10digital?u(t.top10digital,o,s):r.getJSON(i.datacast_url+n.dataset.datacast_identifier,this,u)},m=function(){for(var e=2012,t=gon.selected_year,n="",o=e;t>=o;o++)n=n+"<span id = id_year_filters_yearno_"+o+' onclick="Rumali.autoCharts.filterDataYear('+o+')">'+o+"</span>";document.getElementById("id_year_filters").innerHTML=n},g=function(){var e="";e='<span id = id_quarter_filters_quarterno_1 onclick="Rumali.autoCharts.filterQuarterData(1)">Q1</span><span id = id_quarter_filters_quarterno_2 onclick="Rumali.autoCharts.filterQuarterData(2)">Q2</span><span id = id_quarter_filters_quarterno_3 onclick="Rumali.autoCharts.filterQuarterData(3)">Q3</span><span id = id_quarter_filters_quarterno_4 onclick="Rumali.autoCharts.filterQuarterData(4)">Q4</span>',document.getElementById("id_quarter_filters").innerHTML=e},v=function(e,t){w(e);var n="Data not available",o="<span id=error_"+e+">"+(t?t:n)+"</span>";$(o).insertBefore("#"+e)},w=function(e){$("#error_"+e).remove()},y=function(e,t){var t=t,n=e[0].title?e[0].title:"",o=e[0].key?e[0].key:"<br/>",i=e[0].value?e[0].value:"",s=e[0].content?e[0].content:"";"number"==typeof+i&&(i=+i,i=r.applyConditionalFormatting(i));var a=$("<div />").appendTo("body");a.attr("id",t);var l='<span class = "col-sm-12 card_layout">';l+='<span class= "col-sm-12 card_layout_header_span"><h4 class="card_layout_header"><b>'+n+"</b></h4></span>",l+='<span class= "col-sm-12 card_layout_key">'+o+"</b></span>",l+='<span class= "col-sm-12 card_layout_value">'+i+"</b></span>",l+='<span class= "col-sm-12 card_layout_content">'+s+"</span>",l+="</span>",$("#"+t).html(l)},C=function(e,t){var n=0,o="",i="",s="",a="",l="",c="",u="",d="",h="",f="";for(f+='<span class = "col-sm-12 box_layout border_top">',f+='<span class = "col-sm-12 box_layout_header_span">',f+='<span class = "col-sm-3 box_layout_header"><b>Metric',f+="</b></span>",f+='<span class = "col-sm-4 box_layout_header"><b>Rank',f+="</b></span>",f+='<span class = "col-sm-5 box_layout_header"><b>Value',f+="</b></span>",f+="</span>",f+='<span class = "col-sm-12">',f+='<span class = "col-sm-3"></span>',f+='<span class = "col-sm-4 box_layout_header_subtitle">Europeana</span>',f+="</span>",n=0;n<e.length;n++)o=e[n].metric,a=e[n].rank_for_europeana,l=e[n].diff_in_rank_for_europeana,c=e[n].value_of_last_month,h=e[n].contribution_to_europeana,u=e[n].diff_value,f+='<span class = "col-sm-12 border_top">',f+='<span class = "col-sm-3 text-center">',f+=r.renderHTMLforTableTitle(o),f+="</span>",f+='<span class = "col-sm-4 text-center">',f+=b(i,s,a,l),f+="</span>",f+='<span class = "col-sm-5 text-right">',f+=R(c,u,d,h),f+="</span>",f+="</span>";f+='<span class = "col-sm-12 border_top box_layout_header_subtitle">',f+="* % in value indicates contribution to Europeana.",f+="</span>",f+="</span>",$("#"+t).html(f),$(".positive_value_css").tooltip(),$(".negative_value_css").tooltip()},b=function(e,t,n,o){var i='<span class="col-sm-12">';return i+='<span class="important_val">',i+=n+"</span>(",o>0?(i+='<span class="'+r.applyConditionalCssPositiveOrNegative(Rumali.object.value_change.negative)+'">',i+=o+" &#9660;"):0>o?(i+='<span class="'+r.applyConditionalCssPositiveOrNegative(Rumali.object.value_change.positive)+'">',i+=-1*o+" &#9652;"):(i+='<span class="'+r.applyConditionalCssPositiveOrNegative(Rumali.object.value_change.no_change)+' ">',i+=-1*o+" -"),i+="</span>",i+=")",i+="</span>"},R=function(e,t,n,o){var i='<span class="col-sm-12">',s="";return s=r.applyConditionalCssPositiveOrNegative(+t>0?Rumali.object.value_change.positive:0>+t?Rumali.object.value_change.negative:Rumali.object.value_change.no_change),i+="<span class="+s+' data-toggle="tooltip" data-placement="bottom" data-original-title="'+r.calculateChangeFromPreviousValue(e,t)+'">',i+=r.applyConditionalFormatting(e),i+="</span>(",i+=o+"% )",i+="</span>"},T=function(n){e.year_no=n,d(e.charts[2],e.year_no,e.quarter_no),f(e.charts[4],e.year_no,e.quarter_no),p(t.content[0],e.year_no,e.quarter_no)},S=function(n){e.quarter_no=n,f(e.charts[4],e.year_no,e.quarter_no),p(t.content[0],e.year_no,e.quarter_no)};return{loadReportChart:l,filterDataYear:T,filterQuarterData:S}}();var scrolling=function(e){"textarea"==e&&$("#report_preview").scrollTop($("#input").scrollTop())};$.fn.insertAtCaret=function(e){return this.each(function(){document.selection&&"TEXTAREA"==this.tagName?(this.focus(),sel=document.selection.createRange(),sel.text=e,this.focus()):this.selectionStart||"0"==this.selectionStart?(startPos=this.selectionStart,endPos=this.selectionEnd,scrollTop=this.scrollTop,this.value=this.value.substring(0,startPos)+e+this.value.substring(endPos,this.value.length),this.focus(),this.selectionStart=startPos+e.length,this.selectionEnd=startPos+e.length,this.scrollTop=scrollTop):(this.value+=e,this.focus(),this.value=this.value)})},function(e,t){"use strict";function n(){for(var e={},t=arguments.length-1;t>=0;t--){var n=arguments[t];for(var o in n)e[o]=n[o]}return e}t.inlineAttach=function(e,o){function r(e,t){return(e+"\n\n[[D]]"+t).replace(/(\n{2,})\[\[D\]\]/,"\n\n").replace(/^(\n*)/,"")}var i,s=n(e,inlineAttach.defaults),a=o,l=this;this.uploadFile=function(e){var t=new FormData,n=new XMLHttpRequest,o="png";if(e.name){var r=e.name.match(/\.(.+)$/);r&&(o=r[1])}var i=e.name.substr(0,e.name.lastIndexOf("."))||e.name;t.append(s.uploadFieldName,e,i+"."+o),n.open("POST",s.uploadUrl),n.onload=function(){if(200===n.status||201===n.status){var e=JSON.parse(n.responseText);
l.onUploadedFile(e)}else l.onErrorUploading()},n.send(t)},this.isAllowedFile=function(e){return s.allowedTypes.indexOf(e.type)>=0},this.onUploadedFile=function(e){var t=s.onUploadedFile(e),n=e[s.downloadFieldName];t!==!1&&n&&(o="<img src='"+n+"' />",a.setValue(o))},this.customUploadHandler=function(e){return s.customUploadHandler(e)},this.onErrorUploading=function(){var e=a.getValue().replace(i,"");a.setValue(e),s.customErrorHandler()&&t.alert(s.errorText)},this.onReceivedFile=function(e){var t=s.onReceivedFile(e);t!==!1&&(i=s.progressText,a.setValue(r(a.getValue(),i)))},this.onPaste=function(e){var t=!1,n=e.clipboardData;if("object"==typeof n&&null!==n.items)for(var o=0;n.items.length>o;o++){var r=n.items[o];l.isAllowedFile(r)&&(t=!0,this.onReceivedFile(r.getAsFile()),this.customUploadHandler(r.getAsFile())&&this.uploadFile(r.getAsFile()))}return t},this.onDrop=function(e){for(var t=!1,n=0;e.dataTransfer.files.length>n;n++){var o=e.dataTransfer.files[n];l.isAllowedFile(o)&&(t=!0,this.onReceivedFile(o),this.customUploadHandler(o)&&this.uploadFile(o))}return t}},t.inlineAttach.Editor=function(e){var t=e;return{getValue:function(){return t.value},setValue:function(e){t.value=e}}},t.inlineAttach.defaults={uploadUrl:"upload_attachment.php",uploadFieldName:"file",downloadFieldName:"filename",allowedTypes:["image/jpeg","image/png","image/jpg","image/gif"],progressText:"![Uploading file...]()",urlText:"![file]({filename})",onReceivedFile:function(){},customUploadHandler:function(){return!0},customErrorHandler:function(){return!0},errorText:"Error uploading file",onUploadedFile:function(){}},t.inlineAttach.attachToInput=function(e,t){t=t||{};var n=new inlineAttach.Editor(e),o=new inlineAttach(t,n);e.addEventListener("paste",function(e){o.onPaste(e)},!1),e.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),o.onDrop(e)},!1),e.addEventListener("dragenter",function(e){e.stopPropagation(),e.preventDefault()},!1),e.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault()},!1)}}(document,window),function(e,t,n){"use strict";function o(e){var t=n(e);return{getValue:function(){return t.val()},setValue:function(e){t.val(e)}}}o.prototype=new inlineAttach.Editor,n.fn.inlineattach=function(e){var t=n(this);return t.each(function(){var t=n(this),r=new o(t),i=new inlineAttach(e,r);t.bind({paste:function(e){i.onPaste(e.originalEvent)},drop:function(e){e.stopPropagation(),e.preventDefault(),i.onDrop(e.originalEvent)},"dragenter dragover":function(e){e.stopPropagation(),e.preventDefault()}})}),this}}(document,window,jQuery),"undefined"==typeof window.console&&(window.console={}),"undefined"==typeof window.console.emulated&&("function"==typeof window.console.log?window.console.hasLog=!0:("undefined"==typeof window.console.log&&(window.console.log=function(){}),window.console.hasLog=!1),"function"==typeof window.console.debug?window.console.hasDebug=!0:("undefined"==typeof window.console.debug&&(window.console.debug=window.console.hasLog?function(){for(var e=["console.debug:"],t=0;t<arguments.length;t++)e.push(arguments[t]);window.console.log.apply(window.console,e)}:function(){}),window.console.hasDebug=!1),"function"==typeof window.console.warn?window.console.hasWarn=!0:("undefined"==typeof window.console.warn&&(window.console.warn=window.console.hasLog?function(){for(var e=["console.warn:"],t=0;t<arguments.length;t++)e.push(arguments[t]);window.console.log.apply(window.console,e)}:function(){}),window.console.hasWarn=!1),"function"==typeof window.console.error?window.console.hasError=!0:("undefined"==typeof window.console.error&&(window.console.error=function(){var e="An error has occured.";if(window.console.hasLog){for(var t=["console.error:"],n=0;n<arguments.length;n++)t.push(arguments[n]);window.console.log.apply(window.console,t),e="An error has occured. More information is available in your browser's javascript console."}for(var n=0;n<arguments.length&&"string"==typeof arguments[n];++n)e+="\n"+arguments[n];throw"undefined"!=typeof Error?new Error(e):e}),window.console.hasError=!1),"function"==typeof window.console.trace?window.console.hasTrace=!0:("undefined"==typeof window.console.trace&&(window.console.trace=function(){window.console.error("console.trace does not exist")}),window.console.hasTrace=!1),window.console.emulated=!0),function(e){e.appendStylesheet=e.appendStylesheet||function(t,n){if(!document.body)return setTimeout(function(){e.appendStylesheet.apply(e,[t,n])},500),e;var o="stylesheet-"+t.replace(/[^a-zA-Z0-9]/g,""),r=e("#"+o);if("undefined"==typeof n&&(n=!1),1===r.length){if(!n)return e;r.remove()}var i=document.getElementsByTagName(e.browser.safari?"head":"body")[0],s=document.createElement("link");return s.type="text/css",s.rel="stylesheet",s.media="screen",s.href=t,s.id=o,i.appendChild(s),e},e.appendScript=e.appendScript||function(t,n){if(!document.body)return setTimeout(function(){e.appendScript.apply(e,[t,n])},500),e;var o="script-"+t.replace(/[^a-zA-Z0-9]/g,""),r=e("#"+o);if("undefined"==typeof n&&(n=!1),1===r.length){if(!n)return e;r.remove()}var i=document.getElementsByTagName(e.browser.safari?"head":"body")[0],s=document.createElement("script");return s.type="text/javascript",s.src=t,s.id=o,i.appendChild(s),e}}(jQuery),function(e){e.fn.findAndSelf=e.fn.findAndSelf||function(t){var n=e(this);return n.find(t).andSelf().filter(t)},Number.prototype.replace=Number.prototype.replace||function(){var e=String(this);return e.replace.apply(this,arguments)},e.SyntaxHighlighter?window.console.warn("SyntaxHighlighter has already been defined..."):e.SyntaxHighlighter={config:{load:!0,highlight:!0,debug:!1,wrapLines:!0,lineNumbers:!0,stripEmptyStartFinishLines:!0,stripInitialWhitespace:!0,alternateLines:!1,defaultClassname:"highlight",theme:"balupton",themes:["balupton"],addSparkleExtension:!0,prettifyBaseUrl:"http://balupton.github.com/jquery-syntaxhighlighter/prettify",baseUrl:"http://balupton.github.com/jquery-syntaxhighlighter"},init:function(t){var n=this,o=n.config,r=o.baseUrl;return"/"===r[r.length-1]&&(o.baseUrl=r.substr(0,r.length-2)),delete r,e.extend(!0,n.config,t||{}),e.Sparkle&&e.Sparkle.addExtension("syntaxhighlighter",function(){e(this).syntaxHighlight()}),e.fn.syntaxHighlight=e.fn.SyntaxHighlight=n.fn,o.load&&n.load(),o.highlight&&n.highlight(),this},load:function(){var t=this,n=t.config,o=n.prettifyBaseUrl,r=n.baseUrl,i=n.themes;return t.loaded()||(e.appendScript(o+"/prettify.min.js"),e.appendStylesheet(o+"/prettify.min.css"),e.appendStylesheet(r+"/styles/style.min.css"),e.each(i,function(t,n){e.appendStylesheet(r+"/styles/theme-"+n+".min.css")}),e.browser.msie&&e.appendStylesheet(r+"/styles/ie.min.css"),t.loadedExtras=!0),this},loadedExtras:!1,loaded:function(){return"undefined"!=typeof prettyPrint&&this.loadedExtras},determineLanguage:function(e){for(var t=null,n=/lang(uage)?-([a-z0-9]+)/g,o=n.exec(e);null!==o;)t=o[2],o=n.exec(e);return t},fn:function(){var t=e.SyntaxHighlighter,n=(t.config,e(this));return e.SyntaxHighlighter.highlight({el:n}),this},highlight:function(t){"object"!=typeof t&&(t={});var n=this,o=n.config,r=t.el||!1;if(r instanceof jQuery||(r=e("body")),!n.loaded())return o.debug&&window.console.debug("SyntaxHighlighter.highlight: Chosen SyntaxHighlighter is not yet defined. Waiting 1200 ms then trying again."),void setTimeout(function(){n.highlight.apply(n,[t])},1200);var i=o.defaultClassname,s="";"array"==typeof i?(s="."+i.join(",."),i=i.join(" ")):(i=String(i),s="."+i.replace(" ",",.")),"."!==s&&i||(window.console.error("SyntaxHighlighter.highlight: Invalid defaultClassname.",[this,arguments],[o.defaultClassname]),window.console.trace());var a=r.findAndSelf("code,pre").filter("[class*=lang],"+s).filter(":not(.prettyprint)");return a.css({"overflow-y":"visible","overflow-x":"visible","white-space":"pre"}).addClass("prettyprint "+i).each(function(){var t=e(this),o=t.attr("class"),r=n.determineLanguage(o);t.addClass("lang-"+r)}),o.lineNumbers&&a.addClass("linenums"),o.theme&&a.addClass("theme-"+o.theme),o.alternateLines&&a.addClass("alternate"),prettyPrint(),o.stripEmptyStartFinishLines&&a.find("li:first-child > :first-child, li:last-child > :first-child").each(function(){var t=e(this),n=t.html(),o=/^([\r\n\s\t]|\&nbsp;)*$/.test(n),r=t.parent(),i=t.siblings();if(o&&(0===i.length||1===i.length&&i.filter(":last").is("br"))){var r=t.parent(),s=r.val();r.next().val(s),r.remove()}}),o.stripInitialWhitespace&&a.find("li:first-child > :first-child").each(function(){var t=e(this),n=t.html(),o=n.match(/^(([\r\n\s\t]|\&nbsp;)+)/)||[],r=o[1]||"";r.length&&t.parent().siblings().children(":first-child").add(t).each(function(){var t=e(this),n=t.html();n=n.replace(new RegExp("^"+r,"gm"),""),t.html(n)})}),a.css(o.wrapLines?{"overflow-x":"hidden","overflow-y":"hidden","white-space":"pre-wrap","max-height":"none"}:{"overflow-x":"auto","overflow-y":"auto","white-space":"normal","max-height":"500px"}),this}}}(jQuery),Rumali.manualCharts=function(){var e,t=[],n=Rumali.utility,o=Rumali.object,r={},i=function(){var i,a;for(t=$(".d3-pykcharts"),i=t.length,e=0;i>e;e++){var l=t[e].dataset.api;switch(l){case"PykCharts.multiD.column":s(t[e]);break;case"PykCharts.oneD.pie":d(t[e])}}r=$(".box_table")[0],a=r.id,n.getJSONforTable(o.datacast_url+r.dataset.datacast_identifier,a,c)},s=function(e){var t,r="",i=[],s=function(){var e={selector:t,data:i,axis_x_formatting_enable:"no",chart_margin_left:60},n=new PykCharts.multiD.column(e);n.execute()},a=function(t){"false"===e.dataset.filter_present&&(i=t,s())};r+="<span class = header id ="+$(e).attr("id")+"_header></span>",r+="<span class = header id ="+$(e).attr("id")+"_body></span>",r+="<span class = header id ="+$(e).attr("id")+"_footer></span>",t="#"+$(e).attr("id"),$(t).html(r),t="#"+$(e).attr("id")+"_body",n.setHTMLheaderForChart("This chart is for pageviews of Europeana",$(e).attr("id")+"_header"),n.getJSON(o.datacast_url+e.dataset.datacast_identifier,this,a)};renderHTMLforTableRank=function(e,t){var o='<span class="col-sm-12">';return o+='<span class="important_val">',o+=e+"</span>(",t>0?(o+='<span class="'+n.applyConditionalCssPositiveOrNegative(Rumali.object.value_change.negative)+'">',o+=t+" &#9660;"):0>t?(o+='<span class="'+n.applyConditionalCssPositiveOrNegative(Rumali.object.value_change.positive)+'">',o+=-1*t+" &#9652;"):(o+='<span class="'+n.applyConditionalCssPositiveOrNegative(Rumali.object.value_change.no_change)+' ">',o+=-1*t+" -"),o+="</span>",o+=")",o+="</span>"};var a=function(e,t,o){var r='<span class="col-sm-12">',i="";return i=n.applyConditionalCssPositiveOrNegative(+t>0?Rumali.object.value_change.positive:0>+t?Rumali.object.value_change.negative:Rumali.object.value_change.no_change),r+="<span class="+i+' data-toggle="tooltip" data-placement="bottom" data-original-title="'+n.tooltipLayout(t)+'">',r+=n.applyConditionalFormatting(e),r+="</span>(",r+=o+"%)",r+="</span>"},l=function(e){var t="",o="",r="",i="",s="",l="",c=0,u="";for(c=0;c<e.length;c++)t=e[c].impl_aggregation_name,o=e[c].rank_for_europeana,r=e[c].diff_in_rank_for_europeana,i=e[c].sum,s=e[c].diff_in_value_in_percentage,l=e[c].contribution_to_europeana,u+='<span class = "col-sm-12 border_top">',u+='<span class = "col-sm-5 text-center">',u+=n.renderHTMLforTableTitle(t),u+="</span>",u+='<span class = "col-sm-3 text-center">',u+=renderHTMLforTableRank(o,r),u+="</span>",u+='<span class = "col-sm-4 text-right">',u+=a(i,s,l),u+="</span>",u+="</span>";return u},c=function(e,t){var o="",r=[],i=e;o+='<h3 class="ranking_header">Provider Rankings.</h3>',r=n.filterData(e,"metric","pageviews"),o+=n.renderFilter(e,"metric","id_dropdown_provider_rank"),o+='<span class = "col-sm-12 box_layout border_top">',o+='<span class = "col-sm-12 box_layout_header_span">',o+='<span class = "col-sm-5 box_layout_header"><b>Provider Name',o+="</b></span>",o+='<span class = "col-sm-3 box_layout_header"><b>Rank',o+="</b></span>",o+='<span class = "col-sm-4 box_layout_header"><b>Value',o+="</b></span>",o+='<span class = "col-sm-12">',o+='<span class = "col-sm-5"></span>',o+='<span class = "col-sm-3 box_layout_header_subtitle">Europeana</span>',o+="</span>",o+='<span id="id_provider_rank_content">',o+="</span>",o+='<span class = "col-sm-12 border_top box_layout_header_subtitle">',o+="* % in value indicates contribution to Europeana.",o+="</span>",o+="</span>",$("#"+t).html(o),$("#id_dropdown_provider_rank").val("pageviews"),$("#id_provider_rank_content").html(l(r)),$("#id_dropdown_provider_rank").change(function(){r=n.filterData(i,"metric",this.options[this.selectedIndex].text),$("#id_provider_rank_content").html(l(r)),u()}),u()},u=function(){$(".positive_value_css").tooltip(),$(".negative_value_css").tooltip()},d=function(e){var t,r,i,s,a=[],l="",c=function(){var e={selector:"#"+i,data:a,chart_width:400},n=new PykCharts.oneD.pie(e);n.execute();var o=1.25*n.chart_height;$(t).height(o)},u=function(t){var o="";"false"===e.dataset.filter_present?(a=t,c()):(a=n.filterData(t,e.dataset.filter_column_name,t[t.length-1][e.dataset.filter_column_name]),c(),o+=n.renderFilter(t,e.dataset.filter_column_name,r+"_dropdown"),$("#"+r).html(o),$("#"+r+"_dropdown").val(t[t.length-1][e.dataset.filter_column_name]),$("#"+r+"_dropdown").change(function(){a=n.filterData(t,e.dataset.filter_column_name,this.options[this.selectedIndex].text),c()}))};t="#"+$(e).attr("id"),r=$(e).attr("id")+"_head",i=$(e).attr("id")+"_body",s=$(e).attr("id")+"_footer",l+="<span class = header id ="+r+"></span>",l+="<div class = header id ="+i+" height= 400></div>",l+="<span class = header id ="+s+"></span>",$(t).html(l),n.getJSON(o.datacast_url+e.dataset.datacast_identifier,this,u)};return{loadReportChart:i}}();var typingTimer,doneTypingInterval=1e3,$input=$("#input");Rumali.reportsNewPage=function(){$(".selected-chart").click(function(e){html_in=this.dataset.auto_html_div,$("#input").insertAtCaret(html_in),setTimeout(function(){$("svg").remove(),genereteChartInMarkdown()},500),$("#chart-selector").modal("hide"),e.preventDefault()}),$("#input").on("keyup",function(){clearTimeout(typingTimer),typingTimer=setTimeout(function(){$("svg").remove(),genereteChartInMarkdown()},doneTypingInterval)}),$("#input").on("keydown",function(){clearTimeout(typingTimer)})},Rumali.buildCharts=function(){var e=function(){gon.is_autogenerated?Rumali.autoCharts.loadReportChart():"europeana"==gon.report_slug?Rumali.manualCharts.loadReportChart():genereteChartInMarkdown()};return{loadReportChart:e}}();var Attacklab=Attacklab||{};Attacklab.showdown=Attacklab.showdown||{},Attacklab.showdown.converter=function(){var e,t,n,o=0;this.makeHtml=function(o){return e=new Array,t=new Array,n=new Array,o=o.replace(/~/g,"~T"),o=o.replace(/\$/g,"~D"),o=o.replace(/\r\n/g,"\n"),o=o.replace(/\r/g,"\n"),o="\n\n"+o+"\n\n",o=H(o),o=o.replace(/^[ \t]+$/gm,""),o=s(o),o=i(o),o=l(o),o=D(o),o=o.replace(/~D/g,"$$"),o=o.replace(/~T/g,"~")};var r,i=function(n){var n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(n,o,r,i,s){return o=o.toLowerCase(),e[o]=E(r),i?i+s:(s&&(t[o]=s.replace(/"/g,"&quot;")),"")});return n},s=function(e){e=e.replace(/\n/g,"\n\n");return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,a),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,a),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,a),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,a),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,a),e=e.replace(/\n\n/g,"\n")},a=function(e,t){var o=t;return o=o.replace(/\n\n/g,"\n"),o=o.replace(/^\n/,""),o=o.replace(/\n+$/g,""),o="\n\n~K"+(n.push(o)-1)+"K\n\n"},l=function(e){e=g(e);var t=y("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,t),e=v(e),e=w(e),e=T(e),e=s(e),e=S(e)},c=function(e){return e=C(e),e=u(e),e=_(e),e=f(e),e=d(e),e=k(e),e=E(e),e=R(e),e=e.replace(/  +\n/g," <br />\n")},u=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=O(t,"\\`*_")})},d=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,h),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,h),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,h)},h=function(n,o,r,i,s,a,l,c){void 0==c&&(c="");var u=o,d=r,h=i.toLowerCase(),f=s,p=c;if(""==f)if(""==h&&(h=d.toLowerCase().replace(/ ?\n/g," ")),f="#"+h,void 0!=e[h])f=e[h],void 0!=t[h]&&(p=t[h]);else{if(!(u.search(/\(\s*\)$/m)>-1))return u;f=""}f=O(f,"*_");var m='<a href="'+f+'"';return""!=p&&(p=p.replace(/"/g,"&quot;"),p=O(p,"*_"),m+=' title="'+p+'"'),m+=">"+d+"</a>"},f=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p)},p=function(n,o,r,i,s,a,l,c){var u=o,d=r,h=i.toLowerCase(),f=s,p=c;if("visualization"==r){for(var g="",v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",w=0;5>w;w++)g+=v.charAt(Math.floor(Math.random()*v.length));m(s,g),y=""}else{if(p||(p=""),""==f){if(""==h&&(h=d.toLowerCase().replace(/ ?\n/g," ")),f="#"+h,void 0==e[h])return u;f=e[h],void 0!=t[h]&&(p=t[h])}d=d.replace(/"/g,"&quot;"),f=O(f,"*_");var y='<img src="'+f+'" alt="'+d+'"';p=p.replace(/"/g,"&quot;"),p=O(p,"*_"),y+=' title="'+p+'"',y+=" />"}return y},m=function(e,t){var n,o={"Pie Chart":"pie","Election Donut Chart":"election-donut","Donut Chart":"donut","Bar Chart":"bar","Column Chart":"column","Grouped Column Chart":"grouped-column","Line Chart":"line"};return $.get("/generate/chart/"+e,function(e){if(n=e,e){var r="500px",i="500px";gon.width&&(r=gon.width),gon.height&&(i=gon.height),console.log(gon),$("<div>").attr("id",t).css({height:i,width:r}).appendTo("#preview"),dw.visualize({type:o[e.chart_type]+"-chart",theme:"default",container:$("#"+t),datasource:dw.datasource.delimited({csv:e.mapped_output})})}}),$("#"+t)},g=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return y("<h1>"+c(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return y("<h2>"+c(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var o=t.length;return y("<h"+o+">"+c(n)+"</h"+o+">")})},v=function(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return o?e=e.replace(t,function(e,t,n){var o=t,i=n.search(/[*+-]/g)>-1?"ul":"ol";o=o.replace(/\n{2,}/g,"\n\n\n");var s=r(o);return s=s.replace(/\s+$/,""),s="<"+i+">"+s+"</"+i+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,o){var i=t,s=n,a=o.search(/[*+-]/g)>-1?"ul":"ol",s=s.replace(/\n{2,}/g,"\n\n\n"),l=r(s);return l=i+"<"+a+">\n"+l+"</"+a+">\n"})),e=e.replace(/~0/,"")};r=function(e){return o++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(e,t,n,o,r){var i=r,s=t;return s||i.search(/\n{2,}/)>-1?i=l(A(i)):(i=v(A(i)),i=i.replace(/\n$/,""),i=c(i)),"<li>"+i+"</li>\n"}),e=e.replace(/~0/g,""),o--,e};var w=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var o=t,r=n;return o=b(A(o)),o=H(o),o=o.replace(/^\n+/g,""),o=o.replace(/\n+$/g,""),o="<pre><code class='highlight'>"+o+"\n</code></pre>",y(o)+r}),e=e.replace(/~0/,"")},y=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(e)-1)+"K\n\n"},C=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,o){var r=o;return r=r.replace(/^([ \t]*)/g,""),r=r.replace(/[ \t]*$/g,""),r=b(r),t+"<code class='highlight'>"+r+"</code>"})},b=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=O(e,"*_{}[]\\",!1)},R=function(e){return e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},T=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=l(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),y("<blockquote>\n"+n+"\n</blockquote>")})},S=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var t=e.split(/\n{2,}/g),o=new Array,r=t.length,i=0;r>i;i++){var s=t[i];s.search(/~K(\d+)K/g)>=0?o.push(s):s.search(/\S/)>=0&&(s=c(s),s=s.replace(/^([ \t]*)/g,"<p>"),s+="</p>",o.push(s))}r=o.length;for(var i=0;r>i;i++)for(;o[i].search(/~K(\d+)K/)>=0;){var a=n[RegExp.$1];a=a.replace(/\$/g,"$$$$"),o[i]=o[i].replace(/~K\d+K/,a)}return o.join("\n\n")},E=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},_=function(e){return e=e.replace(/\\(\\)/g,P),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,P)},k=function(e){return e=e.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return x(D(t))})},x=function(e){function t(e){var t="0123456789ABCDEF",n=e.charCodeAt(0);return t.charAt(n>>4)+t.charAt(15&n)}var n=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"==e)e=n[Math.floor(2*Math.random())](e);else if(":"!=e){var t=Math.random();e=t>.9?n[2](e):t>.45?n[1](e):n[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')},D=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})},A=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")},H=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var n=t,o=4-n.length%4,r=0;o>r;r++)n+=" ";return n}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")},O=function(e,t,n){var o="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(o="\\\\"+o);var r=new RegExp(o,"g");return e=e.replace(r,P)},P=function(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}};var Showdown=Attacklab.showdown;Attacklab.fileLoaded&&Attacklab.fileLoaded("showdown.js"),function(){function e(e,t){var n=e.className;return n.length>0&&(n===t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(n))||(e.className=e.className+(e.className?" ":"")+t),e}function t(e,t,n,o){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1),o&&"function"==typeof o.push?o.push({element:e,event:t,callback:n}):T.push({element:e,event:t,callback:n})}function n(e,t){t=t||{},e=e||{};var n;for(n in t)t.hasOwnProperty(n)&&"undefined"!=typeof t[n]&&(e[n]=t[n]);return e}function o(e,t,n){var o,r=e.toString(),i="";return(null===t||void 0===t)&&(t=""),(null===n||void 0===n)&&(n=""),o=r.match(/\/([gim]*)$/),i=o?o[1]:"",r=r.replace(/(^\/|\/[gim]*$)/g,""),r=t+r+n,new RegExp(r,i)}function r(e){return(e||"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function i(){return R||(R=S.WebKit&&!document.evaluate?document:S.Opera&&window.parseFloat(window.opera.version())<9.5?document.body:document.documentElement),{width:R.clientWidth,height:R.clientHeight}}function s(e,t){var n,o;if(e){if("undefined"!=typeof e.indexOf)return e.indexOf(t);if("undefined"!=typeof e.length)for(n=0,o=e.length;o>n;n++)if(e[n]===t)return n}return-1}function a(e,t){function o(){return c.charAt(r(0,c.length))}function r(e,t){return Math.floor(Math.random()*(t-e))+e}t=n({numbers:!1,lower:!0,upper:!0,other:!1},t);var i="0123456789",s="abcdefjhijklmnopqrstuvwxyz",a="ABCDEFJHIJKLMNOPQRSTUVWXYZ",l="`~!@#$%^&*()-_=+[{]}\\|;:'\",<.>/?",c="",u="";if(t.numbers&&(c+=i),t.lower&&(c+=s),t.upper&&(c+=a),t.other&&(c+=l),0===c.length)throw"There is no character set from which to generate random strings.";for(var d=0;e>d;d++)u+=o();return u}function l(e,t){return e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,""),e}function c(e,t,n,o){var r=null,i=0;for(o=o&&"function"==typeof o.push?o:T;i<o.length;i++)if(o[i].element===e&&o[i].event===t&&o[i].callback===n){r=o[i];break}e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1),r&&o.splice(s(o,r),1)}function u(e){var t=!0;return window.getComputedStyle?t="none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle&&(t="none"!==e.currentStyle.display),t}function d(e){b="RU"==e?Translator_RU:Translator_EN,m.builtIn={strong:{text:b.strongText,title:b.strongTitle,css:"wmd-strong",shortcut:"b"},em:{text:b.emText,title:b.emTitle,css:"wmd-em",shortcut:"i"},a:{text:b.aText,title:b.aTitle,css:"wmd-a",shortcut:"l"},blockquote:{text:b.blockquoteText,title:b.blockquoteTitle,css:"wmd-blockquote",shortcut:"q"},code:{text:b.codeText,title:b.codeTitle,css:"wmd-code",shortcut:"k"},ol:{text:b.olText,title:b.olTitle,css:"wmd-ol",shortcut:"o"},ul:{text:b.ulText,title:b.ulTitle,css:"wmd-ul",shortcut:"u"},h:{text:b.hText,title:b.hTitle,css:"wmd-h",shortcut:"h"},hr:{text:b.hrText,title:b.hrTitle,css:"wmd-hr",shortcut:"r"},spacer:{css:"wmd-spacer",builder:m.createSpacer}}}var h,f,p,m,g,v,w,y,C,b,R,T=[],S={IE:!(!window.attachEvent||window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1};h=function(e,o,r){function i(){var e,t,n,i,s,a,u=r.commands.split(" ");if(o)for(o.innerHTML="",e=document.createElement("ul"),e.className="wmd-toolbar",o.appendChild(e),t=0;t<u.length;t+=1)n=u[t],i=null,a=null,s=m.create,r.commandTable[n]?i=r.commandTable[n]:m.builtIn[n]&&(i=m.builtIn[n]),i&&(i.builder&&"function"==typeof i.builder&&(s=i.builder),a=s(l,n,i),i.shortcut&&"string"==typeof i.shortcut&&(c[i.shortcut.toLowerCase()]=a.run),a.draw(e))}function s(){function n(){e.value!==u&&(r.preview.innerHTML=r.showdown(e.value),u=e.value)}t(e,S.Opera?"keypress":"keydown",function(e){var t=e||window.event,n=t.keyCode||t.which,o=String.fromCharCode(n).toLowerCase();return(t.ctrlKey||t.metaKey)&&c[o]&&"function"==typeof c[o]?(c[o](),t.preventDefault&&t.preventDefault(),window.event&&(window.event.returnValue=!1),!1):void 0}),t(e,"keyup",function(e){var t,n,o=e||window.event,r=o.keyCode||o.which,i=o.shiftKey||o.ctrlKey||o.metaKey;i||13!==r||(t=new p(l),n=t.getChunk(),m.autoIndent(l,n,function(){t.setChunk(n),t.restore()}))}),S.IE&&t(e,"keypress",function(e){var t=e||window.event,n=t.keyCode||t.which;return 27===n?(t.returnValue=!1,!1):void 0}),r.preview&&r.previewEvery>0&&"function"==typeof r.showdown&&("string"==typeof r.preview&&(r.preview=document.getElementById(r.preview)),a=setInterval(n,1e3*r.previewEvery),t(e,"keypress",n),t(e,"keydown",n))}r=n({preview:null,previewEvery:.5,showdown:null,lineLength:40,commands:"strong em spacer a blockquote code img spacer ol ul h hr",commandTable:{},lang:"EN"},r),d(r.lang),"string"==typeof e&&(e=document.getElementById(e)),"string"==typeof o&&(o=document.getElementById(o));var a,l={},c={},u="";return!r.showdown&&"undefined"!=typeof Attacklab&&Attacklab.showdown&&Attacklab.showdown.converter&&(r.showdown=(new Attacklab.showdown.converter).makeHtml),i(),s(),n(l,{input:e,options:r,ieClicked:!1,ieRange:null})},t(window,"unload",function(){for(;T.length>0;)c(T[0].element,T[0].event,T[0].callback)}),Translator_EN={urlFieldInsertion:'<span class="note">To add a tool-tip, place it in quotes after the URL (e.g., <strong>http://google.com "Google"</strong>)</span>',linkText:"link text",imageAlt:"image alt",listItem:"List item",strongTitle:"Strong <strong> Ctl+B",emTitle:"Emphasis <em> Ctl+I",aTitle:"Hyperlink <a> Ctl+L",blockquoteTitle:"Blockquote <blockquote> Ctl+Q",codeTitle:"Code Sample <pre><code> Ctl+K",imgTitle:"Image <img> Ctl+G",olTitle:"Numbered List <ol> Ctl+O",ulTitle:"Bulleted List <ul> Ctl+U",hTitle:"Heading <h1>/<h2> Ctl+H",hrTitle:"Horizontal Rule <hr> Ctl+R",strongText:"Bold",emText:"Italic",aText:"Link",blockquoteText:"Blockquote",codeText:"Code",imgText:"Image",olText:"Numbered List",ulText:"Bulleted List",hText:"Heading",hrText:"Horizontal Rule",insertImage:"Insert image",imageURL:"Image URL",enterCodeHere:"enter code here",blockquote:"Blockquote",insertLink:"Insert link",linkURL:"Link URL",submit:"Submit",cancel:"Cancel"},Translator_RU={urlFieldInsertion:'<span class="note">(\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, <strong>http://google.com</strong>)</span>',linkText:"\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0441\u0441\u044b\u043b\u043a\u0438",imageAlt:"\u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438",listItem:"\u0442\u0435\u043a\u0441\u0442",strongTitle:"\u0416\u0438\u0440\u043d\u044b\u0439 <strong> Ctl+B",emTitle:"\u041a\u0443\u0440\u0441\u0438\u0432 <em> Ctl+I",aTitle:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 <a> Ctl+L",blockquoteTitle:"\u042b\u0438\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c <blockquote> Ctl+Q",codeTitle:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043f\u0440\u0438\u043c\u0435\u0440 \u043a\u043e\u0434\u0430 <pre><code> Ctl+K",imgTitle:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443 <img> Ctl+G",olTitle:"\u041d\u0443\u043c\u0435\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a <ol> Ctl+O",ulTitle:"\u041c\u0430\u0440\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a <ul> Ctl+U",hTitle:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a <h1>/<h2> Ctl+H",hrTitle:"\u0413\u043e\u0440\u0438\u0437\u043e\u043d\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0447\u0435\u0440\u0442\u0430 <hr> Ctl+R",strongText:"Bold",emText:"Italic",aText:"Link",blockquoteText:"Blockquote",codeText:"Code",imgText:"Image",olText:"Numbered List",ulText:"Bulleted List",hText:"Heading",hrText:"Horizontal Rule",insertImage:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",imageURL:"\u0410\u0434\u0440\u0435\u0441 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438",enterCodeHere:"\u0432\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u043a\u043e\u0434 \u0441\u0434\u0435\u0441\u044c",blockquote:"\u0442\u0435\u043a\u0441\u0442 \u0446\u0438\u0442\u0430\u0442\u044b",insertLink:"\u0412\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443",linkURL:"\u0421\u0441\u044b\u043b\u043a\u0430",submit:"\u041e\u043a",cancel:"\u041e\u0442\u043c\u0435\u043d\u0430"},b=Translator_EN,f=function(e,t,i,s){var a="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",l={};return n(l,{before:r(e.substring(0,t)),selection:r(e.substring(t,i)),after:r(e.substring(i)),scrollTop:s,startTag:"",endTag:"",addBlankLines:function(e,t,n){var o,r,i;if(e="undefined"==typeof e||null===e?1:e,t="undefined"==typeof t||null===t?1:t,e+=1,t+=1,i=/(^\n*)/.exec(this.selection),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+(i?i[1]:""),i=/(\n*$)/.exec(this.selection),this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+(i?i[1]:""),i=/(^\n*)/.exec(this.startTag),this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+(i?i[1]:""),i=/(\n*$)/.exec(this.endTag),this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+(i?i[1]:""),this.before){for(o=r="";e>0;)o+="\\n?",r+="\n",e-=1;n&&(o="\\n*"),this.before=this.before.replace(new RegExp(o+"$",""),r)}if(this.after){for(o=r="";t>0;)o+="\\n?",r+="\n",t-=1;n&&(o="\\n*"),this.after=this.after.replace(new RegExp(o,""),r)}return this},setTags:function(e,t){var n,r=this;return e&&(n=o(e,"","$"),this.before=this.before.replace(n,function(e){return r.startTag=r.startTag+e,""}),n=o(e,"^",""),this.selection=this.selection.replace(n,function(e){return r.startTag=r.startTag+e,""})),t&&(n=o(t,"","$"),this.selection=this.selection.replace(n,function(e){return r.endTag=e+r.endTag,""}),n=o(t,"^",""),this.after=this.after.replace(n,function(e){return r.endTag=e+r.endTag,""})),this},trimWhitespace:function(e){return this.selection=this.selection.replace(/^(\s*)/,""),e||(this.before=this.before+RegExp.$1),this.selection=this.selection.replace(/(\s*)$/,""),e||(this.after=RegExp.$1+this.after),this},unwrap:function(){var e=new RegExp("([^\\n])\\n(?!(\\n|"+a+"))","g");
return this.selection=this.selection.replace(e,"$1 $2"),this},wrap:function(e){var t=new RegExp("(.{1,"+e+"})( +|$\\n?)","gm");return this.unwrap(),this.selection=this.selection.replace(t,function(e,t){return new RegExp("^"+a,"").test(e)?e:t+"\n"}),this.selection=this.selection.replace(/\s+$/,""),this}})},p=function(e){var t={},o=e.input;return t=n(t,{scrollTop:0,text:"",start:0,end:0,getChunk:function(){return new f(this.text,this.start,this.end,this.scrollTop)},restore:function(){this.text!==o.value&&(o.value=this.text),this.setInputSelection(),o.scrollTop=this.scrollTop},setChunk:function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,S.Opera&&(e.before=e.before.replace(/\n/g,"\r\n"),e.selection=e.selection.replace(/\n/g,"\r\n"),e.after=e.after.replace(/\n/g,"\r\n")),this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},setInputSelection:function(){var e;u(o)&&(o.focus(),o.selectionStart||0===o.selectionStart?(o.selectionStart=this.start,o.selectionEnd=this.end,o.scrollTop=this.scrollTop):document.selection&&(document.activeElement&&document.activeElement!==o||(e=o.createTextRange(),e.moveStart("character",-1*o.value.length),e.moveEnd("character",-1*o.value.length),e.moveEnd("character",this.end),e.moveStart("character",this.start),e.select())))},setStartEnd:function(){var t,n,i,s,a,l="";if(u(o))if(o.selectionStart||0===o.selectionStart)this.start=o.selectionStart,this.end=o.selectionEnd;else if(document.selection){if(this.text=r(o.value),e.ieClicked&&e.ieRange?(t=e.ieRange,e.ieClicked=!1):t=document.selection.createRange(),n=r(t.text),i=l+n+l,t.text=i,s=r(o.value),t.moveStart("character",-1*i.length),t.text=n,this.start=s.indexOf(l),this.end=s.lastIndexOf(l)-l.length,a=this.text.length-r(o.value).length,a>0){for(t.moveStart("character",-1*n.length);a>0;)n+="\n",this.end=this.end+1,a-=1;t.text=n}this.setInputSelection()}}}),u(o)&&(o.focus(),t.setStartEnd(),t.scrollTop=o.scrollTop,(o.selectionStart||0===o.selectionStart)&&(t.text=o.value)),t},m=function(o,r,i,s){function a(){l&&(l.className=m.css.base+" "+r.css)}s=n({downCssSuffix:"-down"},s);{var l,c={};r.css+s.downCssSuffix}return n(c,{draw:function(n){var i,u=r.css+s.downCssSuffix;l?n.appendChild(l):(l=document.createElement("li"),l.title=r.title,n.appendChild(l),i=document.createElement("span"),i.innerHTML=r.text,l.appendChild(i),t(l,"click",function(){a(),c.run()}),t(l,"mouseover",function(){a(),e(l,m.css.over)}),t(l,"mouseout",function(){a()}),t(l,"mousedown",function(){a(),e(l,m.css.down),e(l,u),S.IE&&(o.ieClicked=!0,o.ieRange=document.selection.createRange())})),a()},run:function(){var e=new p(o),t=e.getChunk();i(o,t,function(){e.setChunk(t),e.restore()})}})},n(m,{css:{base:"wmd-command",over:"wmd-command-over",down:"wmd-command-down"},autoIndent:function(e,t,o,r){r=n(r,{preventDefaultText:!0}),t.before=t.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),t.before=t.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),t.before=t.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),/(\n|^)[ ]{0,3}([*+-])[ \t]+.*\n$/.test(t.before)?m.runners.ul(e,t,o,n(r,{preventDefaultText:!1})):/(\n|^)[ ]{0,3}(\d+[.])[ \t]+.*\n$/.test(t.before)?m.runners.ol(e,t,o,n(r,{preventDefaultText:!1})):/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(t.before)?m.runners.blockquote(e,t,o,r):/(\n|^)(\t|[ ]{4,}).*\n$/.test(t.before)?m.runners.code(e,t,o,r):"function"==typeof o&&o()},create:function(e,t,n){return new m(e,n,m.runners[t])},createSpacer:function(e,t,n){var o=null;return{draw:function(e){var t;return o?e.appendChild(o):(o=document.createElement("li"),o.className=m.css.base+" "+n.css,e.appendChild(o),t=document.createElement("span"),o.appendChild(t)),o},run:function(){}}},createSubmitCancelForm:function(e,t,n){var o=document.createElement("a"),r=new w(e,{dialog:!0,onSubmit:t,onDestroy:n}),i=new y("","submit",{value:b.submit});return r.addField("submit",i),o.href="javascript:void(0);",o.innerHTML=b.cancel,o.onclick=function(){r.destroy()},i.insert("&nbsp;or&nbsp;"),i.insert(o),r},runLinkImage:function(e,t,n,o){function r(e){var n,r;e&&(t.startTag=t.endTag="",n=" [999]: "+e,r=C.add(t,n),t.startTag="img"===o.tag?"![":"[",t.endTag="]["+r+"]",t.selection||(t.selection="img"===o.tag?b.imageAlt:b.linkText))}var n="function"==typeof n?n:function(){};t.trimWhitespace(),t.setTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),t.endTag.length>1?(t.startTag=t.startTag.replace(/!?\[/,""),t.endTag="",C.add(t),n()):/\n\n/.test(t.selection)?(C.add(t),n()):"function"==typeof o.prompt?o.prompt(function(e){r(e),n()}):(r(o.link||null),n())},runList:function(e,t,n,o){function r(){var e;return"ol"===o.tag?(e=" "+m+". ",m+=1):e=" "+p+" ",e}function i(e){return void 0===o.tag&&(o.tag=/^\s*\d/.test(e)?"ol":"ul"),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return r()})}var s,a,l,c,u,d=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,h=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,f=!1,p="-",m=1;n="function"==typeof n?n:function(){},t.setTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!t.before||/\n$/.test(t.before)||/^\n/.test(t.startTag)||(t.before=t.before+t.startTag,t.startTag=""),t.startTag&&(s=/\d+[.]/.test(t.startTag),t.startTag="",t.selection=t.selection.replace(/\n[ ]{4}/g,"\n"),t.unwrap(),t.addBlankLines(),s&&(t.after=t.after.replace(h,i)),s&&"ol"===o.tag&&(f=!0)),f||(a=1,t.before=t.before.replace(d,function(e){return/^\s*([*+-])/.test(e)&&(p=RegExp.$1),a=/[^\n]\n\n[^\n]/.test(e)?1:0,i(e)}),t.selection||(t.selection=o.preventDefaultText?" ":b.listItem),l=r(),c=1,t.after=t.after.replace(h,function(e){return c=/[^\n]\n\n[^\n]/.test(e)?1:0,i(e)}),t.trimWhitespace(!0),t.addBlankLines(a,c,!0),t.startTag=l,u=l.replace(/./g," "),t.wrap(e.options.lineLength-u.length),t.selection=t.selection.replace(/\n/g,"\n"+u)),n()},runStrongEm:function(e,t,o,r){var i,s,a,l;o="function"==typeof o?o:function(){},n({stars:2},r),t.trimWhitespace(),t.selection=t.selection.replace(/\n{2,}/g,"\n"),t.before.search(/(\**$)/),i=RegExp.$1,t.after.search(/(^\**)/),s=RegExp.$1,a=Math.min(i.length,s.length),a>=r.stars&&(2!==a||1!==r.stars)?(t.before=t.before.replace(RegExp("[*]{"+r.stars+"}$",""),""),t.after=t.after.replace(RegExp("^[*]{"+r.stars+"}",""),"")):!t.selection&&s?(t.after=t.after.replace(/^([*_]*)/,""),t.before=t.before.replace(/(\s?)$/,""),t.before=t.before+s+RegExp.$1):(t.selection||s||(t.selection=r.text||""),l=r.stars<=1?"*":"**",t.before=t.before+l,t.after=l+t.after),o()},runners:{a:function(e,t,o,r){m.runLinkImage(e,t,o,n({tag:"a",prompt:function(e){C.createDialog(b.insertLink,b.linkURL,e)}},r))},blockquote:function(e,t,n,o){function r(e){var n=e?"> ":"";t.startTag&&(t.startTag=t.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})),t.endTag&&(t.endTag=t.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))}o=o||{},n="function"==typeof n?n:function(){},t.selection=t.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(e,n,o,r){return t.before+=n,t.after=r+t.after,o}),t.before=t.before.replace(/(>[ \t]*)$/,function(e,n){return t.selection=n+t.selection,""}),t.selection=t.selection.replace(/^(\s|>)+$/,""),t.selection=t.selection||(o.preventDefaultText?"":b.blockquote),t.before&&(t.before=t.before.replace(/\n?$/,"\n")),t.after&&(t.after=t.after.replace(/^\n?/,"\n")),t.before=t.before.replace(/(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*$)/,function(e){return t.startTag=e,""}),t.after=t.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(e){return t.endTag=e,""}),/^(?![ ]{0,3}>)/m.test(t.selection)?(t.wrap(e.options.lineLength-2),t.selection=t.selection.replace(/^/gm,"> "),r(!0),t.addBlankLines()):(t.selection=t.selection.replace(/^[ ]{0,3}> ?/gm,""),t.unwrap(),r(!1),!/^(\n|^)[ ]{0,3}>/.test(t.selection)&&t.startTag&&(t.startTag=t.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(t.selection)&&t.endTag&&(t.endTag=t.endTag.replace(/^\n{0,2}/,"\n\n"))),/\n/.test(t.selection)||(t.selection=t.selection.replace(/^(> *)/,function(e,n){return t.startTag=t.startTag+n,""})),n()},code:function(e,t,n,o){o=o||{},n="function"==typeof n?n:function(){};var r=/\S[ ]*$/.test(t.before),i=/^[ ]*\S/.test(t.after),s=1,a=1;!r||i||/\n/.test(t.selection)?(t.before=t.before.replace(/[ ]{4}$/,function(e){return t.selection=e+t.selection,""}),(/\n(\t|[ ]{4,}).*\n$/.test(t.before)||""===t.after||/^\n(\t|[ ]{4,})/.test(t.after))&&(s=0),t.addBlankLines(s,a),t.selection?t.selection=/^[ ]{0,3}\S/m.test(t.selection)?t.selection.replace(/^/gm,"    "):t.selection.replace(/^[ ]{4}/gm,""):(t.startTag="    ",t.selection=o.preventDefaultText?"":b.enterCodeHere)):(t.trimWhitespace(),t.setTags(/`/,/`/),t.startTag||t.endTag?t.endTag&&!t.startTag?(t.before=t.before+t.endTag,t.endTag=""):t.startTag=t.endTag="":(t.startTag=t.endTag="`",t.selection||(t.selection=o.preventDefaultText?"":b.enterCodeHere))),n()},em:function(e,t,o,r){m.runStrongEm(e,t,o,n({stars:1,text:"emphasized text"},r))},h:function(e,t,n,o){o=o||{},n="function"==typeof n?n:function(){};var r,i,s,a=0;if(t.selection=t.selection.replace(/\s+/g," "),t.selection=t.selection.replace(/(^\s+|\s+$)/g,""),t.selection){if(t.setTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(t.startTag)&&(a=RegExp.lastMatch.length),t.startTag=t.endTag="",t.setTags(null,/\s?(-+|=+)/),/=+/.test(t.endTag)?a=1:/-+/.test(t.endTag)&&(a=2),t.startTag=t.endTag="",t.addBlankLines(1,1),r=0===a?2:a-1,r>0)for(i=r>=2?"-":"=",s=t.selection.length,s>e.options.lineLength&&(s=e.options.lineLength),t.endTag="\n";s>0;)t.endTag=t.endTag+i,s-=1}else t.startTag="## ",t.selection="Heading",t.endTag=" ##";n()},hr:function(e,t,n,o){o=o||{},n="function"==typeof n?n:function(){},t.startTag="----------\n",t.selection="",t.addBlankLines(2,1,!0),n()},img:function(e,t,o,r){m.runLinkImage(e,t,o,n({tag:"img",prompt:function(e){C.createDialog(b.insertImage,b.imageURL,e)}},r))},ol:function(e,t,o,r){m.runList(e,t,o,n({tag:"ol"},r))},strong:function(e,t,o,r){m.runStrongEm(e,t,o,n({stars:2,text:"strong text"},r))},ul:function(e,t,o,r){m.runList(e,t,o,n({tag:"ul"},r))}}}),m.builtIn={strong:{text:b.strongText,title:b.strongTitle,css:"wmd-strong",shortcut:"b"},em:{text:b.emText,title:b.emTitle,css:"wmd-em",shortcut:"i"},a:{text:b.aText,title:b.aTitle,css:"wmd-a",shortcut:"l"},blockquote:{text:b.blockquoteText,title:b.blockquoteTitle,css:"wmd-blockquote",shortcut:"q"},code:{text:b.codeText,title:b.codeTitle,css:"wmd-code",shortcut:"k"},img:{text:b.imgText,title:b.imgTitle,css:"wmd-img",shortcut:"g"},ol:{text:b.olText,title:b.olTitle,css:"wmd-ol",shortcut:"o"},ul:{text:b.ulText,title:b.ulTitle,css:"wmd-ul",shortcut:"u"},h:{text:b.hText,title:b.hTitle,css:"wmd-h",shortcut:"h"},hr:{text:b.hrText,title:b.hrTitle,css:"wmd-hr",shortcut:"r"},spacer:{css:"wmd-spacer",builder:m.createSpacer}},g=function(e){function o(){i||(e.modal&&(s=new v({color:e.overlayColor,zIndex:e.zIndex-1})),i=document.createElement("div"),document.body.appendChild(i),i.className=e.css,i.style.position="absolute",i.style.zIndex=e.zIndex,i.style.top=(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)+"px",e.insertion&&r.fill(e.insertion),e.closeOnEsc&&t(document,"keypress",function(e){var t=e||window.event,n=t.keyCode||t.which;27===n&&r.destroy()},a))}var r,i,s,a=[],e=n({zIndex:10,css:"wmd-dialog",overlayColor:"#FFFFFF",modal:!0,closeOnEsc:!0,insertion:null,onDestroy:null},e);return r=n(r,{destroy:function(){for(;a.length>0;)c(a[0].element,a[0].event,a[0].callback,a);s&&(s.destroy(),s=null),i&&(i.parentNode.removeChild(i),i=null),"function"==typeof e.onDestroy&&e.onDestroy(this)},fill:function(e){i&&(i.innerHTML="",e=e||"","string"==typeof e?i.innerHTML=e:i.appendChild(e))},hide:function(){i&&(i.style.display="none")},redraw:function(){var e;i&&(e=i.className,i.className="",i.className=e)},show:function(){i&&(i.style.display="")}}),o(),r},v=function(e){function o(){var e,t;s&&(e={left:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,top:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop},t=i(),s.style.width=t.width+"px",s.style.height=t.height+"px",s.style.left=e.left+"px",s.style.top=e.top+"px",a&&(a.style.width=t.width+"px",a.style.height=t.height+"px",a.style.left=e.left+"px",a.style.top=e.top+"px"))}function r(){s||(s=document.createElement("div"),document.body.appendChild(s),s.style.position="absolute",s.style.background=e.color,s.style.zIndex=e.zIndex,s.style.opacity=e.opacity,S.IE&&(s.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+100*e.opacity+")",a=document.createElement("iframe"),document.body.appendChild(a),a.frameBorder="0",a.scrolling="no",a.style.position="absolute",a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=0)",a.style.zIndex=e.zIndex-1),e.scroll&&(t(window,"resize",o,u),t(window,"load",o,u),t(window,"scroll",o,u)),o())}var s,a,l={},u=[],e=n({color:"#FFFFFF",zIndex:9,scroll:!0,opacity:.3},e);return l=n(l,{destroy:function(){for(;u.length>0;)c(u[0].element,u[0].event,u[0].callback,u);s&&(s.parentNode.removeChild(s),s=null),a&&(a.parentNode.removeChild(a),a=null)}}),r(),l},w=function(e,o){function r(e){var t,n,o=null,r=-1;for(t=0,n=f.length;n>t;t++)if(f[t].key===e){o=f[t].value,r=t;break}return{field:o,index:r}}function i(e){var t,n,o=[];for(t=0,n=f.length;n>t;t++)f[t].key!==e&&o.push(f[t]);f=o}e=e||"",o=n({css:"wmd-form",legendCss:"wmd-legend",errorCss:"wmd-error",requiredReason:"Required",dialogCss:"wmd-dialog",dialog:!1,modal:!0,dialogZIndex:10,closeOnEsc:!0,id:"",onSubmit:null,onDestroy:null},o);var s,l,u,d,h=[],f=[];return o.id||(o.id=a(6,{upper:!1})),s=document.createElement("form"),s.id=o.id,s.className=o.css,s.onsubmit=function(){return"function"==typeof o.onSubmit&&o.onSubmit(s),!1},l=document.createElement("fieldset"),s.appendChild(l),legend=document.createElement("div"),legend.className=o.legendCss,legend.style.display="none",l.appendChild(legend),u=document.createElement("div"),u.className=o.errorCss,u.style.display="none",l.appendChild(u),o.dialog&&(d=new g({modal:o.modal,zIndex:o.dialogZIndex,css:o.dialogCss,closeOnEsc:!1,insertion:s})),t(document,"keypress",function(e){var t=e||window.event,n=t.keyCode||t.which;switch(n){case 27:o.closeOnEsc&&s.destroy()}},h),n(s,{addField:function(e,t){return this.insertField(-1,e,t)},destroy:function(){var e,t;for("function"==typeof o.onDestroy&&o.onDestroy(this);h.length>0;)c(h[0].element,h[0].event,h[0].callback,h);for(e=0,t=f.length;t>e;e++)f[e].value&&("function"==typeof f[e].value.destroy?f[e].value.destroy():f[e].value.parentNode&&f[e].value.parentNode.removeChild(f[e].value),f[e].value=null);return f=[],s.parentNode.removeChild(s),s=null,d&&(d.destroy(),d=null),this},error:function(e){return e=(e||"").toString(),u.innerHTML=e,u.style.display=e?"":"none",d&&d.redraw(),this},fill:function(e){var t;if(e)for(t in e)e.hasOwnProperty(t)&&this.setValue(t,e[t]);return this},focus:function(){var e,t;for(e=0,t=f.length;t>e;e++)if(f[e].value&&"function"==typeof f[e].value.focus){f[e].value.focus();break}return this},getDialog:function(){return d},getField:function(e){var t=r(e);return t?t.value:null},getValue:function(e,t){var n=r(e);return n&&n.value&&"function"==typeof n.value.getValue?n.value.getValue(t):void 0},insertField:function(e,t,n){return this.removeField(t),e>=0&&f.length>e?(f.splice(e,0,{key:t,value:n}),f[e+1].value.parentNode.insertBefore(n,f[e+1].value)):(f.push({key:t,value:n}),l.appendChild(n)),d&&d.redraw(),this},removeField:function(e){var t=r(e);return t.value&&("function"==typeof t.value.destroy?t.value.destroy():t.value.parentNode&&t.value.parentNode.removeChild(t.value),i(e)),d&&d.redraw(),this},serialize:function(e,t){var n,r,i,s,a,l={},c=0;for(s=0,a=f.length;a>s;s++)n=f[s].value,r=n.getValue(t),i=n.getType(),"empty"!==i&&"submit"!==i&&"reset"!==i&&"button"!==i&&(""!==r&&"undefined"!=typeof r&&null!==r&&0!==r.length?(l[f[s].key]=r,n.error()):e&&n.isRequired()&&n.isVisible()&&(c+=1,n.error(!0,o.requiredReason)));return d&&d.redraw(),0===c?l:null},setTitle:function(e){return legend.innerHTML=e||"",legend.style.display=e?"":"none",this},setValue:function(e,t){var n=r(e);return n&&n.value&&"function"==typeof n.value.setValue&&n.value.setValue(t),this}}),s.setTitle(e),s},y=function(o,r,i){o=o||"",r=r.toLowerCase(),i=n({required:!1,inline:!1,"float":!1,items:null,itemsAlign:"left",css:"wmd-field",inputCss:"wmd-fieldinput",buttonCss:"wmd-fieldbutton",passwordCss:"wmd-fieldpassword",labelCss:"wmd-fieldlabel",inlineCss:"wmd-fieldinline",floatCss:"wmd-fieldfloat",errorCss:"wmd-fielderror",reasonCss:"wmd-fieldreason",hiddenCss:"wmd-hidden",value:"",group:"",id:"",insertion:null},i);var u,d,h,f,p,m=[],g=!1;if(s(y.TYPES,r)<0)throw'"'+r+'" is not a valid field type.';switch(i.id||(i.id=a(6,{upper:!1})),u=document.createElement("div"),u.id=i.id,u.className=i.css,i.inline&&e(u,i.inlineCss),i["float"]&&addClassname(u,i.floatCss),"hidden"===r&&e(u,i.hiddenCss),o&&(d=document.createElement("label"),d.className=i.labelCss,d.innerHTML=o,i.required&&(d.innerHTML+=" <em>*</em>"),u.appendChild(d)),h=document.createElement("div"),i.inline&&(h.className=i.inlineCss),u.appendChild(h),p=document.createElement("div"),p.className=i.reasonCss,p.style.display="none",u.appendChild(p),r){case"empty":break;case"checkbox":case"radio":f=y.createInputList(h,r,i);break;case"select":f=y.createSelectList(h,r,i),g=!0;break;case"textarea":f=y.createTextArea(h,r,i),g=!0;break;default:f=y.createInput(h,r,i),g=!0}return"undefined"==typeof f&&(f=null),d&&g&&d.setAttribute("for",y.getInputId(i)),n(u,{addEvent:function(e,n){var o,i,s=function(){n(u)};if(f)switch(r){case"empty":break;case"checkbox":case"radio":for(o=0,i=f.length;i>o;o++)t(f[o],e,s,m);break;default:t(f,e,s,m)}return this},destroy:function(){for(;m.length>0;)c(m[0].element,m[0].action,m[0].callback,m);return u.parentNode.removeChild(u),this},error:function(t,n){return t?(e(u,i.errorCss),n?(p.innerHTML=n.toString(),p.style.display=""):(p.innerHTML="",p.style.display="none")):(l(u,i.errorCss),p.style.display="none"),this},focus:function(){return this.isVisible()&&f&&(f.length>0&&("checkbox"===r||"radio"===r)?f[0].focus():f.focus()),this},hide:function(){u.style.display="none"},insert:function(e){e=e||"";var t,n,o;if("string"==typeof e)for(t=document.createElement("div"),t.innerHTML=e,n=0,o=t.childNodes.length;o>n;n++)h.appendChild(t.childNodes[n]);else h.appendChild(e);return this},isRequired:function(){return!!i.required},isVisible:function(){return!u.style.display},getLabel:function(){return o||""},getType:function(){return r},getValue:function(e){function t(t){var n,o,r;return e&&(n=/^(true)|(false)$/i.exec(t),n?t="undefined"==typeof n[2]||""===n[2]?!0:!1:(o=/^\d*(\.?\d+)?$/.exec(t),o&&o.length>0&&(r="undefined"==typeof o[1]||""===o[1]?parseInt(t,10):parseFloat(t,10),isNaN(r)||(t=r)))),t}var n,o,i;if(f)switch(r){case"empty":break;case"checkbox":for(n=[],o=0,i=f.length;i>o;o++)f[o].checked&&n.push(t(f[o].value));break;case"radio":for(n="",o=0,i=f.length;i>o;o++)if(f[o].checked){n=t(f[o].value);break}break;case"select":n=t(f.options[input.selectedIndex].value);break;default:n=f.value}return n},setValue:function(e){function t(e){return(e||"").toString()===(n?n.value:"")}var n,o,i,s,a,l;if(f)switch(r){case"empty":break;case"checkbox":if("number"==typeof e?e=getArrayFromEnum(e):"string"==typeof e&&(e=[e]),e.length)for(o=0,i=f.length;i>o;o++)for(n=f[o],n.checked="",s=0,a=e.length;a>s;s++)if(t(e[s])){n.checked="checked";break}break;case"radio":for(e=(e||"").toString(),o=0,i=f.length;i>o;o++)f[o].checked="",f[o].value===e&&(f[o].checked="checked");break;case"select":for(e=(e||"").toString(),l=0,o=0,i=f.options.length;i>o;o++)if(f.options[o].value===e){l=o;break}f.selectedIndex=l;break;default:e=(e||"").toString(),f.value=e}return this},show:function(){u.style.display=""}}),i.insertion&&u.insert(i.insertion),u},n(y,{TYPES:["button","checkbox","empty","file","hidden","image","password","radio","reset","submit","text","select","textarea"],createInput:function(t,n,o){var r=y.getInputId(o),i="button"===n||"submit"===n||"reset"===n?o.buttonCss:o.inputCss,s=document.createElement("input");return s.id=r,s.name=r,s.className=i,s.type=n,"password"===n&&o.passwordCss&&e(s,o.passwordCss),s.value=(o.value||"").toString(),t.appendChild(s),s},createInputList:function(e,t,n){var o,r,i,s,a,l,c,u=[];if(n.items&&n.items.length)for(o=0,r=n.items.length;r>o;o++)i=y.getInputId(n)+"_"+o,s=document.createElement("span"),s.className=n.inputCss,a=document.createElement("label"),a["for"]=i,a.innerHTML=n.items[o].text,l=n.group?n.group:i,c=document.createElement("input"),c.id=i,c.type=t,c.name=l,n.items[o].selected&&(c.checked="checked"),n.items[o].value&&(c.value=n.items[o].value.toString()),"right"===n.itemsAlign?(s.appendChild(c),s.appendChild(document.createTextNode("&nbsp;")),s.appendChild(a)):(s.appendChild(a),s.appendChild(document.createTextNode("&nbsp;")),s.appendChild(c)),e.appendChild(s),u.push(c);return u},createSelectList:function(e,t,n){var o,r,i,s,a=y.getInputId(n);if(i=document.createElement("select"),i.id=a,i.name=a,i.className=n.inputCss,e.appendChild(i),n.items&&n.items.length){for(s=-1,o=0,r=n.items.length;r>o;o++)i.options[o]=new Option(n.items[o].text,n.items[o].value),n[o].selected&&(s=o);s>-1&&(i.selectedIndex=s)}return i},createTextArea:function(e,t,n){var o=y.getInputId(n),r=document.createElement("textarea");return r.id=o,r.name=o,r.className=n.inputCss,r.value=(n.value||"").toString(),e.appendChild(r),r},getArrayFromEnum:function(e,t){var n,o=[],r=1;for("string"==typeof e&&(n=parseInt(e,10),e=isNaN(parse)?0:n);e>=r;)(r&e)===r&&o.push(t?t[r.toString()]:r),r=2*r;return o},getEnumFromArray:function(e){var t,n,o,r=0;for(n=0,o=e.length;o>n;n++)t=e[n],"string"==typeof t&&(t=parseInt(t,10),isNaN(t)&&(t=void 0)),"number"==typeof t&&(r|=t);return r},getInputId:function(e){return e.id+"_input"}}),C={add:function(e,t){function n(e){r+=1,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+r+"]:"),s+="\n"+e}function o(e,t,o,s){var a="";return i[o]?(n(i[o]),a=t+r+s):a=e,a}var r=0,i={},s="",a=/(\[(?:\[[^\]]*\]|[^\[\]])*\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g;return e.before=C.strip(e.before,i),e.selection=C.strip(e.selection,i),e.after=C.strip(e.after,i),e.before=e.before.replace(a,o),t?n(t):e.selection=e.selection.replace(a,o),e.after=e.after.replace(a,o),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after=e.after+"\n\n"+s,r},createDialog:function(e,t,n){var o,r,i=!1;n="function"==typeof n?n:function(){},o=m.createSubmitCancelForm(e,function(){var e=o.serialize(!0);e&&(i=!0,o.destroy(),n(e.url))},function(){i||n("")}),r=new y(t,"text",{required:!0,value:"http://",insertion:b.urlFieldInsertion}),o.insertField(0,"url",r),r.focus()},strip:function(e,t){var n=/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm;return e=e.replace(n,function(e,n,o,r,i){var s="";return t[n]=e.replace(/\s*$/,""),r&&(t[n]=e.replace(/["(](.+?)[")]$/,""),s=r+i),s})}},window.WMD=h,window.WMD.Command=m,window.WMD.Form=w,window.WMD.Field=y}();var getApiFromString=function(e){return e=e.split("."),PykCharts[e[1]][e[2]]};window.onload=function(){$("#loader .centered").slideUp(function(){$("#loader").fadeOut(function(){$("#loader").remove()})});var e=document.getElementsByTagName("body")[0].id;switch(e){case"scopejs_themes_new":case"scopejs_themes_create":case"scopejs_themes_edit":case"scopejs_themes_update":Rumali.ConfigThemeSubmitForm(),Rumali.liveEditor();break;case"scopejs_vizs_new":case"scopejs_vizs_create":Rumali.chartView();break;case"scopejs_vizs_edit":case"scopejs_vizs_update":"Grid"!==chart_name&&"One Number indicators"!==chart_name?Rumali.liveEditor():"One Number indicators"!==chart_name?Rumali.showAndEditGridPage():Rumali.showAndEditBoxPage();break;case"scopejs_datacast_pulls_create":case"scopejs_datacasts_file":case"scopejs_datacasts_upload":Rumali.newDataStorePage();break;case"scopejs_vizs_show":"Grid"!==chart_name?Rumali.showChartPage():Rumali.showAndEditGridPage();break;case"scopejs_datacasts_new":case"scopejs_datacasts_create":Rumali.dataCastNewPage();break;case"scopejs_datacasts_edit":case"scopejs_datacasts_update":Rumali.dataCastNewPage(),Rumali.initDataCastGrid();break;case"scopejs_articles_edit":case"scopejs_articles_update":Rumali.newArticleCreate();case"scopejs_reports_show":Rumali.buildCharts.loadReportChart();case"scopejs_reports_new":case"scopejs_reports_create":case"scopejs_reports_edit":case"scopejs_reports_update":Rumali.reportsNewPage()}};